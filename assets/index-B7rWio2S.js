(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const k of document.querySelectorAll('link[rel="modulepreload"]'))_(k);new MutationObserver(k=>{for(const b of k)if(b.type==="childList")for(const T of b.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&_(T)}).observe(document,{childList:!0,subtree:!0});function v(k){const b={};return k.integrity&&(b.integrity=k.integrity),k.referrerPolicy&&(b.referrerPolicy=k.referrerPolicy),k.crossOrigin==="use-credentials"?b.credentials="include":k.crossOrigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function _(k){if(k.ep)return;k.ep=!0;const b=v(k);fetch(k.href,b)}})();const LA=(a,h)=>a===h,Hp=Symbol("solid-proxy"),yE=typeof Proxy=="function",qp={equals:LA};let vE=IE;const hl=1,Wp=2,bE={owned:null,cleanups:null,context:null,owner:null};var nn=null;let ig=null,OA=null,mn=null,da=null,ys=null,Yp=0;function xE(a,h){const v=mn,_=nn,k=a.length===0,b=h===void 0?_:h,T=k?bE:{owned:null,cleanups:null,context:b?b.context:null,owner:b},t=k?a:()=>a(()=>Eo(()=>Cf(T)));nn=T,mn=null;try{return fl(t,!0)}finally{mn=v,nn=_}}function fa(a,h){h=h?Object.assign({},qp,h):qp;const v={value:a,observers:null,observerSlots:null,comparator:h.equals||void 0},_=k=>(typeof k=="function"&&(k=k(v.value)),AE(v,k));return[ME.bind(v),_]}function Pa(a,h,v){const _=Ly(a,h,!1,hl);zf(_)}function Of(a,h,v){vE=NA;const _=Ly(a,h,!1,hl);_.user=!0,ys?ys.push(_):zf(_)}function kn(a,h,v){v=v?Object.assign({},qp,v):qp;const _=Ly(a,h,!0,0);return _.observers=null,_.observerSlots=null,_.comparator=v.equals||void 0,zf(_),ME.bind(_)}function zA(a){return fl(a,!1)}function Eo(a){if(mn===null)return a();const h=mn;mn=null;try{return a()}finally{mn=h}}function Cy(a,h,v){const _=Array.isArray(a);let k,b=v&&v.defer;return T=>{let t;if(_){t=Array(a.length);for(let D=0;D<a.length;D++)t[D]=a[D]()}else t=a();if(b)return b=!1,T;const S=Eo(()=>h(t,k,T));return k=t,S}}function Kp(a){Of(()=>Eo(a))}function wE(a){return nn===null||(nn.cleanups===null?nn.cleanups=[a]:nn.cleanups.push(a)),a}function EE(){return nn}function TE(a,h){const v=nn,_=mn;nn=a,mn=null;try{return fl(h,!0)}catch(k){Oy(k)}finally{nn=v,mn=_}}function kA(a){const h=mn,v=nn;return Promise.resolve().then(()=>{mn=h,nn=v;let _;return fl(a,!1),mn=nn=null,_?_.done:void 0})}const[hC,fC]=fa(!1);function SE(a,h){const v=Symbol("context");return{id:v,Provider:jA(v),defaultValue:a}}function Ry(a){let h;return nn&&nn.context&&(h=nn.context[a.id])!==void 0?h:a.defaultValue}function Dy(a){const h=kn(a),v=kn(()=>vy(h()));return v.toArray=()=>{const _=v();return Array.isArray(_)?_:_!=null?[_]:[]},v}function ME(){if(this.sources&&this.state)if(this.state===hl)zf(this);else{const a=da;da=null,fl(()=>Zp(this),!1),da=a}if(mn){const a=this.observers?this.observers.length:0;mn.sources?(mn.sources.push(this),mn.sourceSlots.push(a)):(mn.sources=[this],mn.sourceSlots=[a]),this.observers?(this.observers.push(mn),this.observerSlots.push(mn.sources.length-1)):(this.observers=[mn],this.observerSlots=[mn.sources.length-1])}return this.value}function AE(a,h,v){let _=a.value;return(!a.comparator||!a.comparator(_,h))&&(a.value=h,a.observers&&a.observers.length&&fl(()=>{for(let k=0;k<a.observers.length;k+=1){const b=a.observers[k],T=ig&&ig.running;T&&ig.disposed.has(b),(T?!b.tState:!b.state)&&(b.pure?da.push(b):ys.push(b),b.observers&&PE(b)),T||(b.state=hl)}if(da.length>1e6)throw da=[],new Error},!1)),h}function zf(a){if(!a.fn)return;Cf(a);const h=Yp;BA(a,a.value,h)}function BA(a,h,v){let _;const k=nn,b=mn;mn=nn=a;try{_=a.fn(h)}catch(T){return a.pure&&(a.state=hl,a.owned&&a.owned.forEach(Cf),a.owned=null),a.updatedAt=v+1,Oy(T)}finally{mn=b,nn=k}(!a.updatedAt||a.updatedAt<=v)&&(a.updatedAt!=null&&"observers"in a?AE(a,_):a.value=_,a.updatedAt=v)}function Ly(a,h,v,_=hl,k){const b={fn:a,state:_,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:h,owner:nn,context:nn?nn.context:null,pure:v};return nn===null||nn!==bE&&(nn.owned?nn.owned.push(b):nn.owned=[b]),b}function $p(a){if(a.state===0)return;if(a.state===Wp)return Zp(a);if(a.suspense&&Eo(a.suspense.inFallback))return a.suspense.effects.push(a);const h=[a];for(;(a=a.owner)&&(!a.updatedAt||a.updatedAt<Yp);)a.state&&h.push(a);for(let v=h.length-1;v>=0;v--)if(a=h[v],a.state===hl)zf(a);else if(a.state===Wp){const _=da;da=null,fl(()=>Zp(a,h[0]),!1),da=_}}function fl(a,h){if(da)return a();let v=!1;h||(da=[]),ys?v=!0:ys=[],Yp++;try{const _=a();return FA(v),_}catch(_){v||(ys=null),da=null,Oy(_)}}function FA(a){if(da&&(IE(da),da=null),a)return;const h=ys;ys=null,h.length&&fl(()=>vE(h),!1)}function IE(a){for(let h=0;h<a.length;h++)$p(a[h])}function NA(a){let h,v=0;for(h=0;h<a.length;h++){const _=a[h];_.user?a[v++]=_:$p(_)}for(h=0;h<v;h++)$p(a[h])}function Zp(a,h){a.state=0;for(let v=0;v<a.sources.length;v+=1){const _=a.sources[v];if(_.sources){const k=_.state;k===hl?_!==h&&(!_.updatedAt||_.updatedAt<Yp)&&$p(_):k===Wp&&Zp(_,h)}}}function PE(a){for(let h=0;h<a.observers.length;h+=1){const v=a.observers[h];v.state||(v.state=Wp,v.pure?da.push(v):ys.push(v),v.observers&&PE(v))}}function Cf(a){let h;if(a.sources)for(;a.sources.length;){const v=a.sources.pop(),_=a.sourceSlots.pop(),k=v.observers;if(k&&k.length){const b=k.pop(),T=v.observerSlots.pop();_<k.length&&(b.sourceSlots[T]=_,k[_]=b,v.observerSlots[_]=T)}}if(a.tOwned){for(h=a.tOwned.length-1;h>=0;h--)Cf(a.tOwned[h]);delete a.tOwned}if(a.owned){for(h=a.owned.length-1;h>=0;h--)Cf(a.owned[h]);a.owned=null}if(a.cleanups){for(h=a.cleanups.length-1;h>=0;h--)a.cleanups[h]();a.cleanups=null}a.state=0}function UA(a){return a instanceof Error?a:new Error(typeof a=="string"?a:"Unknown error",{cause:a})}function Oy(a,h=nn){throw UA(a)}function vy(a){if(typeof a=="function"&&!a.length)return vy(a());if(Array.isArray(a)){const h=[];for(let v=0;v<a.length;v++){const _=vy(a[v]);Array.isArray(_)?h.push.apply(h,_):h.push(_)}return h}return a}function jA(a,h){return function(_){let k;return Pa(()=>k=Eo(()=>(nn.context={...nn.context,[a]:_.value},Dy(()=>_.children))),void 0),k}}function Gn(a,h){return Eo(()=>a(h||{}))}function Rp(){return!0}const by={get(a,h,v){return h===Hp?v:a.get(h)},has(a,h){return h===Hp?!0:a.has(h)},set:Rp,deleteProperty:Rp,getOwnPropertyDescriptor(a,h){return{configurable:!0,enumerable:!0,get(){return a.get(h)},set:Rp,deleteProperty:Rp}},ownKeys(a){return a.keys()}};function ng(a){return(a=typeof a=="function"?a():a)?a:{}}function VA(){for(let a=0,h=this.length;a<h;++a){const v=this[a]();if(v!==void 0)return v}}function xy(...a){let h=!1;for(let T=0;T<a.length;T++){const t=a[T];h=h||!!t&&Hp in t,a[T]=typeof t=="function"?(h=!0,kn(t)):t}if(yE&&h)return new Proxy({get(T){for(let t=a.length-1;t>=0;t--){const S=ng(a[t])[T];if(S!==void 0)return S}},has(T){for(let t=a.length-1;t>=0;t--)if(T in ng(a[t]))return!0;return!1},keys(){const T=[];for(let t=0;t<a.length;t++)T.push(...Object.keys(ng(a[t])));return[...new Set(T)]}},by);const v={},_=Object.create(null);for(let T=a.length-1;T>=0;T--){const t=a[T];if(!t)continue;const S=Object.getOwnPropertyNames(t);for(let D=S.length-1;D>=0;D--){const w=S[D];if(w==="__proto__"||w==="constructor")continue;const E=Object.getOwnPropertyDescriptor(t,w);if(!_[w])_[w]=E.get?{enumerable:!0,configurable:!0,get:VA.bind(v[w]=[E.get.bind(t)])}:E.value!==void 0?E:void 0;else{const m=v[w];m&&(E.get?m.push(E.get.bind(t)):E.value!==void 0&&m.push(()=>E.value))}}}const k={},b=Object.keys(_);for(let T=b.length-1;T>=0;T--){const t=b[T],S=_[t];S&&S.get?Object.defineProperty(k,t,S):k[t]=S?S.value:void 0}return k}function GA(a,...h){if(yE&&Hp in a){const k=new Set(h.length>1?h.flat():h[0]),b=h.map(T=>new Proxy({get(t){return T.includes(t)?a[t]:void 0},has(t){return T.includes(t)&&t in a},keys(){return T.filter(t=>t in a)}},by));return b.push(new Proxy({get(T){return k.has(T)?void 0:a[T]},has(T){return k.has(T)?!1:T in a},keys(){return Object.keys(a).filter(T=>!k.has(T))}},by)),b}const v={},_=h.map(()=>({}));for(const k of Object.getOwnPropertyNames(a)){const b=Object.getOwnPropertyDescriptor(a,k),T=!b.get&&!b.set&&b.enumerable&&b.writable&&b.configurable;let t=!1,S=0;for(const D of h)D.includes(k)&&(t=!0,T?_[S][k]=b.value:Object.defineProperty(_[S],k,b)),++S;t||(T?v[k]=b.value:Object.defineProperty(v,k,b))}return[..._,v]}const HA=a=>`Stale read from <${a}>.`;function CE(a){const h=a.keyed,v=kn(()=>a.when,void 0,{equals:(_,k)=>h?_===k:!_==!k});return kn(()=>{const _=v();if(_){const k=a.children;return typeof k=="function"&&k.length>0?Eo(()=>k(h?_:()=>{if(!Eo(v))throw HA("Show");return a.when})):k}return a.fallback},void 0,void 0)}const qA=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"],WA=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline",...qA]),$A=new Set(["innerHTML","textContent","innerText","children"]),ZA=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),XA=Object.assign(Object.create(null),{class:"className",formnovalidate:{$:"formNoValidate",BUTTON:1,INPUT:1},ismap:{$:"isMap",IMG:1},nomodule:{$:"noModule",SCRIPT:1},playsinline:{$:"playsInline",VIDEO:1},readonly:{$:"readOnly",INPUT:1,TEXTAREA:1}});function YA(a,h){const v=XA[a];return typeof v=="object"?v[h]?v.$:void 0:v}const KA=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]);function JA(a,h,v){let _=v.length,k=h.length,b=_,T=0,t=0,S=h[k-1].nextSibling,D=null;for(;T<k||t<b;){if(h[T]===v[t]){T++,t++;continue}for(;h[k-1]===v[b-1];)k--,b--;if(k===T){const w=b<_?t?v[t-1].nextSibling:v[b-t]:S;for(;t<b;)a.insertBefore(v[t++],w)}else if(b===t)for(;T<k;)(!D||!D.has(h[T]))&&h[T].remove(),T++;else if(h[T]===v[b-1]&&v[t]===h[k-1]){const w=h[--k].nextSibling;a.insertBefore(v[t++],h[T++].nextSibling),a.insertBefore(v[--b],w),h[k]=v[b]}else{if(!D){D=new Map;let E=t;for(;E<b;)D.set(v[E],E++)}const w=D.get(h[T]);if(w!=null)if(t<w&&w<b){let E=T,m=1,y;for(;++E<k&&E<b&&!((y=D.get(h[E]))==null||y!==w+m);)m++;if(m>w-t){const p=h[T];for(;t<w;)a.insertBefore(v[t++],p)}else a.replaceChild(v[t++],h[T++])}else T++;else h[T++].remove()}}}const Ux="_$DX_DELEGATE";function QA(a,h,v,_={}){let k;return xE(b=>{k=b,h===document?a():cl(h,a(),h.firstChild?null:void 0,v)},_.owner),()=>{k(),h.textContent=""}}function bs(a,h,v){let _;const k=()=>{const T=document.createElement("template");return T.innerHTML=a,T.content.firstChild},b=()=>(_||(_=k())).cloneNode(!0);return b.cloneNode=b,b}function RE(a,h=window.document){const v=h[Ux]||(h[Ux]=new Set);for(let _=0,k=a.length;_<k;_++){const b=a[_];v.has(b)||(v.add(b),h.addEventListener(b,l3))}}function wy(a,h,v){v==null?a.removeAttribute(h):a.setAttribute(h,v)}function e3(a,h,v){v?a.setAttribute(h,""):a.removeAttribute(h)}function t3(a,h){h==null?a.removeAttribute("class"):a.className=h}function r3(a,h,v,_){if(_)Array.isArray(v)?(a[`$$${h}`]=v[0],a[`$$${h}Data`]=v[1]):a[`$$${h}`]=v;else if(Array.isArray(v)){const k=v[0];a.addEventListener(h,v[0]=b=>k.call(a,v[1],b))}else a.addEventListener(h,v,typeof v!="function"&&v)}function i3(a,h,v={}){const _=Object.keys(h||{}),k=Object.keys(v);let b,T;for(b=0,T=k.length;b<T;b++){const t=k[b];!t||t==="undefined"||h[t]||(jx(a,t,!1),delete v[t])}for(b=0,T=_.length;b<T;b++){const t=_[b],S=!!h[t];!t||t==="undefined"||v[t]===S||!S||(jx(a,t,!0),v[t]=S)}return v}function n3(a,h,v){if(!h)return v?wy(a,"style"):h;const _=a.style;if(typeof h=="string")return _.cssText=h;typeof v=="string"&&(_.cssText=v=void 0),v||(v={}),h||(h={});let k,b;for(b in v)h[b]==null&&_.removeProperty(b),delete v[b];for(b in h)k=h[b],k!==v[b]&&(_.setProperty(b,k),v[b]=k);return v}function a3(a,h={},v,_){const k={};return Pa(()=>k.children=Rf(a,h.children,k.children)),Pa(()=>typeof h.ref=="function"&&kf(h.ref,a)),Pa(()=>o3(a,h,v,!0,k,!0)),k}function kf(a,h,v){return Eo(()=>a(h,v))}function cl(a,h,v,_){if(v!==void 0&&!_&&(_=[]),typeof h!="function")return Rf(a,h,_,v);Pa(k=>Rf(a,h(),k,v),_)}function o3(a,h,v,_,k={},b=!1){h||(h={});for(const T in k)if(!(T in h)){if(T==="children")continue;k[T]=Vx(a,T,null,k[T],v,b,h)}for(const T in h){if(T==="children")continue;const t=h[T];k[T]=Vx(a,T,t,k[T],v,b,h)}}function s3(a){return a.toLowerCase().replace(/-([a-z])/g,(h,v)=>v.toUpperCase())}function jx(a,h,v){const _=h.trim().split(/\s+/);for(let k=0,b=_.length;k<b;k++)a.classList.toggle(_[k],v)}function Vx(a,h,v,_,k,b,T){let t,S,D,w,E;if(h==="style")return n3(a,v,_);if(h==="classList")return i3(a,v,_);if(v===_)return _;if(h==="ref")b||v(a);else if(h.slice(0,3)==="on:"){const m=h.slice(3);_&&a.removeEventListener(m,_,typeof _!="function"&&_),v&&a.addEventListener(m,v,typeof v!="function"&&v)}else if(h.slice(0,10)==="oncapture:"){const m=h.slice(10);_&&a.removeEventListener(m,_,!0),v&&a.addEventListener(m,v,!0)}else if(h.slice(0,2)==="on"){const m=h.slice(2).toLowerCase(),y=KA.has(m);if(!y&&_){const p=Array.isArray(_)?_[0]:_;a.removeEventListener(m,p)}(y||v)&&(r3(a,m,v,y),y&&RE([m]))}else h.slice(0,5)==="attr:"?wy(a,h.slice(5),v):h.slice(0,5)==="bool:"?e3(a,h.slice(5),v):(E=h.slice(0,5)==="prop:")||(D=$A.has(h))||(w=YA(h,a.tagName))||(S=WA.has(h))||(t=a.nodeName.includes("-")||"is"in T)?(E&&(h=h.slice(5),S=!0),h==="class"||h==="className"?t3(a,v):t&&!S&&!D?a[s3(h)]=v:a[w||h]=v):wy(a,ZA[h]||h,v);return v}function l3(a){let h=a.target;const v=`$$${a.type}`,_=a.target,k=a.currentTarget,b=S=>Object.defineProperty(a,"target",{configurable:!0,value:S}),T=()=>{const S=h[v];if(S&&!h.disabled){const D=h[`${v}Data`];if(D!==void 0?S.call(h,D,a):S.call(h,a),a.cancelBubble)return}return h.host&&typeof h.host!="string"&&!h.host._$host&&h.contains(a.target)&&b(h.host),!0},t=()=>{for(;T()&&(h=h._$host||h.parentNode||h.host););};if(Object.defineProperty(a,"currentTarget",{configurable:!0,get(){return h||document}}),a.composedPath){const S=a.composedPath();b(S[0]);for(let D=0;D<S.length-2&&(h=S[D],!!T());D++){if(h._$host){h=h._$host,t();break}if(h.parentNode===k)break}}else t();b(_)}function Rf(a,h,v,_,k){for(;typeof v=="function";)v=v();if(h===v)return v;const b=typeof h,T=_!==void 0;if(a=T&&v[0]&&v[0].parentNode||a,b==="string"||b==="number"){if(b==="number"&&(h=h.toString(),h===v))return v;if(T){let t=v[0];t&&t.nodeType===3?t.data!==h&&(t.data=h):t=document.createTextNode(h),v=zc(a,v,_,t)}else v!==""&&typeof v=="string"?v=a.firstChild.data=h:v=a.textContent=h}else if(h==null||b==="boolean")v=zc(a,v,_);else{if(b==="function")return Pa(()=>{let t=h();for(;typeof t=="function";)t=t();v=Rf(a,t,v,_)}),()=>v;if(Array.isArray(h)){const t=[],S=v&&Array.isArray(v);if(Ey(t,h,v,k))return Pa(()=>v=Rf(a,t,v,_,!0)),()=>v;if(t.length===0){if(v=zc(a,v,_),T)return v}else S?v.length===0?Gx(a,t,_):JA(a,v,t):(v&&zc(a),Gx(a,t));v=t}else if(h.nodeType){if(Array.isArray(v)){if(T)return v=zc(a,v,_,h);zc(a,v,null,h)}else v==null||v===""||!a.firstChild?a.appendChild(h):a.replaceChild(h,a.firstChild);v=h}}return v}function Ey(a,h,v,_){let k=!1;for(let b=0,T=h.length;b<T;b++){let t=h[b],S=v&&v[a.length],D;if(!(t==null||t===!0||t===!1))if((D=typeof t)=="object"&&t.nodeType)a.push(t);else if(Array.isArray(t))k=Ey(a,t,S)||k;else if(D==="function")if(_){for(;typeof t=="function";)t=t();k=Ey(a,Array.isArray(t)?t:[t],Array.isArray(S)?S:[S])||k}else a.push(t),k=!0;else{const w=String(t);S&&S.nodeType===3&&S.data===w?a.push(S):a.push(document.createTextNode(w))}}return k}function Gx(a,h,v=null){for(let _=0,k=h.length;_<k;_++)a.insertBefore(h[_],v)}function zc(a,h,v,_){if(v===void 0)return a.textContent="";const k=_||document.createTextNode("");if(h.length){let b=!1;for(let T=h.length-1;T>=0;T--){const t=h[T];if(k!==t){const S=t.parentNode===a;!b&&!T?S?a.replaceChild(k,t):a.insertBefore(k,v):S&&t.remove()}else b=!0}}else a.insertBefore(k,v);return[k]}const u3=!1;function DE(){let a=new Set;function h(k){return a.add(k),()=>a.delete(k)}let v=!1;function _(k,b){if(v)return!(v=!1);const T={to:k,options:b,defaultPrevented:!1,preventDefault:()=>T.defaultPrevented=!0};for(const t of a)t.listener({...T,from:t.location,retry:S=>{S&&(v=!0),t.navigate(k,{...b,resolve:!1})}});return!T.defaultPrevented}return{subscribe:h,confirm:_}}let Ty;function zy(){(!window.history.state||window.history.state._depth==null)&&window.history.replaceState({...window.history.state,_depth:window.history.length-1},""),Ty=window.history.state._depth}zy();function c3(a){return{...a,_depth:window.history.state&&window.history.state._depth}}function h3(a,h){let v=!1;return()=>{const _=Ty;zy();const k=_==null?null:Ty-_;if(v){v=!1;return}k&&h(k)?(v=!0,window.history.go(-k)):a()}}const f3=/^(?:[a-z0-9]+:)?\/\//i,d3=/^\/+|(\/)\/+$/g,LE="http://sr";function su(a,h=!1){const v=a.replace(d3,"$1");return v?h||/^[?#]/.test(v)?v:"/"+v:""}function Up(a,h,v){if(f3.test(h))return;const _=su(a),k=v&&su(v);let b="";return!k||h.startsWith("/")?b=_:k.toLowerCase().indexOf(_.toLowerCase())!==0?b=_+k:b=k,(b||"/")+su(h,!b)}function p3(a,h){if(a==null)throw new Error(h);return a}function m3(a,h){return su(a).replace(/\/*(\*.*)?$/g,"")+su(h)}function OE(a){const h={};return a.searchParams.forEach((v,_)=>{_ in h?Array.isArray(h[_])?h[_].push(v):h[_]=[h[_],v]:h[_]=v}),h}function _3(a,h,v){const[_,k]=a.split("/*",2),b=_.split("/").filter(Boolean),T=b.length;return t=>{const S=t.split("/").filter(Boolean),D=S.length-T;if(D<0||D>0&&k===void 0&&!h)return null;const w={path:T?"":"/",params:{}},E=m=>v===void 0?void 0:v[m];for(let m=0;m<T;m++){const y=b[m],p=y[0]===":",C=p?S[m]:S[m].toLowerCase(),z=p?y.slice(1):y.toLowerCase();if(p&&ag(C,E(z)))w.params[z]=C;else if(p||!ag(C,z))return null;w.path+=`/${C}`}if(k){const m=D?S.slice(-D).join("/"):"";if(ag(m,E(k)))w.params[k]=m;else return null}return w}}function ag(a,h){const v=_=>_===a;return h===void 0?!0:typeof h=="string"?v(h):typeof h=="function"?h(a):Array.isArray(h)?h.some(v):h instanceof RegExp?h.test(a):!1}function g3(a){const[h,v]=a.pattern.split("/*",2),_=h.split("/").filter(Boolean);return _.reduce((k,b)=>k+(b.startsWith(":")?2:3),_.length-(v===void 0?0:1))}function zE(a){const h=new Map,v=EE();return new Proxy({},{get(_,k){return h.has(k)||TE(v,()=>h.set(k,kn(()=>a()[k]))),h.get(k)()},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}},ownKeys(){return Reflect.ownKeys(a())}})}function kE(a){let h=/(\/?\:[^\/]+)\?/.exec(a);if(!h)return[a];let v=a.slice(0,h.index),_=a.slice(h.index+h[0].length);const k=[v,v+=h[1]];for(;h=/^(\/\:[^\/]+)\?/.exec(_);)k.push(v+=h[1]),_=_.slice(h[0].length);return kE(_).reduce((b,T)=>[...b,...k.map(t=>t+T)],[])}const y3=100,BE=SE(),ky=SE(),By=()=>p3(Ry(BE),"<A> and 'use' router primitives can be only used inside a Route."),v3=()=>Ry(ky)||By().base,b3=a=>{const h=v3();return kn(()=>h.resolvePath(a()))},x3=a=>{const h=By();return kn(()=>{const v=a();return v!==void 0?h.renderPath(v):v})},w3=()=>By().location;function E3(a,h=""){const{component:v,preload:_,load:k,children:b,info:T}=a,t=!b||Array.isArray(b)&&!b.length,S={key:a,component:v,preload:_||k,info:T};return FE(a.path).reduce((D,w)=>{for(const E of kE(w)){const m=m3(h,E);let y=t?m:m.split("/*",1)[0];y=y.split("/").map(p=>p.startsWith(":")||p.startsWith("*")?p:encodeURIComponent(p)).join("/"),D.push({...S,originalPath:w,pattern:y,matcher:_3(y,!t,a.matchFilters)})}return D},[])}function T3(a,h=0){return{routes:a,score:g3(a[a.length-1])*1e4-h,matcher(v){const _=[];for(let k=a.length-1;k>=0;k--){const b=a[k],T=b.matcher(v);if(!T)return null;_.unshift({...T,route:b})}return _}}}function FE(a){return Array.isArray(a)?a:[a]}function NE(a,h="",v=[],_=[]){const k=FE(a);for(let b=0,T=k.length;b<T;b++){const t=k[b];if(t&&typeof t=="object"){t.hasOwnProperty("path")||(t.path="");const S=E3(t,h);for(const D of S){v.push(D);const w=Array.isArray(t.children)&&t.children.length===0;if(t.children&&!w)NE(t.children,D.pattern,v,_);else{const E=T3([...v],_.length);_.push(E)}v.pop()}}}return v.length?_:_.sort((b,T)=>T.score-b.score)}function og(a,h){for(let v=0,_=a.length;v<_;v++){const k=a[v].matcher(h);if(k)return k}return[]}function S3(a,h,v){const _=new URL(LE),k=kn(w=>{const E=a();try{return new URL(E,_)}catch{return console.error(`Invalid path ${E}`),w}},_,{equals:(w,E)=>w.href===E.href}),b=kn(()=>k().pathname),T=kn(()=>k().search,!0),t=kn(()=>k().hash),S=()=>"",D=Cy(T,()=>OE(k()));return{get pathname(){return b()},get search(){return T()},get hash(){return t()},get state(){return h()},get key(){return S()},query:v?v(D):zE(D)}}let au;function M3(){return au}function A3(a,h,v,_={}){const{signal:[k,b],utils:T={}}=a,t=T.parsePath||(ue=>ue),S=T.renderPath||(ue=>ue),D=T.beforeLeave||DE(),w=Up("",_.base||"");if(w===void 0)throw new Error(`${w} is not a valid base path`);w&&!k().value&&b({value:w,replace:!0,scroll:!1});const[E,m]=fa(!1);let y;const p=(ue,Se)=>{Se.value===C()&&Se.state===A()||(y===void 0&&m(!0),au=ue,y=Se,kA(()=>{y===Se&&(z(y.value),P(y.state),U[1](Le=>Le.filter(Pe=>Pe.pending)))}).finally(()=>{y===Se&&zA(()=>{au=void 0,ue==="navigate"&&te(y),m(!1),y=void 0})}))},[C,z]=fa(k().value),[A,P]=fa(k().state),x=S3(C,A,T.queryWrapper),O=[],U=fa([]),G=kn(()=>typeof _.transformUrl=="function"?og(h(),_.transformUrl(x.pathname)):og(h(),x.pathname)),Z=()=>{const ue=G(),Se={};for(let Le=0;Le<ue.length;Le++)Object.assign(Se,ue[Le].params);return Se},X=T.paramsWrapper?T.paramsWrapper(Z,h):zE(Z),W={pattern:w,path:()=>w,outlet:()=>null,resolvePath(ue){return Up(w,ue)}};return Pa(Cy(k,ue=>p("native",ue),{defer:!0})),{base:W,location:x,params:X,isRouting:E,renderPath:S,parsePath:t,navigatorFactory:re,matches:G,beforeLeave:D,preloadRoute:ye,singleFlight:_.singleFlight===void 0?!0:_.singleFlight,submissions:U};function J(ue,Se,Le){Eo(()=>{if(typeof Se=="number"){Se&&(T.go?T.go(Se):console.warn("Router integration does not support relative routing"));return}const Pe=!Se||Se[0]==="?",{replace:Ee,resolve:Me,scroll:He,state:nt}={replace:!1,resolve:!Pe,scroll:!0,...Le},ht=Me?ue.resolvePath(Se):Up(Pe&&x.pathname||"",Se);if(ht===void 0)throw new Error(`Path '${Se}' is not a routable path`);if(O.length>=y3)throw new Error("Too many redirects");const Fe=C();(ht!==Fe||nt!==A())&&(u3||D.confirm(ht,Le)&&(O.push({value:Fe,replace:Ee,scroll:He,state:A()}),p("navigate",{value:ht,state:nt})))})}function re(ue){return ue=ue||Ry(ky)||W,(Se,Le)=>J(ue,Se,Le)}function te(ue){const Se=O[0];Se&&(b({...ue,replace:Se.replace,scroll:Se.scroll}),O.length=0)}function ye(ue,Se){const Le=og(h(),ue.pathname),Pe=au;au="preload";for(let Ee in Le){const{route:Me,params:He}=Le[Ee];Me.component&&Me.component.preload&&Me.component.preload();const{preload:nt}=Me;Se&&nt&&TE(v(),()=>nt({params:He,location:{pathname:ue.pathname,search:ue.search,hash:ue.hash,query:OE(ue),state:null,key:""},intent:"preload"}))}au=Pe}}function I3(a,h,v,_){const{base:k,location:b,params:T}=a,{pattern:t,component:S,preload:D}=_().route,w=kn(()=>_().path);S&&S.preload&&S.preload();const E=D?D({params:T,location:b,intent:au||"initial"}):void 0;return{parent:h,pattern:t,path:w,outlet:()=>S?Gn(S,{params:T,location:b,data:E,get children(){return v()}}):v(),resolvePath(y){return Up(k.path(),y,w())}}}const P3=a=>h=>{const{base:v}=h,_=Dy(()=>h.children),k=kn(()=>NE(_(),h.base||""));let b;const T=A3(a,k,()=>b,{base:v,singleFlight:h.singleFlight,transformUrl:h.transformUrl});return a.create&&a.create(T),Gn(BE.Provider,{value:T,get children(){return Gn(C3,{routerState:T,get root(){return h.root},get preload(){return h.rootPreload||h.rootLoad},get children(){return[kn(()=>(b=EE())&&null),Gn(R3,{routerState:T,get branches(){return k()}})]}})}})};function C3(a){const h=a.routerState.location,v=a.routerState.params,_=kn(()=>a.preload&&Eo(()=>{a.preload({params:v,location:h,intent:M3()||"initial"})}));return Gn(CE,{get when(){return a.root},keyed:!0,get fallback(){return a.children},children:k=>Gn(k,{params:v,location:h,get data(){return _()},get children(){return a.children}})})}function R3(a){const h=[];let v;const _=kn(Cy(a.routerState.matches,(k,b,T)=>{let t=b&&k.length===b.length;const S=[];for(let D=0,w=k.length;D<w;D++){const E=b&&b[D],m=k[D];T&&E&&m.route.key===E.route.key?S[D]=T[D]:(t=!1,h[D]&&h[D](),xE(y=>{h[D]=y,S[D]=I3(a.routerState,S[D-1]||a.routerState.base,Hx(()=>_()[D+1]),()=>a.routerState.matches()[D])}))}return h.splice(k.length).forEach(D=>D()),T&&t?T:(v=S[0],S)}));return Hx(()=>_()&&v)()}const Hx=a=>()=>Gn(CE,{get when(){return a()},keyed:!0,children:h=>Gn(ky.Provider,{value:h,get children(){return h.outlet()}})}),sg=a=>{const h=Dy(()=>a.children);return xy(a,{get children(){return h()}})};function D3([a,h],v,_){return[a,_?k=>h(_(k)):h]}function L3(a){let h=!1;const v=k=>typeof k=="string"?{value:k}:k,_=D3(fa(v(a.get()),{equals:(k,b)=>k.value===b.value&&k.state===b.state}),void 0,k=>(!h&&a.set(k),k));return a.init&&wE(a.init((k=a.get())=>{h=!0,_[1](v(k)),h=!1})),P3({signal:_,create:a.create,utils:a.utils})}function O3(a,h,v){return a.addEventListener(h,v),()=>a.removeEventListener(h,v)}function z3(a,h){const v=a&&document.getElementById(a);v?v.scrollIntoView():h&&window.scrollTo(0,0)}const k3=new Map;function B3(a=!0,h=!1,v="/_server",_){return k=>{const b=k.base.path(),T=k.navigatorFactory(k.base);let t,S;function D(C){return C.namespaceURI==="http://www.w3.org/2000/svg"}function w(C){if(C.defaultPrevented||C.button!==0||C.metaKey||C.altKey||C.ctrlKey||C.shiftKey)return;const z=C.composedPath().find(G=>G instanceof Node&&G.nodeName.toUpperCase()==="A");if(!z||h&&!z.hasAttribute("link"))return;const A=D(z),P=A?z.href.baseVal:z.href;if((A?z.target.baseVal:z.target)||!P&&!z.hasAttribute("state"))return;const O=(z.getAttribute("rel")||"").split(/\s+/);if(z.hasAttribute("download")||O&&O.includes("external"))return;const U=A?new URL(P,document.baseURI):new URL(P);if(!(U.origin!==window.location.origin||b&&U.pathname&&!U.pathname.toLowerCase().startsWith(b.toLowerCase())))return[z,U]}function E(C){const z=w(C);if(!z)return;const[A,P]=z,x=k.parsePath(P.pathname+P.search+P.hash),O=A.getAttribute("state");C.preventDefault(),T(x,{resolve:!1,replace:A.hasAttribute("replace"),scroll:!A.hasAttribute("noscroll"),state:O?JSON.parse(O):void 0})}function m(C){const z=w(C);if(!z)return;const[A,P]=z;_&&(P.pathname=_(P.pathname)),k.preloadRoute(P,A.getAttribute("preload")!=="false")}function y(C){clearTimeout(t);const z=w(C);if(!z)return S=null;const[A,P]=z;S!==A&&(_&&(P.pathname=_(P.pathname)),t=setTimeout(()=>{k.preloadRoute(P,A.getAttribute("preload")!=="false"),S=A},20))}function p(C){if(C.defaultPrevented)return;let z=C.submitter&&C.submitter.hasAttribute("formaction")?C.submitter.getAttribute("formaction"):C.target.getAttribute("action");if(!z)return;if(!z.startsWith("https://action/")){const P=new URL(z,LE);if(z=k.parsePath(P.pathname+P.search),!z.startsWith(v))return}if(C.target.method.toUpperCase()!=="POST")throw new Error("Only POST forms are supported for Actions");const A=k3.get(z);if(A){C.preventDefault();const P=new FormData(C.target,C.submitter);A.call({r:k,f:C.target},C.target.enctype==="multipart/form-data"?P:new URLSearchParams(P))}}RE(["click","submit"]),document.addEventListener("click",E),a&&(document.addEventListener("mousemove",y,{passive:!0}),document.addEventListener("focusin",m,{passive:!0}),document.addEventListener("touchstart",m,{passive:!0})),document.addEventListener("submit",p),wE(()=>{document.removeEventListener("click",E),a&&(document.removeEventListener("mousemove",y),document.removeEventListener("focusin",m),document.removeEventListener("touchstart",m)),document.removeEventListener("submit",p)})}}function F3(a){const h=()=>{const _=window.location.pathname.replace(/^\/+/,"/")+window.location.search,k=window.history.state&&window.history.state._depth&&Object.keys(window.history.state).length===1?void 0:window.history.state;return{value:_+window.location.hash,state:k}},v=DE();return L3({get:h,set({value:_,replace:k,scroll:b,state:T}){k?window.history.replaceState(c3(T),"",_):window.history.pushState(T,"",_),z3(decodeURIComponent(window.location.hash.slice(1)),b),zy()},init:_=>O3(window,"popstate",h3(_,k=>{if(k&&k<0)return!v.confirm(k);{const b=h();return!v.confirm(b.value,{state:b.state})}})),create:B3(a.preload,a.explicitLinks,a.actionBase,a.transformUrl),utils:{go:_=>window.history.go(_),beforeLeave:v}})(a)}var N3=bs("<a>");function lg(a){a=xy({inactiveClass:"inactive",activeClass:"active"},a);const[,h]=GA(a,["href","state","class","activeClass","inactiveClass","end"]),v=b3(()=>a.href),_=x3(v),k=w3(),b=kn(()=>{const T=v();if(T===void 0)return[!1,!1];const t=su(T.split(/[?#]/,1)[0]).toLowerCase(),S=decodeURI(su(k.pathname).toLowerCase());return[a.end?t===S:S.startsWith(t+"/")||S===t,t===S]});return(()=>{var T=N3();return a3(T,xy(h,{get href(){return _()||a.href},get state(){return JSON.stringify(a.state)},get classList(){return{...a.class&&{[a.class]:!0},[a.inactiveClass]:!b()[0],[a.activeClass]:b()[0],...h.classList}},link:"",get"aria-current"(){return b()[1]?"page":void 0}}),!1),T})()}var Hr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fy(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function UE(a){if(a.__esModule)return a;var h=a.default;if(typeof h=="function"){var v=function _(){return this instanceof _?Reflect.construct(h,arguments,this.constructor):h.apply(this,arguments)};v.prototype=h.prototype}else v={};return Object.defineProperty(v,"__esModule",{value:!0}),Object.keys(a).forEach(function(_){var k=Object.getOwnPropertyDescriptor(a,_);Object.defineProperty(v,_,k.get?k:{enumerable:!0,get:function(){return a[_]}})}),v}var jE={exports:{}};(function(a,h){(function(v,_){a.exports=_()})(Hr,function(){var v,_,k;function b(t,S){if(!v)v=S;else if(!_)_=S;else{var D="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+v+")(sharedChunk); ("+_+")(sharedChunk); self.onerror = null;",w={};v(w),k=S(w),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(k.workerUrl=window.URL.createObjectURL(new Blob([D],{type:"text/javascript"})))}}b(["exports"],function(t){function S(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var D,w={},E={};function m(){if(D)return E;D=1,Object.defineProperty(E,"__esModule",{value:!0}),E.setMatrixArrayType=function(f){E.ARRAY_TYPE=e=f},E.toRadian=function(f){return f*s},E.equals=function(f,l){return Math.abs(f-l)<=o*Math.max(1,Math.abs(f),Math.abs(l))},E.RANDOM=E.ARRAY_TYPE=E.EPSILON=void 0;var o=1e-6;E.EPSILON=o;var e=typeof Float32Array<"u"?Float32Array:Array;E.ARRAY_TYPE=e;var i=Math.random;E.RANDOM=i;var s=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var f=0,l=arguments.length;l--;)f+=arguments[l]*arguments[l];return Math.sqrt(f)}),E}var y,p={};function C(){if(y)return p;function o(l){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},o(l)}y=1,Object.defineProperty(p,"__esModule",{value:!0}),p.create=function(){var l=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l},p.clone=function(l){var d=new e.ARRAY_TYPE(4);return d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[3],d},p.copy=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[3],l},p.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l},p.fromValues=function(l,d,R,N){var $=new e.ARRAY_TYPE(4);return $[0]=l,$[1]=d,$[2]=R,$[3]=N,$},p.set=function(l,d,R,N,$){return l[0]=d,l[1]=R,l[2]=N,l[3]=$,l},p.transpose=function(l,d){if(l===d){var R=d[1];l[1]=d[2],l[2]=R}else l[0]=d[0],l[1]=d[2],l[2]=d[1],l[3]=d[3];return l},p.invert=function(l,d){var R=d[0],N=d[1],$=d[2],I=d[3],j=R*I-$*N;return j?(l[0]=I*(j=1/j),l[1]=-N*j,l[2]=-$*j,l[3]=R*j,l):null},p.adjoint=function(l,d){var R=d[0];return l[0]=d[3],l[1]=-d[1],l[2]=-d[2],l[3]=R,l},p.determinant=function(l){return l[0]*l[3]-l[2]*l[1]},p.multiply=s,p.rotate=function(l,d,R){var N=d[0],$=d[1],I=d[2],j=d[3],H=Math.sin(R),F=Math.cos(R);return l[0]=N*F+I*H,l[1]=$*F+j*H,l[2]=N*-H+I*F,l[3]=$*-H+j*F,l},p.scale=function(l,d,R){var N=d[1],$=d[2],I=d[3],j=R[0],H=R[1];return l[0]=d[0]*j,l[1]=N*j,l[2]=$*H,l[3]=I*H,l},p.fromRotation=function(l,d){var R=Math.sin(d),N=Math.cos(d);return l[0]=N,l[1]=R,l[2]=-R,l[3]=N,l},p.fromScaling=function(l,d){return l[0]=d[0],l[1]=0,l[2]=0,l[3]=d[1],l},p.str=function(l){return"mat2("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+")"},p.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3])},p.LDU=function(l,d,R,N){return l[2]=N[2]/N[0],R[0]=N[0],R[1]=N[1],R[3]=N[3]-l[2]*R[1],[l,d,R]},p.add=function(l,d,R){return l[0]=d[0]+R[0],l[1]=d[1]+R[1],l[2]=d[2]+R[2],l[3]=d[3]+R[3],l},p.subtract=f,p.exactEquals=function(l,d){return l[0]===d[0]&&l[1]===d[1]&&l[2]===d[2]&&l[3]===d[3]},p.equals=function(l,d){var R=l[0],N=l[1],$=l[2],I=l[3],j=d[0],H=d[1],F=d[2],V=d[3];return Math.abs(R-j)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(j))&&Math.abs(N-H)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(H))&&Math.abs($-F)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(F))&&Math.abs(I-V)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(V))},p.multiplyScalar=function(l,d,R){return l[0]=d[0]*R,l[1]=d[1]*R,l[2]=d[2]*R,l[3]=d[3]*R,l},p.multiplyScalarAndAdd=function(l,d,R,N){return l[0]=d[0]+R[0]*N,l[1]=d[1]+R[1]*N,l[2]=d[2]+R[2]*N,l[3]=d[3]+R[3]*N,l},p.sub=p.mul=void 0;var e=function(l,d){if(l&&l.__esModule)return l;if(l===null||o(l)!=="object"&&typeof l!="function")return{default:l};var R=i(void 0);if(R&&R.has(l))return R.get(l);var N={},$=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var I in l)if(I!=="default"&&Object.prototype.hasOwnProperty.call(l,I)){var j=$?Object.getOwnPropertyDescriptor(l,I):null;j&&(j.get||j.set)?Object.defineProperty(N,I,j):N[I]=l[I]}return N.default=l,R&&R.set(l,N),N}(m());function i(l){if(typeof WeakMap!="function")return null;var d=new WeakMap,R=new WeakMap;return(i=function(N){return N?R:d})(l)}function s(l,d,R){var N=d[0],$=d[1],I=d[2],j=d[3],H=R[0],F=R[1],V=R[2],Y=R[3];return l[0]=N*H+I*F,l[1]=$*H+j*F,l[2]=N*V+I*Y,l[3]=$*V+j*Y,l}function f(l,d,R){return l[0]=d[0]-R[0],l[1]=d[1]-R[1],l[2]=d[2]-R[2],l[3]=d[3]-R[3],l}return p.mul=s,p.sub=f,p}var z,A={};function P(){if(z)return A;function o(l){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},o(l)}z=1,Object.defineProperty(A,"__esModule",{value:!0}),A.create=function(){var l=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0,l[4]=0,l[5]=0),l[0]=1,l[3]=1,l},A.clone=function(l){var d=new e.ARRAY_TYPE(6);return d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[3],d[4]=l[4],d[5]=l[5],d},A.copy=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[3],l[4]=d[4],l[5]=d[5],l},A.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=0,l[5]=0,l},A.fromValues=function(l,d,R,N,$,I){var j=new e.ARRAY_TYPE(6);return j[0]=l,j[1]=d,j[2]=R,j[3]=N,j[4]=$,j[5]=I,j},A.set=function(l,d,R,N,$,I,j){return l[0]=d,l[1]=R,l[2]=N,l[3]=$,l[4]=I,l[5]=j,l},A.invert=function(l,d){var R=d[0],N=d[1],$=d[2],I=d[3],j=d[4],H=d[5],F=R*I-N*$;return F?(l[0]=I*(F=1/F),l[1]=-N*F,l[2]=-$*F,l[3]=R*F,l[4]=($*H-I*j)*F,l[5]=(N*j-R*H)*F,l):null},A.determinant=function(l){return l[0]*l[3]-l[1]*l[2]},A.multiply=s,A.rotate=function(l,d,R){var N=d[0],$=d[1],I=d[2],j=d[3],H=d[4],F=d[5],V=Math.sin(R),Y=Math.cos(R);return l[0]=N*Y+I*V,l[1]=$*Y+j*V,l[2]=N*-V+I*Y,l[3]=$*-V+j*Y,l[4]=H,l[5]=F,l},A.scale=function(l,d,R){var N=d[1],$=d[2],I=d[3],j=d[4],H=d[5],F=R[0],V=R[1];return l[0]=d[0]*F,l[1]=N*F,l[2]=$*V,l[3]=I*V,l[4]=j,l[5]=H,l},A.translate=function(l,d,R){var N=d[0],$=d[1],I=d[2],j=d[3],H=d[4],F=d[5],V=R[0],Y=R[1];return l[0]=N,l[1]=$,l[2]=I,l[3]=j,l[4]=N*V+I*Y+H,l[5]=$*V+j*Y+F,l},A.fromRotation=function(l,d){var R=Math.sin(d),N=Math.cos(d);return l[0]=N,l[1]=R,l[2]=-R,l[3]=N,l[4]=0,l[5]=0,l},A.fromScaling=function(l,d){return l[0]=d[0],l[1]=0,l[2]=0,l[3]=d[1],l[4]=0,l[5]=0,l},A.fromTranslation=function(l,d){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=d[0],l[5]=d[1],l},A.str=function(l){return"mat2d("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+", "+l[4]+", "+l[5]+")"},A.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3],l[4],l[5],1)},A.add=function(l,d,R){return l[0]=d[0]+R[0],l[1]=d[1]+R[1],l[2]=d[2]+R[2],l[3]=d[3]+R[3],l[4]=d[4]+R[4],l[5]=d[5]+R[5],l},A.subtract=f,A.multiplyScalar=function(l,d,R){return l[0]=d[0]*R,l[1]=d[1]*R,l[2]=d[2]*R,l[3]=d[3]*R,l[4]=d[4]*R,l[5]=d[5]*R,l},A.multiplyScalarAndAdd=function(l,d,R,N){return l[0]=d[0]+R[0]*N,l[1]=d[1]+R[1]*N,l[2]=d[2]+R[2]*N,l[3]=d[3]+R[3]*N,l[4]=d[4]+R[4]*N,l[5]=d[5]+R[5]*N,l},A.exactEquals=function(l,d){return l[0]===d[0]&&l[1]===d[1]&&l[2]===d[2]&&l[3]===d[3]&&l[4]===d[4]&&l[5]===d[5]},A.equals=function(l,d){var R=l[0],N=l[1],$=l[2],I=l[3],j=l[4],H=l[5],F=d[0],V=d[1],Y=d[2],oe=d[3],ce=d[4],we=d[5];return Math.abs(R-F)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(F))&&Math.abs(N-V)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(V))&&Math.abs($-Y)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(Y))&&Math.abs(I-oe)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(oe))&&Math.abs(j-ce)<=e.EPSILON*Math.max(1,Math.abs(j),Math.abs(ce))&&Math.abs(H-we)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(we))},A.sub=A.mul=void 0;var e=function(l,d){if(l&&l.__esModule)return l;if(l===null||o(l)!=="object"&&typeof l!="function")return{default:l};var R=i(void 0);if(R&&R.has(l))return R.get(l);var N={},$=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var I in l)if(I!=="default"&&Object.prototype.hasOwnProperty.call(l,I)){var j=$?Object.getOwnPropertyDescriptor(l,I):null;j&&(j.get||j.set)?Object.defineProperty(N,I,j):N[I]=l[I]}return N.default=l,R&&R.set(l,N),N}(m());function i(l){if(typeof WeakMap!="function")return null;var d=new WeakMap,R=new WeakMap;return(i=function(N){return N?R:d})(l)}function s(l,d,R){var N=d[0],$=d[1],I=d[2],j=d[3],H=d[4],F=d[5],V=R[0],Y=R[1],oe=R[2],ce=R[3],we=R[4],Ie=R[5];return l[0]=N*V+I*Y,l[1]=$*V+j*Y,l[2]=N*oe+I*ce,l[3]=$*oe+j*ce,l[4]=N*we+I*Ie+H,l[5]=$*we+j*Ie+F,l}function f(l,d,R){return l[0]=d[0]-R[0],l[1]=d[1]-R[1],l[2]=d[2]-R[2],l[3]=d[3]-R[3],l[4]=d[4]-R[4],l[5]=d[5]-R[5],l}return A.mul=s,A.sub=f,A}var x,O={};function U(){if(x)return O;function o(l){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},o(l)}x=1,Object.defineProperty(O,"__esModule",{value:!0}),O.create=function(){var l=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l},O.fromMat4=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[4],l[4]=d[5],l[5]=d[6],l[6]=d[8],l[7]=d[9],l[8]=d[10],l},O.clone=function(l){var d=new e.ARRAY_TYPE(9);return d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[3],d[4]=l[4],d[5]=l[5],d[6]=l[6],d[7]=l[7],d[8]=l[8],d},O.copy=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[3],l[4]=d[4],l[5]=d[5],l[6]=d[6],l[7]=d[7],l[8]=d[8],l},O.fromValues=function(l,d,R,N,$,I,j,H,F){var V=new e.ARRAY_TYPE(9);return V[0]=l,V[1]=d,V[2]=R,V[3]=N,V[4]=$,V[5]=I,V[6]=j,V[7]=H,V[8]=F,V},O.set=function(l,d,R,N,$,I,j,H,F,V){return l[0]=d,l[1]=R,l[2]=N,l[3]=$,l[4]=I,l[5]=j,l[6]=H,l[7]=F,l[8]=V,l},O.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=1,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},O.transpose=function(l,d){if(l===d){var R=d[1],N=d[2],$=d[5];l[1]=d[3],l[2]=d[6],l[3]=R,l[5]=d[7],l[6]=N,l[7]=$}else l[0]=d[0],l[1]=d[3],l[2]=d[6],l[3]=d[1],l[4]=d[4],l[5]=d[7],l[6]=d[2],l[7]=d[5],l[8]=d[8];return l},O.invert=function(l,d){var R=d[0],N=d[1],$=d[2],I=d[3],j=d[4],H=d[5],F=d[6],V=d[7],Y=d[8],oe=Y*j-H*V,ce=-Y*I+H*F,we=V*I-j*F,Ie=R*oe+N*ce+$*we;return Ie?(l[0]=oe*(Ie=1/Ie),l[1]=(-Y*N+$*V)*Ie,l[2]=(H*N-$*j)*Ie,l[3]=ce*Ie,l[4]=(Y*R-$*F)*Ie,l[5]=(-H*R+$*I)*Ie,l[6]=we*Ie,l[7]=(-V*R+N*F)*Ie,l[8]=(j*R-N*I)*Ie,l):null},O.adjoint=function(l,d){var R=d[0],N=d[1],$=d[2],I=d[3],j=d[4],H=d[5],F=d[6],V=d[7],Y=d[8];return l[0]=j*Y-H*V,l[1]=$*V-N*Y,l[2]=N*H-$*j,l[3]=H*F-I*Y,l[4]=R*Y-$*F,l[5]=$*I-R*H,l[6]=I*V-j*F,l[7]=N*F-R*V,l[8]=R*j-N*I,l},O.determinant=function(l){var d=l[3],R=l[4],N=l[5],$=l[6],I=l[7],j=l[8];return l[0]*(j*R-N*I)+l[1]*(-j*d+N*$)+l[2]*(I*d-R*$)},O.multiply=s,O.translate=function(l,d,R){var N=d[0],$=d[1],I=d[2],j=d[3],H=d[4],F=d[5],V=d[6],Y=d[7],oe=d[8],ce=R[0],we=R[1];return l[0]=N,l[1]=$,l[2]=I,l[3]=j,l[4]=H,l[5]=F,l[6]=ce*N+we*j+V,l[7]=ce*$+we*H+Y,l[8]=ce*I+we*F+oe,l},O.rotate=function(l,d,R){var N=d[0],$=d[1],I=d[2],j=d[3],H=d[4],F=d[5],V=d[6],Y=d[7],oe=d[8],ce=Math.sin(R),we=Math.cos(R);return l[0]=we*N+ce*j,l[1]=we*$+ce*H,l[2]=we*I+ce*F,l[3]=we*j-ce*N,l[4]=we*H-ce*$,l[5]=we*F-ce*I,l[6]=V,l[7]=Y,l[8]=oe,l},O.scale=function(l,d,R){var N=R[0],$=R[1];return l[0]=N*d[0],l[1]=N*d[1],l[2]=N*d[2],l[3]=$*d[3],l[4]=$*d[4],l[5]=$*d[5],l[6]=d[6],l[7]=d[7],l[8]=d[8],l},O.fromTranslation=function(l,d){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=1,l[5]=0,l[6]=d[0],l[7]=d[1],l[8]=1,l},O.fromRotation=function(l,d){var R=Math.sin(d),N=Math.cos(d);return l[0]=N,l[1]=R,l[2]=0,l[3]=-R,l[4]=N,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},O.fromScaling=function(l,d){return l[0]=d[0],l[1]=0,l[2]=0,l[3]=0,l[4]=d[1],l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},O.fromMat2d=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=0,l[3]=d[2],l[4]=d[3],l[5]=0,l[6]=d[4],l[7]=d[5],l[8]=1,l},O.fromQuat=function(l,d){var R=d[0],N=d[1],$=d[2],I=d[3],j=R+R,H=N+N,F=$+$,V=R*j,Y=N*j,oe=N*H,ce=$*j,we=$*H,Ie=$*F,me=I*j,Re=I*H,Ue=I*F;return l[0]=1-oe-Ie,l[3]=Y-Ue,l[6]=ce+Re,l[1]=Y+Ue,l[4]=1-V-Ie,l[7]=we-me,l[2]=ce-Re,l[5]=we+me,l[8]=1-V-oe,l},O.normalFromMat4=function(l,d){var R=d[0],N=d[1],$=d[2],I=d[3],j=d[4],H=d[5],F=d[6],V=d[7],Y=d[8],oe=d[9],ce=d[10],we=d[11],Ie=d[12],me=d[13],Re=d[14],Ue=d[15],$e=R*H-N*j,ct=R*F-$*j,lt=R*V-I*j,st=N*F-$*H,xt=N*V-I*H,dt=$*V-I*F,Et=Y*me-oe*Ie,It=Y*Re-ce*Ie,Mt=Y*Ue-we*Ie,Ct=oe*Re-ce*me,kt=oe*Ue-we*me,jt=ce*Ue-we*Re,Ot=$e*jt-ct*kt+lt*Ct+st*Mt-xt*It+dt*Et;return Ot?(l[0]=(H*jt-F*kt+V*Ct)*(Ot=1/Ot),l[1]=(F*Mt-j*jt-V*It)*Ot,l[2]=(j*kt-H*Mt+V*Et)*Ot,l[3]=($*kt-N*jt-I*Ct)*Ot,l[4]=(R*jt-$*Mt+I*It)*Ot,l[5]=(N*Mt-R*kt-I*Et)*Ot,l[6]=(me*dt-Re*xt+Ue*st)*Ot,l[7]=(Re*lt-Ie*dt-Ue*ct)*Ot,l[8]=(Ie*xt-me*lt+Ue*$e)*Ot,l):null},O.projection=function(l,d,R){return l[0]=2/d,l[1]=0,l[2]=0,l[3]=0,l[4]=-2/R,l[5]=0,l[6]=-1,l[7]=1,l[8]=1,l},O.str=function(l){return"mat3("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+", "+l[4]+", "+l[5]+", "+l[6]+", "+l[7]+", "+l[8]+")"},O.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8])},O.add=function(l,d,R){return l[0]=d[0]+R[0],l[1]=d[1]+R[1],l[2]=d[2]+R[2],l[3]=d[3]+R[3],l[4]=d[4]+R[4],l[5]=d[5]+R[5],l[6]=d[6]+R[6],l[7]=d[7]+R[7],l[8]=d[8]+R[8],l},O.subtract=f,O.multiplyScalar=function(l,d,R){return l[0]=d[0]*R,l[1]=d[1]*R,l[2]=d[2]*R,l[3]=d[3]*R,l[4]=d[4]*R,l[5]=d[5]*R,l[6]=d[6]*R,l[7]=d[7]*R,l[8]=d[8]*R,l},O.multiplyScalarAndAdd=function(l,d,R,N){return l[0]=d[0]+R[0]*N,l[1]=d[1]+R[1]*N,l[2]=d[2]+R[2]*N,l[3]=d[3]+R[3]*N,l[4]=d[4]+R[4]*N,l[5]=d[5]+R[5]*N,l[6]=d[6]+R[6]*N,l[7]=d[7]+R[7]*N,l[8]=d[8]+R[8]*N,l},O.exactEquals=function(l,d){return l[0]===d[0]&&l[1]===d[1]&&l[2]===d[2]&&l[3]===d[3]&&l[4]===d[4]&&l[5]===d[5]&&l[6]===d[6]&&l[7]===d[7]&&l[8]===d[8]},O.equals=function(l,d){var R=l[0],N=l[1],$=l[2],I=l[3],j=l[4],H=l[5],F=l[6],V=l[7],Y=l[8],oe=d[0],ce=d[1],we=d[2],Ie=d[3],me=d[4],Re=d[5],Ue=d[6],$e=d[7],ct=d[8];return Math.abs(R-oe)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(oe))&&Math.abs(N-ce)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(ce))&&Math.abs($-we)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(we))&&Math.abs(I-Ie)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(Ie))&&Math.abs(j-me)<=e.EPSILON*Math.max(1,Math.abs(j),Math.abs(me))&&Math.abs(H-Re)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(Re))&&Math.abs(F-Ue)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(Ue))&&Math.abs(V-$e)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs($e))&&Math.abs(Y-ct)<=e.EPSILON*Math.max(1,Math.abs(Y),Math.abs(ct))},O.sub=O.mul=void 0;var e=function(l,d){if(l&&l.__esModule)return l;if(l===null||o(l)!=="object"&&typeof l!="function")return{default:l};var R=i(void 0);if(R&&R.has(l))return R.get(l);var N={},$=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var I in l)if(I!=="default"&&Object.prototype.hasOwnProperty.call(l,I)){var j=$?Object.getOwnPropertyDescriptor(l,I):null;j&&(j.get||j.set)?Object.defineProperty(N,I,j):N[I]=l[I]}return N.default=l,R&&R.set(l,N),N}(m());function i(l){if(typeof WeakMap!="function")return null;var d=new WeakMap,R=new WeakMap;return(i=function(N){return N?R:d})(l)}function s(l,d,R){var N=d[0],$=d[1],I=d[2],j=d[3],H=d[4],F=d[5],V=d[6],Y=d[7],oe=d[8],ce=R[0],we=R[1],Ie=R[2],me=R[3],Re=R[4],Ue=R[5],$e=R[6],ct=R[7],lt=R[8];return l[0]=ce*N+we*j+Ie*V,l[1]=ce*$+we*H+Ie*Y,l[2]=ce*I+we*F+Ie*oe,l[3]=me*N+Re*j+Ue*V,l[4]=me*$+Re*H+Ue*Y,l[5]=me*I+Re*F+Ue*oe,l[6]=$e*N+ct*j+lt*V,l[7]=$e*$+ct*H+lt*Y,l[8]=$e*I+ct*F+lt*oe,l}function f(l,d,R){return l[0]=d[0]-R[0],l[1]=d[1]-R[1],l[2]=d[2]-R[2],l[3]=d[3]-R[3],l[4]=d[4]-R[4],l[5]=d[5]-R[5],l[6]=d[6]-R[6],l[7]=d[7]-R[7],l[8]=d[8]-R[8],l}return O.mul=s,O.sub=f,O}var G,Z={};function X(){if(G)return Z;function o(I){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(j){return typeof j}:function(j){return j&&typeof Symbol=="function"&&j.constructor===Symbol&&j!==Symbol.prototype?"symbol":typeof j},o(I)}G=1,Object.defineProperty(Z,"__esModule",{value:!0}),Z.create=function(){var I=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[6]=0,I[7]=0,I[8]=0,I[9]=0,I[11]=0,I[12]=0,I[13]=0,I[14]=0),I[0]=1,I[5]=1,I[10]=1,I[15]=1,I},Z.clone=function(I){var j=new e.ARRAY_TYPE(16);return j[0]=I[0],j[1]=I[1],j[2]=I[2],j[3]=I[3],j[4]=I[4],j[5]=I[5],j[6]=I[6],j[7]=I[7],j[8]=I[8],j[9]=I[9],j[10]=I[10],j[11]=I[11],j[12]=I[12],j[13]=I[13],j[14]=I[14],j[15]=I[15],j},Z.copy=function(I,j){return I[0]=j[0],I[1]=j[1],I[2]=j[2],I[3]=j[3],I[4]=j[4],I[5]=j[5],I[6]=j[6],I[7]=j[7],I[8]=j[8],I[9]=j[9],I[10]=j[10],I[11]=j[11],I[12]=j[12],I[13]=j[13],I[14]=j[14],I[15]=j[15],I},Z.fromValues=function(I,j,H,F,V,Y,oe,ce,we,Ie,me,Re,Ue,$e,ct,lt){var st=new e.ARRAY_TYPE(16);return st[0]=I,st[1]=j,st[2]=H,st[3]=F,st[4]=V,st[5]=Y,st[6]=oe,st[7]=ce,st[8]=we,st[9]=Ie,st[10]=me,st[11]=Re,st[12]=Ue,st[13]=$e,st[14]=ct,st[15]=lt,st},Z.set=function(I,j,H,F,V,Y,oe,ce,we,Ie,me,Re,Ue,$e,ct,lt,st){return I[0]=j,I[1]=H,I[2]=F,I[3]=V,I[4]=Y,I[5]=oe,I[6]=ce,I[7]=we,I[8]=Ie,I[9]=me,I[10]=Re,I[11]=Ue,I[12]=$e,I[13]=ct,I[14]=lt,I[15]=st,I},Z.identity=s,Z.transpose=function(I,j){if(I===j){var H=j[1],F=j[2],V=j[3],Y=j[6],oe=j[7],ce=j[11];I[1]=j[4],I[2]=j[8],I[3]=j[12],I[4]=H,I[6]=j[9],I[7]=j[13],I[8]=F,I[9]=Y,I[11]=j[14],I[12]=V,I[13]=oe,I[14]=ce}else I[0]=j[0],I[1]=j[4],I[2]=j[8],I[3]=j[12],I[4]=j[1],I[5]=j[5],I[6]=j[9],I[7]=j[13],I[8]=j[2],I[9]=j[6],I[10]=j[10],I[11]=j[14],I[12]=j[3],I[13]=j[7],I[14]=j[11],I[15]=j[15];return I},Z.invert=function(I,j){var H=j[0],F=j[1],V=j[2],Y=j[3],oe=j[4],ce=j[5],we=j[6],Ie=j[7],me=j[8],Re=j[9],Ue=j[10],$e=j[11],ct=j[12],lt=j[13],st=j[14],xt=j[15],dt=H*ce-F*oe,Et=H*we-V*oe,It=H*Ie-Y*oe,Mt=F*we-V*ce,Ct=F*Ie-Y*ce,kt=V*Ie-Y*we,jt=me*lt-Re*ct,Ot=me*st-Ue*ct,Kt=me*xt-$e*ct,ur=Re*st-Ue*lt,Jt=Re*xt-$e*lt,yr=Ue*xt-$e*st,_r=dt*yr-Et*Jt+It*ur+Mt*Kt-Ct*Ot+kt*jt;return _r?(I[0]=(ce*yr-we*Jt+Ie*ur)*(_r=1/_r),I[1]=(V*Jt-F*yr-Y*ur)*_r,I[2]=(lt*kt-st*Ct+xt*Mt)*_r,I[3]=(Ue*Ct-Re*kt-$e*Mt)*_r,I[4]=(we*Kt-oe*yr-Ie*Ot)*_r,I[5]=(H*yr-V*Kt+Y*Ot)*_r,I[6]=(st*It-ct*kt-xt*Et)*_r,I[7]=(me*kt-Ue*It+$e*Et)*_r,I[8]=(oe*Jt-ce*Kt+Ie*jt)*_r,I[9]=(F*Kt-H*Jt-Y*jt)*_r,I[10]=(ct*Ct-lt*It+xt*dt)*_r,I[11]=(Re*It-me*Ct-$e*dt)*_r,I[12]=(ce*Ot-oe*ur-we*jt)*_r,I[13]=(H*ur-F*Ot+V*jt)*_r,I[14]=(lt*Et-ct*Mt-st*dt)*_r,I[15]=(me*Mt-Re*Et+Ue*dt)*_r,I):null},Z.adjoint=function(I,j){var H=j[0],F=j[1],V=j[2],Y=j[3],oe=j[4],ce=j[5],we=j[6],Ie=j[7],me=j[8],Re=j[9],Ue=j[10],$e=j[11],ct=j[12],lt=j[13],st=j[14],xt=j[15];return I[0]=ce*(Ue*xt-$e*st)-Re*(we*xt-Ie*st)+lt*(we*$e-Ie*Ue),I[1]=-(F*(Ue*xt-$e*st)-Re*(V*xt-Y*st)+lt*(V*$e-Y*Ue)),I[2]=F*(we*xt-Ie*st)-ce*(V*xt-Y*st)+lt*(V*Ie-Y*we),I[3]=-(F*(we*$e-Ie*Ue)-ce*(V*$e-Y*Ue)+Re*(V*Ie-Y*we)),I[4]=-(oe*(Ue*xt-$e*st)-me*(we*xt-Ie*st)+ct*(we*$e-Ie*Ue)),I[5]=H*(Ue*xt-$e*st)-me*(V*xt-Y*st)+ct*(V*$e-Y*Ue),I[6]=-(H*(we*xt-Ie*st)-oe*(V*xt-Y*st)+ct*(V*Ie-Y*we)),I[7]=H*(we*$e-Ie*Ue)-oe*(V*$e-Y*Ue)+me*(V*Ie-Y*we),I[8]=oe*(Re*xt-$e*lt)-me*(ce*xt-Ie*lt)+ct*(ce*$e-Ie*Re),I[9]=-(H*(Re*xt-$e*lt)-me*(F*xt-Y*lt)+ct*(F*$e-Y*Re)),I[10]=H*(ce*xt-Ie*lt)-oe*(F*xt-Y*lt)+ct*(F*Ie-Y*ce),I[11]=-(H*(ce*$e-Ie*Re)-oe*(F*$e-Y*Re)+me*(F*Ie-Y*ce)),I[12]=-(oe*(Re*st-Ue*lt)-me*(ce*st-we*lt)+ct*(ce*Ue-we*Re)),I[13]=H*(Re*st-Ue*lt)-me*(F*st-V*lt)+ct*(F*Ue-V*Re),I[14]=-(H*(ce*st-we*lt)-oe*(F*st-V*lt)+ct*(F*we-V*ce)),I[15]=H*(ce*Ue-we*Re)-oe*(F*Ue-V*Re)+me*(F*we-V*ce),I},Z.determinant=function(I){var j=I[0],H=I[1],F=I[2],V=I[3],Y=I[4],oe=I[5],ce=I[6],we=I[7],Ie=I[8],me=I[9],Re=I[10],Ue=I[11],$e=I[12],ct=I[13],lt=I[14],st=I[15];return(j*oe-H*Y)*(Re*st-Ue*lt)-(j*ce-F*Y)*(me*st-Ue*ct)+(j*we-V*Y)*(me*lt-Re*ct)+(H*ce-F*oe)*(Ie*st-Ue*$e)-(H*we-V*oe)*(Ie*lt-Re*$e)+(F*we-V*ce)*(Ie*ct-me*$e)},Z.multiply=f,Z.translate=function(I,j,H){var F,V,Y,oe,ce,we,Ie,me,Re,Ue,$e,ct,lt=H[0],st=H[1],xt=H[2];return j===I?(I[12]=j[0]*lt+j[4]*st+j[8]*xt+j[12],I[13]=j[1]*lt+j[5]*st+j[9]*xt+j[13],I[14]=j[2]*lt+j[6]*st+j[10]*xt+j[14],I[15]=j[3]*lt+j[7]*st+j[11]*xt+j[15]):(V=j[1],Y=j[2],oe=j[3],ce=j[4],we=j[5],Ie=j[6],me=j[7],Re=j[8],Ue=j[9],$e=j[10],ct=j[11],I[0]=F=j[0],I[1]=V,I[2]=Y,I[3]=oe,I[4]=ce,I[5]=we,I[6]=Ie,I[7]=me,I[8]=Re,I[9]=Ue,I[10]=$e,I[11]=ct,I[12]=F*lt+ce*st+Re*xt+j[12],I[13]=V*lt+we*st+Ue*xt+j[13],I[14]=Y*lt+Ie*st+$e*xt+j[14],I[15]=oe*lt+me*st+ct*xt+j[15]),I},Z.scale=function(I,j,H){var F=H[0],V=H[1],Y=H[2];return I[0]=j[0]*F,I[1]=j[1]*F,I[2]=j[2]*F,I[3]=j[3]*F,I[4]=j[4]*V,I[5]=j[5]*V,I[6]=j[6]*V,I[7]=j[7]*V,I[8]=j[8]*Y,I[9]=j[9]*Y,I[10]=j[10]*Y,I[11]=j[11]*Y,I[12]=j[12],I[13]=j[13],I[14]=j[14],I[15]=j[15],I},Z.rotate=function(I,j,H,F){var V,Y,oe,ce,we,Ie,me,Re,Ue,$e,ct,lt,st,xt,dt,Et,It,Mt,Ct,kt,jt,Ot,Kt,ur,Jt=F[0],yr=F[1],_r=F[2],Er=Math.hypot(Jt,yr,_r);return Er<e.EPSILON?null:(Jt*=Er=1/Er,yr*=Er,_r*=Er,V=Math.sin(H),Y=Math.cos(H),we=j[1],Ie=j[2],me=j[3],Ue=j[5],$e=j[6],ct=j[7],st=j[9],xt=j[10],dt=j[11],Et=Jt*Jt*(oe=1-Y)+Y,Ct=Jt*yr*oe-_r*V,kt=yr*yr*oe+Y,jt=_r*yr*oe+Jt*V,Ot=Jt*_r*oe+yr*V,Kt=yr*_r*oe-Jt*V,ur=_r*_r*oe+Y,I[0]=(ce=j[0])*Et+(Re=j[4])*(It=yr*Jt*oe+_r*V)+(lt=j[8])*(Mt=_r*Jt*oe-yr*V),I[1]=we*Et+Ue*It+st*Mt,I[2]=Ie*Et+$e*It+xt*Mt,I[3]=me*Et+ct*It+dt*Mt,I[4]=ce*Ct+Re*kt+lt*jt,I[5]=we*Ct+Ue*kt+st*jt,I[6]=Ie*Ct+$e*kt+xt*jt,I[7]=me*Ct+ct*kt+dt*jt,I[8]=ce*Ot+Re*Kt+lt*ur,I[9]=we*Ot+Ue*Kt+st*ur,I[10]=Ie*Ot+$e*Kt+xt*ur,I[11]=me*Ot+ct*Kt+dt*ur,j!==I&&(I[12]=j[12],I[13]=j[13],I[14]=j[14],I[15]=j[15]),I)},Z.rotateX=function(I,j,H){var F=Math.sin(H),V=Math.cos(H),Y=j[4],oe=j[5],ce=j[6],we=j[7],Ie=j[8],me=j[9],Re=j[10],Ue=j[11];return j!==I&&(I[0]=j[0],I[1]=j[1],I[2]=j[2],I[3]=j[3],I[12]=j[12],I[13]=j[13],I[14]=j[14],I[15]=j[15]),I[4]=Y*V+Ie*F,I[5]=oe*V+me*F,I[6]=ce*V+Re*F,I[7]=we*V+Ue*F,I[8]=Ie*V-Y*F,I[9]=me*V-oe*F,I[10]=Re*V-ce*F,I[11]=Ue*V-we*F,I},Z.rotateY=function(I,j,H){var F=Math.sin(H),V=Math.cos(H),Y=j[0],oe=j[1],ce=j[2],we=j[3],Ie=j[8],me=j[9],Re=j[10],Ue=j[11];return j!==I&&(I[4]=j[4],I[5]=j[5],I[6]=j[6],I[7]=j[7],I[12]=j[12],I[13]=j[13],I[14]=j[14],I[15]=j[15]),I[0]=Y*V-Ie*F,I[1]=oe*V-me*F,I[2]=ce*V-Re*F,I[3]=we*V-Ue*F,I[8]=Y*F+Ie*V,I[9]=oe*F+me*V,I[10]=ce*F+Re*V,I[11]=we*F+Ue*V,I},Z.rotateZ=function(I,j,H){var F=Math.sin(H),V=Math.cos(H),Y=j[0],oe=j[1],ce=j[2],we=j[3],Ie=j[4],me=j[5],Re=j[6],Ue=j[7];return j!==I&&(I[8]=j[8],I[9]=j[9],I[10]=j[10],I[11]=j[11],I[12]=j[12],I[13]=j[13],I[14]=j[14],I[15]=j[15]),I[0]=Y*V+Ie*F,I[1]=oe*V+me*F,I[2]=ce*V+Re*F,I[3]=we*V+Ue*F,I[4]=Ie*V-Y*F,I[5]=me*V-oe*F,I[6]=Re*V-ce*F,I[7]=Ue*V-we*F,I},Z.fromTranslation=function(I,j){return I[0]=1,I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=1,I[6]=0,I[7]=0,I[8]=0,I[9]=0,I[10]=1,I[11]=0,I[12]=j[0],I[13]=j[1],I[14]=j[2],I[15]=1,I},Z.fromScaling=function(I,j){return I[0]=j[0],I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=j[1],I[6]=0,I[7]=0,I[8]=0,I[9]=0,I[10]=j[2],I[11]=0,I[12]=0,I[13]=0,I[14]=0,I[15]=1,I},Z.fromRotation=function(I,j,H){var F,V,Y,oe=H[0],ce=H[1],we=H[2],Ie=Math.hypot(oe,ce,we);return Ie<e.EPSILON?null:(oe*=Ie=1/Ie,ce*=Ie,we*=Ie,F=Math.sin(j),V=Math.cos(j),I[0]=oe*oe*(Y=1-V)+V,I[1]=ce*oe*Y+we*F,I[2]=we*oe*Y-ce*F,I[3]=0,I[4]=oe*ce*Y-we*F,I[5]=ce*ce*Y+V,I[6]=we*ce*Y+oe*F,I[7]=0,I[8]=oe*we*Y+ce*F,I[9]=ce*we*Y-oe*F,I[10]=we*we*Y+V,I[11]=0,I[12]=0,I[13]=0,I[14]=0,I[15]=1,I)},Z.fromXRotation=function(I,j){var H=Math.sin(j),F=Math.cos(j);return I[0]=1,I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=F,I[6]=H,I[7]=0,I[8]=0,I[9]=-H,I[10]=F,I[11]=0,I[12]=0,I[13]=0,I[14]=0,I[15]=1,I},Z.fromYRotation=function(I,j){var H=Math.sin(j),F=Math.cos(j);return I[0]=F,I[1]=0,I[2]=-H,I[3]=0,I[4]=0,I[5]=1,I[6]=0,I[7]=0,I[8]=H,I[9]=0,I[10]=F,I[11]=0,I[12]=0,I[13]=0,I[14]=0,I[15]=1,I},Z.fromZRotation=function(I,j){var H=Math.sin(j),F=Math.cos(j);return I[0]=F,I[1]=H,I[2]=0,I[3]=0,I[4]=-H,I[5]=F,I[6]=0,I[7]=0,I[8]=0,I[9]=0,I[10]=1,I[11]=0,I[12]=0,I[13]=0,I[14]=0,I[15]=1,I},Z.fromRotationTranslation=l,Z.fromQuat2=function(I,j){var H=new e.ARRAY_TYPE(3),F=-j[0],V=-j[1],Y=-j[2],oe=j[3],ce=j[4],we=j[5],Ie=j[6],me=j[7],Re=F*F+V*V+Y*Y+oe*oe;return Re>0?(H[0]=2*(ce*oe+me*F+we*Y-Ie*V)/Re,H[1]=2*(we*oe+me*V+Ie*F-ce*Y)/Re,H[2]=2*(Ie*oe+me*Y+ce*V-we*F)/Re):(H[0]=2*(ce*oe+me*F+we*Y-Ie*V),H[1]=2*(we*oe+me*V+Ie*F-ce*Y),H[2]=2*(Ie*oe+me*Y+ce*V-we*F)),l(I,j,H),I},Z.getTranslation=function(I,j){return I[0]=j[12],I[1]=j[13],I[2]=j[14],I},Z.getScaling=d,Z.getRotation=function(I,j){var H=new e.ARRAY_TYPE(3);d(H,j);var F=1/H[0],V=1/H[1],Y=1/H[2],oe=j[0]*F,ce=j[1]*V,we=j[2]*Y,Ie=j[4]*F,me=j[5]*V,Re=j[6]*Y,Ue=j[8]*F,$e=j[9]*V,ct=j[10]*Y,lt=oe+me+ct,st=0;return lt>0?(st=2*Math.sqrt(lt+1),I[3]=.25*st,I[0]=(Re-$e)/st,I[1]=(Ue-we)/st,I[2]=(ce-Ie)/st):oe>me&&oe>ct?(st=2*Math.sqrt(1+oe-me-ct),I[3]=(Re-$e)/st,I[0]=.25*st,I[1]=(ce+Ie)/st,I[2]=(Ue+we)/st):me>ct?(st=2*Math.sqrt(1+me-oe-ct),I[3]=(Ue-we)/st,I[0]=(ce+Ie)/st,I[1]=.25*st,I[2]=(Re+$e)/st):(st=2*Math.sqrt(1+ct-oe-me),I[3]=(ce-Ie)/st,I[0]=(Ue+we)/st,I[1]=(Re+$e)/st,I[2]=.25*st),I},Z.fromRotationTranslationScale=function(I,j,H,F){var V=j[0],Y=j[1],oe=j[2],ce=j[3],we=V+V,Ie=Y+Y,me=oe+oe,Re=V*we,Ue=V*Ie,$e=V*me,ct=Y*Ie,lt=Y*me,st=oe*me,xt=ce*we,dt=ce*Ie,Et=ce*me,It=F[0],Mt=F[1],Ct=F[2];return I[0]=(1-(ct+st))*It,I[1]=(Ue+Et)*It,I[2]=($e-dt)*It,I[3]=0,I[4]=(Ue-Et)*Mt,I[5]=(1-(Re+st))*Mt,I[6]=(lt+xt)*Mt,I[7]=0,I[8]=($e+dt)*Ct,I[9]=(lt-xt)*Ct,I[10]=(1-(Re+ct))*Ct,I[11]=0,I[12]=H[0],I[13]=H[1],I[14]=H[2],I[15]=1,I},Z.fromRotationTranslationScaleOrigin=function(I,j,H,F,V){var Y=j[0],oe=j[1],ce=j[2],we=j[3],Ie=Y+Y,me=oe+oe,Re=ce+ce,Ue=Y*Ie,$e=Y*me,ct=Y*Re,lt=oe*me,st=oe*Re,xt=ce*Re,dt=we*Ie,Et=we*me,It=we*Re,Mt=F[0],Ct=F[1],kt=F[2],jt=V[0],Ot=V[1],Kt=V[2],ur=(1-(lt+xt))*Mt,Jt=($e+It)*Mt,yr=(ct-Et)*Mt,_r=($e-It)*Ct,Er=(1-(Ue+xt))*Ct,rr=(st+dt)*Ct,kr=(ct+Et)*kt,vr=(st-dt)*kt,zr=(1-(Ue+lt))*kt;return I[0]=ur,I[1]=Jt,I[2]=yr,I[3]=0,I[4]=_r,I[5]=Er,I[6]=rr,I[7]=0,I[8]=kr,I[9]=vr,I[10]=zr,I[11]=0,I[12]=H[0]+jt-(ur*jt+_r*Ot+kr*Kt),I[13]=H[1]+Ot-(Jt*jt+Er*Ot+vr*Kt),I[14]=H[2]+Kt-(yr*jt+rr*Ot+zr*Kt),I[15]=1,I},Z.fromQuat=function(I,j){var H=j[0],F=j[1],V=j[2],Y=j[3],oe=H+H,ce=F+F,we=V+V,Ie=H*oe,me=F*oe,Re=F*ce,Ue=V*oe,$e=V*ce,ct=V*we,lt=Y*oe,st=Y*ce,xt=Y*we;return I[0]=1-Re-ct,I[1]=me+xt,I[2]=Ue-st,I[3]=0,I[4]=me-xt,I[5]=1-Ie-ct,I[6]=$e+lt,I[7]=0,I[8]=Ue+st,I[9]=$e-lt,I[10]=1-Ie-Re,I[11]=0,I[12]=0,I[13]=0,I[14]=0,I[15]=1,I},Z.frustum=function(I,j,H,F,V,Y,oe){var ce=1/(H-j),we=1/(V-F),Ie=1/(Y-oe);return I[0]=2*Y*ce,I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=2*Y*we,I[6]=0,I[7]=0,I[8]=(H+j)*ce,I[9]=(V+F)*we,I[10]=(oe+Y)*Ie,I[11]=-1,I[12]=0,I[13]=0,I[14]=oe*Y*2*Ie,I[15]=0,I},Z.perspectiveNO=R,Z.perspectiveZO=function(I,j,H,F,V){var Y,oe=1/Math.tan(j/2);return I[0]=oe/H,I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=oe,I[6]=0,I[7]=0,I[8]=0,I[9]=0,I[11]=-1,I[12]=0,I[13]=0,I[15]=0,V!=null&&V!==1/0?(I[10]=V*(Y=1/(F-V)),I[14]=V*F*Y):(I[10]=-1,I[14]=-F),I},Z.perspectiveFromFieldOfView=function(I,j,H,F){var V=Math.tan(j.upDegrees*Math.PI/180),Y=Math.tan(j.downDegrees*Math.PI/180),oe=Math.tan(j.leftDegrees*Math.PI/180),ce=Math.tan(j.rightDegrees*Math.PI/180),we=2/(oe+ce),Ie=2/(V+Y);return I[0]=we,I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=Ie,I[6]=0,I[7]=0,I[8]=-(oe-ce)*we*.5,I[9]=(V-Y)*Ie*.5,I[10]=F/(H-F),I[11]=-1,I[12]=0,I[13]=0,I[14]=F*H/(H-F),I[15]=0,I},Z.orthoNO=N,Z.orthoZO=function(I,j,H,F,V,Y,oe){var ce=1/(j-H),we=1/(F-V),Ie=1/(Y-oe);return I[0]=-2*ce,I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=-2*we,I[6]=0,I[7]=0,I[8]=0,I[9]=0,I[10]=Ie,I[11]=0,I[12]=(j+H)*ce,I[13]=(V+F)*we,I[14]=Y*Ie,I[15]=1,I},Z.lookAt=function(I,j,H,F){var V,Y,oe,ce,we,Ie,me,Re,Ue,$e,ct=j[0],lt=j[1],st=j[2],xt=F[0],dt=F[1],Et=F[2],It=H[0],Mt=H[1],Ct=H[2];return Math.abs(ct-It)<e.EPSILON&&Math.abs(lt-Mt)<e.EPSILON&&Math.abs(st-Ct)<e.EPSILON?s(I):(me=ct-It,Re=lt-Mt,Ue=st-Ct,V=dt*(Ue*=$e=1/Math.hypot(me,Re,Ue))-Et*(Re*=$e),Y=Et*(me*=$e)-xt*Ue,oe=xt*Re-dt*me,($e=Math.hypot(V,Y,oe))?(V*=$e=1/$e,Y*=$e,oe*=$e):(V=0,Y=0,oe=0),ce=Re*oe-Ue*Y,we=Ue*V-me*oe,Ie=me*Y-Re*V,($e=Math.hypot(ce,we,Ie))?(ce*=$e=1/$e,we*=$e,Ie*=$e):(ce=0,we=0,Ie=0),I[0]=V,I[1]=ce,I[2]=me,I[3]=0,I[4]=Y,I[5]=we,I[6]=Re,I[7]=0,I[8]=oe,I[9]=Ie,I[10]=Ue,I[11]=0,I[12]=-(V*ct+Y*lt+oe*st),I[13]=-(ce*ct+we*lt+Ie*st),I[14]=-(me*ct+Re*lt+Ue*st),I[15]=1,I)},Z.targetTo=function(I,j,H,F){var V=j[0],Y=j[1],oe=j[2],ce=F[0],we=F[1],Ie=F[2],me=V-H[0],Re=Y-H[1],Ue=oe-H[2],$e=me*me+Re*Re+Ue*Ue;$e>0&&(me*=$e=1/Math.sqrt($e),Re*=$e,Ue*=$e);var ct=we*Ue-Ie*Re,lt=Ie*me-ce*Ue,st=ce*Re-we*me;return($e=ct*ct+lt*lt+st*st)>0&&(ct*=$e=1/Math.sqrt($e),lt*=$e,st*=$e),I[0]=ct,I[1]=lt,I[2]=st,I[3]=0,I[4]=Re*st-Ue*lt,I[5]=Ue*ct-me*st,I[6]=me*lt-Re*ct,I[7]=0,I[8]=me,I[9]=Re,I[10]=Ue,I[11]=0,I[12]=V,I[13]=Y,I[14]=oe,I[15]=1,I},Z.str=function(I){return"mat4("+I[0]+", "+I[1]+", "+I[2]+", "+I[3]+", "+I[4]+", "+I[5]+", "+I[6]+", "+I[7]+", "+I[8]+", "+I[9]+", "+I[10]+", "+I[11]+", "+I[12]+", "+I[13]+", "+I[14]+", "+I[15]+")"},Z.frob=function(I){return Math.hypot(I[0],I[1],I[2],I[3],I[4],I[5],I[6],I[7],I[8],I[9],I[10],I[11],I[12],I[13],I[14],I[15])},Z.add=function(I,j,H){return I[0]=j[0]+H[0],I[1]=j[1]+H[1],I[2]=j[2]+H[2],I[3]=j[3]+H[3],I[4]=j[4]+H[4],I[5]=j[5]+H[5],I[6]=j[6]+H[6],I[7]=j[7]+H[7],I[8]=j[8]+H[8],I[9]=j[9]+H[9],I[10]=j[10]+H[10],I[11]=j[11]+H[11],I[12]=j[12]+H[12],I[13]=j[13]+H[13],I[14]=j[14]+H[14],I[15]=j[15]+H[15],I},Z.subtract=$,Z.multiplyScalar=function(I,j,H){return I[0]=j[0]*H,I[1]=j[1]*H,I[2]=j[2]*H,I[3]=j[3]*H,I[4]=j[4]*H,I[5]=j[5]*H,I[6]=j[6]*H,I[7]=j[7]*H,I[8]=j[8]*H,I[9]=j[9]*H,I[10]=j[10]*H,I[11]=j[11]*H,I[12]=j[12]*H,I[13]=j[13]*H,I[14]=j[14]*H,I[15]=j[15]*H,I},Z.multiplyScalarAndAdd=function(I,j,H,F){return I[0]=j[0]+H[0]*F,I[1]=j[1]+H[1]*F,I[2]=j[2]+H[2]*F,I[3]=j[3]+H[3]*F,I[4]=j[4]+H[4]*F,I[5]=j[5]+H[5]*F,I[6]=j[6]+H[6]*F,I[7]=j[7]+H[7]*F,I[8]=j[8]+H[8]*F,I[9]=j[9]+H[9]*F,I[10]=j[10]+H[10]*F,I[11]=j[11]+H[11]*F,I[12]=j[12]+H[12]*F,I[13]=j[13]+H[13]*F,I[14]=j[14]+H[14]*F,I[15]=j[15]+H[15]*F,I},Z.exactEquals=function(I,j){return I[0]===j[0]&&I[1]===j[1]&&I[2]===j[2]&&I[3]===j[3]&&I[4]===j[4]&&I[5]===j[5]&&I[6]===j[6]&&I[7]===j[7]&&I[8]===j[8]&&I[9]===j[9]&&I[10]===j[10]&&I[11]===j[11]&&I[12]===j[12]&&I[13]===j[13]&&I[14]===j[14]&&I[15]===j[15]},Z.equals=function(I,j){var H=I[0],F=I[1],V=I[2],Y=I[3],oe=I[4],ce=I[5],we=I[6],Ie=I[7],me=I[8],Re=I[9],Ue=I[10],$e=I[11],ct=I[12],lt=I[13],st=I[14],xt=I[15],dt=j[0],Et=j[1],It=j[2],Mt=j[3],Ct=j[4],kt=j[5],jt=j[6],Ot=j[7],Kt=j[8],ur=j[9],Jt=j[10],yr=j[11],_r=j[12],Er=j[13],rr=j[14],kr=j[15];return Math.abs(H-dt)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(dt))&&Math.abs(F-Et)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(Et))&&Math.abs(V-It)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(It))&&Math.abs(Y-Mt)<=e.EPSILON*Math.max(1,Math.abs(Y),Math.abs(Mt))&&Math.abs(oe-Ct)<=e.EPSILON*Math.max(1,Math.abs(oe),Math.abs(Ct))&&Math.abs(ce-kt)<=e.EPSILON*Math.max(1,Math.abs(ce),Math.abs(kt))&&Math.abs(we-jt)<=e.EPSILON*Math.max(1,Math.abs(we),Math.abs(jt))&&Math.abs(Ie-Ot)<=e.EPSILON*Math.max(1,Math.abs(Ie),Math.abs(Ot))&&Math.abs(me-Kt)<=e.EPSILON*Math.max(1,Math.abs(me),Math.abs(Kt))&&Math.abs(Re-ur)<=e.EPSILON*Math.max(1,Math.abs(Re),Math.abs(ur))&&Math.abs(Ue-Jt)<=e.EPSILON*Math.max(1,Math.abs(Ue),Math.abs(Jt))&&Math.abs($e-yr)<=e.EPSILON*Math.max(1,Math.abs($e),Math.abs(yr))&&Math.abs(ct-_r)<=e.EPSILON*Math.max(1,Math.abs(ct),Math.abs(_r))&&Math.abs(lt-Er)<=e.EPSILON*Math.max(1,Math.abs(lt),Math.abs(Er))&&Math.abs(st-rr)<=e.EPSILON*Math.max(1,Math.abs(st),Math.abs(rr))&&Math.abs(xt-kr)<=e.EPSILON*Math.max(1,Math.abs(xt),Math.abs(kr))},Z.sub=Z.mul=Z.ortho=Z.perspective=void 0;var e=function(I,j){if(I&&I.__esModule)return I;if(I===null||o(I)!=="object"&&typeof I!="function")return{default:I};var H=i(void 0);if(H&&H.has(I))return H.get(I);var F={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Y in I)if(Y!=="default"&&Object.prototype.hasOwnProperty.call(I,Y)){var oe=V?Object.getOwnPropertyDescriptor(I,Y):null;oe&&(oe.get||oe.set)?Object.defineProperty(F,Y,oe):F[Y]=I[Y]}return F.default=I,H&&H.set(I,F),F}(m());function i(I){if(typeof WeakMap!="function")return null;var j=new WeakMap,H=new WeakMap;return(i=function(F){return F?H:j})(I)}function s(I){return I[0]=1,I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=1,I[6]=0,I[7]=0,I[8]=0,I[9]=0,I[10]=1,I[11]=0,I[12]=0,I[13]=0,I[14]=0,I[15]=1,I}function f(I,j,H){var F=j[0],V=j[1],Y=j[2],oe=j[3],ce=j[4],we=j[5],Ie=j[6],me=j[7],Re=j[8],Ue=j[9],$e=j[10],ct=j[11],lt=j[12],st=j[13],xt=j[14],dt=j[15],Et=H[0],It=H[1],Mt=H[2],Ct=H[3];return I[0]=Et*F+It*ce+Mt*Re+Ct*lt,I[1]=Et*V+It*we+Mt*Ue+Ct*st,I[2]=Et*Y+It*Ie+Mt*$e+Ct*xt,I[3]=Et*oe+It*me+Mt*ct+Ct*dt,I[4]=(Et=H[4])*F+(It=H[5])*ce+(Mt=H[6])*Re+(Ct=H[7])*lt,I[5]=Et*V+It*we+Mt*Ue+Ct*st,I[6]=Et*Y+It*Ie+Mt*$e+Ct*xt,I[7]=Et*oe+It*me+Mt*ct+Ct*dt,I[8]=(Et=H[8])*F+(It=H[9])*ce+(Mt=H[10])*Re+(Ct=H[11])*lt,I[9]=Et*V+It*we+Mt*Ue+Ct*st,I[10]=Et*Y+It*Ie+Mt*$e+Ct*xt,I[11]=Et*oe+It*me+Mt*ct+Ct*dt,I[12]=(Et=H[12])*F+(It=H[13])*ce+(Mt=H[14])*Re+(Ct=H[15])*lt,I[13]=Et*V+It*we+Mt*Ue+Ct*st,I[14]=Et*Y+It*Ie+Mt*$e+Ct*xt,I[15]=Et*oe+It*me+Mt*ct+Ct*dt,I}function l(I,j,H){var F=j[0],V=j[1],Y=j[2],oe=j[3],ce=F+F,we=V+V,Ie=Y+Y,me=F*ce,Re=F*we,Ue=F*Ie,$e=V*we,ct=V*Ie,lt=Y*Ie,st=oe*ce,xt=oe*we,dt=oe*Ie;return I[0]=1-($e+lt),I[1]=Re+dt,I[2]=Ue-xt,I[3]=0,I[4]=Re-dt,I[5]=1-(me+lt),I[6]=ct+st,I[7]=0,I[8]=Ue+xt,I[9]=ct-st,I[10]=1-(me+$e),I[11]=0,I[12]=H[0],I[13]=H[1],I[14]=H[2],I[15]=1,I}function d(I,j){var H=j[4],F=j[5],V=j[6],Y=j[8],oe=j[9],ce=j[10];return I[0]=Math.hypot(j[0],j[1],j[2]),I[1]=Math.hypot(H,F,V),I[2]=Math.hypot(Y,oe,ce),I}function R(I,j,H,F,V){var Y,oe=1/Math.tan(j/2);return I[0]=oe/H,I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=oe,I[6]=0,I[7]=0,I[8]=0,I[9]=0,I[11]=-1,I[12]=0,I[13]=0,I[15]=0,V!=null&&V!==1/0?(I[10]=(V+F)*(Y=1/(F-V)),I[14]=2*V*F*Y):(I[10]=-1,I[14]=-2*F),I}function N(I,j,H,F,V,Y,oe){var ce=1/(j-H),we=1/(F-V),Ie=1/(Y-oe);return I[0]=-2*ce,I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=-2*we,I[6]=0,I[7]=0,I[8]=0,I[9]=0,I[10]=2*Ie,I[11]=0,I[12]=(j+H)*ce,I[13]=(V+F)*we,I[14]=(oe+Y)*Ie,I[15]=1,I}function $(I,j,H){return I[0]=j[0]-H[0],I[1]=j[1]-H[1],I[2]=j[2]-H[2],I[3]=j[3]-H[3],I[4]=j[4]-H[4],I[5]=j[5]-H[5],I[6]=j[6]-H[6],I[7]=j[7]-H[7],I[8]=j[8]-H[8],I[9]=j[9]-H[9],I[10]=j[10]-H[10],I[11]=j[11]-H[11],I[12]=j[12]-H[12],I[13]=j[13]-H[13],I[14]=j[14]-H[14],I[15]=j[15]-H[15],I}return Z.perspective=R,Z.ortho=N,Z.mul=f,Z.sub=$,Z}var W,J={},re={};function te(){if(W)return re;function o(V){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Y){return typeof Y}:function(Y){return Y&&typeof Symbol=="function"&&Y.constructor===Symbol&&Y!==Symbol.prototype?"symbol":typeof Y},o(V)}W=1,Object.defineProperty(re,"__esModule",{value:!0}),re.create=s,re.clone=function(V){var Y=new e.ARRAY_TYPE(3);return Y[0]=V[0],Y[1]=V[1],Y[2]=V[2],Y},re.length=f,re.fromValues=function(V,Y,oe){var ce=new e.ARRAY_TYPE(3);return ce[0]=V,ce[1]=Y,ce[2]=oe,ce},re.copy=function(V,Y){return V[0]=Y[0],V[1]=Y[1],V[2]=Y[2],V},re.set=function(V,Y,oe,ce){return V[0]=Y,V[1]=oe,V[2]=ce,V},re.add=function(V,Y,oe){return V[0]=Y[0]+oe[0],V[1]=Y[1]+oe[1],V[2]=Y[2]+oe[2],V},re.subtract=l,re.multiply=d,re.divide=R,re.ceil=function(V,Y){return V[0]=Math.ceil(Y[0]),V[1]=Math.ceil(Y[1]),V[2]=Math.ceil(Y[2]),V},re.floor=function(V,Y){return V[0]=Math.floor(Y[0]),V[1]=Math.floor(Y[1]),V[2]=Math.floor(Y[2]),V},re.min=function(V,Y,oe){return V[0]=Math.min(Y[0],oe[0]),V[1]=Math.min(Y[1],oe[1]),V[2]=Math.min(Y[2],oe[2]),V},re.max=function(V,Y,oe){return V[0]=Math.max(Y[0],oe[0]),V[1]=Math.max(Y[1],oe[1]),V[2]=Math.max(Y[2],oe[2]),V},re.round=function(V,Y){return V[0]=Math.round(Y[0]),V[1]=Math.round(Y[1]),V[2]=Math.round(Y[2]),V},re.scale=function(V,Y,oe){return V[0]=Y[0]*oe,V[1]=Y[1]*oe,V[2]=Y[2]*oe,V},re.scaleAndAdd=function(V,Y,oe,ce){return V[0]=Y[0]+oe[0]*ce,V[1]=Y[1]+oe[1]*ce,V[2]=Y[2]+oe[2]*ce,V},re.distance=N,re.squaredDistance=$,re.squaredLength=I,re.negate=function(V,Y){return V[0]=-Y[0],V[1]=-Y[1],V[2]=-Y[2],V},re.inverse=function(V,Y){return V[0]=1/Y[0],V[1]=1/Y[1],V[2]=1/Y[2],V},re.normalize=function(V,Y){var oe=Y[0],ce=Y[1],we=Y[2],Ie=oe*oe+ce*ce+we*we;return Ie>0&&(Ie=1/Math.sqrt(Ie)),V[0]=Y[0]*Ie,V[1]=Y[1]*Ie,V[2]=Y[2]*Ie,V},re.dot=j,re.cross=function(V,Y,oe){var ce=Y[0],we=Y[1],Ie=Y[2],me=oe[0],Re=oe[1],Ue=oe[2];return V[0]=we*Ue-Ie*Re,V[1]=Ie*me-ce*Ue,V[2]=ce*Re-we*me,V},re.lerp=function(V,Y,oe,ce){var we=Y[0],Ie=Y[1],me=Y[2];return V[0]=we+ce*(oe[0]-we),V[1]=Ie+ce*(oe[1]-Ie),V[2]=me+ce*(oe[2]-me),V},re.hermite=function(V,Y,oe,ce,we,Ie){var me=Ie*Ie,Re=me*(2*Ie-3)+1,Ue=me*(Ie-2)+Ie,$e=me*(Ie-1),ct=me*(3-2*Ie);return V[0]=Y[0]*Re+oe[0]*Ue+ce[0]*$e+we[0]*ct,V[1]=Y[1]*Re+oe[1]*Ue+ce[1]*$e+we[1]*ct,V[2]=Y[2]*Re+oe[2]*Ue+ce[2]*$e+we[2]*ct,V},re.bezier=function(V,Y,oe,ce,we,Ie){var me=1-Ie,Re=me*me,Ue=Ie*Ie,$e=Re*me,ct=3*Ie*Re,lt=3*Ue*me,st=Ue*Ie;return V[0]=Y[0]*$e+oe[0]*ct+ce[0]*lt+we[0]*st,V[1]=Y[1]*$e+oe[1]*ct+ce[1]*lt+we[1]*st,V[2]=Y[2]*$e+oe[2]*ct+ce[2]*lt+we[2]*st,V},re.random=function(V,Y){Y=Y||1;var oe=2*e.RANDOM()*Math.PI,ce=2*e.RANDOM()-1,we=Math.sqrt(1-ce*ce)*Y;return V[0]=Math.cos(oe)*we,V[1]=Math.sin(oe)*we,V[2]=ce*Y,V},re.transformMat4=function(V,Y,oe){var ce=Y[0],we=Y[1],Ie=Y[2],me=oe[3]*ce+oe[7]*we+oe[11]*Ie+oe[15];return V[0]=(oe[0]*ce+oe[4]*we+oe[8]*Ie+oe[12])/(me=me||1),V[1]=(oe[1]*ce+oe[5]*we+oe[9]*Ie+oe[13])/me,V[2]=(oe[2]*ce+oe[6]*we+oe[10]*Ie+oe[14])/me,V},re.transformMat3=function(V,Y,oe){var ce=Y[0],we=Y[1],Ie=Y[2];return V[0]=ce*oe[0]+we*oe[3]+Ie*oe[6],V[1]=ce*oe[1]+we*oe[4]+Ie*oe[7],V[2]=ce*oe[2]+we*oe[5]+Ie*oe[8],V},re.transformQuat=function(V,Y,oe){var ce=oe[0],we=oe[1],Ie=oe[2],me=Y[0],Re=Y[1],Ue=Y[2],$e=we*Ue-Ie*Re,ct=Ie*me-ce*Ue,lt=ce*Re-we*me,st=we*lt-Ie*ct,xt=Ie*$e-ce*lt,dt=ce*ct-we*$e,Et=2*oe[3];return ct*=Et,lt*=Et,xt*=2,dt*=2,V[0]=me+($e*=Et)+(st*=2),V[1]=Re+ct+xt,V[2]=Ue+lt+dt,V},re.rotateX=function(V,Y,oe,ce){var we=[],Ie=[];return we[0]=Y[0]-oe[0],we[1]=Y[1]-oe[1],we[2]=Y[2]-oe[2],Ie[0]=we[0],Ie[1]=we[1]*Math.cos(ce)-we[2]*Math.sin(ce),Ie[2]=we[1]*Math.sin(ce)+we[2]*Math.cos(ce),V[0]=Ie[0]+oe[0],V[1]=Ie[1]+oe[1],V[2]=Ie[2]+oe[2],V},re.rotateY=function(V,Y,oe,ce){var we=[],Ie=[];return we[0]=Y[0]-oe[0],we[1]=Y[1]-oe[1],we[2]=Y[2]-oe[2],Ie[0]=we[2]*Math.sin(ce)+we[0]*Math.cos(ce),Ie[1]=we[1],Ie[2]=we[2]*Math.cos(ce)-we[0]*Math.sin(ce),V[0]=Ie[0]+oe[0],V[1]=Ie[1]+oe[1],V[2]=Ie[2]+oe[2],V},re.rotateZ=function(V,Y,oe,ce){var we=[],Ie=[];return we[0]=Y[0]-oe[0],we[1]=Y[1]-oe[1],we[2]=Y[2]-oe[2],Ie[0]=we[0]*Math.cos(ce)-we[1]*Math.sin(ce),Ie[1]=we[0]*Math.sin(ce)+we[1]*Math.cos(ce),Ie[2]=we[2],V[0]=Ie[0]+oe[0],V[1]=Ie[1]+oe[1],V[2]=Ie[2]+oe[2],V},re.angle=function(V,Y){var oe=V[0],ce=V[1],we=V[2],Ie=Y[0],me=Y[1],Re=Y[2],Ue=Math.sqrt(oe*oe+ce*ce+we*we)*Math.sqrt(Ie*Ie+me*me+Re*Re),$e=Ue&&j(V,Y)/Ue;return Math.acos(Math.min(Math.max($e,-1),1))},re.zero=function(V){return V[0]=0,V[1]=0,V[2]=0,V},re.str=function(V){return"vec3("+V[0]+", "+V[1]+", "+V[2]+")"},re.exactEquals=function(V,Y){return V[0]===Y[0]&&V[1]===Y[1]&&V[2]===Y[2]},re.equals=function(V,Y){var oe=V[0],ce=V[1],we=V[2],Ie=Y[0],me=Y[1],Re=Y[2];return Math.abs(oe-Ie)<=e.EPSILON*Math.max(1,Math.abs(oe),Math.abs(Ie))&&Math.abs(ce-me)<=e.EPSILON*Math.max(1,Math.abs(ce),Math.abs(me))&&Math.abs(we-Re)<=e.EPSILON*Math.max(1,Math.abs(we),Math.abs(Re))},re.forEach=re.sqrLen=re.len=re.sqrDist=re.dist=re.div=re.mul=re.sub=void 0;var e=function(V,Y){if(V&&V.__esModule)return V;if(V===null||o(V)!=="object"&&typeof V!="function")return{default:V};var oe=i(void 0);if(oe&&oe.has(V))return oe.get(V);var ce={},we=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ie in V)if(Ie!=="default"&&Object.prototype.hasOwnProperty.call(V,Ie)){var me=we?Object.getOwnPropertyDescriptor(V,Ie):null;me&&(me.get||me.set)?Object.defineProperty(ce,Ie,me):ce[Ie]=V[Ie]}return ce.default=V,oe&&oe.set(V,ce),ce}(m());function i(V){if(typeof WeakMap!="function")return null;var Y=new WeakMap,oe=new WeakMap;return(i=function(ce){return ce?oe:Y})(V)}function s(){var V=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(V[0]=0,V[1]=0,V[2]=0),V}function f(V){return Math.hypot(V[0],V[1],V[2])}function l(V,Y,oe){return V[0]=Y[0]-oe[0],V[1]=Y[1]-oe[1],V[2]=Y[2]-oe[2],V}function d(V,Y,oe){return V[0]=Y[0]*oe[0],V[1]=Y[1]*oe[1],V[2]=Y[2]*oe[2],V}function R(V,Y,oe){return V[0]=Y[0]/oe[0],V[1]=Y[1]/oe[1],V[2]=Y[2]/oe[2],V}function N(V,Y){return Math.hypot(Y[0]-V[0],Y[1]-V[1],Y[2]-V[2])}function $(V,Y){var oe=Y[0]-V[0],ce=Y[1]-V[1],we=Y[2]-V[2];return oe*oe+ce*ce+we*we}function I(V){var Y=V[0],oe=V[1],ce=V[2];return Y*Y+oe*oe+ce*ce}function j(V,Y){return V[0]*Y[0]+V[1]*Y[1]+V[2]*Y[2]}re.sub=l,re.mul=d,re.div=R,re.dist=N,re.sqrDist=$,re.len=f,re.sqrLen=I;var H,F=(H=s(),function(V,Y,oe,ce,we,Ie){var me,Re;for(Y||(Y=3),oe||(oe=0),Re=ce?Math.min(ce*Y+oe,V.length):V.length,me=oe;me<Re;me+=Y)H[0]=V[me],H[1]=V[me+1],H[2]=V[me+2],we(H,H,Ie),V[me]=H[0],V[me+1]=H[1],V[me+2]=H[2];return V});return re.forEach=F,re}var ye,ue,Se={};function Le(){if(ye)return Se;function o(F){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(V){return typeof V}:function(V){return V&&typeof Symbol=="function"&&V.constructor===Symbol&&V!==Symbol.prototype?"symbol":typeof V},o(F)}ye=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.create=s,Se.clone=function(F){var V=new e.ARRAY_TYPE(4);return V[0]=F[0],V[1]=F[1],V[2]=F[2],V[3]=F[3],V},Se.fromValues=function(F,V,Y,oe){var ce=new e.ARRAY_TYPE(4);return ce[0]=F,ce[1]=V,ce[2]=Y,ce[3]=oe,ce},Se.copy=function(F,V){return F[0]=V[0],F[1]=V[1],F[2]=V[2],F[3]=V[3],F},Se.set=function(F,V,Y,oe,ce){return F[0]=V,F[1]=Y,F[2]=oe,F[3]=ce,F},Se.add=function(F,V,Y){return F[0]=V[0]+Y[0],F[1]=V[1]+Y[1],F[2]=V[2]+Y[2],F[3]=V[3]+Y[3],F},Se.subtract=f,Se.multiply=l,Se.divide=d,Se.ceil=function(F,V){return F[0]=Math.ceil(V[0]),F[1]=Math.ceil(V[1]),F[2]=Math.ceil(V[2]),F[3]=Math.ceil(V[3]),F},Se.floor=function(F,V){return F[0]=Math.floor(V[0]),F[1]=Math.floor(V[1]),F[2]=Math.floor(V[2]),F[3]=Math.floor(V[3]),F},Se.min=function(F,V,Y){return F[0]=Math.min(V[0],Y[0]),F[1]=Math.min(V[1],Y[1]),F[2]=Math.min(V[2],Y[2]),F[3]=Math.min(V[3],Y[3]),F},Se.max=function(F,V,Y){return F[0]=Math.max(V[0],Y[0]),F[1]=Math.max(V[1],Y[1]),F[2]=Math.max(V[2],Y[2]),F[3]=Math.max(V[3],Y[3]),F},Se.round=function(F,V){return F[0]=Math.round(V[0]),F[1]=Math.round(V[1]),F[2]=Math.round(V[2]),F[3]=Math.round(V[3]),F},Se.scale=function(F,V,Y){return F[0]=V[0]*Y,F[1]=V[1]*Y,F[2]=V[2]*Y,F[3]=V[3]*Y,F},Se.scaleAndAdd=function(F,V,Y,oe){return F[0]=V[0]+Y[0]*oe,F[1]=V[1]+Y[1]*oe,F[2]=V[2]+Y[2]*oe,F[3]=V[3]+Y[3]*oe,F},Se.distance=R,Se.squaredDistance=N,Se.length=$,Se.squaredLength=I,Se.negate=function(F,V){return F[0]=-V[0],F[1]=-V[1],F[2]=-V[2],F[3]=-V[3],F},Se.inverse=function(F,V){return F[0]=1/V[0],F[1]=1/V[1],F[2]=1/V[2],F[3]=1/V[3],F},Se.normalize=function(F,V){var Y=V[0],oe=V[1],ce=V[2],we=V[3],Ie=Y*Y+oe*oe+ce*ce+we*we;return Ie>0&&(Ie=1/Math.sqrt(Ie)),F[0]=Y*Ie,F[1]=oe*Ie,F[2]=ce*Ie,F[3]=we*Ie,F},Se.dot=function(F,V){return F[0]*V[0]+F[1]*V[1]+F[2]*V[2]+F[3]*V[3]},Se.cross=function(F,V,Y,oe){var ce=Y[0]*oe[1]-Y[1]*oe[0],we=Y[0]*oe[2]-Y[2]*oe[0],Ie=Y[0]*oe[3]-Y[3]*oe[0],me=Y[1]*oe[2]-Y[2]*oe[1],Re=Y[1]*oe[3]-Y[3]*oe[1],Ue=Y[2]*oe[3]-Y[3]*oe[2],$e=V[0],ct=V[1],lt=V[2],st=V[3];return F[0]=ct*Ue-lt*Re+st*me,F[1]=-$e*Ue+lt*Ie-st*we,F[2]=$e*Re-ct*Ie+st*ce,F[3]=-$e*me+ct*we-lt*ce,F},Se.lerp=function(F,V,Y,oe){var ce=V[0],we=V[1],Ie=V[2],me=V[3];return F[0]=ce+oe*(Y[0]-ce),F[1]=we+oe*(Y[1]-we),F[2]=Ie+oe*(Y[2]-Ie),F[3]=me+oe*(Y[3]-me),F},Se.random=function(F,V){var Y,oe,ce,we,Ie,me;V=V||1;do Ie=(Y=2*e.RANDOM()-1)*Y+(oe=2*e.RANDOM()-1)*oe;while(Ie>=1);do me=(ce=2*e.RANDOM()-1)*ce+(we=2*e.RANDOM()-1)*we;while(me>=1);var Re=Math.sqrt((1-Ie)/me);return F[0]=V*Y,F[1]=V*oe,F[2]=V*ce*Re,F[3]=V*we*Re,F},Se.transformMat4=function(F,V,Y){var oe=V[0],ce=V[1],we=V[2],Ie=V[3];return F[0]=Y[0]*oe+Y[4]*ce+Y[8]*we+Y[12]*Ie,F[1]=Y[1]*oe+Y[5]*ce+Y[9]*we+Y[13]*Ie,F[2]=Y[2]*oe+Y[6]*ce+Y[10]*we+Y[14]*Ie,F[3]=Y[3]*oe+Y[7]*ce+Y[11]*we+Y[15]*Ie,F},Se.transformQuat=function(F,V,Y){var oe=V[0],ce=V[1],we=V[2],Ie=Y[0],me=Y[1],Re=Y[2],Ue=Y[3],$e=Ue*oe+me*we-Re*ce,ct=Ue*ce+Re*oe-Ie*we,lt=Ue*we+Ie*ce-me*oe,st=-Ie*oe-me*ce-Re*we;return F[0]=$e*Ue+st*-Ie+ct*-Re-lt*-me,F[1]=ct*Ue+st*-me+lt*-Ie-$e*-Re,F[2]=lt*Ue+st*-Re+$e*-me-ct*-Ie,F[3]=V[3],F},Se.zero=function(F){return F[0]=0,F[1]=0,F[2]=0,F[3]=0,F},Se.str=function(F){return"vec4("+F[0]+", "+F[1]+", "+F[2]+", "+F[3]+")"},Se.exactEquals=function(F,V){return F[0]===V[0]&&F[1]===V[1]&&F[2]===V[2]&&F[3]===V[3]},Se.equals=function(F,V){var Y=F[0],oe=F[1],ce=F[2],we=F[3],Ie=V[0],me=V[1],Re=V[2],Ue=V[3];return Math.abs(Y-Ie)<=e.EPSILON*Math.max(1,Math.abs(Y),Math.abs(Ie))&&Math.abs(oe-me)<=e.EPSILON*Math.max(1,Math.abs(oe),Math.abs(me))&&Math.abs(ce-Re)<=e.EPSILON*Math.max(1,Math.abs(ce),Math.abs(Re))&&Math.abs(we-Ue)<=e.EPSILON*Math.max(1,Math.abs(we),Math.abs(Ue))},Se.forEach=Se.sqrLen=Se.len=Se.sqrDist=Se.dist=Se.div=Se.mul=Se.sub=void 0;var e=function(F,V){if(F&&F.__esModule)return F;if(F===null||o(F)!=="object"&&typeof F!="function")return{default:F};var Y=i(void 0);if(Y&&Y.has(F))return Y.get(F);var oe={},ce=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var we in F)if(we!=="default"&&Object.prototype.hasOwnProperty.call(F,we)){var Ie=ce?Object.getOwnPropertyDescriptor(F,we):null;Ie&&(Ie.get||Ie.set)?Object.defineProperty(oe,we,Ie):oe[we]=F[we]}return oe.default=F,Y&&Y.set(F,oe),oe}(m());function i(F){if(typeof WeakMap!="function")return null;var V=new WeakMap,Y=new WeakMap;return(i=function(oe){return oe?Y:V})(F)}function s(){var F=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(F[0]=0,F[1]=0,F[2]=0,F[3]=0),F}function f(F,V,Y){return F[0]=V[0]-Y[0],F[1]=V[1]-Y[1],F[2]=V[2]-Y[2],F[3]=V[3]-Y[3],F}function l(F,V,Y){return F[0]=V[0]*Y[0],F[1]=V[1]*Y[1],F[2]=V[2]*Y[2],F[3]=V[3]*Y[3],F}function d(F,V,Y){return F[0]=V[0]/Y[0],F[1]=V[1]/Y[1],F[2]=V[2]/Y[2],F[3]=V[3]/Y[3],F}function R(F,V){return Math.hypot(V[0]-F[0],V[1]-F[1],V[2]-F[2],V[3]-F[3])}function N(F,V){var Y=V[0]-F[0],oe=V[1]-F[1],ce=V[2]-F[2],we=V[3]-F[3];return Y*Y+oe*oe+ce*ce+we*we}function $(F){return Math.hypot(F[0],F[1],F[2],F[3])}function I(F){var V=F[0],Y=F[1],oe=F[2],ce=F[3];return V*V+Y*Y+oe*oe+ce*ce}Se.sub=f,Se.mul=l,Se.div=d,Se.dist=R,Se.sqrDist=N,Se.len=$,Se.sqrLen=I;var j,H=(j=s(),function(F,V,Y,oe,ce,we){var Ie,me;for(V||(V=4),Y||(Y=0),me=oe?Math.min(oe*V+Y,F.length):F.length,Ie=Y;Ie<me;Ie+=V)j[0]=F[Ie],j[1]=F[Ie+1],j[2]=F[Ie+2],j[3]=F[Ie+3],ce(j,j,we),F[Ie]=j[0],F[Ie+1]=j[1],F[Ie+2]=j[2],F[Ie+3]=j[3];return F});return Se.forEach=H,Se}function Pe(){if(ue)return J;function o(dt){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Et){return typeof Et}:function(Et){return Et&&typeof Symbol=="function"&&Et.constructor===Symbol&&Et!==Symbol.prototype?"symbol":typeof Et},o(dt)}ue=1,Object.defineProperty(J,"__esModule",{value:!0}),J.create=R,J.identity=function(dt){return dt[0]=0,dt[1]=0,dt[2]=0,dt[3]=1,dt},J.setAxisAngle=N,J.getAxisAngle=function(dt,Et){var It=2*Math.acos(Et[3]),Mt=Math.sin(It/2);return Mt>e.EPSILON?(dt[0]=Et[0]/Mt,dt[1]=Et[1]/Mt,dt[2]=Et[2]/Mt):(dt[0]=1,dt[1]=0,dt[2]=0),It},J.getAngle=function(dt,Et){var It=Y(dt,Et);return Math.acos(2*It*It-1)},J.multiply=$,J.rotateX=function(dt,Et,It){It*=.5;var Mt=Et[0],Ct=Et[1],kt=Et[2],jt=Et[3],Ot=Math.sin(It),Kt=Math.cos(It);return dt[0]=Mt*Kt+jt*Ot,dt[1]=Ct*Kt+kt*Ot,dt[2]=kt*Kt-Ct*Ot,dt[3]=jt*Kt-Mt*Ot,dt},J.rotateY=function(dt,Et,It){It*=.5;var Mt=Et[0],Ct=Et[1],kt=Et[2],jt=Et[3],Ot=Math.sin(It),Kt=Math.cos(It);return dt[0]=Mt*Kt-kt*Ot,dt[1]=Ct*Kt+jt*Ot,dt[2]=kt*Kt+Mt*Ot,dt[3]=jt*Kt-Ct*Ot,dt},J.rotateZ=function(dt,Et,It){It*=.5;var Mt=Et[0],Ct=Et[1],kt=Et[2],jt=Et[3],Ot=Math.sin(It),Kt=Math.cos(It);return dt[0]=Mt*Kt+Ct*Ot,dt[1]=Ct*Kt-Mt*Ot,dt[2]=kt*Kt+jt*Ot,dt[3]=jt*Kt-kt*Ot,dt},J.calculateW=function(dt,Et){var It=Et[0],Mt=Et[1],Ct=Et[2];return dt[0]=It,dt[1]=Mt,dt[2]=Ct,dt[3]=Math.sqrt(Math.abs(1-It*It-Mt*Mt-Ct*Ct)),dt},J.exp=I,J.ln=j,J.pow=function(dt,Et,It){return j(dt,Et),V(dt,dt,It),I(dt,dt),dt},J.slerp=H,J.random=function(dt){var Et=e.RANDOM(),It=e.RANDOM(),Mt=e.RANDOM(),Ct=Math.sqrt(1-Et),kt=Math.sqrt(Et);return dt[0]=Ct*Math.sin(2*Math.PI*It),dt[1]=Ct*Math.cos(2*Math.PI*It),dt[2]=kt*Math.sin(2*Math.PI*Mt),dt[3]=kt*Math.cos(2*Math.PI*Mt),dt},J.invert=function(dt,Et){var It=Et[0],Mt=Et[1],Ct=Et[2],kt=Et[3],jt=It*It+Mt*Mt+Ct*Ct+kt*kt,Ot=jt?1/jt:0;return dt[0]=-It*Ot,dt[1]=-Mt*Ot,dt[2]=-Ct*Ot,dt[3]=kt*Ot,dt},J.conjugate=function(dt,Et){return dt[0]=-Et[0],dt[1]=-Et[1],dt[2]=-Et[2],dt[3]=Et[3],dt},J.fromMat3=F,J.fromEuler=function(dt,Et,It,Mt){var Ct=.5*Math.PI/180;Et*=Ct,It*=Ct,Mt*=Ct;var kt=Math.sin(Et),jt=Math.cos(Et),Ot=Math.sin(It),Kt=Math.cos(It),ur=Math.sin(Mt),Jt=Math.cos(Mt);return dt[0]=kt*Kt*Jt-jt*Ot*ur,dt[1]=jt*Ot*Jt+kt*Kt*ur,dt[2]=jt*Kt*ur-kt*Ot*Jt,dt[3]=jt*Kt*Jt+kt*Ot*ur,dt},J.str=function(dt){return"quat("+dt[0]+", "+dt[1]+", "+dt[2]+", "+dt[3]+")"},J.setAxes=J.sqlerp=J.rotationTo=J.equals=J.exactEquals=J.normalize=J.sqrLen=J.squaredLength=J.len=J.length=J.lerp=J.dot=J.scale=J.mul=J.add=J.set=J.copy=J.fromValues=J.clone=void 0;var e=d(m()),i=d(U()),s=d(te()),f=d(Le());function l(dt){if(typeof WeakMap!="function")return null;var Et=new WeakMap,It=new WeakMap;return(l=function(Mt){return Mt?It:Et})(dt)}function d(dt,Et){if(dt&&dt.__esModule)return dt;if(dt===null||o(dt)!=="object"&&typeof dt!="function")return{default:dt};var It=l(Et);if(It&&It.has(dt))return It.get(dt);var Mt={},Ct=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var kt in dt)if(kt!=="default"&&Object.prototype.hasOwnProperty.call(dt,kt)){var jt=Ct?Object.getOwnPropertyDescriptor(dt,kt):null;jt&&(jt.get||jt.set)?Object.defineProperty(Mt,kt,jt):Mt[kt]=dt[kt]}return Mt.default=dt,It&&It.set(dt,Mt),Mt}function R(){var dt=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(dt[0]=0,dt[1]=0,dt[2]=0),dt[3]=1,dt}function N(dt,Et,It){It*=.5;var Mt=Math.sin(It);return dt[0]=Mt*Et[0],dt[1]=Mt*Et[1],dt[2]=Mt*Et[2],dt[3]=Math.cos(It),dt}function $(dt,Et,It){var Mt=Et[0],Ct=Et[1],kt=Et[2],jt=Et[3],Ot=It[0],Kt=It[1],ur=It[2],Jt=It[3];return dt[0]=Mt*Jt+jt*Ot+Ct*ur-kt*Kt,dt[1]=Ct*Jt+jt*Kt+kt*Ot-Mt*ur,dt[2]=kt*Jt+jt*ur+Mt*Kt-Ct*Ot,dt[3]=jt*Jt-Mt*Ot-Ct*Kt-kt*ur,dt}function I(dt,Et){var It=Et[0],Mt=Et[1],Ct=Et[2],kt=Et[3],jt=Math.sqrt(It*It+Mt*Mt+Ct*Ct),Ot=Math.exp(kt),Kt=jt>0?Ot*Math.sin(jt)/jt:0;return dt[0]=It*Kt,dt[1]=Mt*Kt,dt[2]=Ct*Kt,dt[3]=Ot*Math.cos(jt),dt}function j(dt,Et){var It=Et[0],Mt=Et[1],Ct=Et[2],kt=Et[3],jt=Math.sqrt(It*It+Mt*Mt+Ct*Ct),Ot=jt>0?Math.atan2(jt,kt)/jt:0;return dt[0]=It*Ot,dt[1]=Mt*Ot,dt[2]=Ct*Ot,dt[3]=.5*Math.log(It*It+Mt*Mt+Ct*Ct+kt*kt),dt}function H(dt,Et,It,Mt){var Ct,kt,jt,Ot,Kt,ur=Et[0],Jt=Et[1],yr=Et[2],_r=Et[3],Er=It[0],rr=It[1],kr=It[2],vr=It[3];return(kt=ur*Er+Jt*rr+yr*kr+_r*vr)<0&&(kt=-kt,Er=-Er,rr=-rr,kr=-kr,vr=-vr),1-kt>e.EPSILON?(Ct=Math.acos(kt),jt=Math.sin(Ct),Ot=Math.sin((1-Mt)*Ct)/jt,Kt=Math.sin(Mt*Ct)/jt):(Ot=1-Mt,Kt=Mt),dt[0]=Ot*ur+Kt*Er,dt[1]=Ot*Jt+Kt*rr,dt[2]=Ot*yr+Kt*kr,dt[3]=Ot*_r+Kt*vr,dt}function F(dt,Et){var It,Mt=Et[0]+Et[4]+Et[8];if(Mt>0)It=Math.sqrt(Mt+1),dt[3]=.5*It,dt[0]=(Et[5]-Et[7])*(It=.5/It),dt[1]=(Et[6]-Et[2])*It,dt[2]=(Et[1]-Et[3])*It;else{var Ct=0;Et[4]>Et[0]&&(Ct=1),Et[8]>Et[3*Ct+Ct]&&(Ct=2);var kt=(Ct+1)%3,jt=(Ct+2)%3;It=Math.sqrt(Et[3*Ct+Ct]-Et[3*kt+kt]-Et[3*jt+jt]+1),dt[Ct]=.5*It,dt[3]=(Et[3*kt+jt]-Et[3*jt+kt])*(It=.5/It),dt[kt]=(Et[3*kt+Ct]+Et[3*Ct+kt])*It,dt[jt]=(Et[3*jt+Ct]+Et[3*Ct+jt])*It}return dt}J.clone=f.clone,J.fromValues=f.fromValues,J.copy=f.copy,J.set=f.set,J.add=f.add,J.mul=$;var V=f.scale;J.scale=V;var Y=f.dot;J.dot=Y,J.lerp=f.lerp;var oe=f.length;J.length=oe,J.len=oe;var ce=f.squaredLength;J.squaredLength=ce,J.sqrLen=ce;var we=f.normalize;J.normalize=we,J.exactEquals=f.exactEquals,J.equals=f.equals;var Ie,me,Re,Ue=(Ie=s.create(),me=s.fromValues(1,0,0),Re=s.fromValues(0,1,0),function(dt,Et,It){var Mt=s.dot(Et,It);return Mt<-.999999?(s.cross(Ie,me,Et),s.len(Ie)<1e-6&&s.cross(Ie,Re,Et),s.normalize(Ie,Ie),N(dt,Ie,Math.PI),dt):Mt>.999999?(dt[0]=0,dt[1]=0,dt[2]=0,dt[3]=1,dt):(s.cross(Ie,Et,It),dt[0]=Ie[0],dt[1]=Ie[1],dt[2]=Ie[2],dt[3]=1+Mt,we(dt,dt))});J.rotationTo=Ue;var $e,ct,lt=($e=R(),ct=R(),function(dt,Et,It,Mt,Ct,kt){return H($e,Et,Ct,kt),H(ct,It,Mt,kt),H(dt,$e,ct,2*kt*(1-kt)),dt});J.sqlerp=lt;var st,xt=(st=i.create(),function(dt,Et,It,Mt){return st[0]=It[0],st[3]=It[1],st[6]=It[2],st[1]=Mt[0],st[4]=Mt[1],st[7]=Mt[2],st[2]=-Et[0],st[5]=-Et[1],st[8]=-Et[2],we(dt,F(dt,st))});return J.setAxes=xt,J}var Ee,Me={};function He(){if(Ee)return Me;function o(H){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(F){return typeof F}:function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F},o(H)}Ee=1,Object.defineProperty(Me,"__esModule",{value:!0}),Me.create=function(){var H=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(H[0]=0,H[1]=0,H[2]=0,H[4]=0,H[5]=0,H[6]=0,H[7]=0),H[3]=1,H},Me.clone=function(H){var F=new e.ARRAY_TYPE(8);return F[0]=H[0],F[1]=H[1],F[2]=H[2],F[3]=H[3],F[4]=H[4],F[5]=H[5],F[6]=H[6],F[7]=H[7],F},Me.fromValues=function(H,F,V,Y,oe,ce,we,Ie){var me=new e.ARRAY_TYPE(8);return me[0]=H,me[1]=F,me[2]=V,me[3]=Y,me[4]=oe,me[5]=ce,me[6]=we,me[7]=Ie,me},Me.fromRotationTranslationValues=function(H,F,V,Y,oe,ce,we){var Ie=new e.ARRAY_TYPE(8);Ie[0]=H,Ie[1]=F,Ie[2]=V,Ie[3]=Y;var me=.5*oe,Re=.5*ce,Ue=.5*we;return Ie[4]=me*Y+Re*V-Ue*F,Ie[5]=Re*Y+Ue*H-me*V,Ie[6]=Ue*Y+me*F-Re*H,Ie[7]=-me*H-Re*F-Ue*V,Ie},Me.fromRotationTranslation=d,Me.fromTranslation=function(H,F){return H[0]=0,H[1]=0,H[2]=0,H[3]=1,H[4]=.5*F[0],H[5]=.5*F[1],H[6]=.5*F[2],H[7]=0,H},Me.fromRotation=function(H,F){return H[0]=F[0],H[1]=F[1],H[2]=F[2],H[3]=F[3],H[4]=0,H[5]=0,H[6]=0,H[7]=0,H},Me.fromMat4=function(H,F){var V=i.create();s.getRotation(V,F);var Y=new e.ARRAY_TYPE(3);return s.getTranslation(Y,F),d(H,V,Y),H},Me.copy=R,Me.identity=function(H){return H[0]=0,H[1]=0,H[2]=0,H[3]=1,H[4]=0,H[5]=0,H[6]=0,H[7]=0,H},Me.set=function(H,F,V,Y,oe,ce,we,Ie,me){return H[0]=F,H[1]=V,H[2]=Y,H[3]=oe,H[4]=ce,H[5]=we,H[6]=Ie,H[7]=me,H},Me.getDual=function(H,F){return H[0]=F[4],H[1]=F[5],H[2]=F[6],H[3]=F[7],H},Me.setDual=function(H,F){return H[4]=F[0],H[5]=F[1],H[6]=F[2],H[7]=F[3],H},Me.getTranslation=function(H,F){var V=F[4],Y=F[5],oe=F[6],ce=F[7],we=-F[0],Ie=-F[1],me=-F[2],Re=F[3];return H[0]=2*(V*Re+ce*we+Y*me-oe*Ie),H[1]=2*(Y*Re+ce*Ie+oe*we-V*me),H[2]=2*(oe*Re+ce*me+V*Ie-Y*we),H},Me.translate=function(H,F,V){var Y=F[0],oe=F[1],ce=F[2],we=F[3],Ie=.5*V[0],me=.5*V[1],Re=.5*V[2],Ue=F[4],$e=F[5],ct=F[6],lt=F[7];return H[0]=Y,H[1]=oe,H[2]=ce,H[3]=we,H[4]=we*Ie+oe*Re-ce*me+Ue,H[5]=we*me+ce*Ie-Y*Re+$e,H[6]=we*Re+Y*me-oe*Ie+ct,H[7]=-Y*Ie-oe*me-ce*Re+lt,H},Me.rotateX=function(H,F,V){var Y=-F[0],oe=-F[1],ce=-F[2],we=F[3],Ie=F[4],me=F[5],Re=F[6],Ue=F[7],$e=Ie*we+Ue*Y+me*ce-Re*oe,ct=me*we+Ue*oe+Re*Y-Ie*ce,lt=Re*we+Ue*ce+Ie*oe-me*Y,st=Ue*we-Ie*Y-me*oe-Re*ce;return i.rotateX(H,F,V),H[4]=$e*(we=H[3])+st*(Y=H[0])+ct*(ce=H[2])-lt*(oe=H[1]),H[5]=ct*we+st*oe+lt*Y-$e*ce,H[6]=lt*we+st*ce+$e*oe-ct*Y,H[7]=st*we-$e*Y-ct*oe-lt*ce,H},Me.rotateY=function(H,F,V){var Y=-F[0],oe=-F[1],ce=-F[2],we=F[3],Ie=F[4],me=F[5],Re=F[6],Ue=F[7],$e=Ie*we+Ue*Y+me*ce-Re*oe,ct=me*we+Ue*oe+Re*Y-Ie*ce,lt=Re*we+Ue*ce+Ie*oe-me*Y,st=Ue*we-Ie*Y-me*oe-Re*ce;return i.rotateY(H,F,V),H[4]=$e*(we=H[3])+st*(Y=H[0])+ct*(ce=H[2])-lt*(oe=H[1]),H[5]=ct*we+st*oe+lt*Y-$e*ce,H[6]=lt*we+st*ce+$e*oe-ct*Y,H[7]=st*we-$e*Y-ct*oe-lt*ce,H},Me.rotateZ=function(H,F,V){var Y=-F[0],oe=-F[1],ce=-F[2],we=F[3],Ie=F[4],me=F[5],Re=F[6],Ue=F[7],$e=Ie*we+Ue*Y+me*ce-Re*oe,ct=me*we+Ue*oe+Re*Y-Ie*ce,lt=Re*we+Ue*ce+Ie*oe-me*Y,st=Ue*we-Ie*Y-me*oe-Re*ce;return i.rotateZ(H,F,V),H[4]=$e*(we=H[3])+st*(Y=H[0])+ct*(ce=H[2])-lt*(oe=H[1]),H[5]=ct*we+st*oe+lt*Y-$e*ce,H[6]=lt*we+st*ce+$e*oe-ct*Y,H[7]=st*we-$e*Y-ct*oe-lt*ce,H},Me.rotateByQuatAppend=function(H,F,V){var Y=V[0],oe=V[1],ce=V[2],we=V[3],Ie=F[0],me=F[1],Re=F[2],Ue=F[3];return H[0]=Ie*we+Ue*Y+me*ce-Re*oe,H[1]=me*we+Ue*oe+Re*Y-Ie*ce,H[2]=Re*we+Ue*ce+Ie*oe-me*Y,H[3]=Ue*we-Ie*Y-me*oe-Re*ce,H[4]=(Ie=F[4])*we+(Ue=F[7])*Y+(me=F[5])*ce-(Re=F[6])*oe,H[5]=me*we+Ue*oe+Re*Y-Ie*ce,H[6]=Re*we+Ue*ce+Ie*oe-me*Y,H[7]=Ue*we-Ie*Y-me*oe-Re*ce,H},Me.rotateByQuatPrepend=function(H,F,V){var Y=F[0],oe=F[1],ce=F[2],we=F[3],Ie=V[0],me=V[1],Re=V[2],Ue=V[3];return H[0]=Y*Ue+we*Ie+oe*Re-ce*me,H[1]=oe*Ue+we*me+ce*Ie-Y*Re,H[2]=ce*Ue+we*Re+Y*me-oe*Ie,H[3]=we*Ue-Y*Ie-oe*me-ce*Re,H[4]=Y*(Ue=V[7])+we*(Ie=V[4])+oe*(Re=V[6])-ce*(me=V[5]),H[5]=oe*Ue+we*me+ce*Ie-Y*Re,H[6]=ce*Ue+we*Re+Y*me-oe*Ie,H[7]=we*Ue-Y*Ie-oe*me-ce*Re,H},Me.rotateAroundAxis=function(H,F,V,Y){if(Math.abs(Y)<e.EPSILON)return R(H,F);var oe=Math.hypot(V[0],V[1],V[2]);Y*=.5;var ce=Math.sin(Y),we=ce*V[0]/oe,Ie=ce*V[1]/oe,me=ce*V[2]/oe,Re=Math.cos(Y),Ue=F[0],$e=F[1],ct=F[2],lt=F[3];H[0]=Ue*Re+lt*we+$e*me-ct*Ie,H[1]=$e*Re+lt*Ie+ct*we-Ue*me,H[2]=ct*Re+lt*me+Ue*Ie-$e*we,H[3]=lt*Re-Ue*we-$e*Ie-ct*me;var st=F[4],xt=F[5],dt=F[6],Et=F[7];return H[4]=st*Re+Et*we+xt*me-dt*Ie,H[5]=xt*Re+Et*Ie+dt*we-st*me,H[6]=dt*Re+Et*me+st*Ie-xt*we,H[7]=Et*Re-st*we-xt*Ie-dt*me,H},Me.add=function(H,F,V){return H[0]=F[0]+V[0],H[1]=F[1]+V[1],H[2]=F[2]+V[2],H[3]=F[3]+V[3],H[4]=F[4]+V[4],H[5]=F[5]+V[5],H[6]=F[6]+V[6],H[7]=F[7]+V[7],H},Me.multiply=N,Me.scale=function(H,F,V){return H[0]=F[0]*V,H[1]=F[1]*V,H[2]=F[2]*V,H[3]=F[3]*V,H[4]=F[4]*V,H[5]=F[5]*V,H[6]=F[6]*V,H[7]=F[7]*V,H},Me.lerp=function(H,F,V,Y){var oe=1-Y;return $(F,V)<0&&(Y=-Y),H[0]=F[0]*oe+V[0]*Y,H[1]=F[1]*oe+V[1]*Y,H[2]=F[2]*oe+V[2]*Y,H[3]=F[3]*oe+V[3]*Y,H[4]=F[4]*oe+V[4]*Y,H[5]=F[5]*oe+V[5]*Y,H[6]=F[6]*oe+V[6]*Y,H[7]=F[7]*oe+V[7]*Y,H},Me.invert=function(H,F){var V=j(F);return H[0]=-F[0]/V,H[1]=-F[1]/V,H[2]=-F[2]/V,H[3]=F[3]/V,H[4]=-F[4]/V,H[5]=-F[5]/V,H[6]=-F[6]/V,H[7]=F[7]/V,H},Me.conjugate=function(H,F){return H[0]=-F[0],H[1]=-F[1],H[2]=-F[2],H[3]=F[3],H[4]=-F[4],H[5]=-F[5],H[6]=-F[6],H[7]=F[7],H},Me.normalize=function(H,F){var V=j(F);if(V>0){V=Math.sqrt(V);var Y=F[0]/V,oe=F[1]/V,ce=F[2]/V,we=F[3]/V,Ie=F[4],me=F[5],Re=F[6],Ue=F[7],$e=Y*Ie+oe*me+ce*Re+we*Ue;H[0]=Y,H[1]=oe,H[2]=ce,H[3]=we,H[4]=(Ie-Y*$e)/V,H[5]=(me-oe*$e)/V,H[6]=(Re-ce*$e)/V,H[7]=(Ue-we*$e)/V}return H},Me.str=function(H){return"quat2("+H[0]+", "+H[1]+", "+H[2]+", "+H[3]+", "+H[4]+", "+H[5]+", "+H[6]+", "+H[7]+")"},Me.exactEquals=function(H,F){return H[0]===F[0]&&H[1]===F[1]&&H[2]===F[2]&&H[3]===F[3]&&H[4]===F[4]&&H[5]===F[5]&&H[6]===F[6]&&H[7]===F[7]},Me.equals=function(H,F){var V=H[0],Y=H[1],oe=H[2],ce=H[3],we=H[4],Ie=H[5],me=H[6],Re=H[7],Ue=F[0],$e=F[1],ct=F[2],lt=F[3],st=F[4],xt=F[5],dt=F[6],Et=F[7];return Math.abs(V-Ue)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(Ue))&&Math.abs(Y-$e)<=e.EPSILON*Math.max(1,Math.abs(Y),Math.abs($e))&&Math.abs(oe-ct)<=e.EPSILON*Math.max(1,Math.abs(oe),Math.abs(ct))&&Math.abs(ce-lt)<=e.EPSILON*Math.max(1,Math.abs(ce),Math.abs(lt))&&Math.abs(we-st)<=e.EPSILON*Math.max(1,Math.abs(we),Math.abs(st))&&Math.abs(Ie-xt)<=e.EPSILON*Math.max(1,Math.abs(Ie),Math.abs(xt))&&Math.abs(me-dt)<=e.EPSILON*Math.max(1,Math.abs(me),Math.abs(dt))&&Math.abs(Re-Et)<=e.EPSILON*Math.max(1,Math.abs(Re),Math.abs(Et))},Me.sqrLen=Me.squaredLength=Me.len=Me.length=Me.dot=Me.mul=Me.setReal=Me.getReal=void 0;var e=l(m()),i=l(Pe()),s=l(X());function f(H){if(typeof WeakMap!="function")return null;var F=new WeakMap,V=new WeakMap;return(f=function(Y){return Y?V:F})(H)}function l(H,F){if(H&&H.__esModule)return H;if(H===null||o(H)!=="object"&&typeof H!="function")return{default:H};var V=f(F);if(V&&V.has(H))return V.get(H);var Y={},oe=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ce in H)if(ce!=="default"&&Object.prototype.hasOwnProperty.call(H,ce)){var we=oe?Object.getOwnPropertyDescriptor(H,ce):null;we&&(we.get||we.set)?Object.defineProperty(Y,ce,we):Y[ce]=H[ce]}return Y.default=H,V&&V.set(H,Y),Y}function d(H,F,V){var Y=.5*V[0],oe=.5*V[1],ce=.5*V[2],we=F[0],Ie=F[1],me=F[2],Re=F[3];return H[0]=we,H[1]=Ie,H[2]=me,H[3]=Re,H[4]=Y*Re+oe*me-ce*Ie,H[5]=oe*Re+ce*we-Y*me,H[6]=ce*Re+Y*Ie-oe*we,H[7]=-Y*we-oe*Ie-ce*me,H}function R(H,F){return H[0]=F[0],H[1]=F[1],H[2]=F[2],H[3]=F[3],H[4]=F[4],H[5]=F[5],H[6]=F[6],H[7]=F[7],H}function N(H,F,V){var Y=F[0],oe=F[1],ce=F[2],we=F[3],Ie=V[4],me=V[5],Re=V[6],Ue=V[7],$e=F[4],ct=F[5],lt=F[6],st=F[7],xt=V[0],dt=V[1],Et=V[2],It=V[3];return H[0]=Y*It+we*xt+oe*Et-ce*dt,H[1]=oe*It+we*dt+ce*xt-Y*Et,H[2]=ce*It+we*Et+Y*dt-oe*xt,H[3]=we*It-Y*xt-oe*dt-ce*Et,H[4]=Y*Ue+we*Ie+oe*Re-ce*me+$e*It+st*xt+ct*Et-lt*dt,H[5]=oe*Ue+we*me+ce*Ie-Y*Re+ct*It+st*dt+lt*xt-$e*Et,H[6]=ce*Ue+we*Re+Y*me-oe*Ie+lt*It+st*Et+$e*dt-ct*xt,H[7]=we*Ue-Y*Ie-oe*me-ce*Re+st*It-$e*xt-ct*dt-lt*Et,H}Me.getReal=i.copy,Me.setReal=i.copy,Me.mul=N;var $=i.dot;Me.dot=$;var I=i.length;Me.length=I,Me.len=I;var j=i.squaredLength;return Me.squaredLength=j,Me.sqrLen=j,Me}var nt,ht,Fe={};function Ce(){if(nt)return Fe;function o(F){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(V){return typeof V}:function(V){return V&&typeof Symbol=="function"&&V.constructor===Symbol&&V!==Symbol.prototype?"symbol":typeof V},o(F)}nt=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.create=s,Fe.clone=function(F){var V=new e.ARRAY_TYPE(2);return V[0]=F[0],V[1]=F[1],V},Fe.fromValues=function(F,V){var Y=new e.ARRAY_TYPE(2);return Y[0]=F,Y[1]=V,Y},Fe.copy=function(F,V){return F[0]=V[0],F[1]=V[1],F},Fe.set=function(F,V,Y){return F[0]=V,F[1]=Y,F},Fe.add=function(F,V,Y){return F[0]=V[0]+Y[0],F[1]=V[1]+Y[1],F},Fe.subtract=f,Fe.multiply=l,Fe.divide=d,Fe.ceil=function(F,V){return F[0]=Math.ceil(V[0]),F[1]=Math.ceil(V[1]),F},Fe.floor=function(F,V){return F[0]=Math.floor(V[0]),F[1]=Math.floor(V[1]),F},Fe.min=function(F,V,Y){return F[0]=Math.min(V[0],Y[0]),F[1]=Math.min(V[1],Y[1]),F},Fe.max=function(F,V,Y){return F[0]=Math.max(V[0],Y[0]),F[1]=Math.max(V[1],Y[1]),F},Fe.round=function(F,V){return F[0]=Math.round(V[0]),F[1]=Math.round(V[1]),F},Fe.scale=function(F,V,Y){return F[0]=V[0]*Y,F[1]=V[1]*Y,F},Fe.scaleAndAdd=function(F,V,Y,oe){return F[0]=V[0]+Y[0]*oe,F[1]=V[1]+Y[1]*oe,F},Fe.distance=R,Fe.squaredDistance=N,Fe.length=$,Fe.squaredLength=I,Fe.negate=function(F,V){return F[0]=-V[0],F[1]=-V[1],F},Fe.inverse=function(F,V){return F[0]=1/V[0],F[1]=1/V[1],F},Fe.normalize=function(F,V){var Y=V[0],oe=V[1],ce=Y*Y+oe*oe;return ce>0&&(ce=1/Math.sqrt(ce)),F[0]=V[0]*ce,F[1]=V[1]*ce,F},Fe.dot=function(F,V){return F[0]*V[0]+F[1]*V[1]},Fe.cross=function(F,V,Y){var oe=V[0]*Y[1]-V[1]*Y[0];return F[0]=F[1]=0,F[2]=oe,F},Fe.lerp=function(F,V,Y,oe){var ce=V[0],we=V[1];return F[0]=ce+oe*(Y[0]-ce),F[1]=we+oe*(Y[1]-we),F},Fe.random=function(F,V){V=V||1;var Y=2*e.RANDOM()*Math.PI;return F[0]=Math.cos(Y)*V,F[1]=Math.sin(Y)*V,F},Fe.transformMat2=function(F,V,Y){var oe=V[0],ce=V[1];return F[0]=Y[0]*oe+Y[2]*ce,F[1]=Y[1]*oe+Y[3]*ce,F},Fe.transformMat2d=function(F,V,Y){var oe=V[0],ce=V[1];return F[0]=Y[0]*oe+Y[2]*ce+Y[4],F[1]=Y[1]*oe+Y[3]*ce+Y[5],F},Fe.transformMat3=function(F,V,Y){var oe=V[0],ce=V[1];return F[0]=Y[0]*oe+Y[3]*ce+Y[6],F[1]=Y[1]*oe+Y[4]*ce+Y[7],F},Fe.transformMat4=function(F,V,Y){var oe=V[0],ce=V[1];return F[0]=Y[0]*oe+Y[4]*ce+Y[12],F[1]=Y[1]*oe+Y[5]*ce+Y[13],F},Fe.rotate=function(F,V,Y,oe){var ce=V[0]-Y[0],we=V[1]-Y[1],Ie=Math.sin(oe),me=Math.cos(oe);return F[0]=ce*me-we*Ie+Y[0],F[1]=ce*Ie+we*me+Y[1],F},Fe.angle=function(F,V){var Y=F[0],oe=F[1],ce=V[0],we=V[1],Ie=Math.sqrt(Y*Y+oe*oe)*Math.sqrt(ce*ce+we*we);return Math.acos(Math.min(Math.max(Ie&&(Y*ce+oe*we)/Ie,-1),1))},Fe.zero=function(F){return F[0]=0,F[1]=0,F},Fe.str=function(F){return"vec2("+F[0]+", "+F[1]+")"},Fe.exactEquals=function(F,V){return F[0]===V[0]&&F[1]===V[1]},Fe.equals=function(F,V){var Y=F[0],oe=F[1],ce=V[0],we=V[1];return Math.abs(Y-ce)<=e.EPSILON*Math.max(1,Math.abs(Y),Math.abs(ce))&&Math.abs(oe-we)<=e.EPSILON*Math.max(1,Math.abs(oe),Math.abs(we))},Fe.forEach=Fe.sqrLen=Fe.sqrDist=Fe.dist=Fe.div=Fe.mul=Fe.sub=Fe.len=void 0;var e=function(F,V){if(F&&F.__esModule)return F;if(F===null||o(F)!=="object"&&typeof F!="function")return{default:F};var Y=i(void 0);if(Y&&Y.has(F))return Y.get(F);var oe={},ce=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var we in F)if(we!=="default"&&Object.prototype.hasOwnProperty.call(F,we)){var Ie=ce?Object.getOwnPropertyDescriptor(F,we):null;Ie&&(Ie.get||Ie.set)?Object.defineProperty(oe,we,Ie):oe[we]=F[we]}return oe.default=F,Y&&Y.set(F,oe),oe}(m());function i(F){if(typeof WeakMap!="function")return null;var V=new WeakMap,Y=new WeakMap;return(i=function(oe){return oe?Y:V})(F)}function s(){var F=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(F[0]=0,F[1]=0),F}function f(F,V,Y){return F[0]=V[0]-Y[0],F[1]=V[1]-Y[1],F}function l(F,V,Y){return F[0]=V[0]*Y[0],F[1]=V[1]*Y[1],F}function d(F,V,Y){return F[0]=V[0]/Y[0],F[1]=V[1]/Y[1],F}function R(F,V){return Math.hypot(V[0]-F[0],V[1]-F[1])}function N(F,V){var Y=V[0]-F[0],oe=V[1]-F[1];return Y*Y+oe*oe}function $(F){return Math.hypot(F[0],F[1])}function I(F){var V=F[0],Y=F[1];return V*V+Y*Y}Fe.len=$,Fe.sub=f,Fe.mul=l,Fe.div=d,Fe.dist=R,Fe.sqrDist=N,Fe.sqrLen=I;var j,H=(j=s(),function(F,V,Y,oe,ce,we){var Ie,me;for(V||(V=2),Y||(Y=0),me=oe?Math.min(oe*V+Y,F.length):F.length,Ie=Y;Ie<me;Ie+=V)j[0]=F[Ie],j[1]=F[Ie+1],ce(j,j,we),F[Ie]=j[0],F[Ie+1]=j[1];return F});return Fe.forEach=H,Fe}function Be(){if(ht)return w;function o(F){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(V){return typeof V}:function(V){return V&&typeof Symbol=="function"&&V.constructor===Symbol&&V!==Symbol.prototype?"symbol":typeof V},o(F)}ht=1,Object.defineProperty(w,"__esModule",{value:!0}),w.vec4=w.vec3=w.vec2=w.quat2=w.quat=w.mat4=w.mat3=w.mat2d=w.mat2=w.glMatrix=void 0;var e=H(m());w.glMatrix=e;var i=H(C());w.mat2=i;var s=H(P());w.mat2d=s;var f=H(U());w.mat3=f;var l=H(X());w.mat4=l;var d=H(Pe());w.quat=d;var R=H(He());w.quat2=R;var N=H(Ce());w.vec2=N;var $=H(te());w.vec3=$;var I=H(Le());function j(F){if(typeof WeakMap!="function")return null;var V=new WeakMap,Y=new WeakMap;return(j=function(oe){return oe?Y:V})(F)}function H(F,V){if(F&&F.__esModule)return F;if(F===null||o(F)!=="object"&&typeof F!="function")return{default:F};var Y=j(V);if(Y&&Y.has(F))return Y.get(F);var oe={},ce=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var we in F)if(we!=="default"&&Object.prototype.hasOwnProperty.call(F,we)){var Ie=ce?Object.getOwnPropertyDescriptor(F,we):null;Ie&&(Ie.get||Ie.set)?Object.defineProperty(oe,we,Ie):oe[we]=F[we]}return oe.default=F,Y&&Y.set(F,oe),oe}return w.vec4=I,w}var Ae,se,pe,Ke,_e=Be(),ke=function(){if(se)return Ae;function o(e,i,s,f){this.cx=3*e,this.bx=3*(s-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(f-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=s,this.p2y=f}return se=1,Ae=o,o.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var s=e,f=0;f<8;f++){var l=this.sampleCurveX(s)-e;if(Math.abs(l)<i)return s;var d=this.sampleCurveDerivativeX(s);if(Math.abs(d)<1e-6)break;s-=l/d}var R=0,N=1;for(s=e,f=0;f<20&&(l=this.sampleCurveX(s),!(Math.abs(l-e)<i));f++)e>l?R=s:N=s,s=.5*(N-R)+R;return s},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Ae}(),qe=S(ke);function tt(){if(Ke)return pe;function o(e,i){this.x=e,this.y=i}return Ke=1,pe=o,o.prototype={clone:function(){return new o(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,s=e.y-this.y;return i*i+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),s=Math.sin(e),f=s*this.x+i*this.y;return this.x=i*this.x-s*this.y,this.y=f,this},_rotateAround:function(e,i){var s=Math.cos(e),f=Math.sin(e),l=i.y+f*(this.x-i.x)+s*(this.y-i.y);return this.x=i.x+s*(this.x-i.x)-f*(this.y-i.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(e){return e instanceof o?e:Array.isArray(e)?new o(e[0],e[1]):e},pe}var Ge=S(tt());function We(o,e){if(Array.isArray(o)){if(!Array.isArray(e)||o.length!==e.length)return!1;for(let i=0;i<o.length;i++)if(!We(o[i],e[i]))return!1;return!0}if(typeof o=="object"&&o!==null&&e!==null){if(typeof e!="object"||Object.keys(o).length!==Object.keys(e).length)return!1;for(const i in o)if(!We(o[i],e[i]))return!1;return!0}return o===e}const Je=Math.PI/180,it=180/Math.PI;function ze(o){return o*Je}function de(o){return o*it}const ve=[[0,0],[1,0],[1,1],[0,1]];function be(o){if(o<=0)return 0;if(o>=1)return 1;const e=o*o,i=e*o;return 4*(o<.5?i:3*(o-e)+i-.75)}function Oe(o,e,i,s){const f=new qe(o,e,i,s);return function(l){return f.solve(l)}}const ge=Oe(.25,.1,.25,1);function le(o,e,i){return Math.min(i,Math.max(e,o))}function et(o,e,i){return(i=le((i-o)/(e-o),0,1))*i*(3-2*i)}function wt(o,e,i){const s=i-e,f=((o-e)%s+s)%s+e;return f===e?i:f}function Ft(o,e,i){if(!o.length)return i(null,[]);let s=o.length;const f=new Array(o.length);let l=null;o.forEach((d,R)=>{e(d,(N,$)=>{N&&(l=N),f[R]=$,--s==0&&i(l,f)})})}function Wt(o,...e){for(const i of e)for(const s in i)o[s]=i[s];return o}let or=1;function Or(){return or++}function xr(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function Tr(o,e){o.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function br(o,e){return o.indexOf(e,o.length-e.length)!==-1}function fr(o,e,i){const s={};for(const f in o)s[f]=e.call(this,o[f],f,o);return s}function Vr(o,e,i){const s={};for(const f in o)e.call(this,o[f],f,o)&&(s[f]=o[f]);return s}function Ir(o){return Array.isArray(o)?o.map(Ir):typeof o=="object"&&o?fr(o,Ir):o}const De={};function St(o){De[o]||(typeof console<"u"&&console.warn(o),De[o]=!0)}function Ut(o,e,i){return(i.y-o.y)*(e.x-o.x)>(e.y-o.y)*(i.x-o.x)}function ir(o){let e=0;for(let i,s,f=0,l=o.length,d=l-1;f<l;d=f++)i=o[f],s=o[d],e+=(s.x-i.x)*(i.y+s.y);return e}function Rt([o,e,i]){const s=ze(e+90),f=ze(i);return{x:o*Math.cos(s)*Math.sin(f),y:o*Math.sin(s)*Math.sin(f),z:o*Math.cos(f),azimuthal:e,polar:i}}function $t(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function rt(o){const e={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,s,f,l)=>{const d=f||l;return e[s]=!d||d.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let sr=null;function Fr(o,e){return[o[4*e],o[4*e+1],o[4*e+2],o[4*e+3]]}function ee(o,e,i,s){for(;e<i;){const f=e+i>>1;o[f]<s?e=f+1:i=f}return e}function Qe(o,e,i,s){for(;e<i;){const f=e+i>>1;o[f]<=s?e=f+1:i=f}return e}function ie(o){return o>0?1/(1.001-o):1+o}function B(o){return o>0?1-1/(1.001-o):-o}const Q={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Q.API_URL)return null;try{const o=new URL(Q.API_URL);return o.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":o.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function xe(o){return Q.API_URL_REGEX.test(o)}function Ne(o){return Q.API_SPRITE_REGEX.test(o)}let Ze,ot,mt,Nt,Bt,Lt;function Yt(){return Ze==null&&(Ze=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ze}const cr={now:()=>Nt!==void 0?Nt:performance.now(),setNow(o){Nt=o},restoreNow(){Nt=void 0},frame(o){const e=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(o,e=0){const{width:i,height:s}=o;Bt||(Bt=document.createElement("canvas"));const f=Bt.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(i>Bt.width||s>Bt.height)&&(Bt.width=i,Bt.height=s),f.clearRect(-e,-e,i+2*e,s+2*e),f.drawImage(o,0,0,i,s),f.getImageData(-e,-e,i+2*e,s+2*e)},resolveURL:o=>(ot||(ot=document.createElement("a")),ot.href=o,ot.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(mt==null&&(mt=window.matchMedia("(prefers-reduced-motion: reduce)")),mt.matches)},hasCanvasFingerprintNoise(){if(Lt!==void 0)return Lt;if(!Yt())return Lt=!1,!1;const o=new OffscreenCanvas(85,1),e=o.getContext("2d",{willReadFrequently:!0});let i=0;for(let f=0;f<o.width;++f)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(f,0,1,1);const s=e.getImageData(0,0,o.width,o.height);i=0;for(let f=0;f<s.data.length;++f)if(f%4!=3&&i++!==s.data[f])return Lt=!0,!0;return Lt=!1,!1}};function gr(o,e){const i=o.indexOf("?");if(i<0)return`${o}?${new URLSearchParams(e).toString()}`;const s=new URLSearchParams(o.slice(i));for(const f in e)s.set(f,e[f]);return`${o.slice(0,i)}?${s.toString()}`}function Pr(o,e={persistentParams:[]}){const i=o.indexOf("?");if(i<0)return o;const s=new URLSearchParams,f=new URLSearchParams(o.slice(i));for(const d of e.persistentParams){const R=f.get(d);R&&s.set(d,R)}const l=s.toString();return`${o.slice(0,i)}${l.length>0?`?${l}`:""}`}const Jr="mapbox-tiles";let Br=500,Ur=50;const oi=["language","worldview","jobid"];let si,Kr;function Wr(){try{return caches}catch{}}function Pi(){const o=Wr();o&&si==null&&(si=o.open(Jr))}let Ki=1/0;const xn={supported:!1,testSupport:function(o){!_t&&ut&&(Vt?Qt(o):en=o)}};let en,ut,_t=!1,Vt=!1;const At=typeof self<"u"?self:{};function Qt(o){const e=o.createTexture();o.bindTexture(o.TEXTURE_2D,e);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,ut),o.isContextLost())return;xn.supported=!0}catch{}o.deleteTexture(e),_t=!0}At.document&&(ut=At.document.createElement("img"),ut.onload=function(){en&&Qt(en),en=null,Vt=!0},ut.onerror=function(){_t=!0,en=null},ut.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Cr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Cr);class Ca extends Error{constructor(e,i,s){i===401&&xe(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Wa=$t()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,ea=function(o,e){if(!(/^file:/.test(i=o.url)||/^file:/.test(Wa())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(s,f){const l=new AbortController,d=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:Wa(),referrerPolicy:s.referrerPolicy,signal:l.signal});let R=!1,N=!1;const $=(I=d.url).indexOf("sku=")>0&&xe(I);var I;s.type==="json"&&d.headers.set("Accept","application/json");const j=(F,V,Y)=>{if(N)return;if(F&&F.message!=="SecurityError"&&St(F.toString()),V&&Y)return H(V);const oe=Date.now();fetch(d).then(ce=>{if(ce.ok){const we=$?ce.clone():null;return H(ce,we,oe)}return f(new Ca(ce.statusText,ce.status,s.url))}).catch(ce=>{ce.name!=="AbortError"&&f(new Error(`${ce.message} ${s.url}`))})},H=(F,V,Y)=>{(s.type==="arrayBuffer"?F.arrayBuffer():s.type==="json"?F.json():F.text()).then(oe=>{N||(V&&Y&&function(ce,we,Ie){if(Pi(),si==null)return;const me=rt(we.headers.get("Cache-Control")||"");if(me["no-store"])return;const Re={status:we.status,statusText:we.statusText,headers:new Headers};we.headers.forEach((ct,lt)=>Re.headers.set(lt,ct)),me["max-age"]&&Re.headers.set("Expires",new Date(Ie+1e3*me["max-age"]).toUTCString());const Ue=Re.headers.get("Expires");if(!Ue||new Date(Ue).getTime()-Ie<42e4)return;let $e=Pr(ce.url,{persistentParams:oi});if(we.status===206){const ct=ce.headers.get("Range");if(!ct)return;Re.status=200,$e=gr($e,{range:ct})}(function(ct,lt){if(Kr===void 0)try{new Response(new ReadableStream),Kr=!0}catch{Kr=!1}Kr?lt(ct.body):ct.blob().then(lt)})(we,ct=>{const lt=new Response((st=we.status)!==200&&st!==404&&[101,103,204,205,304].includes(st)?null:ct,Re);var st;Pi(),si?.then(xt=>xt.put($e,lt)).catch(xt=>St(xt.message))})}(d,V,Y),R=!0,f(null,oe,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(oe=>{N||f(new Error(oe.message))})};return $?function(F,V){if(Pi(),si==null)return V(null);si.then(Y=>{let oe=Pr(F.url,{persistentParams:oi});const ce=F.headers.get("Range");ce&&(oe=gr(oe,{range:ce})),Y.match(oe).then(we=>{const Ie=function(me){if(!me)return!1;const Re=new Date(me.headers.get("Expires")||0),Ue=rt(me.headers.get("Cache-Control")||"");return Re>Date.now()&&!Ue["no-cache"]}(we);Y.delete(oe),Ie&&Y.put(oe,we.clone()),V(null,we,Ie)}).catch(V)}).catch(V)}(d,j):j(null,null),{cancel:()=>{N=!0,R||l.abort()}}}(o,e);if($t()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,e,void 0,!0)}var i;return function(s,f){const l=new XMLHttpRequest;l.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(l.responseType="arraybuffer");for(const d in s.headers)l.setRequestHeader(d,s.headers[d]);return s.type==="json"&&(l.responseType="text",l.setRequestHeader("Accept","application/json")),l.withCredentials=s.credentials==="include",l.onerror=()=>{f(new Error(l.statusText))},l.onload=()=>{if((l.status>=200&&l.status<300||l.status===0)&&l.response!==null){let d=l.response;if(s.type==="json")try{d=JSON.parse(l.response)}catch(R){return f(R)}f(null,d,l.getResponseHeader("Cache-Control"),l.getResponseHeader("Expires"))}else f(new Ca(l.statusText,l.status,s.url))},l.send(s.body),{cancel:()=>l.abort()}}(o,e)},Ra=function(o,e){return ea(Wt(o,{type:"arrayBuffer"}),e)};function To(o){const e=document.createElement("a");return e.href=o,e.protocol===location.protocol&&e.host===location.host}const Es="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let cu,dl;cu=[],dl=0;const hu=function(o,e){if(xn.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),dl>=Q.MAX_PARALLEL_IMAGE_REQUESTS){const l={requestParameters:o,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return cu.push(l),l}dl++;let i=!1;const s=()=>{if(!i)for(i=!0,dl--;cu.length&&dl<Q.MAX_PARALLEL_IMAGE_REQUESTS;){const l=cu.shift(),{requestParameters:d,callback:R,cancelled:N}=l;N||(l.cancel=hu(d,R).cancel)}},f=Ra(o,(l,d,R,N)=>{s(),l?e(l):d&&(self.createImageBitmap?function($,I){const j=new Blob([new Uint8Array($)],{type:"image/png"});createImageBitmap(j).then(H=>{I(null,H)}).catch(H=>{I(new Error(`Could not load image because of ${H.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,($,I)=>e($,I,R,N)):function($,I){const j=new Image;j.onload=()=>{I(null,j),URL.revokeObjectURL(j.src),j.onload=null,requestAnimationFrame(()=>{j.src=Es})},j.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const H=new Blob([new Uint8Array($)],{type:"image/png"});j.src=$.byteLength?URL.createObjectURL(H):Es}(d,($,I)=>e($,I,R,N)))});return{cancel:()=>{f.cancel(),s()}}};var Vc,pa,Da,ga={exports:{}},La={exports:{}},ro={exports:{}},fu=function(){if(Da)return ga.exports;Da=1;var o=(Vc||(Vc=1,La.exports=function(i,s){var f,l,d,R,N,$,I,j;for(l=i.length-(f=3&i.length),d=s,N=3432918353,$=461845907,j=0;j<l;)I=255&i.charCodeAt(j)|(255&i.charCodeAt(++j))<<8|(255&i.charCodeAt(++j))<<16|(255&i.charCodeAt(++j))<<24,++j,d=27492+(65535&(R=5*(65535&(d=(d^=I=(65535&(I=(I=(65535&I)*N+(((I>>>16)*N&65535)<<16)&4294967295)<<15|I>>>17))*$+(((I>>>16)*$&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(R>>>16)&65535)<<16);switch(I=0,f){case 3:I^=(255&i.charCodeAt(j+2))<<16;case 2:I^=(255&i.charCodeAt(j+1))<<8;case 1:d^=I=(65535&(I=(I=(65535&(I^=255&i.charCodeAt(j)))*N+(((I>>>16)*N&65535)<<16)&4294967295)<<15|I>>>17))*$+(((I>>>16)*$&65535)<<16)&4294967295}return d^=i.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}),La.exports),e=(pa||(pa=1,ro.exports=function(i,s){for(var f,l=i.length,d=s^l,R=0;l>=4;)f=1540483477*(65535&(f=255&i.charCodeAt(R)|(255&i.charCodeAt(++R))<<8|(255&i.charCodeAt(++R))<<16|(255&i.charCodeAt(++R))<<24))+((1540483477*(f>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),l-=4,++R;switch(l){case 3:d^=(255&i.charCodeAt(R+2))<<16;case 2:d^=(255&i.charCodeAt(R+1))<<8;case 1:d=1540483477*(65535&(d^=255&i.charCodeAt(R)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}),ro.exports);return ga.exports=o,ga.exports.murmur3=o,ga.exports.murmur2=e,ga.exports}(),pl=S(fu);class So{constructor(e,...i){Wt(this,i[0]||{}),this.type=e}}class Mo extends So{constructor(e,i={}){super("error",Wt({error:e},i))}}function du(o,e,i){i[o]&&i[o].indexOf(e)!==-1||(i[o]=i[o]||[],i[o].push(e))}function Gc(o,e,i){if(i&&i[o]){const s=i[o].indexOf(e);s!==-1&&i[o].splice(s,1)}}class Ts{on(e,i){return this._listeners=this._listeners||{},du(e,i,this._listeners),this}off(e,i){return Gc(e,i,this._listeners),Gc(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},du(e,i,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,i){const s=typeof e=="string"?new So(e,i):e,f=s.type;if(this.listens(f)){s.target=this;const l=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const N of l)N.call(this,s);const d=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const N of d)Gc(f,N,this._oneTimeListeners),N.call(this,s);const R=this._eventedParent;R&&(Wt(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),R.fire(s))}else s instanceof Mo&&console.error(s.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var ya,pu={},mu=function(){if(ya)return pu;ya=1;var o={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(l){return(l=Math.round(l))<0?0:l>255?255:l}function i(l){return e(l[l.length-1]==="%"?parseFloat(l)/100*255:parseInt(l))}function s(l){return(d=l[l.length-1]==="%"?parseFloat(l)/100:parseFloat(l))<0?0:d>1?1:d;var d}function f(l,d,R){return R<0?R+=1:R>1&&(R-=1),6*R<1?l+(d-l)*R*6:2*R<1?d:3*R<2?l+(d-l)*(2/3-R)*6:l}try{pu.parseCSSColor=function(l){var d,R=l.replace(/ /g,"").toLowerCase();if(R in o)return o[R].slice();if(R[0]==="#")return R.length===4?(d=parseInt(R.substr(1),16))>=0&&d<=4095?[(3840&d)>>4|(3840&d)>>8,240&d|(240&d)>>4,15&d|(15&d)<<4,1]:null:R.length===7&&(d=parseInt(R.substr(1),16))>=0&&d<=16777215?[(16711680&d)>>16,(65280&d)>>8,255&d,1]:null;var N=R.indexOf("("),$=R.indexOf(")");if(N!==-1&&$+1===R.length){var I=R.substr(0,N),j=R.substr(N+1,$-(N+1)).split(","),H=1;switch(I){case"rgba":if(j.length!==4)return null;H=s(j.pop());case"rgb":return j.length!==3?null:[i(j[0]),i(j[1]),i(j[2]),H];case"hsla":if(j.length!==4)return null;H=s(j.pop());case"hsl":if(j.length!==3)return null;var F=(parseFloat(j[0])%360+360)%360/360,V=s(j[1]),Y=s(j[2]),oe=Y<=.5?Y*(V+1):Y+V-Y*V,ce=2*Y-oe;return[e(255*f(ce,oe,F+1/3)),e(255*f(ce,oe,F)),e(255*f(ce,oe,F-1/3)),H];default:return null}}return null}}catch{}return pu}();class Mi{constructor(e,i,s,f=1){this.r=e,this.g=i,this.b=s,this.a=f}static parse(e){if(!e)return;if(e instanceof Mi)return e;if(typeof e!="string")return;const i=mu.parseCSSColor(e);return i?new Mi(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toStringPremultipliedAlpha(){const[e,i,s,f]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(s)},${f})`}toString(){const[e,i,s,f]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*s)},${f})`}toRenderColor(e){const{r:i,g:s,b:f,a:l}=this;return new am(e,i,s,f,l)}clone(){return new Mi(this.r,this.g,this.b,this.a)}}class am{constructor(e,i,s,f,l){if(e){const d=e.image.height,R=d*d;i=l===0?0:i/l*(d-1),s=l===0?0:s/l*(d-1),f=l===0?0:f/l*(d-1);const N=Math.floor(i),$=Math.floor(s),I=Math.floor(f),j=Math.ceil(i),H=Math.ceil(s),F=Math.ceil(f),V=i-N,Y=s-$,oe=f-I,ce=e.image.data,we=4*(N+$*R+I*d),Ie=4*(N+$*R+F*d),me=4*(N+H*R+I*d),Re=4*(N+H*R+F*d),Ue=4*(j+$*R+I*d),$e=4*(j+$*R+F*d),ct=4*(j+H*R+I*d),lt=4*(j+H*R+F*d);if(we<0||lt>=ce.length)throw new Error("out of range");this.r=Qr(Qr(Qr(ce[we],ce[Ie],oe),Qr(ce[me],ce[Re],oe),Y),Qr(Qr(ce[Ue],ce[$e],oe),Qr(ce[ct],ce[lt],oe),Y),V)/255*l,this.g=Qr(Qr(Qr(ce[we+1],ce[Ie+1],oe),Qr(ce[me+1],ce[Re+1],oe),Y),Qr(Qr(ce[Ue+1],ce[$e+1],oe),Qr(ce[ct+1],ce[lt+1],oe),Y),V)/255*l,this.b=Qr(Qr(Qr(ce[we+2],ce[Ie+2],oe),Qr(ce[me+2],ce[Re+2],oe),Y),Qr(Qr(ce[Ue+2],ce[$e+2],oe),Qr(ce[ct+2],ce[lt+2],oe),Y),V)/255*l,this.a=l}else this.r=i,this.g=s,this.b=f,this.a=l}toArray(){const{r:e,g:i,b:s,a:f}=this;return f===0?[0,0,0,0]:[255*e/f,255*i/f,255*s/f,f]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:e,g:i,b:s,a:f}=this,l=Math.min(Math.max(e/f,0),1),d=Math.min(Math.max(i/f,0),1),R=Math.min(Math.max(s/f,0),1),N=Math.min(l,d,R),$=Math.max(l,d,R),I=(N+$)/2;if(N===$)return[0,0,100*I,f];const j=$-N,H=I>.5?j/(2-$-N):j/($+N);let F=0;return $===l?F=(d-R)/j+(d<R?6:0):$===d?F=(R-l)/j+2:$===R&&(F=(l-d)/j+4),F*=60,[Math.min(Math.max(F,0),360),Math.min(Math.max(100*H,0),100),Math.min(Math.max(100*I,0),100),f]}toArray01(){const{r:e,g:i,b:s,a:f}=this;return f===0?[0,0,0,0]:[e/f,i/f,s/f,f]}toArray01Scaled(e){const{r:i,g:s,b:f,a:l}=this;return l===0?[0,0,0]:[i/l*e,s/l*e,f/l*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:s,a:f}=this;return[e,i,s,f]}toArray01Linear(){const{r:e,g:i,b:s,a:f}=this;return f===0?[0,0,0,0]:[Math.pow(e/f,2.2),Math.pow(i/f,2.2),Math.pow(s/f,2.2),f]}}function Qr(o,e,i){return o*(1-i)+e*i}function Hc(o,e,i){return o.map((s,f)=>Qr(s,e[f],i))}Mi.black=new Mi(0,0,0,1),Mi.white=new Mi(1,1,1,1),Mi.transparent=new Mi(0,0,0,0),Mi.red=new Mi(1,0,0,1),Mi.blue=new Mi(0,0,1,1);var Ti=Object.freeze({__proto__:null,array:Hc,color:function(o,e,i){return new Mi(Qr(o.r,e.r,i),Qr(o.g,e.g,i),Qr(o.b,e.b,i),Qr(o.a,e.a,i))},number:Qr});function _u(o,...e){for(const i of e)for(const s in i)o[s]=i[s];return o}class va extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class qc{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[s,f]of i)this.bindings[s]=f}concat(e){return new qc(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Ss={kind:"null"},Rr={kind:"number"},Ci={kind:"string"},Si={kind:"boolean"},ta={kind:"color"},$o={kind:"object"},xi={kind:"value"},gu={kind:"collator"},io={kind:"formatted"},Zo={kind:"resolvedImage"};function Fn(o,e){return{kind:"array",itemType:o,N:e}}function Wi(o){if(o.kind==="array"){const e=Wi(o.itemType);return typeof o.N=="number"?`array<${e}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${e}>`}return o.kind}const Vf=[Ss,Rr,Ci,Si,ta,io,$o,Fn(xi),Zo];function ml(o,e){if(e.kind==="error")return null;if(o.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ml(o.itemType,e.itemType))&&(typeof o.N!="number"||o.N===e.N))return null}else{if(o.kind===e.kind)return null;if(o.kind==="value"){for(const i of Vf)if(!ml(i,e))return null}}return`Expected ${Wi(o)} but found ${Wi(e)} instead.`}function yu(o,e){return e.some(i=>i.kind===o.kind)}function Ms(o,e){return e.some(i=>i==="null"?o===null:i==="array"?Array.isArray(o):i==="object"?o&&!Array.isArray(o)&&typeof o=="object":i===typeof o)}class vu{constructor(e,i,s){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class _l{constructor(e,i,s,f,l){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=s,this.fontStack=f,this.textColor=l}}class Nn{constructor(e){this.sections=e}static fromString(e){return new Nn([new _l(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary)}static factory(e){return e instanceof Nn?e:Nn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toRenderColor(null).toArray())),e.push(s)}return e}}class $a{constructor(e,i){if(this.id=e,this.options=i||{params:{}},this.options.transform){const{a:s,b:f,c:l,d,e:R,f:N}=this.options.transform;this.options.transform=new DOMMatrix([s,f,l,d,R,N])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}static deserializeId(e){return JSON.parse(e).id}static deserializeFromString(e){const i=JSON.parse(e),{a:s,b:f,c:l,d,e:R,f:N}=i.options.transform;return new DOMMatrix([s,f,l,d,R,N]),new $a(i.id,i.options)}scaleSelf(e){return this.options.transform=this.options.transform.scale(e),this}serialize(){const e={id:this.id};this.options&&(e.options=this.options);const{a:i,b:s,c:f,d:l,e:d,f:R}=this.options.transform;return e.options.transform={a:i,b:s,c:f,d:l,e:d,f:R},JSON.stringify(e)}}class Mn{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),e.optionsPrimary&&(this.optionsPrimary=e.optionsPrimary),e.optionsSecondary&&(this.optionsSecondary=e.optionsSecondary),this.available=e.available}toString(){return this.namePrimary&&this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}getPrimary(){return new $a(this.namePrimary,{params:this.optionsPrimary&&this.optionsPrimary.params||{}})}getSerializedPrimary(){return this.getPrimary().serialize()}getSecondary(){return this.nameSecondary?new $a(this.nameSecondary,{params:this.optionsSecondary&&this.optionsSecondary.params||{}}):null}static from(e){return typeof e=="string"?Mn.build(e):e}static build(e,i,s,f){return e?new Mn({namePrimary:e,nameSecondary:i,optionsPrimary:s,optionsSecondary:f,available:!1}):null}}function Xo(o,e,i,s){return typeof o=="number"&&o>=0&&o<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[o,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[o,e,i,s]:[o,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Yo(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof Mi||o instanceof vu||o instanceof Nn||o instanceof Mn)return!0;if(Array.isArray(o)){for(const e of o)if(!Yo(e))return!1;return!0}if(typeof o=="object"){for(const e in o)if(!Yo(o[e]))return!1;return!0}return!1}function Ji(o){if(o===null)return Ss;if(typeof o=="string")return Ci;if(typeof o=="boolean")return Si;if(typeof o=="number")return Rr;if(o instanceof Mi)return ta;if(o instanceof vu)return gu;if(o instanceof Nn)return io;if(o instanceof Mn)return Zo;if(Array.isArray(o)){const e=o.length;let i;for(const s of o){const f=Ji(s);if(i){if(i===f)continue;i=xi;break}i=f}return Fn(i||xi,e)}return $o}function Oa(o){const e=typeof o;return o===null?"":e==="string"||e==="number"||e==="boolean"?String(o):o instanceof Mi?o.toStringPremultipliedAlpha():o instanceof Nn||o instanceof Mn?o.toString():JSON.stringify(o)}class ba{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Yo(e[1]))return i.error("invalid value");const s=e[1];let f=Ji(s);const l=i.expectedType;return f.kind!=="array"||f.N!==0||!l||l.kind!=="array"||typeof l.N=="number"&&l.N!==0||(f=l),new ba(f,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Mi?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Nn?this.value.serialize():this.value}}class dn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const gl={string:Ci,number:Rr,boolean:Si,object:$o};class xa{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s,f=1;const l=e[0];if(l==="array"){let R,N;if(e.length>2){const $=e[1];if(typeof $!="string"||!($ in gl)||$==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);R=gl[$],f++}else R=xi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);N=e[2],f++}s=Fn(R,N)}else s=gl[l];const d=[];for(;f<e.length;f++){const R=i.parse(e[f],f,xi);if(!R)return null;d.push(R)}return new xa(s,d)}evaluate(e){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(e);if(!ml(this.type,Ji(s)))return s;if(i===this.args.length-1)throw new dn(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${Wi(Ji(s))} but was expected to be of type ${Wi(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){i.push(s.kind);const f=e.N;(typeof f=="number"||this.args.length>1)&&i.push(f)}}return i.concat(this.args.map(s=>s.serialize()))}}class no{constructor(e){this.type=io,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return i.error("First argument must be an image or text section.");const f=[];let l=!1;for(let d=1;d<=e.length-1;++d){const R=e[d];if(l&&typeof R=="object"&&!Array.isArray(R)){l=!1;let N=null;if(R["font-scale"]&&(N=i.parseObjectValue(R["font-scale"],d,"font-scale",Rr),!N))return null;let $=null;if(R["text-font"]&&($=i.parseObjectValue(R["text-font"],d,"text-font",Fn(Ci)),!$))return null;let I=null;if(R["text-color"]&&(I=i.parseObjectValue(R["text-color"],d,"text-color",ta),!I))return null;const j=f[f.length-1];j.scale=N,j.font=$,j.textColor=I}else{const N=i.parse(e[d],d,xi);if(!N)return null;const $=N.type.kind;if($!=="string"&&$!=="value"&&$!=="null"&&$!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,f.push({content:N,scale:null,font:null,textColor:null})}}return new no(f)}evaluate(e){return new Nn(this.sections.map(i=>{const s=i.content.evaluate(e);return Ji(s)===Zo?new _l("",s,null,null,null):new _l(Oa(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),e.push(s)}return e}}class As{constructor(e,i,s,f){this._imageWarnHistory={},this.type=Zo,this.inputPrimary=e,this.inputSecondary=i,this.inputPrimaryParams=s,this.inputSecondaryParams=f}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let s=1;const f=[];function l(){if(s<e.length){const R=i.parse(e[s],s++,Ci);return R?(f.push({image:R,options:void 0}),!0):(i.error(f.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function d(){if(s<e.length){if((R=e[s])===null||typeof R!="object"||Array.isArray(R))return!0;const N=e[s].params,$=i.concat(s);if(!N)return s++,!0;if(typeof N!="object"||N.constructor!==Object)return $.error('Image options "params" should be an object'),!1;const I={},j=$.concat(void 0,"params");for(const H in N){if(!H)return j.error("Image parameter name should be non-empty"),!1;const F=j.concat(void 0,H).parse(N[H],void 0,ta,void 0,{typeAnnotation:"coerce"});if(!F)return!1;I[H]=F}return f[f.length-1].options=I,s++,!0}var R;return!0}for(let R=0;R<2;R++)if(!l()||!d())return;return new As(f[0].image,f[1]?f[1].image:void 0,f[0].options,f[1]?f[1].options:void 0)}evaluateParams(e,i){const s={};if(i){for(const f in i)if(i[f])try{const l=i[f].evaluate(e),d=`Ignoring image parameter "${f}" with semi-transparent color ${l.toString()}`;if(l.a!==1){this._imageWarnHistory[d]||(console.warn(d),this._imageWarnHistory[d]=!0);continue}s[f]=l}catch{continue}if(Object.keys(s).length!==0)return{params:s}}}evaluate(e){const i=Mn.build(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0,this.inputPrimaryParams?this.evaluateParams(e,this.inputPrimaryParams):void 0,this.inputSecondaryParams?this.evaluateParams(e,this.inputSecondaryParams):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){if(e(this.inputPrimary),this.inputPrimaryParams)for(const i in this.inputPrimaryParams)this.inputPrimaryParams[i]&&e(this.inputPrimaryParams[i]);if(this.inputSecondary&&(e(this.inputSecondary),this.inputSecondaryParams))for(const i in this.inputSecondaryParams)this.inputSecondaryParams[i]&&e(this.inputSecondaryParams[i])}outputDefined(){return!1}serializeParams(e){const i={};if(e){for(const s in e)e[s]&&(i[s]=e[s].serialize());return{params:i}}}serialize(){const e=["image",this.inputPrimary.serialize()];return this.inputPrimaryParams&&e.push(this.serializeParams(this.inputPrimaryParams)),this.inputSecondary&&(e.push(this.inputSecondary.serialize()),this.inputSecondaryParams&&e.push(this.serializeParams(this.inputSecondaryParams))),e}}function Ko(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}const om={"to-boolean":Si,"to-color":ta,"to-number":Rr,"to-string":Ci};class ao{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[0],f=[];let l=Ss;if(s==="to-array"){if(!Array.isArray(e[1]))return null;const d=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);l=Fn(i.expectedType.itemType,d)}else{if(!(d>0&&Yo(e[1][0])))return null;l=Fn(Ji(e[1][0]),d)}for(let R=0;R<d;R++){const N=e[1][R];let $;if(Ko(N)==="array")$=i.parse(N,void 0,l.itemType);else{const I=Ko(N);if(I!==l.itemType.kind)return i.error(`Expected ${l.itemType.kind} but found ${I}.`);$=i.registry.literal.parse(["literal",N===void 0?null:N],i)}if(!$)return null;f.push($)}}else{if((s==="to-boolean"||s==="to-string")&&e.length!==2)return i.error("Expected one argument.");l=om[s];for(let d=1;d<e.length;d++){const R=i.parse(e[d],d,xi);if(!R)return null;f.push(R)}}return new ao(l,f)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,s;for(const f of this.args){if(i=f.evaluate(e),s=null,i instanceof Mi)return i;if(typeof i=="string"){const l=e.parseColor(i);if(l)return l}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Xo(i[0],i[1],i[2],i[3]),!s))return new Mi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new dn(s||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const s of this.args){if(i=s.evaluate(e),i===null)return 0;const f=Number(i);if(!isNaN(f))return f}throw new dn(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Nn.fromString(Oa(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Mn.build(Oa(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):Oa(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new no([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new As(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Gf=["Unknown","Point","LineString","Polygon"];class bu{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Gf[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:s,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*i-e[0])+this.featureDistanceData.bearing[1]*(f*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Mi.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class ra{constructor(e,i,s,f,l){this.name=e,this.type=i,this._evaluate=s,this.args=f,this._overloadIndex=l}evaluate(e){if(!this._evaluate){const i=ra.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const s=e[0],f=ra.definitions[s];if(!f)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const l=Array.isArray(f)?f[0]:f.type,d=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,R=[];let N=null,$=-1;for(const[I,j]of d){if(Array.isArray(I)&&I.length!==e.length-1)continue;R.push(I),$++,N=new Jc(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const H=[];let F=!1;for(let V=1;V<e.length;V++){const Y=e[V],oe=Array.isArray(I)?I[V-1]:I.type,ce=N.parse(Y,1+H.length,oe);if(!ce){F=!0;break}H.push(ce)}if(!F)if(Array.isArray(I)&&I.length!==H.length)N.error(`Expected ${I.length} arguments, but found ${H.length} instead.`);else{for(let V=0;V<H.length;V++){const Y=Array.isArray(I)?I[V]:I.type,oe=H[V];N.concat(V+1).checkSubtype(Y,oe.type)}if(N.errors.length===0)return new ra(s,l,j,H,$)}}if(R.length===1)i.errors.push(...N.errors);else{const I=(R.length?R:d.map(([H])=>H)).map(xu).join(" | "),j=[];for(let H=1;H<e.length;H++){const F=i.parse(e[H],1+j.length);if(!F)return null;j.push(Wi(F.type))}i.error(`Expected arguments of type ${I}, but found (${j.join(", ")}) instead.`)}return null}static register(e,i){ra.definitions=i;for(const s in i)e[s]=ra}}function xu(o){return Array.isArray(o)?`(${o.map(Wi).join(", ")})`:`(${Wi(o.type)}...)`}class wu{constructor(e,i,s){this.type=gu,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return i.error("Collator options argument must be an object.");const f=s["case-sensitive"]===void 0?i.parse(!1,1,Si):i.parseObjectValue(s["case-sensitive"],1,"case-sensitive",Si);if(!f)return null;const l=s["diacritic-sensitive"]===void 0?i.parse(!1,1,Si):i.parseObjectValue(s["diacritic-sensitive"],1,"diacritic-sensitive",Si);if(!l)return null;let d=null;return s.locale&&(d=i.parseObjectValue(s.locale,1,"locale",Ci),!d)?null:new wu(f,l,d)}evaluate(e){return new vu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Hf(o,e,i=0,s=o.length-1,f=sm){for(;s>i;){if(s-i>600){const N=s-i+1,$=e-i+1,I=Math.log(N),j=.5*Math.exp(2*I/3),H=.5*Math.sqrt(I*j*(N-j)/N)*($-N/2<0?-1:1);Hf(o,e,Math.max(i,Math.floor(e-$*j/N+H)),Math.min(s,Math.floor(e+(N-$)*j/N+H)),f)}const l=o[e];let d=i,R=s;for(yl(o,i,e),f(o[s],l)>0&&yl(o,i,s);d<R;){for(yl(o,d,R),d++,R--;f(o[d],l)<0;)d++;for(;f(o[R],l)>0;)R--}f(o[i],l)===0?yl(o,i,R):(R++,yl(o,R,s)),R<=e&&(i=R+1),e<=R&&(s=R-1)}}function yl(o,e,i){const s=o[e];o[e]=o[i],o[i]=s}function sm(o,e){return o<e?-1:o>e?1:0}function lm(o){let e=0;for(let i,s,f=0,l=o.length,d=l-1;f<l;d=f++)i=o[f],s=o[d],e+=(s.x-i.x)*(i.y+s.y);return e}function vl(o,e){o[0]=Math.min(o[0],e[0]),o[1]=Math.min(o[1],e[1]),o[2]=Math.max(o[2],e[0]),o[3]=Math.max(o[3],e[1])}function bl(o,e){return!(o[0]<=e[0]||o[2]>=e[2]||o[1]<=e[1]||o[3]>=e[3])}function qf(o,e,i){const s=o[0]-e[0],f=o[1]-e[1],l=o[0]-i[0],d=o[1]-i[1];return s*d-l*f==0&&s*l<=0&&f*d<=0}function za(o,e,i=!1){let s=!1;for(let R=0,N=e.length;R<N;R++){const $=e[R];for(let I=0,j=$.length,H=j-1;I<j;H=I++){const F=$[H],V=$[I];if(qf(o,F,V))return i;(l=F)[1]>(f=o)[1]!=(d=V)[1]>f[1]&&f[0]<(d[0]-l[0])*(f[1]-l[1])/(d[1]-l[1])+l[0]&&(s=!s)}}var f,l,d;return s}function Wf(o,e,i,s){const f=s[0]-i[0],l=s[1]-i[1],d=(o[0]-i[0])*l-f*(o[1]-i[1]),R=(e[0]-i[0])*l-f*(e[1]-i[1]);return d>0&&R<0||d<0&&R>0}function Eu(o,e,i,s){return(f=[s[0]-i[0],s[1]-i[1]])[0]*(l=[e[0]-o[0],e[1]-o[1]])[1]-f[1]*l[0]!=0&&!(!Wf(o,e,i,s)||!Wf(i,s,o,e));var f,l}const Za=8192;function um(o,e){const i=(180+o[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,f=Math.pow(2,e.z);return[Math.round(i*f*Za),Math.round(s*f*Za)]}function cm(o,e){for(let i=0;i<e.length;i++)if(za(o,e[i]))return!0;return!1}function hm(o,e,i){for(const s of i)for(let f=0,l=s.length,d=l-1;f<l;d=f++)if(Eu(o,e,s[d],s[f]))return!0;return!1}function $f(o,e){for(let i=0;i<o.length;++i)if(!za(o[i],e))return!1;for(let i=0;i<o.length-1;++i)if(hm(o[i],o[i+1],e))return!1;return!0}function Is(o,e){for(let i=0;i<e.length;i++)if($f(o,e[i]))return!0;return!1}function pi(o,e,i){const s=[];for(let f=0;f<o.length;f++){const l=[];for(let d=0;d<o[f].length;d++){const R=um(o[f][d],i);vl(e,R),l.push(R)}s.push(l)}return s}function qr(o,e,i){const s=[];for(let f=0;f<o.length;f++){const l=pi(o[f],e,i);s.push(l)}return s}function Tu(o,e,i,s){if(o[0]<i[0]||o[0]>i[2]){const f=.5*s;let l=o[0]-i[0]>f?-s:i[0]-o[0]>f?s:0;l===0&&(l=o[0]-i[2]>f?-s:i[2]-o[0]>f?s:0),o[0]+=l}vl(e,o)}function ai(o,e,i,s){const f=Math.pow(2,s.z)*Za,l=[s.x*Za,s.y*Za],d=[];if(!o)return d;for(const R of o)for(const N of R){const $=[N.x+l[0],N.y+l[1]];Tu($,e,i,f),d.push($)}return d}function Su(o,e,i,s){const f=Math.pow(2,s.z)*Za,l=[s.x*Za,s.y*Za],d=[];if(!o)return d;for(const N of o){const $=[];for(const I of N){const j=[I.x+l[0],I.y+l[1]];vl(e,j),$.push(j)}d.push($)}if(e[2]-e[0]<=f/2){(R=e)[0]=R[1]=1/0,R[2]=R[3]=-1/0;for(const N of d)for(const $ of N)Tu($,e,i,f)}var R;return d}class oo{constructor(e,i){this.type=Si,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Yo(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let f=0;f<s.features.length;++f){const l=s.features[f].geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new oo(s,s.features[f].geometry)}else if(s.type==="Feature"){const f=s.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new oo(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new oo(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,s){const f=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(s.type==="Polygon"){const R=pi(s.coordinates,l,d),N=ai(i.geometry(),f,l,d);if(!bl(f,l))return!1;for(const $ of N)if(!za($,R))return!1}if(s.type==="MultiPolygon"){const R=qr(s.coordinates,l,d),N=ai(i.geometry(),f,l,d);if(!bl(f,l))return!1;for(const $ of N)if(!cm($,R))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,s){const f=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(s.type==="Polygon"){const R=pi(s.coordinates,l,d),N=Su(i.geometry(),f,l,d);if(!bl(f,l))return!1;for(const $ of N)if(!$f($,R))return!1}if(s.type==="MultiPolygon"){const R=qr(s.coordinates,l,d),N=Su(i.geometry(),f,l,d);if(!bl(f,l))return!1;for(const $ of N)if(!Is($,R))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const ei={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Wc=1/298.257223563,Mu=Wc*(2-Wc),Ps=Math.PI/180;class Cs{static fromTile(e,i,s){const f=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),l=Math.atan(.5*(Math.exp(f)-Math.exp(-f)))/Ps;return new Cs(l,s)}static get units(){return ei}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!ei[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(ei).join(", ")}`);const s=6378.137*Ps*(i?ei[i]:1),f=Math.cos(e*Ps),l=1/(1-Mu*(1-f*f)),d=Math.sqrt(l);this.kx=s*d*f,this.ky=s*d*l*(1-Mu)}distance(e,i){const s=ia(e[0]-i[0])*this.kx,f=(e[1]-i[1])*this.ky;return Math.sqrt(s*s+f*f)}bearing(e,i){const s=ia(i[0]-e[0])*this.kx;return Math.atan2(s,(i[1]-e[1])*this.ky)/Ps}destination(e,i,s){const f=s*Ps;return this.offset(e,Math.sin(f)*i,Math.cos(f)*i)}offset(e,i,s){return[e[0]+i/this.kx,e[1]+s/this.ky]}lineDistance(e){let i=0;for(let s=0;s<e.length-1;s++)i+=this.distance(e[s],e[s+1]);return i}area(e){let i=0;for(let s=0;s<e.length;s++){const f=e[s];for(let l=0,d=f.length,R=d-1;l<d;R=l++)i+=ia(f[l][0]-f[R][0])*(f[l][1]+f[R][1])*(s?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let s=0;if(i<=0)return e[0];for(let f=0;f<e.length-1;f++){const l=e[f],d=e[f+1],R=this.distance(l,d);if(s+=R,s>i)return Ln(l,d,(i-(s-R))/R)}return e[e.length-1]}pointToSegmentDistance(e,i,s){let[f,l]=i,d=ia(s[0]-f)*this.kx,R=(s[1]-l)*this.ky;if(d!==0||R!==0){const N=(ia(e[0]-f)*this.kx*d+(e[1]-l)*this.ky*R)/(d*d+R*R);N>1?(f=s[0],l=s[1]):N>0&&(f+=d/this.kx*N,l+=R/this.ky*N)}return d=ia(e[0]-f)*this.kx,R=(e[1]-l)*this.ky,Math.sqrt(d*d+R*R)}pointOnLine(e,i){let s=1/0,f=e[0][0],l=e[0][1],d=0,R=0;for(let N=0;N<e.length-1;N++){let $=e[N][0],I=e[N][1],j=ia(e[N+1][0]-$)*this.kx,H=(e[N+1][1]-I)*this.ky,F=0;j===0&&H===0||(F=(ia(i[0]-$)*this.kx*j+(i[1]-I)*this.ky*H)/(j*j+H*H),F>1?($=e[N+1][0],I=e[N+1][1]):F>0&&($+=j/this.kx*F,I+=H/this.ky*F)),j=ia(i[0]-$)*this.kx,H=(i[1]-I)*this.ky;const V=j*j+H*H;V<s&&(s=V,f=$,l=I,d=N,R=F)}return{point:[f,l],index:d,t:Math.max(0,Math.min(1,R))}}lineSlice(e,i,s){let f=this.pointOnLine(s,e),l=this.pointOnLine(s,i);if(f.index>l.index||f.index===l.index&&f.t>l.t){const $=f;f=l,l=$}const d=[f.point],R=f.index+1,N=l.index;!xl(s[R],d[0])&&R<=N&&d.push(s[R]);for(let $=R+1;$<=N;$++)d.push(s[$]);return xl(s[N],l.point)||d.push(l.point),d}lineSliceAlong(e,i,s){let f=0;const l=[];for(let d=0;d<s.length-1;d++){const R=s[d],N=s[d+1],$=this.distance(R,N);if(f+=$,f>e&&l.length===0&&l.push(Ln(R,N,(e-(f-$))/$)),f>=i)return l.push(Ln(R,N,(i-(f-$))/$)),l;f>e&&l.push(N)}return l}bufferPoint(e,i){const s=i/this.ky,f=i/this.kx;return[e[0]-f,e[1]-s,e[0]+f,e[1]+s]}bufferBBox(e,i){const s=i/this.ky,f=i/this.kx;return[e[0]-f,e[1]-s,e[2]+f,e[3]+s]}insideBBox(e,i){return ia(e[0]-i[0])>=0&&ia(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function xl(o,e){return o[0]===e[0]&&o[1]===e[1]}function Ln(o,e,i){const s=ia(e[0]-o[0]);return[o[0]+s*i,o[1]+(e[1]-o[1])*i]}function ia(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}class Au{constructor(e=[],i=(s,f)=>s<f?-1:s>f?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:s}=this,f=i[e];for(;e>0;){const l=e-1>>1,d=i[l];if(s(f,d)>=0)break;i[e]=d,e=l}i[e]=f}_down(e){const{data:i,compare:s}=this,f=this.length>>1,l=i[e];for(;e<f;){let d=1+(e<<1);const R=d+1;if(R<this.length&&s(i[R],i[d])<0&&(d=R),s(i[d],l)>=0)break;i[e]=i[d],e=d}i[e]=l}}var wr=8192;function Iu(o,e){return e.dist-o.dist}const so=100,On=50;function Zf(o){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==o.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==o[i])return!1;return!0}function Pu(o){return o[1]-o[0]+1}function lo(o,e){const i=o[1]>=o[0]&&o[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Rs(o,e){if(o[0]>o[1])return[null,null];const i=Pu(o);if(e){if(i===2)return[o,null];const s=Math.floor(i/2);return[[o[0],o[0]+s],[o[0]+s,o[1]]]}{if(i===1)return[o,null];const s=Math.floor(i/2)-1;return[[o[0],o[0]+s],[o[0]+s+1,o[1]]]}}function Ao(o,e){const i=[1/0,1/0,-1/0,-1/0];if(!lo(e,o.length))return i;for(let s=e[0];s<=e[1];++s)vl(i,o[s]);return i}function Ds(o){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<o.length;++i)for(let s=0;s<o[i].length;++s)vl(e,o[i][s]);return e}function Ls(o,e,i){if(Zf(o)||Zf(e))return NaN;let s=0,f=0;return o[2]<e[0]&&(s=e[0]-o[2]),o[0]>e[2]&&(s=o[0]-e[2]),o[1]>e[3]&&(f=o[1]-e[3]),o[3]<e[1]&&(f=e[1]-o[3]),i.distance([0,0],[s,f])}function fm(o){return 360*o-180}function dm(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function $c(o,e){const i=Math.pow(2,e.z),s=(o.y/wr+e.y)/i;return[fm((o.x/wr+e.x)/i),dm(s)]}function Xf(o,e){const i=[];for(let s=0;s<o.length;++s)i.push($c(o[s],e));return i}function Yf(o,e,i){const s=i.pointOnLine(e,o).point;return i.distance(o,s)}function Kf(o,e,i,s,f){const l=i.slice(s[0],s[1]+1);let d=1/0;for(let R=e[0];R<=e[1];++R)if((d=Math.min(d,Yf(o[R],l,f)))===0)return 0;return d}function Cu(o,e,i,s,f){const l=Math.min(f.pointToSegmentDistance(o,i,s),f.pointToSegmentDistance(e,i,s)),d=Math.min(f.pointToSegmentDistance(i,o,e),f.pointToSegmentDistance(s,o,e));return Math.min(l,d)}function Jo(o,e,i,s,f){if(!lo(e,o.length)||!lo(s,i.length))return NaN;let l=1/0;for(let d=e[0];d<e[1];++d)for(let R=s[0];R<s[1];++R){if(Eu(o[d],o[d+1],i[R],i[R+1]))return 0;l=Math.min(l,Cu(o[d],o[d+1],i[R],i[R+1],f))}return l}function pm(o,e,i,s,f){if(!lo(e,o.length)||!lo(s,i.length))return NaN;let l=1/0;for(let d=e[0];d<=e[1];++d)for(let R=s[0];R<=s[1];++R)if((l=Math.min(l,f.distance(o[d],i[R])))===0)return l;return l}function mm(o,e,i){if(za(o,e,!0))return 0;let s=1/0;for(const f of e){const l=f.length;if(l<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(f[0]!==f[l-1]&&(s=Math.min(s,i.pointToSegmentDistance(o,f[l-1],f[0])))===0||(s=Math.min(s,Yf(o,f,i)))===0)return s}return s}function Zc(o,e,i,s){if(!lo(e,o.length))return NaN;for(let l=e[0];l<=e[1];++l)if(za(o[l],i,!0))return 0;let f=1/0;for(let l=e[0];l<e[1];++l)for(const d of i)for(let R=0,N=d.length,$=N-1;R<N;$=R++){if(Eu(o[l],o[l+1],d[$],d[R]))return 0;f=Math.min(f,Cu(o[l],o[l+1],d[$],d[R],s))}return f}function Xc(o,e){for(const i of o)for(let s=0;s<=i.length-1;++s)if(za(i[s],e,!0))return!0;return!1}function Jf(o,e,i,s=1/0){const f=Ds(o),l=Ds(e);if(s!==1/0&&Ls(f,l,i)>=s)return s;if(bl(f,l)){if(Xc(o,e))return 0}else if(Xc(e,o))return 0;let d=s;for(const R of o)for(let N=0,$=R.length,I=$-1;N<$;I=N++)for(const j of e)for(let H=0,F=j.length,V=F-1;H<F;V=H++){if(Eu(R[I],R[N],j[V],j[H]))return 0;d=Math.min(d,Cu(R[I],R[N],j[V],j[H],i))}return d}function na(o,e,i,s,f,l,d){if(l===null||d===null)return;const R=Ls(Ao(s,l),Ao(f,d),i);R<e&&o.push({dist:R,range1:l,range2:d})}function Qf(o,e,i,s,f=1/0){let l=Math.min(s.distance(o[0],i[0][0]),f);if(l===0)return l;const d=new Au([{dist:0,range1:[0,o.length-1],range2:[0,0]}],Iu),R=e?On:so,N=Ds(i);for(;d.length;){const $=d.pop();if($.dist>=l)continue;const I=$.range1;if(Pu(I)<=R){if(!lo(I,o.length))return NaN;if(e){const j=Zc(o,I,i,s);if((l=Math.min(l,j))===0)return l}else for(let j=I[0];j<=I[1];++j){const H=mm(o[j],i,s);if((l=Math.min(l,H))===0)return l}}else{const j=Rs(I,e);if(j[0]!==null){const H=Ls(Ao(o,j[0]),N,s);H<l&&d.push({dist:H,range1:j[0],range2:[0,0]})}if(j[1]!==null){const H=Ls(Ao(o,j[1]),N,s);H<l&&d.push({dist:H,range1:j[1],range2:[0,0]})}}}return l}function Yc(o,e,i,s,f,l=1/0){let d=Math.min(l,f.distance(o[0],i[0]));if(d===0)return d;const R=new Au([{dist:0,range1:[0,o.length-1],range2:[0,i.length-1]}],Iu),N=e?On:so,$=s?On:so;for(;R.length;){const I=R.pop();if(I.dist>=d)continue;const j=I.range1,H=I.range2;if(Pu(j)<=N&&Pu(H)<=$){if(!lo(j,o.length)||!lo(H,i.length))return NaN;if(e&&s?d=Math.min(d,Jo(o,j,i,H,f)):e||s?e&&!s?d=Math.min(d,Kf(i,H,o,j,f)):!e&&s&&(d=Math.min(d,Kf(o,j,i,H,f))):d=Math.min(d,pm(o,j,i,H,f)),d===0)return d}else{const F=Rs(j,e),V=Rs(H,s);na(R,d,f,o,i,F[0],V[0]),na(R,d,f,o,i,F[0],V[1]),na(R,d,f,o,i,F[1],V[0]),na(R,d,f,o,i,F[1],V[1])}}return d}function Ru(o,e,i,s,f=1/0){let l=f;const d=Ao(o,[0,o.length-1]);for(const R of i)if(!(l!==1/0&&Ls(d,Ao(R,[0,R.length-1]),s)>=l)&&(l=Math.min(l,Yc(o,e,R,!0,s,l)),l===0))return l;return l}function wl(o,e,i,s,f=1/0){let l=f;const d=Ao(o,[0,o.length-1]);for(const R of i){if(l!==1/0&&Ls(d,Ds(R),s)>=l)continue;const N=Qf(o,e,R,s,l);if(isNaN(N))return N;if((l=Math.min(l,N))===0)return l}return l}function Du(o){return o==="Point"||o==="MultiPoint"||o==="LineString"||o==="MultiLineString"||o==="Polygon"||o==="MultiPolygon"}class Io{constructor(e,i){this.type=Rr,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Yo(e[1])){const s=e[1];if(s.type==="FeatureCollection"){for(let f=0;f<s.features.length;++f)if(Du(s.features[f].geometry.type))return new Io(s,s.features[f].geometry)}else if(s.type==="Feature"){if(Du(s.geometry.type))return new Io(s,s.geometry)}else if(Du(s.type))return new Io(s,s)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),s=e.canonicalID();if(i!=null&&s!=null){if(e.geometryType()==="Point")return function(f,l,d){const R=[];for(const $ of f)for(const I of $)R.push($c(I,l));const N=new Cs(R[0][1],"meters");return d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString"?Yc(R,!1,d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",N):d.type==="MultiLineString"?Ru(R,!1,d.coordinates,N):d.type==="Polygon"||d.type==="MultiPolygon"?wl(R,!1,d.type==="Polygon"?[d.coordinates]:d.coordinates,N):null}(i,s,this.geometries);if(e.geometryType()==="LineString")return function(f,l,d){const R=[];for(const $ of f){const I=[];for(const j of $)I.push($c(j,l));R.push(I)}const N=new Cs(R[0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return Ru(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",R,N);if(d.type==="MultiLineString"){let $=1/0;for(let I=0;I<d.coordinates.length;I++){const j=Ru(d.coordinates[I],!0,R,N,$);if(isNaN(j))return j;if(($=Math.min($,j))===0)return $}return $}if(d.type==="Polygon"||d.type==="MultiPolygon"){let $=1/0;for(let I=0;I<R.length;I++){const j=wl(R[I],!0,d.type==="Polygon"?[d.coordinates]:d.coordinates,N,$);if(isNaN(j))return j;if(($=Math.min($,j))===0)return $}return $}return null}(i,s,this.geometries);if(e.geometryType()==="Polygon")return function(f,l,d){const R=[];for(const $ of function(I,j){const H=I.length;if(H<=1)return[I];const F=[];let V,Y;for(let oe=0;oe<H;oe++){const ce=lm(I[oe]);ce!==0&&(I[oe].area=Math.abs(ce),Y===void 0&&(Y=ce<0),Y===ce<0?(V&&F.push(V),V=[I[oe]]):V.push(I[oe]))}return V&&F.push(V),F}(f)){const I=[];for(let j=0;j<$.length;++j)I.push(Xf($[j],l));R.push(I)}const N=new Cs(R[0][0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return wl(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",R,N);if(d.type==="MultiLineString"){let $=1/0;for(let I=0;I<d.coordinates.length;I++){const j=wl(d.coordinates[I],!0,R,N,$);if(isNaN(j))return j;if(($=Math.min($,j))===0)return $}return $}return d.type==="Polygon"||d.type==="MultiPolygon"?function($,I,j){let H=1/0;for(const F of $)for(const V of I){const Y=Jf(F,V,j,H);if(isNaN(Y))return Y;if((H=Math.min(H,Y))===0)return H}return H}(d.type==="Polygon"?[d.coordinates]:d.coordinates,R,N):null}(i,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Lu(o,e){switch(o){case"string":return Oa(e);case"number":return+e;case"boolean":return!!e;case"color":return Mi.parse(e);case"formatted":return Nn.fromString(Oa(e));case"resolvedImage":return Mn.build(Oa(e))}return e}function Kc(o,e,i,s){return s!==void 0&&(o=s*Math.round(o/s)),e!==void 0&&o<e&&(o=e),i!==void 0&&o>i&&(o=i),o}class Qo{constructor(e,i,s){this.type=e,this.key=i,this.scope=s}static parse(e,i){let s=i.expectedType;if(s==null&&(s=xi),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const f=i.parse(e[1],1);if(!(f instanceof ba))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const l=i.parse(e[2],2);return l instanceof ba?new Qo(s,Oa(f.value),Oa(l.value)):i.error("Scope of 'config' expression must be a string literal.")}return new Qo(s,Oa(f.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),s=e.getConfig(i);if(!s)return null;const{type:f,value:l,values:d,minValue:R,maxValue:N,stepValue:$}=s,I=s.default.evaluate(e);let j=I;if(l){const H=e.scope;e.scope=(H||"").split("").slice(1).join(""),j=l.evaluate(e),e.scope=H}return f&&(j=Lu(f,j)),j===void 0||R===void 0&&N===void 0&&$===void 0||(typeof j=="number"?j=Kc(j,R,N,$):Array.isArray(j)&&(j=j.map(H=>typeof H=="number"?Kc(H,R,N,$):H))),l!==void 0&&j!==void 0&&d&&!d.includes(j)&&(j=I,f&&(j=Lu(f,j))),(f&&f!==this.type||j!==void 0&&Ji(j)!==this.type)&&(j=Lu(this.type.kind,j)),j}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Os(o){if(o instanceof ra&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof oo||o instanceof Io)return!1;let e=!0;return o.eachChild(i=>{e&&!Os(i)&&(e=!1)}),e}function El(o){if(o instanceof ra&&o.name==="feature-state")return!1;let e=!0;return o.eachChild(i=>{e&&!El(i)&&(e=!1)}),e}function es(o){if(o instanceof Qo)return new Set([o.key]);let e=new Set;return o.eachChild(i=>{e=new Set([...e,...es(i)])}),e}function uo(o,e){if(o instanceof ra&&e.indexOf(o.name)>=0)return!1;let i=!0;return o.eachChild(s=>{i&&!uo(s,e)&&(i=!1)}),i}class ts{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const s=e[1];return i.scope.has(s)?new ts(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ou{constructor(e,i=[],s,f=new qc,l=[],d,R){this.registry=e,this.path=i,this.key=i.map(N=>typeof N=="string"?`['${N}']`:`[${N}]`).join(""),this.scope=f,this.errors=l,this.expectedType=s,this._scope=d,this.options=R}parse(e,i,s,f,l={}){return i||s?this.concat(i,null,s,f)._parse(e,l):this._parse(e,l)}parseObjectValue(e,i,s,f,l,d={}){return this.concat(i,s,f,l)._parse(e,d)}_parse(e,i){function s(f,l,d){return d==="assert"?new xa(l,[f]):d==="coerce"?new ao(l,[f]):f}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(f){let l=f.parse(e,this);if(!l)return null;if(this.expectedType){const d=this.expectedType,R=l.type;if(d.kind!=="string"&&d.kind!=="number"&&d.kind!=="boolean"&&d.kind!=="object"&&d.kind!=="array"||R.kind!=="value")if(d.kind!=="color"&&d.kind!=="formatted"&&d.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string"){if(this.checkSubtype(d,R))return null}else l=s(l,d,i.typeAnnotation||"coerce");else l=s(l,d,i.typeAnnotation||"assert")}if(!(l instanceof ba)&&l.type.kind!=="resolvedImage"&&zu(l)){const d=new bu(this._scope,this.options);try{l=new ba(l.type,l.evaluate(d))}catch(R){return this.error(R.message),null}}return l}return ao.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s,f){let l=typeof e=="number"?this.path.concat(e):this.path;l=typeof i=="string"?l.concat(i):l;const d=f?this.scope.concat(f):this.scope;return new Ou(this.registry,l,s||null,d,this.errors,this._scope,this.options)}error(e,...i){const s=`${this.key}${i.map(f=>`[${f}]`).join("")}`;this.errors.push(new va(s,e))}checkSubtype(e,i){const s=ml(e,i);return s&&this.error(s),s}}var Jc=Ou;function zu(o){if(o instanceof ts)return zu(o.boundExpression);if(o instanceof ra&&o.name==="error"||o instanceof wu||o instanceof oo||o instanceof Io||o instanceof Qo)return!1;const e=o instanceof ao||o instanceof xa;let i=!0;return o.eachChild(s=>{i=e?i&&zu(s):i&&s instanceof ba}),!!i&&Os(o)&&uo(o,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function co(o,e){const i=o.length-1;let s,f,l=0,d=i,R=0;for(;l<=d;)if(R=Math.floor((l+d)/2),s=o[R],f=o[R+1],s<=e){if(R===i||e<f)return R;l=R+1}else{if(!(s>e))throw new dn("Input is not a number.");d=R-1}return 0}class gi{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[f,l]of s)this.labels.push(f),this.outputs.push(l)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(e[1],1,Rr);if(!s)return null;const f=[];let l=null;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);for(let d=1;d<e.length;d+=2){const R=d===1?-1/0:e[d],N=e[d+1],$=d,I=d+1;if(typeof R!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(f.length&&f[f.length-1][0]>=R)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',$);const j=i.parse(N,I,l);if(!j)return null;l=l||j.type,f.push([R,j])}return new gi(l,s,f)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const f=this.input.evaluate(e);if(f<=i[0])return s[0].evaluate(e);const l=i.length;return f>=i[l-1]?s[l-1].evaluate(e):s[co(i,f)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const ed=.95047,td=1.08883,rd=4/29,rs=6/29,id=3*rs*rs,Zi=rs*rs*rs,_m=Math.PI/180,gm=180/Math.PI;function Qc(o){return o>Zi?Math.pow(o,1/3):o/id+rd}function eh(o){return o>rs?o*o*o:id*(o-rd)}function th(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function rh(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function nd(o){const e=rh(o.r),i=rh(o.g),s=rh(o.b),f=Qc((.4124564*e+.3575761*i+.1804375*s)/ed),l=Qc((.2126729*e+.7151522*i+.072175*s)/1);return{l:116*l-16,a:500*(f-l),b:200*(l-Qc((.0193339*e+.119192*i+.9503041*s)/td)),alpha:o.a}}function ad(o){let e=(o.l+16)/116,i=isNaN(o.a)?e:e+o.a/500,s=isNaN(o.b)?e:e-o.b/200;return e=1*eh(e),i=ed*eh(i),s=td*eh(s),new Mi(th(3.2404542*i-1.5371385*e-.4985314*s),th(-.969266*i+1.8760108*e+.041556*s),th(.0556434*i-.2040259*e+1.0572252*s),o.alpha)}function ym(o,e,i){const s=e-o;return o+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const Tl={forward:nd,reverse:ad,interpolate:function(o,e,i){return{l:Qr(o.l,e.l,i),a:Qr(o.a,e.a,i),b:Qr(o.b,e.b,i),alpha:Qr(o.alpha,e.alpha,i)}}},Sl={forward:function(o){const{l:e,a:i,b:s}=nd(o),f=Math.atan2(s,i)*gm;return{h:f<0?f+360:f,c:Math.sqrt(i*i+s*s),l:e,alpha:o.a}},reverse:function(o){const e=o.h*_m,i=o.c;return ad({l:o.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:o.alpha})},interpolate:function(o,e,i){return{h:ym(o.h,e.h,i),c:Qr(o.c,e.c,i),l:Qr(o.l,e.l,i),alpha:Qr(o.alpha,e.alpha,i)}}};var od=Object.freeze({__proto__:null,hcl:Sl,lab:Tl});class aa{constructor(e,i,s,f,l,d){this.type=e,this.operator=i,this.interpolation=s,this.input=f,this.dynamicStops=l,this.labels=[],this.outputs=[];for(const[R,N]of d)this.labels.push(R),this.outputs.push(N)}static interpolationFactor(e,i,s,f){let l=0;if(e.name==="exponential")l=ih(i,e.base,s,f);else if(e.name==="linear")l=ih(i,1,s,f);else if(e.name==="cubic-bezier"){const d=e.controlPoints;l=new qe(d[0],d[1],d[2],d[3]).solve(ih(i,1,s,f))}return l}static parse(e,i){let[s,f,l,...d]=e;if(!Array.isArray(f)||f.length===0)return i.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const $=f[1];if(typeof $!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:$}}else{if(f[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const $=f.slice(1);if($.length!==4||$.some(I=>typeof I!="number"||I<0||I>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:$}}}if(e.length-1<3)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(l=i.parse(l,2,Rr),!l)return null;const R=[];let N=null;if(s==="interpolate-hcl"||s==="interpolate-lab"?N=ta:i.expectedType&&i.expectedType.kind!=="value"&&(N=i.expectedType),e.length-1==3){const $=i.parse(d[0],3,xi);return $?new aa(N,s,f,l,$,R):null}for(let $=0;$<d.length;$+=2){const I=d[$],j=d[$+1],H=$+3,F=$+4;if(typeof I!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(R.length&&R[R.length-1][0]>=I)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',H);const V=i.parse(j,F,N);if(!V)return null;N=N||V.type,R.push([I,V])}return N.kind==="number"||N.kind==="color"||N.kind==="array"&&N.itemType.kind==="number"&&typeof N.N=="number"?new aa(N,s,f,l,null,R):i.error(`Type ${Wi(N)} is not interpolatable.`)}evaluate(e){let i=this.labels,s=this.outputs;if(this.dynamicStops){const I=this.dynamicStops.evaluate(e);if(I.length%2!=0)throw new dn("Expected an even number of arguments.");i=[],s=[];for(let j=0;j<I.length;j+=2){const H=I[j],F=new ba(Rr,I[j+1]);if(typeof H!="number")throw new dn('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.');if(i.length&&i[i.length-1]>=H)throw new dn('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.');i.push(H),s.push(F)}if(i.length===0)throw new dn("Expected at least one input/output pair.")}if(i.length===1)return s[0].evaluate(e);const f=this.input.evaluate(e);if(f<=i[0])return s[0].evaluate(e);const l=i.length;if(f>=i[l-1])return s[l-1].evaluate(e);const d=co(i,f),R=aa.interpolationFactor(this.interpolation,f,i[d],i[d+1]),N=s[d].evaluate(e),$=s[d+1].evaluate(e);return this.operator==="interpolate"?Ti[this.type.kind.toLowerCase()](N,$,R):this.operator==="interpolate-hcl"?Sl.reverse(Sl.interpolate(Sl.forward(N),Sl.forward($),R)):Tl.reverse(Tl.interpolate(Tl.forward(N),Tl.forward($),R))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];if(this.dynamicStops)i.push(this.dynamicStops.serialize());else for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function ih(o,e,i,s){const f=s-i,l=o-i;return f===0?0:e===1?l/f:(Math.pow(e,l)-1)/(Math.pow(e,f)-1)}class ku{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let s=null;const f=i.expectedType;f&&f.kind!=="value"&&(s=f);const l=[];for(const R of e.slice(1)){const N=i.parse(R,1+l.length,s,void 0,{typeAnnotation:"omit"});if(!N)return null;s=s||N.type,l.push(N)}const d=f&&l.some(R=>ml(f,R.type));return new ku(d?xi:s,l)}evaluate(e){let i,s=null,f=0;for(const l of this.args){if(f++,s=l.evaluate(e),s&&s instanceof Mn&&!s.available&&(i||(i=s),s=null,f===this.args.length))return i;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Bu{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let l=1;l<e.length-1;l+=2){const d=e[l];if(typeof d!="string")return i.error(`Expected string, but found ${typeof d} instead.`,l);if(/[^a-zA-Z0-9_]/.test(d))return i.error("Variable names must contain only alphanumeric characters or '_'.",l);const R=i.parse(e[l+1],l+1);if(!R)return null;s.push([d,R])}const f=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return f?new Bu(s,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,s]of this.bindings)e.push(i,s.serialize());return e.push(this.result.serialize()),e}}class nh{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Rr),f=i.parse(e[2],2,Fn(i.expectedType||xi));return s&&f?new nh(f.type.itemType,s,f):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new dn(`Array index out of bounds: ${i} < 0.`);if(i>s.length-1)throw new dn(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i===Math.floor(i))return s[i];const f=Math.floor(i),l=Math.ceil(i),d=s[f],R=s[l];if(typeof d!="number"||typeof R!="number")throw new dn(`Cannot interpolate between non-number values at index ${i}.`);const N=i-f;return d*(1-N)+R*N}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class ah{constructor(e,i){this.type=Si,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,xi),f=i.parse(e[2],2,xi);return s&&f?yu(s.type,[Si,Ci,Rr,Ss,xi])?new ah(s,f):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(s.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!Ms(i,["boolean","string","number","null"]))throw new dn(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(Ji(i))} instead.`);if(!Ms(s,["string","array"]))throw new dn(`Expected second argument to be of type array or string, but found ${Wi(Ji(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Fu{constructor(e,i,s){this.type=Rr,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,xi),f=i.parse(e[2],2,xi);if(!s||!f)return null;if(!yu(s.type,[Si,Ci,Rr,Ss,xi]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(s.type)} instead`);if(e.length===4){const l=i.parse(e[3],3,Rr);return l?new Fu(s,f,l):null}return new Fu(s,f)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Ms(i,["boolean","string","number","null"]))throw new dn(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(Ji(i))} instead.`);if(!Ms(s,["string","array"]))throw new dn(`Expected second argument to be of type array or string, but found ${Wi(Ji(s))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(e);return s.indexOf(i,f)}return s.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class oh{constructor(e,i,s,f,l,d){this.inputType=e,this.type=i,this.input=s,this.cases=f,this.outputs=l,this.otherwise=d}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let s,f;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);const l={},d=[];for(let $=2;$<e.length-1;$+=2){let I=e[$];const j=e[$+1];Array.isArray(I)||(I=[I]);const H=i.concat($);if(I.length===0)return H.error("Expected at least one branch label.");for(const V of I){if(typeof V!="number"&&typeof V!="string")return H.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return H.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return H.error("Numeric branch labels must be integer values.");if(s){if(H.checkSubtype(s,Ji(V)))return null}else s=Ji(V);if(l[String(V)]!==void 0)return H.error("Branch labels must be unique.");l[String(V)]=d.length}const F=i.parse(j,$,f);if(!F)return null;f=f||F.type,d.push(F)}const R=i.parse(e[1],1,xi);if(!R)return null;const N=i.parse(e[e.length-1],e.length-1,f);return N?R.type.kind!=="value"&&i.concat(1).checkSubtype(s,R.type)?null:new oh(s,f,R,l,d,N):null}evaluate(e){const i=this.input.evaluate(e);return(Ji(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],f={};for(const d of i){const R=f[this.cases[d]];R===void 0?(f[this.cases[d]]=s.length,s.push([this.cases[d],[d]])):s[R][1].push(d)}const l=d=>this.inputType.kind==="number"?Number(d):d;for(const[d,R]of s)e.push(R.length===1?l(R[0]):R.map(l)),e.push(this.outputs[d].serialize());return e.push(this.otherwise.serialize()),e}}class sh{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);const f=[];for(let d=1;d<e.length-1;d+=2){const R=i.parse(e[d],d,Si);if(!R)return null;const N=i.parse(e[d+1],d+1,s);if(!N)return null;f.push([R,N]),s=s||N.type}const l=i.parse(e[e.length-1],e.length-1,s);return l?new sh(s,f,l):null}evaluate(e){for(const[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Nu{constructor(e,i,s,f){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=f}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,xi),f=i.parse(e[2],2,Rr);if(!s||!f)return null;if(!yu(s.type,[Fn(xi),Ci,xi]))return i.error(`Expected first argument to be of type array or string, but found ${Wi(s.type)} instead`);if(e.length===4){const l=i.parse(e[3],3,Rr);return l?new Nu(s.type,s,f,l):null}return new Nu(s.type,s,f)}evaluate(e){const i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Ms(i,["string","array"]))throw new dn(`Expected first argument to be of type array or string, but found ${Wi(Ji(i))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(e);return i.slice(s,f)}return i.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function sd(o,e){return o==="=="||o==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ld(o,e,i,s){return s.compare(e,i)===0}function zs(o,e,i){const s=o!=="=="&&o!=="!=";return class VE{constructor(l,d,R){this.type=Si,this.lhs=l,this.rhs=d,this.collator=R,this.hasUntypedArgument=l.type.kind==="value"||d.type.kind==="value"}static parse(l,d){if(l.length!==3&&l.length!==4)return d.error("Expected two or three arguments.");const R=l[0];let N=d.parse(l[1],1,xi);if(!N)return null;if(!sd(R,N.type))return d.concat(1).error(`"${R}" comparisons are not supported for type '${Wi(N.type)}'.`);let $=d.parse(l[2],2,xi);if(!$)return null;if(!sd(R,$.type))return d.concat(2).error(`"${R}" comparisons are not supported for type '${Wi($.type)}'.`);if(N.type.kind!==$.type.kind&&N.type.kind!=="value"&&$.type.kind!=="value")return d.error(`Cannot compare types '${Wi(N.type)}' and '${Wi($.type)}'.`);s&&(N.type.kind==="value"&&$.type.kind!=="value"?N=new xa($.type,[N]):N.type.kind!=="value"&&$.type.kind==="value"&&($=new xa(N.type,[$])));let I=null;if(l.length===4){if(N.type.kind!=="string"&&$.type.kind!=="string"&&N.type.kind!=="value"&&$.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(I=d.parse(l[3],3,gu),!I)return null}return new VE(N,$,I)}evaluate(l){const d=this.lhs.evaluate(l),R=this.rhs.evaluate(l);if(s&&this.hasUntypedArgument){const N=Ji(d),$=Ji(R);if(N.kind!==$.kind||N.kind!=="string"&&N.kind!=="number")throw new dn(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${N.kind}, ${$.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const N=Ji(d),$=Ji(R);if(N.kind!=="string"||$.kind!=="string")return e(l,d,R)}return this.collator?i(l,d,R,this.collator.evaluate(l)):e(l,d,R)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}serialize(){const l=[o];return this.eachChild(d=>{l.push(d.serialize())}),l}}}const vm=zs("==",function(o,e,i){return e===i},ld),bm=zs("!=",function(o,e,i){return e!==i},function(o,e,i,s){return!ld(0,e,i,s)}),xm=zs("<",function(o,e,i){return e<i},function(o,e,i,s){return s.compare(e,i)<0}),wm=zs(">",function(o,e,i){return e>i},function(o,e,i,s){return s.compare(e,i)>0}),Em=zs("<=",function(o,e,i){return e<=i},function(o,e,i,s){return s.compare(e,i)<=0}),Tm=zs(">=",function(o,e,i){return e>=i},function(o,e,i,s){return s.compare(e,i)>=0});class Ml{constructor(e,i,s,f,l,d){this.type=Ci,this.number=e,this.locale=i,this.currency=s,this.unit=f,this.minFractionDigits=l,this.maxFractionDigits=d}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const s=i.parse(e[1],1,Rr);if(!s)return null;const f=e[2];if(typeof f!="object"||Array.isArray(f))return i.error("NumberFormat options argument must be an object.");let l=null;if(f.locale&&(l=i.parseObjectValue(f.locale,2,"locale",Ci),!l))return null;let d=null;if(f.currency&&(d=i.parseObjectValue(f.currency,2,"currency",Ci),!d))return null;let R=null;if(f.unit&&(R=i.parseObjectValue(f.unit,2,"unit",Ci),!R))return null;let N=null;if(f["min-fraction-digits"]&&(N=i.parseObjectValue(f["min-fraction-digits"],2,"min-fraction-digits",Rr),!N))return null;let $=null;return f["max-fraction-digits"]&&($=i.parseObjectValue(f["max-fraction-digits"],2,"max-fraction-digits",Rr),!$)?null:new Ml(s,l,d,R,N,$)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class lh{constructor(e){this.type=Rr,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=i.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Wi(s.type)} instead.`):new lh(s):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new dn(`Expected value to be of type string or array, but found ${Wi(Ji(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function uh(o){return function(){o=1831565813+(o|=0)|0;let e=Math.imul(o^o>>>15,1|o);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const ks={"==":vm,"!=":bm,">":wm,"<":xm,">=":Tm,"<=":Em,array:xa,at:nh,boolean:xa,case:sh,coalesce:ku,collator:wu,format:no,image:As,in:ah,"index-of":Fu,interpolate:aa,"interpolate-hcl":aa,"interpolate-lab":aa,length:lh,let:Bu,literal:ba,match:oh,number:xa,"number-format":Ml,object:xa,slice:Nu,step:gi,string:xa,"to-boolean":ao,"to-color":ao,"to-number":ao,"to-string":ao,var:ts,within:oo,distance:Io,config:Qo};function ud(o,[e,i,s,f]){e=e.evaluate(o),i=i.evaluate(o),s=s.evaluate(o);const l=f?f.evaluate(o):1,d=Xo(e,i,s,l);if(d)throw new dn(d);return new Mi(e/255*l,i/255*l,s/255*l,l)}function cd(o,[e,i,s,f]){e=e.evaluate(o),i=i.evaluate(o),s=s.evaluate(o);const l=f?f.evaluate(o):1,d=function($,I,j,H){return typeof $=="number"&&$>=0&&$<=360?typeof I=="number"&&I>=0&&I<=100&&typeof j=="number"&&j>=0&&j<=100?H===void 0||typeof H=="number"&&H>=0&&H<=1?null:`Invalid hsla value [${[$,I,j,H].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof H=="number"?[$,I,j,H]:[$,I,j]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof H=="number"?[$,I,j,H]:[$,I,j]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,s,l);if(d)throw new dn(d);const R=`hsla(${e}, ${i}%, ${s}%, ${l})`,N=Mi.parse(R);if(!N)throw new dn(`Failed to parse HSLA color: ${R}`);return N}function ch(o,e){return o in e}function Uu(o,e){const i=e[o];return i===void 0?null:i}function wa(o){return{type:o}}function hh(o){return{result:"success",value:o}}function ho(o){return{result:"error",value:o}}function fh(o,e){return!!o&&!!o.parameters&&o.parameters.indexOf(e)>-1}function Bs(o){return o["property-type"]==="data-driven"}function ju(o){return fh(o.expression,"measure-light")}function hd(o){return fh(o.expression,"zoom")}function dh(o){return!!o.expression&&o.expression.interpolated}function Vu(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function fd(o){return o}function dd(o,e){const i=e.type==="color",s=o.stops&&typeof o.stops[0][0]=="object",f=s||!(s||o.property!==void 0),l=o.type||(dh(e)?"exponential":"interval");if(i&&((o=_u({},o)).stops&&(o.stops=o.stops.map($=>[$[0],Mi.parse($[1])])),o.default=Mi.parse(o.default?o.default:e.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!od[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let d,R,N;if(l==="exponential")d=ph;else if(l==="interval")d=pd;else if(l==="categorical"){d=Sm,R=Object.create(null);for(const $ of o.stops)R[$[0]]=$[1];N=typeof o.stops[0][0]}else{if(l!=="identity")throw new Error(`Unknown function type "${l}"`);d=Gu}if(s){const $={},I=[];for(let F=0;F<o.stops.length;F++){const V=o.stops[F],Y=V[0].zoom;$[Y]===void 0&&($[Y]={zoom:Y,type:o.type,property:o.property,default:o.default,stops:[]},I.push(Y)),$[Y].stops.push([V[0].value,V[1]])}const j=[];for(const F of I)j.push([$[F].zoom,dd($[F],e)]);const H={name:"linear"};return{kind:"composite",interpolationType:H,interpolationFactor:aa.interpolationFactor.bind(void 0,H),zoomStops:j.map(F=>F[0]),evaluate:({zoom:F},V)=>ph({stops:j,base:o.base},e,F).evaluate(F,V)}}if(f){const $=l==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:$,interpolationFactor:aa.interpolationFactor.bind(void 0,$),zoomStops:o.stops.map(I=>I[0]),evaluate:({zoom:I})=>d(o,e,I,R,N)}}return{kind:"source",evaluate($,I){const j=I&&I.properties?I.properties[o.property]:void 0;return j===void 0?Al(o.default,e.default):d(o,e,j,R,N)}}}function Al(o,e,i){return o!==void 0?o:e!==void 0?e:i!==void 0?i:void 0}function Sm(o,e,i,s,f){return Al(typeof i===f?s[i]:void 0,o.default,e.default)}function pd(o,e,i){if(Ko(i)!=="number")return Al(o.default,e.default);const s=o.stops.length;if(s===1||i<=o.stops[0][0])return o.stops[0][1];if(i>=o.stops[s-1][0])return o.stops[s-1][1];const f=co(o.stops.map(l=>l[0]),i);return o.stops[f][1]}function ph(o,e,i){const s=o.base!==void 0?o.base:1;if(Ko(i)!=="number")return Al(o.default,e.default);const f=o.stops.length;if(f===1||i<=o.stops[0][0])return o.stops[0][1];if(i>=o.stops[f-1][0])return o.stops[f-1][1];const l=co(o.stops.map(I=>I[0]),i),d=function(I,j,H,F){const V=F-H,Y=I-H;return V===0?0:j===1?Y/V:(Math.pow(j,Y)-1)/(Math.pow(j,V)-1)}(i,s,o.stops[l][0],o.stops[l+1][0]),R=o.stops[l][1],N=o.stops[l+1][1];let $=Ti[e.type]||fd;if(o.colorSpace&&o.colorSpace!=="rgb"){const I=od[o.colorSpace];$=(j,H)=>I.reverse(I.interpolate(I.forward(j),I.forward(H),d))}return typeof R.evaluate=="function"?{evaluate(...I){const j=R.evaluate.apply(void 0,I),H=N.evaluate.apply(void 0,I);if(j!==void 0&&H!==void 0)return $(j,H,d)}}:$(R,N,d)}function Gu(o,e,i){return e.type==="color"?i=Mi.parse(i):e.type==="formatted"?i=Nn.fromString(i.toString()):e.type==="resolvedImage"?i=Mn.build(i.toString()):Ko(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Al(i,o.default,e.default)}ra.register(ks,{error:[{kind:"error"},[Ci],(o,[e])=>{throw new dn(e.evaluate(o))}],typeof:[Ci,[xi],(o,[e])=>Wi(Ji(e.evaluate(o)))],"to-rgba":[Fn(Rr,4),[ta],(o,[e])=>e.evaluate(o).toRenderColor(null).toArray()],"to-hsla":[Fn(Rr,4),[ta],(o,[e])=>e.evaluate(o).toRenderColor(null).toHslaArray()],rgb:[ta,[Rr,Rr,Rr],ud],rgba:[ta,[Rr,Rr,Rr,Rr],ud],hsl:[ta,[Rr,Rr,Rr],cd],hsla:[ta,[Rr,Rr,Rr,Rr],cd],has:{type:Si,overloads:[[[Ci],(o,[e])=>ch(e.evaluate(o),o.properties())],[[Ci,$o],(o,[e,i])=>ch(e.evaluate(o),i.evaluate(o))]]},get:{type:xi,overloads:[[[Ci],(o,[e])=>Uu(e.evaluate(o),o.properties())],[[Ci,$o],(o,[e,i])=>Uu(e.evaluate(o),i.evaluate(o))]]},"feature-state":[xi,[Ci],(o,[e])=>Uu(e.evaluate(o),o.featureState||{})],properties:[$o,[],o=>o.properties()],"geometry-type":[Ci,[],o=>o.geometryType()],id:[xi,[],o=>o.id()],zoom:[Rr,[],o=>o.globals.zoom],pitch:[Rr,[],o=>o.globals.pitch||0],"distance-from-center":[Rr,[],o=>o.distanceFromCenter()],"measure-light":[Rr,[Ci],(o,[e])=>o.measureLight(e.evaluate(o))],"heatmap-density":[Rr,[],o=>o.globals.heatmapDensity||0],"line-progress":[Rr,[],o=>o.globals.lineProgress||0],"raster-value":[Rr,[],o=>o.globals.rasterValue||0],"raster-particle-speed":[Rr,[],o=>o.globals.rasterParticleSpeed||0],"sky-radial-progress":[Rr,[],o=>o.globals.skyRadialProgress||0],accumulated:[xi,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[Rr,wa(Rr),(o,e)=>{let i=0;for(const s of e)i+=s.evaluate(o);return i}],"*":[Rr,wa(Rr),(o,e)=>{let i=1;for(const s of e)i*=s.evaluate(o);return i}],"-":{type:Rr,overloads:[[[Rr,Rr],(o,[e,i])=>e.evaluate(o)-i.evaluate(o)],[[Rr],(o,[e])=>-e.evaluate(o)]]},"/":[Rr,[Rr,Rr],(o,[e,i])=>e.evaluate(o)/i.evaluate(o)],"%":[Rr,[Rr,Rr],(o,[e,i])=>e.evaluate(o)%i.evaluate(o)],ln2:[Rr,[],()=>Math.LN2],pi:[Rr,[],()=>Math.PI],e:[Rr,[],()=>Math.E],"^":[Rr,[Rr,Rr],(o,[e,i])=>Math.pow(e.evaluate(o),i.evaluate(o))],sqrt:[Rr,[Rr],(o,[e])=>Math.sqrt(e.evaluate(o))],log10:[Rr,[Rr],(o,[e])=>Math.log(e.evaluate(o))/Math.LN10],ln:[Rr,[Rr],(o,[e])=>Math.log(e.evaluate(o))],log2:[Rr,[Rr],(o,[e])=>Math.log(e.evaluate(o))/Math.LN2],sin:[Rr,[Rr],(o,[e])=>Math.sin(e.evaluate(o))],cos:[Rr,[Rr],(o,[e])=>Math.cos(e.evaluate(o))],tan:[Rr,[Rr],(o,[e])=>Math.tan(e.evaluate(o))],asin:[Rr,[Rr],(o,[e])=>Math.asin(e.evaluate(o))],acos:[Rr,[Rr],(o,[e])=>Math.acos(e.evaluate(o))],atan:[Rr,[Rr],(o,[e])=>Math.atan(e.evaluate(o))],min:[Rr,wa(Rr),(o,e)=>Math.min(...e.map(i=>i.evaluate(o)))],max:[Rr,wa(Rr),(o,e)=>Math.max(...e.map(i=>i.evaluate(o)))],abs:[Rr,[Rr],(o,[e])=>Math.abs(e.evaluate(o))],round:[Rr,[Rr],(o,[e])=>{const i=e.evaluate(o);return i<0?-Math.round(-i):Math.round(i)}],floor:[Rr,[Rr],(o,[e])=>Math.floor(e.evaluate(o))],ceil:[Rr,[Rr],(o,[e])=>Math.ceil(e.evaluate(o))],"filter-==":[Si,[Ci,xi],(o,[e,i])=>o.properties()[e.value]===i.value],"filter-id-==":[Si,[xi],(o,[e])=>o.id()===e.value],"filter-type-==":[Si,[Ci],(o,[e])=>o.geometryType()===e.value],"filter-<":[Si,[Ci,xi],(o,[e,i])=>{const s=o.properties()[e.value],f=i.value;return typeof s==typeof f&&s<f}],"filter-id-<":[Si,[xi],(o,[e])=>{const i=o.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[Si,[Ci,xi],(o,[e,i])=>{const s=o.properties()[e.value],f=i.value;return typeof s==typeof f&&s>f}],"filter-id->":[Si,[xi],(o,[e])=>{const i=o.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[Si,[Ci,xi],(o,[e,i])=>{const s=o.properties()[e.value],f=i.value;return typeof s==typeof f&&s<=f}],"filter-id-<=":[Si,[xi],(o,[e])=>{const i=o.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[Si,[Ci,xi],(o,[e,i])=>{const s=o.properties()[e.value],f=i.value;return typeof s==typeof f&&s>=f}],"filter-id->=":[Si,[xi],(o,[e])=>{const i=o.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[Si,[xi],(o,[e])=>e.value in o.properties()],"filter-has-id":[Si,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[Si,[Fn(Ci)],(o,[e])=>e.value.indexOf(o.geometryType())>=0],"filter-id-in":[Si,[Fn(xi)],(o,[e])=>e.value.indexOf(o.id())>=0],"filter-in-small":[Si,[Ci,Fn(xi)],(o,[e,i])=>i.value.indexOf(o.properties()[e.value])>=0],"filter-in-large":[Si,[Ci,Fn(xi)],(o,[e,i])=>function(s,f,l,d){for(;l<=d;){const R=l+d>>1;if(f[R]===s)return!0;f[R]>s?d=R-1:l=R+1}return!1}(o.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Si,overloads:[[[Si,Si],(o,[e,i])=>e.evaluate(o)&&i.evaluate(o)],[wa(Si),(o,e)=>{for(const i of e)if(!i.evaluate(o))return!1;return!0}]]},any:{type:Si,overloads:[[[Si,Si],(o,[e,i])=>e.evaluate(o)||i.evaluate(o)],[wa(Si),(o,e)=>{for(const i of e)if(i.evaluate(o))return!0;return!1}]]},"!":[Si,[Si],(o,[e])=>!e.evaluate(o)],"is-supported-script":[Si,[Ci],(o,[e])=>{const i=o.globals&&o.globals.isSupportedScript;return!i||i(e.evaluate(o))}],upcase:[Ci,[Ci],(o,[e])=>e.evaluate(o).toUpperCase()],downcase:[Ci,[Ci],(o,[e])=>e.evaluate(o).toLowerCase()],concat:[Ci,wa(xi),(o,e)=>e.map(i=>Oa(i.evaluate(o))).join("")],"resolved-locale":[Ci,[gu],(o,[e])=>e.evaluate(o).resolvedLocale()],random:[Rr,[Rr,Rr,xi],(o,e)=>{const[i,s,f]=e.map(d=>d.evaluate(o));if(i>s||i===s)return i;let l;if(typeof f=="string")l=function(d){let R=0;if(d.length===0)return R;for(let N=0;N<d.length;N++)R=(R<<5)-R+d.charCodeAt(N),R|=0;return R}(f);else{if(typeof f!="number")throw new dn(`Invalid seed input: ${f}`);l=f}return i+uh(l)()*(s-i)}]});class mh{constructor(e,i,s,f){this.expression=e,this._warningHistory={},this._evaluator=new bu(s,f),this._defaultValue=i?function(l){return l.type==="color"&&(Vu(l.default)||Array.isArray(l.default))?new Mi(0,0,0,0):l.type==="color"?Mi.parse(l.default)||null:l.default===void 0?null:l.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=es(e)}evaluateWithoutErrorHandling(e,i,s,f,l,d,R,N){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=f||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=R||null,this._evaluator.featureDistanceData=N||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,f,l,d,R,N){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=R||null,this._evaluator.featureDistanceData=N||null;try{const $=this.expression.evaluate(this._evaluator);if($==null||typeof $=="number"&&$!=$)return this._defaultValue;if(this._enumValues&&!($ in this._enumValues))throw new dn(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify($)} instead.`);return $}catch($){return this._warningHistory[$.message]||(this._warningHistory[$.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${$.message}`)),this._defaultValue}}}function Hu(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in ks}function Il(o,e,i,s){const f=new Jc(ks,[],e?function(d){const R={color:ta,string:Ci,number:Rr,enum:Ci,boolean:Si,formatted:io,resolvedImage:Zo};return d.type==="array"?Fn(R[d.value]||xi,d.length):R[d.type]}(e):void 0,void 0,void 0,i,s),l=f.parse(o,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?hh(new mh(l,e,i,s)):ho(f.errors)}class _h{constructor(e,i,s,f){this.kind=e,this._styleExpression=i,this.isLightConstant=s,this.isLineProgressConstant=f,this.isStateDependent=e!=="constant"&&!El(i.expression),this.configDependencies=es(i.expression)}evaluateWithoutErrorHandling(e,i,s,f,l,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,f,l,d)}evaluate(e,i,s,f,l,d){return this._styleExpression.evaluate(e,i,s,f,l,d)}}class Fs{constructor(e,i,s,f,l,d){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!El(i.expression),this.isLightConstant=l,this.isLineProgressConstant=d,this.configDependencies=es(i.expression),this.interpolationType=f}evaluateWithoutErrorHandling(e,i,s,f,l,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,f,l,d)}evaluate(e,i,s,f,l,d){return this._styleExpression.evaluate(e,i,s,f,l,d)}interpolationFactor(e,i,s){return this.interpolationType?aa.interpolationFactor(this.interpolationType,e,i,s):0}}function gh(o,e,i,s){if((o=Il(o,e,i,s)).result==="error")return o;const f=o.value.expression,l=Os(f);if(!l&&!Bs(e))return ho([new va("","data expressions not supported")]);const d=uo(f,["zoom","pitch","distance-from-center"]);if(!d&&!hd(e))return ho([new va("","zoom expressions not supported")]);const R=uo(f,["measure-light"]);if(!R&&!ju(e))return ho([new va("","measure-light expression not supported")]);const N=uo(f,["line-progress"]);if(!N&&!function(j){return fh(j.expression,"line-progress")}(e))return ho([new va("","line-progress expression not supported")]);const $=e.expression&&e.expression.relaxZoomRestriction,I=Wu(f);return I||d||$?I instanceof va?ho([I]):I instanceof aa&&!dh(e)?ho([new va("",'"interpolate" expressions cannot be used with this property')]):hh(I?new Fs(l&&N?"camera":"composite",o.value,I.labels,I instanceof aa?I.interpolation:void 0,R,N):new _h(l&&N?"constant":"source",o.value,R,N)):ho([new va("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class qu{constructor(e,i){this._parameters=e,this._specification=i,_u(this,dd(this._parameters,this._specification))}static deserialize(e){return new qu(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Wu(o){let e=null;if(o instanceof Bu)e=Wu(o.result);else if(o instanceof ku){for(const i of o.args)if(e=Wu(i),e)break}else(o instanceof gi||o instanceof aa)&&o.input instanceof ra&&o.input.name==="zoom"&&(e=o);return e instanceof va||o.eachChild(i=>{const s=Wu(i);s instanceof va?e=s:e&&s&&e!==s&&(e=new va("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var yh,vh,Mm=function(){if(vh)return yh;vh=1,yh=e;var o=3;function e(i,s,f){var l=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var d=new Int32Array(this.arrayBuffer);i=d[0],this.d=(s=d[1])+2*(f=d[2]);for(var R=0;R<this.d*this.d;R++){var N=d[o+R],$=d[o+R+1];l.push(N===$?null:d.subarray(N,$))}var I=d[o+l.length+1];this.keys=d.subarray(d[o+l.length],I),this.bboxes=d.subarray(I),this.insert=this._insertReadonly}else{this.d=s+2*f;for(var j=0;j<this.d*this.d;j++)l.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=i,this.padding=f,this.scale=s/i,this.uid=0;var H=f/s*i;this.min=-H,this.max=i+H}return e.prototype.insert=function(i,s,f,l,d){this._forEachCell(s,f,l,d,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(s),this.bboxes.push(f),this.bboxes.push(l),this.bboxes.push(d)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,s,f,l,d,R){this.cells[d].push(R)},e.prototype.query=function(i,s,f,l,d){var R=this.min,N=this.max;if(i<=R&&s<=R&&N<=f&&N<=l&&!d)return Array.prototype.slice.call(this.keys);var $=[];return this._forEachCell(i,s,f,l,this._queryCell,$,{},d),$},e.prototype._queryCell=function(i,s,f,l,d,R,N,$){var I=this.cells[d];if(I!==null)for(var j=this.keys,H=this.bboxes,F=0;F<I.length;F++){var V=I[F];if(N[V]===void 0){var Y=4*V;($?$(H[Y+0],H[Y+1],H[Y+2],H[Y+3]):i<=H[Y+2]&&s<=H[Y+3]&&f>=H[Y+0]&&l>=H[Y+1])?(N[V]=!0,R.push(j[V])):N[V]=!1}}},e.prototype._forEachCell=function(i,s,f,l,d,R,N,$){for(var I=this._convertToCellCoord(i),j=this._convertToCellCoord(s),H=this._convertToCellCoord(f),F=this._convertToCellCoord(l),V=I;V<=H;V++)for(var Y=j;Y<=F;Y++){var oe=this.d*Y+V;if((!$||$(this._convertFromCellCoord(V),this._convertFromCellCoord(Y),this._convertFromCellCoord(V+1),this._convertFromCellCoord(Y+1)))&&d.call(this,i,s,f,l,oe,R,N,$))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,s=o+this.cells.length+1+1,f=0,l=0;l<this.cells.length;l++)f+=this.cells[l].length;var d=new Int32Array(s+f+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var R=s,N=0;N<i.length;N++){var $=i[N];d[o+N]=R,d.set($,R),R+=$.length}return d[o+i.length]=R,d.set(this.keys,R),d[o+i.length+1]=R+=this.keys.length,d.set(this.bboxes,R),R+=this.bboxes.length,d.buffer},yh}(),Ns=S(Mm);const Pl={};function Dr(o,e,i={}){Object.defineProperty(o,"_classRegistryKey",{value:e,writable:!1}),Pl[e]={klass:o,omit:i.omit||[]}}Dr(Object,"Object"),Ns.serialize=function(o,e){const i=o.toArrayBuffer();return e&&e.add(i),{buffer:i}},Ns.deserialize=function(o){return new Ns(o.buffer)},Object.defineProperty(Ns,"name",{value:"Grid"}),Dr(Ns,"Grid"),typeof DOMMatrix<"u"&&Dr(DOMMatrix,"DOMMatrix"),Dr(Mi,"Color"),Dr(Error,"Error"),Dr(Nn,"Formatted"),Dr(_l,"FormattedSection"),Dr(Ca,"AJAXError"),Dr(Mn,"ResolvedImage"),Dr(qu,"StylePropertyFunction"),Dr(mh,"StyleExpression",{omit:["_evaluator"]}),Dr($a,"ImageIdWithOptions"),Dr(Fs,"ZoomDependentExpression"),Dr(_h,"ZoomConstantExpression"),Dr(ra,"CompoundExpression",{omit:["_evaluate"]});for(const o in ks)Pl[ks[o]._classRegistryKey]||Dr(ks[o],`Expression${o}`);function bh(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function md(o){return self.ImageBitmap&&o instanceof ImageBitmap}function Ea(o,e){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(bh(o)||md(o))return e&&e.add(o),o;if(ArrayBuffer.isView(o))return e&&e.add(o.buffer),o;if(o instanceof ImageData)return e&&e.add(o.data.buffer),o;if(Array.isArray(o)){const i=[];for(const s of o)i.push(Ea(s,e));return i}if(o instanceof Map){const i={$name:"Map"};for(const[s,f]of o.entries())i[s]=Ea(f);return i}if(o instanceof Set){const i={$name:"Set"};let s=0;for(const f of o.values())i[++s]=Ea(f);return i}if(typeof o=="object"){const i=o.constructor,s=i._classRegistryKey;if(!s)throw new Error(`Can't serialize object of unregistered class "${s}".`);const f=i.serialize?i.serialize(o,e):{};if(!i.serialize){for(const l in o)o.hasOwnProperty(l)&&(Pl[s].omit.indexOf(l)>=0||(f[l]=Ea(o[l],e)));o instanceof Error&&(f.message=o.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(f.$name=s),f}throw new Error("can't serialize object of type "+typeof o)}function is(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||bh(o)||md(o)||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(is);if(typeof o=="object"){const e=o.$name||"Object";if(e==="Map"){const f=new Map;for(const l of Object.keys(o))l!=="$name"&&f.set(l,is(o[l]));return f}if(e==="Set"){const f=new Set;for(const l of Object.keys(o))l!=="$name"&&f.add(is(o[l]));return f}const{klass:i}=Pl[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(o);const s=Object.create(i.prototype);for(const f of Object.keys(o))f!=="$name"&&(s[f]=is(o[f]));return s}throw new Error("can't deserialize object of type "+typeof o)}const jr={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519,Osage:o=>o>=66736&&o<=66815,"CJK Unified Ideographs Extension B":o=>o>=131072&&o<=173791};function xh(o){for(const e of o)if($u(e.charCodeAt(0)))return!0;return!1}function _d(o){for(const e of o)if(!gd(e.charCodeAt(0)))return!1;return!0}function gd(o){return!(jr.Arabic(o)||jr["Arabic Supplement"](o)||jr["Arabic Extended-A"](o)||jr["Arabic Presentation Forms-A"](o)||jr["Arabic Presentation Forms-B"](o))}function $u(o){return!(o!==746&&o!==747&&(o<4352||!(jr["Bopomofo Extended"](o)||jr.Bopomofo(o)||jr["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||jr["CJK Compatibility Ideographs"](o)||jr["CJK Compatibility"](o)||jr["CJK Radicals Supplement"](o)||jr["CJK Strokes"](o)||!(!jr["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||jr["CJK Unified Ideographs Extension A"](o)||jr["CJK Unified Ideographs"](o)||jr["Enclosed CJK Letters and Months"](o)||jr["Hangul Compatibility Jamo"](o)||jr["Hangul Jamo Extended-A"](o)||jr["Hangul Jamo Extended-B"](o)||jr["Hangul Jamo"](o)||jr["Hangul Syllables"](o)||jr.Hiragana(o)||jr["Ideographic Description Characters"](o)||jr.Kanbun(o)||jr["Kangxi Radicals"](o)||jr["Katakana Phonetic Extensions"](o)||jr.Katakana(o)&&o!==12540||!(!jr["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!jr["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||jr["Unified Canadian Aboriginal Syllabics"](o)||jr["Unified Canadian Aboriginal Syllabics Extended"](o)||jr["Vertical Forms"](o)||jr["Yijing Hexagram Symbols"](o)||jr["Yi Syllables"](o)||jr["Yi Radicals"](o))))}function wh(o){return!($u(o)||function(e){return!!(jr["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||jr["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||jr["Letterlike Symbols"](e)||jr["Number Forms"](e)||jr["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||jr["Control Pictures"](e)&&e!==9251||jr["Optical Character Recognition"](e)||jr["Enclosed Alphanumerics"](e)||jr["Geometric Shapes"](e)||jr["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||jr["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||jr["CJK Symbols and Punctuation"](e)||jr.Katakana(e)||jr["Private Use Area"](e)||jr["CJK Compatibility Forms"](e)||jr["Small Form Variants"](e)||jr["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(o))}function Zu(o){return o>=1424&&o<=2303||jr["Arabic Presentation Forms-A"](o)||jr["Arabic Presentation Forms-B"](o)}function Eh(o,e){return!(!e&&Zu(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||jr.Khmer(o))}function yd(o){for(const e of o)if(Zu(e.charCodeAt(0)))return!0;return!1}const Th="deferred",Xa="loading",Sh="loaded";let Mh=null,Yn="unavailable",Po=null;const Cl=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(Yn="error"),Mh&&Mh(o)};function Xu(){Us.fire(new So("pluginStateChange",{pluginStatus:Yn,pluginURL:Po}))}const Us=new Ts,Yu=function(){return Yn},vd=function(){if(Yn!==Th||!Po)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Yn=Xa,Xu(),Po&&Ra({url:Po},o=>{o?Cl(o):(Yn=Sh,Xu())})},Ta={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Yn===Sh||Ta.applyArabicShaping!=null,isLoading:()=>Yn===Xa,setState(o){Yn=o.pluginStatus,Po=o.pluginURL},isParsed:()=>Ta.applyArabicShaping!=null&&Ta.processBidirectionalText!=null&&Ta.processStyledBidirectionalText!=null,getPluginURL:()=>Po};class Xi{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,s){for(const f of i)if(!Eh(f.charCodeAt(0),s))return!1;return!0}(e,Ta.isLoaded())}}class js{constructor(e,i,s,f){this.property=e,this.value=i,this.expression=function(l,d,R,N){if(Vu(l))return new qu(l,d);if(Hu(l)||Array.isArray(l)&&l.length>0){const $=gh(l,d,R,N);if($.result==="error")throw new Error($.value.map(I=>`${I.key}: ${I.message}`).join(", "));return $.value}{let $=l;return typeof l=="string"&&d.type==="color"&&($=Mi.parse(l)),{kind:"constant",configDependencies:new Set,evaluate:()=>$}}}(i===void 0?e.specification.default:i,e.specification,s,f)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,s){return this.property.possiblyEvaluate(this,e,i,s)}}class Ku{constructor(e,i,s){this.property=e,this.value=new js(e,void 0,i,s)}transitioned(e,i){return new ns(this.property,this.value,i,Wt({},e.transition,this.transition),e.now)}untransitioned(){return new ns(this.property,this.value,null,{},0)}}class Rl{constructor(e,i,s){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=s,this.configDependencies=new Set}getValue(e){return Ir(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ku(this._values[e].property,this._scope,this._options)),this._values[e].value=new js(this._values[e].property,i===null?void 0:Ir(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const s=this._properties.properties;if(e)for(const f in e){const l=e[f];if(br(f,"-transition")){const d=f.slice(0,-11);s[d]&&this.setTransition(d,l)}else s.hasOwnProperty(f)&&this.setValue(f,l)}}getTransition(e){return Ir(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ku(this._values[e].property)),this._values[e].transition=Ir(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s);const f=this.getTransition(i);f!==void 0&&(e[`${i}-transition`]=f)}return e}transitioned(e,i){const s=new bd(this._properties);for(const f of Object.keys(this._values))s._values[f]=this._values[f].transitioned(e,i._values[f]);return s}untransitioned(){const e=new bd(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class ns{constructor(e,i,s,f,l){const d=f.delay||0,R=f.duration||0;l=l||0,this.property=e,this.value=i,this.begin=l+d,this.end=this.begin+R,e.specification.transition&&(f.delay||f.duration)&&(this.prior=s)}possiblyEvaluate(e,i,s){const f=e.now||0,l=this.value.possiblyEvaluate(e,i,s),d=this.prior;if(d){if(f>this.end)return this.prior=null,l;if(this.value.isDataDriven())return this.prior=null,l;if(f<this.begin)return d.possiblyEvaluate(e,i,s);{const R=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,i,s),l,be(R))}}return l}}class bd{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,s){const f=new Gs(this._properties);for(const l of Object.keys(this._values))f._values[l]=this._values[l].possiblyEvaluate(e,i,s);return f}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Am{constructor(e,i,s){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=s,this.configDependencies=new Set}getValue(e){return Ir(this._values[e].value)}setValue(e,i){this._values[e]=new js(this._values[e].property,i===null?void 0:Ir(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s)}return e}possiblyEvaluate(e,i,s){const f=new Gs(this._properties);for(const l of Object.keys(this._values))f._values[l]=this._values[l].possiblyEvaluate(e,i,s);return f}}class Vs{constructor(e,i,s){this.property=e,this.value=i,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,s,f){return this.property.evaluate(this.value,this.parameters,e,i,s,f)}}class Gs{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class dr{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,s){const f=Ti[this.specification.type];return f?f(e,i,s):e}}class Ar{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,s,f){return new Vs(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},s,f)}:e.expression,i)}interpolate(e,i,s){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Vs(this,{kind:"constant",value:void 0},e.parameters);const f=Ti[this.specification.type];return f?new Vs(this,{kind:"constant",value:f(e.value.value,i.value.value,s)},e.parameters):e}evaluate(e,i,s,f,l,d){return e.kind==="constant"?e.value:e.evaluate(i,s,f,l,d)}}class Co{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,f){return!!e.expression.evaluate(i,null,{},s,f)}interpolate(){return!1}}class on{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Xi(0,{});for(const s in e){const f=e[s];f.specification.overridable&&this.overridableProperties.push(s);const l=this.defaultPropertyValues[s]=new js(f,void 0),d=this.defaultTransitionablePropertyValues[s]=new Ku(f);this.defaultTransitioningPropertyValues[s]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=l.possiblyEvaluate(i)}}}Dr(Ar,"DataDrivenProperty"),Dr(dr,"DataConstantProperty"),Dr(Co,"ColorRampProperty");var qt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function xd(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Ju(o){if(Array.isArray(o))return o.map(Ju);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const e={};for(const i in o)e[i]=Ju(o[i]);return e}return xd(o)}function Ah(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const e of o.slice(1))if(!Ah(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function wd(o,e="",i=null,s="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ah(o)||(o=Dl(o));const f=o;let l=!0;try{l=function(I){if(!Hs(I))return I;let j=Ju(I);return Td(j),j=Ed(j),j}(f)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(f,null,2)}
        `)}let d=null,R=null;if(s!=="background"&&s!=="sky"&&s!=="slot"){R=qt[`filter_${s}`];const I=Il(l,R,e,i);if(I.result==="error")throw new Error(I.value.map(j=>`${j.key}: ${j.message}`).join(", "));d=(j,H,F)=>I.value.evaluate(j,H,{},F)}let N=null,$=null;if(l!==f){const I=Il(f,R,e,i);if(I.result==="error")throw new Error(I.value.map(j=>`${j.key}: ${j.message}`).join(", "));N=(j,H,F,V,Y)=>I.value.evaluate(j,H,{},F,void 0,void 0,V,Y),$=!Os(I.value.expression)}return{filter:d,dynamicFilter:N||void 0,needGeometry:as(l),needFeature:!!$}}function Ed(o){if(!Array.isArray(o))return o;const e=function(i){if(Im.has(i[0])){for(let s=1;s<i.length;s++)if(Hs(i[s]))return!0}return i}(o);return e===!0?e:e.map(i=>Ed(i))}function Td(o){let e=!1;const i=[];if(o[0]==="case"){for(let s=1;s<o.length-1;s+=2)e=e||Hs(o[s]),i.push(o[s+1]);i.push(o[o.length-1])}else if(o[0]==="match"){e=e||Hs(o[1]);for(let s=2;s<o.length-1;s+=2)i.push(o[s+1]);i.push(o[o.length-1])}else if(o[0]==="step"){e=e||Hs(o[1]);for(let s=1;s<o.length-1;s+=2)i.push(o[s+1])}e&&(o.length=0,o.push("any",...i));for(let s=1;s<o.length;s++)Td(o[s])}function Hs(o){if(!Array.isArray(o))return!1;if((e=o[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<o.length;i++)if(Hs(o[i]))return!0;return!1}const Im=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Pm(o,e){return o<e?-1:o>e?1:0}function as(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let e=1;e<o.length;e++)if(as(o[e]))return!0;return!1}function Dl(o){if(!o)return!0;const e=o[0];return o.length<=1?e!=="any":e==="=="?Qu(o[1],o[2],"=="):e==="!="?ec(Qu(o[1],o[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Qu(o[1],o[2],e):e==="any"?(i=o.slice(1),["any"].concat(i.map(Dl))):e==="all"?["all"].concat(o.slice(1).map(Dl)):e==="none"?["all"].concat(o.slice(1).map(Dl).map(ec)):e==="in"?Ll(o[1],o.slice(2)):e==="!in"?ec(Ll(o[1],o.slice(2))):e==="has"?Sd(o[1]):e!=="!has"||ec(Sd(o[1]));var i}function Qu(o,e,i){switch(o){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,o,e]}}function Ll(o,e){if(e.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",o,["literal",e.sort(Pm)]]:["filter-in-small",o,["literal",e]]}}function Sd(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function ec(o){return["!",o]}const ka="";function Ba(o,e){return e?`${o}${ka}${e}`:o}const os="-transition",Cm=new Set(["fill","line","background","hillshade","raster"]);class Kn extends Ts{constructor(e,i,s,f,l){if(super(),this.id=e.id,this.fqid=Ba(this.id,s),this.type=e.type,this.scope=s,this.lut=f,this.options=l,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const d=Il(this.filter,qt[`filter_${e.type}`]);d.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...d.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new Am(i.layout,this.scope,l),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new Rl(i.paint,this.scope,l);for(const d in e.paint)this.setPaintProperty(d,e.paint[d]);for(const d in e.layout)this.setLayoutProperty(d,e.layout[d]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Gs(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D()&&Cm.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...s.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return br(e,os)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const s=this._transitionablePaint,f=s._properties.properties;if(br(e,os)){const j=e.slice(0,-11);return f[j]&&s.setTransition(j,i||void 0),!1}if(!f[e])return!1;const l=s._values[e],d=l.value.isDataDriven(),R=l.value;s.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...s.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const N=s._values[e].value,$=N.isDataDriven(),I=br(e,"pattern")||e==="line-dasharray";return $||d||I||this._handleOverridablePaintPropertyUpdate(e,R,N)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,s){return null}_handleOverridablePaintPropertyUpdate(e,i,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return Vr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Vs&&Bs(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=wd(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,s,f,l,d,R,N,$){}}const Rm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ol{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class $i{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ri(o,e=1){let i=0,s=0;return{members:o.map(f=>{const l=Rm[f.type].BYTES_PER_ELEMENT,d=i=tc(i,Math.max(e,l)),R=f.components||1;return s=Math.max(s,l),i+=l*R,{name:f.name,type:f.type,components:R,offset:d}}),size:tc(i,Math.max(s,e)),alignment:e}}function tc(o,e){return Math.ceil(o/e)*e}class Fa extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const f=2*e;return this.int16[f+0]=i,this.int16[f+1]=s,e}}Fa.prototype.bytesPerElement=4,Dr(Fa,"StructArrayLayout2i4");class zl extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s)}emplace(e,i,s,f){const l=3*e;return this.int16[l+0]=i,this.int16[l+1]=s,this.int16[l+2]=f,e}}zl.prototype.bytesPerElement=6,Dr(zl,"StructArrayLayout3i6");class Ro extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,f){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,s,f)}emplace(e,i,s,f,l){const d=4*e;return this.int16[d+0]=i,this.int16[d+1]=s,this.int16[d+2]=f,this.int16[d+3]=l,e}}Ro.prototype.bytesPerElement=8,Dr(Ro,"StructArrayLayout4i8");class Ih extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,f,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,f,l)}emplace(e,i,s,f,l,d){const R=5*e;return this.int16[R+0]=i,this.int16[R+1]=s,this.int16[R+2]=f,this.int16[R+3]=l,this.int16[R+4]=d,e}}Ih.prototype.bytesPerElement=10,Dr(Ih,"StructArrayLayout5i10");class Sa extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,f,l,d,R){const N=this.length;return this.resize(N+1),this.emplace(N,e,i,s,f,l,d,R)}emplace(e,i,s,f,l,d,R,N){const $=6*e,I=12*e,j=3*e;return this.int16[$+0]=i,this.int16[$+1]=s,this.uint8[I+4]=f,this.uint8[I+5]=l,this.uint8[I+6]=d,this.uint8[I+7]=R,this.float32[j+2]=N,e}}Sa.prototype.bytesPerElement=12,Dr(Sa,"StructArrayLayout2i4ub1f12");class Do extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,f){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,s,f)}emplace(e,i,s,f,l){const d=4*e;return this.float32[d+0]=i,this.float32[d+1]=s,this.float32[d+2]=f,this.float32[d+3]=l,e}}Do.prototype.bytesPerElement=16,Dr(Do,"StructArrayLayout4f16");class fo extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s)}emplace(e,i,s,f){const l=3*e;return this.float32[l+0]=i,this.float32[l+1]=s,this.float32[l+2]=f,e}}fo.prototype.bytesPerElement=12,Dr(fo,"StructArrayLayout3f12");class Lo extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,f,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,f,l)}emplace(e,i,s,f,l,d){const R=6*e,N=3*e;return this.uint16[R+0]=i,this.uint16[R+1]=s,this.uint16[R+2]=f,this.uint16[R+3]=l,this.float32[N+2]=d,e}}Lo.prototype.bytesPerElement=12,Dr(Lo,"StructArrayLayout4ui1f12");class rc extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,f){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,s,f)}emplace(e,i,s,f,l){const d=4*e;return this.uint16[d+0]=i,this.uint16[d+1]=s,this.uint16[d+2]=f,this.uint16[d+3]=l,e}}rc.prototype.bytesPerElement=8,Dr(rc,"StructArrayLayout4ui8");class ic extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,f,l,d){const R=this.length;return this.resize(R+1),this.emplace(R,e,i,s,f,l,d)}emplace(e,i,s,f,l,d,R){const N=6*e;return this.int16[N+0]=i,this.int16[N+1]=s,this.int16[N+2]=f,this.int16[N+3]=l,this.int16[N+4]=d,this.int16[N+5]=R,e}}ic.prototype.bytesPerElement=12,Dr(ic,"StructArrayLayout6i12");class Ph extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,f,l,d,R,N,$,I,j,H){const F=this.length;return this.resize(F+1),this.emplace(F,e,i,s,f,l,d,R,N,$,I,j,H)}emplace(e,i,s,f,l,d,R,N,$,I,j,H,F){const V=12*e;return this.int16[V+0]=i,this.int16[V+1]=s,this.int16[V+2]=f,this.int16[V+3]=l,this.uint16[V+4]=d,this.uint16[V+5]=R,this.uint16[V+6]=N,this.uint16[V+7]=$,this.int16[V+8]=I,this.int16[V+9]=j,this.int16[V+10]=H,this.int16[V+11]=F,e}}Ph.prototype.bytesPerElement=24,Dr(Ph,"StructArrayLayout4i4ui4i24");class Ch extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,f,l,d){const R=this.length;return this.resize(R+1),this.emplace(R,e,i,s,f,l,d)}emplace(e,i,s,f,l,d,R){const N=10*e,$=5*e;return this.int16[N+0]=i,this.int16[N+1]=s,this.int16[N+2]=f,this.float32[$+2]=l,this.float32[$+3]=d,this.float32[$+4]=R,e}}Ch.prototype.bytesPerElement=20,Dr(Ch,"StructArrayLayout3i3f20");class Rh extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Rh.prototype.bytesPerElement=4,Dr(Rh,"StructArrayLayout1ul4");class Oo extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const f=2*e;return this.uint16[f+0]=i,this.uint16[f+1]=s,e}}Oo.prototype.bytesPerElement=4,Dr(Oo,"StructArrayLayout2ui4");class Dh extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,f,l,d,R,N,$,I,j,H,F){const V=this.length;return this.resize(V+1),this.emplace(V,e,i,s,f,l,d,R,N,$,I,j,H,F)}emplace(e,i,s,f,l,d,R,N,$,I,j,H,F,V){const Y=20*e,oe=10*e;return this.int16[Y+0]=i,this.int16[Y+1]=s,this.int16[Y+2]=f,this.int16[Y+3]=l,this.int16[Y+4]=d,this.float32[oe+3]=R,this.float32[oe+4]=N,this.float32[oe+5]=$,this.float32[oe+6]=I,this.int16[Y+14]=j,this.uint32[oe+8]=H,this.uint16[Y+18]=F,this.uint16[Y+19]=V,e}}Dh.prototype.bytesPerElement=40,Dr(Dh,"StructArrayLayout5i4f1i1ul2ui40");class nc extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,f,l,d,R){const N=this.length;return this.resize(N+1),this.emplace(N,e,i,s,f,l,d,R)}emplace(e,i,s,f,l,d,R,N){const $=8*e;return this.int16[$+0]=i,this.int16[$+1]=s,this.int16[$+2]=f,this.int16[$+4]=l,this.int16[$+5]=d,this.int16[$+6]=R,this.int16[$+7]=N,e}}nc.prototype.bytesPerElement=16,Dr(nc,"StructArrayLayout3i2i2i16");class ac extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,f,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,f,l)}emplace(e,i,s,f,l,d){const R=4*e,N=8*e;return this.float32[R+0]=i,this.float32[R+1]=s,this.float32[R+2]=f,this.int16[N+6]=l,this.int16[N+7]=d,e}}ac.prototype.bytesPerElement=16,Dr(ac,"StructArrayLayout2f1f2i16");class Lh extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,f,l,d){const R=this.length;return this.resize(R+1),this.emplace(R,e,i,s,f,l,d)}emplace(e,i,s,f,l,d,R){const N=20*e,$=5*e;return this.uint8[N+0]=i,this.uint8[N+1]=s,this.float32[$+1]=f,this.float32[$+2]=l,this.float32[$+3]=d,this.float32[$+4]=R,e}}Lh.prototype.bytesPerElement=20,Dr(Lh,"StructArrayLayout2ub4f20");class zn extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s)}emplace(e,i,s,f){const l=3*e;return this.uint16[l+0]=i,this.uint16[l+1]=s,this.uint16[l+2]=f,e}}zn.prototype.bytesPerElement=6,Dr(zn,"StructArrayLayout3ui6");class Oh extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,f,l,d,R,N,$,I,j,H,F,V,Y,oe,ce,we,Ie,me,Re){const Ue=this.length;return this.resize(Ue+1),this.emplace(Ue,e,i,s,f,l,d,R,N,$,I,j,H,F,V,Y,oe,ce,we,Ie,me,Re)}emplace(e,i,s,f,l,d,R,N,$,I,j,H,F,V,Y,oe,ce,we,Ie,me,Re,Ue){const $e=30*e,ct=15*e,lt=60*e;return this.int16[$e+0]=i,this.int16[$e+1]=s,this.int16[$e+2]=f,this.float32[ct+2]=l,this.float32[ct+3]=d,this.uint16[$e+8]=R,this.uint16[$e+9]=N,this.uint32[ct+5]=$,this.uint32[ct+6]=I,this.uint32[ct+7]=j,this.uint16[$e+16]=H,this.uint16[$e+17]=F,this.uint16[$e+18]=V,this.float32[ct+10]=Y,this.float32[ct+11]=oe,this.uint8[lt+48]=ce,this.uint8[lt+49]=we,this.uint8[lt+50]=Ie,this.uint32[ct+13]=me,this.int16[$e+28]=Re,this.uint8[lt+58]=Ue,e}}Oh.prototype.bytesPerElement=60,Dr(Oh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class oc extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,f,l,d,R,N,$,I,j,H,F,V,Y,oe,ce,we,Ie,me,Re,Ue,$e,ct,lt,st,xt,dt,Et,It,Mt,Ct){const kt=this.length;return this.resize(kt+1),this.emplace(kt,e,i,s,f,l,d,R,N,$,I,j,H,F,V,Y,oe,ce,we,Ie,me,Re,Ue,$e,ct,lt,st,xt,dt,Et,It,Mt,Ct)}emplace(e,i,s,f,l,d,R,N,$,I,j,H,F,V,Y,oe,ce,we,Ie,me,Re,Ue,$e,ct,lt,st,xt,dt,Et,It,Mt,Ct,kt){const jt=20*e,Ot=40*e,Kt=80*e;return this.float32[jt+0]=i,this.float32[jt+1]=s,this.int16[Ot+4]=f,this.int16[Ot+5]=l,this.int16[Ot+6]=d,this.int16[Ot+7]=R,this.int16[Ot+8]=N,this.int16[Ot+9]=$,this.int16[Ot+10]=I,this.int16[Ot+11]=j,this.int16[Ot+12]=H,this.uint16[Ot+13]=F,this.uint16[Ot+14]=V,this.uint16[Ot+15]=Y,this.uint16[Ot+16]=oe,this.uint16[Ot+17]=ce,this.uint16[Ot+18]=we,this.uint16[Ot+19]=Ie,this.uint16[Ot+20]=me,this.uint16[Ot+21]=Re,this.uint16[Ot+22]=Ue,this.uint16[Ot+23]=$e,this.uint16[Ot+24]=ct,this.uint16[Ot+25]=lt,this.uint16[Ot+26]=st,this.uint16[Ot+27]=xt,this.uint32[jt+14]=dt,this.float32[jt+15]=Et,this.float32[jt+16]=It,this.float32[jt+17]=Mt,this.float32[jt+18]=Ct,this.uint8[Kt+76]=kt,e}}oc.prototype.bytesPerElement=80,Dr(oc,"StructArrayLayout2f9i15ui1ul4f1ub80");class qs extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}qs.prototype.bytesPerElement=4,Dr(qs,"StructArrayLayout1f4");class oa extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,f,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,f,l)}emplace(e,i,s,f,l,d){const R=5*e;return this.float32[R+0]=i,this.float32[R+1]=s,this.float32[R+2]=f,this.float32[R+3]=l,this.float32[R+4]=d,e}}oa.prototype.bytesPerElement=20,Dr(oa,"StructArrayLayout5f20");class sc extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,f,l,d,R){const N=this.length;return this.resize(N+1),this.emplace(N,e,i,s,f,l,d,R)}emplace(e,i,s,f,l,d,R,N){const $=7*e;return this.float32[$+0]=i,this.float32[$+1]=s,this.float32[$+2]=f,this.float32[$+3]=l,this.float32[$+4]=d,this.float32[$+5]=R,this.float32[$+6]=N,e}}sc.prototype.bytesPerElement=28,Dr(sc,"StructArrayLayout7f28");class zh extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,f,l,d,R,N,$,I,j){const H=this.length;return this.resize(H+1),this.emplace(H,e,i,s,f,l,d,R,N,$,I,j)}emplace(e,i,s,f,l,d,R,N,$,I,j,H){const F=11*e;return this.float32[F+0]=i,this.float32[F+1]=s,this.float32[F+2]=f,this.float32[F+3]=l,this.float32[F+4]=d,this.float32[F+5]=R,this.float32[F+6]=N,this.float32[F+7]=$,this.float32[F+8]=I,this.float32[F+9]=j,this.float32[F+10]=H,e}}zh.prototype.bytesPerElement=44,Dr(zh,"StructArrayLayout11f44");class kh extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,f,l,d,R,N,$){const I=this.length;return this.resize(I+1),this.emplace(I,e,i,s,f,l,d,R,N,$)}emplace(e,i,s,f,l,d,R,N,$,I){const j=9*e;return this.float32[j+0]=i,this.float32[j+1]=s,this.float32[j+2]=f,this.float32[j+3]=l,this.float32[j+4]=d,this.float32[j+5]=R,this.float32[j+6]=N,this.float32[j+7]=$,this.float32[j+8]=I,e}}kh.prototype.bytesPerElement=36,Dr(kh,"StructArrayLayout9f36");class ss extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const f=2*e;return this.float32[f+0]=i,this.float32[f+1]=s,e}}ss.prototype.bytesPerElement=8,Dr(ss,"StructArrayLayout2f8");class kl extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,f){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,s,f)}emplace(e,i,s,f,l){const d=6*e;return this.uint32[3*e+0]=i,this.uint16[d+2]=s,this.uint16[d+3]=f,this.uint16[d+4]=l,e}}kl.prototype.bytesPerElement=12,Dr(kl,"StructArrayLayout1ul3ui12");class lc extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}lc.prototype.bytesPerElement=2,Dr(lc,"StructArrayLayout1ui2");class Bh extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,f,l,d,R,N,$,I,j,H,F,V,Y,oe){const ce=this.length;return this.resize(ce+1),this.emplace(ce,e,i,s,f,l,d,R,N,$,I,j,H,F,V,Y,oe)}emplace(e,i,s,f,l,d,R,N,$,I,j,H,F,V,Y,oe,ce){const we=16*e;return this.float32[we+0]=i,this.float32[we+1]=s,this.float32[we+2]=f,this.float32[we+3]=l,this.float32[we+4]=d,this.float32[we+5]=R,this.float32[we+6]=N,this.float32[we+7]=$,this.float32[we+8]=I,this.float32[we+9]=j,this.float32[we+10]=H,this.float32[we+11]=F,this.float32[we+12]=V,this.float32[we+13]=Y,this.float32[we+14]=oe,this.float32[we+15]=ce,e}}Bh.prototype.bytesPerElement=64,Dr(Bh,"StructArrayLayout16f64");class Bl extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,f,l,d,R){const N=this.length;return this.resize(N+1),this.emplace(N,e,i,s,f,l,d,R)}emplace(e,i,s,f,l,d,R,N){const $=10*e,I=5*e;return this.uint16[$+0]=i,this.uint16[$+1]=s,this.uint16[$+2]=f,this.uint16[$+3]=l,this.float32[I+2]=d,this.float32[I+3]=R,this.float32[I+4]=N,e}}Bl.prototype.bytesPerElement=20,Dr(Bl,"StructArrayLayout4ui3f20");class Fh extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Fh.prototype.bytesPerElement=2,Dr(Fh,"StructArrayLayout1i2");class uc extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}uc.prototype.bytesPerElement=1,Dr(uc,"StructArrayLayout1ub1");class Fl extends Ol{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Fl.prototype.size=40;class Md extends Dh{get(e){return new Fl(this,e)}}Dr(Md,"CollisionBoxArray");class Ad extends Ol{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Ad.prototype.size=60;class Id extends Oh{get(e){return new Ad(this,e)}}Dr(Id,"PlacedSymbolArray");class Pd extends Ol{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Pd.prototype.size=80;class Cd extends oc{get(e){return new Pd(this,e)}}Dr(Cd,"SymbolInstanceArray");class Nl extends qs{getoffsetX(e){return this.float32[1*e+0]}}Dr(Nl,"GlyphOffsetArray");class Ul extends Fa{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Dr(Ul,"SymbolLineVertexArray");class sa extends Ol{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}sa.prototype.size=12;class jl extends kl{get(e){return new sa(this,e)}}Dr(jl,"FeatureIndexArray");class Rd extends Oo{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Dr(Rd,"FillExtrusionCentroidArray");class Dd extends Ol{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Dd.prototype.size=6;class Ld extends zl{get(e){return new Dd(this,e)}}Dr(Ld,"FillExtrusionWallArray");const Dm=Ri([{name:"a_pos",components:2,type:"Int16"}],4),Nh=Ri([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class hn{constructor(e=[]){this.segments=e}_prepareSegment(e,i,s,f){let l=this.segments[this.segments.length-1];return e>hn.MAX_VERTEX_ARRAY_LENGTH&&St(`Max vertices per segment is ${hn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!l||l.vertexLength+e>hn.MAX_VERTEX_ARRAY_LENGTH||l.sortKey!==f)&&(l={vertexOffset:i,primitiveOffset:s,vertexLength:0,primitiveLength:0},f!==void 0&&(l.sortKey=f),this.segments.push(l)),l}prepareSegment(e,i,s,f){return this._prepareSegment(e,i.length,s.length,f)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,s,f){return new hn([{vertexOffset:e,primitiveOffset:i,vertexLength:s,primitiveLength:f,vaos:{},sortKey:0}])}}function cc(o,e){return 256*(o=le(Math.floor(o),0,255))+le(Math.floor(e),0,255)}hn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Dr(hn,"SegmentVector");const Lm=Ri([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Om=Ri([{name:"a_dash",components:4,type:"Uint16"}]);class ls{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,s,f){this.ids.push(Od(e)),this.positions.push(i,s,f)}eachPosition(e,i){const s=Od(e);let f=0,l=this.ids.length-1;for(;f<l;){const d=f+l>>1;this.ids[d]>=s?l=d:f=d+1}for(;this.ids[f]===s;)i(this.positions[3*f],this.positions[3*f+1],this.positions[3*f+2]),f++}static serialize(e,i){const s=new Float64Array(e.ids),f=new Uint32Array(e.positions);return hc(s,f,0,s.length-1),i&&(i.add(s.buffer),i.add(f.buffer)),{ids:s,positions:f}}static deserialize(e){const i=new ls;let s;i.ids=e.ids,i.positions=e.positions;for(const f of i.ids)f!==s&&i.uniqueIds.push(f),s=f;return i.indexed=!0,i}}function Od(o){const e=+o;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:pl(String(o))}function hc(o,e,i,s){for(;i<s;){const f=o[i+s>>1];let l=i-1,d=s+1;for(;;){do l++;while(o[l]<f);do d--;while(o[d]>f);if(l>=d)break;Vl(o,l,d),Vl(e,3*l,3*d),Vl(e,3*l+1,3*d+1),Vl(e,3*l+2,3*d+2)}d-i<s-d?(hc(o,e,i,d),i=d+1):(hc(o,e,d+1,s),s=d)}}function Vl(o,e,i){const s=o[e];o[e]=o[i],o[i]=s}Dr(ls,"FeaturePositionMap");class po{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,s){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Ws extends po{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class sn extends po{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Na extends po{constructor(e){super(e),this.current=[0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class Uh extends po{constructor(e){super(e),this.current=[0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class Gl extends po{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class zd extends po{constructor(e){super(e),this.current=Mi.transparent.toRenderColor(null)}set(e,i,s){this.fetchUniformLocation(e,i)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const jh=new Float32Array(16);class Hl extends po{constructor(e){super(e),this.current=jh}set(e,i,s){if(this.fetchUniformLocation(e,i)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let f=1;f<16;f++)if(s[f]!==this.current[f]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}const zm=new Float32Array(9),km=new Float32Array(4);class Vh extends po{constructor(e){super(e),this.current=km}set(e,i,s){if(this.fetchUniformLocation(e,i)){for(let f=0;f<4;f++)if(s[f]!==this.current[f]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}}function fc(o){return[cc(255*o.r,255*o.g),cc(255*o.b,255*o.a)]}class $s{constructor(e,i,s,f){this.value=e,this.uniformNames=i.map(l=>`u_${l}`),this.type=s,this.context=f}setUniform(e,i,s,f,l){const d=f.constantOr(this.value);i.set(e,l,d instanceof Mi?d.toRenderColor(this.ignoreLut?null:this.context.lut):d)}getBinding(e,i){return this.type==="color"?new zd(e):new sn(e)}}class Zs{constructor(e,i){this.uniformNames=i.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,s,f,l){const d=l==="u_pattern"||l==="u_dash"?this.pattern:l==="u_pixel_ratio"?this.pixelRatio:null;d&&i.set(e,l,d)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new Gl(e):new sn(e)}}class mo{constructor(e,i,s,f){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map(l=>({name:`a_${l}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,i,s,f,l,d,R){const N=this.paintVertexArray.length,$=this.expression.evaluate(new Xi(0,{brightness:d}),i,{},l,f,R);this.paintVertexArray.resize(e),this._setPaintValue(N,e,$,this.context)}updatePaintArray(e,i,s,f,l,d,R){const N=this.expression.evaluate({zoom:0,brightness:R},s,f,void 0,l);this._setPaintValue(e,i,N,this.context)}_setPaintValue(e,i,s,f){if(this.type==="color"){const l=fc(s.toRenderColor(this.ignoreLut?null:f.lut));for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,l[0],l[1])}else{for(let l=e;l<i;l++)this.paintVertexArray.emplace(l,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ua{constructor(e,i,s,f,l,d){this.expression=e,this.uniformNames=i.map(R=>`u_${R}_t`),this.type=s,this.useIntegerZoom=f,this.context=l,this.maxValue=0,this.paintVertexAttributes=i.map(R=>({name:`a_${R}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,i,s,f,l,d,R){const N=this.expression.evaluate(new Xi(this.context.zoom,{brightness:d}),i,{},l,f,R),$=this.expression.evaluate(new Xi(this.context.zoom+1,{brightness:d}),i,{},l,f,R),I=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(I,e,N,$,this.context)}updatePaintArray(e,i,s,f,l,d,R){const N=this.expression.evaluate({zoom:this.context.zoom,brightness:R},s,f,void 0,l),$=this.expression.evaluate({zoom:this.context.zoom+1,brightness:R},s,f,void 0,l);this._setPaintValue(e,i,N,$,this.context)}_setPaintValue(e,i,s,f,l){if(this.type==="color"){const d=fc(s.toRenderColor(this.ignoreLut?null:l.lut)),R=fc(s.toRenderColor(this.ignoreLut?null:l.lut));for(let N=e;N<i;N++)this.paintVertexArray.emplace(N,d[0],d[1],R[0],R[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,s,f);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(f))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,s,f,l){const d=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,R=le(this.expression.interpolationFactor(d,this.context.zoom,this.context.zoom+1),0,1);i.set(e,l,R)}getBinding(e,i){return new sn(e)}}class zo{constructor(e,i,s,f,l){this.expression=e,this.layerId=l,this.paintVertexAttributes=(s==="array"?Om:Lm).members;for(let d=0;d<i.length;++d);this.paintVertexArray=new f}populatePaintArray(e,i,s,f){const l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(l,e,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(e,i,s,f,l,d,R){this._setPaintValues(e,i,s.patterns&&s.patterns[this.layerId],d)}_setPaintValues(e,i,s,f){if(!f||!s)return;const l=f[s];if(!l)return;const{tl:d,br:R,pixelRatio:N}=l;for(let $=e;$<i;$++)this.paintVertexArray.emplace($,d[0],d[1],R[0],R[1],N)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class us{constructor(e,i,s=()=>!0){this.binders={},this._buffers=[],this.context=i;const f=[];for(const l in e.paint._values){const d=e.paint.get(l),R=e.paint.get(`${l}-use-theme`);if(l.endsWith("-use-theme")||!s(l)||!(d instanceof Vs&&Bs(d.property.specification)))continue;const N=dc(l,e.type),$=d.value,I=d.property.specification.type,j=!!d.property.useIntegerZoom,H=l==="line-dasharray"||l.endsWith("pattern"),F=l==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if($.kind!=="constant"||F)if($.kind==="source"||F||H){const V=ql(l,I,"source");this.binders[l]=H?new zo($,N,I,V,e.id):new mo($,N,I,V),f.push(`/a_${l}`)}else{const V=ql(l,I,"composite");this.binders[l]=new Ua($,N,I,j,i,V),f.push(`/z_${l}`)}else this.binders[l]=H?new Zs($.value,N):new $s($.value,N,I,i),f.push(`/u_${l}`);R&&(this.binders[l].ignoreLut=R.constantOr("default")==="none",this.binders[l].checkUseTheme=!0)}this.cacheKey=f.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof mo||i instanceof Ua?i.maxValue:0}populatePaintArrays(e,i,s,f,l,d,R){for(const N in this.binders){const $=this.binders[N];$.context=this.context,($ instanceof mo||$ instanceof Ua||$ instanceof zo)&&$.populatePaintArray(e,i,s,f,l,d,R)}}setConstantPatternPositions(e){for(const i in this.binders){const s=this.binders[i];s instanceof Zs&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,i,s,f,l,d,R,N,$){let I=!1;const j=Object.keys(e),H=j.length!==0&&!N,F=H?j:i.uniqueIds;this.context.lut=l.lut;for(const V in this.binders){const Y=this.binders[V];if(Y.context=this.context,(Y instanceof mo||Y instanceof Ua||Y instanceof zo)&&(Y.expression.isStateDependent===!0||Y.expression.isLightConstant===!1)){const oe=l.paint.get(V);Y.expression=oe.value;for(const ce of F){const we=e[ce.toString()];i.eachPosition(ce,(Ie,me,Re)=>{const Ue=f.feature(Ie);Y.updatePaintArray(me,Re,Ue,we,d,R,$)})}if(!H)for(const ce of s.uniqueIds){const we=e[ce.toString()];s.eachPosition(ce,(Ie,me,Re)=>{const Ue=f.feature(Ie);Y.updatePaintArray(me,Re,Ue,we,d,R,$)})}I=!0}}return I}defines(){const e=[];for(const i in this.binders){const s=this.binders[i];(s instanceof $s||s instanceof Zs)&&e.push(...s.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof mo||s instanceof Ua||s instanceof zo)for(let f=0;f<s.paintVertexAttributes.length;f++)e.push(s.paintVertexAttributes[f].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof $s||s instanceof Zs||s instanceof Ua)for(const f of s.uniformNames)e.push(f)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const s in this.binders){const f=this.binders[s];if(f instanceof $s||f instanceof Zs||f instanceof Ua)for(const l of f.uniformNames)i.push({name:l,property:s,binding:f.getBinding(e,l)})}return i}setUniforms(e,i,s,f,l){for(const{name:d,property:R,binding:N}of s){if(this.binders[R].checkUseTheme&&this.binders[R]instanceof $s){const $=f.get(`${R}-use-theme`);$.isConstant()&&(this.binders[R].ignoreLut=$.constantOr("default")==="none")}this.binders[R].setUniform(e,N,l,f.get(R),d)}}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof mo||i instanceof Ua||i instanceof zo)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const s=this.binders[i];(s instanceof mo||s instanceof Ua||s instanceof zo)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof mo||i instanceof Ua||i instanceof zo)&&i.destroy()}}}class ko{constructor(e,i,s=()=>!0){this.programConfigurations={};for(const f of e)this.programConfigurations[f.id]=new us(f,i,s);this.needsUpload=!1,this._featureMap=new ls,this._featureMapWithoutIds=new ls,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,s,f,l,d,R,N){for(const $ in this.programConfigurations)this.programConfigurations[$].populatePaintArrays(e,i,f,l,d,R,N);i.id!==void 0?this._featureMap.add(i.id,s,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,s,f,l,d,R){for(const N of s)this.needsUpload=this.programConfigurations[N.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,N,f,l,d,R||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Bm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function dc(o,e){return Bm[o]||[o.replace(`${e}-`,"").replace(/-/g,"_")]}const Fm={"line-pattern":{source:Lo,composite:Lo},"fill-pattern":{source:Lo,composite:Lo},"fill-extrusion-pattern":{source:Lo,composite:Lo},"line-dasharray":{source:rc,composite:rc}},Nm={color:{source:ss,composite:Do},number:{source:qs,composite:ss}};function ql(o,e,i){const s=Fm[o];return s&&s[i]||Nm[e][i]}Dr($s,"ConstantBinder"),Dr(Zs,"PatternConstantBinder"),Dr(mo,"SourceExpressionBinder"),Dr(zo,"PatternCompositeBinder"),Dr(Ua,"CompositeExpressionBinder"),Dr(us,"ProgramConfiguration",{omit:["_buffers"]}),Dr(ko,"ProgramConfigurationSet");const Hn=wr/Math.PI/2,pc=5,kd=6,Bd=16383,cs=64,mc=[cs,32,16],Ma=-Hn,Aa=Hn;function Xs(o,e,i,s=Hn){return i=ze(i),[o*Math.sin(i)*s,-e*s,o*Math.cos(i)*s]}function Bo(o,e,i){return Xs(Math.cos(ze(o)),Math.sin(ze(o)),e,i)}const Ys=63710088e-1,Gh=2*Math.PI*Ys;class Ai{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ai(wt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,s=this.lat*i,f=e.lat*i,l=Math.sin(s)*Math.sin(f)+Math.cos(s)*Math.cos(f)*Math.cos((e.lng-this.lng)*i);return Ys*Math.acos(Math.min(l,1))}toBounds(e=0){const i=360*e/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new Fo({lng:this.lng-s,lat:this.lat-i},{lng:this.lng+s,lat:this.lat+i})}toEcef(e){return Bo(this.lat,this.lng,Hn+e*Hn/Ys)}static convert(e){if(e instanceof Ai)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ai(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ai(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Fo{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const s=e;this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]])}else{const s=e;this.setSouthWest(s[0]).setNorthEast(s[1])}}setNorthEast(e){return this._ne=e instanceof Ai?new Ai(e.lng,e.lat):Ai.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ai?new Ai(e.lng,e.lat):Ai.convert(e),this}extend(e){const i=this._sw,s=this._ne;let f,l;if(e instanceof Ai)f=e,l=e;else{if(!(e instanceof Fo))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Fo.convert(e)):this.extend(Ai.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Ai.convert(e)):this;if(f=e._sw,l=e._ne,!f||!l)return this}return i||s?(i.lng=Math.min(f.lng,i.lng),i.lat=Math.min(f.lat,i.lat),s.lng=Math.max(l.lng,s.lng),s.lat=Math.max(l.lat,s.lat)):(this._sw=new Ai(f.lng,f.lat),this._ne=new Ai(l.lng,l.lat)),this}getCenter(){return new Ai((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ai(this.getWest(),this.getNorth())}getSouthEast(){return new Ai(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:s}=Ai.convert(e);let f=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&f}static convert(e){if(e)return e instanceof Fo?e:new Fo(e)}}const Um=0,Fd=25.5;function Wl(o){return Gh*Math.cos(o*Math.PI/180)}function Ya(o){return(180+o)/360}function _o(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function qn(o,e){return o/Wl(e)}function la(o){return 360*o-180}function In(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Nd(o,e){return o*Wl(In(e))}const Wn=85.051129;function jm(o){return Math.cos(ze(le(o,-85.051129,Wn)))}function u(o,e){const i=le(e,Um,Fd),s=Math.pow(2,i);return jm(o)*Gh/(512*s)}function r(o){return 1/Math.cos(o*Math.PI/180)}function n(o,e=0){const i=Math.exp(Math.PI*(1-(o.y+e/wr)/(1<<o.z)*2));return 80150034*i/(i*i+1)/wr/(1<<o.z)}class c{constructor(e,i,s=0){this.x=+e,this.y=+i,this.z=+s}static fromLngLat(e,i=0){const s=Ai.convert(e);return new c(Ya(s.lng),_o(s.lat),qn(i,s.lat))}toLngLat(){return new Ai(la(this.x),In(this.y))}toAltitude(){return Nd(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Gh*r(In(this.y))}}function g(o,e,i,s,f,l,d,R,N){const $=(e+s)/2,I=(i+f)/2,j=new Ge($,I);R(j),function(H,F,V,Y,oe,ce){const we=V-oe,Ie=Y-ce;return Math.abs((Y-F)*we-(V-H)*Ie)/Math.hypot(we,Ie)}(j.x,j.y,l.x,l.y,d.x,d.y)>=N?(g(o,e,i,$,I,l,j,R,N),g(o,$,I,s,f,j,d,R,N)):o.push(d)}function M(o,e,i){let s=o[0],f=s.x,l=s.y;e(s);const d=[s];for(let R=1;R<o.length;R++){const N=o[R],{x:$,y:I}=N;e(N),g(d,f,l,$,I,s,N,e,i),f=$,l=I,s=N}return d}function L(o,e,i,s){if(s(e,i)){const f=e.add(i)._mult(.5);L(o,e,f,s),L(o,f,i,s)}else o.push(i)}function q(o,e){let i=o[0];const s=[i];for(let f=1;f<o.length;f++){const l=o[f];L(s,i,l,e),i=l}return s}const K=Math.pow(2,14)-1,ne=-K-1;function ae(o,e){const i=Math.round(o.x*e),s=Math.round(o.y*e);return o.x=le(i,ne,K),o.y=le(s,ne,K),(i<o.x||i>o.x+1||s<o.y||s>o.y+1)&&St("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function he(o,e,i){const s=o.loadGeometry(),f=o.extent,l=wr/f;if(e&&i&&i.projection.isReprojectedInTileSpace){const d=1<<e.z,{scale:R,x:N,y:$,projection:I}=i,j=H=>{const F=la((e.x+H.x/f)/d),V=In((e.y+H.y/f)/d),Y=I.project(F,V);H.x=(Y.x*R-N)*f,H.y=(Y.y*R-$)*f};for(let H=0;H<s.length;H++)if(o.type!==1)s[H]=M(s[H],j,1);else{const F=[];for(const V of s[H])V.x<0||V.x>=f||V.y<0||V.y>=f||(j(V),F.push(V));s[H]=F}}for(const d of s)for(const R of d)ae(R,l);return s}function fe(o,e){return{type:o.type,id:o.id,properties:o.properties,geometry:e?he(o):[]}}function Te(o,e,i,s,f){o.emplaceBack(2*e+(s+1)/2,2*i+(f+1)/2)}function Ve(o,e,i){o.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class je{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Fa,this.indexArray=new zn,this.segments=new hn,this.programConfigurations=new ko(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}updateFootprints(e,i){}populate(e,i,s,f){const l=this.layers[0],d=[];let R=null;l.type==="circle"&&(R=l.layout.get("circle-sort-key"));for(const{feature:$,id:I,index:j,sourceLayerIndex:H}of e){const F=this.layers[0]._featureFilter.needGeometry,V=fe($,F);if(!this.layers[0]._featureFilter.filter(new Xi(this.zoom),V,s))continue;const Y=R?R.evaluate(V,{},s):void 0,oe={id:I,properties:$.properties,type:$.type,sourceLayerIndex:H,index:j,geometry:F?V.geometry:he($,s,f),patterns:{},sortKey:Y};d.push(oe)}R&&d.sort(($,I)=>$.sortKey-I.sortKey);let N=null;f.projection.name==="globe"&&(this.globeExtVertexArray=new ic,N=f.projection);for(const $ of d){const{geometry:I,index:j,sourceLayerIndex:H}=$,F=e[j].feature;this.addFeature($,I,j,i.availableImages,s,N,i.brightness),i.featureIndex.insert(F,I,j,H,this.index)}}update(e,i,s,f,l,d,R){this.programConfigurations.updatePaintArrays(e,i,l,s,f,d,R)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Dm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Nh.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,s,f,l,d,R){for(const N of i)for(const $ of N){const I=$.x,j=$.y;if(I<0||I>=wr||j<0||j>=wr)continue;if(d){const V=d.projectTilePoint(I,j,l),Y=d.upVector(l,I,j),oe=this.globeExtVertexArray;Ve(oe,V,Y),Ve(oe,V,Y),Ve(oe,V,Y),Ve(oe,V,Y)}const H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),F=H.vertexLength;Te(this.layoutVertexArray,I,j,-1,-1),Te(this.layoutVertexArray,I,j,1,-1),Te(this.layoutVertexArray,I,j,1,1),Te(this.layoutVertexArray,I,j,-1,1),this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+2,F+3),H.vertexLength+=4,H.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},f,l,R)}}function Xe(o,e){for(let i=0;i<o.length;i++)if(Tt(e,o[i]))return!0;for(let i=0;i<e.length;i++)if(Tt(o,e[i]))return!0;return!!ft(o,e)}function Ye(o,e,i){return!!Tt(o,e)||!!gt(e,o,i)}function at(o,e){if(o.length===1)return yt(e,o[0]);for(let i=0;i<e.length;i++){const s=e[i];for(let f=0;f<s.length;f++)if(Tt(o,s[f]))return!0}for(let i=0;i<o.length;i++)if(yt(e,o[i]))return!0;for(let i=0;i<e.length;i++)if(ft(o,e[i]))return!0;return!1}function pt(o,e,i){if(o.length>1){if(ft(o,e))return!0;for(let s=0;s<e.length;s++)if(gt(e[s],o,i))return!0}for(let s=0;s<o.length;s++)if(gt(o[s],e,i))return!0;return!1}function ft(o,e){if(o.length===0||e.length===0)return!1;for(let i=0;i<o.length-1;i++){const s=o[i],f=o[i+1];for(let l=0;l<e.length-1;l++)if(bt(s,f,e[l],e[l+1]))return!0}return!1}function bt(o,e,i,s){return Ut(o,i,s)!==Ut(e,i,s)&&Ut(o,e,i)!==Ut(o,e,s)}function gt(o,e,i){const s=i*i;if(e.length===1)return o.distSqr(e[0])<s;for(let f=1;f<e.length;f++)if(vt(o,e[f-1],e[f])<s)return!0;return!1}function vt(o,e,i){const s=e.distSqr(i);if(s===0)return o.distSqr(e);const f=((o.x-e.x)*(i.x-e.x)+(o.y-e.y)*(i.y-e.y))/s;return o.distSqr(f<0?e:f>1?i:i.sub(e)._mult(f)._add(e))}function yt(o,e){let i,s,f,l=!1;for(let d=0;d<o.length;d++){i=o[d];for(let R=0,N=i.length-1;R<i.length;N=R++)s=i[R],f=i[N],s.y>e.y!=f.y>e.y&&e.x<(f.x-s.x)*(e.y-s.y)/(f.y-s.y)+s.x&&(l=!l)}return l}function Tt(o,e){let i=!1;for(let s=0,f=o.length-1;s<o.length;f=s++){const l=o[s],d=o[f];l.y>e.y!=d.y>e.y&&e.x<(d.x-l.x)*(e.y-l.y)/(d.y-l.y)+l.x&&(i=!i)}return i}function Dt(o,e,i,s,f){for(const d of o)if(e<=d.x&&i<=d.y&&s>=d.x&&f>=d.y)return!0;const l=[new Ge(e,i),new Ge(e,f),new Ge(s,f),new Ge(s,i)];if(o.length>2){for(const d of l)if(Tt(o,d))return!0}for(let d=0;d<o.length-1;d++)if(Zt(o[d],o[d+1],l))return!0;return!1}function Zt(o,e,i){const s=i[0],f=i[2];if(o.x<s.x&&e.x<s.x||o.x>f.x&&e.x>f.x||o.y<s.y&&e.y<s.y||o.y>f.y&&e.y>f.y)return!1;const l=Ut(o,e,i[0]);return l!==Ut(o,e,i[1])||l!==Ut(o,e,i[2])||l!==Ut(o,e,i[3])}function Ht(o,e,i,s,f,l){let d=e.y-o.y,R=o.x-e.x;if(l=l||0){const N=d*d+R*R;if(N===0)return!0;const $=Math.sqrt(N);d/=$,R/=$}return!((i.x-o.x)*d+(i.y-o.y)*R-l<0||(s.x-o.x)*d+(s.y-o.y)*R-l<0||(f.x-o.x)*d+(f.y-o.y)*R-l<0)}function Pt(o,e,i,s,f,l,d){return!(Ht(o,e,s,f,l,d)||Ht(e,i,s,f,l,d)||Ht(i,o,s,f,l,d)||Ht(s,f,o,e,i,d)||Ht(f,l,o,e,i,d)||Ht(l,s,o,e,i,d))}function zt(o,e,i){const s=e.paint.get(o).value;return s.kind==="constant"?s.value:i.programConfigurations.get(e.id).getMaxValue(o)}function tr(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function lr(o,e,i,s,f){if(!e[0]&&!e[1])return o;const l=Ge.convert(e)._mult(f);i==="viewport"&&l._rotate(-s);const d=[];for(let R=0;R<o.length;R++)d.push(o[R].sub(l));return d}function pr(o,e,i,s){const f=Ge.convert(o)._mult(s);return e==="viewport"&&f._rotate(-i),f}let Gt,nr;Dr(je,"CircleBucket",{omit:["layers"]});var Xt,hr={exports:{}},ar=(Xt||(Xt=1,function(o,e){(function(i){function s(l,d,R){var N=f(256*l,256*(d=Math.pow(2,R)-d-1),R),$=f(256*(l+1),256*(d+1),R);return N[0]+","+N[1]+","+$[0]+","+$[1]}function f(l,d,R){var N=2*Math.PI*6378137/256/Math.pow(2,R);return[l*N-2*Math.PI*6378137/2,d*N-2*Math.PI*6378137/2]}i.getURL=function(l,d,R,N,$,I){return I=I||{},l+"?"+["bbox="+s(R,N,$),"format="+(I.format||"image/png"),"service="+(I.service||"WMS"),"version="+(I.version||"1.1.1"),"request="+(I.request||"GetMap"),"srs="+(I.srs||"EPSG:3857"),"width="+(I.width||256),"height="+(I.height||256),"layers="+d].join("&")},i.getTileBBox=s,i.getMercCoords=f,Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,hr.exports)),hr.exports);class er{constructor(e,i,s){this.z=e,this.x=i,this.y=s,this.key=Mr(0,e,e,i,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const s=ar.getTileBBox(this.x,this.y,this.z),f=function(l,d,R){let N,$="";for(let I=l;I>0;I--)N=1<<I-1,$+=(d&N?1:0)+(R&N?2:0);return $}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Sr{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Mr(e,i.z,i.z,i.x,i.y)}}class mr{constructor(e,i,s,f,l){this.overscaledZ=e,this.wrap=i,this.canonical=new er(s,+f,+l),this.key=i===0&&e===s?this.canonical.key:Mr(i,e,s,f,l)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new mr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new mr(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Mr(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Mr(this.wrap*+i,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new mr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,f=2*this.canonical.y;return[new mr(i,this.wrap,i,s,f),new mr(i,this.wrap,i,s+1,f),new mr(i,this.wrap,i,s,f+1),new mr(i,this.wrap,i,s+1,f+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new mr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new mr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Sr(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Mr(o,e,i,s,f){const l=1<<Math.min(i,22);let d=l*(f%l)+s%l;return o&&i<22&&(d+=l*l*((o<0?-2*o-1:2*o)%(1<<2*(22-i)))),16*(32*d+i)+(e-i)}const Lr=[o=>{let e=o.canonical.x-1,i=o.wrap;return e<0&&(e=(1<<o.canonical.z)-1,i--),new mr(o.overscaledZ,i,o.canonical.z,e,o.canonical.y)},o=>{let e=o.canonical.x+1,i=o.wrap;return e===1<<o.canonical.z&&(e=0,i++),new mr(o.overscaledZ,i,o.canonical.z,e,o.canonical.y)},o=>new mr(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,(o.canonical.y===0?1<<o.canonical.z:o.canonical.y)-1),o=>new mr(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y===(1<<o.canonical.z)-1?0:o.canonical.y+1)];Dr(er,"CanonicalTileID"),Dr(mr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const ri=Ri([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Gr}=ri,Zr=Ri([{name:"a_pos_3",components:3,type:"Int16"}]);var ii=Ri([{name:"a_pos",type:"Int16",components:2}]);class vi{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const f=_e.vec3.dot(i,this.dir);if(Math.abs(f)<1e-6)return!1;const l=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/f;return s[0]=this.pos[0]+this.dir[0]*l,s[1]=this.pos[1]+this.dir[1]*l,s[2]=this.pos[2]+this.dir[2]*l,!0}closestPointOnSphere(e,i,s){if(_e.vec3.equals(this.pos,e)||i===0)return s[0]=s[1]=s[2]=0,!1;const[f,l,d]=this.dir,R=this.pos[0]-e[0],N=this.pos[1]-e[1],$=this.pos[2]-e[2],I=f*f+l*l+d*d,j=2*(R*f+N*l+$*d),H=j*j-4*I*(R*R+N*N+$*$-i*i);if(H<0){const F=Math.max(-j/2,0),V=R+f*F,Y=N+l*F,oe=$+d*F,ce=Math.hypot(V,Y,oe);return s[0]=V*i/ce,s[1]=Y*i/ce,s[2]=oe*i/ce,!1}{const F=(-j-Math.sqrt(H))/(2*I);if(F<0){const V=Math.hypot(R,N,$);return s[0]=R*i/V,s[1]=N*i/V,s[2]=$*i/V,!1}return s[0]=R+f*F,s[1]=N+l*F,s[2]=$+d*F,!0}}}class di{constructor(e,i,s,f,l){this.TL=e,this.TR=i,this.BR=s,this.BL=f,this.horizon=l}static fromInvProjectionMatrix(e,i,s){const f=[-1,1,1],l=[1,1,1],d=[1,-1,1],R=[-1,-1,1],N=_e.vec3.transformMat4(f,f,e),$=_e.vec3.transformMat4(l,l,e),I=_e.vec3.transformMat4(d,d,e),j=_e.vec3.transformMat4(R,R,e);return new di(N,$,I,j,i/s)}}function Hi(o,e,i){let s=1/0,f=-1/0;const l=[];for(const d of o){_e.vec3.sub(l,d,e);const R=_e.vec3.dot(l,i);s=Math.min(s,R),f=Math.max(f,R)}return[s,f]}function Yi(o,e){let i=!0;for(let s=0;s<o.planes.length;s++){const f=o.planes[s];let l=0;for(let d=0;d<e.length;d++)l+=_e.vec3.dot(f,e[d])+f[3]>=0;if(l===0)return 0;l!==e.length&&(i=!1)}return i?2:1}function Di(o,e){for(const i of o.projections){const s=Hi(e,o.points[0],i.axis);if(i.projection[1]<s[0]||i.projection[0]>s[1])return 0}return 1}function ki(o,e){let i=0;const s=[0,0,0,0];for(let f=0;f<o.length;f++)s[0]=o[f][0],s[1]=o[f][1],s[2]=o[f][2],s[3]=1,_e.vec4.dot(s,e)>=0&&i++;return i}class ui{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Xr.fromPoints(this.points),this.projections=[],this.frustumEdges=[_e.vec3.sub([],this.points[2],this.points[3]),_e.vec3.sub([],this.points[0],this.points[3]),_e.vec3.sub([],this.points[4],this.points[0]),_e.vec3.sub([],this.points[5],this.points[1]),_e.vec3.sub([],this.points[6],this.points[2]),_e.vec3.sub([],this.points[7],this.points[3])];for(const s of this.frustumEdges){const f=[0,-s[2],s[1]],l=[s[2],0,-s[0]];this.projections.push({axis:f,projection:Hi(this.points,this.points[0],f)}),this.projections.push({axis:l,projection:Hi(this.points,this.points[0],l)})}}static fromInvProjectionMatrix(e,i,s,f){const l=Math.pow(2,s),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map($=>{const I=_e.vec4.transformMat4([],$,e),j=1/I[3]/i*l;return _e.vec4.mul(I,I,[j,j,f?1/I[3]:j,j])}),R=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map($=>{const I=_e.vec3.sub([],d[$[0]],d[$[1]]),j=_e.vec3.sub([],d[$[2]],d[$[1]]),H=_e.vec3.normalize([],_e.vec3.cross([],I,j)),F=-_e.vec3.dot(H,d[$[1]]);return H.concat(F)}),N=[];for(let $=0;$<d.length;$++)N.push([d[$][0],d[$][1],d[$][2]]);return new ui(N,R)}intersectsPrecise(e,i,s){for(let f=0;f<i.length;f++)if(!ki(e,i[f]))return 0;for(let f=0;f<this.planes.length;f++)if(!ki(e,this.planes[f]))return 0;for(const f of s)for(const l of this.frustumEdges){const d=_e.vec3.cross([],f,l),R=_e.vec3.length(d);if(R===0)continue;_e.vec3.scale(d,d,1/R);const N=Hi(this.points,this.points[0],d),$=Hi(e,this.points[0],d);if(N[0]>$[1]||$[0]>N[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const s=i[3];if(_e.vec3.dot([i[0],i[1],i[2]],e)+s<0)return!1}return!0}}class Xr{static fromPoints(e){const i=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const f of e)_e.vec3.min(i,i,f),_e.vec3.max(s,s,f);return new Xr(i,s)}static fromTileIdAndHeight(e,i,s){const f=1<<e.canonical.z,l=e.canonical.x,d=e.canonical.y;return new Xr([l/f,d/f,i],[(l+1)/f,(d+1)/f,s])}static applyTransform(e,i){const s=e.getCorners();for(let f=0;f<s.length;++f)_e.vec3.transformMat4(s[f],s[f],i);return Xr.fromPoints(s)}static applyTransformFast(e,i){const s=[i[12],i[13],i[14]],f=[...s];for(let l=0;l<3;l++)for(let d=0;d<3;d++){const R=i[4*d+l],N=R*e.min[d],$=R*e.max[d];s[l]+=Math.min(N,$),f[l]+=Math.max(N,$)}return new Xr(s,f)}static projectAabbCorners(e,i){const s=e.getCorners();for(let f=0;f<s.length;++f)_e.vec3.transformMat4(s[f],s[f],i);return s}constructor(e,i){this.min=e,this.max=i,this.center=_e.vec3.scale([],_e.vec3.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],s=_e.vec3.clone(this.min),f=_e.vec3.clone(this.max);for(let l=0;l<i.length;l++)s[l]=i[l]?this.min[l]:this.center[l],f[l]=i[l]?this.center[l]:this.max[l];return f[2]=this.max[2],new Xr(s,f)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Yi(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Yi(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Di(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Di(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function Ii(o){return o*Hn/Ys}Dr(Xr,"Aabb");const Li=[new Xr([Ma,Ma,Ma],[Aa,Aa,Aa]),new Xr([Ma,Ma,Ma],[0,0,Aa]),new Xr([0,Ma,Ma],[Aa,0,Aa]),new Xr([Ma,0,Ma],[0,Aa,Aa]),new Xr([0,0,Ma],[Aa,Aa,Aa])];function tn(o,e,i,s=!0){const f=_e.vec3.scale([],o._camera.position,o.worldSize),l=[e,i,1,1];_e.vec4.transformMat4(l,l,o.pixelMatrixInverse),_e.vec4.scale(l,l,1/l[3]);const d=_e.vec3.sub([],l,f),R=_e.vec3.normalize([],d),N=o.globeMatrix,$=[N[12],N[13],N[14]],I=_e.vec3.sub([],$,f),j=_e.vec3.length(I),H=_e.vec3.normalize([],I),F=o.worldSize/(2*Math.PI),V=_e.vec3.dot(H,R),Y=Math.asin(F/j);if(Y<Math.acos(V)){if(!s)return null;const xt=[],dt=[];_e.vec3.scale(xt,R,j/V),_e.vec3.normalize(dt,_e.vec3.sub(dt,xt,I)),_e.vec3.normalize(R,_e.vec3.add(R,I,_e.vec3.scale(R,dt,Math.tan(Y)*j)))}const oe=[];new vi(f,R).closestPointOnSphere($,F,oe);const ce=_e.vec3.normalize([],Fr(N,0)),we=_e.vec3.normalize([],Fr(N,1)),Ie=_e.vec3.normalize([],Fr(N,2)),me=_e.vec3.dot(ce,oe),Re=_e.vec3.dot(we,oe),Ue=_e.vec3.dot(Ie,oe),$e=de(Math.asin(-Re/F));let ct=de(Math.atan2(me,Ue));ct=o.center.lng+function(xt,dt){const Et=(dt-xt+180)%360-180;return Et<-180?Et+360:Et}(o.center.lng,ct);const lt=Ya(ct),st=le(_o($e),0,1);return new c(lt,st)}class Pn{constructor(e,i,s){this.a=_e.vec3.sub([],e,s),this.b=_e.vec3.sub([],i,s),this.center=s;const f=_e.vec3.normalize([],this.a),l=_e.vec3.normalize([],this.b);this.angle=Math.acos(_e.vec3.dot(f,l))}}function $n(o,e){if(o.angle===0)return null;let i;return i=o.a[e]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[e]/o.a[e]/Math.sin(o.angle)-1/Math.tan(o.angle)),i<0||i>1?null:function(s,f,l,d){const R=Math.sin(l);return s*(Math.sin((1-d)*l)/R)+f*(Math.sin(d*l)/R)}(o.a[e],o.b[e],o.angle,le(i,0,1))+o.center[e]}function pn(o){if(o.z<=1)return Li[o.z+2*o.y+o.x];const e=qi(ji(o));return Xr.fromPoints(e)}function An(o,e,i){return _e.vec3.scale(o,o,1-i),_e.vec3.scaleAndAdd(o,o,e,i)}function Un(o,e,i){for(const s of o)_e.vec3.transformMat4(s,s,e),_e.vec3.scale(s,s,i)}function un(o,e,i,s){const f=e/o.worldSize,l=o.globeMatrix;if(i.z<=1){const lt=pn(i).getCorners();return Un(lt,l,f),Xr.fromPoints(lt)}const d=ji(i,s),R=qi(d,Hn+Ii(o._tileCoverLift));Un(R,l,f);const N=Number.MAX_VALUE,$=[-N,-N,-N],I=[N,N,N];if(d.contains(o.center)){for(const xt of R)_e.vec3.min(I,I,xt),_e.vec3.max($,$,xt);$[2]=0;const lt=o.point,st=[lt.x*f,lt.y*f,0];return _e.vec3.min(I,I,st),_e.vec3.max($,$,st),new Xr(I,$)}if(o._tileCoverLift>0){for(const lt of R)_e.vec3.min(I,I,lt),_e.vec3.max($,$,lt);return new Xr(I,$)}const j=[l[12]*f,l[13]*f,l[14]*f],H=d.getCenter(),F=le(o.center.lat,-85.051129,Wn),V=le(H.lat,-85.051129,Wn),Y=Ya(o.center.lng),oe=_o(F);let ce=Y-Ya(H.lng);const we=oe-_o(V);ce>.5?ce-=1:ce<-.5&&(ce+=1);let Ie=0;if(Math.abs(ce)>Math.abs(we))Ie=ce>=0?1:3;else{Ie=we>=0?0:2;const lt=[l[4]*f,l[5]*f,l[6]*f],st=-Math.sin(ze(we>=0?d.getSouth():d.getNorth()))*Hn;_e.vec3.scaleAndAdd(j,j,lt,st)}const me=R[Ie],Re=R[(Ie+1)%4],Ue=new Pn(me,Re,j),$e=[$n(Ue,0)||me[0],$n(Ue,1)||me[1],$n(Ue,2)||me[2]],ct=Zn(o.zoom);if(ct>0){const lt=function({x:xt,y:dt,z:Et},It,Mt,Ct,kt){const jt=1/(1<<Et);let Ot=xt*jt,Kt=Ot+jt,ur=dt*jt,Jt=ur+jt,yr=0;const _r=(Ot+Kt)/2-Ct;return _r>.5?yr=-1:_r<-.5&&(yr=1),Ot=((Ot+yr)*It-(Ct*=It))*Mt+Ct,Kt=((Kt+yr)*It-Ct)*Mt+Ct,ur=(ur*It-(kt*=It))*Mt+kt,Jt=(Jt*It-kt)*Mt+kt,[[Ot,Jt,0],[Kt,Jt,0],[Kt,ur,0],[Ot,ur,0]]}(i,e,o._pixelsPerMercatorPixel,Y,oe);for(let xt=0;xt<R.length;xt++)An(R[xt],lt[xt],ct);const st=_e.vec3.add([],lt[Ie],lt[(Ie+1)%4]);_e.vec3.scale(st,st,.5),An($e,st,ct)}for(const lt of R)_e.vec3.min(I,I,lt),_e.vec3.max($,$,lt);return I[2]=Math.min(me[2],Re[2]),_e.vec3.min(I,I,$e),_e.vec3.max($,$,$e),new Xr(I,$)}function ji({x:o,y:e,z:i},s=!1){const f=1/(1<<i),l=new Ai(la(o*f),e===(1<<i)-1&&s?-90:In((e+1)*f)),d=new Ai(la((o+1)*f),e===0&&s?90:In(e*f));return new Fo(l,d)}function qi(o,e=Hn){const i=ze(o.getNorth()),s=ze(o.getSouth()),f=Math.cos(i),l=Math.cos(s),d=Math.sin(i),R=Math.sin(s),N=o.getWest(),$=o.getEast();return[Xs(l,R,N,e),Xs(l,R,$,e),Xs(f,d,$,e),Xs(f,d,N,e)]}function wi(o,e,i,s){const f=1<<i.z,l=(o/wr+i.x)/f;return Bo(In((e/wr+i.y)/f),la(l),s)}function cn({min:o,max:e}){return Bd/Math.max(e[0]-o[0],e[1]-o[1],e[2]-o[2])}const Cn=new Float64Array(16);function Ni(o){const e=cn(o),i=_e.mat4.fromScaling(Cn,[e,e,e]);return _e.mat4.translate(i,i,_e.vec3.negate([],o.min))}function jn(o){const e=_e.mat4.fromTranslation(Cn,o.min),i=1/cn(o);return _e.mat4.scale(e,e,[i,i,i])}function ma(o){const e=wr/(2*Math.PI);return o/(2*Math.PI)/e}function ua(o,e){return wr/(512*Math.pow(2,o))*cn(pn(e))}function go(o,e,i,s,f){const l=ma(i),d=[o,e,-i/(2*Math.PI)],R=_e.mat4.identity(new Float64Array(16));return _e.mat4.translate(R,R,d),_e.mat4.scale(R,R,[l,l,l]),_e.mat4.rotateX(R,R,ze(-f)),_e.mat4.rotateY(R,R,ze(-s)),R}function Zn(o){return et(pc,kd,o)}function ja(o,e){const i=Bo(e.lat,e.lng),s=function(l){const d=Bo(l._center.lat,l._center.lng),R=_e.vec3.fromValues(0,1,0);let N=_e.vec3.cross([],R,d);const $=_e.mat4.fromRotation([],-l.angle,d);N=_e.vec3.transformMat4(N,N,$),_e.mat4.fromRotation($,-l._pitch,N);const I=_e.vec3.normalize([],d);return _e.vec3.scale(I,I,Ii(l.cameraToCenterDistance/l.pixelsPerMeter)),_e.vec3.transformMat4(I,I,$),_e.vec3.add([],d,I)}(o),f=_e.vec3.subtract([],s,i);return _e.vec3.angle(f,i)}function ca(o,e){return ja(o,e)>Math.PI/2*1.01}const No=ze(85),Ka=Math.cos(No),hs=Math.sin(No),$l=_e.mat4.create(),_c=o=>{const e=[];return o.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),o.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function gc(o,e,i,s,f,l,d,R,N){if(l&&o.queryGeometry.isAboveHorizon)return!1;l&&(N*=o.pixelToTileUnitsFactor);const $=o.tileID.canonical,I=i.projection.upVectorScale($,i.center.lat,i.worldSize).metersToTile;for(const j of e)for(const H of j){const F=H.add(R),V=f&&i.elevation?i.elevation.exaggeration()*f.getElevationAt(F.x,F.y,!0):0,Y=i.projection.projectTilePoint(F.x,F.y,$);if(V>0){const Ie=i.projection.upVector($,F.x,F.y);Y.x+=Ie[0]*I*V,Y.y+=Ie[1]*I*V,Y.z+=Ie[2]*I*V}const oe=l?F:NT(Y.x,Y.y,Y.z,s),ce=l?o.tilespaceRays.map(Ie=>jT(Ie,V)):o.queryGeometry.screenGeometry,we=_e.vec4.transformMat4([],[Y.x,Y.y,Y.z,1],s);if(!d&&l?N*=we[3]/i.cameraToCenterDistance:d&&!l&&(N*=i.cameraToCenterDistance/we[3]),l){const Ie=In((H.y/wr+$.y)/(1<<$.z));N/=i.projection.pixelsPerMeter(Ie,1)/qn(1,Ie)}if(Ye(ce,oe,N))return!0}return!1}function NT(o,e,i,s){const f=_e.vec4.transformMat4([],[o,e,i,1],s);return new Ge(f[0]/f[3],f[1]/f[3])}const g1=_e.vec3.fromValues(0,0,0),UT=_e.vec3.fromValues(0,0,1);function jT(o,e){const i=_e.vec3.create();return g1[2]=e,o.intersectsPlane(g1,UT,i),new Ge(i[0],i[1])}class y1 extends je{}let v1,b1,x1,w1;function E1(o,{width:e,height:i},s,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==e*i*s)throw new RangeError("mismatched image size")}else f=new Uint8Array(e*i*s);return o.width=e,o.height=i,o.data=f,o}function T1(o,e,i){const{width:s,height:f}=e;s===o.width&&f===o.height||(Vm(o,e,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,s),height:Math.min(o.height,f)},i,null),o.width=s,o.height=f,o.data=e.data)}function Vm(o,e,i,s,f,l,d,R){if(f.width===0||f.height===0)return e;if(f.width>o.width||f.height>o.height||i.x>o.width-f.width||i.y>o.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>e.width||f.height>e.height||s.x>e.width-f.width||s.y>e.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const N=o.data,$=e.data,I=l===4&&R;for(let j=0;j<f.height;j++){const H=((i.y+j)*o.width+i.x)*l,F=((s.y+j)*e.width+s.x)*l;if(I)for(let V=0;V<f.width;V++){const Y=H+V*l+3,oe=F+V*l;$[oe+0]=255,$[oe+1]=255,$[oe+2]=255,$[oe+3]=N[Y]}else if(d)for(let V=0;V<f.width;V++){const Y=H+V*l,oe=F+V*l,ce=N[Y+3],we=new Mi(N[Y+0]/255*ce,N[Y+1]/255*ce,N[Y+2]/255*ce,ce).toRenderColor(d).toArray();$[oe+0]=we[0],$[oe+1]=we[1],$[oe+2]=we[2],$[oe+3]=we[3]}else for(let V=0;V<f.width*l;V++)$[F+V]=N[H+V]}return e}Dr(y1,"HeatmapBucket",{omit:["layers"]});class Ks{constructor(e,i){E1(this,e,1,i)}resize(e){T1(this,new Ks(e),1)}clone(){return new Ks({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,f,l){Vm(e,i,s,f,l,1,null)}}class Xn{constructor(e,i){E1(this,e,4,i)}resize(e){T1(this,new Xn(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Xn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,f,l,d,R){Vm(e,i,s,f,l,4,d,R)}}class S1{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Hh(o){const e={},i=o.resolution||256,s=o.clips?o.clips.length:1,f=o.image||new Xn({width:i,height:s}),l=(d,R,N)=>{e[o.evaluationKey]=N;const $=o.expression.evaluate(e);$&&(f.data[d+R+0]=Math.floor(255*$.r/$.a),f.data[d+R+1]=Math.floor(255*$.g/$.a),f.data[d+R+2]=Math.floor(255*$.b/$.a),f.data[d+R+3]=Math.floor(255*$.a))};if(o.clips)for(let d=0,R=0;d<s;++d,R+=4*i)for(let N=0,$=0;N<i;N++,$+=4){const I=N/(i-1),{start:j,end:H}=o.clips[d];l(R,$,j*(1-I)+H*I)}else for(let d=0,R=0;d<i;d++,R+=4)l(0,R,d/(i-1));return f}Dr(Ks,"AlphaImage"),Dr(Xn,"RGBAImage");const VT=Ri([{name:"a_pos",components:2,type:"Int16"}],4),{members:GT}=VT;function qh(o,e,i=2){const s=e&&e.length,f=s?e[0]*i:o.length;let l=M1(o,0,f,i,!0);const d=[];if(!l||l.next===l.prev)return d;let R,N,$;if(s&&(l=function(I,j,H,F){const V=[];for(let Y=0,oe=j.length;Y<oe;Y++){const ce=M1(I,j[Y]*F,Y<oe-1?j[Y+1]*F:I.length,F,!1);ce===ce.next&&(ce.steiner=!0),V.push(KT(ce))}V.sort(ZT);for(let Y=0;Y<V.length;Y++)H=XT(V[Y],H);return H}(o,e,l,i)),o.length>80*i){R=1/0,N=1/0;let I=-1/0,j=-1/0;for(let H=i;H<f;H+=i){const F=o[H],V=o[H+1];F<R&&(R=F),V<N&&(N=V),F>I&&(I=F),V>j&&(j=V)}$=Math.max(I-R,j-N),$=$!==0?32767/$:0}return Wh(l,d,i,R,N,$,0),d}function M1(o,e,i,s,f){let l;if(f===function(d,R,N,$){let I=0;for(let j=R,H=N-$;j<N;j+=$)I+=(d[H]-d[j])*(d[j+1]+d[H+1]),H=j;return I}(o,e,i,s)>0)for(let d=e;d<i;d+=s)l=P1(d/s|0,o[d],o[d+1],l);else for(let d=i-s;d>=e;d-=s)l=P1(d/s|0,o[d],o[d+1],l);return l&&Ud(l,l.next)&&(Zh(l),l=l.next),l}function Zl(o,e){if(!o)return o;e||(e=o);let i,s=o;do if(i=!1,s.steiner||!Ud(s,s.next)&&Tn(s.prev,s,s.next)!==0)s=s.next;else{if(Zh(s),s=e=s.prev,s===s.next)break;i=!0}while(i||s!==e);return e}function Wh(o,e,i,s,f,l,d){if(!o)return;!d&&l&&function(N,$,I,j){let H=N;do H.z===0&&(H.z=Gm(H.x,H.y,$,I,j)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next;while(H!==N);H.prevZ.nextZ=null,H.prevZ=null,function(F){let V,Y=1;do{let oe,ce=F;F=null;let we=null;for(V=0;ce;){V++;let Ie=ce,me=0;for(let Ue=0;Ue<Y&&(me++,Ie=Ie.nextZ,Ie);Ue++);let Re=Y;for(;me>0||Re>0&&Ie;)me!==0&&(Re===0||!Ie||ce.z<=Ie.z)?(oe=ce,ce=ce.nextZ,me--):(oe=Ie,Ie=Ie.nextZ,Re--),we?we.nextZ=oe:F=oe,oe.prevZ=we,we=oe;ce=Ie}we.nextZ=null,Y*=2}while(V>1)}(H)}(o,s,f,l);let R=o;for(;o.prev!==o.next;){const N=o.prev,$=o.next;if(l?qT(o,s,f,l):HT(o))e.push(N.i,o.i,$.i),Zh(o),o=$.next,R=$.next;else if((o=$)===R){d?d===1?Wh(o=WT(Zl(o),e),e,i,s,f,l,2):d===2&&$T(o,e,i,s,f,l):Wh(Zl(o),e,i,s,f,l,1);break}}}function HT(o){const e=o.prev,i=o,s=o.next;if(Tn(e,i,s)>=0)return!1;const f=e.x,l=i.x,d=s.x,R=e.y,N=i.y,$=s.y,I=f<l?f<d?f:d:l<d?l:d,j=R<N?R<$?R:$:N<$?N:$,H=f>l?f>d?f:d:l>d?l:d,F=R>N?R>$?R:$:N>$?N:$;let V=s.next;for(;V!==e;){if(V.x>=I&&V.x<=H&&V.y>=j&&V.y<=F&&yc(f,R,l,N,d,$,V.x,V.y)&&Tn(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function qT(o,e,i,s){const f=o.prev,l=o,d=o.next;if(Tn(f,l,d)>=0)return!1;const R=f.x,N=l.x,$=d.x,I=f.y,j=l.y,H=d.y,F=R<N?R<$?R:$:N<$?N:$,V=I<j?I<H?I:H:j<H?j:H,Y=R>N?R>$?R:$:N>$?N:$,oe=I>j?I>H?I:H:j>H?j:H,ce=Gm(F,V,e,i,s),we=Gm(Y,oe,e,i,s);let Ie=o.prevZ,me=o.nextZ;for(;Ie&&Ie.z>=ce&&me&&me.z<=we;){if(Ie.x>=F&&Ie.x<=Y&&Ie.y>=V&&Ie.y<=oe&&Ie!==f&&Ie!==d&&yc(R,I,N,j,$,H,Ie.x,Ie.y)&&Tn(Ie.prev,Ie,Ie.next)>=0||(Ie=Ie.prevZ,me.x>=F&&me.x<=Y&&me.y>=V&&me.y<=oe&&me!==f&&me!==d&&yc(R,I,N,j,$,H,me.x,me.y)&&Tn(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;Ie&&Ie.z>=ce;){if(Ie.x>=F&&Ie.x<=Y&&Ie.y>=V&&Ie.y<=oe&&Ie!==f&&Ie!==d&&yc(R,I,N,j,$,H,Ie.x,Ie.y)&&Tn(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.prevZ}for(;me&&me.z<=we;){if(me.x>=F&&me.x<=Y&&me.y>=V&&me.y<=oe&&me!==f&&me!==d&&yc(R,I,N,j,$,H,me.x,me.y)&&Tn(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function WT(o,e){let i=o;do{const s=i.prev,f=i.next.next;!Ud(s,f)&&A1(s,i,i.next,f)&&$h(s,f)&&$h(f,s)&&(e.push(s.i,i.i,f.i),Zh(i),Zh(i.next),i=o=f),i=i.next}while(i!==o);return Zl(i)}function $T(o,e,i,s,f,l){let d=o;do{let R=d.next.next;for(;R!==d.prev;){if(d.i!==R.i&&JT(d,R)){let N=I1(d,R);return d=Zl(d,d.next),N=Zl(N,N.next),Wh(d,e,i,s,f,l,0),void Wh(N,e,i,s,f,l,0)}R=R.next}d=d.next}while(d!==o)}function ZT(o,e){return o.x-e.x}function XT(o,e){const i=function(f,l){let d=l;const R=f.x,N=f.y;let $,I=-1/0;do{if(N<=d.y&&N>=d.next.y&&d.next.y!==d.y){const Y=d.x+(N-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(Y<=R&&Y>I&&(I=Y,$=d.x<d.next.x?d:d.next,Y===R))return $}d=d.next}while(d!==l);if(!$)return null;const j=$,H=$.x,F=$.y;let V=1/0;d=$;do{if(R>=d.x&&d.x>=H&&R!==d.x&&yc(N<F?R:I,N,H,F,N<F?I:R,N,d.x,d.y)){const Y=Math.abs(N-d.y)/(R-d.x);$h(d,f)&&(Y<V||Y===V&&(d.x>$.x||d.x===$.x&&YT($,d)))&&($=d,V=Y)}d=d.next}while(d!==j);return $}(o,e);if(!i)return e;const s=I1(i,o);return Zl(s,s.next),Zl(i,i.next)}function YT(o,e){return Tn(o.prev,o,e.prev)<0&&Tn(e.next,o,o.next)<0}function Gm(o,e,i,s,f){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-i)*f|0)|o<<8))|o<<4))|o<<2))|o<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*f|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function KT(o){let e=o,i=o;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==o);return i}function yc(o,e,i,s,f,l,d,R){return(f-d)*(e-R)>=(o-d)*(l-R)&&(o-d)*(s-R)>=(i-d)*(e-R)&&(i-d)*(l-R)>=(f-d)*(s-R)}function JT(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!function(i,s){let f=i;do{if(f.i!==i.i&&f.next.i!==i.i&&f.i!==s.i&&f.next.i!==s.i&&A1(f,f.next,i,s))return!0;f=f.next}while(f!==i);return!1}(o,e)&&($h(o,e)&&$h(e,o)&&function(i,s){let f=i,l=!1;const d=(i.x+s.x)/2,R=(i.y+s.y)/2;do f.y>R!=f.next.y>R&&f.next.y!==f.y&&d<(f.next.x-f.x)*(R-f.y)/(f.next.y-f.y)+f.x&&(l=!l),f=f.next;while(f!==i);return l}(o,e)&&(Tn(o.prev,o,e.prev)||Tn(o,e.prev,e))||Ud(o,e)&&Tn(o.prev,o,o.next)>0&&Tn(e.prev,e,e.next)>0)}function Tn(o,e,i){return(e.y-o.y)*(i.x-e.x)-(e.x-o.x)*(i.y-e.y)}function Ud(o,e){return o.x===e.x&&o.y===e.y}function A1(o,e,i,s){const f=Vd(Tn(o,e,i)),l=Vd(Tn(o,e,s)),d=Vd(Tn(i,s,o)),R=Vd(Tn(i,s,e));return f!==l&&d!==R||!(f!==0||!jd(o,i,e))||!(l!==0||!jd(o,s,e))||!(d!==0||!jd(i,o,s))||!(R!==0||!jd(i,e,s))}function jd(o,e,i){return e.x<=Math.max(o.x,i.x)&&e.x>=Math.min(o.x,i.x)&&e.y<=Math.max(o.y,i.y)&&e.y>=Math.min(o.y,i.y)}function Vd(o){return o>0?1:o<0?-1:0}function $h(o,e){return Tn(o.prev,o,o.next)<0?Tn(o,e,o.next)>=0&&Tn(o,o.prev,e)>=0:Tn(o,e,o.prev)<0||Tn(o,o.next,e)<0}function I1(o,e){const i=Hm(o.i,o.x,o.y),s=Hm(e.i,e.x,e.y),f=o.next,l=e.prev;return o.next=e,e.prev=o,i.next=f,f.prev=i,s.next=i,i.prev=s,l.next=s,s.prev=l,s}function P1(o,e,i,s){const f=Hm(o,e,i);return s?(f.next=s.next,f.prev=s,s.next.prev=f,s.next=f):(f.prev=f,f.next=f),f}function Zh(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Hm(o,e,i){return{i:o,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Gd(o,e){const i=o.length;if(i<=1)return[o];const s=[];let f,l;for(let d=0;d<i;d++){const R=ir(o[d]);R!==0&&(o[d].area=Math.abs(R),l===void 0&&(l=R<0),l===R<0?(f&&s.push(f),f=[o[d]]):f.push(o[d]))}if(f&&s.push(f),e>1)for(let d=0;d<s.length;d++)s[d].length<=e||(Hf(s[d],e,1,s[d].length-1,QT),s[d]=s[d].slice(0,e));return s}function QT(o,e){return e.area-o.area}function C1(o,e){if(!o)return null;const i=typeof o=="string"?o:o.getPrimary().id;e[i]||(e[i]=[]);const s=Mn.from(o).getPrimary();return e[i].push(s),s.serialize()}function qm(o,e,i){const s=i.patternDependencies;let f=!1;for(const l of e){const d=l.paint.get(`${o}-pattern`);d.isConstant()||(f=!0),C1(d.constantOr(null),s)&&(f=!0)}return f}function Wm(o,e,i,s,f){const l=f.patternDependencies;for(const d of e){const R=d.paint.get(`${o}-pattern`).value;if(R.kind!=="constant"){let N=R.evaluate({zoom:s},i,{},f.availableImages);N=N&&N.name?N.name:N;const $=C1(N,l);$&&(i.patterns[d.id]=$)}}return i}class $m{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Fa,this.indexArray=new zn,this.indexArray2=new Oo,this.programConfigurations=new ko(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new hn,this.segments2=new hn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}updateFootprints(e,i){}populate(e,i,s,f){this.hasPattern=qm("fill",this.layers,i);const l=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:R,id:N,index:$,sourceLayerIndex:I}of e){const j=this.layers[0]._featureFilter.needGeometry,H=fe(R,j);if(!this.layers[0]._featureFilter.filter(new Xi(this.zoom),H,s))continue;const F=l?l.evaluate(H,{},s,i.availableImages):void 0,V={id:N,properties:R.properties,type:R.type,sourceLayerIndex:I,index:$,geometry:j?H.geometry:he(R,s,f),patterns:{},sortKey:F};d.push(V)}l&&d.sort((R,N)=>R.sortKey-N.sortKey);for(const R of d){const{geometry:N,index:$,sourceLayerIndex:I}=R;if(this.hasPattern){const j=Wm("fill",this.layers,R,this.zoom,i);this.patternFeatures.push(j)}else this.addFeature(R,N,$,s,{},i.availableImages,i.brightness);i.featureIndex.insert(e[$].feature,N,$,I,this.index)}}update(e,i,s,f,l,d,R){this.programConfigurations.updatePaintArrays(e,i,l,s,f,d,R)}addFeatures(e,i,s,f,l,d){for(const R of this.patternFeatures)this.addFeature(R,R.geometry,R.index,i,s,f,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,GT),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,s,f,l,d=[],R){for(const N of Gd(i,500)){let $=0;for(const Y of N)$+=Y.length;const I=this.segments.prepareSegment($,this.layoutVertexArray,this.indexArray),j=I.vertexLength,H=[],F=[];for(const Y of N){if(Y.length===0)continue;Y!==N[0]&&F.push(H.length/2);const oe=this.segments2.prepareSegment(Y.length,this.layoutVertexArray,this.indexArray2),ce=oe.vertexLength;this.layoutVertexArray.emplaceBack(Y[0].x,Y[0].y),this.indexArray2.emplaceBack(ce+Y.length-1,ce),H.push(Y[0].x),H.push(Y[0].y);for(let we=1;we<Y.length;we++)this.layoutVertexArray.emplaceBack(Y[we].x,Y[we].y),this.indexArray2.emplaceBack(ce+we-1,ce+we),H.push(Y[we].x),H.push(Y[we].y);oe.vertexLength+=Y.length,oe.primitiveLength+=Y.length}const V=qh(H,F);for(let Y=0;Y<V.length;Y+=3)this.indexArray.emplaceBack(j+V[Y],j+V[Y+1],j+V[Y+2]);I.vertexLength+=$,I.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,l,d,f,R)}}let R1,D1,L1,O1;Dr($m,"FillBucket",{omit:["layers","patternFeatures"]});class Zm{constructor(e,i,s,f){if(this.triangleCount=i.length/3,this.min=new Ge(0,0),this.max=new Ge(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[l,d]=[e[0].clone(),e[0].clone()];for(let j=1;j<e.length;++j){const H=e[j];l.x=Math.min(l.x,H.x),l.y=Math.min(l.y,H.y),d.x=Math.max(d.x,H.x),d.y=Math.max(d.y,H.y)}if(f){const j=Math.ceil(Math.max(d.x-l.x,d.y-l.y)/f);s=Math.max(s,j)}if(s===0)return;this.min=l,this.max=d;const R=this.max.sub(this.min);R.x=Math.max(R.x,1),R.y=Math.max(R.y,1);const N=Math.max(R.x,R.y)/s;this.cellsX=Math.max(1,Math.ceil(R.x/N)),this.cellsY=Math.max(1,Math.ceil(R.y/N)),this.xScale=1/N,this.yScale=1/N;const $=[];for(let j=0;j<this.triangleCount;j++){const H=e[i[3*j+0]].sub(this.min),F=e[i[3*j+1]].sub(this.min),V=e[i[3*j+2]].sub(this.min),Y=Uo(Math.floor(Math.min(H.x,F.x,V.x)),this.xScale,this.cellsX),oe=Uo(Math.floor(Math.max(H.x,F.x,V.x)),this.xScale,this.cellsX),ce=Uo(Math.floor(Math.min(H.y,F.y,V.y)),this.yScale,this.cellsY),we=Uo(Math.floor(Math.max(H.y,F.y,V.y)),this.yScale,this.cellsY),Ie=new Ge(0,0),me=new Ge(0,0),Re=new Ge(0,0),Ue=new Ge(0,0);for(let $e=ce;$e<=we;++$e){Ie.y=me.y=$e*N,Re.y=Ue.y=($e+1)*N;for(let ct=Y;ct<=oe;++ct)Ie.x=Re.x=ct*N,me.x=Ue.x=(ct+1)*N,(Pt(H,F,V,Ie,me,Ue)||Pt(H,F,V,Ie,Ue,Re))&&$.push({cellIdx:$e*this.cellsX+ct,triIdx:j})}}if($.length===0)return;$.sort((j,H)=>j.cellIdx-H.cellIdx||j.triIdx-H.triIdx);let I=0;for(;I<$.length;){const j=$[I].cellIdx,H={start:this.payload.length,len:0};for(;I<$.length&&$[I].cellIdx===j;)++H.len,this.payload.push($[I++].triIdx);this.cells[j]=H}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const s=Uo(e.x-this.min.x,this.xScale,this.cellsX),f=Uo(e.y-this.min.y,this.yScale,this.cellsY),l=this.cells[f*this.cellsX+s];if(l){this._lazyInitLookup();for(let d=0;d<l.len;d++){const R=this.payload[l.start+d],N=Math.floor(R/8),$=1<<R%8;if(!(this.lookup[N]&$)&&(this.lookup[N]|=$,i.push(R),i.length===this.triangleCount))return}}}query(e,i,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const f=Uo(e.x-this.min.x,this.xScale,this.cellsX),l=Uo(i.x-this.min.x,this.xScale,this.cellsX),d=Uo(e.y-this.min.y,this.yScale,this.cellsY),R=Uo(i.y-this.min.y,this.yScale,this.cellsY);for(let N=d;N<=R;N++)for(let $=f;$<=l;$++){const I=this.cells[N*this.cellsX+$];if(I)for(let j=0;j<I.len;j++){const H=this.payload[I.start+j],F=Math.floor(H/8),V=1<<H%8;if(!(this.lookup[F]&V)&&(this.lookup[F]|=V,s.push(H),s.length===this.triangleCount))return}}}}function Uo(o,e,i){return Math.max(0,Math.min(i-1,Math.floor(o*e)))}Dr(Zm,"TriangleGridIndex");class z1{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[]}updateFootprints(e,i){for(const s of this.footprints)i.push({footprint:s,id:e})}populate(e,i,s,f){const l=[];for(const{feature:d,id:R,index:N,sourceLayerIndex:$}of e){const I=this.layers[0]._featureFilter.needGeometry,j=fe(d,I);if(!this.layers[0]._featureFilter.filter(new Xi(this.zoom),j,s))continue;const H={id:R,properties:d.properties,type:d.type,sourceLayerIndex:$,index:N,geometry:I?j.geometry:he(d,s,f),patterns:{}};l.push(H)}for(const d of l){const{geometry:R,index:N,sourceLayerIndex:$}=d;this.addFeature(d,R,N,s,{},i.availableImages,i.brightness),i.featureIndex.insert(e[N].feature,R,N,$,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,s,f,l,d,R){}destroy(){}addFeature(e,i,s,f,l,d=[],R){for(const N of Gd(i,2)){const $=[],I=[],j=[],H=new Ge(1/0,1/0),F=new Ge(-1/0,-1/0);for(const oe of N)if(oe.length!==0){oe!==N[0]&&j.push(I.length/2);for(let ce=0;ce<oe.length;ce++)I.push(oe[ce].x),I.push(oe[ce].y),$.push(oe[ce]),H.x=Math.min(H.x,oe[ce].x),H.y=Math.min(H.y,oe[ce].y),F.x=Math.max(F.x,oe[ce].x),F.y=Math.max(F.y,oe[ce].y)}const V=qh(I,j),Y=new Zm($,V,8,256);this.footprints.push({vertices:$,indices:V,grid:Y,min:H,max:F})}}}Dr(z1,"ClipBucket",{omit:["layers"]});const eS=Ri([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),tS=Ri([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),rS=Ri([{name:"a_centroid_pos",components:2,type:"Uint16"}]),iS=Ri([{name:"a_join_normal_inside",components:3,type:"Int16"}]),nS=Ri([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),aS=Ri([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:oS}=eS;var Xm,k1,Ym,B1,Km,F1,N1,Hd={};function U1(){if(k1)return Xm;k1=1;var o=tt();function e(f,l,d,R,N){this.properties={},this.extent=d,this.type=0,this._pbf=f,this._geometry=-1,this._keys=R,this._values=N,f.readFields(i,this,l)}function i(f,l,d){f==1?l.id=d.readVarint():f==2?function(R,N){for(var $=R.readVarint()+R.pos;R.pos<$;){var I=N._keys[R.readVarint()],j=N._values[R.readVarint()];N.properties[I]=j}}(d,l):f==3?l.type=d.readVarint():f==4&&(l._geometry=d.pos)}function s(f){for(var l,d,R=0,N=0,$=f.length,I=$-1;N<$;I=N++)R+=((d=f[I]).x-(l=f[N]).x)*(l.y+d.y);return R}return Xm=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var l,d=f.readVarint()+f.pos,R=1,N=0,$=0,I=0,j=[];f.pos<d;){if(N<=0){var H=f.readVarint();R=7&H,N=H>>3}if(N--,R===1||R===2)$+=f.readSVarint(),I+=f.readSVarint(),R===1&&(l&&j.push(l),l=[]),l.push(new o($,I));else{if(R!==7)throw new Error("unknown command "+R);l&&l.push(l[0].clone())}}return l&&j.push(l),j},e.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var l=f.readVarint()+f.pos,d=1,R=0,N=0,$=0,I=1/0,j=-1/0,H=1/0,F=-1/0;f.pos<l;){if(R<=0){var V=f.readVarint();d=7&V,R=V>>3}if(R--,d===1||d===2)(N+=f.readSVarint())<I&&(I=N),N>j&&(j=N),($+=f.readSVarint())<H&&(H=$),$>F&&(F=$);else if(d!==7)throw new Error("unknown command "+d)}return[I,H,j,F]},e.prototype.toGeoJSON=function(f,l,d){var R,N,$=this.extent*Math.pow(2,d),I=this.extent*f,j=this.extent*l,H=this.loadGeometry(),F=e.types[this.type];function V(ce){for(var we=0;we<ce.length;we++){var Ie=ce[we];ce[we]=[360*(Ie.x+I)/$-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ie.y+j)/$)*Math.PI/180))-90]}}switch(this.type){case 1:var Y=[];for(R=0;R<H.length;R++)Y[R]=H[R][0];V(H=Y);break;case 2:for(R=0;R<H.length;R++)V(H[R]);break;case 3:for(H=function(ce){var we=ce.length;if(we<=1)return[ce];for(var Ie,me,Re=[],Ue=0;Ue<we;Ue++){var $e=s(ce[Ue]);$e!==0&&(me===void 0&&(me=$e<0),me===$e<0?(Ie&&Re.push(Ie),Ie=[ce[Ue]]):Ie.push(ce[Ue]))}return Ie&&Re.push(Ie),Re}(H),R=0;R<H.length;R++)for(N=0;N<H[R].length;N++)V(H[R][N])}H.length===1?H=H[0]:F="Multi"+F;var oe={type:"Feature",geometry:{type:F,coordinates:H},properties:this.properties};return"id"in this&&(oe.id=this.id),oe},Xm}function j1(){if(B1)return Ym;B1=1;var o=U1();function e(s,f){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(i,this,f),this.length=this._features.length}function i(s,f,l){s===15?f.version=l.readVarint():s===1?f.name=l.readString():s===5?f.extent=l.readVarint():s===2?f._features.push(l.pos):s===3?f._keys.push(l.readString()):s===4&&f._values.push(function(d){for(var R=null,N=d.readVarint()+d.pos;d.pos<N;){var $=d.readVarint()>>3;R=$===1?d.readString():$===2?d.readFloat():$===3?d.readDouble():$===4?d.readVarint64():$===5?d.readVarint():$===6?d.readSVarint():$===7?d.readBoolean():null}return R}(l))}return Ym=e,e.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var f=this._pbf.readVarint()+this._pbf.pos;return new o(this._pbf,f,this.extent,this._keys,this._values)},Ym}function V1(){return N1||(N1=1,Hd.VectorTile=function(){if(F1)return Km;F1=1;var o=j1();function e(i,s,f){if(i===3){var l=new o(f,f.readVarint()+f.pos);l.length&&(s[l.name]=l)}}return Km=function(i,s){this.layers=i.readFields(e,{},s)},Km}(),Hd.VectorTileFeature=U1(),Hd.VectorTileLayer=j1()),Hd}var vc=V1();class Xl extends Ge{constructor(e,i,s){super(e,i),this.z=s}}class G1 extends Xl{constructor(e,i,s,f){super(e,i,s),this.w=f}}function qd(o,e,i,s){const f=[],l=s===0?(d,R,N,$,I,j)=>{d.push(new Ge(j,N+(j-R)/($-R)*(I-N)))}:(d,R,N,$,I,j)=>{d.push(new Ge(R+(j-N)/(I-N)*($-R),j))};for(const d of o){const R=[];for(const N of d){if(N.length<=2)continue;const $=[];for(let H=0;H<N.length-1;H++){const F=N[H].x,V=N[H].y,Y=N[H+1].x,oe=N[H+1].y,ce=s===0?F:V,we=s===0?Y:oe;ce<e?we>e&&l($,F,V,Y,oe,e):ce>i?we<i&&l($,F,V,Y,oe,i):$.push(N[H]),we<e&&ce>=e&&l($,F,V,Y,oe,e),we>i&&ce<=i&&l($,F,V,Y,oe,i)}let I=N[N.length-1];const j=s===0?I.x:I.y;j>=e&&j<=i&&$.push(I),$.length&&(I=$[$.length-1],$[0].x===I.x&&$[0].y===I.y||$.push($[0]),R.push($))}R.length&&f.push(R)}return f}function H1(o,e,i,s){const f=i==="x"?"y":"x",l=(s-o[i])/(e[i]-o[i]);o[f]=o[f]+(e[f]-o[f])*l,o[i]=s,o.hasOwnProperty("z")&&(o.z=Qr(o.z,e.z,l)),o.hasOwnProperty("w")&&(o.w=Qr(o.w,e.w,l))}function q1(o,e,i,s){const f=i,l=s;for(const d of["x","y"]){let R=o,N=e;R[d]>=N[d]&&(R=e,N=o),R[d]<f&&N[d]>f&&H1(R,N,d,f),R[d]<l&&N[d]>l&&H1(N,R,d,l)}}const Wd=Number.MAX_SAFE_INTEGER;function W1(o,e,i,s){return o.order<e||o.order===Wd||!(o.clipMask&i)||function(f,l){return l.length!==0&&l.find(d=>d===f)===void 0}(s,o.clipScope)}function $d(o,e){return o.x-e.x||o.y-e.y}function $1(o,e){return $d(o.min,e.min)===0&&$d(o.max,e.max)===0}function Jm(o,e){return!(o.min.x>e.max.x||o.max.x<e.min.x||o.min.y>e.max.y||o.max.y<e.min.y)}function Qm(o,e){if(o.length!==e.length)return!1;for(let i=0;i<o.length;i++)if(o[i].sourceId!==e[i].sourceId||!$1(o[i],e[i])||o[i].order!==e[i].order||o[i].clipMask!==e[i].clipMask||!We(o[i].clipScope,e[i].clipScope))return!1;return!0}function Z1(o,e,i){const s=1/wr,f=1/(1<<i.canonical.z),l=(e.x*s+i.canonical.x)*f+i.wrap,d=(e.y*s+i.canonical.y)*f;return{min:new Ge((o.x*s+i.canonical.x)*f+i.wrap,(o.y*s+i.canonical.y)*f),max:new Ge(l,d)}}function sS(o,e,i){const s=1<<i.canonical.z,f=((e.x-i.wrap)*s-i.canonical.x)*wr,l=(e.y*s-i.canonical.y)*wr;return{min:new Ge(((o.x-i.wrap)*s-i.canonical.x)*wr,(o.y*s-i.canonical.y)*wr),max:new Ge(f,l)}}function X1(o,e,i,s,f,l,d){const R=o.indices,N=o.vertices,$=[];for(let I=s;I<s+f;I+=3){const j=e[i[I+0]+l],H=e[i[I+1]+l],F=e[i[I+2]+l],V=Math.min(j.x,H.x,F.x),Y=Math.max(j.x,H.x,F.x),oe=Math.min(j.y,H.y,F.y),ce=Math.max(j.y,H.y,F.y);$.length=0,o.grid.query(new Ge(V,oe),new Ge(Y,ce),$);for(let we=0;we<$.length;we++){const Ie=$[we];if(Pt(N[R[3*Ie+0]],N[R[3*Ie+1]],N[R[3*Ie+2]],j,H,F,d))return!0}}return!1}function Y1(o,e,i,s){if(!o||!i)return!1;let f=o.vertices;if(!e.canonical.equals(s.canonical)||e.wrap!==s.wrap){if(i.vertices.length<o.vertices.length)return Y1(i,s,o,e);const l=e.canonical,d=s.canonical,R=Math.pow(2,d.z-l.z);f=o.vertices.map(N=>new Ge((N.x+l.x*wr)*R-d.x*wr,(N.y+l.y*wr)*R-d.y*wr))}return X1(i,f,o.indices,0,o.indices.length,0,0)}function K1(o,e,i,s){const f=Math.pow(2,s.z-i.z);return new Ge((o+i.x*wr)*f-s.x*wr,(e+i.y*wr)*f-s.y*wr)}function J1(o,e){const i=[];e.grid.queryPoint(o,i);const s=e.indices,f=e.vertices;for(let l=0;l<i.length;l++){const d=i[l];if(Tt([f[s[3*d+0]],f[s[3*d+1]],f[s[3*d+2]]],o))return!0}return!1}const e_=[new Ge(0,0),new Ge(wr,0),new Ge(wr,wr),new Ge(0,wr)];function Q1(o,e){const i=[];let s=[];if(!e||o.length<2)return[o];if(o.length===2)return Zt(o[0],o[1],e_)?[o]:[];for(let f=0;f<o.length+2;f++){const l=o[f%o.length],d=o[(f+1)%o.length],R=Zt(f===0?o[o.length-1]:o[(f-1)%o.length],l,e_),N=Zt(l,d,e_),$=R||N;$&&s.push(l),$&&N||s.length>0&&(s.length>1&&i.push(s),s=[])}return s.length>1&&i.push(s),i}const t_=vc.VectorTileFeature.types,lS=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],uS=["fill-extrusion-flood-light-ground-radius"],cS=Math.pow(2,13),hS=Math.pow(2,15)-1,ev=new Ge(0,1),Js=2147483648;function Xh(o,e,i,s,f,l,d,R){o.emplaceBack((e<<1)+d,(i<<1)+l,(Math.floor(s*cS)<<1)+f,Math.round(R))}function Yh(o,e,i){o.emplaceBack(e.x*wr,e.y*wr,i?1:0)}function Zd(o,e,i,s,f,l){o.emplaceBack(e.x,e.y,(i.x<<1)+s,(i.y<<1)+f,l)}function Kh(o,e,i){o.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class tv{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class rv{constructor(){this.centroidXY=new Ge(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ge(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ge(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ge(this.max.x-this.min.x,this.max.y-this.min.y)}}class iv{constructor(){this.acc=new Ge(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,s){this.accCount++,this.acc._add(i);let f=!!this.borders;i.x<e.min.x?(e.min.x=i.x,f=!0):i.x>e.max.x&&(e.max.x=i.x,f=!0),i.y<e.min.y?(e.min.y=i.y,f=!0):i.y>e.max.y&&(e.max.y=i.y,f=!0),((i.x===0||i.x===wr)&&i.x===s.x)!=((i.y===0||i.y===wr)&&i.y===s.y)&&this.processBorderOverlap(i,s),f&&this.checkBorderIntersection(i,s)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Qr(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>wr!=e.x>wr&&this.addBorderIntersection(1,Qr(i.y,e.y,(wr-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Qr(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>wr!=e.y>wr&&this.addBorderIntersection(3,Qr(i.x,e.x,(wr-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,e.x)}}centroid(){return this.accCount===0?new Ge(0,0):new Ge(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function nv(o,e){const i=o.add(e)._unit(),s=le(o.x*i.x+o.y*i.y,-1,1);var f,l,d;return d=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(d)))/4*hS*((f=o).x*(l=e).y-f.y*l.x<0?-1:1)}const fS=[o=>o.x<0,o=>o.x>wr,o=>o.y<0,o=>o.y>wr];function dS(o,e,i,s){const f=[4];if(s===0)return f;i._mult(s);const l=o.sub(i),d=e.sub(i),R=[o,e,l,d];for(let N=0;N<4;N++)for(const $ of R)if(fS[N]($)){f.push(N);break}return f}class av{constructor(e){this.vertexArray=new Ih,this.indexArray=new zn,this.programConfigurations=new ko(e.layers,{zoom:e.zoom,lut:e.lut},i=>uS.includes(i)),this._segments=new hn,this.hiddenByLandmarkVertexArray=new uc,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new hn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,s,f=!1){const l=e.length;if(l>2){let d=Math.max(0,this._segments.get().length-1);const R=this._segments._prepareSegment(4*l,this.vertexArray.length,2*this._segmentToGroundQuads[d].length);let N;d!==this._segments.get().length-1&&(d++,this._segmentToGroundQuads[d]=[],this._segmentToRegionTriCounts[d]=[0,0,0,0,0]);{const $=e[0],I=e[1];N=nv($.sub(e[l-1])._perp()._unit(),I.sub($)._perp()._unit())}for(let $=0;$<l;$++){const I=$===l-1?0:$+1,j=e[$],H=e[I],F=e[I===l-1?0:I+1],V=H.sub(j)._perp()._unit(),Y=nv(V,F.sub(H)._perp()._unit()),oe=N,ce=Y;if(r_(j,H,i)||f&&lv(j,i)&&lv(H,i)){N=Y;continue}const we=R.vertexLength;Zd(this.vertexArray,j,H,1,1,oe),Zd(this.vertexArray,j,H,1,0,oe),Zd(this.vertexArray,j,H,0,1,ce),Zd(this.vertexArray,j,H,0,0,ce),R.vertexLength+=4;const Ie=dS(j,H,V,s);for(const me of Ie)this._segmentToGroundQuads[d].push({id:we,region:me}),this._segmentToRegionTriCounts[d][me]+=2,R.primitiveLength+=2;N=Y}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let s=0;s<i;s++)this._segmentToGroundQuads[s].sort((f,l)=>f.region-l.region);for(let s=0;s<i;s++){const f=this._segmentToGroundQuads[s],l=e[s],d=this._segmentToRegionTriCounts[s];d.reduce((N,$)=>N+$,0);let R=0;for(let N=0;N<=4;N++){const $=d[N];if($!==0){let I=this.regionSegments[N];I||(I=this.regionSegments[N]=new hn);const j={vertexOffset:l.vertexOffset,primitiveOffset:l.primitiveOffset+R,vertexLength:l.vertexLength,primitiveLength:$};I.get().push(j)}R+=$}for(let N=0;N<f.length;N++){const $=f[N].id;this.indexArray.emplaceBack($,$+1,$+3),this.indexArray.emplaceBack($,$+3,$+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,s,f,l,d){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,s,f,l,d)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,tS.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,s,f,l,d,R){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,s,f,l,d,R)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const s=e.flags&Js?1:0;for(let f=e.groundVertexArrayOffset;f<i;++f)this.hiddenByLandmarkVertexArray.emplace(f,s);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,nS.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class Xd{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new zn,this.footprintVertices=new Fa,this.footprintSegments=[],this.layoutVertexArray=new Ro,this.centroidVertexArray=new Rd,this.wallVertexArray=new Ld,this.indexArray=new zn,this.programConfigurations=new ko(e.layers,{zoom:e.zoom,lut:e.lut},i=>lS.includes(i)),this.segments=new hn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new av(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,i){}populate(e,i,s,f){this.features=[],this.hasPattern=qm("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=n(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:l,id:d,index:R,sourceLayerIndex:N}of e){const $=this.layers[0]._featureFilter.needGeometry,I=fe(l,$);if(!this.layers[0]._featureFilter.filter(new Xi(this.zoom),I,s))continue;const j={id:d,sourceLayerIndex:N,index:R,geometry:$?I.geometry:he(l,s,f),properties:l.properties,type:l.type,patterns:{}},H=this.layoutVertexArray.length,F=t_[j.type]==="Polygon";if(this.hasPattern)this.features.push(Wm("fill-extrusion",this.layers,j,this.zoom,i));else if(this.wallMode)for(const V of j.geometry)for(const Y of Q1(V,F))this.addFeature(j,[Y],R,s,{},i.availableImages,f,i.brightness);else this.addFeature(j,j.geometry,R,s,{},i.availableImages,f,i.brightness);i.featureIndex.insert(l,j.geometry,R,N,this.index,H)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,s,f,l,d){for(const R of this.features){const N=t_[R.type]==="Polygon",{geometry:$}=R;if(this.wallMode)for(const I of $)for(const j of Q1(I,N))this.addFeature(R,[j],R.index,i,s,f,l,d);else this.addFeature(R,$,R.index,i,s,f,l,d)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,s,f,l,d,R){this.programConfigurations.updatePaintArrays(e,i,l,s,f,d,R),this.groundEffect.update(e,i,l,s,f,d,R)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,oS),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,iS.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,aS.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,rS.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,f,l,d,R,N){const $=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,I=[new Ge(0,0),new Ge(wr,wr)],j=R.projection,H=j.name==="globe",F=this.wallMode||t_[e.type]==="Polygon",V=new iv;V.centroidDataIndex=this.centroidData.length;const Y=new rv,oe=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},f)<=0,ce=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},f);let we;if(Y.height=ce,Y.vertexArrayOffset=this.layoutVertexArray.length,Y.groundVertexArrayOffset=this.groundEffect.vertexArray.length,H&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ic),this.wallMode){if(H)return void St("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;we=function(st){const xt=st[0].x===st[st.length-1].x&&st[0].y===st[st.length-1].y;(function(Er){let rr=0;const kr=Er.length;for(let vr=0;vr<kr;vr++)rr+=(Er[(vr+1)%kr].x-Er[vr].x)*(Er[(vr+1)%kr].y+Er[vr].y);return rr>=0})(st)||(st=st.reverse());const Et={geometry:[],joinNormals:[],indices:[]},It=[],Mt=[],Ct=[];let kt=st.length;for(;kt>=2&&st[kt-1].equals(st[kt-2]);)kt--;if(kt<(xt?3:2))return Et;let jt,Ot,Kt,ur,Jt,yr=0;for(;yr<kt-1&&st[yr].equals(st[yr+1]);)yr++;xt&&(jt=st[kt-2],Jt=st[yr].sub(jt)._unit()._perp());for(let Er=yr;Er<kt;Er++){if(Kt=Er===kt-1?xt?st[yr+1]:void 0:st[Er+1],Kt&&st[Er].equals(Kt))continue;Jt&&(ur=Jt),jt&&(Ot=jt),jt=st[Er],Jt=Kt?Kt.sub(jt)._unit()._perp():ur,ur=ur||Jt;let rr=ur.add(Jt);rr.x===0&&rr.y===0||rr._unit();const kr=rr.x*Jt.x+rr.y*Jt.y,vr=kr!==0?1/kr:1/0,zr=ur.x*Jt.y-ur.y*Jt.x>0;let Yr="miter";const li=2;Yr==="miter"&&vr>li&&(Yr="bevel"),Yr==="bevel"&&(vr>100&&(Yr="flipbevel"),vr<li&&(Yr="miter"));const ci=(_i,hi,yi,Vi)=>{const Bi=new Ge(_i.x,_i.y),ni=new Ge(_i.x,_i.y);Bi.x+=hi.x*Vi,Bi.y+=hi.y*Vi,ni.x-=hi.x*Math.max(yi,1),ni.y-=hi.y*Math.max(yi,1),Ct.push(hi),It.push(Bi),Mt.push(ni)};if(Yr==="miter")rr._mult(vr),ci(jt,rr,0,0);else if(Yr==="flipbevel")rr=Jt.mult(-1),ci(jt,rr,0,0),ci(jt,rr.mult(-1),0,0);else{const _i=-Math.sqrt(vr*vr-1),hi=zr?_i:0,yi=zr?0:_i;Ot&&ci(jt,ur,hi,yi),Kt&&ci(jt,Jt,hi,yi)}}Et.geometry=[...It,...Mt.reverse(),It[0]],Et.joinNormals=[...Ct,...Ct.reverse(),Ct[Ct.length-1]];const _r=Et.geometry.length-1;for(let Er=0;Er<_r/2;Er++)if(Er+1<_r/2){let rr=Er,kr=Er+1,vr=_r-1-Er,zr=_r-2-Er;rr=rr===0?_r-1:rr-1,kr=kr===0?_r-1:kr-1,vr=vr===0?_r-1:vr-1,zr=zr===0?_r-1:zr-1,Et.indices.push(vr),Et.indices.push(kr),Et.indices.push(rr),Et.indices.push(vr),Et.indices.push(zr),Et.indices.push(kr)}return Et}(i[0]),i=[we.geometry]}const Ie=(st,xt)=>st<(xt.length-1)/2||st===xt.length-1,me=this.wallMode?[i]:Gd(i,500);for(let st=me.length-1;st>=0;st--){const xt=me[st];(xt.length===0||(Re=xt[0]).every(dt=>dt.x<=0)||Re.every(dt=>dt.x>=wr)||Re.every(dt=>dt.y<=0)||Re.every(dt=>dt.y>=wr))&&me.splice(st,1)}var Re;let Ue;if(H)Ue=fv(me,I,f);else{Ue=[];for(const st of me)Ue.push({polygon:st,bounds:I})}const $e=F?this.edgeRadius:0,ct=$e>0&&this.zoom<17,lt=(st,xt)=>{if(st.length===0)return!1;const dt=st[st.length-1];return xt.x===dt.x&&xt.y===dt.y};for(const{polygon:st,bounds:xt}of Ue){let dt=0,Et=0;for(const kt of st)F&&!kt[0].equals(kt[kt.length-1])&&kt.push(kt[0]),Et+=F?kt.length-1:kt.length;const It=this.segments.prepareSegment((F?5:4)*Et,this.layoutVertexArray,this.indexArray);Y.footprintSegIdx<0&&(Y.footprintSegIdx=this.footprintSegments.length),Y.polygonSegIdx<0&&(Y.polygonSegIdx=this.polygonSegments.length);const Mt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ct=new tv;if(Ct.vertexOffset=this.footprintVertices.length,Ct.indexOffset=3*this.footprintIndices.length,Ct.ringIndices=[],F){const kt=[],jt=[];dt=It.vertexLength;for(let Kt=0;Kt<st.length;Kt++){const ur=st[Kt];ur.length&&Kt!==0&&jt.push(kt.length/2);const Jt=[];let yr,_r;yr=ur[1].sub(ur[0])._perp()._unit(),Ct.ringIndices.push(ur.length-1);for(let Er=1;Er<ur.length;Er++){const rr=ur[Er],kr=ur[Er===ur.length-1?1:Er+1],vr=rr.clone();if($e){_r=kr.sub(rr)._perp()._unit();const zr=yr.add(_r)._unit(),Yr=$e*Math.min(4,1/(yr.x*zr.x+yr.y*zr.y));vr.x+=Yr*zr.x,vr.y+=Yr*zr.y,vr.x=Math.round(vr.x),vr.y=Math.round(vr.y),yr=_r}if(!oe||$e!==0&&!ct||lt(Jt,vr)||Jt.push(vr),Xh(this.layoutVertexArray,vr.x,vr.y,0,0,1,1,0),this.wallMode){const zr=Ie(Er,ur);Yh(this.wallVertexArray,we.joinNormals[Er],!zr)}It.vertexLength++,this.footprintVertices.emplaceBack(rr.x,rr.y),kt.push(rr.x,rr.y),H&&Kh(this.layoutVertexExtArray,j.projectTilePoint(vr.x,vr.y,f),j.upVector(f,vr.x,vr.y))}oe&&($e===0||ct)&&(Jt.length!==0&&lt(Jt,Jt[0])&&Jt.pop(),this.groundEffect.addData(Jt,xt,$))}const Ot=this.wallMode?we.indices:qh(kt,jt);for(let Kt=0;Kt<Ot.length;Kt+=3)this.footprintIndices.emplaceBack(Ct.vertexOffset+Ot[Kt+0],Ct.vertexOffset+Ot[Kt+1],Ct.vertexOffset+Ot[Kt+2]),this.indexArray.emplaceBack(dt+Ot[Kt],dt+Ot[Kt+2],dt+Ot[Kt+1]),It.primitiveLength++;Ct.indexCount+=Ot.length,Ct.vertexCount+=this.footprintVertices.length-Ct.vertexOffset}for(let kt=0;kt<st.length;kt++){const jt=st[kt];V.startRing(Y,jt[0]);let Ot=jt.length>4&&uv(jt[jt.length-2],jt[0],jt[1]),Kt=$e?pS(jt[jt.length-2],jt[0],jt[1],$e):0;const ur=[];let Jt,yr,_r;yr=jt[1].sub(jt[0])._perp()._unit();let Er=!0;for(let rr=1,kr=0;rr<jt.length;rr++){let vr=jt[rr-1],zr=jt[rr];const Yr=jt[rr===jt.length-1?1:rr+1];if(V.appendEdge(Y,zr,vr),r_(zr,vr,xt)){$e&&(yr=Yr.sub(zr)._perp()._unit(),Er=!Er);continue}const li=zr.sub(vr)._perp(),ci=li.x/(Math.abs(li.x)+Math.abs(li.y)),_i=li.y>0?1:0,hi=vr.dist(zr);if(kr+hi>32768&&(kr=0),$e){_r=Yr.sub(zr)._perp()._unit();let ni=sv(vr,zr,Yr,ov(yr,_r),$e);isNaN(ni)&&(ni=0);const Fi=zr.sub(vr)._unit();vr=vr.add(Fi.mult(Kt))._round(),zr=zr.add(Fi.mult(-ni))._round(),Kt=ni,yr=_r,oe&&this.zoom>=17&&(lt(ur,vr)||ur.push(vr),lt(ur,zr)||ur.push(zr))}const yi=It.vertexLength,Vi=jt.length>4&&uv(vr,zr,Yr);let Bi=cv(kr,Ot,Er);if(Xh(this.layoutVertexArray,vr.x,vr.y,ci,_i,0,0,Bi),Xh(this.layoutVertexArray,vr.x,vr.y,ci,_i,0,1,Bi),this.wallMode){const ni=Ie(rr-1,jt),Fi=we.joinNormals[rr-1];Yh(this.wallVertexArray,Fi,ni),Yh(this.wallVertexArray,Fi,ni)}if(kr+=hi,Bi=cv(kr,Vi,!Er),Ot=Vi,Xh(this.layoutVertexArray,zr.x,zr.y,ci,_i,0,0,Bi),Xh(this.layoutVertexArray,zr.x,zr.y,ci,_i,0,1,Bi),this.wallMode){const ni=Ie(rr,jt),Fi=we.joinNormals[rr];Yh(this.wallVertexArray,Fi,ni),Yh(this.wallVertexArray,Fi,ni)}if(It.vertexLength+=4,this.indexArray.emplaceBack(yi+0,yi+1,yi+2),this.indexArray.emplaceBack(yi+1,yi+3,yi+2),It.primitiveLength+=2,$e){const ni=dt+(rr===1?jt.length-2:rr-2),Fi=rr===1?dt:ni+1;if(this.indexArray.emplaceBack(yi+1,ni,yi+3),this.indexArray.emplaceBack(ni,Fi,yi+3),It.primitiveLength+=2,Jt===void 0&&(Jt=yi),!r_(Yr,jt[rr],xt)){const zi=rr===jt.length-1?Jt:It.vertexLength;this.indexArray.emplaceBack(yi+2,yi+3,zi),this.indexArray.emplaceBack(yi+3,zi+1,zi),this.indexArray.emplaceBack(yi+3,Fi,zi+1),It.primitiveLength+=3}Er=!Er}if(H){const ni=this.layoutVertexExtArray,Fi=j.projectTilePoint(vr.x,vr.y,f),zi=j.projectTilePoint(zr.x,zr.y,f),Gi=j.upVector(f,vr.x,vr.y),gn=j.upVector(f,zr.x,zr.y);Kh(ni,Fi,Gi),Kh(ni,Fi,Gi),Kh(ni,zi,gn),Kh(ni,zi,gn)}}F&&(dt+=jt.length-1),oe&&$e&&this.zoom>=17&&(ur.length!==0&&lt(ur,ur[0])&&ur.pop(),this.groundEffect.addData(ur,xt,$,$e>0))}this.footprintSegments.push(Ct),Mt.triangleCount=this.indexArray.length-Mt.triangleArrayOffset,this.polygonSegments.push(Mt),++Y.footprintSegLen,++Y.polygonSegLen}if(Y.vertexCount=this.layoutVertexArray.length-Y.vertexArrayOffset,Y.groundVertexCount=this.groundEffect.vertexArray.length-Y.groundVertexArrayOffset,Y.vertexCount!==0){if(Y.centroidXY=V.borders?ev:this.encodeCentroid(V,Y),this.centroidData.push(Y),V.borders){this.featuresOnBorder.push(V);const st=this.featuresOnBorder.length-1;for(let xt=0;xt<V.borders.length;xt++)V.borders[xt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[xt].push(st)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,l,d,f,N),this.groundEffect.addPaintPropertiesData(e,s,l,d,f,N),this.maxHeight=Math.max(this.maxHeight,ce)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,s)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}splitToSubtiles(){const e=[];for(let R=0;R<this.centroidData.length;R++){const N=this.centroidData[R],$=+(N.min.y+N.max.y>wr),I=2*$+(+(N.min.x+N.max.x>wr)^$);for(let j=0;j<N.polygonSegLen;j++){const H=N.polygonSegIdx+j;e.push({centroidIdx:R,subtile:I,polygonSegmentIdx:H,triangleSegmentIdx:this.polygonSegments[H].triangleSegIdx})}}const i=new zn;e.sort((R,N)=>R.triangleSegmentIdx===N.triangleSegmentIdx?R.subtile-N.subtile:R.triangleSegmentIdx-N.triangleSegmentIdx);let s=0,f=0,l=0;for(const R of e){if(R.triangleSegmentIdx!==s)break;l++}const d=e.length;for(;f!==e.length;){s=e[f].triangleSegmentIdx;let R=0,N=f,$=f;for(let I=N;I<l&&e[I].subtile===R;I++)$++;for(;N!==l;){const I=e[N];R=I.subtile;const j=this.centroidData[I.centroidIdx].min.clone(),H=this.centroidData[I.centroidIdx].max.clone(),F={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let V=N;V<$;V++){const Y=e[V],oe=this.polygonSegments[Y.polygonSegmentIdx],ce=this.centroidData[Y.centroidIdx].min,we=this.centroidData[Y.centroidIdx].max,Ie=this.indexArray.uint16;for(let me=oe.triangleArrayOffset;me<oe.triangleArrayOffset+oe.triangleCount;me++)i.emplaceBack(Ie[3*me],Ie[3*me+1],Ie[3*me+2]);F.primitiveLength+=oe.triangleCount,j.x=Math.min(j.x,ce.x),j.y=Math.min(j.y,ce.y),H.x=Math.max(H.x,we.x),H.y=Math.max(H.y,we.y)}F.primitiveLength>0&&this.triangleSubSegments.push({segment:F,min:j,max:H}),N=$;for(let V=N;V<l&&e[V].subtile===e[N].subtile;V++)$++}f=l;for(let I=f;I<d&&e[I].triangleSegmentIdx===e[f].triangleSegmentIdx;I++)l++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,s){const f=new hn;if(this.wallMode){for(const Y of this.triangleSubSegments)f.segments.push(Y.segment);return f}let l=0,d=0;const R=1<<e.canonical.z;if(i){const Y=i.getMinMaxForTile(e);Y&&(l=Y.min,d=Y.max)}d+=this.maxHeight;const N=e.toUnwrapped();let $;const I=[N.canonical.x/R+N.wrap,N.canonical.y/R],j=[(N.canonical.x+1)/R+N.wrap,(N.canonical.y+1)/R],H=(Y,oe,ce)=>[Y[0]*(1-ce[0])+oe[0]*ce[0],Y[1]*(1-ce[1])+oe[1]*ce[1]],F=[],V=[];for(const Y of this.triangleSubSegments){F[0]=Y.min.x/wr,F[1]=Y.min.y/wr,V[0]=Y.max.x/wr,V[1]=Y.max.y/wr;const oe=H(I,j,F),ce=H(I,j,V);if(new Xr([oe[0],oe[1],l],[ce[0],ce[1],d]).intersectsPrecise(s)===0){$&&(f.segments.push($),$=void 0);continue}const we=Y.segment;$&&$.vertexOffset!==we.vertexOffset&&(f.segments.push($),$=void 0),$?($.vertexLength+=we.vertexLength,$.primitiveLength+=we.primitiveLength):$={vertexOffset:we.vertexOffset,primitiveLength:we.primitiveLength,vertexLength:we.vertexLength,primitiveOffset:we.primitiveOffset,sortKey:void 0,vaos:{}}}return $&&f.segments.push($),f}encodeCentroid(e,i){const s=e.centroid(),f=i.span(),l=Math.min(7,Math.round(f.x*this.tileToMeter/10)),d=Math.min(7,Math.round(f.y*this.tileToMeter/10));return new Ge(le(s.x,1,wr-1)<<3|l,le(s.y,1,wr-1)<<3|d)}encodeBorderCentroid(e){if(!e.borders)return new Ge(0,0);const i=e.borders,s=Number.MAX_VALUE;if(i[0][0]!==s||i[1][0]!==s){const f=i[0][0]!==s?0:1;return new Ge(6|(i[0][0]!==s?0:65528),(i[f][0]+i[f][1])/2<<3|6)}{const f=i[2][0]!==s?2:3;return new Ge((i[f][0]+i[f][1])/2<<3|6,6|(i[2][0]!==s?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=Js,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,s=e.vertexCount+e.vertexArrayOffset,f=e.flags&Js?ev:e.centroidXY,l=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==f.y||l!==f.x){for(let d=i;d<s;++d)this.centroidVertexArray.emplace(d,f.x,f.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,s){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const f=i.getReplacementRegionsForTile(e.toUnwrapped());if(Qm(this.activeReplacements,f))return;if(this.activeReplacements=f,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const d of this.centroidData)d.flags&=2147483647;const l=[];for(const d of this.activeReplacements){if(d.order<s)continue;const R=Math.max(1,Math.pow(2,d.footprintTileId.canonical.z-e.canonical.z));for(const N of this.centroidData)if(!(N.flags&Js||d.min.x>N.max.x||N.min.x>d.max.x||d.min.y>N.max.y||N.min.y>d.max.y))for(let $=0;$<N.footprintSegLen;$++){const I=this.footprintSegments[N.footprintSegIdx+$];if(l.length=0,mS(this.footprintVertices,I.vertexOffset,I.vertexCount,d.footprintTileId.canonical,e.canonical,l),X1(d.footprint,l,this.footprintIndices.uint16,I.indexOffset,I.indexCount,-I.vertexOffset,-R)){N.flags|=Js;break}}}for(const d of this.centroidData)this.writeCentroidToBuffer(d);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,s){let f=!1;for(let l=0;l<s.footprintSegLen;l++){const d=this.footprintSegments[s.footprintSegIdx+l];let R=0;for(const N of d.ringIndices){for(let $=R,I=N+R-1;$<N+R;I=$++){const j=this.footprintVertices.int16[2*($+d.vertexOffset)+0],H=this.footprintVertices.int16[2*($+d.vertexOffset)+1],F=this.footprintVertices.int16[2*(I+d.vertexOffset)+1];H>i!=F>i&&e<(this.footprintVertices.int16[2*(I+d.vertexOffset)+0]-j)*(i-H)/(F-H)+j&&(f=!f)}R=N}}return f}getHeightAtTileCoord(e,i){let s=Number.NEGATIVE_INFINITY,f=!0;const l=4*(e+wr)*wr+(i+wr);if(this.partLookup.hasOwnProperty(l)){const d=this.partLookup[l];return d?{height:d.height,hidden:!!(d.flags&Js)}:void 0}for(const d of this.centroidData)e>d.max.x||d.min.x>e||i>d.max.y||d.min.y>i||this.footprintContainsPoint(e,i,d)&&d&&d.height>s&&(s=d.height,this.partLookup[l]=d,f=!!(d.flags&Js));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:f};this.partLookup[l]=void 0}}function ov(o,e){const i=o.add(e)._unit();return o.x*i.x+o.y*i.y}function pS(o,e,i,s){const f=e.sub(o)._perp()._unit(),l=i.sub(e)._perp()._unit();return sv(o,e,i,ov(f,l),s)}function sv(o,e,i,s,f){const l=Math.sqrt(1-s*s);return Math.min(o.dist(e)/3,e.dist(i)/3,f*l/s)}function r_(o,e,i){return o.x<i[0].x&&e.x<i[0].x||o.x>i[1].x&&e.x>i[1].x||o.y<i[0].y&&e.y<i[0].y||o.y>i[1].y&&e.y>i[1].y}function lv(o,e){return o.x<e[0].x||o.x>e[1].x||o.y<e[0].y||o.y>e[1].y}function uv(o,e,i){if(o.x<0||o.x>=wr||e.x<0||e.x>=wr||i.x<0||i.x>=wr)return!1;const s=i.sub(e),f=s.perp(),l=o.sub(e);return(s.x*l.x+s.y*l.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(l.x*l.x+l.y*l.y))>-.866&&f.x*l.x+f.y*l.y<0}function cv(o,e,i){const s=e?2|o:-3&o;return i?1|s:-2&s}function hv(){const o=Math.PI/32,e=Math.tan(o),i=Ys;return i*Math.sqrt(1+2*e*e)-i}function fv(o,e,i){const s=1<<i.z,f=la(i.x/s),l=la((i.x+1)/s),d=In(i.y/s),R=In((i.y+1)/s);return function(N,$,I,j,H=0,F){const V=[];if(!N.length||!I||!j)return V;const Y=(Ue,$e)=>{for(const ct of Ue)V.push({polygon:ct,bounds:$e})},oe=Math.ceil(Math.log2(I)),ce=Math.ceil(Math.log2(j)),we=oe-ce,Ie=[];for(let Ue=0;Ue<Math.abs(we);Ue++)Ie.push(we>0?0:1);for(let Ue=0;Ue<Math.min(oe,ce);Ue++)Ie.push(0),Ie.push(1);let me=N;if(me=qd(me,$[0].y-H,$[1].y+H,1),me=qd(me,$[0].x-H,$[1].x+H,0),!me.length)return V;const Re=[];for(Ie.length?Re.push({polygons:me,bounds:$,depth:0}):Y(me,$);Re.length;){const Ue=Re.pop(),$e=Ue.depth,ct=Ie[$e],lt=Ue.bounds[0],st=Ue.bounds[1],xt=ct===0?lt.x:lt.y,dt=ct===0?st.x:st.y,Et=F?F(ct,xt,dt):.5*(xt+dt),It=qd(Ue.polygons,xt-H,Et+H,ct),Mt=qd(Ue.polygons,Et-H,dt+H,ct);if(It.length){const Ct=[lt,new Ge(ct===0?Et:st.x,ct===1?Et:st.y)];Ie.length>$e+1?Re.push({polygons:It,bounds:Ct,depth:$e+1}):Y(It,Ct)}if(Mt.length){const Ct=[new Ge(ct===0?Et:lt.x,ct===1?Et:lt.y),st];Ie.length>$e+1?Re.push({polygons:Mt,bounds:Ct,depth:$e+1}):Y(Mt,Ct)}}return V}(o,e,Math.ceil((l-f)/11.25),Math.ceil((d-R)/11.25),1,(N,$,I)=>{if(N===0)return .5*($+I);{const j=In((i.y+$/wr)/s);return(_o(.5*(In((i.y+I/wr)/s)+j))*s-i.y)*wr}})}function mS(o,e,i,s,f,l){const d=Math.pow(2,s.z-f.z);for(let R=0;R<i;R++){let N=o.int16[2*(R+e)+0],$=o.int16[2*(R+e)+1];N=(N+f.x*wr)*d-s.x*wr,$=($+f.y*wr)*d-s.y*wr,l.push(new Ge(N,$))}}let dv,pv;function Jh(o,e){return o.x*e.x+o.y*e.y}function mv(o,e){if(o.length===1){let i=0;const s=e[i++];let f;for(;!f||s.equals(f);)if(f=e[i++],!f)return 1/0;for(;i<e.length;i++){const l=e[i],d=o[0],R=f.sub(s),N=l.sub(s),$=d.sub(s),I=Jh(R,R),j=Jh(R,N),H=Jh(N,N),F=Jh($,R),V=Jh($,N),Y=I*H-j*j,oe=(H*F-j*V)/Y,ce=(I*V-j*F)/Y,we=s.z*(1-oe-ce)+f.z*oe+l.z*ce;if(isFinite(we))return we}return 1/0}{let i=1/0;for(const s of e)i=Math.min(i,s.z);return i}}function _v(o,e,i,s,f,l,d,R){const N=d*f.getElevationAt(o,e,!0,!0),$=l[0]!==0,I=$?l[1]===0?d*(l[0]/7-450):d*function(j,H,F){const V=Math.floor(H[0]/8),Y=Math.floor(H[1]/8),oe=10*(H[0]-8*V),ce=10*(H[1]-8*Y),we=j.getElevationAt(V,Y,!0,!0),Ie=j.getMeterToDEM(F),me=Math.floor(.5*(oe*Ie-1)),Re=Math.floor(.5*(ce*Ie-1)),Ue=j.tileCoordToPixel(V,Y),$e=2*me+1,ct=2*Re+1,lt=function(Mt,Ct,kt,jt,Ot){return[Mt.getElevationAtPixel(Ct,kt,!0),Mt.getElevationAtPixel(Ct+Ot,kt,!0),Mt.getElevationAtPixel(Ct,kt+Ot,!0),Mt.getElevationAtPixel(Ct+jt,kt+Ot,!0)]}(j,Ue.x-me,Ue.y-Re,$e,ct),st=Math.abs(lt[0]-lt[1]),xt=Math.abs(lt[2]-lt[3]),dt=Math.abs(lt[0]-lt[2])+Math.abs(lt[1]-lt[3]),Et=Math.min(.25,.5*Ie*(st+xt)/$e),It=Math.min(.25,.5*Ie*dt/ct);return we+Math.max(Et*oe,It*ce)}(f,l,R):N;return{base:N+(i===0?-1:i),top:$?Math.max(I+s,N+i+2):N+s}}Dr(Xd,"FillExtrusionBucket",{omit:["layers","features"]}),Dr(rv,"PartData"),Dr(tv,"FootprintSegment"),Dr(iv,"BorderCentroidData"),Dr(av,"GroundEffect");const _S=Ri([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),gS=Ri([{name:"a_z_offset_width",components:2,type:"Float32"}],4),{members:yS}=_S,vS=Ri([{name:"a_packed",components:4,type:"Float32"}]),{members:bS}=vS,xS=Ri([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:wS}=xS;class gv{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Ks({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const s=this.getKey(e,i);return this.positions[s]}trim(){const e=this.width,i=this.height=xr(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,s){const f=[];let l=e.length%2==1?-e[e.length-1]*s:0,d=e[0]*s,R=!0;f.push({left:l,right:d,isDash:R,zeroLength:e[0]===0});let N=e[0];for(let $=1;$<e.length;$++){R=!R;const I=e[$];l=N*s,N+=I,d=N*s,f.push({left:l,right:d,isDash:R,zeroLength:I===0})}return f}addRoundDash(e,i,s){const f=i/2;for(let l=-s;l<=s;l++){const d=this.width*(this.nextRow+s+l);let R=0,N=e[R];for(let $=0;$<this.width;$++){$/N.right>1&&(N=e[++R]);const I=Math.abs($-N.left),j=Math.abs($-N.right),H=Math.min(I,j);let F;const V=l/s*(f+1);if(N.isDash){const Y=f-Math.abs(V);F=Math.sqrt(H*H+Y*Y)}else F=f-Math.sqrt(H*H+V*V);this.image.data[d+$]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(e,i){for(let N=e.length-1;N>=0;--N){const $=e[N],I=e[N+1];$.zeroLength?e.splice(N,1):I&&I.isDash===$.isDash&&(I.left=$.left,e.splice(N,1))}const s=e[0],f=e[e.length-1];s.isDash===f.isDash&&(s.left=f.left-this.width,f.right=s.right+this.width);const l=this.width*this.nextRow;let d=0,R=e[d];for(let N=0;N<this.width;N++){N/R.right>1&&(R=e[++d]);const $=Math.abs(N-R.left),I=Math.abs(N-R.right),j=Math.min($,I);this.image.data[l+N]=Math.max(0,Math.min(255,(R.isDash?j:-j)+i+128))}}addDash(e,i){const s=this.getKey(e,i);if(this.positions[s])return this.positions[s];const f=i==="round",l=f?7:0,d=2*l+1;if(this.nextRow+d>this.height)return St("LineAtlas out of space"),null;e.length===0&&e.push(1);let R=0;for(let I=0;I<e.length;I++)e[I]<0&&(St("Negative value is found in line dasharray, replacing values with 0"),e[I]=0),R+=e[I];if(R!==0){const I=this.width/R,j=this.getDashRanges(e,this.width,I);f?this.addRoundDash(j,I,l):this.addRegularDash(j,i==="square"?.5*I:0)}const N=this.nextRow+l;this.nextRow+=d;const $={tl:[N,l],br:[R,0]};return this.positions[s]=$,$}}Dr(gv,"LineAtlas");const ES=vc.VectorTileFeature.types,TS=Math.cos(Math.PI/180*37.5),SS=Math.cos(Math.PI/180*5);class i_{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Sa,this.layoutVertexArray2=new Do,this.patternVertexArray=new fo,this.indexArray=new zn,this.programConfigurations=new ko(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new hn,this.maxLineLength=0,this.zOffsetVertexArray=new ss,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:wr/64}updateFootprints(e,i){}populate(e,i,s,f){this.hasPattern=qm("line",this.layers,i);const l=this.layers[0].layout.get("line-sort-key");this.tileToMeter=n(s),this.hasZOffset=!this.layers[0].isDraped();const d=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset&&d==="none"&&St(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const R=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&R!==void 0;const N=[];for(const{feature:H,id:F,index:V,sourceLayerIndex:Y}of e){const oe=this.layers[0]._featureFilter.needGeometry,ce=fe(H,oe);if(!this.layers[0]._featureFilter.filter(new Xi(this.zoom),ce,s))continue;const we=l?l.evaluate(ce,{},s):void 0,Ie={id:F,properties:H.properties,type:H.type,sourceLayerIndex:Y,index:V,geometry:oe?ce.geometry:he(H,s,f),patterns:{},sortKey:we};N.push(Ie)}l&&N.sort((H,F)=>H.sortKey-F.sortKey);const{lineAtlas:$,featureIndex:I}=i,j=this.addConstantDashes($);for(const H of N){const{geometry:F,index:V,sourceLayerIndex:Y}=H;if(j&&this.addFeatureDashes(H,$),this.hasPattern){const oe=Wm("line",this.layers,H,this.zoom,i);this.patternFeatures.push(oe)}else this.addFeature(H,F,V,s,$.positions,i.availableImages,i.brightness);I.insert(e[V].feature,F,V,Y,this.index)}}addConstantDashes(e){let i=!1;for(const s of this.layers){const f=s.paint.get("line-dasharray").value,l=s.layout.get("line-cap").value;if(f.kind!=="constant"||l.kind!=="constant")i=!0;else{const d=l.value,R=f.value;if(!R)continue;e.addDash(R,d)}}return i}addFeatureDashes(e,i){const s=this.zoom;for(const f of this.layers){const l=f.paint.get("line-dasharray").value,d=f.layout.get("line-cap").value;if(l.kind==="constant"&&d.kind==="constant")continue;let R,N;if(l.kind==="constant"){if(R=l.value,!R)continue}else R=l.evaluate({zoom:s},e);N=d.kind==="constant"?d.value:d.evaluate({zoom:s},e),i.addDash(R,N),e.patterns[f.id]=i.getKey(R,N)}}update(e,i,s,f,l,d,R){this.programConfigurations.updatePaintArrays(e,i,l,s,f,d,R)}addFeatures(e,i,s,f,l,d){for(const R of this.patternFeatures)this.addFeature(R,R.geometry,R.index,i,s,f,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,bS)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,wS)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,gS.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yS),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,s,f,l,d,R){const N=this.layers[0].layout,$=N.get("line-join").evaluate(e,{}),I=N.get("line-cap").evaluate(e,{}),j=N.get("line-miter-limit"),H=N.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=N.get("line-z-offset").value;const F=this.layers[0].paint.get("line-width").value;F.kind!=="constant"&&F.isLineProgressConstant===!1&&(this.variableWidthValue=F);for(const V of i)this.addLine(V,e,f,$,I,j,H);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,l,d,f,R)}addLine(e,i,s,f,l,d,R){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const N=f==="none";if(this.patternJoinNone=this.hasPattern&&N,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ie=0;Ie<e.length-1;Ie++)this.totalDistance+=e[Ie].dist(e[Ie+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const $=ES[i.type]==="Polygon";let I=e.length;for(;I>=2&&e[I-1].equals(e[I-2]);)I--;let j=0;for(;j<I-1&&e[j].equals(e[j+1]);)j++;if(I<($?3:2))return;f==="bevel"&&(d=1.05);const H=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let F,V,Y,oe,ce,we;this.e1=this.e2=-1,$&&(F=e[I-2],ce=e[j].sub(F)._unit()._perp());for(let Ie=j;Ie<I;Ie++){if(Y=Ie===I-1?$?e[j+1]:void 0:e[Ie+1],Y&&e[Ie].equals(Y))continue;ce&&(oe=ce),F&&(V=F),F=e[Ie],we=this.evaluateLineProgressFeatures(V?V.dist(F):0),ce=Y?Y.sub(F)._unit()._perp():oe,oe=oe||ce;const me=V&&Y;let Re=me?f:$||N?"butt":l;const Ue=oe.x*ce.x+oe.y*ce.y;if(N){const It=function(Mt){if(Mt.patternJoinNone){const Ct=Mt.segmentPoints.length/2,kt=Mt.lineSoFar-Mt.segmentStart;for(let jt=0;jt<Ct;++jt){const Ot=Mt.segmentPoints[2*jt+1],Kt=Math.round(Mt.segmentPoints[2*jt])+.5+.25*Ot;Mt.patternVertexArray.emplaceBack(Kt,kt,Mt.segmentStart),Mt.patternVertexArray.emplaceBack(Kt,kt,Mt.segmentStart)}Mt.segmentPoints.length=0}Mt.e1=Mt.e2=-1};if(me&&Ue<SS){this.updateDistance(V,F),this.addCurrentVertex(F,oe,1,1,H,we),It(this),this.addCurrentVertex(F,ce,-1,-1,H,we);continue}if(V){if(!Y){this.updateDistance(V,F),this.addCurrentVertex(F,oe,1,1,H,we),It(this);continue}Re="miter"}}let $e=oe.add(ce);$e.x===0&&$e.y===0||$e._unit();const ct=$e.x*ce.x+$e.y*ce.y,lt=ct!==0?1/ct:1/0,st=2*Math.sqrt(2-2*ct),xt=ct<TS&&V&&Y,dt=oe.x*ce.y-oe.y*ce.x>0,Et=this.overscaling<=16?15*wr/(512*this.overscaling):0;if(me&&Re==="round"){if(lt<R)Re="miter";else if(lt<=2){const It=n_(F,-10,wr+10);Re=this.hasZOffset&&(It||this.hasCrossSlope)?"miter":"fakeround"}}if(Re==="miter"&&lt>d&&(Re="bevel"),Re==="bevel"&&(lt>2&&(Re="flipbevel"),lt<d&&(Re="miter")),V&&!(Re==="miter"&&xt)&&this.updateDistance(V,F),Re==="miter")if(xt){const It=F.dist(V);if(It>2*Et){const Ct=F.sub(F.sub(V)._mult(Et/It)._round());this.updateDistance(V,Ct),this.addCurrentVertex(Ct,oe,0,0,H,we),V=Ct}this.updateDistance(V,F),$e._mult(lt),this.addCurrentVertex(F,$e,0,0,H,we);const Mt=F.dist(Y);if(Mt>2*Et){const Ct=F.add(Y.sub(F)._mult(Et/Mt)._round());this.updateDistance(F,Ct),this.addCurrentVertex(Ct,ce,0,0,H,we),F=Ct}}else $e._mult(lt),this.addCurrentVertex(F,$e,0,0,H,we);else if(Re==="flipbevel"){if(lt>100)$e=ce.mult(-1);else{const It=lt*oe.add(ce).mag()/oe.sub(ce).mag();$e._perp()._mult(It*(dt?-1:1))}this.addCurrentVertex(F,$e,0,0,H,we),this.addCurrentVertex(F,$e.mult(-1),0,0,H,we)}else if(Re==="bevel"||Re==="fakeround"){we!=null&&V&&this.addCurrentVertex(F,oe,-1,-1,H,we);const It=F.dist(V)<=2*Et&&Re!=="bevel",Mt=$e.mult(dt?1:-1);Mt._mult(lt);const Ct=ce.mult(dt?-1:1),kt=oe.mult(dt?-1:1),jt=this.evaluateLineProgressFeatures(this.distance);if(we==null&&(this.addHalfVertex(F,Mt.x,Mt.y,!1,!dt,0,H,jt),It||this.addHalfVertex(F,Mt.x+2*kt.x,Mt.y+2*kt.y,!1,dt,0,H,jt)),Re==="fakeround"){const Ot=Math.round(180*st/Math.PI/20);this.addHalfVertex(F,kt.x,kt.y,!1,dt,0,H,jt);for(let Kt=0;Kt<Ot;Kt++){let ur=Kt/Ot;if(ur!==.5){const yr=ur-.5;ur+=ur*yr*(ur-1)*((1.0904+Ue*(Ue*(3.55645-1.43519*Ue)-3.2452))*yr*yr+(.848013+Ue*(.215638*Ue-1.06021)))}const Jt=Ct.sub(kt)._mult(ur)._add(kt)._unit();this.addHalfVertex(F,Jt.x,Jt.y,!1,dt,0,H,jt)}this.addHalfVertex(F,Ct.x,Ct.y,!1,dt,0,H,jt)}It||we!=null||this.addHalfVertex(F,Mt.x+2*Ct.x,Mt.y+2*Ct.y,!1,dt,0,H,jt),we!=null&&Y&&this.addCurrentVertex(F,ce,1,1,H,we)}else Re==="butt"?this.addCurrentVertex(F,$e,0,0,H,we):Re==="square"?(V||this.addCurrentVertex(F,$e,-1,-1,H,we),this.addCurrentVertex(F,$e,0,0,H,we),V&&this.addCurrentVertex(F,$e,1,1,H,we)):Re==="round"&&(V&&(this.addCurrentVertex(F,oe,0,0,H,we),this.addCurrentVertex(F,oe,1,1,H,we,!0)),Y&&(this.addCurrentVertex(F,ce,-1,-1,H,we,!0),this.addCurrentVertex(F,ce,0,0,H,we)))}}addVerticesTo(e,i,s,f,l,d,R,N,$,I){const j=(i.w-e.w)/this.tessellationStep|0;let H=0;const F=this.scaledDistance;if(j>1){this.lineSoFar=e.w;const Y=(i.x-e.x)/j,oe=(i.y-e.y)/j,ce=(i.z-e.z)/j,we=(i.w-e.w)/j;for(let Ie=1;Ie<j;++Ie){e.x+=Y,e.y+=oe,e.z+=ce,this.lineSoFar+=we,H+=we;const me=this.evaluateLineProgressFeatures(this.prevDistance+H);this.scaledDistance=(this.prevDistance+H)/this.totalDistance,this.addHalfVertex(e,s,f,I,!1,R,$,me),this.addHalfVertex(e,l,d,I,!0,-N,$,me)}}this.lineSoFar=i.w,this.scaledDistance=F;const V=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,s,f,I,!1,R,$,V),this.addHalfVertex(i,l,d,I,!0,-N,$,V)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):St(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}:{zOffset:0,variableWidth:i}}addCurrentVertex(e,i,s,f,l,d,R=!1){const N=i.x+i.y*s,$=i.y-i.x*s,I=i.y*f-i.x,j=-i.y-i.x*f;if(d!=null){const H=this.hasZOffset,F=-10,V=wr+10,Y=d.zOffset,oe=new G1(e.x,e.y,Y,this.lineSoFar),ce=!!H&&n_(e,F,V),we=this.lineSoFar,Ie=this.distance;if(this.currentVertex)if(ce){const me=this.currentVertexIsOutside,Re=this.currentVertex,Ue=new G1(e.x,e.y,Y,this.lineSoFar);if(q1(Re,Ue,F,V),!n_(Ue,F,V)){if(me){this.e1=this.e2=-1,this.distance-=Re.dist(oe),this.lineSoFar=Re.w;const $e=this.evaluateLineProgressFeatures(Re.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Re,N,$,R,!1,s,l,$e),this.addHalfVertex(Re,I,j,R,!0,-f,l,$e),this.prevDistance=this.distance}this.distance=this.prevDistance+Re.dist(Ue),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Re,Ue,N,$,I,j,s,f,l,R),this.distance=Ie,this.scaledDistance=this.distance/this.totalDistance}}else{const me=this.currentVertex;if(this.currentVertexIsOutside){q1(me,oe,F,V),this.e1=this.e2=-1,this.distance-=me.dist(oe),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=me.w;const Re=this.evaluateLineProgressFeatures(me.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(me,N,$,R,!1,s,l,Re),this.addHalfVertex(me,I,j,R,!0,-f,l,Re),this.prevDistance=this.distance,this.distance=Ie,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(me,oe,N,$,I,j,s,f,l,R)}else ce||(this.addHalfVertex(e,N,$,R,!1,s,l,d),this.addHalfVertex(e,I,j,R,!0,-f,l,d));this.currentVertex=oe,this.currentVertexIsOutside=ce,this.lineSoFar=we}else this.addHalfVertex(e,N,$,R,!1,s,l,d),this.addHalfVertex(e,I,j,R,!0,-f,l,d)}addHalfVertex({x:e,y:i},s,f,l,d,R,N,$){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),d||this.segmentPoints.push(this.lineSoFar-this.segmentStart,R)),this.layoutVertexArray.emplaceBack((e<<1)+(l?1:0),(i<<1)+(d?1:0),Math.round(63*s)+128,Math.round(63*f)+128,1+(R===0?0:R<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const I=N.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),N.primitiveLength++),d?this.e2=I:this.e1=I,$!=null&&this.zOffsetVertexArray.emplaceBack($.zOffset,$.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function n_(o,e,i){return o.x<e||o.x>i||o.y<e||o.y>i}let yv,vv;function bv(o,e,i){return e*(wr/(o.tileSize*Math.pow(2,i-o.tileID.overscaledZ)))}Dr(i_,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const xv=(o,e,i)=>(1-i)*o+i*e;function wv(o,e){return 1/bv(o,1,e.tileZoom)}function Ev(o,e,i,s){return o.translatePosMatrix(s||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Tv=o=>{const e=[];Sv(o)&&e.push("RENDER_LINE_DASH"),o.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=o.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),o.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const s=o.layout.get("line-join").constantOr("miter")==="none",f=!!o.paint.get("line-pattern").constantOr(1);return s&&f&&e.push("LINE_JOIN_NONE"),e};function Sv(o){const e=o.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let a_;const Mv=()=>a_||(a_={layout:yv||(yv=new on({"line-cap":new Ar(qt.layout_line["line-cap"]),"line-join":new Ar(qt.layout_line["line-join"]),"line-miter-limit":new dr(qt.layout_line["line-miter-limit"]),"line-round-limit":new dr(qt.layout_line["line-round-limit"]),"line-sort-key":new Ar(qt.layout_line["line-sort-key"]),"line-z-offset":new Ar(qt.layout_line["line-z-offset"]),"line-elevation-reference":new dr(qt.layout_line["line-elevation-reference"]),"line-cross-slope":new dr(qt.layout_line["line-cross-slope"]),visibility:new dr(qt.layout_line.visibility),"line-width-unit":new dr(qt.layout_line["line-width-unit"])})),paint:vv||(vv=new on({"line-opacity":new Ar(qt.paint_line["line-opacity"]),"line-color":new Ar(qt.paint_line["line-color"]),"line-translate":new dr(qt.paint_line["line-translate"]),"line-translate-anchor":new dr(qt.paint_line["line-translate-anchor"]),"line-width":new Ar(qt.paint_line["line-width"]),"line-gap-width":new Ar(qt.paint_line["line-gap-width"]),"line-offset":new Ar(qt.paint_line["line-offset"]),"line-blur":new Ar(qt.paint_line["line-blur"]),"line-dasharray":new Ar(qt.paint_line["line-dasharray"]),"line-pattern":new Ar(qt.paint_line["line-pattern"]),"line-gradient":new Co(qt.paint_line["line-gradient"]),"line-trim-offset":new dr(qt.paint_line["line-trim-offset"]),"line-trim-fade-range":new dr(qt.paint_line["line-trim-fade-range"]),"line-trim-color":new dr(qt.paint_line["line-trim-color"]),"line-emissive-strength":new dr(qt.paint_line["line-emissive-strength"]),"line-border-width":new Ar(qt.paint_line["line-border-width"]),"line-border-color":new Ar(qt.paint_line["line-border-color"]),"line-occlusion-opacity":new dr(qt.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"})}))},a_);class MS extends Ar{possiblyEvaluate(e,i){return i=new Xi(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,s,f){return i=Wt({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,s,f)}}let Qh;function Av(o,e){return e>0?e+2*o:o}const AS=Ri([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),IS=Ri([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),PS=Ri([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ri([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const CS=Ri([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),RS=Ri([{name:"a_texb",components:2,type:"Uint16"}]),DS=Ri([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),LS=Ri([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Ri([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Iv=Ri([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),OS=Ri([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ri([{name:"triangle",components:3,type:"Uint16"}]),Ri([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ri([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Ri([{type:"Float32",name:"offsetX"}]),Ri([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Vn=24;const yo=128;function Yd(o,e,i,s,f){if(o.kind==="camera")return o.maxSize;if(o.kind==="composite"){const l=e.possiblyEvaluate(new Xi(o.maxZoom),i).evaluate(f,{},i),d=e.possiblyEvaluate(new Xi(o.minZoom),i).evaluate(f,{},i);return Math.max(l,d)}return e.possiblyEvaluate(new Xi(s)).evaluate(f,{},i)}function o_(o,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Xi(o+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:f}=i;let l=0;for(;l<s.length&&s[l]<=o;)l++;l=Math.max(0,l-1);let d=l;for(;d<s.length&&s[d]<o+1;)d++;d=Math.min(s.length-1,d);const R=s[l],N=s[d];return i.kind==="composite"?{kind:"composite",minZoom:R,maxZoom:N,interpolationType:f}:{kind:"camera",minZoom:R,maxZoom:N,minSize:i.evaluate(new Xi(R)),maxSize:i.evaluate(new Xi(N)),interpolationType:f}}}function Kd(o,{uSize:e,uSizeT:i},{lowerSize:s,upperSize:f}){return o.kind==="source"?s/yo:o.kind==="composite"?Qr(s/yo,f/yo,i):e}function bc(o,e,i=1){let s=0,f=0;if(o.kind==="constant")f=o.layoutSize*i;else if(o.kind!=="source"){const{interpolationType:l,minZoom:d,maxZoom:R}=o,N=l?le(aa.interpolationFactor(l,e,d,R),0,1):0;o.kind==="camera"?f=Qr(o.minSize,o.maxSize,N)*i:s=N*i}return{uSizeT:s,uSize:f}}var zS=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:yo,evaluateSizeForFeature:Kd,evaluateSizeForZoom:bc,getRasterizedIconSize:Yd,getSizeData:o_});function kS(o,e,i){return o.sections.forEach(s=>{s.text=function(f,l,d){const R=l.layout.get("text-transform").evaluate(d,{});return R==="uppercase"?f=f.toLocaleUpperCase():R==="lowercase"&&(f=f.toLocaleLowerCase()),Ta.applyArabicShaping&&(f=Ta.applyArabicShaping(f)),f}(s.text,e,i)}),o}const ef={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function BS(o){return o==="︶"||o==="﹈"||o==="︸"||o==="﹄"||o==="﹂"||o==="︾"||o==="︼"||o==="︺"||o==="︘"||o==="﹀"||o==="︐"||o==="︓"||o==="︔"||o==="｀"||o==="￣"||o==="︑"||o==="︒"}function FS(o){return o==="︵"||o==="﹇"||o==="︷"||o==="﹃"||o==="﹁"||o==="︽"||o==="︻"||o==="︹"||o==="︗"||o==="︿"}var Pv,s_,Cv,l_={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function NS(){return Pv||(Pv=1,l_.read=function(o,e,i,s,f){var l,d,R=8*f-s-1,N=(1<<R)-1,$=N>>1,I=-7,j=i?f-1:0,H=i?-1:1,F=o[e+j];for(j+=H,l=F&(1<<-I)-1,F>>=-I,I+=R;I>0;l=256*l+o[e+j],j+=H,I-=8);for(d=l&(1<<-I)-1,l>>=-I,I+=s;I>0;d=256*d+o[e+j],j+=H,I-=8);if(l===0)l=1-$;else{if(l===N)return d?NaN:1/0*(F?-1:1);d+=Math.pow(2,s),l-=$}return(F?-1:1)*d*Math.pow(2,l-s)},l_.write=function(o,e,i,s,f,l){var d,R,N,$=8*l-f-1,I=(1<<$)-1,j=I>>1,H=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=s?0:l-1,V=s?1:-1,Y=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(R=isNaN(e)?1:0,d=I):(d=Math.floor(Math.log(e)/Math.LN2),e*(N=Math.pow(2,-d))<1&&(d--,N*=2),(e+=d+j>=1?H/N:H*Math.pow(2,1-j))*N>=2&&(d++,N/=2),d+j>=I?(R=0,d=I):d+j>=1?(R=(e*N-1)*Math.pow(2,f),d+=j):(R=e*Math.pow(2,j-1)*Math.pow(2,f),d=0));f>=8;o[i+F]=255&R,F+=V,R/=256,f-=8);for(d=d<<f|R,$+=f;$>0;o[i+F]=255&d,F+=V,d/=256,$-=8);o[i+F-V]|=128*Y}),l_}function Rv(){if(Cv)return s_;Cv=1,s_=e;var o=NS();function e(me){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(me)?me:new Uint8Array(me||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,s=1/i,f=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function l(me){return me.type===e.Bytes?me.readVarint()+me.pos:me.pos+1}function d(me,Re,Ue){return Ue?4294967296*Re+(me>>>0):4294967296*(Re>>>0)+(me>>>0)}function R(me,Re,Ue){var $e=Re<=16383?1:Re<=2097151?2:Re<=268435455?3:Math.floor(Math.log(Re)/(7*Math.LN2));Ue.realloc($e);for(var ct=Ue.pos-1;ct>=me;ct--)Ue.buf[ct+$e]=Ue.buf[ct]}function N(me,Re){for(var Ue=0;Ue<me.length;Ue++)Re.writeVarint(me[Ue])}function $(me,Re){for(var Ue=0;Ue<me.length;Ue++)Re.writeSVarint(me[Ue])}function I(me,Re){for(var Ue=0;Ue<me.length;Ue++)Re.writeFloat(me[Ue])}function j(me,Re){for(var Ue=0;Ue<me.length;Ue++)Re.writeDouble(me[Ue])}function H(me,Re){for(var Ue=0;Ue<me.length;Ue++)Re.writeBoolean(me[Ue])}function F(me,Re){for(var Ue=0;Ue<me.length;Ue++)Re.writeFixed32(me[Ue])}function V(me,Re){for(var Ue=0;Ue<me.length;Ue++)Re.writeSFixed32(me[Ue])}function Y(me,Re){for(var Ue=0;Ue<me.length;Ue++)Re.writeFixed64(me[Ue])}function oe(me,Re){for(var Ue=0;Ue<me.length;Ue++)Re.writeSFixed64(me[Ue])}function ce(me,Re){return(me[Re]|me[Re+1]<<8|me[Re+2]<<16)+16777216*me[Re+3]}function we(me,Re,Ue){me[Ue]=Re,me[Ue+1]=Re>>>8,me[Ue+2]=Re>>>16,me[Ue+3]=Re>>>24}function Ie(me,Re){return(me[Re]|me[Re+1]<<8|me[Re+2]<<16)+(me[Re+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(me,Re,Ue){for(Ue=Ue||this.length;this.pos<Ue;){var $e=this.readVarint(),ct=$e>>3,lt=this.pos;this.type=7&$e,me(ct,Re,this),this.pos===lt&&this.skip($e)}return Re},readMessage:function(me,Re){return this.readFields(me,Re,this.readVarint()+this.pos)},readFixed32:function(){var me=ce(this.buf,this.pos);return this.pos+=4,me},readSFixed32:function(){var me=Ie(this.buf,this.pos);return this.pos+=4,me},readFixed64:function(){var me=ce(this.buf,this.pos)+ce(this.buf,this.pos+4)*i;return this.pos+=8,me},readSFixed64:function(){var me=ce(this.buf,this.pos)+Ie(this.buf,this.pos+4)*i;return this.pos+=8,me},readFloat:function(){var me=o.read(this.buf,this.pos,!0,23,4);return this.pos+=4,me},readDouble:function(){var me=o.read(this.buf,this.pos,!0,52,8);return this.pos+=8,me},readVarint:function(me){var Re,Ue,$e=this.buf;return Re=127&(Ue=$e[this.pos++]),Ue<128?Re:(Re|=(127&(Ue=$e[this.pos++]))<<7,Ue<128?Re:(Re|=(127&(Ue=$e[this.pos++]))<<14,Ue<128?Re:(Re|=(127&(Ue=$e[this.pos++]))<<21,Ue<128?Re:function(ct,lt,st){var xt,dt,Et=st.buf;if(xt=(112&(dt=Et[st.pos++]))>>4,dt<128||(xt|=(127&(dt=Et[st.pos++]))<<3,dt<128)||(xt|=(127&(dt=Et[st.pos++]))<<10,dt<128)||(xt|=(127&(dt=Et[st.pos++]))<<17,dt<128)||(xt|=(127&(dt=Et[st.pos++]))<<24,dt<128)||(xt|=(1&(dt=Et[st.pos++]))<<31,dt<128))return d(ct,xt,lt);throw new Error("Expected varint not more than 10 bytes")}(Re|=(15&(Ue=$e[this.pos]))<<28,me,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var me=this.readVarint();return me%2==1?(me+1)/-2:me/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var me=this.readVarint()+this.pos,Re=this.pos;return this.pos=me,me-Re>=12&&f?function(Ue,$e,ct){return f.decode(Ue.subarray($e,ct))}(this.buf,Re,me):function(Ue,$e,ct){for(var lt="",st=$e;st<ct;){var xt,dt,Et,It=Ue[st],Mt=null,Ct=It>239?4:It>223?3:It>191?2:1;if(st+Ct>ct)break;Ct===1?It<128&&(Mt=It):Ct===2?(192&(xt=Ue[st+1]))==128&&(Mt=(31&It)<<6|63&xt)<=127&&(Mt=null):Ct===3?(dt=Ue[st+2],(192&(xt=Ue[st+1]))==128&&(192&dt)==128&&((Mt=(15&It)<<12|(63&xt)<<6|63&dt)<=2047||Mt>=55296&&Mt<=57343)&&(Mt=null)):Ct===4&&(dt=Ue[st+2],Et=Ue[st+3],(192&(xt=Ue[st+1]))==128&&(192&dt)==128&&(192&Et)==128&&((Mt=(15&It)<<18|(63&xt)<<12|(63&dt)<<6|63&Et)<=65535||Mt>=1114112)&&(Mt=null)),Mt===null?(Mt=65533,Ct=1):Mt>65535&&(Mt-=65536,lt+=String.fromCharCode(Mt>>>10&1023|55296),Mt=56320|1023&Mt),lt+=String.fromCharCode(Mt),st+=Ct}return lt}(this.buf,Re,me)},readBytes:function(){var me=this.readVarint()+this.pos,Re=this.buf.subarray(this.pos,me);return this.pos=me,Re},readPackedVarint:function(me,Re){if(this.type!==e.Bytes)return me.push(this.readVarint(Re));var Ue=l(this);for(me=me||[];this.pos<Ue;)me.push(this.readVarint(Re));return me},readPackedSVarint:function(me){if(this.type!==e.Bytes)return me.push(this.readSVarint());var Re=l(this);for(me=me||[];this.pos<Re;)me.push(this.readSVarint());return me},readPackedBoolean:function(me){if(this.type!==e.Bytes)return me.push(this.readBoolean());var Re=l(this);for(me=me||[];this.pos<Re;)me.push(this.readBoolean());return me},readPackedFloat:function(me){if(this.type!==e.Bytes)return me.push(this.readFloat());var Re=l(this);for(me=me||[];this.pos<Re;)me.push(this.readFloat());return me},readPackedDouble:function(me){if(this.type!==e.Bytes)return me.push(this.readDouble());var Re=l(this);for(me=me||[];this.pos<Re;)me.push(this.readDouble());return me},readPackedFixed32:function(me){if(this.type!==e.Bytes)return me.push(this.readFixed32());var Re=l(this);for(me=me||[];this.pos<Re;)me.push(this.readFixed32());return me},readPackedSFixed32:function(me){if(this.type!==e.Bytes)return me.push(this.readSFixed32());var Re=l(this);for(me=me||[];this.pos<Re;)me.push(this.readSFixed32());return me},readPackedFixed64:function(me){if(this.type!==e.Bytes)return me.push(this.readFixed64());var Re=l(this);for(me=me||[];this.pos<Re;)me.push(this.readFixed64());return me},readPackedSFixed64:function(me){if(this.type!==e.Bytes)return me.push(this.readSFixed64());var Re=l(this);for(me=me||[];this.pos<Re;)me.push(this.readSFixed64());return me},skip:function(me){var Re=7&me;if(Re===e.Varint)for(;this.buf[this.pos++]>127;);else if(Re===e.Bytes)this.pos=this.readVarint()+this.pos;else if(Re===e.Fixed32)this.pos+=4;else{if(Re!==e.Fixed64)throw new Error("Unimplemented type: "+Re);this.pos+=8}},writeTag:function(me,Re){this.writeVarint(me<<3|Re)},realloc:function(me){for(var Re=this.length||16;Re<this.pos+me;)Re*=2;if(Re!==this.length){var Ue=new Uint8Array(Re);Ue.set(this.buf),this.buf=Ue,this.length=Re}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(me){this.realloc(4),we(this.buf,me,this.pos),this.pos+=4},writeSFixed32:function(me){this.realloc(4),we(this.buf,me,this.pos),this.pos+=4},writeFixed64:function(me){this.realloc(8),we(this.buf,-1&me,this.pos),we(this.buf,Math.floor(me*s),this.pos+4),this.pos+=8},writeSFixed64:function(me){this.realloc(8),we(this.buf,-1&me,this.pos),we(this.buf,Math.floor(me*s),this.pos+4),this.pos+=8},writeVarint:function(me){(me=+me||0)>268435455||me<0?function(Re,Ue){var $e,ct;if(Re>=0?($e=Re%4294967296|0,ct=Re/4294967296|0):(ct=~(-Re/4294967296),4294967295^($e=~(-Re%4294967296))?$e=$e+1|0:($e=0,ct=ct+1|0)),Re>=18446744073709552e3||Re<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Ue.realloc(10),function(lt,st,xt){xt.buf[xt.pos++]=127&lt|128,lt>>>=7,xt.buf[xt.pos++]=127&lt|128,lt>>>=7,xt.buf[xt.pos++]=127&lt|128,lt>>>=7,xt.buf[xt.pos++]=127&lt|128,xt.buf[xt.pos]=127&(lt>>>=7)}($e,0,Ue),function(lt,st){var xt=(7&lt)<<4;st.buf[st.pos++]|=xt|((lt>>>=3)?128:0),lt&&(st.buf[st.pos++]=127&lt|((lt>>>=7)?128:0),lt&&(st.buf[st.pos++]=127&lt|((lt>>>=7)?128:0),lt&&(st.buf[st.pos++]=127&lt|((lt>>>=7)?128:0),lt&&(st.buf[st.pos++]=127&lt|((lt>>>=7)?128:0),lt&&(st.buf[st.pos++]=127&lt)))))}(ct,Ue)}(me,this):(this.realloc(4),this.buf[this.pos++]=127&me|(me>127?128:0),me<=127||(this.buf[this.pos++]=127&(me>>>=7)|(me>127?128:0),me<=127||(this.buf[this.pos++]=127&(me>>>=7)|(me>127?128:0),me<=127||(this.buf[this.pos++]=me>>>7&127))))},writeSVarint:function(me){this.writeVarint(me<0?2*-me-1:2*me)},writeBoolean:function(me){this.writeVarint(!!me)},writeString:function(me){me=String(me),this.realloc(4*me.length),this.pos++;var Re=this.pos;this.pos=function($e,ct,lt){for(var st,xt,dt=0;dt<ct.length;dt++){if((st=ct.charCodeAt(dt))>55295&&st<57344){if(!xt){st>56319||dt+1===ct.length?($e[lt++]=239,$e[lt++]=191,$e[lt++]=189):xt=st;continue}if(st<56320){$e[lt++]=239,$e[lt++]=191,$e[lt++]=189,xt=st;continue}st=xt-55296<<10|st-56320|65536,xt=null}else xt&&($e[lt++]=239,$e[lt++]=191,$e[lt++]=189,xt=null);st<128?$e[lt++]=st:(st<2048?$e[lt++]=st>>6|192:(st<65536?$e[lt++]=st>>12|224:($e[lt++]=st>>18|240,$e[lt++]=st>>12&63|128),$e[lt++]=st>>6&63|128),$e[lt++]=63&st|128)}return lt}(this.buf,me,this.pos);var Ue=this.pos-Re;Ue>=128&&R(Re,Ue,this),this.pos=Re-1,this.writeVarint(Ue),this.pos+=Ue},writeFloat:function(me){this.realloc(4),o.write(this.buf,me,this.pos,!0,23,4),this.pos+=4},writeDouble:function(me){this.realloc(8),o.write(this.buf,me,this.pos,!0,52,8),this.pos+=8},writeBytes:function(me){var Re=me.length;this.writeVarint(Re),this.realloc(Re);for(var Ue=0;Ue<Re;Ue++)this.buf[this.pos++]=me[Ue]},writeRawMessage:function(me,Re){this.pos++;var Ue=this.pos;me(Re,this);var $e=this.pos-Ue;$e>=128&&R(Ue,$e,this),this.pos=Ue-1,this.writeVarint($e),this.pos+=$e},writeMessage:function(me,Re,Ue){this.writeTag(me,e.Bytes),this.writeRawMessage(Re,Ue)},writePackedVarint:function(me,Re){Re.length&&this.writeMessage(me,N,Re)},writePackedSVarint:function(me,Re){Re.length&&this.writeMessage(me,$,Re)},writePackedBoolean:function(me,Re){Re.length&&this.writeMessage(me,H,Re)},writePackedFloat:function(me,Re){Re.length&&this.writeMessage(me,I,Re)},writePackedDouble:function(me,Re){Re.length&&this.writeMessage(me,j,Re)},writePackedFixed32:function(me,Re){Re.length&&this.writeMessage(me,F,Re)},writePackedSFixed32:function(me,Re){Re.length&&this.writeMessage(me,V,Re)},writePackedFixed64:function(me,Re){Re.length&&this.writeMessage(me,Y,Re)},writePackedSFixed64:function(me,Re){Re.length&&this.writeMessage(me,oe,Re)},writeBytesField:function(me,Re){this.writeTag(me,e.Bytes),this.writeBytes(Re)},writeFixed32Field:function(me,Re){this.writeTag(me,e.Fixed32),this.writeFixed32(Re)},writeSFixed32Field:function(me,Re){this.writeTag(me,e.Fixed32),this.writeSFixed32(Re)},writeFixed64Field:function(me,Re){this.writeTag(me,e.Fixed64),this.writeFixed64(Re)},writeSFixed64Field:function(me,Re){this.writeTag(me,e.Fixed64),this.writeSFixed64(Re)},writeVarintField:function(me,Re){this.writeTag(me,e.Varint),this.writeVarint(Re)},writeSVarintField:function(me,Re){this.writeTag(me,e.Varint),this.writeSVarint(Re)},writeStringField:function(me,Re){this.writeTag(me,e.Bytes),this.writeString(Re)},writeFloatField:function(me,Re){this.writeTag(me,e.Fixed32),this.writeFloat(Re)},writeDoubleField:function(me,Re){this.writeTag(me,e.Fixed64),this.writeDouble(Re)},writeBooleanField:function(me,Re){this.writeVarintField(me,!!Re)}},s_}var Jd=S(Rv());const u_=3;function US(o,e,i){e.glyphs=[],o===1&&i.readMessage(jS,e)}function jS(o,e,i){if(o===3){const{id:s,bitmap:f,width:l,height:d,left:R,top:N,advance:$}=i.readMessage(VS,{});e.glyphs.push({id:s,bitmap:new Ks({width:l+2*u_,height:d+2*u_},f),metrics:{width:l,height:d,left:R,top:N,advance:$}})}else o===4?e.ascender=i.readSVarint():o===5&&(e.descender=i.readSVarint())}function VS(o,e,i){o===1?e.id=i.readVarint():o===2?e.bitmap=i.readBytes():o===3?e.width=i.readVarint():o===4?e.height=i.readVarint():o===5?e.left=i.readSVarint():o===6?e.top=i.readSVarint():o===7&&(e.advance=i.readVarint())}const GS=u_,Va={horizontal:1,vertical:2,horizontalOnly:3};class tf{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const s=new tf;return s.scale=e||1,s.fontStack=i,s}static forImage(e){const i=new tf;return i.image=e,i}}class xc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const s=new xc;for(let f=0;f<e.sections.length;f++){const l=e.sections[f];l.image?s.addImageSection(l):s.addTextSection(l,i)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,s){let f="";for(let l=0;l<i.length;l++){const d=i.charCodeAt(l+1)||null,R=i.charCodeAt(l-1)||null;f+=!s&&(d&&wh(d)&&!ef[i[l+1]]||R&&wh(R)&&!ef[i[l-1]])||!ef[i[l]]?i[l]:ef[i[l]]}return f}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Qd[this.text.charCodeAt(s)];s++)e++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Qd[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const s=new xc;return s.text=this.text.substring(e,i),s.sectionIndex=this.sectionIndex.slice(e,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(tf.forText(e.scale,e.fontStack||i));const s=this.sections.length-1;for(let f=0;f<e.text.length;++f)this.sectionIndex.push(s)}addImageSection(e){const i=e.image&&e.image.namePrimary?e.image.getPrimary():null;if(!i)return void St("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCodePoint(s),this.sections.push(tf.forImage(i)),this.sectionIndex.push(this.sections.length-1)):St("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function c_(o,e,i,s,f,l,d,R,N,$,I,j,H,F,V){const Y=xc.fromFeature(o,f);j===Va.vertical&&Y.verticalizePunctuation(H);let oe=[];const ce=function(Ue,$e,ct,lt,st,xt){if(!Ue)return[];const dt=[],Et=function(kt,jt,Ot,Kt,ur,Jt){let yr=0;for(let _r=0;_r<kt.length();_r++){const Er=kt.getSection(_r);yr+=Dv(kt.getCodePoint(_r),Er,Kt,ur,jt,Jt)}return yr/Math.max(1,Math.ceil(yr/Ot))}(Ue,$e,ct,lt,st,xt),It=Ue.text.indexOf("​")>=0;let Mt=0;for(let kt=0;kt<Ue.length();kt++){const jt=Ue.getSection(kt),Ot=Ue.getCodePoint(kt);if(Qd[Ot]||(Mt+=Dv(Ot,jt,lt,st,$e,xt)),kt<Ue.length()-1){const Kt=!((Ct=Ot)<11904||!(jr["Bopomofo Extended"](Ct)||jr.Bopomofo(Ct)||jr["CJK Compatibility Forms"](Ct)||jr["CJK Compatibility Ideographs"](Ct)||jr["CJK Compatibility"](Ct)||jr["CJK Radicals Supplement"](Ct)||jr["CJK Strokes"](Ct)||jr["CJK Symbols and Punctuation"](Ct)||jr["CJK Unified Ideographs Extension A"](Ct)||jr["CJK Unified Ideographs"](Ct)||jr["Enclosed CJK Letters and Months"](Ct)||jr["Halfwidth and Fullwidth Forms"](Ct)||jr.Hiragana(Ct)||jr["Ideographic Description Characters"](Ct)||jr["Kangxi Radicals"](Ct)||jr["Katakana Phonetic Extensions"](Ct)||jr.Katakana(Ct)||jr["Vertical Forms"](Ct)||jr["Yi Radicals"](Ct)||jr["Yi Syllables"](Ct)));(HS[Ot]||Kt||jt.image)&&dt.push(Ov(kt+1,Mt,Et,dt,qS(Ot,Ue.getCodePoint(kt+1),Kt&&It),!1))}}var Ct;return zv(Ov(Ue.length(),Mt,Et,dt,0,!0))}(Y,$,l,e,s,F),{processBidirectionalText:we,processStyledBidirectionalText:Ie}=Ta;if(we&&Y.sections.length===1){const Ue=we(Y.toString(),ce);for(const $e of Ue){const ct=new xc;ct.text=$e,ct.sections=Y.sections;for(let lt=0;lt<$e.length;lt++)ct.sectionIndex.push(0);oe.push(ct)}}else if(Ie){const Ue=Ie(Y.text,Y.sectionIndex,ce);for(const $e of Ue){const ct=new xc;ct.text=$e[0],ct.sectionIndex=$e[1],ct.sections=Y.sections,oe.push(ct)}}else oe=function(Ue,$e){const ct=[],lt=Ue.text;let st=0;for(const xt of $e)ct.push(Ue.substring(st,xt)),st=xt;return st<lt.length&&ct.push(Ue.substring(st,lt.length)),ct}(Y,ce);const me=[],Re={positionedLines:me,text:Y.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:j,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Ue,$e,ct,lt,st,xt,dt,Et,It,Mt,Ct,kt){let jt=0,Ot=0,Kt=0;const ur=Et==="right"?1:Et==="left"?0:.5;let Jt=!1;for(const vr of st){const zr=vr.getSections();for(const Yr of zr){if(Yr.image)continue;const li=$e[Yr.fontStack];if(li&&(Jt=li.ascender!==void 0&&li.descender!==void 0,!Jt))break}if(!Jt)break}let yr=0;for(const vr of st){vr.trim();const zr=vr.getMaxScale(),Yr=(zr-1)*Vn,li={positionedGlyphs:[],lineOffset:0};Ue.positionedLines[yr]=li;const ci=li.positionedGlyphs;let _i=0;if(!vr.length()){Ot+=xt,++yr;continue}let hi=0,yi=0;for(let Bi=0;Bi<vr.length();Bi++){const ni=vr.getSection(Bi),Fi=vr.getSectionIndex(Bi),zi=vr.getCodePoint(Bi);let Gi=ni.scale,gn=null,yn=null,fn=null,ha=Vn,Qi=0;const rn=!(It===Va.horizontal||!Ct&&!$u(zi)||Ct&&(Qd[zi]||(_r=zi,jr.Arabic(_r)||jr["Arabic Supplement"](_r)||jr["Arabic Extended-A"](_r)||jr["Arabic Presentation Forms-A"](_r)||jr["Arabic Presentation Forms-B"](_r))));if(ni.image){const Jn=lt[ni.image.serialize()];if(!Jn)continue;fn=ni.image.id,Ue.iconsInText=Ue.iconsInText||!0,yn=Jn.paddedRect;const vn=Jn.displaySize;Gi=Gi*Vn/kt,gn={width:vn[0],height:vn[1],left:0,top:-3,advance:rn?vn[1]:vn[0],localGlyph:!1},Qi=Jt?-gn.height*Gi:zr*Vn-17-vn[1]*Gi,ha=gn.advance;const _a=(rn?vn[0]:vn[1])*Gi-Vn*zr;_a>0&&_a>_i&&(_i=_a)}else{const Jn=ct[ni.fontStack];if(!Jn)continue;Jn[zi]&&(yn=Jn[zi]);const vn=$e[ni.fontStack];if(!vn)continue;const _a=vn.glyphs[zi];if(!_a)continue;if(gn=_a.metrics,ha=zi!==8203?Vn:0,Jt){const Sn=vn.ascender!==void 0?Math.abs(vn.ascender):0,jo=vn.descender!==void 0?Math.abs(vn.descender):0,il=(Sn+jo)*Gi;hi<il&&(hi=il,yi=(Sn-jo)/2*Gi),Qi=-Sn*Gi}else Qi=(zr-Gi)*Vn-17}rn?(Ue.verticalizable=!0,ci.push({glyph:zi,imageName:fn,x:jt,y:Ot+Qi,vertical:rn,scale:Gi,localGlyph:gn.localGlyph,fontStack:ni.fontStack,sectionIndex:Fi,metrics:gn,rect:yn}),jt+=ha*Gi+Mt):(ci.push({glyph:zi,imageName:fn,x:jt,y:Ot+Qi,vertical:rn,scale:Gi,localGlyph:gn.localGlyph,fontStack:ni.fontStack,sectionIndex:Fi,metrics:gn,rect:yn}),jt+=gn.advance*Gi+Mt)}ci.length!==0&&(Kt=Math.max(jt-Mt,Kt),Jt?kv(ci,ur,_i,yi,xt*zr/2):kv(ci,ur,_i,0,xt/2)),jt=0;const Vi=xt*zr+_i;li.lineOffset=Math.max(_i,Yr),Ot+=Vi,++yr}var _r;const Er=Ot,{horizontalAlign:rr,verticalAlign:kr}=h_(dt);(function(vr,zr,Yr,li,ci,_i){const hi=(zr-Yr)*ci,yi=-_i*li;for(const Vi of vr)for(const Bi of Vi.positionedGlyphs)Bi.x+=hi,Bi.y+=yi})(Ue.positionedLines,ur,rr,kr,Kt,Er),Ue.top+=-kr*Er,Ue.bottom=Ue.top+Er,Ue.left+=-rr*Kt,Ue.right=Ue.left+Kt,Ue.hasBaseline=Jt}(Re,e,i,s,oe,d,R,N,j,$,H,V),!function(Ue){for(const $e of Ue)if($e.positionedGlyphs.length!==0)return!1;return!0}(me)&&Re}const Qd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},HS={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Dv(o,e,i,s,f,l){if(e.image){const d=s[e.image.serialize()];return d?d.displaySize[0]*e.scale*Vn/l+f:0}{const d=i[e.fontStack],R=d&&d.glyphs[o];return R?R.metrics.advance*e.scale+f:0}}function Lv(o,e,i,s){const f=Math.pow(o-e,2);return s?o<e?f/2:2*f:f+Math.abs(i)*i}function qS(o,e,i){let s=0;return o===10&&(s-=1e4),i&&(s+=150),o!==40&&o!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Ov(o,e,i,s,f,l){let d=null,R=Lv(e,i,f,l);for(const N of s){const $=Lv(e-N.x,i,f,l)+N.badness;$<=R&&(d=N,R=$)}return{index:o,x:e,priorBreak:d,badness:R}}function zv(o){return o?zv(o.priorBreak).concat(o.index):[]}function h_(o){let e=.5,i=.5;switch(o){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function kv(o,e,i,s,f){if(!(e||i||s||f))return;const l=o.length-1,d=o[l],R=(d.x+d.metrics.advance*d.scale)*e;for(let N=0;N<=l;N++)o[N].x-=R,o[N].y+=i+s+f}function WS(o,e,i,s){const{horizontalAlign:f,verticalAlign:l}=h_(s),d=i[0]-o.displaySize[0]*f,R=i[1]-o.displaySize[1]*l;return{imagePrimary:o,imageSecondary:e,top:R,bottom:R+o.displaySize[1],left:d,right:d+o.displaySize[0]}}function Bv(o,e,i,s,f,l){const d=o.imagePrimary;let R;if(d.content){const oe=d.content,ce=d.pixelRatio||1;R=[oe[0]/ce,oe[1]/ce,d.displaySize[0]-oe[2]/ce,d.displaySize[1]-oe[3]/ce]}const N=e.left*l,$=e.right*l;let I,j,H,F;i==="width"||i==="both"?(F=f[0]+N-s[3],j=f[0]+$+s[1]):(F=f[0]+(N+$-d.displaySize[0])/2,j=F+d.displaySize[0]);const V=e.top*l,Y=e.bottom*l;return i==="height"||i==="both"?(I=f[1]+V-s[0],H=f[1]+Y+s[2]):(I=f[1]+(V+Y-d.displaySize[1])/2,H=I+d.displaySize[1]),{imagePrimary:d,imageSecondary:void 0,top:I,right:j,bottom:H,left:F,collisionPadding:R}}class fs extends Ge{constructor(e,i,s,f,l){super(e,i),this.angle=f,this.z=s,l!==void 0&&(this.segment=l)}clone(){return new fs(this.x,this.y,this.z,this.angle,this.segment)}}function Fv(o,e,i,s,f){if(e.segment===void 0)return!0;let l=e,d=e.segment+1,R=0;for(;R>-i/2;){if(d--,d<0)return!1;R-=o[d].dist(l),l=o[d]}R+=o[d].dist(o[d+1]),d++;const N=[];let $=0;for(;R<i/2;){const I=o[d],j=o[d+1];if(!j)return!1;let H=o[d-1].angleTo(I)-I.angleTo(j);for(H=Math.abs((H+3*Math.PI)%(2*Math.PI)-Math.PI),N.push({distance:R,angleDelta:H}),$+=H;R-N[0].distance>s;)$-=N.shift().angleDelta;if($>f)return!1;d++,R+=I.dist(j)}return!0}function Nv(o){let e=0;for(let i=0;i<o.length-1;i++)e+=o[i].dist(o[i+1]);return e}function Uv(o,e,i){return o?.6*e*i:0}function jv(o,e){return Math.max(o?o.right-o.left:0,e?e.right-e.left:0)}function $S(o,e,i,s,f,l){const d=Uv(i,f,l),R=jv(i,s)*l;let N=0;const $=Nv(o)/2;for(let I=0;I<o.length-1;I++){const j=o[I],H=o[I+1],F=j.dist(H);if(N+F>$){const V=($-N)/F,Y=Qr(j.x,H.x,V),oe=Qr(j.y,H.y,V),ce=new fs(Y,oe,0,H.angleTo(j),I);return!d||Fv(o,ce,R,d,e)?ce:void 0}N+=F}}function ZS(o,e,i,s,f,l,d,R,N){const $=Uv(s,l,d),I=jv(s,f),j=I*d,H=o[0].x===0||o[0].x===N||o[0].y===0||o[0].y===N;return e-j<e/4&&(e=j+e/4),Vv(o,H?e/2*R%e:(I/2+2*l)*d*R%e,e,$,i,j,H,!1,N)}function Vv(o,e,i,s,f,l,d,R,N){const $=l/2,I=Nv(o);let j=0,H=e-i,F=[];for(let V=0;V<o.length-1;V++){const Y=o[V],oe=o[V+1],ce=Y.dist(oe),we=oe.angleTo(Y);for(;H+i<j+ce;){H+=i;const Ie=(H-j)/ce,me=Qr(Y.x,oe.x,Ie),Re=Qr(Y.y,oe.y,Ie);if(me>=0&&me<N&&Re>=0&&Re<N&&H-$>=0&&H+$<=I){const Ue=new fs(me,Re,0,we,V);s&&!Fv(o,Ue,l,s,f)||F.push(Ue)}}j+=ce}return R||F.length||d||(F=Vv(o,j/2,i,s,f,l,d,!0,N)),F}function Gv(o,e,i,s,f){const l=[];for(let d=0;d<o.length;d++){const R=o[d];let N;for(let $=0;$<R.length-1;$++){let I=R[$],j=R[$+1];I.x<e&&j.x<e||(I.x<e?I=new Ge(e,I.y+(e-I.x)/(j.x-I.x)*(j.y-I.y))._round():j.x<e&&(j=new Ge(e,I.y+(e-I.x)/(j.x-I.x)*(j.y-I.y))._round()),I.y<i&&j.y<i||(I.y<i?I=new Ge(I.x+(i-I.y)/(j.y-I.y)*(j.x-I.x),i)._round():j.y<i&&(j=new Ge(I.x+(i-I.y)/(j.y-I.y)*(j.x-I.x),i)._round()),I.x>=s&&j.x>=s||(I.x>=s?I=new Ge(s,I.y+(s-I.x)/(j.x-I.x)*(j.y-I.y))._round():j.x>=s&&(j=new Ge(s,I.y+(s-I.x)/(j.x-I.x)*(j.y-I.y))._round()),I.y>=f&&j.y>=f||(I.y>=f?I=new Ge(I.x+(f-I.y)/(j.y-I.y)*(j.x-I.x),f)._round():j.y>=f&&(j=new Ge(I.x+(f-I.y)/(j.y-I.y)*(j.x-I.x),f)._round()),N&&I.equals(N[N.length-1])||(N=[I],l.push(N)),N.push(j)))))}}return l}function Hv(o){let e=0,i=0;for(const d of o)e+=d.w*d.h,i=Math.max(i,d.w);o.sort((d,R)=>R.h-d.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let f=0,l=0;for(const d of o)for(let R=s.length-1;R>=0;R--){const N=s[R];if(!(d.w>N.w||d.h>N.h)){if(d.x=N.x,d.y=N.y,l=Math.max(l,d.y+d.h),f=Math.max(f,d.x+d.w),d.w===N.w&&d.h===N.h){const $=s.pop();R<s.length&&(s[R]=$)}else d.h===N.h?(N.x+=d.w,N.w-=d.w):d.w===N.w?(N.y+=d.h,N.h-=d.h):(s.push({x:N.x+d.w,y:N.y,w:N.w-d.w,h:d.h}),N.y+=d.h,N.h-=d.h);break}}return{w:f,h:l,fill:e/(f*l)||0}}Dr(fs,"Anchor");const rf=1;class f_{constructor(e,{pixelRatio:i,version:s,stretchX:f,stretchY:l,content:d},R){this.paddedRect=e,this.pixelRatio=i,this.stretchX=f,this.stretchY=l,this.content=d,this.version=s,this.padding=R}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class qv{constructor(e,i,s){const f={},l={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,f,rf,d),this.addImages(i,l,2,d);const{w:R,h:N}=Hv(d),$=new Xn({width:R||1,height:N||1});for(const I in e){const j=e[I],H=f[I].paddedRect;Xn.copy(j.data,$,{x:0,y:0},{x:H.x+rf,y:H.y+rf},j.data,s,j.sdf)}for(const I in i){const j=i[I],H=l[I].paddedRect;let F=l[I].padding;const V=H.x+F,Y=H.y+F,oe=j.data.width,ce=j.data.height;F=F>1?F-1:F,Xn.copy(j.data,$,{x:0,y:0},{x:V,y:Y},j.data,s),Xn.copy(j.data,$,{x:0,y:ce-F},{x:V,y:Y-F},{width:oe,height:F},s),Xn.copy(j.data,$,{x:0,y:0},{x:V,y:Y+ce},{width:oe,height:F},s),Xn.copy(j.data,$,{x:oe-F,y:0},{x:V-F,y:Y},{width:F,height:ce},s),Xn.copy(j.data,$,{x:0,y:0},{x:V+oe,y:Y},{width:F,height:ce},s),Xn.copy(j.data,$,{x:oe-F,y:ce-F},{x:V-F,y:Y-F},{width:F,height:F},s),Xn.copy(j.data,$,{x:0,y:ce-F},{x:V+oe,y:Y-F},{width:F,height:F},s),Xn.copy(j.data,$,{x:0,y:0},{x:V+oe,y:Y+ce},{width:F,height:F},s),Xn.copy(j.data,$,{x:oe-F,y:0},{x:V-F,y:Y+ce},{width:F,height:F},s)}this.image=$,this.iconPositions=f,this.patternPositions=l}addImages(e,i,s,f){for(const l in e){const d=e[l],R={x:0,y:0,w:d.data.width+2*s,h:d.data.height+2*s};f.push(R),i[l]=new f_(R,d,s),d.hasRenderCallback&&this.haveRenderCallbacks.push($a.deserializeId(l))}}patchUpdatedImages(e,i,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(f=>e.hasImage(f,s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(const f in e.getUpdatedImages(s)){for(const l of Object.keys(this.iconPositions))$a.deserializeId(l)===f&&this.patchUpdatedImage(this.iconPositions[l],e.getImage(f,s),i);for(const l of Object.keys(this.patternPositions))$a.deserializeId(l)===f&&this.patchUpdatedImage(this.patternPositions[l],e.getImage(f,s),i)}}patchUpdatedImage(e,i,s){if(!e||!i||e.version===i.version)return;e.version=i.version;const[f,l]=e.tl;s.update(i.data,{position:{x:f,y:l}})}}Dr(f_,"ImagePosition"),Dr(qv,"ImageAtlas");const ep=1e20;function Wv(o,e,i,s,f,l,d,R,N){for(let $=e;$<e+s;$++)$v(o,i*l+$,l,f,d,R,N);for(let $=i;$<i+f;$++)$v(o,$*l+e,1,s,d,R,N)}function $v(o,e,i,s,f,l,d){l[0]=0,d[0]=-1e20,d[1]=ep,f[0]=o[e];for(let R=1,N=0,$=0;R<s;R++){f[R]=o[e+R*i];const I=R*R;do{const j=l[N];$=(f[R]-f[j]+I-j*j)/(R-j)/2}while($<=d[N]&&--N>-1);N++,l[N]=R,d[N]=$,d[N+1]=ep}for(let R=0,N=0;R<s;R++){for(;d[N+1]<R;)N++;const $=l[N],I=R-$;o[e+R*i]=f[$]+I*I}}const vo=2,d_={none:0,ideographs:1,all:2};class wc{constructor(e,i,s){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=s,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,s){const f=[],l=this.urls[i]||Q.GLYPHS_URL;for(const d in e)for(const R of e[d])f.push({stack:d,id:R});Ft(f,({stack:d,id:R},N)=>{let $=this.entries[d];$||($=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let I=$.glyphs[R];if(I!==void 0)return void N(null,{stack:d,id:R,glyph:I});if(I=this._tinySDF($,d,R),I)return $.glyphs[R]=I,void N(null,{stack:d,id:R,glyph:I});const j=Math.floor(R/256);if(256*j>65535)return St("glyphs > 65535 not supported"),void N(null,{stack:d,id:R,glyph:I});if($.ranges[j])return void N(null,{stack:d,id:R,glyph:I});let H=$.requests[j];H||(H=$.requests[j]=[],wc.loadGlyphRange(d,j,l,this.requestManager,(F,V)=>{if(V){$.ascender=V.ascender,$.descender=V.descender;for(const Y in V.glyphs)this._doesCharSupportLocalGlyph(+Y)||($.glyphs[+Y]=V.glyphs[+Y]);$.ranges[j]=!0}for(const Y of H)Y(F,V);delete $.requests[j]})),H.push((F,V)=>{F?N(F):V&&N(null,{stack:d,id:R,glyph:V.glyphs[R]||null})})},(d,R)=>{if(d)s(d);else if(R){const N={};for(const{stack:$,id:I,glyph:j}of R)N[$]===void 0&&(N[$]={}),N[$].glyphs===void 0&&(N[$].glyphs={}),N[$].glyphs[I]=j&&{id:j.id,bitmap:j.bitmap.clone(),metrics:j.metrics},N[$].ascender=this.entries[$].ascender,N[$].descender=this.entries[$].descender;s(null,N)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==d_.none&&(this.localGlyphMode===d_.all?!!this.localFontFamily:!!this.localFontFamily&&(jr["CJK Unified Ideographs"](e)||jr["Hangul Syllables"](e)||jr.Hiragana(e)||jr.Katakana(e)||jr["CJK Symbols and Punctuation"](e)||jr["CJK Unified Ideographs Extension A"](e)||jr["CJK Unified Ideographs Extension B"](e)||jr.Osage(e)))}_tinySDF(e,i,s){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(s))return;let l=e.tinySDF;if(!l){let Y="400";/bold/i.test(i)?Y="900":/medium/i.test(i)?Y="500":/light/i.test(i)&&(Y="200"),l=e.tinySDF=new wc.TinySDF({fontFamily:f,fontWeight:Y,fontSize:24*vo,buffer:3*vo,radius:8*vo}),l.fontWeight=Y}if(this.localGlyphs[l.fontWeight][s])return this.localGlyphs[l.fontWeight][s];const d=String.fromCodePoint(s),{data:R,width:N,height:$,glyphWidth:I,glyphHeight:j,glyphLeft:H,glyphTop:F,glyphAdvance:V}=l.draw(d);return this.localGlyphs[l.fontWeight][s]={id:s,bitmap:new Ks({width:N,height:$},R),metrics:{width:I/vo,height:j/vo,left:H/vo,top:F/vo-27,advance:V/vo,localGlyph:!0}}}}wc.loadGlyphRange=function(o,e,i,s,f){const l=256*e,d=l+255,R=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",o).replace("{range}",`${l}-${d}`),Cr.Glyphs);Ra(R,(N,$)=>{if(N)f(N);else if($){const I={},j=function(H){return new Jd(H).readFields(US,{})}($);for(const H of j.glyphs)I[H.id]=H;f(null,{glyphs:I,ascender:j.ascender,descender:j.descender})}})},wc.TinySDF=class{constructor({fontSize:o=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:f="sans-serif",fontWeight:l="normal",fontStyle:d="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=i;const R=this.size=o+4*e,N=this._createCanvas(R),$=this.ctx=N.getContext("2d",{willReadFrequently:!0});$.font=`${d} ${l} ${o}px ${f}`,$.textBaseline="alphabetic",$.textAlign="left",$.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Uint16Array(R)}_createCanvas(o){const e=document.createElement("canvas");return e.width=e.height=o,e}draw(o){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:f,actualBoundingBoxRight:l}=this.ctx.measureText(o),d=Math.ceil(i),R=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-f))),N=Math.min(this.size-this.buffer,d+Math.ceil(s)),$=R+2*this.buffer,I=N+2*this.buffer,j=Math.max($*I,0),H=new Uint8ClampedArray(j),F={data:H,width:$,height:I,glyphWidth:R,glyphHeight:N,glyphTop:d,glyphLeft:0,glyphAdvance:e};if(R===0||N===0)return F;const{ctx:V,buffer:Y,gridInner:oe,gridOuter:ce}=this;V.clearRect(Y,Y,R,N),V.fillText(o,Y,Y+d);const we=V.getImageData(Y,Y,R,N);ce.fill(ep,0,j),oe.fill(0,0,j);for(let Ie=0;Ie<N;Ie++)for(let me=0;me<R;me++){const Re=we.data[4*(Ie*R+me)+3]/255;if(Re===0)continue;const Ue=(Ie+Y)*$+me+Y;if(Re===1)ce[Ue]=0,oe[Ue]=ep;else{const $e=.5-Re;ce[Ue]=$e>0?$e*$e:0,oe[Ue]=$e<0?$e*$e:0}}Wv(ce,0,0,$,I,$,this.f,this.v,this.z),Wv(oe,Y,Y,R,N,$,this.f,this.v,this.z);for(let Ie=0;Ie<j;Ie++){const me=Math.sqrt(ce[Ie])-Math.sqrt(oe[Ie]);H[Ie]=Math.round(255-255*(me/this.radius+this.cutoff))}return F}};const Yl=rf;function Zv(o,e){return o+e[1]-e[0]}function Xv(o,e,i,s,f=1){const l=[],d=o.imagePrimary,R=d.pixelRatio,N=d.paddedRect.w-2*Yl,$=d.paddedRect.h-2*Yl,I=(o.right-o.left)*f,j=(o.bottom-o.top)*f,H=d.stretchX||[[0,N]],F=d.stretchY||[[0,$]],V=H.reduce(Zv,0),Y=F.reduce(Zv,0),oe=N-V,ce=$-Y;let we=0,Ie=V,me=0,Re=Y,Ue=0,$e=oe,ct=0,lt=ce;if(d.content&&s){const xt=d.content;we=tp(H,0,xt[0]),me=tp(F,0,xt[1]),Ie=tp(H,xt[0],xt[2]),Re=tp(F,xt[1],xt[3]),Ue=xt[0]-we,ct=xt[1]-me,$e=xt[2]-xt[0]-Ie,lt=xt[3]-xt[1]-Re}const st=(xt,dt,Et,It)=>{const Mt=rp(xt.stretch-we,Ie,I,o.left*f),Ct=ip(xt.fixed-Ue,$e,xt.stretch,V),kt=rp(dt.stretch-me,Re,j,o.top*f),jt=ip(dt.fixed-ct,lt,dt.stretch,Y),Ot=rp(Et.stretch-we,Ie,I,o.left*f),Kt=ip(Et.fixed-Ue,$e,Et.stretch,V),ur=rp(It.stretch-me,Re,j,o.top*f),Jt=ip(It.fixed-ct,lt,It.stretch,Y),yr=new Ge(Mt,kt),_r=new Ge(Ot,kt),Er=new Ge(Ot,ur),rr=new Ge(Mt,ur),kr=new Ge(Ct/R,jt/R),vr=new Ge(Kt/R,Jt/R),zr=e*Math.PI/180;if(zr){const yi=Math.sin(zr),Vi=Math.cos(zr),Bi=[Vi,-yi,yi,Vi];yr._matMult(Bi),_r._matMult(Bi),rr._matMult(Bi),Er._matMult(Bi)}const Yr=xt.stretch+xt.fixed,li=Et.stretch+Et.fixed,ci=dt.stretch+dt.fixed,_i=It.stretch+It.fixed,hi=o.imageSecondary;return{tl:yr,tr:_r,bl:rr,br:Er,texPrimary:{x:d.paddedRect.x+Yl+Yr,y:d.paddedRect.y+Yl+ci,w:li-Yr,h:_i-ci},texSecondary:hi?{x:hi.paddedRect.x+Yl+Yr,y:hi.paddedRect.y+Yl+ci,w:li-Yr,h:_i-ci}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:kr,pixelOffsetBR:vr,minFontScaleX:$e/R/I,minFontScaleY:lt/R/j,isSDF:i}};if(s&&(d.stretchX||d.stretchY)){const xt=Yv(H,oe,V),dt=Yv(F,ce,Y);for(let Et=0;Et<xt.length-1;Et++){const It=xt[Et],Mt=xt[Et+1];for(let Ct=0;Ct<dt.length-1;Ct++)l.push(st(It,dt[Ct],Mt,dt[Ct+1]))}}else l.push(st({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:N+1},{fixed:0,stretch:$+1}));return l}function tp(o,e,i){let s=0;for(const f of o)s+=Math.max(e,Math.min(i,f[1]))-Math.max(e,Math.min(i,f[0]));return s}function Yv(o,e,i){const s=[{fixed:-1,stretch:0}];for(const[f,l]of o){const d=s[s.length-1];s.push({fixed:f-d.stretch,stretch:d.stretch}),s.push({fixed:f-d.stretch,stretch:d.stretch+(l-f)})}return s.push({fixed:e+Yl,stretch:i}),s}function rp(o,e,i,s){return o/e*i+s}function ip(o,e,i,s){return o-e*i/s}function XS(o,e,i,s){const f=e+o.positionedLines[s].lineOffset;return s===0?i+f/2:i+(f+(e+o.positionedLines[s-1].lineOffset))/2}function YS(o,e=1,i=!1){let s=1/0,f=1/0,l=-1/0,d=-1/0;const R=o[0];for(let F=0;F<R.length;F++){const V=R[F];(!F||V.x<s)&&(s=V.x),(!F||V.y<f)&&(f=V.y),(!F||V.x>l)&&(l=V.x),(!F||V.y>d)&&(d=V.y)}const N=Math.min(l-s,d-f);let $=N/2;const I=new Au([],KS);if(N===0)return new Ge(s,f);for(let F=s;F<l;F+=N)for(let V=f;V<d;V+=N)I.push(new Ec(F+$,V+$,$,o));let j=function(F){let V=0,Y=0,oe=0;const ce=F[0];for(let we=0,Ie=ce.length,me=Ie-1;we<Ie;me=we++){const Re=ce[we],Ue=ce[me],$e=Re.x*Ue.y-Ue.x*Re.y;Y+=(Re.x+Ue.x)*$e,oe+=(Re.y+Ue.y)*$e,V+=3*$e}return new Ec(Y/V,oe/V,0,F)}(o),H=I.length;for(;I.length;){const F=I.pop();(F.d>j.d||!j.d)&&(j=F,i&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,H)),F.max-j.d<=e||($=F.h/2,I.push(new Ec(F.p.x-$,F.p.y-$,$,o)),I.push(new Ec(F.p.x+$,F.p.y-$,$,o)),I.push(new Ec(F.p.x-$,F.p.y+$,$,o)),I.push(new Ec(F.p.x+$,F.p.y+$,$,o)),H+=4)}return i&&(console.log(`num probes: ${H}`),console.log(`best distance: ${j.d}`)),j.p}function KS(o,e){return e.max-o.max}class Ec{constructor(e,i,s,f){this.p=new Ge(e,i),this.h=s,this.d=function(l,d){let R=!1,N=1/0;for(let $=0;$<d.length;$++){const I=d[$];for(let j=0,H=I.length,F=H-1;j<H;F=j++){const V=I[j],Y=I[F];V.y>l.y!=Y.y>l.y&&l.x<(Y.x-V.x)*(l.y-V.y)/(Y.y-V.y)+V.x&&(R=!R),N=Math.min(N,vt(l,V,Y))}}return(R?1:-1)*Math.sqrt(N)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}const p_=Number.POSITIVE_INFINITY,JS=Math.sqrt(2);function Kv(o,[e,i]){let s=0,f=0;if(i===p_){e<0&&(e=0);const l=e/JS;switch(o){case"top-right":case"top-left":f=l-7;break;case"bottom-right":case"bottom-left":f=7-l;break;case"bottom":f=7-e;break;case"top":f=e-7}switch(o){case"top-right":case"bottom-right":s=-l;break;case"top-left":case"bottom-left":s=l;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),o){case"top-right":case"top-left":case"top":f=i-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-i}switch(o){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,f]}function m_(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function QS(o,e,i,s,f,l,d,R,N,$,I,j,H,F,V,Y){let oe=l.textMaxSize.evaluate(e,{},H);oe===void 0?oe=d*l.textScaleFactor:oe*=l.textScaleFactor;const ce=o.layers[0].layout,we=ce.get("icon-offset").evaluate(e,{},H),Ie=Qv(i.horizontal)||i.vertical,me=F.name==="globe",Re=Vn,Ue=d*l.textScaleFactor/Re,$e=o.tilePixelRatio*oe/Re,ct=(Ct=o.overscaling,o.zoom>18&&Ct>2&&(Ct>>=1),Math.max(wr/(512*Ct),1)*ce.get("symbol-spacing")),lt=ce.get("text-padding")*o.tilePixelRatio,st=ce.get("icon-padding")*o.tilePixelRatio,xt=ze(ce.get("text-max-angle")),dt=ce.get("text-rotation-alignment")==="map"&&ce.get("symbol-placement")!=="point",Et=ce.get("icon-rotation-alignment")==="map"&&ce.get("symbol-placement")!=="point",It=ce.get("symbol-placement"),Mt=ct/2;var Ct;const kt=ce.get("icon-text-fit").evaluate(e,{},H),jt=ce.get("icon-text-fit-padding").evaluate(e,{},H),Ot=kt!=="none";let Kt;o.hasAnyIconTextFit===!1&&Ot&&(o.hasAnyIconTextFit=!0),s&&Ot&&(o.allowVerticalPlacement&&i.vertical&&(Kt=Bv(s,i.vertical,kt,jt,we,Ue)),Ie&&(s=Bv(s,Ie,kt,jt,we,Ue)));const ur=(Jt,yr,_r)=>{if(yr.x<0||yr.x>=wr||yr.y<0||yr.y>=wr)return;let Er=null;if(me){const{x:rr,y:kr,z:vr}=F.projectTilePoint(yr.x,yr.y,_r);Er={anchor:new fs(rr,kr,vr,0,void 0),up:F.upVector(_r,yr.x,yr.y)}}(function(rr,kr,vr,zr,Yr,li,ci,_i,hi,yi,Vi,Bi,ni,Fi,zi,Gi,gn,yn,fn,ha,Qi,rn,Jn,vn,_a,Sn,jo,il){const nl=rr.addToLineVertexArray(kr,zr);let ds,al,ol,Cp,Rx,Dx,Lx,Ox=0,zx=0,kx=0,Bx=0,Y_=-1,K_=-1;const Vo={};let Fx=pl("");const tu=vr?vr.anchor:kr,J_=hi.layout.get("icon-text-fit").evaluate(Qi,{},Sn)!=="none";let Q_=0,eg=0;if(hi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Q_,eg]=hi.layout.get("text-offset").evaluate(Qi,{},Sn).map(Ha=>Ha*Vn):(Q_=hi.layout.get("text-radial-offset").evaluate(Qi,{},Sn)*Vn,eg=p_),rr.allowVerticalPlacement&&Yr.vertical){const Ha=Yr.vertical;if(zi)Dx=__(Ha),_i&&(Lx=__(_i));else{const Ia=hi.layout.get("text-rotate").evaluate(Qi,{},Sn)+90;ol=np(yi,tu,kr,Vi,Bi,ni,Ha,Fi,Ia,Gi),_i&&(Cp=np(yi,tu,kr,Vi,Bi,ni,_i,yn,Ia))}}if(li){const Ha=rr.iconSizeData,Ia=vn?Yd(rr.iconSizeData,rr.layers[0]._unevaluatedLayout._values["icon-size"],Sn,rr.zoom,Qi):1,Oc=hi.layout.get("icon-rotate").evaluate(Qi,{},Sn),Nx=Xv(li,Oc,Jn,J_,vn?1/Ia:rn.iconScaleFactor),rg=_i?Xv(_i,Oc,Jn,J_,rn.iconScaleFactor):void 0;al=np(yi,tu,kr,Vi,Bi,ni,li,yn,Oc,null,vn?rn.iconScaleFactor*Ia:1),Ox=4*Nx.length;let ru=null;Ha.kind==="source"?(ru=[yo*hi.layout.get("icon-size").evaluate(Qi,{},Sn)*rn.iconScaleFactor],ru[0]>Qs&&St(`${rr.layerIds[0]}: Value for "icon-size" is >= ${nf}. Reduce your "icon-size".`)):Ha.kind==="composite"&&(ru=[yo*rn.compositeIconSizes[0].evaluate(Qi,{},Sn)*rn.iconScaleFactor,yo*rn.compositeIconSizes[1].evaluate(Qi,{},Sn)*rn.iconScaleFactor],(ru[0]>Qs||ru[1]>Qs)&&St(`${rr.layerIds[0]}: Value for "icon-size" is >= ${nf}. Reduce your "icon-size".`)),rr.addSymbols(rr.icon,Nx,ru,ha,fn,Qi,!1,vr,kr,nl.lineStartIndex,nl.lineLength,-1,_a,Sn,jo,il),Y_=rr.icon.placedSymbolArray.length-1,rg&&(zx=4*rg.length,rr.addSymbols(rr.icon,rg,ru,ha,fn,Qi,Va.vertical,vr,kr,nl.lineStartIndex,nl.lineLength,-1,_a,Sn,jo,il),K_=rr.icon.placedSymbolArray.length-1)}for(const Ha in Yr.horizontal){const Ia=Yr.horizontal[Ha];ds||(Fx=pl(Ia.text),zi?Rx=__(Ia):ds=np(yi,tu,kr,Vi,Bi,ni,Ia,Fi,hi.layout.get("text-rotate").evaluate(Qi,{},Sn),Gi));const Oc=Ia.positionedLines.length===1;if(kx+=Jv(rr,vr,kr,Ia,ci,hi,zi,Qi,Gi,nl,Yr.vertical?Va.horizontal:Va.horizontalOnly,Oc?Object.keys(Yr.horizontal):[Ha],Vo,Y_,rn,_a,Sn,jo),Oc)break}Yr.vertical&&(Bx+=Jv(rr,vr,kr,Yr.vertical,ci,hi,zi,Qi,Gi,nl,Va.vertical,["vertical"],Vo,K_,rn,_a,Sn,jo));let sl=-1;const tg=(Ha,Ia)=>Ha?Math.max(Ha,Ia):Ia;sl=tg(Rx,sl),sl=tg(Dx,sl),sl=tg(Lx,sl);const DA=sl>-1?1:0;rr.glyphOffsetArray.length>=65535&&St("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Qi.sortKey!==void 0&&rr.addToSortKeyRanges(rr.symbolInstances.length,Qi.sortKey),rr.symbolInstances.emplaceBack(kr.x,kr.y,tu.x,tu.y,tu.z,Vo.right>=0?Vo.right:-1,Vo.center>=0?Vo.center:-1,Vo.left>=0?Vo.left:-1,Vo.vertical>=0?Vo.vertical:-1,Y_,K_,Fx,ds!==void 0?ds:rr.collisionBoxArray.length,ds!==void 0?ds+1:rr.collisionBoxArray.length,ol!==void 0?ol:rr.collisionBoxArray.length,ol!==void 0?ol+1:rr.collisionBoxArray.length,al!==void 0?al:rr.collisionBoxArray.length,al!==void 0?al+1:rr.collisionBoxArray.length,Cp||rr.collisionBoxArray.length,Cp?Cp+1:rr.collisionBoxArray.length,Vi,kx,Bx,Ox,zx,DA,0,Q_,eg,sl,0,J_?1:0)})(o,yr,Er,Jt,i,s,f,Kt,o.layers[0],o.collisionBoxArray,e.index,e.sourceLayerIndex,o.index,lt,dt,N,0,st,Et,we,e,l,$,I,j,H,V,Y)};if(It==="line")for(const Jt of Gv(e.geometry,0,0,wr,wr)){const yr=ZS(Jt,ct,xt,i.vertical||Ie,s,Re,$e,o.overscaling,wr);for(const _r of yr)Ie&&eM(o,Ie.text,Mt,_r)||ur(Jt,_r,H)}else if(It==="line-center"){for(const Jt of e.geometry)if(Jt.length>1){const yr=$S(Jt,xt,i.vertical||Ie,s,Re,$e);yr&&ur(Jt,yr,H)}}else if(e.type==="Polygon")for(const Jt of Gd(e.geometry,0)){const yr=YS(Jt,16);ur(Jt[0],new fs(yr.x,yr.y,0,0,void 0),H)}else if(e.type==="LineString")for(const Jt of e.geometry)ur(Jt,new fs(Jt[0].x,Jt[0].y,0,0,void 0),H);else if(e.type==="Point")for(const Jt of e.geometry)for(const yr of Jt)ur([yr],new fs(yr.x,yr.y,0,0,void 0),H)}const nf=255,Qs=nf*yo;function Jv(o,e,i,s,f,l,d,R,N,$,I,j,H,F,V,Y,oe,ce){const we=function(Re,Ue,$e,ct,lt,st,xt,dt){const Et=[];if(Ue.positionedLines.length===0)return Et;const It=ct.layout.get("text-rotate").evaluate(st,{})*Math.PI/180,Mt=function(Kt){const ur=Kt[0],Jt=Kt[1],yr=ur*Jt;return yr>0?[ur,-Jt]:yr<0?[-ur,Jt]:ur===0?[Jt,ur]:[Jt,-ur]}($e);let Ct=Math.abs(Ue.top-Ue.bottom);for(const Kt of Ue.positionedLines)Ct-=Kt.lineOffset;const kt=Ue.positionedLines.length,jt=Ct/kt;let Ot=Ue.top-$e[1];for(let Kt=0;Kt<kt;++Kt){const ur=Ue.positionedLines[Kt];Ot=XS(Ue,jt,Ot,Kt);for(const Jt of ur.positionedGlyphs){if(!Jt.rect)continue;const yr=Jt.rect||{};let _r=GS+1,Er=!0,rr=1,kr=0;if(Jt.imageName){const fn=xt[Mn.build(Jt.imageName).getSerializedPrimary()];if(!fn)continue;if(fn.sdf){St("SDF images are not supported in formatted text and will be ignored.");continue}Er=!1,rr=fn.pixelRatio,_r=rf/rr}const vr=(lt||dt)&&Jt.vertical,zr=Jt.metrics.advance*Jt.scale/2,Yr=Jt.metrics,li=Jt.rect;if(li===null)continue;dt&&Ue.verticalizable&&(kr=Jt.imageName?zr-Jt.metrics.width*Jt.scale/2:0);const ci=lt?[Jt.x+zr,Jt.y]:[0,0];let _i=[0,0],hi=[0,0],yi=!1;lt||(vr?(hi=[Jt.x+zr+Mt[0],Jt.y+Mt[1]-kr],yi=!0):_i=[Jt.x+zr+$e[0],Jt.y+$e[1]-kr]);const Vi=li.w*Jt.scale/(rr*(Jt.localGlyph?vo:1)),Bi=li.h*Jt.scale/(rr*(Jt.localGlyph?vo:1));let ni,Fi,zi,Gi;if(vr){const fn=Jt.y-Ot,ha=new Ge(-zr,zr-fn),Qi=-Math.PI/2,rn=new Ge(...hi);ni=new Ge(-zr+_i[0],_i[1]),ni._rotateAround(Qi,ha)._add(rn),ni.x+=-fn+zr,ni.y-=(Yr.left-_r)*Jt.scale;const Jn=Jt.imageName?Yr.advance*Jt.scale:Vn*Jt.scale,vn=String.fromCodePoint(Jt.glyph);BS(vn)?ni.x+=(1-_r)*Jt.scale:FS(vn)?ni.x+=Jn-Yr.height*Jt.scale+(-_r-1)*Jt.scale:ni.x+=Jt.imageName||Yr.width+2*_r===li.w&&Yr.height+2*_r===li.h?(Jn-Bi)/2:(Jn-(Yr.height+2*_r)*Jt.scale)/2,Fi=new Ge(ni.x,ni.y-Vi),zi=new Ge(ni.x+Bi,ni.y),Gi=new Ge(ni.x+Bi,ni.y-Vi)}else{const fn=(Yr.left-_r)*Jt.scale-zr+_i[0],ha=(-Yr.top-_r)*Jt.scale+_i[1],Qi=fn+Vi,rn=ha+Bi;ni=new Ge(fn,ha),Fi=new Ge(Qi,ha),zi=new Ge(fn,rn),Gi=new Ge(Qi,rn)}if(It){let fn;fn=lt?new Ge(0,0):yi?new Ge(Mt[0],Mt[1]):new Ge($e[0],$e[1]),ni._rotateAround(It,fn),Fi._rotateAround(It,fn),zi._rotateAround(It,fn),Gi._rotateAround(It,fn)}const gn=new Ge(0,0),yn=new Ge(0,0);Et.push({tl:ni,tr:Fi,bl:zi,br:Gi,texPrimary:yr,texSecondary:void 0,writingMode:Ue.writingMode,glyphOffset:ci,sectionIndex:Jt.sectionIndex,isSDF:Er,pixelOffsetTL:gn,pixelOffsetBR:yn,minFontScaleX:0,minFontScaleY:0})}}return Et}(0,s,N,l,d,R,f,o.allowVerticalPlacement),Ie=o.textSizeData;let me=null;Ie.kind==="source"?(me=[yo*l.layout.get("text-size").evaluate(R,{},oe)*V.textScaleFactor],me[0]>Qs&&St(`${o.layerIds[0]}: Value for "text-size" is >= ${nf}. Reduce your "text-size".`)):Ie.kind==="composite"&&(me=[yo*V.compositeTextSizes[0].evaluate(R,{},oe)*V.textScaleFactor,yo*V.compositeTextSizes[1].evaluate(R,{},oe)*V.textScaleFactor],(me[0]>Qs||me[1]>Qs)&&St(`${o.layerIds[0]}: Value for "text-size" is >= ${nf}. Reduce your "text-size".`)),o.addSymbols(o.text,we,me,N,d,R,I,e,i,$.lineStartIndex,$.lineLength,F,Y,oe,ce,!1);for(const Re of j)H[Re]=o.text.placedSymbolArray.length-1;return 4*we.length}function Qv(o){for(const e in o)return o[e];return null}function np(o,e,i,s,f,l,d,R,N,$,I=1){let j=d.top/I,H=d.bottom/I,F=d.left/I,V=d.right/I;const Y=d.collisionPadding;if(Y&&(F-=Y[0],j-=Y[1],V+=Y[2],H+=Y[3]),N){const oe=new Ge(F,j),ce=new Ge(V,j),we=new Ge(F,H),Ie=new Ge(V,H),me=ze(N);let Re=new Ge(0,0);$&&(Re=new Ge($[0],$[1])),oe._rotateAround(me,Re),ce._rotateAround(me,Re),we._rotateAround(me,Re),Ie._rotateAround(me,Re),F=Math.min(oe.x,ce.x,we.x,Ie.x),V=Math.max(oe.x,ce.x,we.x,Ie.x),j=Math.min(oe.y,ce.y,we.y,Ie.y),H=Math.max(oe.y,ce.y,we.y,Ie.y)}return o.emplaceBack(e.x,e.y,e.z,i.x,i.y,F,j,V,H,R,s,f,l),o.length-1}function __(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const e=o.bottom-o.top;return e>0?Math.max(10,e):null}function eM(o,e,i,s){const f=o.compareText;if(e in f){const l=f[e];for(let d=l.length-1;d>=0;d--)if(s.dist(l[d])<i)return!0}else f[e]=[];return f[e].push(s),!1}function eb(o,e){const i=o.fovAboveCenter,s=o.elevation?o.elevation.getMinElevationBelowMSL()*e:0,f=(o._camera.position[2]*o.worldSize-s)/Math.cos(o._pitch),l=Math.sin(i)*f/Math.sin(Math.max(Math.PI/2-o._pitch-i,.01));let d=Math.sin(o._pitch)*l+f;const R=f*(1/o._horizonShift);return o.elevation&&o.elevation.exaggeration()!==0||(d*=1+Math.max(o.zoom-17,0)),Math.min(1.01*d,R)}function af(o,e){if(!e.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:e};const i=Math.pow(2,-o.z),s=o.x*i,f=(o.x+1)*i,l=o.y*i,d=(o.y+1)*i,R=la(s),N=la(f),$=In(l),I=In(d),j=e.project(R,$),H=e.project(N,$),F=e.project(N,I),V=e.project(R,I);let Y=Math.min(j.x,H.x,F.x,V.x),oe=Math.min(j.y,H.y,F.y,V.y),ce=Math.max(j.x,H.x,F.x,V.x),we=Math.max(j.y,H.y,F.y,V.y);const Ie=i/16;function me(Ue,$e,ct,lt,st,xt){const dt=(ct+st)/2,Et=(lt+xt)/2,It=e.project(la(dt),In(Et)),Mt=Math.max(0,Y-It.x,oe-It.y,It.x-ce,It.y-we);Y=Math.min(Y,It.x),ce=Math.max(ce,It.x),oe=Math.min(oe,It.y),we=Math.max(we,It.y),Mt>Ie&&(me(Ue,It,ct,lt,dt,Et),me(It,$e,dt,Et,st,xt))}me(j,H,s,l,f,l),me(H,F,f,l,f,d),me(F,V,f,d,s,d),me(V,j,s,d,s,l),Y-=Ie,oe-=Ie,ce+=Ie,we+=Ie;const Re=1/Math.max(ce-Y,we-oe);return{scale:Re,x:Y*Re,y:oe*Re,x2:ce*Re,y2:we*Re,projection:e}}function tb(o,{x:e,y:i},s=0){return new Ge(((e-s)*o.scale-o.x)*wr,(i*o.scale-o.y)*wr)}const tM=_e.mat4.identity(new Float32Array(16));class el{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new Ai(0,0)}projectTilePoint(e,i,s){return{x:e,y:i,z:0}}locationPoint(e,i,s=!0){return e._coordinatePoint(e.locationCoordinate(i),s)}pixelsPerMeter(e,i){return qn(1,e)*i}pixelSpaceConversion(e,i,s){return 1}farthestPixelDistance(e){return eb(e,e.pixelsPerMeter)}pointCoordinate(e,i,s,f){const l=e.horizonLineFromTop(!1),d=new Ge(i,Math.max(l,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(d,f))}pointCoordinate3D(e,i,s){const f=new Ge(i,s);if(e.elevation)return e.elevation.pointCoordinate(f);{const l=this.pointCoordinate(e,f.x,f.y,0);return[l.x,l.y,l.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const s=e.horizonLineFromTop();return i.y<s}createInversionMatrix(e,i){return tM}createTileMatrix(e,i,s){let f,l,d;const R=s.canonical,N=_e.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const $=af(R,this);f=1,l=$.x+s.wrap*$.scale,d=$.y,_e.mat4.scale(N,N,[f/$.scale,f/$.scale,e.pixelsPerMeter/i])}else f=i/e.zoomScale(R.z),l=(R.x+Math.pow(2,R.z)*s.wrap)*f,d=R.y*f;return _e.mat4.translate(N,N,[l,d,0]),_e.mat4.scale(N,N,[f/wr,f/wr,1]),N}upVector(e,i,s){return[0,0,1]}upVectorScale(e,i,s){return{metersToTile:1}}}class rM extends el{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,s]=this.parallels=e.parallels||[29.5,45.5],f=Math.sin(ze(i));this.n=(f+Math.sin(ze(s)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:s,c:f,r0:l}=this,d=ze(e-this.center[0]),R=ze(i),N=Math.sqrt(f-2*s*Math.sin(R))/s;return{x:N*Math.sin(d*s),y:N*Math.cos(d*s)-l,z:0}}unproject(e,i){const{n:s,c:f,r0:l}=this,d=l+i;let R=Math.atan2(e,Math.abs(d))*Math.sign(d);d*s<0&&(R-=Math.PI*Math.sign(e)*Math.sign(d));const N=ze(this.center[0])*s;R=wt(R,-Math.PI-N,Math.PI-N);const $=le(de(R/s)+this.center[0],-180,180),I=Math.asin(le((f-(e*e+d*d)*s*s)/(2*s),-1,1)),j=le(de(I),-85.051129,Wn);return new Ai($,j)}}const of=1.340264,sf=-.081106,lf=893e-6,uf=.003796,ap=Math.sqrt(3)/2;class iM extends el{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(ap*Math.sin(i)),f=s*s,l=f*f*f;return{x:.5*(e*Math.cos(s)/(ap*(of+3*sf*f+l*(7*lf+9*uf*f)))/Math.PI+.5),y:1-.5*(s*(of+sf*f+l*(lf+uf*f))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,f=s*s,l=f*f*f;for(let I,j,H,F=0;F<12&&(j=s*(of+sf*f+l*(lf+uf*f))-i,H=of+3*sf*f+l*(7*lf+9*uf*f),I=j/H,s=le(s-I,-Math.PI/3,Math.PI/3),f=s*s,l=f*f*f,!(Math.abs(I)<1e-12));++F);const d=ap*e*(of+3*sf*f+l*(7*lf+9*uf*f))/Math.cos(s),R=Math.asin(Math.sin(s)/ap),N=le(180*d/Math.PI,-180,180),$=le(180*R/Math.PI,-85.051129,Wn);return new Ai(N,$)}}class nM extends el{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const s=360*(e-.5),f=le(360*(.5-i),-85.051129,Wn);return new Ai(s,f)}}const Tc=Math.PI/2;function op(o){return Math.tan((Tc+o)/2)}class aM extends el{constructor(e){super(e),this.center=e.center||[0,30];const[i,s]=this.parallels=e.parallels||[30,30];let f=ze(i),l=ze(s);this.southernCenter=f+l<0,this.southernCenter&&(f=-f,l=-l);const d=Math.cos(f),R=op(f);this.n=f===l?Math.sin(f):Math.log(d/Math.cos(l))/Math.log(op(l)/R),this.f=d*Math.pow(op(f),this.n)/this.n}project(e,i){i=ze(i),this.southernCenter&&(i=-i),e=ze(e-this.center[0]);const s=1e-6,{n:f,f:l}=this;l>0?i<-Tc+s&&(i=-Tc+s):i>Tc-s&&(i=Tc-s);const d=l/Math.pow(op(i),f);let R=d*Math.sin(f*e),N=l-d*Math.cos(f*e);return R=.5*(R/Math.PI+.5),N=.5*(N/Math.PI+.5),{x:R,y:this.southernCenter?N:1-N,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:s,f}=this,l=f-i,d=Math.sign(l),R=Math.sign(s)*Math.sqrt(e*e+l*l);let N=Math.atan2(e,Math.abs(l))*d;l*s<0&&(N-=Math.PI*Math.sign(e)*d);const $=le(de(N/s)+this.center[0],-180,180),I=le(de(2*Math.atan(Math.pow(f/R,1/s))-Tc),-85.051129,Wn);return new Ai($,this.southernCenter?-I:I)}}class rb extends el{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Ya(e),y:_o(i),z:0}}unproject(e,i){const s=la(e),f=In(i);return new Ai(s,f)}}const ib=ze(Wn);class oM extends el{project(e,i){const s=(i=ze(i))*i,f=s*s;return{x:.5*((e=ze(e))*(.8707-.131979*s+f*(f*(.003971*s-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+f*(.028874*s-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,f=25,l=0,d=s*s;do{d=s*s;const $=d*d;l=(s*(1.007226+d*(.015085+$*(.028874*d-.044475-.005916*$)))-i)/(1.007226+d*(.045255+$*(.259866*d-.311325-.005916*11*$))),s=le(s-l,-ib,ib)}while(Math.abs(l)>1e-6&&--f>0);d=s*s;const R=le(de(e/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),N=de(s);return new Ai(R,N)}}const nb=ze(Wn);class sM extends el{project(e,i){i=ze(i),e=ze(e);const s=Math.cos(i),f=2/Math.PI,l=Math.acos(s*Math.cos(e/2)),d=Math.sin(l)/l,R=.5*(e*f+2*s*Math.sin(e/2)/d)||0,N=.5*(i+Math.sin(i)/d)||0;return{x:.5*(R/Math.PI+.5),y:1-.5*(N/Math.PI+1),z:0}}unproject(e,i){let s=e=(2*e-.5)*Math.PI,f=i=(2*(1-i)-1)*Math.PI,l=25;const d=1e-6;let R=0,N=0;do{const $=Math.cos(f),I=Math.sin(f),j=2*I*$,H=I*I,F=$*$,V=Math.cos(s/2),Y=Math.sin(s/2),oe=2*V*Y,ce=Y*Y,we=1-F*V*V,Ie=we?1/we:0,me=we?Math.acos($*V)*Math.sqrt(1/we):0,Re=.5*(2*me*$*Y+2*s/Math.PI)-e,Ue=.5*(me*I+f)-i,$e=.5*Ie*(F*ce+me*$*V*H)+1/Math.PI,ct=Ie*(oe*j/4-me*I*Y),lt=.125*Ie*(j*Y-me*I*F*oe),st=.5*Ie*(H*V+me*ce*$)+.5,xt=ct*lt-st*$e;R=(Ue*ct-Re*st)/xt,N=(Re*lt-Ue*$e)/xt,s=le(s-R,-Math.PI,Math.PI),f=le(f-N,-nb,nb)}while((Math.abs(R)>d||Math.abs(N)>d)&&--l>0);return new Ai(de(s),de(f))}}class ab extends el{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ze(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:s,cosPhi:f}=this;return{x:ze(e)*f*s+.5,y:-Math.sin(ze(i))/f*s+.5,z:0}}unproject(e,i){const{scale:s,cosPhi:f}=this,l=-(i-.5)/s,d=le(de((e-.5)/s)/f,-180,180),R=Math.asin(le(l*f,-1,1)),N=le(de(R),-85.051129,Wn);return new Ai(d,N)}}class lM extends rb{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,s){const f=wi(e,i,s),l=Ni(pn(s));return _e.vec3.transformMat4(f,f,l),{x:f[0],y:f[1],z:f[2]}}locationPoint(e,i){const s=Bo(i.lat,i.lng),f=_e.vec3.normalize([],s),l=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,d=qn(1,0)*wr*l;_e.vec3.scaleAndAdd(s,s,f,d);const R=_e.mat4.identity(new Float64Array(16));return _e.mat4.multiply(R,e.pixelMatrix,e.globeMatrix),_e.vec3.transformMat4(s,s,R),new Ge(s[0],s[1])}pixelsPerMeter(e,i){return qn(1,0)*i}pixelSpaceConversion(e,i,s){const f=qn(1,e)*i,l=Qr(qn(1,45)*i,f,s);return this.pixelsPerMeter(e,i)/l}createTileMatrix(e,i,s){const f=jn(pn(s.canonical));return _e.mat4.multiply(new Float64Array(16),e.globeMatrix,f)}createInversionMatrix(e,i){const{center:s}=e,f=Ni(pn(i));return _e.mat4.rotateY(f,f,ze(s.lng)),_e.mat4.rotateX(f,f,ze(s.lat)),_e.mat4.scale(f,f,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(e,i,s,f){return tn(e,i,s,!0)||new c(0,0)}pointCoordinate3D(e,i,s){const f=this.pointCoordinate(e,i,s,0);return[f.x,f.y,f.z]}isPointAboveHorizon(e,i){return!tn(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(f,l){const d=f.cameraToCenterDistance,R=f._centerAltitude*l,N=f._camera,$=f._camera.forward(),I=_e.vec3.add([],_e.vec3.scale([],$,-d),[0,0,R]),j=f.worldSize/(2*Math.PI),H=[0,0,-j],F=f.width/f.height,V=Math.tan(f.fovAboveCenter),Y=_e.vec3.scale([],N.up(),V),oe=_e.vec3.scale([],N.right(),V*F),ce=_e.vec3.normalize([],_e.vec3.add([],_e.vec3.add([],$,Y),oe)),we=[];let Ie;if(new vi(I,ce).closestPointOnSphere(H,j,we)){const me=_e.vec3.add([],we,H),Re=_e.vec3.sub([],me,I);Ie=Math.cos(f.fovAboveCenter)*_e.vec3.length(Re)}else{const me=_e.vec3.sub([],I,H),Re=_e.vec3.sub([],H,I);_e.vec3.normalize(Re,Re);const Ue=_e.vec3.length(me)-j;Ie=Math.sqrt(Ue*(Ue+2*j));const $e=Math.acos(Ie/(j+Ue))-Math.acos(_e.vec3.dot($,Re));Ie*=Math.cos($e)}return 1.01*Ie}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=Zn(e.zoom);if(s>0){const f=eb(e,qn(1,e.center.lat)*e.worldSize),l=e.worldSize/(2*Math.PI),d=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Qr(i,f+l*(1-Math.cos(d)),Math.pow(s,10))}return i}upVector(e,i,s){return wi(i,s,e,1)}upVectorScale(e){return{metersToTile:Ii(cn(pn(e)))}}}function ob(o){const e=o.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(o.name){case"mercator":return new rb(o);case"equirectangular":return new nM(o);case"naturalEarth":return new oM(o);case"equalEarth":return new iM(o);case"winkelTripel":return new sM(o);case"albers":return i?new ab(o):new rM(o);case"lambertConformalConic":return i?new ab(o):new aM(o);case"globe":return new lM(o)}throw new Error(`Invalid projection name: ${o.name}`)}const uM=vc.VectorTileFeature.types,cM=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function sp(o,e,i,s,f,l,d,R,N,$,I,j,H){const F=R?Math.min(Qs,Math.round(R[0])):0,V=R?Math.min(Qs,Math.round(R[1])):0;o.emplaceBack(e,i,Math.round(32*s),Math.round(32*f),l,d,(F<<1)+(N?1:0),V,16*$,16*I,256*j,256*H)}function lp(o,e,i){o.emplaceBack(e,i)}function up(o,e,i,s,f,l,d){o.emplaceBack(e,i,s,f,l,d)}function cp(o,e,i,s,f){o.emplaceBack(e,i,s,f),o.emplaceBack(e,i,s,f),o.emplaceBack(e,i,s,f),o.emplaceBack(e,i,s,f)}function hM(o){for(const e of o.sections)if(yd(e.text))return!0;return!1}class g_{constructor(e){this.layoutVertexArray=new Ph,this.indexArray=new zn,this.programConfigurations=e,this.segments=new hn,this.dynamicLayoutVertexArray=new Do,this.opacityVertexArray=new Rh,this.placedSymbolArray=new Id,this.iconTransitioningVertexArray=new Oo,this.globeExtVertexArray=new Ch,this.zOffsetVertexArray=new qs}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,s,f,l){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,AS.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,PS.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,cM,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,RS.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,IS.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||l)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,CS.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||f)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Dr(g_,"SymbolBuffers");class y_{constructor(e,i,s){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new s,this.segments=new hn,this.collisionVertexArray=new Lh,this.collisionVertexArrayExt=new Do}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,DS.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,LS.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Dr(y_,"CollisionBuffers");class hp{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=_e.mat4.identity([]),this.placementViewportMatrix=_e.mat4.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=o_(this.zoom,i["text-size"]),this.iconSizeData=o_(this.zoom,i["icon-size"]);const s=this.layers[0].layout,f=s.get("symbol-sort-key"),l=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=l!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(l==="viewport-y"||l==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(d=>Va[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=s.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new g_(new ko(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new g_(new ko(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Nl,this.lineVertexArray=new Ul,this.symbolInstances=new Cd}calculateGlyphDependencies(e,i,s,f,l){for(const d of e){const R=d.codePointAt(0);if(R===void 0)break;if(i[R]=!0,f&&l&&R<=65535){const N=ef[d];N&&(i[N.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Qm(this.activeReplacements,s)&&(this.activeReplacements=s,!0)}populate(e,i,s,f){const l=this.layers[0],d=l.layout,R=this.projection.name==="globe",N=d.get("text-font"),$=d.get("text-field"),I=d.get("icon-image"),[j,H]=d.get("icon-size-scale-range"),F=le(i.scaleFactor||1,j,H),V=($.value.kind!=="constant"||$.value.value instanceof Nn&&!$.value.value.isEmpty()||$.value.value.toString().length>0)&&(N.value.kind!=="constant"||N.value.value.length>0),Y=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,oe=d.get("symbol-sort-key");if(this.features=[],!V&&!Y)return;const ce=i.iconDependencies,we=i.glyphDependencies,Ie=i.availableImages,me=new Xi(this.zoom);for(const{feature:Re,id:Ue,index:$e,sourceLayerIndex:ct}of e){const lt=l._featureFilter.needGeometry,st=fe(Re,lt);if(!l._featureFilter.filter(me,st,s))continue;if(lt||(st.geometry=he(Re,s,f)),R&&Re.type!==1&&s.z<=5){const Mt=st.geometry,Ct=.98078528056,kt=(jt,Ot)=>{const Kt=wi(jt.x,jt.y,s,1),ur=wi(Ot.x,Ot.y,s,1);return _e.vec3.dot(Kt,ur)<Ct};for(let jt=0;jt<Mt.length;jt++)Mt[jt]=q(Mt[jt],kt)}let xt,dt;if(V){const Mt=l.getValueAndResolveTokens("text-field",st,s,Ie),Ct=Nn.factory(Mt);hM(Ct)&&(this.hasRTLText=!0),(!this.hasRTLText||Yu()==="unavailable"||this.hasRTLText&&Ta.isParsed())&&(xt=kS(Ct,l,st))}if(Y){const Mt=l.getValueAndResolveTokens("icon-image",st,s,Ie);dt=Mt instanceof Mn?Mt:Mn.build(Mt)}if(!xt&&!dt)continue;const Et=this.sortFeaturesByKey?oe.evaluate(st,{},s):void 0,It={id:Ue,text:xt,icon:dt,index:$e,sourceLayerIndex:ct,geometry:st.geometry,properties:Re.properties,type:uM[Re.type],sortKey:Et};if(this.features.push(It),dt){const Mt=Yd(this.iconSizeData,this.layers[0]._unevaluatedLayout._values["icon-size"],s,this.zoom,It)*F*this.pixelRatio,Ct=dt.getPrimary().scaleSelf(Mt);if(ce[Ct.id]=ce[Ct.id]||[],ce[Ct.id].push(Ct),dt.nameSecondary){const kt=dt.getSecondary().scaleSelf(Mt);ce[kt.id]=ce[kt.id]||[],ce[kt.id].push(kt)}}if(xt){const Mt=N.evaluate(st,{},s).join(","),Ct=d.get("text-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Va.vertical)>=0;for(const kt of xt.sections)if(kt.image){const jt=kt.image.getPrimary().scaleSelf(this.pixelRatio);ce[jt.id]=ce[jt.id]||[],ce[jt.id].push(jt)}else{const jt=xh(xt.toString()),Ot=kt.fontStack||Mt,Kt=we[Ot]=we[Ot]||{};this.calculateGlyphDependencies(kt.text,Kt,Ct,this.allowVerticalPlacement,jt)}}}d.get("symbol-placement")==="line"&&(this.features=function(Re){const Ue={},$e={},ct=[];let lt=0;function st(It){ct.push(Re[It]),lt++}function xt(It,Mt,Ct){const kt=$e[It];return delete $e[It],$e[Mt]=kt,ct[kt].geometry[0].pop(),ct[kt].geometry[0]=ct[kt].geometry[0].concat(Ct[0]),kt}function dt(It,Mt,Ct){const kt=Ue[Mt];return delete Ue[Mt],Ue[It]=kt,ct[kt].geometry[0].shift(),ct[kt].geometry[0]=Ct[0].concat(ct[kt].geometry[0]),kt}function Et(It,Mt,Ct){const kt=Ct?Mt[0][Mt[0].length-1]:Mt[0][0];return`${It}:${kt.x}:${kt.y}`}for(let It=0;It<Re.length;It++){const Mt=Re[It],Ct=Mt.geometry,kt=Mt.text?Mt.text.toString():null;if(!kt){st(It);continue}const jt=Et(kt,Ct),Ot=Et(kt,Ct,!0);if(jt in $e&&Ot in Ue&&$e[jt]!==Ue[Ot]){const Kt=dt(jt,Ot,Ct),ur=xt(jt,Ot,ct[Kt].geometry);delete Ue[jt],delete $e[Ot],$e[Et(kt,ct[ur].geometry,!0)]=ur,ct[Kt].geometry=null}else jt in $e?xt(jt,Ot,Ct):Ot in Ue?dt(jt,Ot,Ct):(st(It),Ue[jt]=lt-1,$e[Ot]=lt-1)}return ct.filter(It=>It.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Re,Ue)=>Re.sortKey-Ue.sortKey)}update(e,i,s,f,l,d,R){this.text.programConfigurations.updatePaintArrays(e,i,l,s,f,d,R),this.icon.programConfigurations.updatePaintArrays(e,i,l,s,f,d,R)}updateZOffset(){const e=(l,d,R)=>{s+=d,s>l.length&&l.resize(s);for(let N=-d;N<0;N++)l.emplace(N+s,R)},i=(l,d,R)=>{f+=d,f>l.length&&l.resize(f);for(let N=-d;N<0;N++)l.emplace(N+f,R)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,f=0;for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l),{numHorizontalGlyphVertices:R,numVerticalGlyphVertices:N,numIconVertices:$}=d,I=d.zOffset,j=$>0;if((R>0||N>0)&&(e(this.text.zOffsetVertexArray,R,I),e(this.text.zOffsetVertexArray,N,I)),j){const{placedIconSymbolIndex:H,verticalPlacedIconSymbolIndex:F}=d;H>=0&&i(this.icon.zOffsetVertexArray,$,I),F>=0&&i(this.icon.zOffsetVertexArray,d.numVerticalIconVertices,I)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ob(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const s=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:f,y:l}of i)this.lineVertexArray.emplaceBack(f,l);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,i,s,f,l,d,R,N,$,I,j,H,F,V,Y,oe){const ce=e.indexArray,we=e.layoutVertexArray,Ie=e.globeExtVertexArray,me=e.segments.prepareSegment(4*i.length,we,ce,this.canOverlap?d.sortKey:void 0),Re=this.glyphOffsetArray.length,Ue=me.vertexLength,$e=this.allowVerticalPlacement&&R===Va.vertical?Math.PI/2:0,ct=d.text&&d.text.sections;for(let st=0;st<i.length;st++){const{tl:xt,tr:dt,bl:Et,br:It,texPrimary:Mt,texSecondary:Ct,pixelOffsetTL:kt,pixelOffsetBR:jt,minFontScaleX:Ot,minFontScaleY:Kt,glyphOffset:ur,isSDF:Jt,sectionIndex:yr}=i[st],_r=me.vertexLength,Er=ur[1];if(sp(we,$.x,$.y,xt.x,Er+xt.y,Mt.x,Mt.y,s,Jt,kt.x,kt.y,Ot,Kt),sp(we,$.x,$.y,dt.x,Er+dt.y,Mt.x+Mt.w,Mt.y,s,Jt,jt.x,kt.y,Ot,Kt),sp(we,$.x,$.y,Et.x,Er+Et.y,Mt.x,Mt.y+Mt.h,s,Jt,kt.x,jt.y,Ot,Kt),sp(we,$.x,$.y,It.x,Er+It.y,Mt.x+Mt.w,Mt.y+Mt.h,s,Jt,jt.x,jt.y,Ot,Kt),N){const{x:rr,y:kr,z:vr}=N.anchor,[zr,Yr,li]=N.up;up(Ie,rr,kr,vr,zr,Yr,li),up(Ie,rr,kr,vr,zr,Yr,li),up(Ie,rr,kr,vr,zr,Yr,li),up(Ie,rr,kr,vr,zr,Yr,li),cp(e.dynamicLayoutVertexArray,rr,kr,vr,$e)}else cp(e.dynamicLayoutVertexArray,$.x,$.y,$.z,$e);if(oe){const rr=Ct||Mt;lp(e.iconTransitioningVertexArray,rr.x,rr.y),lp(e.iconTransitioningVertexArray,rr.x+rr.w,rr.y),lp(e.iconTransitioningVertexArray,rr.x,rr.y+rr.h),lp(e.iconTransitioningVertexArray,rr.x+rr.w,rr.y+rr.h)}ce.emplaceBack(_r,_r+1,_r+2),ce.emplaceBack(_r+1,_r+2,_r+3),me.vertexLength+=4,me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ur[0]),st!==i.length-1&&yr===i[st+1].sectionIndex||e.programConfigurations.populatePaintArrays(we.length,d,d.index,{},F,V,Y,ct&&ct[yr])}const lt=N?N.anchor:$;e.placedSymbolArray.emplaceBack(lt.x,lt.y,lt.z,$.x,$.y,Re,this.glyphOffsetArray.length-Re,Ue,I,j,$.segment,s?s[0]:0,s?s[1]:0,f[0],f[1],R,0,!1,0,H,0)}_commitLayoutVertex(e,i,s,f,l,d,R){e.emplaceBack(i,s,f,l,d,Math.round(R.x),Math.round(R.y))}_addCollisionDebugVertices(e,i,s,f,l,d,R){const N=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),$=N.vertexLength,I=R.tileAnchorX,j=R.tileAnchorY;for(let F=0;F<4;F++)s.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,i,e.padding,R.zOffset),this._commitLayoutVertex(s.layoutVertexArray,f,l,d,I,j,new Ge(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,f,l,d,I,j,new Ge(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,f,l,d,I,j,new Ge(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,f,l,d,I,j,new Ge(e.x1,e.y2)),N.vertexLength+=4;const H=s.indexArray;H.emplaceBack($,$+1),H.emplaceBack($+1,$+2),H.emplaceBack($+2,$+3),H.emplaceBack($+3,$),N.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,s,f,l,d){for(let R=f;R<l;R++){const N=s.get(R),$=this.getSymbolInstanceTextSize(e,d,i,R);this._addCollisionDebugVertices(N,$,this.textCollisionBox,N.projectedAnchorX,N.projectedAnchorY,N.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(e,i,s,f,l,d){for(let R=f;R<l;R++){const N=s.get(R),$=this.getSymbolInstanceIconSize(e,i,d.placedIconSymbolIndex);this._addCollisionDebugVertices(N,$,this.iconCollisionBox,N.projectedAnchorX,N.projectedAnchorY,N.projectedAnchorZ,d)}}generateCollisionDebugBuffers(e,i,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new y_(nc,Iv.members,Oo),this.iconCollisionBox=new y_(nc,Iv.members,Oo);const f=bc(this.iconSizeData,e),l=bc(this.textSizeData,e,s);for(let d=0;d<this.symbolInstances.length;d++){const R=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(l,e,i,R.textBoxStartIndex,R.textBoxEndIndex,R),this._addTextDebugCollisionBoxes(l,e,i,R.verticalTextBoxStartIndex,R.verticalTextBoxEndIndex,R),this._addIconDebugCollisionBoxes(f,e,i,R.iconBoxStartIndex,R.iconBoxEndIndex,R),this._addIconDebugCollisionBoxes(f,e,i,R.verticalIconBoxStartIndex,R.verticalIconBoxEndIndex,R)}}getSymbolInstanceTextSize(e,i,s,f){const l=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:f),d=Kd(this.textSizeData,e,l)/Vn;return this.tilePixelRatio*d}getSymbolInstanceIconSize(e,i,s){const f=this.icon.placedSymbolArray.get(s),l=Kd(this.iconSizeData,e,f);return this.tilePixelRatio*l}_commitDebugCollisionVertexUpdate(e,i,s,f){e.emplaceBack(i,-s,-s,f),e.emplaceBack(i,s,-s,f),e.emplaceBack(i,s,s,f),e.emplaceBack(i,-s,s,f)}_updateTextDebugCollisionBoxes(e,i,s,f,l,d,R){for(let N=f;N<l;N++){const $=s.get(N),I=this.getSymbolInstanceTextSize(e,d,i,N);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,I,$.padding,d.zOffset)}}_updateIconDebugCollisionBoxes(e,i,s,f,l,d,R){for(let N=f;N<l;N++){const $=s.get(N),I=this.getSymbolInstanceIconSize(e,i,d.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,I,$.padding,d.zOffset)}}updateCollisionDebugBuffers(e,i,s,f){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=bc(this.iconSizeData,e,f),d=bc(this.textSizeData,e,s);for(let R=0;R<this.symbolInstances.length;R++){const N=this.symbolInstances.get(R);this._updateTextDebugCollisionBoxes(d,e,i,N.textBoxStartIndex,N.textBoxEndIndex,N,s),this._updateTextDebugCollisionBoxes(d,e,i,N.verticalTextBoxStartIndex,N.verticalTextBoxEndIndex,N,s),this._updateIconDebugCollisionBoxes(l,e,i,N.iconBoxStartIndex,N.iconBoxEndIndex,N,f),this._updateIconDebugCollisionBoxes(l,e,i,N.verticalIconBoxStartIndex,N.verticalIconBoxEndIndex,N,f)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,s,f,l,d,R,N,$){const I={};if(i<s){const{x1:j,y1:H,x2:F,y2:V,padding:Y,projectedAnchorX:oe,projectedAnchorY:ce,projectedAnchorZ:we,tileAnchorX:Ie,tileAnchorY:me,featureIndex:Re}=e.get(i);I.textBox={x1:j,y1:H,x2:F,y2:V,padding:Y,projectedAnchorX:oe,projectedAnchorY:ce,projectedAnchorZ:we,tileAnchorX:Ie,tileAnchorY:me},I.textFeatureIndex=Re}if(f<l){const{x1:j,y1:H,x2:F,y2:V,padding:Y,projectedAnchorX:oe,projectedAnchorY:ce,projectedAnchorZ:we,tileAnchorX:Ie,tileAnchorY:me,featureIndex:Re}=e.get(f);I.verticalTextBox={x1:j,y1:H,x2:F,y2:V,padding:Y,projectedAnchorX:oe,projectedAnchorY:ce,projectedAnchorZ:we,tileAnchorX:Ie,tileAnchorY:me},I.verticalTextFeatureIndex=Re}if(d<R){const{x1:j,y1:H,x2:F,y2:V,padding:Y,projectedAnchorX:oe,projectedAnchorY:ce,projectedAnchorZ:we,tileAnchorX:Ie,tileAnchorY:me,featureIndex:Re}=e.get(d);I.iconBox={x1:j,y1:H,x2:F,y2:V,padding:Y,projectedAnchorX:oe,projectedAnchorY:ce,projectedAnchorZ:we,tileAnchorX:Ie,tileAnchorY:me},I.iconFeatureIndex=Re}if(N<$){const{x1:j,y1:H,x2:F,y2:V,padding:Y,projectedAnchorX:oe,projectedAnchorY:ce,projectedAnchorZ:we,tileAnchorX:Ie,tileAnchorY:me,featureIndex:Re}=e.get(N);I.verticalIconBox={x1:j,y1:H,x2:F,y2:V,padding:Y,projectedAnchorX:oe,projectedAnchorY:ce,projectedAnchorZ:we,tileAnchorX:Ie,tileAnchorY:me},I.verticalIconFeatureIndex=Re}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const s=e.placedSymbolArray.get(i),f=s.vertexStartIndex+4*s.numGlyphs;for(let l=s.vertexStartIndex;l<f;l+=4)e.indexArray.emplaceBack(l,l+1,l+2),e.indexArray.emplaceBack(l+1,l+2,l+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),s=Math.cos(e),f=[],l=[],d=[];for(let R=0;R<this.symbolInstances.length;++R){d.push(R);const N=this.symbolInstances.get(R);f.push(0|Math.round(i*N.tileAnchorX+s*N.tileAnchorY)),l.push(N.featureIndex)}return d.sort((R,N)=>f[R]-f[N]||l[N]-l[R]),d}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:l,leftJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:R,placedIconSymbolIndex:N,verticalPlacedIconSymbolIndex:$}=s;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),l>=0&&l!==f&&this.addIndicesForPlacedSymbol(this.text,l),d>=0&&d!==l&&d!==f&&this.addIndicesForPlacedSymbol(this.text,d),R>=0&&this.addIndicesForPlacedSymbol(this.text,R),N>=0&&this.addIndicesForPlacedSymbol(this.icon,N),$>=0&&this.addIndicesForPlacedSymbol(this.icon,$)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let sb,lb,v_;Dr(hp,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),hp.addDynamicAttributes=cp;class ub{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ss,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Dr(ub,"FormatSectionOverride",{omit:["defaultValue"]});const b_=()=>v_||(v_={layout:sb||(sb=new on({"symbol-placement":new dr(qt.layout_symbol["symbol-placement"]),"symbol-spacing":new dr(qt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new dr(qt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ar(qt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new dr(qt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new dr(qt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new dr(qt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new dr(qt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new dr(qt.layout_symbol["icon-ignore-placement"]),"icon-optional":new dr(qt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new dr(qt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ar(qt.layout_symbol["icon-size"]),"icon-size-scale-range":new dr(qt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Ar(qt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ar(qt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ar(qt.layout_symbol["icon-image"]),"icon-rotate":new Ar(qt.layout_symbol["icon-rotate"]),"icon-padding":new dr(qt.layout_symbol["icon-padding"]),"icon-keep-upright":new dr(qt.layout_symbol["icon-keep-upright"]),"icon-offset":new Ar(qt.layout_symbol["icon-offset"]),"icon-anchor":new Ar(qt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new dr(qt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new dr(qt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new dr(qt.layout_symbol["text-rotation-alignment"]),"text-field":new Ar(qt.layout_symbol["text-field"]),"text-font":new Ar(qt.layout_symbol["text-font"]),"text-size":new Ar(qt.layout_symbol["text-size"]),"text-size-scale-range":new dr(qt.layout_symbol["text-size-scale-range"]),"text-max-width":new Ar(qt.layout_symbol["text-max-width"]),"text-line-height":new Ar(qt.layout_symbol["text-line-height"]),"text-letter-spacing":new Ar(qt.layout_symbol["text-letter-spacing"]),"text-justify":new Ar(qt.layout_symbol["text-justify"]),"text-radial-offset":new Ar(qt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new dr(qt.layout_symbol["text-variable-anchor"]),"text-anchor":new Ar(qt.layout_symbol["text-anchor"]),"text-max-angle":new dr(qt.layout_symbol["text-max-angle"]),"text-writing-mode":new dr(qt.layout_symbol["text-writing-mode"]),"text-rotate":new Ar(qt.layout_symbol["text-rotate"]),"text-padding":new dr(qt.layout_symbol["text-padding"]),"text-keep-upright":new dr(qt.layout_symbol["text-keep-upright"]),"text-transform":new Ar(qt.layout_symbol["text-transform"]),"text-offset":new Ar(qt.layout_symbol["text-offset"]),"text-allow-overlap":new dr(qt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new dr(qt.layout_symbol["text-ignore-placement"]),"text-optional":new dr(qt.layout_symbol["text-optional"]),visibility:new dr(qt.layout_symbol.visibility)})),paint:lb||(lb=new on({"icon-opacity":new Ar(qt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Ar(qt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Ar(qt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Ar(qt.paint_symbol["text-emissive-strength"]),"icon-color":new Ar(qt.paint_symbol["icon-color"]),"icon-halo-color":new Ar(qt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ar(qt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ar(qt.paint_symbol["icon-halo-blur"]),"icon-translate":new dr(qt.paint_symbol["icon-translate"]),"icon-translate-anchor":new dr(qt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ar(qt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Ar(qt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Ar(qt.paint_symbol["text-occlusion-opacity"]),"text-color":new Ar(qt.paint_symbol["text-color"],{runtimeType:ta,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new Ar(qt.paint_symbol["text-halo-color"]),"text-halo-width":new Ar(qt.paint_symbol["text-halo-width"]),"text-halo-blur":new Ar(qt.paint_symbol["text-halo-blur"]),"text-translate":new dr(qt.paint_symbol["text-translate"]),"text-translate-anchor":new dr(qt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new dr(qt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new dr(qt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new dr(qt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new dr(qt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Ar(qt.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"})}))},v_);class fp extends Kn{constructor(e,i,s,f){super(e,b_(),i,s,f),this._colorAdjustmentMatrix=_e.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const f=[];for(const l of s)f.indexOf(l)<0&&f.push(l);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,s,f){return this._saturation===e&&this._contrast===i&&this._brightnessMin===s&&this._brightnessMax===f||(this._colorAdjustmentMatrix=function(l,d,R,N){l=B(l),d=ie(d);const $=_e.mat4.create(),I=l/3,j=1-2*I,H=[j,I,I,0,I,j,I,0,I,I,j,0,0,0,0,1],F=.5-.5*d,V=N-R;return _e.mat4.multiply($,[V,0,0,0,0,V,0,0,0,0,V,0,R,R,R,1],[d,0,0,0,0,d,0,0,0,0,d,0,F,F,F,1]),_e.mat4.multiply($,$,H),$}(e,i,s,f),this._saturation=e,this._contrast=i,this._brightnessMin=s,this._brightnessMax=f),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,s,f){const l=this.layout.get(e).evaluate(i,{},s,f),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||Hu(d.value)||!l?l:function(R,N){return N.replace(/{([^{}]+)}/g,($,I)=>I in R?String(R[I]):"")}(i.properties,l)}createBucket(e){return new hp(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of b_().paint.overridableProperties){if(!fp.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),s=new ub(i),f=new mh(s,i.property.specification,this.scope,this.options);let l=null;l=i.value.kind==="constant"||i.value.kind==="source"?new _h("source",f):new Fs("composite",f,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Vs(i.property,l,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&fp.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const s=e.get("text-field"),f=b_().paint.properties[i];let l=!1;const d=R=>{for(const N of R)if(f.overrides&&f.overrides.hasOverride(N))return void(l=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Nn)d(s.value.value.sections);else if(s.value.kind==="source"){const R=$=>{l||($ instanceof ba&&Ji($.value)===io?d($.value.sections):$ instanceof no?d($.sections):$.eachChild(R))},N=s.value;N._styleExpression&&R(N._styleExpression.expression)}return l}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,s){return{config:new us(this,{zoom:i,lut:s}),overrideFog:!1}}}let cb,hb,fb,db;var x_=Ri([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function w_(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function E_(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class T_{constructor(e,i,s,f){this.context=e,this.format=s,this.useMipmap=f&&f.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:f&&f.premultiply})}update(e,i){const s=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,f=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:l}=this,{gl:d}=l,{x:R,y:N}=i&&i.position?i.position:{x:0,y:0},$=R+s,I=N+f;!this.size||this.size[0]===$&&this.size[1]===I||(d.bindTexture(d.TEXTURE_2D,null),d.deleteTexture(this.texture),this.texture=d.createTexture(),this.size=null),d.bindTexture(d.TEXTURE_2D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(this.format===d.RGBA8&&(!i||i.premultiply!==!1));const j=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&$>0&&I>0){const H=this.useMipmap?Math.floor(Math.log2(Math.max($,I)))+1:1;d.texStorage2D(d.TEXTURE_2D,H,this.format,$,I),this.size=[$,I]}if(this.size)if(j)d.texSubImage2D(d.TEXTURE_2D,0,R,N,w_(this.format),E_(this.format),e);else{const H=e.data;H&&d.texSubImage2D(d.TEXTURE_2D,0,R,N,s,f,w_(this.format),E_(this.format),H)}this.useMipmap&&d.generateMipmap(d.TEXTURE_2D)}bind(e,i,s=!1){const{context:f}=this,{gl:l}=f;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap&&!s?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,i),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,s,f){const{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_2D,this.texture),i!==this.magFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),this.wrapS=s),f!==this.wrapT&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,f),this.wrapT=f)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class dp{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:s}=this,{gl:f}=s;f.bindTexture(f.TEXTURE_2D,this.texture),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,i),this.wrapS=i)}}function pp(o,e,i,s,f,l,d,R){const N=[o,e,1,i,s,1,f,l,1],$=[d,R,1],I=_e.mat3.adjoint([],N),[j,H,F]=_e.vec3.transformMat3($,$,I);return _e.mat3.multiply(N,N,[j,0,0,0,H,0,0,0,F])}function pb(o,e,i,s,f,l,d,R){const N=function($,I,j,H,F,V,Y,oe){const ce=pp(0,0,1,0,1,1,0,1),we=pp($,I,j,H,F,V,Y,oe),Ie=_e.mat3.adjoint([],ce);return _e.mat3.multiply(we,we,Ie)}(o,e,i,s,f,l,d,R);return[N[2]/N[8]/wr,N[5]/N[8]/wr]}function mp(o){return[o[0],Math.min(Math.max(o[1],-85.051129),Wn)]}class mb extends Ts{constructor(e,i,s,f){super(),this.id=e,this.dispatcher=s,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(f),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new So("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=hu(this.map._requestManager.transformRequest(this.url,Cr.Image),(s,f)=>{this._imageRequest=null,this._loaded=!0,s?this.fire(new Mo(s)):f&&(this.image=f instanceof HTMLImageElement?cr.getImageData(f):f,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new dp(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new So("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof dp||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],s=e[0][1];for(const l of e)l[1]>s&&(s=l[1]),l[1]<i&&(i=l[1]);const f=(s+i)/2;if(f>Wn?this.onNorthPole=!0:f<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const l=e.map(c.fromLngLat);this.tileID=function(d){let R=1/0,N=1/0,$=-1/0,I=-1/0;for(const Y of d)R=Math.min(R,Y.x),N=Math.min(N,Y.y),$=Math.max($,Y.x),I=Math.max(I,Y.y);const j=Math.max($-R,I-N),H=Math.max(0,Math.floor(-Math.log(j)/Math.LN2)),F=Math.pow(2,H);let V=Math.floor((R+$)/2*F);return V>1&&(V-=1),new er(H,V,Math.floor((N+I)/2*F))}(l),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new So("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const ce in this.tiles){const we=this.tiles[ce];we.state!=="loaded"&&(we.state="loaded",we.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=af(new er(0,0,0),this.map.transform.projection),s=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(ce){const we=ce[1].x-ce[0].x,Ie=ce[1].y-ce[0].y,me=ce[2].x-ce[1].x,Re=ce[2].y-ce[1].y,Ue=ce[3].x-ce[2].x,$e=ce[3].y-ce[2].y,ct=ce[0].x-ce[3].x,lt=ce[0].y-ce[3].y,st=we*Re-me*Ie,xt=me*$e-Ue*Re,dt=Ue*lt-ct*$e,Et=ct*Ie-we*lt;return st>0&&xt>0&&dt>0&&Et>0||st<0&&xt<0&&dt<0&&Et<0}(s))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const f=af(this.tileID,this.map.transform.projection),[l,d,R,N]=this.coordinates.map(ce=>{const we=f.projection.project(ce[0],ce[1]);return tb(f,we)._round()});this.perspectiveTransform=pb(l.x,l.y,d.x,d.y,R.x,R.y,N.x,N.y);const $=this._boundsArray=new Ro;$.emplaceBack(l.x,l.y,0,0),$.emplaceBack(d.x,d.y,wr,0),$.emplaceBack(N.x,N.y,0,wr),$.emplaceBack(R.x,R.y,wr,wr),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer($,x_.members),this.boundsSegments=hn.simpleSegment(0,0,4,2);const I=[],j=[mp((H=this.coordinates)[0]),mp(H[1]),mp(H[2]),mp(H[3])];var H;const[F,V,Y,oe]=function(ce){let we=ce[0][0],Ie=we,me=ce[0][1],Re=me;for(let Ue=1;Ue<ce.length;Ue++)ce[Ue][0]<we?we=ce[Ue][0]:ce[Ue][0]>Ie&&(Ie=ce[Ue][0]),ce[Ue][1]<me?me=ce[Ue][1]:ce[Ue][1]>Re&&(Re=ce[Ue][1]);return[we,me,Ie-we,Re-me]}(j);{const ce=new Ro,[we,Ie,me,Re]=function(kt){let jt=kt[0].x,Ot=jt,Kt=kt[0].y,ur=Kt;for(let Jt=1;Jt<kt.length;Jt++)kt[Jt].x<jt?jt=kt[Jt].x:kt[Jt].x>Ot&&(Ot=kt[Jt].x),kt[Jt].y<Kt?Kt=kt[Jt].y:kt[Jt].y>ur&&(ur=kt[Jt].y);return[jt,Kt,Ot-jt,ur-Kt]}(s),Ue=kt=>[(kt.x-we)/me,(kt.y-Ie)/Re],[$e,ct,lt,st]=s.map(Ue),xt=function(kt,jt,Ot,Kt,ur,Jt,yr,_r){const Er=pp(0,0,1,0,1,1,0,1),rr=pp(kt,jt,Ot,Kt,ur,Jt,yr,_r),kr=_e.mat3.adjoint([],rr);return _e.mat3.multiply(Er,Er,kr)}($e[0],$e[1],ct[0],ct[1],lt[0],lt[1],st[0],st[1]);this.elevatedGlobePerspectiveTransform=pb($e[0],$e[1],ct[0],ct[1],lt[0],lt[1],st[0],st[1]);const dt=(kt,jt)=>{I.push(kt.lng);const Ot=Math.round((kt.lng-F)/Y*wr),Kt=Math.round((kt.lat-V)/oe*wr),ur=Ue(jt),Jt=_e.vec3.transformMat3([],[ur[0],ur[1],1],xt),yr=Math.round(Jt[0]/Jt[2]*wr),_r=Math.round(Jt[1]/Jt[2]*wr);ce.emplaceBack(Ot,Kt,yr,_r)},Et=s[3].x-s[0].x,It=s[3].y-s[0].y,Mt=s[2].x-s[1].x,Ct=s[2].y-s[1].y;for(let kt=0;kt<65;kt++){const jt=kt/64,Ot=[s[0].x+jt*Et,s[0].y+jt*It],Kt=[s[1].x+jt*Mt,s[1].y+jt*Ct],ur=Kt[0]-Ot[0],Jt=Kt[1]-Ot[1];for(let yr=0;yr<65;yr++){const _r=yr/64,Er={x:Ot[0]+ur*_r,y:Ot[1]+Jt*_r};dt(i.projection.unproject(Er.x,Er.y),Er)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(ce,x_.members)}{this.maxLongitudeTriangleSize=0;let ce=[],we=new zn;const Ie=(me,Re,Ue)=>{we.emplaceBack(me,Re,Ue);const $e=I[me],ct=I[Re],lt=I[Ue],st=Math.min(Math.min($e,ct),lt),xt=Math.max(Math.max($e,ct),lt)-st;xt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=xt),ce.push(st+xt/2)};for(let me=0;me<64;me++)for(let Re=0;Re<64;Re++){const Ue=65*me+Re,$e=Ue+1,ct=Ue+65,lt=ct+1;Ie(Ue,ct,$e),Ie($e,ct,lt)}[ce,we]=function(me,Re){const Ue=Array.from({length:me.length},(lt,st)=>st);Ue.sort((lt,st)=>me[lt]-me[st]);const $e=[],ct=new zn;for(let lt=0;lt<Ue.length;lt++){const st=Ue[lt];$e.push(me[st]);const xt=3*st,dt=xt+1;ct.emplaceBack(Re.uint16[xt],Re.uint16[dt],Re.uint16[dt+1])}return[$e,ct]}(ce,we),this.elevatedGlobeTrianglesCenterLongitudes=ce,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(we)}this.elevatedGlobeSegments=hn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,Y/wr,0,oe/wr,0,0,V,F,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,s=i.gl;!this._dirty||this.texture instanceof dp||(this.texture?this.texture.update(this.image):(this.texture=new T_(i,this.image,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const s=this.elevatedGlobeTrianglesCenterLongitudes;let f=(l=e+180)+360*Math.round((s[0]-l)/360);var l;const d=new hn,R=(j,H)=>{d.segments.push({vertexOffset:0,primitiveOffset:j,vertexLength:i.segments[0].vertexLength,primitiveLength:H,sortKey:void 0,vaos:{}})},N=.51*this.maxLongitudeTriangleSize;if(Math.abs(s[0]-f)<=N){const j=Qe(s,0,s.length,f+N);return j===s.length||R(j,ee(s,j+1,s.length,f+360-N)-j),d}f<s[0]&&(f+=360);const $=ee(s,0,s.length,f-N);if($===s.length)return R(0,s.length),d;R(0,$-0);const I=Qe(s,$+1,s.length,f+N);return I!==s.length&&R(I,s.length-I),d}}const fM=(Math.pow(256,2)-1)/16907520;class _b extends Kn{constructor(e,i,s,f){super(e,{layout:fb||(fb=new on({visibility:new dr(qt.layout_raster.visibility)})),paint:db||(db=new on({"raster-opacity":new dr(qt.paint_raster["raster-opacity"]),"raster-color":new Co(qt.paint_raster["raster-color"]),"raster-color-mix":new dr(qt.paint_raster["raster-color-mix"]),"raster-color-range":new dr(qt.paint_raster["raster-color-range"]),"raster-hue-rotate":new dr(qt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new dr(qt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new dr(qt.paint_raster["raster-brightness-max"]),"raster-saturation":new dr(qt.paint_raster["raster-saturation"]),"raster-contrast":new dr(qt.paint_raster["raster-contrast"]),"raster-resampling":new dr(qt.paint_raster["raster-resampling"]),"raster-fade-duration":new dr(qt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new dr(qt.paint_raster["raster-emissive-strength"]),"raster-array-band":new dr(qt.paint_raster["raster-array-band"]),"raster-elevation":new dr(qt.paint_raster["raster-elevation"]),"raster-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"})}))},i,s,f),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof mb&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[s,f]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(s)&&isNaN(f)||s===this._curRampRange[0]&&f===this._curRampRange[1]||(this.colorRamp=Hh({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:s,end:f}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[s,f])}}let gb,yb,vb,bb,xb;class wb extends Kn{constructor(e,i,s,f){super(e,{layout:gb||(gb=new on({visibility:new dr(qt["layout_raster-particle"].visibility)})),paint:yb||(yb=new on({"raster-particle-array-band":new dr(qt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new dr(qt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Co(qt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new dr(qt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new dr(qt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new dr(qt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new dr(qt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new dr(qt["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"})}))},i,s,f),this._updateColorRamp(),this.lastInvalidatedAt=cr.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Hh({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=cr.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class dM extends Kn{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function S_(o,e,i){const s=[0,0,1],f=_e.quat.identity([]);return _e.quat.rotateY(f,f,i?-ze(o)+Math.PI:ze(o)),_e.quat.rotateX(f,f,-ze(e)),_e.vec3.transformQuat(s,s,f),_e.vec3.normalize(s,s)}function Eb(o,e){const i=_p(o.projection,o.zoom,o.width,o.height),s=function(l,d,R,N,$){const I=new Ai(R.lng-180*tl,R.lat),j=new Ai(R.lng+180*tl,R.lat),H=l.project(I.lng,I.lat),F=l.project(j.lng,j.lat),V=-Math.atan2(F.y-H.y,F.x-H.x),Y=c.fromLngLat(R);Y.y=le(Y.y,-1+tl,1-tl);const oe=Y.toLngLat(),ce=l.project(oe.lng,oe.lat),we=c.fromLngLat(oe);we.x+=tl;const Ie=we.toLngLat(),me=l.project(Ie.lng,Ie.lat),Re=Sb(me.x-ce.x,me.y-ce.y,V),Ue=c.fromLngLat(oe);Ue.y+=tl;const $e=Ue.toLngLat(),ct=l.project($e.lng,$e.lat),lt=Sb(ct.x-ce.x,ct.y-ce.y,V),st=Math.abs(Re.x)/Math.abs(lt.y),xt=_e.mat4.identity([]);_e.mat4.rotateZ(xt,xt,-V*(1-($?0:N)));const dt=_e.mat4.identity([]);return _e.mat4.scale(dt,dt,[1,1-(1-st)*N,1]),dt[4]=-lt.x/lt.y*N,_e.mat4.rotateZ(dt,dt,V),_e.mat4.multiply(dt,xt,dt),dt}(o.projection,0,o.center,i,e),f=Tb(o);return _e.mat4.scale(s,s,[f,f,1]),s}function Tb(o){const e=o.projection,i=_p(o.projection,o.zoom,o.width,o.height),s=M_(e,o.center),f=M_(e,Ai.convert(e.center));return Math.pow(2,s*i+(1-i)*f)}function _p(o,e,i,s,f=1/0){const l=o.range;if(!l)return 0;const d=Math.min(f,Math.max(i,s)),R=Math.log(d/1024)/Math.LN2;return et(l[0]+R,l[1]+R,e)}const tl=1/4e4;function M_(o,e){const i=le(e.lat,-85.051129,Wn),s=new Ai(e.lng-180*tl,i),f=new Ai(e.lng+180*tl,i),l=o.project(s.lng,i),d=o.project(f.lng,i),R=c.fromLngLat(s),N=c.fromLngLat(f),$=d.x-l.x,I=d.y-l.y,j=N.x-R.x,H=N.y-R.y,F=Math.sqrt((j*j+H*H)/($*$+I*I));return Math.log(F)/Math.LN2}function Sb(o,e,i){const s=Math.cos(i),f=Math.sin(i);return{x:o*s-e*f,y:o*f+e*s}}function Mb(o,e,i){_e.mat4.identity(o),_e.mat4.rotateZ(o,o,ze(e[2])),_e.mat4.rotateX(o,o,ze(e[0])),_e.mat4.rotateY(o,o,ze(e[1])),_e.mat4.scale(o,o,i),_e.mat4.multiply(o,o,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function gp(o,e,i,s,f,l,d,R){const N=[i[0]-e[0],i[1]-e[1],0],$=[s[0]-e[0],s[1]-e[1],0];if(_e.vec3.length(N)<1e-12||_e.vec3.length($)<1e-12)return _e.quat.identity(o);const I=_e.vec3.cross([],N,$);_e.vec3.normalize(I,I),_e.vec3.subtract($,s,e),N[2]=(l-f)*R,$[2]=(d-f)*R;const j=N;return _e.vec3.cross(j,N,$),_e.vec3.normalize(j,j),_e.quat.rotationTo(o,I,j)}function A_(o,e,i=!1){const s=Zn(e.zoom),f=function(l,d,R){const N=d.worldSize,$=[l[12],l[13],l[14]],I=In($[1]/N),j=la($[0]/N),H=_e.mat4.identity([]),F=qn(1,I)*N,V=qn(1,0)*N*u(I,d.zoom),Y=1/ma(N);let oe=V*Y;if(R){const me=_p(d.projection,d.zoom,d.width,d.height,1024);oe=Y*d.projection.pixelSpaceConversion(d.center.lat,N,me)}const ce=Bo(I,j);_e.vec3.add(ce,ce,_e.vec3.scale([],_e.vec3.normalize([],ce),F*oe*$[2]));const we=function(me){const Re=[me[0],me[1],me[2]];let Ue=[0,1,0];const $e=_e.vec3.cross([],Ue,Re);return _e.vec3.cross(Ue,Re,$e),_e.vec3.squaredLength(Ue)===0&&(Ue=[0,1,0],_e.vec3.cross($e,Re,Ue)),_e.vec3.normalize($e,$e),_e.vec3.normalize(Ue,Ue),_e.vec3.normalize(Re,Re),[$e[0],$e[1],$e[2],0,Ue[0],Ue[1],Ue[2],0,Re[0],Re[1],Re[2],0,me[0],me[1],me[2],1]}(ce);_e.mat4.scale(H,H,[oe,oe,oe*F]),_e.mat4.translate(H,H,[-$[0],-$[1],-$[2]]);const Ie=_e.mat4.multiply([],d.globeMatrix,we);return _e.mat4.multiply(Ie,Ie,H),_e.mat4.multiply(Ie,Ie,l),Ie}(o,e,i);if(s>0){const l=function(d,R){const N=R.worldSize,$=qn(1,0)*N*u(R.center.lat,R.zoom)/ma(N),I=qn(1,R.center.lat)*N,j=_e.mat4.identity([]);return _e.mat4.rotateY(j,j,ze(R.center.lng)),_e.mat4.rotateX(j,j,ze(R.center.lat)),_e.mat4.translate(j,j,[0,0,Hn]),_e.mat4.scale(j,j,[$,$,$*I]),_e.mat4.translate(j,j,[R.point.x-.5*N,R.point.y-.5*N,0]),_e.mat4.multiply(j,j,d),_e.mat4.multiply(j,R.globeMatrix,j)}(o,e);return function(d,R,N){const $=(V,Y,oe)=>{const ce=_e.vec3.length(V),we=_e.vec3.length(Y),Ie=An(V,Y,oe);return _e.vec3.scale(Ie,Ie,1/_e.vec3.length(Ie)*Qr(ce,we,oe))},I=$([d[0],d[1],d[2]],[R[0],R[1],R[2]],N),j=$([d[4],d[5],d[6]],[R[4],R[5],R[6]],N),H=$([d[8],d[9],d[10]],[R[8],R[9],R[10]],N),F=An([d[12],d[13],d[14]],[R[12],R[13],R[14]],N);return[I[0],I[1],I[2],0,j[0],j[1],j[2],0,H[0],H[1],H[2],0,F[0],F[1],F[2],1]}(f,l,s)}return f}function Ab(o,e,i,s){const f=Xr.projectAabbCorners(s,i);let l=Number.MAX_VALUE,d=-1;for(let $=0;$<f.length;++$){const I=f[$];I[0]=(.5*I[0]+.5)*e.width,I[1]=(.5-.5*I[1])*e.height,I[2]<l&&(d=$,l=I[2])}const R=$=>new Ge(f[$][0],f[$][1]);let N;switch(d){case 0:case 6:N=[R(1),R(5),R(4),R(7),R(3),R(2),R(1)];break;case 1:case 7:N=[R(0),R(4),R(5),R(6),R(2),R(3),R(0)];break;case 3:case 5:N=[R(1),R(0),R(4),R(7),R(6),R(2),R(1)];break;default:N=[R(1),R(5),R(6),R(7),R(3),R(0),R(1)]}if(Xe(o,N))return l}const pM=Ri([{name:"a_pos_3f",components:3,type:"Float32"}]),mM=Ri([{name:"a_color_3f",components:3,type:"Float32"}]),_M=Ri([{name:"a_color_4f",components:4,type:"Float32"}]),gM=Ri([{name:"a_uv_2f",components:2,type:"Float32"}]),yM=Ri([{name:"a_normal_3f",components:3,type:"Float32"}]),vM=Ri([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),bM=Ri([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),Ib={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class yp{constructor(e,i,s,f){this.message=(e?`${e}: `:"")+s,f&&(this.identifier=f),i!=null&&i.__line__&&(this.line=i.__line__)}}function Pb(o,e){const i=o.indexOf("://")===-1;try{return new URL(o,i&&e?"http://example.com":void 0),!0}catch{return!1}}class Cb{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Rb{constructor(){this.instancedDataArray=new Bh,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class I_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,i){}populate(e,i,s,f){this.tileToMeter=n(s);const l=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:d,id:R,index:N,sourceLayerIndex:$}of e){const I=R??(d.properties&&d.properties.hasOwnProperty("id")?d.properties.id:void 0),j=fe(d,l);if(!this.layers[0]._featureFilter.filter(new Xi(this.zoom),j,s))continue;const H={id:I,sourceLayerIndex:$,index:N,geometry:l?j.geometry:he(d,s,f),properties:d.properties,type:d.type,patterns:{}},F=this.addFeature(H,H.geometry,j);F&&i.featureIndex.insert(d,H.geometry,N,$,this.index,this.instancesPerModel[F].instancedDataArray.length,wr/32)}this.lookup=null}update(e,i,s,f){for(const l in this.instancesPerModel){const d=this.instancesPerModel[l];for(const R in e)d.idToFeaturesIndex.hasOwnProperty(R)&&(this.evaluate(d.features[d.idToFeaturesIndex[R]],e[R],d,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];for(const f of s.features){const l=this.layers[0],d=f.feature,R=this.canonical,N=l.paint.get("model-rotation").evaluate(d,{},R),$=l.paint.get("model-scale").evaluate(d,{},R),I=l.paint.get("model-translation").evaluate(d,{},R);_e.vec3.exactEquals(f.rotation,N)&&_e.vec3.exactEquals(f.scale,$)&&_e.vec3.exactEquals(f.translation,I)||(this.evaluate(f,f.featureStates,s,!0),e=!0)}}return e}updateReplacement(e,i,s,f){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Qm(this.activeReplacements,l))return!1;this.activeReplacements=l;let d=!1;for(const R in this.instancesPerModel){const N=this.instancesPerModel[R],$=N.instancedDataArray;for(const I of N.features){const j=I.instancedDataOffset,H=I.instancedDataCount;for(let F=0;F<H;F++){const V=16*(F+j);let Y=$.float32[V+0];const oe=Y>wr;Y=oe?Y-wr:Y;const ce=Math.floor(Y),we=$.float32[V+1];let Ie=!1;for(const me of this.activeReplacements)if(!W1(me,s,Ib.Model,f)&&!(me.min.x>ce||ce>me.max.x||me.min.y>we||we>me.max.y)&&(Ie=J1(K1(ce,we,e.canonical,me.footprintTileId.canonical),me.footprint),Ie))break;$.float32[V]=Ie?Y+wr:Y,d=d||Ie!==oe}}}return d}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];s.instancedDataArray.length<0||s.instancedDataArray.length===0||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=e.createVertexBuffer(s.instancedDataArray,vM.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];s.instancedDataArray.length!==0&&s.instancedDataBuffer&&s.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const i of this.modelUris)e.removeModel(i,"")}addFeature(e,i,s){const f=this.layers[0],l=f.layout.get("model-id").evaluate(s,{},this.canonical);if(!l)return St(`modelId is not evaluated for layer ${f.id} and it is not going to get rendered.`),l;Pb(l,!1)&&(this.modelUris.includes(l)||this.modelUris.push(l)),this.instancesPerModel[l]||(this.instancesPerModel[l]=new Rb);const d=this.instancesPerModel[l],R=d.instancedDataArray,N=new Cb(s,R.length);for(const $ of i)for(const I of $){if(I.x<0||I.x>=wr||I.y<0||I.y>=wr)continue;const j=(this.lookupDim-1)/wr,H=this.lookupDim*(I.y*j|0)+I.x*j|0;if(this.lookup){if(this.lookup[H]!==0)continue;this.lookup[H]=1}this.instanceCount++;const F=R.length;R.resize(F+1),d.instancesEvaluatedElevation.push(0),R.float32[16*F]=I.x,R.float32[16*F+1]=I.y}return N.instancedDataCount=d.instancedDataArray.length-N.instancedDataOffset,N.instancedDataCount>0&&(e.id&&(d.idToFeaturesIndex[e.id]=d.features.length),d.features.push(N),this.evaluate(N,{},d,!1)),l}getModelUris(){return this.modelUris}evaluate(e,i,s,f){const l=this.layers[0],d=e.feature,R=this.canonical,N=e.rotation=l.paint.get("model-rotation").evaluate(d,i,R),$=e.scale=l.paint.get("model-scale").evaluate(d,i,R),I=e.translation=l.paint.get("model-translation").evaluate(d,i,R),j=l.paint.get("model-color").evaluate(d,i,R);j.a=l.paint.get("model-color-mix-intensity").evaluate(d,i,R);const H=[];this.maxVerticalOffset<I[2]&&(this.maxVerticalOffset=I[2]),this.maxScale=Math.max(Math.max(this.maxScale,$[0]),Math.max($[1],$[2])),Mb(H,N,$);const F=Math.round(100*j.a)+j.b/1.05;for(let V=0;V<e.instancedDataCount;++V){const Y=e.instancedDataOffset+V,oe=16*Y,ce=s.instancedDataArray.float32;let we=0;f&&(we=ce[oe+6]-s.instancesEvaluatedElevation[Y]);const Ie=0|ce[oe+1];ce[oe]=(0|ce[oe])+j.r/1.05,ce[oe+1]=Ie+j.g/1.05,ce[oe+2]=F,ce[oe+3]=1/(R.z>10?this.tileToMeter:n(R,Ie)),ce[oe+4]=I[0],ce[oe+5]=I[1],ce[oe+6]=I[2]+we,ce[oe+7]=H[0],ce[oe+8]=H[1],ce[oe+9]=H[2],ce[oe+10]=H[4],ce[oe+11]=H[5],ce[oe+12]=H[6],ce[oe+13]=H[8],ce[oe+14]=H[9],ce[oe+15]=H[10],s.instancesEvaluatedElevation[Y]=I[2]}}}let Db,Lb;Dr(I_,"ModelBucket",{omit:["layers"]}),Dr(Rb,"PerModelAttributes"),Dr(Cb,"ModelFeature");const Kl=64,Sc={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Ob(o,e,i,s,f,l,d,R,N,$=!1){const I=i.zoom,j=i.project(s),H=u(s.lat,I),F=1/H;_e.mat4.identity(o),_e.mat4.translate(o,o,[j.x+d[0]*F,j.y+d[1]*F,d[2]]);let V=1,Y=1;const oe=i.worldSize;if($){if(i.projection.name==="mercator"){let me=0;i.elevation&&(me=i.elevation.getAtPointOrZero(new c(j.x/oe,j.y/oe),0));const Re=_e.vec4.transformMat4([],[j.x,j.y,me,1],i.projMatrix)[3]/i.cameraToCenterDistance;V=Re,Y=Re*u(i.center.lat,I)}else if(i.projection.name==="globe"){const me=A_(o,i),Re=_e.mat4.multiply([],i.projMatrix,me),Ue=[0,0,0,1];_e.vec4.transformMat4(Ue,Ue,Re);const $e=Ue[3]/i.cameraToCenterDistance,ct=Zn(I),lt=i.projection.pixelsPerMeter(s.lat,oe)*u(s.lat,I),st=i.projection.pixelsPerMeter(i.center.lat,oe)*u(i.center.lat,I);V=$e/Qr(lt,jm(i.center.lat),ct),Y=$e*H/lt,V*=st,Y*=st}}else V=F;_e.mat4.scale(o,o,[V,V,Y]);const ce=[...o],we=e.orientation,Ie=[];if(Mb(Ie,[we[0]+f[0],we[1]+f[1],we[2]+f[2]],l),_e.mat4.multiply(o,ce,Ie),R&&i.elevation){let me=0;const Re=[];if(N&&i.elevation){me=function(ct,lt,st,xt,dt){const Et=lt.elevation;if(!Et)return 0;const It=Xr.projectAabbCorners(st,xt),Mt=qn(1,dt.lat)*lt.worldSize,Ct=function(kr,vr){const zr=[0,0,1],Yr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const li of Yr){const ci=kr[li.corners[0]],_i=kr[li.corners[1]],hi=kr[li.corners[2]],yi=[_i[0]-ci[0],_i[1]-ci[1],vr*(_i[2]-ci[2])],Vi=_e.vec3.cross(yi,yi,[hi[0]-ci[0],hi[1]-ci[1],vr*(hi[2]-ci[2])]);_e.vec3.normalize(Vi,Vi),li.dotProductWithUp=_e.vec3.dot(Vi,zr)}return Yr.sort((li,ci)=>li.dotProductWithUp-ci.dotProductWithUp),Yr[0].corners}(It,Mt),kt=It[Ct[0]],jt=It[Ct[1]],Ot=It[Ct[2]],Kt=It[Ct[3]],ur=Et.getAtPointOrZero(new c(kt[0]/lt.worldSize,kt[1]/lt.worldSize),0),Jt=Et.getAtPointOrZero(new c(jt[0]/lt.worldSize,jt[1]/lt.worldSize),0),yr=Et.getAtPointOrZero(new c(Ot[0]/lt.worldSize,Ot[1]/lt.worldSize),0),_r=Et.getAtPointOrZero(new c(Kt[0]/lt.worldSize,Kt[1]/lt.worldSize),0),Er=(ur+_r)/2,rr=(Jt+yr)/2;return Er>rr?Jt<yr?gp(ct,jt,Kt,kt,Jt,_r,ur,Mt):gp(ct,Ot,kt,Kt,yr,ur,_r,Mt):ur<_r?gp(ct,kt,jt,Ot,ur,Jt,yr,Mt):gp(ct,Kt,Ot,jt,_r,yr,Jt,Mt),Math.max(Er,rr)}(Re,i,e.aabb,o,s);const Ue=_e.mat4.fromQuat([],Re),$e=_e.mat4.multiply([],Ue,Ie);_e.mat4.multiply(o,ce,$e)}else me=i.elevation.getAtPointOrZero(new c(j.x/oe,j.y/oe),0);me!==0&&(o[14]+=me)}}function cf(o,e,i=!1){o.uploaded||(o.gfxTexture=new T_(e,o.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:o.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),o.uploaded=!0,o.image=null)}function xM(o,e,i){o.indexBuffer=e.createIndexBuffer(o.indexArray,!1,!0),o.vertexBuffer=e.createVertexBuffer(o.vertexArray,pM.members,!1,!0),o.normalArray&&(o.normalBuffer=e.createVertexBuffer(o.normalArray,yM.members,!1,!0)),o.texcoordArray&&(o.texcoordBuffer=e.createVertexBuffer(o.texcoordArray,gM.members,!1,!0)),o.colorArray&&(o.colorBuffer=e.createVertexBuffer(o.colorArray,(o.colorArray.bytesPerElement===12?mM:_M).members,!1,!0)),o.featureArray&&(o.pbrBuffer=e.createVertexBuffer(o.featureArray,bM.members,!0)),o.segments=hn.simpleSegment(0,0,o.vertexArray.length,o.indexArray.length);const s=o.material;s.pbrMetallicRoughness.baseColorTexture&&cf(s.pbrMetallicRoughness.baseColorTexture,e),s.pbrMetallicRoughness.metallicRoughnessTexture&&cf(s.pbrMetallicRoughness.metallicRoughnessTexture,e),s.normalTexture&&cf(s.normalTexture,e),s.occlusionTexture&&cf(s.occlusionTexture,e,i),s.emissionTexture&&cf(s.emissionTexture,e)}function P_(o,e,i){if(o.meshes)for(const s of o.meshes)xM(s,e,i);if(o.children)for(const s of o.children)P_(s,e,i)}function vp(o){if(o.meshes)for(const e of o.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(o.children)for(const e of o.children)vp(e)}function C_(o){if(o.meshes)for(const i of o.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(o.children)for(const i of o.children)C_(i)}class Mc{constructor(e,i,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(e,i,s){const f=s||e.findDEMTileFor(i);if(!f||!f.dem)return;const l=f.dem,d=f.tileID,R=1<<i.canonical.z-d.canonical.z;return new Mc(f,l.dim/wr/R,[(i.canonical.x/R-d.canonical.x)*l.dim,(i.canonical.y/R-d.canonical.y)*l.dim])}tileCoordToPixel(e,i){const s=i*this._scale+this._offset[1],f=Math.floor(e*this._scale+this._offset[0]),l=Math.floor(s);return new Ge(f,l)}getElevationAt(e,i,s,f){const l=e*this._scale+this._offset[0],d=i*this._scale+this._offset[1],R=Math.floor(l),N=Math.floor(d),$=this._dem;return f=!!f,s?Qr(Qr($.get(R,N,f),$.get(R,N+1,f),d-N),Qr($.get(R+1,N,f),$.get(R+1,N+1,f),d-N),l-R):$.get(R,N,f)}getElevationAtPixel(e,i,s){return this._dem.get(e,i,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*qn(1,e)*this._dem.stride}}const R_=new Float32Array(262144),Jl=new Uint8Array(262144);function zb(o){let e=0;if(o.meshes)for(const i of o.meshes)e=Math.max(e,i.aabb.max[2]);if(o.children)for(const i of o.children)e=Math.max(e,zb(i));return e}function kb(o,e,i){if(o.meshes)for(const s of o.meshes){if(s.aabb.min[0]===1/0)continue;const f=Xr.applyTransform(s.aabb,o.matrix);i.insert(e,f.min[0],f.min[1],f.max[0],f.max[1])}if(o.children)for(const s of o.children)kb(s,e,i)}const Bb=["","wall","door","roof","window","lamp","logo"];class Fb{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:zb(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Xr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Xr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const s of this.node.meshes)this.node.lightMeshIndex!==e&&(s.transformedAabb=Xr.applyTransformFast(s.aabb,this.node.matrix),i.encapsulate(s.transformedAabb)),e++;this.aabb=i}return this.aabb}}class bp{constructor(e,i,s,f,l,d,R){this.id=s,this.layers=e,this.layerIds=this.layers.map(N=>N.fqid),this.stateDependentLayerIds=this.layers.filter(N=>N.isStateDependent()).map(N=>N.id),this.modelTraits|=Sc.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,f&&(this.modelTraits|=Sc.HasMapboxMeshFeatures),l&&(this.modelTraits|=Sc.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=d,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const N of i)this.nodesInfo.push(new Fb(N)),kb(N,R.featureIndexArray.length,R.grid),R.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,R.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const s of this.getNodesInfo()){const f=s.node;f.footprint&&i.push({footprint:f.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const s=i?this.stateDependentLayers:this.layers;if(!We(e,this.states))for(const f of s)this.evaluate(f,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const s of i){const f=s.node;this.uploaded?this.updatePbrBuffer(f):P_(f,e,!0)}for(const s of i)vp(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const s of e.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),i=!0);return i}needsReEvaluation(e,i,s){const f=e.transform.projectionOptions,l=e.style.getBrightness(),d=this.brightness!==l;if(!this.uploaded||this.dirty||f.name!==this.projection.name||hf(s.paint.get("model-color").value,d)||hf(s.paint.get("model-color-mix-intensity").value,d)||hf(s.paint.get("model-roughness").value,d)||hf(s.paint.get("model-emissive-strength").value,d)||hf(s.paint.get("model-height-based-emissive-strength-multiplier").value,d)){this.projection=f,this.brightness=l;const R=this.getNodesInfo();for(const N of R)N.state=null;return!0}return!1}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const s=this.getNodesInfo(),f=this.id.canonical;for(const l of s){const d=l.feature;l.evaluatedScale=i.paint.get("model-scale").evaluate(d,{},f)}}evaluate(e,i){const s=this.getNodesInfo();for(const f of s){if(!f.node.meshes)continue;const l=f.feature,d=i&&i[l.id];if(We(d,f.state))continue;f.state=structuredClone(d);const R=f.node.meshes&&f.node.meshes[0].featureData,N=f.evaluatedColor[2],$=f.evaluatedRMEA[2],I=this.id.canonical;if(f.hasTranslucentParts=!1,R){for(let j=0;j<Bb.length;j++){const H=Bb[j];H.length&&(l.properties.part=H);const F=e.paint.get("model-color").evaluate(l,d,I).toRenderColor(null),V=e.paint.get("model-color-mix-intensity").evaluate(l,d,I);f.evaluatedColor[j]=[F.r,F.g,F.b,V],f.evaluatedRMEA[j][0]=e.paint.get("model-roughness").evaluate(l,d,I),f.evaluatedRMEA[j][2]=e.paint.get("model-emissive-strength").evaluate(l,d,I),f.evaluatedRMEA[j][3]=F.a,f.emissionHeightBasedParams[j]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(l,d,I),!f.hasTranslucentParts&&F.a<1&&(f.hasTranslucentParts=!0)}delete l.properties.part,EM(f,N!==f.evaluatedColor[2]||$!==f.evaluatedRMEA[2],this.modelTraits)}else f.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(l,d,I);f.evaluatedScale=e.paint.get("model-scale").evaluate(l,d,I),this.updatePbrBuffer(f.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,s,f){const l=e.findDEMTileFor(s);if(l&&(l.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(l.dem&&l.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=l.tileID.overscaledZ;const d=Mc.create(e,s,l);if(!d)return;this.modelTraits&Sc.HasMapboxMeshFeatures&&this.updateDEM(e,d,s,f);for(const R of this.getNodesInfo()){const N=R.node;if(!N.footprint||!N.footprint.vertices||!N.footprint.vertices.length)continue;const $=N.footprint.vertices;let I=d.getElevationAt($[0].x,$[0].y,!0,!0);for(let j=1;j<$.length;j++)I=Math.min(I,d.getElevationAt($[j].x,$[j].y,!0,!0));N.elevation=I}}this.terrainTile=l.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,s,f){let l=i._dem._modifiedForSources[f];if(l===void 0&&(i._dem._modifiedForSources[f]=[],l=i._dem._modifiedForSources[f]),l.includes(s.canonical))return;const d=i._dem.dim;l.push(s.canonical);let R=!1;for(const N of this.getNodesInfo()){const $=N.node;if(!$.footprint||!$.footprint.grid)continue;const I=$.footprint.grid,j=i.tileCoordToPixel(I.min.x,I.min.y),H=i.tileCoordToPixel(I.max.x,I.max.y),F=Math.min(Math.min(d-H.y,j.x),Math.min(j.y,d-H.x));if(F<0)continue;const V=le(F,2,5);let Y=Math.max(0,j.x-V),oe=Math.max(0,j.y-V),ce=Math.min(H.x+V,d-1),we=Math.min(H.y+V,d-1);for(let Ue=oe;Ue<=we;++Ue)for(let $e=Y;$e<=ce;++$e)Jl[Ue*d+$e]=255;let Ie=0,me=0;for(let Ue=0;Ue<I.cellsY;++Ue)for(let $e=0;$e<I.cellsX;++$e){if(!I.cells[Ue*I.cellsX+$e])continue;const ct=i.tileCoordToPixel(I.min.x+$e/I.xScale,I.min.y+Ue/I.yScale),lt=i.tileCoordToPixel(I.min.x+($e+1)/I.xScale,I.min.y+(Ue+1)/I.yScale);for(let st=ct.y;st<=Math.min(lt.y+1,d-1);++st)for(let xt=ct.x;xt<=Math.min(lt.x+1,d-1);++xt)Jl[st*d+xt]===255&&(Jl[st*d+xt]=0,Ie+=i.getElevationAtPixel(xt,st),me++)}const Re=Ie/me;Y=Math.max(1,j.x-V),oe=Math.max(1,j.y-V),ce=Math.min(H.x+V,d-2),we=Math.min(H.y+V,d-2),R=!0;for(let Ue=oe;Ue<=we;++Ue)for(let $e=Y;$e<=ce;++$e)Jl[Ue*d+$e]===0&&(R_[Ue*d+$e]=i._dem.set($e,Ue,Re));for(let Ue=1;Ue<V;++Ue){Y=Math.max(1,j.x-Ue),oe=Math.max(1,j.y-Ue),ce=Math.min(H.x+Ue,d-2),we=Math.min(H.y+Ue,d-2);for(let $e=oe;$e<=we;++$e)for(let ct=Y;ct<=ce;++ct){const lt=$e*d+ct;if(Jl[lt]===255){let st=0,xt=0,dt=-1,Et=-1;for(let It=-1;It<=1;++It)for(let Mt=-1;Mt<=1;++Mt){const Ct=($e+It)*d+ct+Mt;if(Jl[Ct]>=Ue)continue;const kt=R_[Ct],jt=Math.abs(kt);jt>xt&&(st=kt,xt=jt,dt=Mt,Et=It)}if(xt>.1){const It=1-(Ue+.5*Math.abs(dt*Et))/V;let Mt=i._dem.get(ct,$e)+st*It;const Ct=i._dem.get(ct+dt,$e+Et),kt=i._dem.get(ct-dt,$e-Et,!0);(Mt-Ct)*(Mt-kt)>0&&(Mt=(Ct+kt)/2),R_[lt]=i._dem.set(ct,$e,Mt),Jl[lt]=Ue}}}}}R&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=cr.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)vp(i.node),C_(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped()),f=this.getNodesInfo();for(let l=0;l<this.nodesInfo.length;l++){const d=f[l].node;f[l].hiddenByReplacement=!!d.footprint&&!s.find(R=>R.footprint===d.footprint)}}getHeightAtTileCoord(e,i){const s=this.getNodesInfo(),f=[],l=[0,0,0],d=_e.mat4.identity([]);for(let R=0;R<this.nodesInfo.length;R++){const N=s[R],$=N.node.meshes[0],I=$.transformedAabb;if(e<I.min[0]||i<I.min[1]||e>I.max[0]||i>I.max[1])continue;if(N.node.hidden===!0)return{height:1/0,maxHeight:N.feature.properties.height,hidden:!1,verticalScale:N.evaluatedScale[2]};_e.mat4.invert(d,N.node.matrix),l[0]=e,l[1]=i,_e.vec3.transformMat4(l,l,d);const j=(l[0]-$.aabb.min[0])/($.aabb.max[0]-$.aabb.min[0])*Kl|0,H=Math.min(63,(l[1]-$.aabb.min[1])/($.aabb.max[1]-$.aabb.min[1])*Kl|0)*Kl+Math.min(63,j),F=$.heightmap[H];if(!(F<0&&N.node.footprint))return N.hiddenByReplacement?void 0:{height:F,maxHeight:N.feature.properties.height,hidden:!1,verticalScale:N.evaluatedScale[2]};if(N.node.footprint.grid.query(new Ge(e,i),new Ge(e,i),f),f.length>0)return{height:void 0,maxHeight:N.feature.properties.height,hidden:N.hiddenByReplacement,verticalScale:N.evaluatedScale[2]}}}}function hf(o,e){return!o.isLightConstant&&e}function wM(o,e,i,s,f,l,d,R){let N=(61440&e|(61440&e)>>4)>>8,$=(3840&e|(3840&e)>>4)>>4,I=240&e|(240&e)>>4;i[3]>0&&(N=Qr(N,255*i[0],i[3]),$=Qr($,255*i[1],i[3]),I=Qr(I,255*i[2],i[3]));const j=N<<8|$,H=I<<8|Math.floor(255*s[3]),F=function(Ue){const $e=le(Ue,0,2);return Math.min(Math.round(.5*$e*255),255)}(s[2])<<8|15*s[0]<<4|15*s[1],V=le(f[0],0,1),Y=le(f[1],0,1),oe=le(f[2],0,1),ce=le(f[3],0,1);let we,Ie,me,Re;if(V!==Y&&d!==l&&Y!==V){const Ue=d-l;Ie=1/(Ue*(Y-V)),me=-(l+Ue*V)/(Ue*(Y-V));const $e=le(f[4],-1,1);Re=Math.pow(10,$e),we=255*oe<<8|255*ce}else we=65535,Ie=0,me=1,Re=1;if(o.emplaceBack(j,H,F,we,Ie,me,Re),R){const Ue=R.length;R.clear();for(let $e=0;$e<Ue;$e++)R.emplaceBack(j,H,F,we,Ie,me,Re)}}function EM(o,e,i){const s=o.node;let f=0;const l=i&Sc.HasMeshoptCompression;for(const d of s.meshes){if(s.lights&&s.lightMeshIndex===f||!d.featureData)continue;d.featureArray=new Bl,d.featureArray.reserve(d.featureData.length);let R=e;for(const N of d.featureData){const $=l?65535&N:N>>16&65535,I=l?N>>16&65535:65535&N,j=(15&I)<8?15&I:0,H=o.evaluatedRMEA[j],F=o.evaluatedColor[j],V=o.emissionHeightBasedParams[j];let Y;if(R&&j===2&&s.lights&&(Y=new Bl,Y.resize(10*s.lights.length)),wM(d.featureArray,$,F,H,V,d.aabb.min[2],d.aabb.max[2],Y),Y&&R){R=!1;const oe=s.meshes[s.lightMeshIndex];oe.featureArray=Y,oe.featureArray._trim()}}d.featureArray._trim(),f++}}function Nb(o,e,i,s){const f=1<<o.z;e.lat=In((s/wr+o.y)/f),e.lng=la((i/wr+o.x)/f)}Dr(bp,"Tiled3dModelBucket",{omit:["layers"]}),Dr(Fb,"Tiled3dModelFeature");const TM={circle:class extends Kn{constructor(o,e,i,s){super(o,{layout:Gt||(Gt=new on({"circle-sort-key":new Ar(qt.layout_circle["circle-sort-key"]),visibility:new dr(qt.layout_circle.visibility)})),paint:nr||(nr=new on({"circle-radius":new Ar(qt.paint_circle["circle-radius"]),"circle-color":new Ar(qt.paint_circle["circle-color"]),"circle-blur":new Ar(qt.paint_circle["circle-blur"]),"circle-opacity":new Ar(qt.paint_circle["circle-opacity"]),"circle-translate":new dr(qt.paint_circle["circle-translate"]),"circle-translate-anchor":new dr(qt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new dr(qt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new dr(qt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ar(qt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ar(qt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ar(qt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new dr(qt.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}createBucket(o){return new je(o)}queryRadius(o){const e=o;return zt("circle-radius",this,e)+zt("circle-stroke-width",this,e)+tr(this.paint.get("circle-translate"))}queryIntersectsFeature(o,e,i,s,f,l,d,R){const N=pr(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),l.angle,o.pixelToTileUnitsFactor),$=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return gc(o,s,l,d,R,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",N,$)}getProgramIds(){return["circle"]}getDefaultProgramParams(o,e,i){const s=_c(this);return{config:new us(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}},heatmap:class extends Kn{createBucket(o){return new y1(o)}constructor(o,e,i,s){super(o,{layout:v1||(v1=new on({visibility:new dr(qt.layout_heatmap.visibility)})),paint:b1||(b1=new on({"heatmap-radius":new Ar(qt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ar(qt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new dr(qt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Co(qt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new dr(qt.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Hh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return zt("heatmap-radius",this,o)}queryIntersectsFeature(o,e,i,s,f,l,d,R){const N=this.paint.get("heatmap-radius").evaluate(e,i);return gc(o,s,l,d,R,!0,!0,new Ge(0,0),N)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(o,e,i){return o==="heatmap"?{config:new us(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends Kn{constructor(o,e,i,s){super(o,{layout:x1||(x1=new on({visibility:new dr(qt.layout_hillshade.visibility)})),paint:w1||(w1=new on({"hillshade-illumination-direction":new dr(qt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new dr(qt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new dr(qt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new dr(qt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new dr(qt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new dr(qt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new dr(qt.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(o,e,i){return{overrideFog:!1}}},fill:class extends Kn{constructor(o,e,i,s){super(o,{layout:R1||(R1=new on({"fill-sort-key":new Ar(qt.layout_fill["fill-sort-key"]),visibility:new dr(qt.layout_fill.visibility),"fill-elevation-reference":new dr(qt.layout_fill["fill-elevation-reference"])})),paint:D1||(D1=new on({"fill-antialias":new dr(qt.paint_fill["fill-antialias"]),"fill-opacity":new Ar(qt.paint_fill["fill-opacity"]),"fill-color":new Ar(qt.paint_fill["fill-color"]),"fill-outline-color":new Ar(qt.paint_fill["fill-outline-color"]),"fill-translate":new dr(qt.paint_fill["fill-translate"]),"fill-translate-anchor":new dr(qt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ar(qt.paint_fill["fill-pattern"]),"fill-emissive-strength":new dr(qt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Ar(qt.paint_fill["fill-z-offset"]),"fill-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}getProgramIds(){const o=this.paint.get("fill-pattern"),e=o&&o.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(o,e,i){return{config:new us(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(o,e){super.recalculate(o,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new $m(o)}queryRadius(){return tr(this.paint.get("fill-translate"))}queryIntersectsFeature(o,e,i,s,f,l){return!o.queryGeometry.isAboveHorizon&&at(lr(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),l.angle,o.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends Kn{constructor(o,e,i,s){super(o,{layout:dv||(dv=new on({visibility:new dr(qt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new dr(qt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:pv||(pv=new on({"fill-extrusion-opacity":new dr(qt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ar(qt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new dr(qt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new dr(qt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ar(qt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ar(qt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ar(qt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new dr(qt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new dr(qt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new dr(qt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new dr(qt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new dr(qt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new dr(qt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new dr(qt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new dr(qt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new dr(qt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new dr(qt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Ar(qt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Ar(qt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new dr(qt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new dr(qt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new dr(qt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new dr(qt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ar(qt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Ar(qt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new dr(qt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new Xd(o)}queryRadius(){return tr(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(o,e,i,s,f,l,d,R,N){const $=pr(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),l.angle,o.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(e,i),j=this.paint.get("fill-extrusion-base").evaluate(e,i),H=[0,0],F=R&&l.elevation,V=l.elevation?l.elevation.exaggeration():1,Y=o.tile.getBucket(this);if(F&&Y instanceof Xd){const me=Y.centroidVertexArray,Re=N+1;Re<me.length&&(H[0]=me.geta_centroid_pos0(Re),H[1]=me.geta_centroid_pos1(Re))}if(H[0]===0&&H[1]===1)return!1;l.projection.name==="globe"&&(s=fv([s],[new Ge(0,0),new Ge(wr,wr)],o.tileID.canonical).map(me=>me.polygon).flat());const oe=F?R:null,[ce,we]=function(me,Re,Ue,$e,ct,lt,st,xt,dt,Et,It){return me.projection.name==="globe"?function(Mt,Ct,kt,jt,Ot,Kt,ur,Jt,yr,_r,Er){const rr=[],kr=[],vr=Mt.projection.upVectorScale(Er,Mt.center.lat,Mt.worldSize).metersToTile,zr=[0,0,0,1],Yr=[0,0,0,1],li=(_i,hi,yi,Vi)=>{_i[0]=hi,_i[1]=yi,_i[2]=Vi,_i[3]=1},ci=hv();kt>0&&(kt+=ci),jt+=ci;for(const _i of Ct){const hi=[],yi=[];for(const Vi of _i){const Bi=Vi.x+Ot.x,ni=Vi.y+Ot.y,Fi=Mt.projection.projectTilePoint(Bi,ni,Er),zi=Mt.projection.upVector(Er,Vi.x,Vi.y);let Gi=kt,gn=jt;if(ur){const yn=_v(Bi,ni,kt,jt,ur,Jt,yr,_r);Gi+=yn.base,gn+=yn.top}kt!==0?li(zr,Fi.x+zi[0]*vr*Gi,Fi.y+zi[1]*vr*Gi,Fi.z+zi[2]*vr*Gi):li(zr,Fi.x,Fi.y,Fi.z),li(Yr,Fi.x+zi[0]*vr*gn,Fi.y+zi[1]*vr*gn,Fi.z+zi[2]*vr*gn),_e.vec3.transformMat4(zr,zr,Kt),_e.vec3.transformMat4(Yr,Yr,Kt),hi.push(new Xl(zr[0],zr[1],zr[2])),yi.push(new Xl(Yr[0],Yr[1],Yr[2]))}rr.push(hi),kr.push(yi)}return[rr,kr]}(me,Re,Ue,$e,ct,lt,st,xt,dt,Et,It):st?function(Mt,Ct,kt,jt,Ot,Kt,ur,Jt,yr){const _r=[],Er=[],rr=[0,0,0,1];for(const kr of Mt){const vr=[],zr=[];for(const Yr of kr){const li=Yr.x+jt.x,ci=Yr.y+jt.y,_i=_v(li,ci,Ct,kt,Kt,ur,Jt,yr);rr[0]=li,rr[1]=ci,rr[2]=_i.base,rr[3]=1,_e.vec4.transformMat4(rr,rr,Ot),rr[3]=Math.max(rr[3],1e-5);const hi=new Xl(rr[0]/rr[3],rr[1]/rr[3],rr[2]/rr[3]);rr[0]=li,rr[1]=ci,rr[2]=_i.top,rr[3]=1,_e.vec4.transformMat4(rr,rr,Ot),rr[3]=Math.max(rr[3],1e-5);const yi=new Xl(rr[0]/rr[3],rr[1]/rr[3],rr[2]/rr[3]);vr.push(hi),zr.push(yi)}_r.push(vr),Er.push(zr)}return[_r,Er]}(Re,Ue,$e,ct,lt,st,xt,dt,Et):function(Mt,Ct,kt,jt,Ot){const Kt=[],ur=[],Jt=Ot[8]*Ct,yr=Ot[9]*Ct,_r=Ot[10]*Ct,Er=Ot[11]*Ct,rr=Ot[8]*kt,kr=Ot[9]*kt,vr=Ot[10]*kt,zr=Ot[11]*kt;for(const Yr of Mt){const li=[],ci=[];for(const _i of Yr){const hi=_i.x+jt.x,yi=_i.y+jt.y,Vi=Ot[0]*hi+Ot[4]*yi+Ot[12],Bi=Ot[1]*hi+Ot[5]*yi+Ot[13],ni=Ot[2]*hi+Ot[6]*yi+Ot[14],Fi=Ot[3]*hi+Ot[7]*yi+Ot[15],zi=Vi+Jt,Gi=Bi+yr,gn=ni+_r,yn=Math.max(Fi+Er,1e-5),fn=Vi+rr,ha=Bi+kr,Qi=ni+vr,rn=Math.max(Fi+zr,1e-5);li.push(new Xl(zi/yn,Gi/yn,gn/yn)),ci.push(new Xl(fn/rn,ha/rn,Qi/rn))}Kt.push(li),ur.push(ci)}return[Kt,ur]}(Re,Ue,$e,ct,lt)}(l,s,j,I,$,d,oe,H,V,l.center.lat,o.tileID.canonical),Ie=o.queryGeometry;return function(me,Re,Ue){let $e=1/0;at(Ue,Re)&&($e=mv(Ue,Re[0]));for(let ct=0;ct<Re.length;ct++){const lt=Re[ct],st=me[ct];for(let xt=0;xt<lt.length-1;xt++){const dt=lt[xt],Et=[dt,lt[xt+1],st[xt+1],st[xt],dt];Xe(Ue,Et)&&($e=Math.min($e,mv(Ue,Et)))}}return $e!==1/0&&$e}(ce,we,Ie.isPointQuery()?Ie.screenBounds:Ie.screenGeometry)}},line:class extends Kn{constructor(o,e,i,s){const f=Mv();super(o,f,e,i,s),f.layout&&(this.layout=new Gs(f.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof gi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,e){super.recalculate(o,e),this.paint._values["line-floorwidth"]=(()=>{if(Qh)return Qh;const i=Mv();return Qh=new MS(i.paint.properties["line-width"].specification),Qh.useIntegerZoom=!0,Qh})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new i_(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(o,e,i){const s=Tv(this);return{config:new us(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}queryRadius(o){const e=o,i=Av(zt("line-width",this,e),zt("line-gap-width",this,e)),s=zt("line-offset",this,e);return i/2+Math.abs(s)+tr(this.paint.get("line-translate"))}queryIntersectsFeature(o,e,i,s,f,l){if(o.queryGeometry.isAboveHorizon)return!1;const d=lr(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),l.angle,o.pixelToTileUnitsFactor),R=o.pixelToTileUnitsFactor/2*Av(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),N=this.paint.get("line-offset").evaluate(e,i);return N&&(s=function($,I){const j=[],H=new Ge(0,0);for(let F=0;F<$.length;F++){const V=$[F],Y=[];for(let oe=0;oe<V.length;oe++){const ce=V[oe],we=V[oe+1],Ie=oe===0?H:ce.sub(V[oe-1])._unit()._perp(),me=oe===V.length-1?H:we.sub(ce)._unit()._perp(),Re=Ie._add(me)._unit();Re._mult(1/(Re.x*me.x+Re.y*me.y)),Y.push(Re._mult(I)._add(ce))}j.push(Y)}return j}(s,N*o.pixelToTileUnitsFactor)),function($,I,j){for(let H=0;H<I.length;H++){const F=I[H];if($.length>=3){for(let V=0;V<F.length;V++)if(Tt($,F[V]))return!0}if(pt($,F,j))return!0}return!1}(d,s,R)}isTileClipped(){return!0}isDraped(o){const e=this.layout.get("line-z-offset"),i=e.isConstant()&&!e.constantOr(0),s=this.layout.get("line-elevation-reference");return!(s==="sea"||s==="ground")&&(i||s!=="none")}},symbol:fp,background:class extends Kn{constructor(o,e,i,s){super(o,{layout:cb||(cb=new on({visibility:new dr(qt.layout_background.visibility)})),paint:hb||(hb=new on({"background-pitch-alignment":new dr(qt.paint_background["background-pitch-alignment"]),"background-color":new dr(qt.paint_background["background-color"]),"background-pattern":new dr(qt.paint_background["background-pattern"]),"background-opacity":new dr(qt.paint_background["background-opacity"]),"background-emissive-strength":new dr(qt.paint_background["background-emissive-strength"]),"background-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(o,e,i){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:_b,"raster-particle":wb,sky:class extends Kn{constructor(o,e,i,s){super(o,{layout:vb||(vb=new on({visibility:new dr(qt.layout_sky.visibility)})),paint:bb||(bb=new on({"sky-type":new dr(qt.paint_sky["sky-type"]),"sky-atmosphere-sun":new dr(qt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new dr(qt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new dr(qt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new dr(qt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Co(qt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new dr(qt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new dr(qt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new dr(qt.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Hh({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(o,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),f=!s,l=o.style.light,d=l.properties.get("position");return f&&l.properties.get("anchor")==="viewport"&&St("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?S_(d.azimuthal,90-d.polar,e):S_(s[0],90-s[1],e)}const i=this.paint.get("sky-gradient-center");return S_(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}},slot:class extends Kn{constructor(o,e,i,s){super(o,{paint:xb||(xb=new on({}))},e,null)}},model:class extends Kn{constructor(o,e,i,s){super(o,{layout:Db||(Db=new on({visibility:new dr(qt.layout_model.visibility),"model-id":new Ar(qt.layout_model["model-id"])})),paint:Lb||(Lb=new on({"model-opacity":new Ar(qt.paint_model["model-opacity"]),"model-rotation":new Ar(qt.paint_model["model-rotation"]),"model-scale":new Ar(qt.paint_model["model-scale"]),"model-translation":new Ar(qt.paint_model["model-translation"]),"model-color":new Ar(qt.paint_model["model-color"]),"model-color-mix-intensity":new Ar(qt.paint_model["model-color-mix-intensity"]),"model-type":new dr(qt.paint_model["model-type"]),"model-cast-shadows":new dr(qt.paint_model["model-cast-shadows"]),"model-receive-shadows":new dr(qt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new dr(qt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Ar(qt.paint_model["model-emissive-strength"]),"model-roughness":new Ar(qt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Ar(qt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new dr(qt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new dr(qt.paint_model["model-front-cutoff"]),"model-color-use-theme":new Ar({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new I_(o)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(o){return o instanceof bp?wr-1:0}queryIntersectsFeature(o,e,i,s,f,l){if(!this.modelManager)return!1;const d=this.modelManager,R=o.tile.getBucket(this);if(!(R&&R instanceof I_))return!1;for(const N in R.instancesPerModel){const $=R.instancesPerModel[N],I=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if($.idToFeaturesIndex.hasOwnProperty(I)){const j=$.features[$.idToFeaturesIndex[I]],H=d.getModel(N,this.scope);if(!H)return!1;let F=_e.mat4.create();const V=new Ai(0,0),Y=R.canonical;let oe=Number.MAX_VALUE;for(let ce=0;ce<j.instancedDataCount;++ce){const we=16*(j.instancedDataOffset+ce),Ie=$.instancedDataArray.float32,me=[Ie[we+4],Ie[we+5],Ie[we+6]];Nb(Y,V,Ie[we],0|Ie[we+1]),Ob(F,H,l,V,j.rotation,j.scale,me,!1,!1,!1),l.projection.name==="globe"&&(F=A_(F,l));const Re=_e.mat4.multiply([],l.projMatrix,F),Ue=o.queryGeometry,$e=Ab(Ue.isPointQuery()?Ue.screenBounds:Ue.screenGeometry,l,Re,H.aabb);$e!=null&&(oe=Math.min($e,oe))}return oe!==Number.MAX_VALUE&&oe}}return!1}_handleOverridablePaintPropertyUpdate(o,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||o!=="model-color"&&o!=="model-color-mix-intensity"&&o!=="model-rotation"&&o!=="model-scale"&&o!=="model-translation"&&o!=="model-emissive-strength")}_isPropertyZoomDependent(o){const e=this._transitionablePaint._values[o];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Fs}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Kn{constructor(o,e,i,s){super(o,{layout:L1||(L1=new on({"clip-layer-types":new dr(qt.layout_clip["clip-layer-types"]),"clip-layer-scope":new dr(qt.layout_clip["clip-layer-scope"])})),paint:O1||(O1=new on({}))},e,i,s)}recalculate(o,e){super.recalculate(o,e)}createBucket(o){return new z1(o)}isTileClipped(){return!0}is3D(){return!0}}};class SM{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class MM{constructor(){this.tasks={},this.taskQueue=[],Tr(["process"],this),this.invoker=new SM(this.process),this.nextId=0}add(e,i){const s=this.nextId++,f=function({type:l,isSymbolTile:d,zoom:R}){return R=R||0,l==="message"?0:l!=="maybePrepare"||d?l!=="parseTile"||d?l==="parseTile"&&d?300-R:l==="maybePrepare"&&d?400-R:500:200-R:100-R}(i);if(f===0){try{e()}finally{}return null}return this.tasks[s]={fn:e,metadata:i,priority:f,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let f=0;f<this.taskQueue.length;f++){const l=this.tasks[this.taskQueue[f]];l.priority<i&&(i=l.priority,e=f)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class Ub{constructor(e,i,s){this.target=e,this.parent=i,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Tr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new MM}send(e,i,s,f,l=!1,d){const R=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=d,this.callbacks[R]=s);const N=new Set;return this.target.postMessage({id:R,type:e,hasCallback:!!s,targetMapId:f,mustQueue:l,sourceMapId:this.mapId,data:Ea(i,N)},N),{cancel:()=>{s&&delete this.callbacks[R],this.target.postMessage({id:R,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(e){const i=e.data,s=i.id;if(s&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const f=this.cancelCallbacks[s];delete this.cancelCallbacks[s],f&&f.cancel()}else if(i.mustQueue||$t()){const f=this.callbacks[s],l=this.scheduler.add(()=>this.processTask(s,i),f&&f.metadata||{type:"message"});l&&(this.cancelCallbacks[s]=l)}else this.processTask(s,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const s=this.callbacks[e];delete this.callbacks[e],s&&(i.error?s(is(i.error)):s(null,is(i.data)))}else{const s=new Set,f=i.hasCallback?(d,R)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:d?Ea(d):null,data:Ea(R,s)},s)}:()=>{},l=is(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,l,f);else if(this.parent.getWorkerSource){const d=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,d[0],l.source,l.scope)[d[1]](l,f)}else f(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var ff={workerUrl:"",workerClass:null,workerParams:void 0};const D_="mapboxgl_preloaded_worker_pool";class Ql{constructor(){this.active={}}acquire(e,i=Ql.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(ff.workerClass!=null?new ff.workerClass:new self.Worker(ff.workerUrl,ff.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[D_]}numActive(){return Object.keys(this.active).length}}Ql.workerCount=2;class Ac{constructor(e,i,s="Worker",f=Ql.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Or();const l=this.workerPool.acquire(this.id,f);for(let d=0;d<l.length;d++){const R=new Ac.Actor(l[d],i,this.id);R.name=`${s} ${d}`,this.actors.push(R)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,s){Ft(this.actors,(f,l)=>{f.send(e,i,l)},s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let df,L_;function xp(){return df||(df=new Ql),df}Ac.Actor=Ub;const O_=new Mi(0,0,0);var wp=(o=>(o[o.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",o[o.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",o[o.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",o))(wp||{}),Ep=(o=>(o[o.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",o[o.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",o[o.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",o[o.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",o))(Ep||{}),pf=(o=>(o[o.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",o[o.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",o[o.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",o[o.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",o[o.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",o))(pf||{}),jb=(o=>(o[o.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",o[o.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",o[o.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",o))(jb||{}),Ic=(o=>(o[o.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",o[o.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",o[o.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",o[o.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",o[o.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",o[o.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",o))(Ic||{}),Vb=(o=>(o[o.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",o[o.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",o[o.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",o))(Vb||{});function AM(o,e,i){o===1&&e.icons.push(function(s,f){return function(l){if(l.usvg_tree.height||(l.usvg_tree.height=l.usvg_tree.width),!l.metadata)return l;const{metadata:d}=l;if(d.content_area){const{content_area:R}=d;R.top==null&&(R.top=R.left),R.width==null&&(R.width=l.usvg_tree.width),R.height==null&&(R.height=R.width)}return d.stretch_x&&d.stretch_x.length&&Gb(d,"x"),d.stretch_y&&d.stretch_y.length&&Gb(d,"y"),l}(s.readFields(IM,{name:void 0},f))}(i,i.readVarint()+i.pos))}function Gb(o,e){const i=[],s=o[`stretch_${e}`];let f=null;for(let l=0;l<s.length;l++)f===null?f=i.length===0?s[0]:i[i.length-1][1]+s[l]:(i.push([f,f+s[l]]),f=null);o[`stretch_${e}_areas`]=i}function IM(o,e,i){o===1?e.name=i.readString():o===2?e.metadata=function(s,f){return s.readFields(PM,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},f)}(i,i.readVarint()+i.pos):o===3&&(e.usvg_tree=function(s,f){return s.readFields(DM,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},f)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function PM(o,e,i){o===1?e.stretch_x=i.readPackedVarint():o===2?e.stretch_y=i.readPackedVarint():o===3?e.content_area=function(s,f){return s.readFields(CM,{left:0},f)}(i,i.readVarint()+i.pos):o===4&&e.variables.push(function(s,f){return s.readFields(RM,{name:void 0},f)}(i,i.readVarint()+i.pos))}function CM(o,e,i){o===1?e.left=i.readVarint():o===2?e.width=i.readVarint():o===3?e.top=i.readVarint():o===4&&(e.height=i.readVarint())}function RM(o,e,i){o===1?e.name=i.readString():o===2&&(e.rgb_color=Mp(i.readVarint()),e.value="rgb_color")}function DM(o,e,i){o===1?e.width=e.height=i.readVarint():o===2?e.height=i.readVarint():o===3?e.children.push(Tp(i,i.readVarint()+i.pos)):o===4?e.linear_gradients.push(function(s,f){return s.readFields(NM,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},f)}(i,i.readVarint()+i.pos)):o===5?e.radial_gradients.push(function(s,f){return s.readFields(jM,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},f)}(i,i.readVarint()+i.pos)):o===7?e.clip_paths.push(function(s,f){return s.readFields(VM,{children:[]},f)}(i,i.readVarint()+i.pos)):o===8&&e.masks.push(function(s,f){const l=s.readFields(GM,{left:0,width:20,mask_type:1,children:[]},f);return l.height==null&&(l.height=l.width),l.top==null&&(l.top=l.left),l}(i,i.readVarint()+i.pos))}function Tp(o,e){return o.readFields(LM,{},e)}function LM(o,e,i){o===1?(e.group=function(s,f){return s.readFields(OM,{opacity:255,children:[]},f)}(i,i.readVarint()+i.pos),e.node="group"):o===2&&(e.path=function(s,f){return s.readFields(kM,{paint_order:1,commands:[],step:1,diffs:[],rule:1},f)}(i,i.readVarint()+i.pos),e.node="path")}function OM(o,e,i){o===1?e.transform=Sp(i,i.readVarint()+i.pos):o===2?e.opacity=i.readVarint():o===5?e.clip_path_idx=i.readVarint():o===6?e.mask_idx=i.readVarint():o===7&&e.children.push(Tp(i,i.readVarint()+i.pos))}function Sp(o,e){return o.readFields(zM,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function zM(o,e,i){o===1?e.sx=i.readFloat():o===2?e.ky=i.readFloat():o===3?e.kx=i.readFloat():o===4?e.sy=i.readFloat():o===5?e.tx=i.readFloat():o===6&&(e.ty=i.readFloat())}function kM(o,e,i){o===1?e.fill=function(s,f){return s.readFields(BM,{rgb_color:O_,paint:"rgb_color",opacity:255},f)}(i,i.readVarint()+i.pos):o===2?e.stroke=function(s,f){return s.readFields(FM,{rgb_color:O_,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},f)}(i,i.readVarint()+i.pos):o===3?e.paint_order=i.readVarint():o===5?i.readPackedVarint(e.commands):o===6?e.step=i.readFloat():o===7?i.readPackedSVarint(e.diffs):o===8&&(e.rule=i.readVarint())}function BM(o,e,i){o===1?(e.rgb_color=Mp(i.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):o===5&&(e.opacity=i.readVarint())}function Mp(o){return new Mi((o>>16&255)/255,(o>>8&255)/255,(255&o)/255,1)}function FM(o,e,i){o===1?(e.rgb_color=Mp(i.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):o===5?i.readPackedFloat(e.dasharray):o===6?e.dashoffset=i.readFloat():o===7?e.miterlimit=i.readFloat():o===8?e.opacity=i.readVarint():o===9?e.width=i.readFloat():o===10?e.linecap=i.readVarint():o===11&&(e.linejoin=i.readVarint())}function NM(o,e,i){o===1?e.transform=Sp(i,i.readVarint()+i.pos):o===2?e.spread_method=i.readVarint():o===3?e.stops.push(Hb(i,i.readVarint()+i.pos)):o===4?e.x1=i.readFloat():o===5?e.y1=i.readFloat():o===6?e.x2=i.readFloat():o===7&&(e.y2=i.readFloat())}function Hb(o,e){return o.readFields(UM,{offset:0,opacity:255,rgb_color:O_},e)}function UM(o,e,i){o===1?e.offset=i.readFloat():o===2?e.opacity=i.readVarint():o===3&&(e.rgb_color=Mp(i.readVarint()))}function jM(o,e,i){o===1?e.transform=Sp(i,i.readVarint()+i.pos):o===2?e.spread_method=i.readVarint():o===3?e.stops.push(Hb(i,i.readVarint()+i.pos)):o===4?e.cx=i.readFloat():o===5?e.cy=i.readFloat():o===6?e.r=i.readFloat():o===7?e.fx=i.readFloat():o===8?e.fy=i.readFloat():o===9&&(e.fr=i.readFloat())}function VM(o,e,i){o===1?e.transform=Sp(i,i.readVarint()+i.pos):o===2?e.clip_path_idx=i.readVarint():o===3&&e.children.push(Tp(i,i.readVarint()+i.pos))}function GM(o,e,i){o===1?e.left=e.top=i.readFloat():o===2?e.width=e.height=i.readFloat():o===3?e.top=i.readFloat():o===4?e.height=i.readFloat():o===5?e.mask_type=i.readVarint():o===6?e.mask_idx=i.readVarint():o===7&&e.children.push(Tp(i,i.readVarint()+i.pos))}class HM{static calculate(e,i){const s=new Map,f=new Map;if(Object.keys(e).length===0)return s;i.forEach(l=>{f.set(l.name,l.rgb_color||new Mi(0,0,0))});for(const[l,d]of Object.entries(e))f.has(l)?s.set(f.get(l).toStringPremultipliedAlpha(),d):console.warn(`Ignoring unknown image variable "${l}"`);return s}}function Pc(o,e=255,i){const s=e/255,f=o.toStringPremultipliedAlpha(),l=i.has(f)?i.get(f).clone():o.clone();return l.a=s,l.toString()}function z_(o,e){if(!Yt()){const i=document.createElement("canvas");return i.width=o,i.height=e,i}return new OffscreenCanvas(o,e)}function qM(o,e){const i=HM.calculate(e.params,o.metadata?o.metadata.variables:[]),s=o.usvg_tree,f=s.width,l=s.height,d=e.transform?e.transform:new DOMMatrix,R=Math.max(1,Math.round(f*d.a)),N=Math.max(1,Math.round(l*d.d)),$=new DOMMatrix([R/f,0,0,N/l,0,0]),I=z_(R,N).getContext("2d");return k_(I,$,s,s,i),I.getImageData(0,0,R,N)}function k_(o,e,i,s,f){for(const l of s.children)qb(o,e,i,l,f)}function qb(o,e,i,s,f){s.group?(o.save(),function(l,d,R,N,$){const I=N.mask_idx!=null?R.masks[N.mask_idx]:null,j=N.clip_path_idx!=null?R.clip_paths[N.clip_path_idx]:null;if(N.transform&&(d=mf(N.transform).preMultiplySelf(d)),!function(V,Y,oe){return V.opacity!==255||Y||oe}(N,j!=null,I!=null))return void k_(l,d,R,N,$);const H=z_(l.canvas.width,l.canvas.height),F=H.getContext("2d");j&&Yb(F,d,R,j),k_(F,d,R,N,$),I&&Kb(F,d,R,I,$),l.globalAlpha=N.opacity/255,l.drawImage(H,0,0)}(o,e,i,s.group,f),o.restore()):s.path&&(o.save(),function(l,d,R,N,$){const I=Jb(N);l.setTransform(d),N.paint_order===jb.PAINT_ORDER_FILL_AND_STROKE?(Wb(l,R,N,I,$),$b(l,R,N,I,$)):($b(l,R,N,I,$),Wb(l,R,N,I,$))}(o,e,i,s.path,f),o.restore())}function Wb(o,e,i,s,f){const l=i.fill;if(!l)return;const d=l.opacity/255;switch(l.paint){case"rgb_color":o.fillStyle=Pc(l.rgb_color,l.opacity,f);break;case"linear_gradient_idx":o.fillStyle=Zb(o,e.linear_gradients[l.linear_gradient_idx],d,f);break;case"radial_gradient_idx":o.fillStyle=Xb(o,e.radial_gradients[l.radial_gradient_idx],d,f)}let R;switch(i.rule){case wp.PATH_RULE_NON_ZERO:R="nonzero";break;case wp.PATH_RULE_EVEN_ODD:R="evenodd"}o.fill(s,R)}function $b(o,e,i,s,f){const l=i.stroke;if(!l)return;o.lineWidth=l.width,o.miterLimit=l.miterlimit,o.setLineDash(l.dasharray),o.lineDashOffset=l.dashoffset;const d=l.opacity/255;switch(l.paint){case"rgb_color":o.strokeStyle=Pc(l.rgb_color,l.opacity,f);break;case"linear_gradient_idx":o.strokeStyle=Zb(o,e.linear_gradients[l.linear_gradient_idx],d,f);break;case"radial_gradient_idx":o.strokeStyle=Xb(o,e.radial_gradients[l.radial_gradient_idx],d,f)}switch(l.linejoin){case pf.LINE_JOIN_MITER_CLIP:case pf.LINE_JOIN_MITER:o.lineJoin="miter";break;case pf.LINE_JOIN_ROUND:o.lineJoin="round";break;case pf.LINE_JOIN_BEVEL:o.lineJoin="bevel"}switch(l.linecap){case Ep.LINE_CAP_BUTT:o.lineCap="butt";break;case Ep.LINE_CAP_ROUND:o.lineCap="round";break;case Ep.LINE_CAP_SQUARE:o.lineCap="square"}o.stroke(s)}function Zb(o,e,i,s){if(e.stops.length===1){const H=e.stops[0];return Pc(H.rgb_color,H.opacity*i,s)}const f=mf(e.transform),{x1:l,y1:d,x2:R,y2:N}=e,$=f.transformPoint(new DOMPoint(l,d)),I=f.transformPoint(new DOMPoint(R,N)),j=o.createLinearGradient($.x,$.y,I.x,I.y);for(const H of e.stops)j.addColorStop(H.offset,Pc(H.rgb_color,H.opacity*i,s));return j}function Xb(o,e,i,s){if(e.stops.length===1){const H=e.stops[0];return Pc(H.rgb_color,H.opacity*i,s)}const f=mf(e.transform),{fx:l,fy:d,cx:R,cy:N}=e,$=f.transformPoint(new DOMPoint(l,d)),I=f.transformPoint(new DOMPoint(R,N)),j=o.createRadialGradient($.x,$.y,0,I.x,I.y,e.r*((f.a+f.d)/2));for(const H of e.stops)j.addColorStop(H.offset,Pc(H.rgb_color,H.opacity*i,s));return j}function Yb(o,e,i,s){const f=mf(s.transform).preMultiplySelf(e),l=s.clip_path_idx!=null?i.clip_paths[s.clip_path_idx]:null;l&&Yb(o,f,i,l);const d=new Path2D;let R;function N($,I){if($.path){const j=$.path;d.addPath(Jb(j),I),j.rule===wp.PATH_RULE_EVEN_ODD&&(R="evenodd")}else if($.group){const j=$.group.transform?mf($.group.transform).preMultiplySelf(I):I;for(const H of $.group.children)N(H,j)}}for(const $ of s.children)N($,f);o.clip(d,R)}function Kb(o,e,i,s,f){if(s.children.length===0)return;const l=s.mask_idx!=null?i.masks[s.mask_idx]:null;l&&Kb(o,e,i,l,f);const d=o.canvas.width,R=o.canvas.height,N=z_(d,R),$=N.getContext("2d"),I=s.width,j=s.height,H=s.left,F=s.top,V=new Path2D,Y=new Path2D;Y.rect(H,F,I,j),V.addPath(Y,e),$.clip(V);for(const we of s.children)qb($,e,i,we,f);const oe=$.getImageData(0,0,d,R),ce=oe.data;if(s.mask_type===Vb.MASK_TYPE_LUMINANCE)for(let we=0;we<ce.length;we+=4)ce[we+3]=ce[we+3]/255*(.2126*ce[we]+.7152*ce[we+1]+.0722*ce[we+2]);$.putImageData(oe,0,0),o.globalCompositeOperation="destination-in",o.drawImage(N,0,0)}function mf(o){return o?new DOMMatrix([o.sx,o.ky,o.kx,o.sy,o.tx,o.ty]):new DOMMatrix}function Jb(o){const e=new Path2D,i=o.step;let s=o.diffs[0]*i,f=o.diffs[1]*i;e.moveTo(s,f);for(let l=0,d=2;l<o.commands.length;l++)switch(o.commands[l]){case Ic.PATH_COMMAND_MOVE:s+=o.diffs[d++]*i,f+=o.diffs[d++]*i,e.moveTo(s,f);break;case Ic.PATH_COMMAND_LINE:s+=o.diffs[d++]*i,f+=o.diffs[d++]*i,e.lineTo(s,f);break;case Ic.PATH_COMMAND_QUAD:{const R=s+o.diffs[d++]*i,N=f+o.diffs[d++]*i;s=R+o.diffs[d++]*i,f=N+o.diffs[d++]*i,e.quadraticCurveTo(R,N,s,f);break}case Ic.PATH_COMMAND_CUBIC:{const R=s+o.diffs[d++]*i,N=f+o.diffs[d++]*i,$=R+o.diffs[d++]*i,I=N+o.diffs[d++]*i;s=$+o.diffs[d++]*i,f=I+o.diffs[d++]*i,e.bezierCurveTo(R,N,$,I,s,f);break}case Ic.PATH_COMMAND_CLOSE:e.closePath()}return e}class B_{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}class F_{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Xn(e,e.data)}getFromCache(e,i,s){return this.cacheMap.has(s)||this.cacheMap.set(s,new B_(150)),this.cacheMap.get(s).get(Ba(e.serialize(),i))}setInCache(e,i,s,f){this.cacheDependenciesMap.has(f)||this.cacheDependenciesMap.set(f,new Map),this.cacheMap.has(f)||this.cacheMap.set(f,new B_(150));const l=this.cacheDependenciesMap.get(f);l.get(Ba(e.id,s))||l.set(Ba(e.id,s),new Set);const d=this.cacheMap.get(f),R=e.serialize();l.get(Ba(e.id,s)).add(R),d.put(Ba(e.serialize(),s),i)}removeImagesFromCacheByIds(e,i,s=""){if(!this.cacheMap.has(s)||!this.cacheDependenciesMap.has(s))return;const f=this.cacheMap.get(s),l=this.cacheDependenciesMap.get(s);for(const d of e)if(l.has(Ba(d,i))){for(const R of l.get(Ba(d,i)))f.delete(R);l.delete(Ba(d,i))}}rasterize(e,i,s,f,l=qM){const d=this.getFromCache(e,s,f);if(d)return d.clone();const R=l(i.icon,e.options),N=F_._getImage(R);return this.setInCache(e,N,s,f),N.clone()}}class Qb{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const s=this.toIdx(e,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function ex(o,e,i,s){let f=0,l=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(s[d])<1e-15){if(i[d]<o[d]||i[d]>e[d])return null}else{const R=1/s[d];let N=(o[d]-i[d])*R,$=(e[d]-i[d])*R;if(N>$){const I=N;N=$,$=I}if(N>f&&(f=N),$<l&&(l=$),f>l)return null}return f}function tx(o,e,i,s,f,l,d,R,N,$,I){const j=s-o,H=f-e,F=l-i,V=d-o,Y=R-e,oe=N-i,ce=I[1]*oe-I[2]*Y,we=I[2]*V-I[0]*oe,Ie=I[0]*Y-I[1]*V,me=j*ce+H*we+F*Ie;if(Math.abs(me)<1e-15)return null;const Re=1/me,Ue=$[0]-o,$e=$[1]-e,ct=$[2]-i,lt=(Ue*ce+$e*we+ct*Ie)*Re;if(lt<0||lt>1)return null;const st=$e*F-ct*H,xt=ct*j-Ue*F,dt=Ue*H-$e*j,Et=(I[0]*st+I[1]*xt+I[2]*dt)*Re;return Et<0||lt+Et>1?null:(V*st+Y*xt+oe*dt)*Re}function rx(o,e,i){return(o-e)/(i-e)}function ix(o,e,i,s,f,l,d,R,N){const $=1<<i,I=l-s,j=d-f,H=(o+1)/$*I+s,F=(e+0)/$*j+f,V=(e+1)/$*j+f;R[0]=(o+0)/$*I+s,R[1]=F,N[0]=H,N[1]=V}class nx{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(l){const d=Math.ceil(Math.log2(l.dim/8)),R=[];let N=Math.ceil(Math.pow(2,d));const $=1/N,I=(F,V,Y,oe,ce)=>{const we=oe?1:0,Ie=(F+1)*Y-we,me=V*Y,Re=(V+1)*Y-we;ce[0]=F*Y,ce[1]=me,ce[2]=Ie,ce[3]=Re};let j=new Qb(N);const H=[];for(let F=0;F<N*N;F++){I(F%N,Math.floor(F/N),$,!1,H);const V=rl(H[0],H[1],l),Y=rl(H[2],H[1],l),oe=rl(H[2],H[3],l),ce=rl(H[0],H[3],l);j.minimums.push(Math.min(V,Y,oe,ce)),j.maximums.push(Math.max(V,Y,oe,ce)),j.leaves.push(1)}for(R.push(j),N/=2;N>=1;N/=2){const F=R[R.length-1];j=new Qb(N);for(let V=0;V<N*N;V++){I(V%N,Math.floor(V/N),2,!0,H);const Y=F.getElevation(H[0],H[1]),oe=F.getElevation(H[2],H[1]),ce=F.getElevation(H[2],H[3]),we=F.getElevation(H[0],H[3]),Ie=F.isLeaf(H[0],H[1]),me=F.isLeaf(H[2],H[1]),Re=F.isLeaf(H[2],H[3]),Ue=F.isLeaf(H[0],H[3]),$e=Math.min(Y.min,oe.min,ce.min,we.min),ct=Math.max(Y.max,oe.max,ce.max,we.max),lt=Ie&&me&&Re&&Ue;j.maximums.push(ct),j.minimums.push($e),j.leaves.push(ct-$e<=5&&lt?1:0)}R.push(j)}return R}(this.dem),s=i.length-1,f=i[s];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(e,i,s,f,l,d,R=1){return ex([e,i,-100],[s,f,this.maximums[0]*R],l,d)}raycast(e,i,s,f,l,d,R=1){if(!this.nodeCount)return null;const N=this.raycastRoot(e,i,s,f,l,d,R);if(N==null)return null;const $=[],I=[],j=[],H=[],F=[{idx:0,t:N,nodex:0,nodey:0,depth:0}];for(;F.length>0;){const{idx:V,t:Y,nodex:oe,nodey:ce,depth:we}=F.pop();if(this.leaves[V]){ix(oe,ce,we,e,i,s,f,j,H);const me=1<<we,Re=(oe+0)/me,Ue=(oe+1)/me,$e=(ce+0)/me,ct=(ce+1)/me,lt=rl(Re,$e,this.dem)*R,st=rl(Ue,$e,this.dem)*R,xt=rl(Ue,ct,this.dem)*R,dt=rl(Re,ct,this.dem)*R,Et=tx(j[0],j[1],lt,H[0],j[1],st,H[0],H[1],xt,l,d),It=tx(H[0],H[1],xt,j[0],H[1],dt,j[0],j[1],lt,l,d),Mt=Math.min(Et!==null?Et:Number.MAX_VALUE,It!==null?It:Number.MAX_VALUE);if(Mt!==Number.MAX_VALUE)return Mt;{const Ct=_e.vec3.scaleAndAdd([],l,d,Y);if(ax(lt,st,dt,xt,rx(Ct[0],j[0],H[0]),rx(Ct[1],j[1],H[1]))>=Ct[2])return Y}continue}let Ie=0;for(let me=0;me<this._siblingOffset.length;me++){ix((oe<<1)+this._siblingOffset[me][0],(ce<<1)+this._siblingOffset[me][1],we+1,e,i,s,f,j,H),j[2]=-100,H[2]=this.maximums[this.childOffsets[V]+me]*R;const Re=ex(j,H,l,d);if(Re!=null){const Ue=Re;$[me]=Ue;let $e=!1;for(let ct=0;ct<Ie&&!$e;ct++)Ue>=$[I[ct]]&&(I.splice(ct,0,me),$e=!0);$e||(I[Ie]=me),Ie++}}for(let me=0;me<Ie;me++){const Re=I[me];F.push({idx:this.childOffsets[V]+Re,t:$[Re],nodex:(oe<<1)+this._siblingOffset[Re][0],nodey:(ce<<1)+this._siblingOffset[Re][1],depth:we+1})}}return null}_addNode(e,i,s){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,s,f,l){if(e[f].isLeaf(i,s)===1)return;this.childOffsets[l]||(this.childOffsets[l]=this.nodeCount);const d=f-1,R=e[d];let N=0,$=0;for(let I=0;I<this._siblingOffset.length;I++){const j=2*i+this._siblingOffset[I][0],H=2*s+this._siblingOffset[I][1],F=R.getElevation(j,H),V=R.isLeaf(j,H),Y=this._addNode(F.min,F.max,V);V&&(N|=1<<I),$||($=Y)}for(let I=0;I<this._siblingOffset.length;I++)N&1<<I||this._construct(e,2*i+this._siblingOffset[I][0],2*s+this._siblingOffset[I][1],d,$+I)}}function ax(o,e,i,s,f,l){return Qr(Qr(o,i,l),Qr(e,s,l),f)}function rl(o,e,i){const s=i.dim,f=le(o*s-.5,0,s-1),l=le(e*s-.5,0,s-1),d=Math.floor(f),R=Math.floor(l),N=Math.min(d+1,s-1),$=Math.min(R+1,s-1);return ax(i.get(d,R),i.get(N,R),i.get(d,$),i.get(N,$),f-d,l-R)}const WM={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function $M(o,e,i){return(256*o*256+256*e+i)/10-1e4}function ZM(o,e,i){return 256*o+e+i/256-32768}class Ap{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,s,f=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void St(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const l=this.dim=i.height-2,d=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=f,this._modifiedForSources={},!f){for(let N=0;N<l;N++)d[this._idx(-1,N)]=d[this._idx(0,N)],d[this._idx(l,N)]=d[this._idx(l-1,N)],d[this._idx(N,-1)]=d[this._idx(N,0)],d[this._idx(N,l)]=d[this._idx(N,l-1)];d[this._idx(-1,-1)]=d[this._idx(0,0)],d[this._idx(l,-1)]=d[this._idx(l-1,0)],d[this._idx(-1,l)]=d[this._idx(0,l-1)],d[this._idx(l,l)]=d[this._idx(l-1,l-1)]}const R=s==="terrarium"?ZM:$M;for(let N=0;N<d.length;++N){const $=4*N;this.floatView[N]=R(this.pixels[$],this.pixels[$+1],this.pixels[$+2])}this._timestamp=cr.now()}_buildQuadTree(){this._tree=new nx(this)}get(e,i,s=!1){s&&(e=le(e,-1,this.dim),i=le(i,-1,this.dim));const f=this._idx(e,i);return this.floatView[f]}set(e,i,s){const f=this._idx(e,i),l=this.floatView[f];return this.floatView[f]=s,s-l}static getUnpackVector(e){return WM[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const s=[0,0,0,0],f=Ap.getUnpackVector(i);let l=Math.floor((e+f[3])/f[2]);return s[2]=l%256,l=Math.floor(l/256),s[1]=l%256,l=Math.floor(l/256),s[0]=l,s}getPixels(){return new S1({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let f=i*this.dim,l=i*this.dim+this.dim,d=s*this.dim,R=s*this.dim+this.dim;switch(i){case-1:f=l-1;break;case 1:l=f+1}switch(s){case-1:d=R-1;break;case 1:R=d+1}const N=-i*this.dim,$=-s*this.dim;for(let I=d;I<R;I++)for(let j=f;j<l;j++){const H=4*this._idx(j,I),F=4*this._idx(j+N,I+$);this.pixels[H+0]=e.pixels[F+0],this.pixels[H+1]=e.pixels[F+1],this.pixels[H+2]=e.pixels[F+2],this.pixels[H+3]=e.pixels[F+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function XM(o,e,i){o===1?e.headerLength=i.readFixed32():o===2?e.x=i.readVarint():o===3?e.y=i.readVarint():o===4?e.z=i.readVarint():o===5&&e.layers.push(function(s,f){return s.readFields(eA,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},f)}(i,i.readVarint()+i.pos))}function YM(o,e,i){o===1?(e.delta_filter=function(s,f){return s.readFields(KM,{blockSize:0},f)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):o===2?(i.readVarint(),e.filter="zigzag_filter"):o===3?(i.readVarint(),e.filter="bitshuffle_filter"):o===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function KM(o,e,i){o===1&&(e.blockSize=i.readVarint())}function JM(o,e,i){o===1?(i.readVarint(),e.codec="gzip_data"):o===2?(i.readVarint(),e.codec="jpeg_image"):o===3?(i.readVarint(),e.codec="webp_image"):o===4&&(i.readVarint(),e.codec="png_image")}function QM(o,e,i){let s=0,f=0;o===1?e.firstByte=i.readFixed64():o===2?e.lastByte=i.readFixed64():o===3?e.filters.push(function(l,d){return l.readFields(YM,{},d)}(i,i.readVarint()+i.pos)):o===4?e.codec=function(l,d){return l.readFields(JM,{},d)}(i,i.readVarint()+i.pos):o===5?f=i.readFloat():o===6?s=i.readFloat():o===7?e.bands.push(i.readString()):o===8?e.offset=i.readDouble():o===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=f),e.scale===0&&(e.scale=s)}function eA(o,e,i){o===1?e.version=i.readVarint():o===2?e.name=i.readString():o===3?e.units=i.readString():o===4?e.tileSize=i.readVarint():o===5?e.buffer=i.readVarint():o===6?e.pixelFormat=i.readVarint():o===7&&e.dataIndex.push(function(s,f){return s.readFields(QM,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},f)}(i,i.readVarint()+i.pos))}function tA(o,e,i){if(o===2)(function(s,f,l){s.readFields(rA,l,f)})(i,i.readVarint()+i.pos,e);else if(o===3)throw new Error("Not implemented")}function rA(o,e,i){if(o===1){let s=0;const f=i.readVarint()+i.pos;for(;i.pos<f;)e[s++]=i.readVarint()}}function iA(o,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let s=2;s>=1;s--){const f=s===1?1:0,l=s===2?1:0;for(let d=0;d<e[0];d++){const R=e[1]*d;for(let N=f;N<e[1];N++){const $=e[2]*(N+R);for(let I=l;I<e[2];I++){const j=e[3]*(I+$);for(let H=0;H<e[3];H++){const F=j+H;o[F]+=o[F-i]}}}}i*=e[s]}return o}function nA(o){for(let e=0,i=o.length;e<i;e++)o[e]=o[e]>>>1^-(1&o[e]);return o}function aA(o,e){switch(e){case"uint32":return o;case"uint16":for(let i=0;i<o.length;i+=2){const s=o[i],f=o[i+1];o[i]=(240&s)>>4|(61440&s)>>8|(240&f)<<4|61440&f,o[i+1]=15&s|(3840&s)>>4|(15&f)<<8|(3840&f)<<4}return o;case"uint8":for(let i=0;i<o.length;i+=4){const s=o[i],f=o[i+1],l=o[i+2],d=o[i+3];o[i+0]=(192&s)>>6|(192&f)>>4|(192&l)>>2|192&d,o[i+1]=(48&s)>>4|(48&f)>>2|48&l|(48&d)<<2,o[i+2]=(12&s)>>2|12&f|(12&l)<<2|(12&d)<<4,o[i+3]=3&s|(3&f)<<2|(3&l)<<4|(3&d)<<6}return o;default:throw new Error(`Invalid pixel format, "${e}"`)}}Dr(Ap,"DEMData"),Dr(nx,"DemMinMaxQuadTree",{omit:["dem"]});var Ga=Uint8Array,_f=Uint16Array,oA=Int32Array,ox=new Ga([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),sx=new Ga([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),sA=new Ga([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),lx=function(o,e){for(var i=new _f(31),s=0;s<31;++s)i[s]=e+=1<<o[s-1];var f=new oA(i[30]);for(s=1;s<30;++s)for(var l=i[s];l<i[s+1];++l)f[l]=l-i[s]<<5|s;return{b:i,r:f}},ux=lx(ox,2),cx=ux.b,lA=ux.r;cx[28]=258,lA[258]=28;for(var uA=lx(sx,0).b,hx=new _f(32768),_n=0;_n<32768;++_n){var Cc=(43690&_n)>>1|(21845&_n)<<1;hx[_n]=((65280&(Cc=(61680&(Cc=(52428&Cc)>>2|(13107&Cc)<<2))>>4|(3855&Cc)<<4))>>8|(255&Cc)<<8)>>1}var gf=function(o,e,i){for(var s=o.length,f=0,l=new _f(e);f<s;++f)o[f]&&++l[o[f]-1];var d,R=new _f(e);for(f=1;f<e;++f)R[f]=R[f-1]+l[f-1]<<1;d=new _f(1<<e);var N=15-e;for(f=0;f<s;++f)if(o[f])for(var $=f<<4|o[f],I=e-o[f],j=R[o[f]-1]++<<I,H=j|(1<<I)-1;j<=H;++j)d[hx[j]>>N]=$;return d},yf=new Ga(288);for(_n=0;_n<144;++_n)yf[_n]=8;for(_n=144;_n<256;++_n)yf[_n]=9;for(_n=256;_n<280;++_n)yf[_n]=7;for(_n=280;_n<288;++_n)yf[_n]=8;var fx=new Ga(32);for(_n=0;_n<32;++_n)fx[_n]=5;var cA=gf(yf,9),hA=gf(fx,5),N_=function(o){for(var e=o[0],i=1;i<o.length;++i)o[i]>e&&(e=o[i]);return e},bo=function(o,e,i){var s=e/8|0;return(o[s]|o[s+1]<<8)>>(7&e)&i},U_=function(o,e){var i=e/8|0;return(o[i]|o[i+1]<<8|o[i+2]<<16)>>(7&e)},fA=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],xo=function(o,e,i){var s=new Error(e||fA[o]);if(s.code=o,Error.captureStackTrace&&Error.captureStackTrace(s,xo),!i)throw s;return s},dA=new Ga(0),pA=typeof TextDecoder<"u"&&new TextDecoder;try{pA.decode(dA,{stream:!0})}catch{}const mA={gzip_data:"gzip"};class Ja extends Error{constructor(e){super(e),this.name="MRTError"}}const _A={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},dx={uint32:1,uint16:2,uint8:4},gA={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let j_;class V_{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new Ja(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),s=new DataView(e);if(i[0]!==13)throw new Ja("File is not a valid MRT.");return s.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),s=this.getHeaderLength(e);if(i.length<s)throw new Ja(`Expected header with length >= ${s} but got buffer of length ${i.length}`);const f=function(l,d){return l.readFields(XM,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new j_(i.subarray(0,s)));if(!isNaN(this.x)&&(this.x!==f.x||this.y!==f.y||this.z!==f.z))throw new Ja(`Invalid attempt to parse header ${f.z}/${f.x}/${f.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=f.x,this.y=f.y,this.z=f.z;for(const l of f.layers)this.layers[l.name]=new yA(l,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],s=this.getLayer(e.layerName);for(let f of e.blockIndices){const l=s.dataIndex[f],d=l.firstByte-e.firstByte,R=l.lastByte-e.firstByte;if(s._blocksInProgress.has(f))continue;const N={layerName:s.name,firstByte:d,lastByte:R,pixelFormat:s.pixelFormat,blockIndex:f,blockShape:[l.bands.length].concat(s.bandShape),buffer:s.buffer,codec:l.codec.codec,filters:l.filters.map($=>$.filter)};s._blocksInProgress.add(f),i.push(N)}return new px(i,()=>{i.forEach(f=>s._blocksInProgress.delete(f.blockIndex))},(f,l)=>{if(i.forEach(d=>s._blocksInProgress.delete(d.blockIndex)),f)throw f;l.forEach(d=>{this.getLayer(d.layerName).processDecodedData(d)})})}}class yA{constructor({version:e,name:i,units:s,tileSize:f,pixelFormat:l,buffer:d,dataIndex:R},N){if(this.version=e,this.version!==1)throw new Ja(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=s,this.tileSize=f,this.buffer=d,this.pixelFormat=_A[l],this.dataIndex=R,this.bandShape=[f+2*d,f+2*d,dx[this.pixelFormat]],this._decodedBlocks=new B_(N?N.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return dx[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[s,f]of this.dataIndex.entries()){for(const[l,d]of f.bands.entries())if(d===e)return{bandIndex:i+l,blockIndex:s,blockBandIndex:l};i+=f.bands.length}break;case"number":for(const[s,f]of this.dataIndex.entries()){if(e>=i&&e<i+f.bands.length)return{bandIndex:e,blockIndex:s,blockBandIndex:e-i};i+=f.bands.length}break;default:throw new Ja(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Ja(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,s=-1/0;const f=[],l=new Set;for(const d of e){const{blockIndex:R}=this.getBlockForBand(d);if(R<0)throw new Ja(`Invalid band: ${JSON.stringify(d)}`);const N=this.dataIndex[R];f.includes(R)||f.push(R),l.add(R),i=Math.min(i,N.firstByte),s=Math.max(s,N.lastByte)}if(l.size>this.cacheSize)throw new Ja(`Number of blocks to decode (${l.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:s,blockIndices:f}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:s}=this.getBlockForBand(e),f=this._decodedBlocks.get(i.toString());if(!f)throw new Ja(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const l=this.dataIndex[i],d=this.bandShape.reduce(($,I)=>$*I,1),R=s*d,N=f.subarray(R,R+d);return{data:N,bytes:new Uint8Array(N.buffer).subarray(N.byteOffset,N.byteOffset+N.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:l.offset,scale:l.scale}}}V_.setPbf=function(o){j_=o};class px{constructor(e,i,s){this.tasks=e,this._onCancel=i,this._onComplete=s,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}V_.performDecoding=function(o,e){const i=new Uint8Array(o);return Promise.all(e.tasks.map(s=>{const{layerName:f,firstByte:l,lastByte:d,pixelFormat:R,blockShape:N,blockIndex:$,filters:I,codec:j}=s,H=i.subarray(l,d+1),F=new Uint32Array(N[0]*N[1]*N[2]);let V;if(j!=="gzip_data")throw new Ja(`Unhandled codec: ${j}`);return V=function(Y,oe){if(!globalThis.DecompressionStream&&oe==="gzip_data")return Promise.resolve(((me=function($e){$e[0]==31&&$e[1]==139&&$e[2]==8||xo(6,"invalid gzip data");var ct=$e[3],lt=10;4&ct&&(lt+=2+($e[10]|$e[11]<<8));for(var st=(ct>>3&1)+(ct>>4&1);st>0;st-=!$e[lt++]);return lt+(2&ct)}(Ie=Y))+8>Ie.length&&xo(6,"invalid gzip data"),function($e,ct,lt,st){var xt=$e.length;if(!xt||ct.f&&!ct.l)return lt||new Ga(0);var dt=!lt,Et=dt||ct.i!=2,It=ct.i;dt&&(lt=new Ga(3*xt));var Mt,Ct,kt=function(ds){var al=lt.length;if(ds>al){var ol=new Ga(Math.max(2*al,ds));ol.set(lt),lt=ol}},jt=ct.f||0,Ot=ct.p||0,Kt=ct.b||0,ur=ct.l,Jt=ct.d,yr=ct.m,_r=ct.n,Er=8*xt;do{if(!ur){jt=bo($e,Ot,1);var rr=bo($e,Ot+1,3);if(Ot+=3,!rr){var kr=$e[(ni=4+((Ot+7)/8|0))-4]|$e[ni-3]<<8,vr=ni+kr;if(vr>xt){It&&xo(0);break}Et&&kt(Kt+kr),lt.set($e.subarray(ni,vr),Kt),ct.b=Kt+=kr,ct.p=Ot=8*vr,ct.f=jt;continue}if(rr==1)ur=cA,Jt=hA,yr=9,_r=5;else if(rr==2){var zr=bo($e,Ot,31)+257,Yr=bo($e,Ot+10,15)+4,li=zr+bo($e,Ot+5,31)+1;Ot+=14;for(var ci=new Ga(li),_i=new Ga(19),hi=0;hi<Yr;++hi)_i[sA[hi]]=bo($e,Ot+3*hi,7);Ot+=3*Yr;var yi=N_(_i),Vi=(1<<yi)-1,Bi=gf(_i,yi);for(hi=0;hi<li;){var ni,Fi=Bi[bo($e,Ot,Vi)];if(Ot+=15&Fi,(ni=Fi>>4)<16)ci[hi++]=ni;else{var zi=0,Gi=0;for(ni==16?(Gi=3+bo($e,Ot,3),Ot+=2,zi=ci[hi-1]):ni==17?(Gi=3+bo($e,Ot,7),Ot+=3):ni==18&&(Gi=11+bo($e,Ot,127),Ot+=7);Gi--;)ci[hi++]=zi}}var gn=ci.subarray(0,zr),yn=ci.subarray(zr);yr=N_(gn),_r=N_(yn),ur=gf(gn,yr),Jt=gf(yn,_r)}else xo(1);if(Ot>Er){It&&xo(0);break}}Et&&kt(Kt+131072);for(var fn=(1<<yr)-1,ha=(1<<_r)-1,Qi=Ot;;Qi=Ot){var rn=(zi=ur[U_($e,Ot)&fn])>>4;if((Ot+=15&zi)>Er){It&&xo(0);break}if(zi||xo(2),rn<256)lt[Kt++]=rn;else{if(rn==256){Qi=Ot,ur=null;break}var Jn=rn-254;rn>264&&(Jn=bo($e,Ot,(1<<(Sn=ox[hi=rn-257]))-1)+cx[hi],Ot+=Sn);var vn=Jt[U_($e,Ot)&ha],_a=vn>>4;if(vn||xo(3),Ot+=15&vn,yn=uA[_a],_a>3){var Sn=sx[_a];yn+=U_($e,Ot)&(1<<Sn)-1,Ot+=Sn}if(Ot>Er){It&&xo(0);break}Et&&kt(Kt+131072);var jo=Kt+Jn;if(Kt<yn){var il=0-yn,nl=Math.min(yn,jo);for(il+Kt<0&&xo(3);Kt<nl;++Kt)lt[Kt]=(void 0)[il+Kt]}for(;Kt<jo;++Kt)lt[Kt]=lt[Kt-yn]}}ct.l=ur,ct.p=Qi,ct.b=Kt,ct.f=jt,ur&&(jt=1,ct.m=yr,ct.d=Jt,ct.n=_r)}while(!jt);return Kt!=lt.length&&dt?(Mt=lt,((Ct=Kt)==null||Ct>Mt.length)&&(Ct=Mt.length),new Ga(Mt.subarray(0,Ct))):lt.subarray(0,Kt)}(Ie.subarray(me,-8),{i:2},new Ga(((ce=Ie)[(we=ce.length)-4]|ce[we-3]<<8|ce[we-2]<<16|ce[we-1]<<24)>>>0))));var ce,we,Ie,me;const Re=mA[oe];if(!Re)throw new Error(`Unhandled codec: ${oe}`);const Ue=new globalThis.DecompressionStream(Re);return new Response(new Blob([Y]).stream().pipeThrough(Ue)).arrayBuffer().then($e=>new Uint8Array($e))}(H,j).then(Y=>(function(oe,ce){oe.readFields(tA,ce)}(new j_(Y),F),new gA[R](F.buffer))),V.then(Y=>{for(let oe=I.length-1;oe>=0;oe--)switch(I[oe]){case"delta_filter":iA(Y,N);break;case"zigzag_filter":nA(Y);break;case"bitshuffle_filter":aA(Y,R);break;default:throw new Ja(`Unhandled filter "${I[oe]}"`)}return{layerName:f,blockIndex:$,data:Y}}).catch(Y=>{throw Y})}))},Dr(px,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let vf,G_,wo,Rc,H_,Dc=null;function mx(){return $t()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:G_||Q.DRACO_URL}function _x(){if($t()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Rc)return Rc;const o=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Rc=WebAssembly.validate(o)?Q.MESHOPT_SIMD_URL:Q.MESHOPT_URL,Rc}const Ip={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},vA={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},bf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function gx(o,e,i){const s=i.json.bufferViews.length,f=i.buffers.length;e.bufferView=s,i.json.bufferViews[s]={buffer:f,byteLength:o.byteLength},i.buffers[f]=o}const q_="KHR_draco_mesh_compression";function bA(o,e){const i=o.extensions&&o.extensions[q_];if(!i)return;const s=new wo.Decoder,f=xx(e,i.bufferView),l=new wo.Mesh;if(!s.DecodeArrayToMesh(f,f.byteLength,l))throw new Error("Failed to decode Draco mesh");const d=e.json.accessors[o.indices],R=Ip[d.componentType],N=d.count*R.BYTES_PER_ELEMENT,$=wo._malloc(N);R===Uint16Array?s.GetTrianglesUInt16Array(l,N,$):s.GetTrianglesUInt32Array(l,N,$),gx(wo.memory.buffer.slice($,$+N),d,e),wo._free($);for(const I of Object.keys(i.attributes)){const j=s.GetAttributeByUniqueId(l,i.attributes[I]),H=e.json.accessors[o.attributes[I]],F=vA[H.componentType],V=H.count*bf[H.type]*Ip[H.componentType].BYTES_PER_ELEMENT,Y=wo._malloc(V);s.GetAttributeDataArrayForAllPoints(l,j,wo[F],V,Y),gx(wo.memory.buffer.slice(Y,Y+V),H,e),wo._free(Y)}s.destroy(),l.destroy(),delete o.extensions[q_]}const Pp="EXT_meshopt_compression";function xA(o,e){if(!o.extensions||!o.extensions[Pp])return;const i=o.extensions[Pp],s=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),f=new Uint8Array(i.count*i.byteStride);H_.decodeGltfBuffer(f,i.count,i.byteStride,s,i.mode,i.filter),o.buffer=e.buffers.length,o.byteOffset=0,e.buffers[o.buffer]=f.buffer,delete o.extensions[Pp]}const yx=1179937895,vx=new TextDecoder("utf8");function bx(o,e){return new URL(o,e).href}function wA(o,e,i,s){return fetch(bx(o.uri,s)).then(f=>f.arrayBuffer()).then(f=>{e.buffers[i]=f})}function xx(o,e){const i=o.json.bufferViews[e];return new Uint8Array(o.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function EA(o,e,i,s){if(o.uri){const f=bx(o.uri,s);return fetch(f).then(l=>l.blob()).then(l=>createImageBitmap(l)).then(l=>{e.images[i]=l})}if(o.bufferView!==void 0){const f=xx(e,o.bufferView),l=new Blob([f],{type:o.mimeType});return createImageBitmap(l).then(d=>{e.images[i]=d})}}function wx(o,e=0,i){const s={json:null,images:[],buffers:[]};if(new Uint32Array(o,e,1)[0]===yx){const I=new Uint32Array(o,e);let j=2;const H=(I[j++]>>2)-3,F=I[j++]>>2;if(j++,s.json=JSON.parse(vx.decode(I.subarray(j,j+F))),j+=F,j<H){const V=I[j++];j++;const Y=e+(j<<2);s.buffers[0]=o.slice(Y,Y+V)}}else s.json=JSON.parse(vx.decode(new Uint8Array(o,e)));const{buffers:f,images:l,meshes:d,extensionsUsed:R,bufferViews:N}=s.json;let $=Promise.resolve();if(f){const I=[];for(let j=0;j<f.length;j++){const H=f[j];H.uri?I.push(wA(H,s,j,i)):s.buffers[j]||(s.buffers[j]=null)}$=Promise.all(I)}return $.then(()=>{const I=[],j=R&&R.includes(q_),H=R&&R.includes(Pp);if(j&&I.push(function(){if(!wo)return vf??(vf=function(F){let V,Y=null;function oe(){V=new Uint8Array(Y.buffer)}function ce(){throw new Error("Unexpected Draco error.")}const we={a:{a:ce,d:function(Ie,me,Re){return V.copyWithin(Ie,me,me+Re)},c:function(Ie){const me=V.length,Re=Math.max(Ie>>>0,Math.ceil(1.2*me)),Ue=Math.ceil((Re-me)/65536);try{return Y.grow(Ue),oe(),!0}catch{return!1}},b:ce}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(F,we):F.then(Ie=>Ie.arrayBuffer()).then(Ie=>WebAssembly.instantiate(Ie,we))).then(Ie=>{const{Rb:me,Qb:Re,P:Ue,T:$e,X:ct,Ja:lt,La:st,Qa:xt,Va:dt,Wa:Et,eb:It,jb:Mt,f:Ct,e:kt,yb:jt,zb:Ot,Ab:Kt,Bb:ur,Db:Jt,Gb:yr}=Ie.instance.exports;Y=kt;const _r=(()=>{let Er=0,rr=0,kr=0,vr=0;return zr=>{kr&&(me(vr),me(Er),rr+=kr,kr=Er=0),Er||(rr+=128,Er=Re(rr));const Yr=zr.length+7&-8;let li=Er;Yr>=rr&&(kr=Yr,li=vr=Re(Yr));for(let ci=0;ci<zr.length;ci++)V[li+ci]=zr[ci];return li}})();return oe(),Ct(),{memory:kt,_free:me,_malloc:Re,Mesh:class{constructor(){this.ptr=Ue()}destroy(){$e(this.ptr)}},Decoder:class{constructor(){this.ptr=lt()}destroy(){Mt(this.ptr)}DecodeArrayToMesh(Er,rr,kr){const vr=_r(Er),zr=st(this.ptr,vr,rr,kr.ptr);return!!ct(zr)}GetAttributeByUniqueId(Er,rr){return{ptr:xt(this.ptr,Er.ptr,rr)}}GetTrianglesUInt16Array(Er,rr,kr){dt(this.ptr,Er.ptr,rr,kr)}GetTrianglesUInt32Array(Er,rr,kr){Et(this.ptr,Er.ptr,rr,kr)}GetAttributeDataArrayForAllPoints(Er,rr,kr,vr,zr){It(this.ptr,Er.ptr,rr.ptr,kr,vr,zr)}},DT_INT8:jt(),DT_UINT8:Ot(),DT_INT16:Kt(),DT_UINT16:ur(),DT_UINT32:Jt(),DT_FLOAT32:yr()}})}(fetch(mx())),vf.then(F=>{wo=F,vf=void 0}))}()),H&&I.push(function(){if(H_)return;const F=function(V){let Y;const oe=WebAssembly.instantiateStreaming(V,{}).then(Ie=>{Y=Ie.instance,Y.exports.__wasm_call_ctors()}),ce={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},we={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:oe,supported:!0,decodeGltfBuffer(Ie,me,Re,Ue,$e,ct){(function(lt,st,xt,dt,Et,It,Mt){const Ct=lt.exports.sbrk,kt=dt+3&-4,jt=Ct(kt*Et),Ot=Ct(It.length),Kt=new Uint8Array(lt.exports.memory.buffer);Kt.set(It,Ot);const ur=st(jt,dt,Et,Ot,It.length);if(ur===0&&Mt&&Mt(jt,kt,Et),xt.set(Kt.subarray(jt,jt+dt*Et)),Ct(jt-Ct(0)),ur!==0)throw new Error(`Malformed buffer data: ${ur}`)})(Y,Y.exports[we[$e]],Ie,me,Re,Ue,Y.exports[ce[ct]])}}}(fetch(_x()));return F.ready.then(()=>{H_=F})}()),l)for(let F=0;F<l.length;F++)I.push(EA(l[F],s,F,i));return(I.length?Promise.all(I):Promise.resolve()).then(()=>{if(j&&d)for(const{primitives:F}of d)for(const V of F)bA(V,s);if(H&&d&&N)for(const F of N)xA(F,s);return s})})}function eu(o,e){const i=o.json.bufferViews[e.bufferView],s=Ip[e.componentType];return new s(o.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==bf[e.type]*s.BYTES_PER_ELEMENT?i.byteStride/s.BYTES_PER_ELEMENT:bf[e.type]))}function W_(o,e,i,s){const f=Ip[e.componentType],l=function(I){switch(I){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(f),d=o.json.bufferViews[e.bufferView],R=d.byteStride?d.byteStride/f.BYTES_PER_ELEMENT:bf[e.type],N=i.float32,$=N.length/i.capacity;for(let I=0,j=0;I<e.count*R;I+=R,j+=$)for(let H=0;H<$;H++)N[j+H]=s[I+H]*l;i._trim()}function TA(o,e,i){const s=o.indices,f=o.attributes,l={};l.indexArray=new zn;const d=e.json.accessors[s],R=d.count/3;l.indexArray.reserve(R);const N=eu(e,d);for(let H=0;H<R;H++)l.indexArray.emplaceBack(N[3*H],N[3*H+1],N[3*H+2]);l.indexArray._trim(),l.vertexArray=new fo;const $=e.json.accessors[f.POSITION];l.vertexArray.reserve($.count);const I=eu(e,$);for(let H=0;H<$.count;H++)l.vertexArray.emplaceBack(I[3*H],I[3*H+1],I[3*H+2]);if(l.vertexArray._trim(),l.aabb=new Xr($.min,$.max),l.centroid=function(H,F){const V=[0,0,0],Y=H.length;if(Y>0){for(let oe=0;oe<Y;oe++){const ce=3*H[oe];V[0]+=F[ce],V[1]+=F[ce+1],V[2]+=F[ce+2]}V[0]/=Y,V[1]/=Y,V[2]/=Y}return V}(N,I),f.COLOR_0!==void 0){const H=e.json.accessors[f.COLOR_0],F=bf[H.type],V=eu(e,H);l.colorArray=F===3?new fo:new Do,l.colorArray.resize(H.count),W_(e,H,l.colorArray,V)}if(f.NORMAL!==void 0){l.normalArray=new fo;const H=e.json.accessors[f.NORMAL];l.normalArray.resize(H.count);const F=eu(e,H);W_(e,H,l.normalArray,F)}if(f.TEXCOORD_0!==void 0&&i.length>0){l.texcoordArray=new ss;const H=e.json.accessors[f.TEXCOORD_0];l.texcoordArray.resize(H.count);const F=eu(e,H);W_(e,H,l.texcoordArray,F)}if(f._FEATURE_ID_RGBA4444!==void 0){const H=e.json.accessors[f._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(l.featureData=eu(e,H))}f._FEATURE_RGBA4444!==void 0&&(l.featureData=new Uint32Array(eu(e,e.json.accessors[f._FEATURE_RGBA4444]).buffer));const j=o.material;return l.material=function(H,F){const{emissiveFactor:V=[0,0,0],alphaMode:Y="OPAQUE",alphaCutoff:oe=.5,normalTexture:ce,occlusionTexture:we,emissiveTexture:Ie,doubleSided:me}=H,{baseColorFactor:Re=[1,1,1,1],metallicFactor:Ue=1,roughnessFactor:$e=1,baseColorTexture:ct,metallicRoughnessTexture:lt}=H.pbrMetallicRoughness||{},st=we?F[we.index]:void 0;if(we&&we.extensions&&we.extensions.KHR_texture_transform&&st){const xt=we.extensions.KHR_texture_transform;st.offsetScale=[xt.offset[0],xt.offset[1],xt.scale[0],xt.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Mi(...Re),metallicFactor:Ue,roughnessFactor:$e,baseColorTexture:ct?F[ct.index]:void 0,metallicRoughnessTexture:lt?F[lt.index]:void 0},doubleSided:me,emissiveFactor:V,alphaMode:Y,alphaCutoff:oe,normalTexture:ce?F[ce.index]:void 0,occlusionTexture:st,emissionTexture:Ie?F[Ie.index]:void 0,defined:H.defined===void 0}}(j!==void 0?e.json.materials[j]:{defined:!1},i),l}function Ex(o,e,i){const{matrix:s,rotation:f,translation:l,scale:d,mesh:R,extras:N,children:$}=o,I={};if(I.matrix=s||_e.mat4.fromRotationTranslationScale([],f||[0,0,0,1],l||[0,0,0],d||[1,1,1]),R!==void 0){I.meshes=i[R];const j=I.anchor=[0,0];for(const H of I.meshes){const{min:F,max:V}=H.aabb;j[0]+=F[0]+V[0],j[1]+=F[1]+V[1]}j[0]=Math.floor(j[0]/I.meshes.length/2),j[1]=Math.floor(j[1]/I.meshes.length/2)}if(N&&(N.id&&(I.id=N.id),N.lights&&(I.lights=function(j){if(!j.length)return[];const H=function(ce){const we=atob(ce),Ie=new Uint8Array(we.length);for(let me=0;me<we.length;me++)Ie[me]=we.codePointAt(me);return Ie}(j),F=[],V=H.length/24,Y=new Uint16Array(H.buffer),oe=new Float32Array(H.buffer);for(let ce=0;ce<V;ce++){const we=Y[2*ce*6]/30,Ie=Y[2*ce*6+1]/30,me=Y[2*ce*6+10]/100,Re=oe[6*ce+1],Ue=oe[6*ce+2],$e=oe[6*ce+3],ct=oe[6*ce+4],lt=$e-Re,st=ct-Ue,xt=Math.hypot(lt,st);F.push({pos:[Re+.5*lt,Ue+.5*st,Ie],normal:[st/xt,-lt/xt,0],width:xt,height:we,depth:me,points:[Re,Ue,$e,ct]})}return F}(N.lights))),$){const j=[];for(const H of $)j.push(Ex(e.json.nodes[H],e,i));I.children=j}return I}function SA(o){if(o.vertices.length===0||o.indices.length===0)return null;const e=new Zm(o.vertices,o.indices,8,256),[i,s]=[e.min.clone(),e.max.clone()];return{vertices:o.vertices,indices:o.indices,grid:e,min:i,max:s}}function MA(o){if(!o.extras||!o.extras.ground)return null;const e=o.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const s=[];for(const d of i){if(!Array.isArray(d)||d.length!==2)continue;const R=d[0],N=d[1];typeof R=="number"&&typeof N=="number"&&s.push(new Ge(R,N))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let f=0;for(let d=0;d<s.length;d++){const R=s[d],N=s[(d+1)%s.length],$=s[(d+2)%s.length];f+=(R.x-N.x)*($.y-N.y)-($.x-N.x)*(R.y-N.y)}f>0&&s.reverse();const l=qh(s.flatMap(d=>[d.x,d.y]),[]);return l.length===0?null:{vertices:s,indices:l}}function AA(o,e){const i=[],s=[];let f=0;const l=[];for(const d of o){f=i.length;const R=d.vertexArray.float32,N=d.indexArray.uint16;for(let $=0;$<d.vertexArray.length;$++)l[0]=R[3*$+0],l[1]=R[3*$+1],l[2]=R[3*$+2],_e.vec3.transformMat4(l,l,e),i.push(new Ge(l[0],l[1]));for(let $=0;$<3*d.indexArray.length;$++)s.push(N[$]+f)}if(s.length%3!=0)return null;for(let d=0;d<s.length;d+=3){const R=i[s[d+0]],N=i[s[d+1]],$=i[s[d+2]];(R.x-N.x)*($.y-N.y)-($.x-N.x)*(R.y-N.y)>0&&([s[d+1],s[d+2]]=[s[d+2],s[d+1]])}return{vertices:i,indices:s}}function Tx(o){const e=function(N,$){const I=[],j=WebGL2RenderingContext;if(N.json.textures)for(const H of N.json.textures){const F={magFilter:j.LINEAR,minFilter:j.NEAREST,wrapS:j.REPEAT,wrapT:j.REPEAT};H.sampler!==void 0&&Object.assign(F,N.json.samplers[H.sampler]),I.push({image:$[H.source],sampler:F,uploaded:!1})}return I}(o,o.images),i=function(N,$){const I=[];for(const j of N.json.meshes){const H=[];for(const F of j.primitives)H.push(TA(F,N,$));I.push(H)}return I}(o,e),{scenes:s,scene:f,nodes:l}=o.json,d=s?s[f||0].nodes:l,R=[];for(const N of d)R.push(Ex(l[N],o,i));return function(N,$,I){const j={},H=new Set;for(let F=0;F<N.length;F++){const V=I[$[F]];if(!V.extras)continue;const Y=V.extras["mapbox:footprint:version"],oe=V.extras["mapbox:footprint:id"];(Y||oe)&&H.add(F),Y==="1.0.0"&&oe&&(j[oe]=F)}for(let F=0;F<N.length;F++){if(H.has(F))continue;const V=N[F],Y=I[$[F]];if(!Y.extras)continue;let oe=null;V.id in j&&(oe=AA(N[j[V.id]].meshes,V.matrix)),oe||(oe=MA(Y)),oe&&(V.footprint=SA(oe))}if(H.size>0){const F=Array.from(H.values()).sort((V,Y)=>V-Y);for(let V=F.length-1;V>=0;V--)N.splice(F[V],1)}}(R,d,o.json.nodes),R}function IA(o){o.heightmap=new Float32Array(4096),o.heightmap.fill(-1);const e=o.vertexArray.float32,i=o.aabb.min[0]-1,s=o.aabb.min[1]-1,f=Kl/(o.aabb.max[0]-i+2),l=Kl/(o.aabb.max[1]-s+2);for(let d=0;d<e.length;d+=3){const R=e[d+2],N=(e[d+0]-i)*f|0,$=(e[d+1]-s)*l|0;R>o.heightmap[$*Kl+N]&&(o.heightmap[$*Kl+N]=R)}}function PA(o,e){const i={};i.indexArray=new zn,i.indexArray.reserve(4*o.length),i.vertexArray=new fo,i.vertexArray.reserve(10*o.length),i.colorArray=new Do,i.vertexArray.reserve(10*o.length);let s=0;for(const d of o){const R=Math.min(10,Math.max(4,1.3*d.height))*e,N=[-d.normal[1],d.normal[0],0],$=Math.min(.29,.1*d.width/d.depth),I=d.width-2*d.depth*e*($+.01),j=_e.vec3.scaleAndAdd([],d.pos,N,I/2),H=_e.vec3.scaleAndAdd([],d.pos,N,-I/2),F=[j[0],j[1],j[2]+d.height],V=[H[0],H[1],H[2]+d.height],Y=_e.vec3.scaleAndAdd([],d.normal,N,$);_e.vec3.scale(Y,Y,R);const oe=_e.vec3.scaleAndAdd([],d.normal,N,-$);_e.vec3.scale(oe,oe,R),_e.vec3.add(Y,j,Y),_e.vec3.add(oe,H,oe),j[2]+=.1,H[2]+=.1,i.vertexArray.emplaceBack(Y[0],Y[1],Y[2]),i.vertexArray.emplaceBack(oe[0],oe[1],oe[2]),i.vertexArray.emplaceBack(j[0],j[1],j[2]),i.vertexArray.emplaceBack(H[0],H[1],H[2]),i.vertexArray.emplaceBack(F[0],F[1],F[2]),i.vertexArray.emplaceBack(V[0],V[1],V[2]),i.vertexArray.emplaceBack(j[0],j[1],j[2]),i.vertexArray.emplaceBack(H[0],H[1],H[2]),i.vertexArray.emplaceBack(Y[0],Y[1],Y[2]),i.vertexArray.emplaceBack(oe[0],oe[1],oe[2]);const ce=I/R/2;i.colorArray.emplaceBack(-ce-$,-1,ce,.8),i.colorArray.emplaceBack(ce+$,-1,ce,.8),i.colorArray.emplaceBack(-ce,0,ce,1.3),i.colorArray.emplaceBack(ce,0,ce,1.3),i.colorArray.emplaceBack(ce+$,-.8,ce,.7),i.colorArray.emplaceBack(ce+$,-.8,ce,.7),i.colorArray.emplaceBack(0,0,ce,1.3),i.colorArray.emplaceBack(0,0,ce,1.3),i.colorArray.emplaceBack(ce+$,-1.2,ce,.8),i.colorArray.emplaceBack(ce+$,-1.2,ce,.8),i.indexArray.emplaceBack(6+s,4+s,8+s),i.indexArray.emplaceBack(7+s,9+s,5+s),i.indexArray.emplaceBack(0+s,1+s,2+s),i.indexArray.emplaceBack(1+s,3+s,2+s),s+=10}const f={defined:!0,emissiveFactor:[0,0,0]},l={};return l.baseColorFactor=Mi.white,f.pbrMetallicRoughness=l,i.material=f,i.aabb=new Xr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}class Sx{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const s=e[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const CA=["id","tile","layer","source","sourceLayer","state"];class Lc{constructor(e,i,s,f,l){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=s,this._y=f,this.properties=e.properties,this.id=l}clone(){const e=new Lc(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state={...this.state}),this.layer&&(e.layer={...this.layer}),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of CA)this[i]!==void 0&&(e[i]=this[i]);return e}}class Mx{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ns(wr,16,0),this.featureIndexArray=new jl,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,s,f,l,d=0,R=0){const N=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,f,l,d);const $=this.grid;for(let I=0;I<i.length;I++){const j=i[I],H=[1/0,1/0,-1/0,-1/0];for(let F=0;F<j.length;F++){const V=j[F];H[0]=Math.min(H[0],V.x),H[1]=Math.min(H[1],V.y),H[2]=Math.max(H[2],V.x),H[3]=Math.max(H[3],V.y)}R!==0&&(H[0]-=R,H[1]-=R,H[2]+=R,H[3]+=R),H[0]<wr&&H[1]<wr&&H[2]>=0&&H[3]>=0&&$.insert(N,H[0],H[1],H[2],H[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new vc.VectorTile(new Jd(this.rawTileData)).layers,this.sourceLayerCoder=new Sx(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:s,transform:f,tileTransform:l,pixelPosMatrix:d,availableImages:R}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const N=s.bufferedTilespaceBounds,$=this.grid.query(N.min.x,N.min.y,N.max.x,N.max.y,(F,V,Y,oe)=>Dt(s.bufferedTilespaceGeometry,F,V,Y,oe));$.sort(RA);let I=null;f.elevation&&$.length>0&&(I=Mc.create(f.elevation,this.tileID));const j={};let H;for(let F=0;F<$.length;F++){const V=$[F];if(V===H)continue;H=V;const Y=this.featureIndexArray.get(V);let oe=null;this.is3DTile?this.loadMatchingModelFeature(j,Y,e,s,f):this.loadMatchingFeature(j,Y,e,R,(ce,we,Ie,me=0)=>(oe||(oe=he(ce,this.tileID.canonical,l)),we.queryIntersectsFeature(s,ce,Ie,oe,this.z,f,d,I,me)))}return j}loadMatchingFeature(e,i,s,f,l){const{featureIndex:d,bucketIndex:R,sourceLayerIndex:N,layoutVertexArrayOffset:$}=i,I=this.bucketLayerIDs[R],j=s.layers,H=Object.keys(j);if(H.length&&!function(ce,we){for(let Ie=0;Ie<ce.length;Ie++)if(we.indexOf(ce[Ie])>=0)return!0;return!1}(H,I))return;const F=s.sourceCache,V=this.sourceLayerCoder.decode(N),Y=this.vtLayers[V].feature(d),oe=this.getId(Y,V);for(let ce=0;ce<I.length;ce++){const we=I[ce];if(!j[we])continue;const{styleLayer:Ie,targets:me}=j[we];let Re={};oe!==void 0&&(Re=F.getFeatureState(Ie.sourceLayer,oe));const Ue=!l||l(Y,Ie,Re,$);if(!Ue)continue;const $e=new Lc(Y,this.z,this.x,this.y,oe);$e.tile=this.tileID.canonical,$e.state=Re;let ct=this.serializedLayersCache.get(we);ct||(ct=Ie.serialize(),ct.id=we,this.serializedLayersCache.set(we,ct)),$e.source=ct.source,$e.sourceLayer=ct["source-layer"],$e.layer=Wt({},ct),$e.layer.paint=Ax(ct.paint,Ie.paint,Y,Re,f),$e.layer.layout=Ax(ct.layout,Ie.layout,Y,Re,f);let lt=!1;for(const st of me){this.updateFeatureProperties($e,st);const{filter:xt}=st;if(xt){if(Y.properties=$e.properties,xt.needGeometry){const dt=fe(Y,!0);if(!xt.filter(new Xi(this.tileID.overscaledZ),dt,this.tileID.canonical))continue}else if(!xt.filter(new Xi(this.tileID.overscaledZ),Y))continue}lt=!0,st.targetId&&this.addFeatureVariant($e,st)}lt&&this.appendToResult(e,we,d,$e,Ue)}}loadMatchingModelFeature(e,i,s,f,l){const d=this.bucketLayerIDs[0][0],R=s.layers;if(!R[d])return;const{styleLayer:N,targets:$}=R[d];if(N.type!=="model")return;const I=f.tile,j=i.featureIndex,H=I.getBucket(N);if(!(H&&H instanceof bp))return;const F=function(ct,lt,st,xt){const dt=ct.getNodesInfo()[lt];if(dt.hiddenByReplacement||!dt.node.meshes)return;let Et=Number.MAX_VALUE;const It=dt.node,Mt=st.tile,Ct=xt.calculatePosMatrix(Mt.tileID.toUnwrapped(),xt.worldSize),kt=dt.evaluatedScale;let jt=0;xt.elevation&&It.elevation&&(jt=It.elevation*xt.elevation.exaggeration()),_e.mat4.translate(Ct,Ct,[(It.anchor?It.anchor[0]:0)*(kt[0]-1),(It.anchor?It.anchor[1]:0)*(kt[1]-1),jt]),_e.mat4.scale(Ct,Ct,kt);const Ot=st.queryGeometry,Kt=Ot.isPointQuery()?Ot.screenBounds:Ot.screenGeometry,ur=function(yr){const _r=_e.mat4.multiply([],Ct,yr.matrix);_e.mat4.multiply(_r,xt.expandedFarZProjMatrix,_r);for(let Er=0;Er<yr.meshes.length;++Er){const rr=yr.meshes[Er];if(Er===yr.lightMeshIndex)continue;const kr=Ab(Kt,xt,_r,rr.aabb);kr!=null&&(Et=Math.min(kr,Et))}if(yr.children)for(const Er of yr.children)ur(Er)};if(ur(It),Et===Number.MAX_VALUE)return;const Jt=new Ai(0,0);return Nb(Mt.tileID.canonical,Jt,dt.node.anchor[0],dt.node.anchor[1]),{intersectionZ:Et,position:Jt,feature:dt.feature}}(H,j,f,l);if(!F)return;const{z:V,x:Y,y:oe}=I.tileID.canonical,{feature:ce,intersectionZ:we,position:Ie}=F;let me={};ce.id!==void 0&&(me=s.sourceCache.getFeatureState(N.sourceLayer,ce.id));const Re=new Lc({},V,Y,oe,ce.id);Re.tile=this.tileID.canonical,Re.state=me,Re.properties=ce.properties,Re.geometry={type:"Point",coordinates:[Ie.lng,Ie.lat]};let Ue=this.serializedLayersCache.get(d);Ue||(Ue=N.serialize(),Ue.id=d,this.serializedLayersCache.set(d,Ue)),Re.source=Ue.source,Re.sourceLayer=Ue["source-layer"],Re.layer=Wt({},Ue);let $e=!1;for(const ct of $){this.updateFeatureProperties(Re,ct);const{filter:lt}=ct;if(lt){if(ce.properties=Re.properties,lt.needGeometry){if(!lt.filter(new Xi(this.tileID.overscaledZ),ce,this.tileID.canonical))continue}else if(!lt.filter(new Xi(this.tileID.overscaledZ),ce))continue}$e=!0,ct.targetId&&this.addFeatureVariant(Re,ct)}$e&&this.appendToResult(e,d,j,Re,we)}updateFeatureProperties(e,i,s){if(i.properties){const f={};for(const l in i.properties){const d=i.properties[l].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,s);d!=null&&(f[l]=d)}e.properties=f}}addFeatureVariant(e,i,s){const f={target:i.target,namespace:i.namespace};i.properties&&(f.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(f)}appendToResult(e,i,s,f,l){let d=e[i];d===void 0&&(d=e[i]=[]),d.push({featureIndex:s,feature:f,intersectionZ:l})}lookupSymbolFeatures(e,i,s,f,l){const d={};this.loadVTLayers();for(const R of e)this.loadMatchingFeature(d,{bucketIndex:i,sourceLayerIndex:s,featureIndex:R,layoutVertexArrayOffset:0},f,l);return d}loadFeature(e){const{featureIndex:i,sourceLayerIndex:s}=e;this.loadVTLayers();const f=this.sourceLayerCoder.decode(s),l=this.vtFeatures[f];if(l[i])return l[i];const d=this.vtLayers[f].feature(i);return l[i]=d,d}hasLayer(e){for(const i of this.bucketLayerIDs)for(const s of i)if(e===s)return!0;return!1}getId(e,i){let s=e.id;if(this.promoteId){const f=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];f!=null&&(s=e.properties[f]),typeof s=="boolean"&&(s=Number(s))}return s}}function Ax(o,e,i,s,f){return fr(o,(l,d)=>{const R=e instanceof Gs?e.get(d):null;return R&&R.evaluate?R.evaluate(i,s,f):R})}function RA(o,e){return e-o}Dr(Mx,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Ix=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class $_{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,s]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=s>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const l=Ix[15&s];if(!l)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(e,2,1),[R]=new Uint32Array(e,4,1);return new $_(R,d,l,e)}constructor(e,i=64,s=Float64Array,f){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const l=Ix.indexOf(this.ArrayType),d=2*e*this.ArrayType.BYTES_PER_ELEMENT,R=e*this.IndexArrayType.BYTES_PER_ELEMENT,N=(8-R%8)%8;if(l<0)throw new Error(`Unexpected typed array class: ${s}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+R+N,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+d+R+N),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+R+N,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+l]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=i,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Z_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,s,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:d,nodeSize:R}=this,N=[0,l.length-1,0],$=[];for(;N.length;){const I=N.pop()||0,j=N.pop()||0,H=N.pop()||0;if(j-H<=R){for(let oe=H;oe<=j;oe++){const ce=d[2*oe],we=d[2*oe+1];ce>=e&&ce<=s&&we>=i&&we<=f&&$.push(l[oe])}continue}const F=H+j>>1,V=d[2*F],Y=d[2*F+1];V>=e&&V<=s&&Y>=i&&Y<=f&&$.push(l[F]),(I===0?e<=V:i<=Y)&&(N.push(H),N.push(F-1),N.push(1-I)),(I===0?s>=V:f>=Y)&&(N.push(F+1),N.push(j),N.push(1-I))}return $}within(e,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:l,nodeSize:d}=this,R=[0,f.length-1,0],N=[],$=s*s;for(;R.length;){const I=R.pop()||0,j=R.pop()||0,H=R.pop()||0;if(j-H<=d){for(let oe=H;oe<=j;oe++)Cx(l[2*oe],l[2*oe+1],e,i)<=$&&N.push(f[oe]);continue}const F=H+j>>1,V=l[2*F],Y=l[2*F+1];Cx(V,Y,e,i)<=$&&N.push(f[F]),(I===0?e-s<=V:i-s<=Y)&&(R.push(H),R.push(F-1),R.push(1-I)),(I===0?e+s>=V:i+s>=Y)&&(R.push(F+1),R.push(j),R.push(1-I))}return N}}function Z_(o,e,i,s,f,l){if(f-s<=i)return;const d=s+f>>1;Px(o,e,d,s,f,l),Z_(o,e,i,s,d-1,1-l),Z_(o,e,i,d+1,f,1-l)}function Px(o,e,i,s,f,l){for(;f>s;){if(f-s>600){const $=f-s+1,I=i-s+1,j=Math.log($),H=.5*Math.exp(2*j/3),F=.5*Math.sqrt(j*H*($-H)/$)*(I-$/2<0?-1:1);Px(o,e,i,Math.max(s,Math.floor(i-I*H/$+F)),Math.min(f,Math.floor(i+($-I)*H/$+F)),l)}const d=e[2*i+l];let R=s,N=f;for(xf(o,e,s,i),e[2*f+l]>d&&xf(o,e,s,f);R<N;){for(xf(o,e,R,N),R++,N--;e[2*R+l]<d;)R++;for(;e[2*N+l]>d;)N--}e[2*s+l]===d?xf(o,e,s,N):(N++,xf(o,e,N,f)),N<=i&&(s=N+1),i<=N&&(f=N-1)}}function xf(o,e,i,s){X_(o,i,s),X_(e,2*i,2*s),X_(e,2*i+1,2*s+1)}function X_(o,e,i){const s=o[e];o[e]=o[i],o[i]=s}function Cx(o,e,i,s){const f=o-i,l=e-s;return f*f+l*l}t.$=Ah,t.A=Mn,t.B=2,t.C=Hv,t.D=Ac,t.E=Ts,t.F=f_,t.G=class extends yp{},t.H=Ko,t.I=F_,t.J=_u,t.K=xd,t.L=dh,t.M=Bs,t.N=hd,t.O=Hu,t.P=Ge,t.Q=Ju,t.R=Cr,t.S=gh,t.T=T_,t.U=Il,t.V=yp,t.W=El,t.X=uo,t.Y=Os,t.Z=ra,t._=mu,t.a=function(o){return Q.API_CDN_URL_REGEX.test(o)},t.a$=Lc,t.a0=Vu,t.a1=ju,t.a2=function(o){const e=o.value;let i=[];if(!e)return i;const s=Ko(e);return s!=="string"?(i=i.concat([new yp(o.key,e,`string expected, "${s}" found`)]),i):(Pb(e,!0)||(i=i.concat([new yp(o.key,e,`invalid url "${e}"`)])),i)},t.a3=qt,t.a4=Rl,t.a5=on,t.a6=dr,t.a7=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return Rt(o.expression.evaluate(e))}interpolate(o,e,i){return{x:Qr(o.x,e.x,i),y:Qr(o.y,e.y,i),z:Qr(o.z,e.z,i),azimuthal:Qr(o.azimuthal,e.azimuthal,i),polar:Qr(o.polar,e.polar,i)}}},t.a8=Xi,t.a9=Fs,t.aA=_o,t.aB=class{constructor(o){this.entries={},this.scheduler=o}request(o,e,i,s){const f=this.entries[o]=this.entries[o]||{callbacks:[]};if(f.result){const[l,d]=f.result;return this.scheduler?this.scheduler.add(()=>{s(l,d)},e):s(l,d),()=>{}}return f.callbacks.push(s),f.cancel||(f.cancel=i((l,d)=>{f.result=[l,d];for(const R of f.callbacks)this.scheduler?this.scheduler.add(()=>{R(l,d)},e):R(l,d);setTimeout(()=>delete this.entries[o],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(l=>l!==s),f.callbacks.length||(f.cancel(),delete this.entries[o]))}}},t.aC=Ba,t.aD=function(o,e,i){const s=JSON.stringify(o.request);return o.data&&(this.deduped.entries[s]={result:[null,o.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},f=>{const l=Ra(o.request,(d,R,N,$)=>{d?f(d):R&&f(null,{vectorTile:i?void 0:new vc.VectorTile(new Jd(R)),rawData:R,cacheControl:N,expires:$})});return()=>{l.cancel(),f()}},e)},t.aE=function(o){Ki++,Ki>Ur&&(o.getActor().send("enforceCacheSizeLimit",Br),Ki=0)},t.aF=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},t.aG=mr,t.aH=_b,t.aI=wb,t.aJ=mb,t.aK=function(o,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let s=0;s<o.length;s++){const f=document.createElement("source");To(o[s])||(i.crossOrigin="Anonymous"),f.src=o[s],i.appendChild(f)}return{cancel:()=>{}}},t.aL=dp,t.aM=function(o){return fetch(o).then(e=>e.arrayBuffer()).then(e=>wx(e,0,o))},t.aN=Tx,t.aO=class{constructor(o,e,i,s){this.id=o,this.position=e!=null?new Ai(e[0],e[1]):new Ai(0,0),this.orientation=i??[0,0,0],this.nodes=s,this.uploaded=!1,this.aabb=new Xr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(o,e){if(_e.mat4.multiply(o.matrix,e,o.matrix),o.meshes)for(const i of o.meshes){const s=Xr.applyTransformFast(i.aabb,o.matrix);this.aabb.encapsulate(s)}if(o.children)for(const i of o.children)this._applyTransformations(i,o.matrix)}computeBoundsAndApplyParent(){const o=_e.mat4.identity([]);for(const e of this.nodes)this._applyTransformations(e,o)}computeModelMatrix(o,e,i,s,f,l,d=!1){Ob(this.matrix,this,o.transform,this.position,e,i,s,f,l,d)}upload(o){if(!this.uploaded){for(const e of this.nodes)P_(e,o);for(const e of this.nodes)vp(e);this.uploaded=!0}}destroy(){for(const o of this.nodes)C_(o)}},t.aP=Tr,t.aQ=af,t.aR=la,t.aS=In,t.aT=Ro,t.aU=zn,t.aV=Or,t.aW=Md,t.aX=hp,t.aY=function(){Ta.isLoading()||Ta.isLoaded()||Yu()!=="deferred"||vd()},t.aZ=wd,t.a_=fe,t.aa=c,t.ab=_e,t.ac=et,t.ad=Gs,t.ae=Zn,t.af=Qr,t.ag=wr,t.ah=Hc,t.ai=ze,t.aj=Mi,t.ak=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return function([i,s]){const f=Rt([1,i,s]);return{x:f.x,y:f.y,z:f.z}}(o.expression.evaluate(e))}interpolate(o,e,i){return{x:Qr(o.x,e.x,i),y:Qr(o.y,e.y,i),z:Qr(o.z,e.z,i)}}},t.al=function(o,e,i=0,s=!0){const f=new Ge(i,i),l=o.sub(f),d=e.add(f),R=[l,new Ge(d.x,l.y),d,new Ge(l.x,d.y)];return s&&R.push(l.clone()),R},t.am=function(o,e){const i=[];for(let s=0;s<o.length;s++){const f=wt(s-1,-1,o.length-1),l=wt(s+1,-1,o.length-1),d=o[s],R=o[l],N=o[f].sub(d).unit(),$=R.sub(d).unit(),I=$.angleWithSep(N.x,N.y),j=N.add($).unit().mult(-1*e/Math.sin(I/2));i.push(d.add(j))}return i},t.an=tb,t.ao=Dt,t.ap=function(o,e,i=0){return _e.vec3.fromValues(((e.x-i)*o.scale-o.x)*wr,(e.y*o.scale-o.y)*wr,Nd(e.z,e.y))},t.aq=vi,t.ar=bv,t.as=function(o){let e=1/0,i=1/0,s=-1/0,f=-1/0;for(const l of o)e=Math.min(e,l.x),i=Math.min(i,l.y),s=Math.max(s,l.x),f=Math.max(f,l.y);return{min:new Ge(e,i),max:new Ge(s,f)}},t.at=Ya,t.au=Tt,t.av=M,t.aw=le,t.ax=Hn,t.ay=function(o,e){const i={};for(let s=0;s<e.length;s++){const f=e[s];f in o&&(i[f]=o[f])}return i},t.az=Fo,t.b=function(o){return Q.API_FONTS_REGEX.test(o)},t.b$=_p,t.b0=rt,t.b1=i_,t.b2=$m,t.b3=he,t.b4=Fa,t.b5=lc,t.b6=ii,t.b7=hn,t.b8=qh,t.b9=x_,t.bA=J1,t.bB=m_,t.bC=Kv,t.bD=h_,t.bE=$_,t.bF=wt,t.bG=Fr,t.bH=qn,t.bI=function(o,e,i){o[4*e+0]=i[0],o[4*e+1]=i[1],o[4*e+2]=i[2],o[4*e+3]=i[3]},t.bJ=Hl,t.bK=Na,t.bL=Uh,t.bM=sn,t.bN=Ws,t.bO=Ai,t.bP=ob,t.bQ=Sr,t.bR=ui,t.bS=Tb,t.bT=er,t.bU=un,t.bV=function(o,e,i,s,f,l,d,R,N){if(N.name==="globe")return un(o,e,new er(i,s,f),!1);const $=af({z:i,x:s,y:f},N);return new Xr([(l+$.x/$.scale)*e,e*($.y/$.scale),d],[(l+$.x2/$.scale)*e,e*($.y2/$.scale),R])},t.bW=function(o,e,i){let s=0;for(let f=0;f<2;++f)o[f]>0&&(s+=(o[f]-0)*(o[f]-0)),e[f]<0&&(s+=(0-e[f])*(0-e[f]));return s},t.bX=Wn,t.bY=kd,t.bZ=function(o){const e=_e.mat4.identity(new Float64Array(16));_e.mat4.multiply(e,o.pixelMatrix,o.globeMatrix);const i=[0,Ma,0],s=[0,Aa,0];return _e.vec3.transformMat4(i,i,e),_e.vec3.transformMat4(s,s,e),[i[0]>0&&i[0]<=o.width&&i[1]>0&&i[1]<=o.height&&!ca(o,new Ai(o.center.lat,90)),s[0]>0&&s[0]<=o.width&&s[1]>0&&s[1]<=o.height&&!ca(o,new Ai(o.center.lat,-90))]},t.b_=function(o,e){const{scale:i}=o.tileTransform,s=i*wr/(o.tileSize*Math.pow(2,e.zoom-o.tileID.overscaledZ+o.tileID.canonical.z));return _e.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[s,s])},t.ba=function(o,e){const i=Zn(e.zoom);if(i===0)return pn(o);const s=ji(o),f=qi(s),l=Ya(s.getWest())*e.worldSize,d=Ya(s.getEast())*e.worldSize,R=_o(s.getNorth())*e.worldSize,N=_o(s.getSouth())*e.worldSize,$=[l,R,0],I=[d,R,0],j=[l,N,0],H=[d,N,0],F=_e.mat4.invert([],e.globeMatrix);return _e.vec3.transformMat4($,$,F),_e.vec3.transformMat4(I,I,F),_e.vec3.transformMat4(j,j,F),_e.vec3.transformMat4(H,H,F),f[0]=An(f[0],j,i),f[1]=An(f[1],H,i),f[2]=An(f[2],I,i),f[3]=An(f[3],$,i),Xr.fromPoints(f)},t.bb=Ni,t.bc=wi,t.bd=An,t.be=zl,t.bf=Zr,t.bg=V_,t.bh=Jd,t.bi=Ra,t.bj=function(o){const e=[];for(const i in o)e.push(o[i]);return e},t.bk=function(o,e){const i=[];for(const s in o)s in e||i.push(s);return i},t.bl=Ft,t.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.bn=We,t.bo=function(o,e){const{x:i,y:s}=o.point,f=go(i,s,o.worldSize/o._pixelsPerMercatorPixel,0,0);return _e.mat4.multiply(f,f,jn(pn(e)))},t.bp=bc,t.bq=Va,t.br=Kd,t.bs=function(o,e,i,s,f){const l=5*e+2;o.float32[l+0]=i,o.float32[l+1]=s,o.float32[l+2]=f},t.bt=cp,t.bu=Gv,t.bv=Xe,t.bw=Vn,t.bx=W1,t.by=Ib,t.bz=K1,t.c=Ne,t.c$=(o,e,i,s,f,l,d,R)=>{const N=o.transform,$=N.pitch<15?xv(.07,.7,le((14-N.zoom)/5,0,1)):.07,I=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Ev(o,e,i,s),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:N.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:f,u_width_scale:l,u_floor_width_scale:d,u_image:0,u_tile_units_to_pixels:wv(e,N),u_units_to_pixels:[1/N.pixelsToGLUnits[0],1/N.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:R,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(I?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:$,u_tile_to_meter:n(e.tileID.canonical,0)}},t.c0=Eb,t.c1=function(o){const e=Eb(o,!0);return _e.mat2.invert([],[e[0],e[1],e[4],e[5]])},t.c2=di,t.c3=function(o){const{x:e,y:i}=o.point,{lng:s,lat:f}=o._center;return go(e,i,o.worldSize,s,f)},t.c4=de,t.c5=Mr,t.c6=pc,t.c7=function(o){const e=Math.round((o+45+360)%360/90)%4;return ve[e]},t.c8=45,t.c9=Wl,t.cA=class extends po{constructor(o){super(o),this.current=zm}set(o,e,i){if(this.fetchUniformLocation(o,e)){for(let s=0;s<9;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},t.cB=be,t.cC=function(o,e,i){const s=Zn(i.zoom),f=o.style.map._antialias,l=e.options.extStandardDerivativesForceOff||o.terrain&&o.terrain.exaggeration()>0;return s===0&&!f&&!l},t.cD=function(o){const e=o.pixelsPerMeter,i=e/qn(1,o.center.lat),s=_e.mat4.identity(new Float64Array(16));return _e.mat4.translate(s,s,[o.point.x,o.point.y,0]),_e.mat4.scale(s,s,[i,i,e]),Float32Array.from(s)},t.cE=ji,t.cF=function(o){const e=Wn-5;o=le(o,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(ze(o))),3);return Math.round(i*(mc.length-1))},t.cG=function(o,e,i,s){const f=e.getNorth(),l=e.getSouth(),d=e.getWest(),R=e.getEast(),N=1<<o.z,$=R-d,I=f-l,j=$/cs,H=-I/mc[i],F=[0,j,0,H,0,0,f,d,0];if(o.z>0){const V=180/s;_e.mat3.multiply(F,F,[V/$+1,0,0,0,V/I+1,0,-.5*V/j,.5*V/H,1])}return F[2]=N,F[5]=o.x,F[8]=o.y,F},t.cH=pn,t.cI=function(o,e,i){const s=_e.mat4.identity(new Float64Array(16)),f=(e/(1<<o)-.5)*Math.PI*2;return _e.mat4.rotateY(s,i.globeMatrix,f),Float32Array.from(s)},t.cJ=class{isDataAvailableAtPoint(o){const e=this._source();if(this.isUsingMockSource()||!e||o.y<0||o.y>1)return!1;const i=e.getSource().maxzoom,s=1<<i,f=Math.floor(o.x),l=Math.floor((o.x-f)*s),d=Math.floor(o.y*s),R=this.findDEMTileFor(new mr(i,f,i,l,d));return!(!R||!R.dem)}getAtPointOrZero(o,e=0){return this.getAtPoint(o,e)||0}getAtPoint(o,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const s=this._source();if(!s||o.y<0||o.y>1)return e;const f=s.getSource().maxzoom,l=1<<f,d=Math.floor(o.x),R=o.x-d,N=new mr(f,d,f,Math.floor(R*l),Math.floor(o.y*l)),$=this.findDEMTileFor(N);if(!$||!$.dem)return e;const I=$.dem,j=1<<$.tileID.canonical.z,H=(R*j-$.tileID.canonical.x)*I.dim,F=(o.y*j-$.tileID.canonical.y)*I.dim,V=Math.floor(H),Y=Math.floor(F);return(i?this.exaggeration():1)*Qr(Qr(I.get(V,Y),I.get(V,Y+1),F-Y),Qr(I.get(V+1,Y),I.get(V+1,Y+1),F-Y),H-V)}getAtTileOffset(o,e,i){const s=1<<o.canonical.z;return this.getAtPointOrZero(new c(o.wrap+(o.canonical.x+e/wr)/s,(o.canonical.y+i/wr)/s))}getAtTileOffsetFunc(o,e,i,s){return f=>{const l=this.getAtTileOffset(o,f.x,f.y),d=s.upVector(o.canonical,f.x,f.y),R=s.upVectorScale(o.canonical,e,i).metersToTile;return _e.vec3.scale(d,d,l*R),d}}getForTilePoints(o,e,i,s){if(this.isUsingMockSource())return!1;const f=Mc.create(this,o,s);return!!f&&(e.forEach(l=>{l[2]=this.exaggeration()*f.getElevationAt(l[0],l[1],i)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(o);if(!e||!e.dem)return null;const i=e.dem.tree,s=e.tileID,f=1<<o.canonical.z-s.canonical.z;let l=o.canonical.x/f-s.canonical.x,d=o.canonical.y/f-s.canonical.y,R=0;for(let N=0;N<o.canonical.z-s.canonical.z&&!i.leaves[R];N++){l*=2,d*=2;const $=2*Math.floor(d)+Math.floor(l);R=i.childOffsets[R]+$,l%=1,d%=1}return{min:this.exaggeration()*i.minimums[R],max:this.exaggeration()*i.maximums[R]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const o=this.visibleDemTiles;if(o.length===0)return null;let e=!1,i=Number.MAX_VALUE,s=Number.MIN_VALUE;for(const f of o){const l=this.getMinMaxForTile(f.tileID);l&&(i=Math.min(i,l.min),s=Math.max(s,l.max),e=!0)}return e?{min:i,max:s}:null}},t.cK=S1,t.cL=Ii,t.cM=function(o,e){return[Math.pow(o[0],2.2)*e,Math.pow(o[1],2.2)*e,Math.pow(o[2],2.2)*e]},t.cN=ua,t.cO=B,t.cP=ie,t.cQ=256,t.cR=function(o,e){const i=[0,0,0],s=Ni(pn(e.canonical));return _e.vec3.transformMat4(i,i,s),_e.vec3.transformMat4(i,i,o),i},t.cS=o=>({u_camera_to_center_distance:new sn(o),u_extrude_scale:new Vh(o),u_device_pixel_ratio:new sn(o),u_matrix:new Hl(o),u_inv_rot_matrix:new Hl(o),u_merc_center:new Na(o),u_tile_id:new Uh(o),u_zoom_transition:new sn(o),u_up_dir:new Uh(o),u_emissive_strength:new sn(o)}),t.cT=o=>({u_matrix:new Hl(o),u_pixels_to_tile_units:new Vh(o),u_device_pixel_ratio:new sn(o),u_width_scale:new sn(o),u_floor_width_scale:new sn(o),u_units_to_pixels:new Na(o),u_dash_image:new Ws(o),u_gradient_image:new Ws(o),u_image_height:new sn(o),u_texsize:new Na(o),u_tile_units_to_pixels:new sn(o),u_alpha_discard_threshold:new sn(o),u_trim_offset:new Na(o),u_trim_fade_range:new Na(o),u_trim_color:new Gl(o),u_emissive_strength:new sn(o),u_zbias_factor:new sn(o),u_tile_to_meter:new sn(o)}),t.cU=o=>({u_matrix:new Hl(o),u_texsize:new Na(o),u_pixels_to_tile_units:new Vh(o),u_device_pixel_ratio:new sn(o),u_width_scale:new sn(o),u_floor_width_scale:new sn(o),u_image:new Ws(o),u_units_to_pixels:new Na(o),u_tile_units_to_pixels:new sn(o),u_alpha_discard_threshold:new sn(o),u_trim_offset:new Na(o),u_trim_fade_range:new Na(o),u_trim_color:new Gl(o),u_emissive_strength:new sn(o),u_zbias_factor:new sn(o),u_tile_to_meter:new sn(o)}),t.cV=ac,t.cW=OS,t.cX=zS,t.cY=_c,t.cZ=(o,e,i,s,f,l)=>{const d=o.transform,R=d.projection.name==="globe";let N;if(l.paint.get("circle-pitch-alignment")==="map")if(R){const I=ua(d.zoom,e.canonical)*d._pixelsPerMercatorPixel;N=Float32Array.from([I,0,0,I])}else N=d.calculatePixelsToTileUnitsMatrix(i);else N=new Float32Array([d.pixelsToGLUnits[0],0,0,d.pixelsToGLUnits[1]]);const $={u_camera_to_center_distance:o.transform.getCameraToCenterDistance(d.projection),u_matrix:o.translatePosMatrix(e.projMatrix,i,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_device_pixel_ratio:cr.devicePixelRatio,u_extrude_scale:N,u_inv_rot_matrix:$l,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:l.paint.get("circle-emissive-strength")};if(R){$.u_inv_rot_matrix=s,$.u_merc_center=f,$.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],$.u_zoom_transition=Zn(d.zoom);const I=f[0]*wr,j=f[1]*wr;$.u_up_dir=d.projection.upVector(new er(0,0,0),I,j)}return $},t.c_=Tv,t.ca=Gl,t.cb=function(o,e,i){const s=Math.sqrt(o*o+e*e+i*i),f=s>0?Math.acos(i/s)*it:0;let l=o!==0||e!==0?Math.atan2(-e,-o)*it+90:0;return l<0&&(l+=360),[s,l,f]},t.cc=n,t.cd=Xr,t.ce=Rt,t.cf=function(o){return[Math.pow(o[0],1/2.2),Math.pow(o[1],1/2.2),Math.pow(o[2],1/2.2)]},t.cg=function(o,e){return o.readFields(AM,{icons:[]},e)},t.ch=function(o){return o({pluginStatus:Yn,pluginURL:Po}),Us.on("pluginStateChange",o),o},t.ci=xp,t.cj=wc,t.ck=d_,t.cl=Wa,t.cm=Cl,t.cn=Pr,t.co=pl,t.cp=Ir,t.cq=function(o){const e=o.indexOf(ka);return e>=0?o.slice(0,e):o},t.cr=function(o){return o.indexOf(ka)>=0},t.cs=function(o){const e=o.indexOf(ka);return e>=0?o.slice(e+1):""},t.ct=function(o){const e=[],i=o.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),o.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},t.cu=function(o,e,i,s){return o.type==="custom"?new dM(o,e):new TM[o.type](o,e,i,s)},t.cv=Vr,t.cw=class extends Lc{constructor(o,e){super(o._vectorTileFeature,o._z,o._x,o._y,o.id),o.state&&(this.state={...o.state}),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=o.source,this.sourceLayer=o.sourceLayer,this.layer=o.layer)}toJSON(){const o=super.toJSON();return o.target=this.target,o.namespace=this.namespace,o}},t.cx=Us,t.cy=ea,t.cz=zd,t.d=function(o){return Q.API_TILEJSON_REGEX.test(o)},t.d$=fr,t.d0=(o,e,i,s,f,l,d,R,N)=>{const $=o.transform,I=$.calculatePixelsToTileUnitsMatrix(e),j=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",H=$.pitch<15?xv(.07,.7,le((14-$.zoom)/5,0,1)):.07;return{u_matrix:Ev(o,e,i,s),u_pixels_to_tile_units:I,u_device_pixel_ratio:l,u_width_scale:d,u_floor_width_scale:R,u_units_to_pixels:[1/$.pixelsToGLUnits[0],1/$.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:f,u_texsize:Sv(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:wv(e,o.transform),u_alpha_discard_threshold:0,u_trim_offset:N,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(j?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:H,u_tile_to_meter:n(e.tileID.canonical,0)}},t.d1=xr,t.d2=Hh,t.d3=hv,t.d4=Lr,t.d5=Xd,t.d6=Js,t.d7=450,t.d8=7,t.d9=fM,t.dA=ge,t.dB=r,t.dC=Bo,t.dD=function([o,e,i]){const s=Math.hypot(o,e,i),f=Math.atan2(o,i),l=.5*Math.PI-Math.acos(-e/s);return new Ai(de(f),de(l))},t.dE=M_,t.dF=function(o){const e=o.navigator?o.navigator.userAgent:null;return!!function(i){if(sr==null){const s=i.navigator?i.navigator.userAgent:null;sr=!!i.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return sr}(o)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},t.dG=function(o,e){Br=o,Ur=e},t.dH=ca,t.dI=ja,t.dJ=function(o){const e=[0,0,0],i=_e.mat4.identity(new Float64Array(16));return _e.mat4.multiply(i,o.pixelMatrix,o.globeMatrix),_e.vec3.transformMat4(e,e,i),new Ge(e[0],e[1])},t.dK=function(o,e,i=!1){if(Yn===Th||Yn===Xa||Yn===Sh)throw new Error("setRTLTextPlugin cannot be called multiple times.");Po=cr.resolveURL(o),Yn=Th,Mh=e,Xu(),i||vd()},t.dL=Yu,t.dM=function(){xp().acquire(D_)},t.dN=function(){const o=df;o&&(o.isPreloaded()&&o.numActive()===1?(o.release(D_),df=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},t.dO=Ql,t.dP=function(o){const e=Wr();if(!e)return;const i=e.delete(Jr);o&&i.catch(o).then(()=>o())},t.dQ=ff,t.dR=mx,t.dS=function(o){G_=cr.resolveURL(o),Dc||(Dc=new Ac(xp(),new Ts)),Dc.broadcast("setDracoUrl",G_)},t.dT=_x,t.dU=function(o){Rc=cr.resolveURL(o),Dc||(Dc=new Ac(xp(),new Ts)),Dc.broadcast("setMeshoptUrl",Rc)},t.dV=Dr,t.dW=Ks,t.dX=vo,t.dY=Sx,t.dZ=Mx,t.d_=gv,t.da=Ri,t.db=Fh,t.dc=256,t.dd=jn,t.de=fo,t.df=oa,t.dg=sc,t.dh=function(o,e,i,s,f){return le((o-e)/(i-e)*(f-s)+s,s,f)},t.di=uh,t.dj=u,t.dk=class{constructor(o,e,i,s){this.context=o,this.format=s,this.size=i,this.texture=o.gl.createTexture();const[f,l,d]=this.size,{gl:R}=o;R.bindTexture(R.TEXTURE_3D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(!1),R.texImage3D(R.TEXTURE_3D,0,this.format,f,l,d,0,w_(this.format),E_(this.format),e.data)}bind(o,e){const{context:i}=this,{gl:s}=i;s.bindTexture(s.TEXTURE_3D,this.texture),o!==this.minFilter&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MAG_FILTER,o),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MIN_FILTER,o),this.minFilter=o),e!==this.wrapS&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_S,e),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}},t.dl=A_,t.dm=[1,1,1],t.dn=Mc,t.dp=Sc,t.dq=Oo,t.dr=ss,t.ds=Ys,t.dt=kh,t.du=zh,t.dv=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ge(1/0,1/0),max:new Ge(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(o,e=!1){const i=Z1(new Ge(0,0),new Ge(wr,wr),o),s=[];if(e&&!Jm(i,this._globalClipBounds))return s;for(const f of this._activeRegions){if(f.hiddenByOverlap||!Jm(i,f))continue;const l=sS(f.min,f.max,o);s.push({min:l.min,max:l.max,sourceId:this._sourceIds[f.priority],footprint:f.footprint,footprintTileId:f.tileId,order:f.order,clipMask:f.clipMask,clipScope:f.clipScope})}return s}setSources(o){this._setSources(o.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const s of e.cache.getVisibleCoordinates()){const f=e.cache.getTile(s).buckets[e.layer];f&&f.updateFootprints(s.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(o){const e=o.getFootprints();if(e.length===0)return;const i=o.getOrder(),s=o.getClipMask(),f=o.getClipScope();for(const l of e){if(!l.footprint)continue;const d=Z1(l.footprint.min,l.footprint.max,l.id);this._activeRegions.push({min:d.min,max:d.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:l.id,footprint:l.footprint,order:i,clipMask:s,clipScope:f})}this._sourceIds.push(o.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||$d(e.min,i.min)||$d(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(s,f){const l=(d,R)=>d+R;return s.length-f.length||s.reduce(l,"").localeCompare(f.reduce(l,""))}(e.clipScope,i.clipScope));let o=this._activeRegions.length!==this._prevRegions.length;if(!o){let e=0;for(;!o&&e!==this._activeRegions.length;){const i=this._activeRegions[e],s=this._prevRegions[e];o=i.priority!==s.priority||!$1(i,s)||i.order!==s.order||i.clipMask!==s.clipMask||!We(i.clipScope,s.clipScope),++e}}if(o){++this._updateTime;for(const i of this._activeRegions)i.order!==Wd&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const s=this._activeRegions;if(i>=s.length)return i;const f=s[i].priority;for(;i<s.length&&s[i].priority===f;)++i;return i};if(this._sourceIds.length>1){let i=0,s=e(i);for(;i!==s;){let f=i;const l=i;for(;f!==s;){const d=this._activeRegions[f];d.hiddenByOverlap=!1;for(let R=0;R<l;R++){const N=this._activeRegions[R];if(!N.hiddenByOverlap&&d.order===Wd&&Jm(d,N)&&(d.hiddenByOverlap=Y1(d.footprint,d.tileId,N.footprint,N.tileId),d.hiddenByOverlap))break}++f}i=s,s=e(i)}}}}_setSources(o){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=o.length-1;e>=0;e--)this._addSource(o[e]);this._computeReplacement()}},t.dw=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy()}_fillGridMeshWithLods(o,e){const i=new Fa,s=new zn,f=[],l=o+1+2,d=e[0]+1,R=e[0]+1+(1+e.length),N=($,I,j)=>{let H=$===l-1?$-2:$===0?$:$-1;return H+=j?24575:0,[H,I]};for(let $=0;$<l;++$)i.emplaceBack(...N($,0,!0));for(let $=0;$<d;++$)for(let I=0;I<l;++I)i.emplaceBack(...N(I,$,(I===0||I===l-1)&&!0));for(let $=0;$<e.length;++$){const I=e[$];for(let j=0;j<l;++j)i.emplaceBack(...N(j,I,!0))}for(let $=0;$<e.length;++$){const I=s.length,j=e[$]+1+2,H=new zn;for(let Y=0;Y<j-1;Y++){const oe=Y===j-2,ce=oe?l*(R-e.length+$-Y):l;for(let we=0;we<l-1;we++){const Ie=Y*l+we;Y===0||oe||we===0||we===l-2?(H.emplaceBack(Ie+1,Ie,Ie+ce),H.emplaceBack(Ie+ce,Ie+ce+1,Ie+1)):(s.emplaceBack(Ie+1,Ie,Ie+ce),s.emplaceBack(Ie+ce,Ie+ce+1,Ie+1))}}const F=hn.simpleSegment(0,I,i.length,s.length-I);for(let Y=0;Y<H.uint16.length;Y+=3)s.emplaceBack(H.uint16[Y],H.uint16[Y+1],H.uint16[Y+2]);const V=hn.simpleSegment(0,I,i.length,s.length-I);f.push({withoutSkirts:F,withSkirts:V})}return{vertices:i,indices:s,segments:f}}_createGrid(o){const e=this._fillGridMeshWithLods(cs,mc);this._gridSegments=e.segments,this._gridBuffer=o.createVertexBuffer(e.vertices,ii.members),this._gridIndexBuffer=o.createIndexBuffer(e.indices,!0)}_createPoles(o){const e=new zn;for(let d=0;d<=cs;d++)e.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=o.createIndexBuffer(e,!0);const i=new oa,s=new oa,f=new oa,l=new oa;this._poleSegments=[];for(let d=0,R=0;d<pc;d++){const N=360/(1<<d);i.emplaceBack(0,-Hn,0,.5,0),s.emplaceBack(0,-Hn,0,.5,1),f.emplaceBack(0,-Hn,0,.5,.5),l.emplaceBack(0,-Hn,0,.5,.5);for(let $=0;$<=cs;$++){let I=$/cs,j=0;const H=Qr(0,N,I),[F,V,Y]=Xs(Ka,hs,H,Hn);i.emplaceBack(F,V,Y,I,j),s.emplaceBack(F,V,Y,I,1-j);const oe=ze(H);I=.5+.5*Math.sin(oe),j=.5+.5*Math.cos(oe),f.emplaceBack(F,V,Y,I,j),l.emplaceBack(F,V,Y,I,1-j)}this._poleSegments.push(hn.simpleSegment(R,0,66,64)),R+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(i,Gr,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(s,Gr,!1),this._texturedPoleNorthVertexBuffer=o.createVertexBuffer(f,Gr,!1),this._texturedPoleSouthVertexBuffer=o.createVertexBuffer(l,Gr,!1)}getGridBuffers(o,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}},t.dx=Wd,t.dy=Oe,t.dz=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},t.e=Q,t.e0=$a,t.e1=qv,t.e2=function(o,e,i,s,f,l,d,R,N,$,I=1,j,H){o.createArrays(),o.tilePixelRatio=wr/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const F=o.layers[0].layout,V=o.layers[0]._unevaluatedLayout._values,Y={};Y.scaleFactor=I,Y.textSizeScaleRange=F.get("text-size-scale-range"),Y.iconSizeScaleRange=F.get("icon-size-scale-range");const[oe,ce]=Y.textSizeScaleRange,[we,Ie]=Y.iconSizeScaleRange;if(Y.textScaleFactor=le(Y.scaleFactor,oe,ce),Y.iconScaleFactor=le(Y.scaleFactor,we,Ie),o.textSizeData.kind==="composite"){const{minZoom:$e,maxZoom:ct}=o.textSizeData;Y.compositeTextSizes=[V["text-size"].possiblyEvaluate(new Xi($e),R),V["text-size"].possiblyEvaluate(new Xi(ct),R)]}if(o.iconSizeData.kind==="composite"){const{minZoom:$e,maxZoom:ct}=o.iconSizeData;Y.compositeIconSizes=[V["icon-size"].possiblyEvaluate(new Xi($e),R),V["icon-size"].possiblyEvaluate(new Xi(ct),R)]}Y.layoutTextSize=V["text-size"].possiblyEvaluate(new Xi(N+1),R),Y.layoutIconSize=V["icon-size"].possiblyEvaluate(new Xi(N+1),R),Y.textMaxSize=V["text-size"].possiblyEvaluate(new Xi(18),R);const me=F.get("text-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",Re=F.get("text-size");let Ue=!1;for(const $e of o.features)if($e.icon&&$e.icon.nameSecondary){Ue=!0;break}for(const $e of o.features){const ct=F.get("text-font").evaluate($e,{},R).join(","),lt=Re.evaluate($e,{},R)*Y.textScaleFactor,st=Y.layoutTextSize.evaluate($e,{},R)*Y.textScaleFactor,xt=(Y.layoutIconSize.evaluate($e,{},R),{horizontal:{},vertical:void 0}),dt=$e.text;let Et,It=[0,0];if(dt){const jt=dt.toString(),Ot=F.get("text-letter-spacing").evaluate($e,{},R)*Vn,Kt=F.get("text-line-height").evaluate($e,{},R)*Vn,ur=_d(jt)?Ot:0,Jt=F.get("text-anchor").evaluate($e,{},R),yr=F.get("text-variable-anchor");if(!yr){const vr=F.get("text-radial-offset").evaluate($e,{},R);It=vr?Kv(Jt,[vr*Vn,p_]):F.get("text-offset").evaluate($e,{},R).map(zr=>zr*Vn)}let _r=me?"center":F.get("text-justify").evaluate($e,{},R);const Er=F.get("symbol-placement")==="point",rr=Er?F.get("text-max-width").evaluate($e,{},R)*Vn:1/0,kr=vr=>{o.allowVerticalPlacement&&xh(jt)&&(xt.vertical=c_(dt,e,i,f,ct,rr,Kt,Jt,vr,ur,It,Va.vertical,!0,st,lt))};if(!me&&yr){const vr=_r==="auto"?yr.map(Yr=>m_(Yr)):[_r];let zr=!1;for(let Yr=0;Yr<vr.length;Yr++){const li=vr[Yr];if(!xt.horizontal[li])if(zr)xt.horizontal[li]=xt.horizontal[0];else{const ci=c_(dt,e,i,f,ct,rr,Kt,"center",li,ur,It,Va.horizontal,!1,st,lt);ci&&(xt.horizontal[li]=ci,zr=ci.positionedLines.length===1)}}kr("left")}else{if(_r==="auto"&&(_r=m_(Jt)),Er||F.get("text-writing-mode").indexOf("horizontal")>=0||!xh(jt)){const vr=c_(dt,e,i,f,ct,rr,Kt,Jt,_r,ur,It,Va.horizontal,!1,st,lt);vr&&(xt.horizontal[_r]=vr)}kr(Er?"left":_r)}}let Mt=!1,Ct=!1;if($e.icon&&$e.icon.namePrimary){const jt=Yd(o.iconSizeData,V["icon-size"],R,o.zoom,$e)*Y.iconScaleFactor*j,Ot=$e.icon.getPrimary().scaleSelf(jt).serialize(),Kt=s[Ot];Kt&&(Et=WS(f[Ot],$e.icon.nameSecondary?f[$e.icon.getSecondary().scaleSelf(jt).serialize()]:void 0,F.get("icon-offset").evaluate($e,{},R),F.get("icon-anchor").evaluate($e,{},R)),Mt=Kt.sdf,Ct=Kt.usvg,o.sdfIcons===void 0?o.sdfIcons=Kt.sdf:o.sdfIcons!==Kt.sdf&&St("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Kt.pixelRatio!==o.pixelRatio||F.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}const kt=Qv(xt.horizontal)||xt.vertical;o.iconsInText||(o.iconsInText=!!kt&&kt.iconsInText),(kt||Et)&&QS(o,$e,xt,Et,s,Y,st,0,It,Mt,Ct,d,R,$,H,Ue)}l&&o.generateCollisionDebugBuffers(N,o.collisionBoxArray,Y.textScaleFactor)},t.e3=vc,t.e4=Ap,t.e5=tt,t.e6=V1,t.e7=Rv,t.e8=S,t.e9=function(o){let e=0;if(new Uint32Array(o,0,1)[0]!==yx){const i=new Uint32Array(o,0,7),[,,s,f,l,d]=i;e=i.byteLength+f+l+d+l,(s!==o.byteLength||e>=o.byteLength)&&St("Invalid b3dm header information.")}return wx(o,e)},t.ea=function(o,e){const i=Tx(o);for(const s of i){for(const f of s.meshes)IA(f);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(PA(s.lights,e)))}return i},t.eb=bp,t.ec=Ub,t.ed=Ta,t.ee=function(o){Pi(),si?.then(e=>{e.keys().then(i=>{for(let s=0;s<i.length-o;s++)e.delete(i[s])})})},t.f=function(o){return o.indexOf("mapbox:")===0},t.g=function(o,e){return ea(Wt(o,{method:"GET"}),e)},t.h=xe,t.i=function(o){return Q.API_STYLE_REGEX.test(o)&&!Ne(o)},t.j=function(o){return decodeURIComponent(atob(o).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},t.k=function(o){return btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},t.l=Wt,t.m=xn,t.n=function(o,e){return ea(Wt(o,{type:"json"}),e)},t.o=hu,t.p=function(o,e){return ea(Wt(o,{method:"POST"}),e)},t.q=cr,t.r=Xn,t.s=function(o){try{const e=self[o];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},t.t=Yt,t.u=function(){return function o(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()},t.v=function(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)},t.w=St,t.x=function(){return L_||(L_=new Ql),L_},t.y=Mo,t.z=So}),b(["./shared"],function(t){function S(Qe){const ie=Qe?Qe.url.toString():void 0;return ie?performance.getEntriesByName(ie):[]}function D(Qe){if(typeof Qe=="number"||typeof Qe=="boolean"||typeof Qe=="string"||Qe==null)return JSON.stringify(Qe);if(Array.isArray(Qe)){let B="[";for(const Q of Qe)B+=`${D(Q)},`;return`${B}]`}let ie="{";for(const B of Object.keys(Qe).sort())ie+=`${B}:${D(Qe[B])},`;return`${ie}}`}function w(Qe){let ie="";for(const B of t.bm)ie+=`/${D(Qe[B])}`;return ie}class E{constructor(ie){this.keyCache={},this._layers={},this._layerConfigs={},ie&&this.replace(ie)}replace(ie,B){this._layerConfigs={},this._layers={},this.update(ie,[],B)}update(ie,B,Q){this._options=Q;for(const Ne of ie)this._layerConfigs[Ne.id]=Ne,(this._layers[Ne.id]=t.cu(Ne,this.scope,null,this._options)).compileFilter(Q),this.keyCache[Ne.id]&&delete this.keyCache[Ne.id];for(const Ne of B)delete this.keyCache[Ne],delete this._layerConfigs[Ne],delete this._layers[Ne];this.familiesBySource={};const xe=function(Ne,Ze){const ot={};for(let Nt=0;Nt<Ne.length;Nt++){const Bt=Ne[Nt];let Lt=Ze&&Ze[Bt.id];!Lt&&(Lt=w(Bt),Bt.type==="line"&&Bt.paint)&&function cr(gr){return typeof gr=="string"&&gr==="line-progress"||(Array.isArray(gr)?gr.some(cr):!(!gr||typeof gr!="object")&&Object.values(gr).some(cr))}(Bt.paint["line-width"])&&(Lt+=`/${D(Bt.paint["line-width"])}`),Ze&&(Ze[Bt.id]=Lt);let Yt=ot[Lt];Yt||(Yt=ot[Lt]=[]),Yt.push(Bt)}const mt=[];for(const Nt in ot)mt.push(ot[Nt]);return mt}(t.bj(this._layerConfigs),this.keyCache);for(const Ne of xe){const Ze=Ne.map(Yt=>this._layers[Yt.id]),ot=Ze[0];if(ot.visibility==="none")continue;const mt=ot.source||"";let Nt=this.familiesBySource[mt];Nt||(Nt=this.familiesBySource[mt]={});const Bt=ot.sourceLayer||"_geojsonTileLayer";let Lt=Nt[Bt];Lt||(Lt=Nt[Bt]=[]),Lt.push(Ze)}}}const m=1*t.dX;class y{constructor(ie){const B={},Q=[];for(const ot in ie){const mt=ie[ot],Nt=B[ot]={};for(const Bt in mt.glyphs){const Lt=mt.glyphs[+Bt];if(!Lt||Lt.bitmap.width===0||Lt.bitmap.height===0)continue;const Yt=Lt.metrics.localGlyph?m:1,cr={x:0,y:0,w:Lt.bitmap.width+2*Yt,h:Lt.bitmap.height+2*Yt};Q.push(cr),Nt[Bt]=cr}}const{w:xe,h:Ne}=t.C(Q),Ze=new t.dW({width:xe||1,height:Ne||1});for(const ot in ie){const mt=ie[ot];for(const Nt in mt.glyphs){const Bt=mt.glyphs[+Nt];if(!Bt||Bt.bitmap.width===0||Bt.bitmap.height===0)continue;const Lt=B[ot][Nt],Yt=Bt.metrics.localGlyph?m:1;t.dW.copy(Bt.bitmap,Ze,{x:0,y:0},{x:Lt.x+Yt,y:Lt.y+Yt},Bt.bitmap)}}this.image=Ze,this.positions=B}}t.dV(y,"GlyphAtlas");class p{constructor(ie){this.tileID=new t.aG(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),this.tileZoom=ie.tileZoom,this.uid=ie.uid,this.zoom=ie.zoom,this.lut=ie.lut,this.canonical=ie.tileID.canonical,this.pixelRatio=ie.pixelRatio,this.tileSize=ie.tileSize,this.source=ie.source,this.scope=ie.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ie.showCollisionBoxes,this.collectResourceTiming=!!ie.request&&ie.request.collectResourceTiming,this.promoteId=ie.promoteId,this.isSymbolTile=ie.isSymbolTile,this.tileTransform=t.aQ(ie.tileID.canonical,ie.projection),this.projection=ie.projection,this.worldview=ie.worldview,this.localizableLayerIds=ie.localizableLayerIds,this.brightness=ie.brightness,this.extraShadowCaster=!!ie.extraShadowCaster,this.tessellationStep=ie.tessellationStep,this.scaleFactor=ie.scaleFactor}parse(ie,B,Q,xe,Ne){this.status="parsing",this.data=ie,this.collisionBoxArray=new t.aW;const Ze=new t.dY(Object.keys(ie.layers).sort()),ot=new t.dZ(this.tileID,this.promoteId);ot.bucketLayerIDs=[];const mt={},Nt=new t.d_(256,256),Bt={featureIndex:ot,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Nt,availableImages:Q,brightness:this.brightness,scaleFactor:this.scaleFactor},Lt=B.familiesBySource[this.source];for(const Ur in Lt){const oi=ie.layers[Ur];if(!oi)continue;let si=!1,Kr=!1,Wr=!1;for(const xn of Lt[Ur])xn[0].type==="symbol"?si=!0:Kr=!0,xn[0].is3D()&&xn[0].type!=="model"&&(Wr=!0);if(this.extraShadowCaster&&!Wr||this.isSymbolTile===!0&&!si||this.isSymbolTile===!1&&!Kr)continue;oi.version===1&&t.w(`Vector tile source "${this.source}" layer "${Ur}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Pi=Ze.encode(Ur),Ki=[];for(let xn=0,en=0;xn<oi.length;xn++){const ut=oi.feature(xn),_t=ot.getId(ut,Ur);if(this.localizableLayerIds&&this.localizableLayerIds.has(Ur)){const Vt=ut.properties?ut.properties.worldview:null;if(this.worldview&&typeof Vt=="string")if(Vt==="all")ut.properties.$localized=!0;else{if(!Vt.split(",").includes(this.worldview))continue;ut.properties.$localized=!0,ut.properties.worldview=this.worldview}}Ki.push({feature:ut,id:_t,index:en,sourceLayerIndex:Pi}),en++}for(const xn of Lt[Ur]){const en=xn[0];(!this.extraShadowCaster||en.is3D()&&en.type!=="model")&&(this.isSymbolTile!==void 0&&en.type==="symbol"!==this.isSymbolTile||en.minzoom&&this.zoom<Math.floor(en.minzoom)||en.maxzoom&&this.zoom>=en.maxzoom||en.visibility!=="none"&&(C(xn,this.zoom,Bt.brightness,Q),(mt[en.id]=en.createBucket({index:ot.bucketLayerIDs.length,layers:xn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Pi,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Ki,Bt,this.tileID.canonical,this.tileTransform),ot.bucketLayerIDs.push(xn.map(ut=>t.aC(ut.id,ut.scope)))))}}let Yt,cr,gr,Pr;Nt.trim();const Jr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Br=()=>{if(Yt)return this.status="done",Ne(Yt);if(this.extraShadowCaster)this.status="done",Ne(null,{buckets:t.bj(mt).filter(Ur=>!Ur.isEmpty()),featureIndex:ot,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Bt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(cr&&gr&&Pr){const Ur=new y(cr),oi=new t.e1(gr,Pr,this.lut);for(const si in mt){const Kr=mt[si];Kr instanceof t.aX?(C(Kr.layers,this.zoom,Bt.brightness,Q),t.e2(Kr,cr,Ur.positions,gr,oi.iconPositions,this.showCollisionBoxes,Q,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.pixelRatio,this.brightness)):Kr.hasPattern&&(Kr instanceof t.b1||Kr instanceof t.b2||Kr instanceof t.d5)&&(C(Kr.layers,this.zoom,Bt.brightness,Q),Kr.addFeatures(Bt,this.tileID.canonical,oi.patternPositions,Q,this.tileTransform,this.brightness))}this.status="done",Ne(null,{buckets:t.bj(mt).filter(si=>!si.isEmpty()),featureIndex:ot,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ur.image,lineAtlas:Nt,imageAtlas:oi,brightness:Bt.brightness})}};if(!this.extraShadowCaster){const Ur=t.d$(Bt.glyphDependencies,Kr=>Object.keys(Kr).map(Number));Object.keys(Ur).length?xe.send("getGlyphs",{uid:this.uid,stacks:Ur,scope:this.scope},(Kr,Wr)=>{Yt||(Yt=Kr,cr=Wr,Br())},void 0,!1,Jr):cr={};const oi=Object.keys(Bt.iconDependencies);oi.length?xe.send("getImages",{icons:oi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Kr,Wr)=>{if(Yt)return;Yt=Kr;const Pi={};Object.values(Wr).some(Ki=>Ki.usvg)?this.rasterize(xe,Pi,Wr,Bt.iconDependencies,()=>{gr=Pi,Br()}):(this.fillImageMap(Pi,Bt.iconDependencies,Wr),gr=Pi,Br())},void 0,!1,Jr):gr={};const si=Object.keys(Bt.patternDependencies);si.length?xe.send("getImages",{icons:si,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Kr,Wr)=>{if(!Yt){Yt=Kr;const Pi={};Object.values(Wr).some(Ki=>Ki.usvg)?this.rasterize(xe,Pi,Wr,Bt.patternDependencies,()=>{Pr=Pi,Br()}):(this.fillImageMap(Pi,Bt.patternDependencies,Wr),Pr=Pi,Br())}},void 0,!1,Jr):Pr={}}Br()}fillImageMap(ie,B,Q){for(const xe in Q){const Ne=B[xe]||[];for(const Ze of Ne)Q[Ze.id].usvg||(ie[Ze.serialize()]=Q[Ze.id])}}getImageTaskQueue(ie,B,Q){const xe={};for(const Ne in B){const Ze=Q[Ne]||[];for(const ot of Ze){const mt=ot.serialize();B[ot.id].usvg?xe[mt]||(xe[mt]=ot):ie[mt]=B[ot.id]}}return xe}rasterize(ie,B,Q,xe,Ne){const Ze=this.getImageTaskQueue(B,Q,xe);this.rasterizeTask=ie.send("rasterizeImages",{scope:this.scope,imageTasks:Ze},(ot,mt)=>{if(!ot)for(const Nt in mt){const{id:Bt}=t.e0.deserializeFromString(Nt);B[Nt]=Object.assign({},Q[Bt],{data:mt[Nt]})}Ne()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function C(Qe,ie,B,Q){const xe=new t.a8(ie,{brightness:B});for(const Ne of Qe)Ne.recalculate(xe,Q)}class z extends t.E{constructor(ie,B,Q,xe,Ne,Ze){super(),this.actor=ie,this.layerIndex=B,this.availableImages=Q,this.loadVectorData=Ne||t.aD,this.loading={},this.loaded={},this.deduped=new t.aB(ie.scheduler),this.isSpriteLoaded=xe,this.scheduler=ie.scheduler,this.brightness=Ze}loadTile(ie,B){const Q=ie.uid,xe=ie&&ie.request,Ne=xe&&xe.collectResourceTiming,Ze=this.loading[Q]=new p(ie);Ze.abort=this.loadVectorData(ie,(ot,mt)=>{const Nt=!this.loading[Q];if(delete this.loading[Q],Ze.cancelRasterize(),Nt||ot||!mt)return Ze.status="done",Nt||(this.loaded[Q]=Ze),B(ot);const Bt=mt.rawData,Lt={};mt.expires&&(Lt.expires=mt.expires),mt.cacheControl&&(Lt.cacheControl=mt.cacheControl),Ze.vectorTile=mt.vectorTile||new t.e3.VectorTile(new t.bh(Bt));const Yt=()=>{Ze.parse(Ze.vectorTile,this.layerIndex,this.availableImages,this.actor,(cr,gr)=>{if(cr||!gr)return B(cr);const Pr={};if(Ne){const Jr=S(xe);Jr.length>0&&(Pr.resourceTiming=JSON.parse(JSON.stringify(Jr)))}B(null,t.l({rawTileData:Bt.slice(0)},gr,Lt,Pr))})};this.isSpriteLoaded?Yt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Yt,{type:"parseTile",isSymbolTile:ie.isSymbolTile,zoom:ie.tileZoom}):Yt()}),this.loaded=this.loaded||{},this.loaded[Q]=Ze})}reloadTile(ie,B){const Q=this.loaded,xe=ie.uid;if(Q&&Q[xe]){const Ne=Q[xe];Ne.scaleFactor=ie.scaleFactor,Ne.showCollisionBoxes=ie.showCollisionBoxes,Ne.projection=ie.projection,Ne.brightness=ie.brightness,Ne.tileTransform=t.aQ(ie.tileID.canonical,ie.projection),Ne.extraShadowCaster=ie.extraShadowCaster,Ne.lut=ie.lut;const Ze=(ot,mt)=>{const Nt=Ne.reloadCallback;Nt&&(delete Ne.reloadCallback,Ne.parse(Ne.vectorTile,this.layerIndex,this.availableImages,this.actor,Nt)),B(ot,mt)};Ne.status==="parsing"?Ne.reloadCallback=Ze:Ne.status==="done"&&(Ne.vectorTile?Ne.parse(Ne.vectorTile,this.layerIndex,this.availableImages,this.actor,Ze):Ze())}else B(null,void 0)}abortTile(ie,B){const Q=ie.uid,xe=this.loading[Q];xe&&(xe.abort&&xe.abort(),delete this.loading[Q]),B()}removeTile(ie,B){const Q=this.loaded,xe=ie.uid;Q&&Q[xe]&&delete Q[xe],B()}}class A{loadTile(ie,B){const{uid:Q,encoding:xe,rawImageData:Ne,padding:Ze}=ie,ot=ImageBitmap&&Ne instanceof ImageBitmap?this.getImageData(Ne,Ze):Ne;B(null,new t.e4(Q,ot,xe,Ze<1))}getImageData(ie,B){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ie.width,ie.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ie.width,this.offscreenCanvas.height=ie.height,this.offscreenCanvasContext.drawImage(ie,0,0,ie.width,ie.height);const Q=this.offscreenCanvasContext.getImageData(-B,-B,ie.width+2*B,ie.height+2*B);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Q}}t.bg.setPbf(t.bh);class P{decodeRasterArray({task:ie,buffer:B},Q){t.bg.performDecoding(B,ie).then(xe=>{Q(null,xe)},xe=>{Q(xe)})}}const x=t.e3.VectorTileFeature.prototype.toGeoJSON;class O{constructor(ie){this._feature=ie,this.extent=t.ag,this.type=ie.type,this.properties=ie.tags,"id"in ie&&!isNaN(ie.id)&&(this.id=parseInt(ie.id,10))}loadGeometry(){if(this._feature.type===1){const ie=[];for(const B of this._feature.geometry)ie.push([new t.P(B[0],B[1])]);return ie}{const ie=[];for(const B of this._feature.geometry){const Q=[];for(const xe of B)Q.push(new t.P(xe[0],xe[1]));ie.push(Q)}return ie}}toGeoJSON(ie,B,Q){return x.call(this,ie,B,Q)}}class U{constructor(ie){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.ag,this.length=ie.length,this._features=ie}feature(ie){return new O(this._features[ie])}}const G=64/4096,Z=128;class X{constructor(){this.features=new Map}clear(){this.features.clear()}load(ie=[],B){for(const Q of ie){const xe=Q.id;if(xe==null)continue;let Ne=this.features.get(xe);Ne&&this.updateCache(Ne,B),Q.geometry?(Ne=J(Q),this.updateCache(Ne,B),this.features.set(xe,Ne)):this.features.delete(xe),this.updateCache(Ne,B)}}updateCache(ie,B){for(const{canonical:Q,uid:xe}of Object.values(B)){const{z:Ne,x:Ze,y:ot}=Q;W(ie,Math.pow(2,Ne),Ze,ot)&&delete B[xe]}}getTile(ie,B,Q){const xe=Math.pow(2,ie),Ne=[];for(const Ze of this.features.values())W(Ze,xe,B,Q)&&Ne.push(ue(Ze,xe,B,Q));return{features:Ne}}getFeatures(){return[...this.features.values()]}}function W({minX:Qe,minY:ie,maxX:B,maxY:Q},xe,Ne,Ze){return Qe<(Ne+1+G)/xe&&ie<(Ze+1+G)/xe&&B>(Ne-G)/xe&&Q>(Ze-G)/xe}function J(Qe){const{id:ie,geometry:B,properties:Q}=Qe;if(!B)return;if(B.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:xe,coordinates:Ne}=B,Ze={id:ie,type:1,geometry:[],tags:Q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},ot=Ze.geometry;if(xe==="Point")re(Ne,ot,Ze);else if(xe==="MultiPoint")for(const mt of Ne)re(mt,ot,Ze);else if(xe==="LineString")Ze.type=2,te(Ne,ot,Ze);else if(xe==="MultiLineString")Ze.type=2,ye(Ne,ot,Ze);else if(xe==="Polygon")Ze.type=3,ye(Ne,ot,Ze,!0);else{if(xe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ze.type=3;for(const mt of Ne)ye(mt,ot,Ze,!0)}return Ze}function re([Qe,ie],B,Q){const xe=t.at(Qe);let Ne=t.aA(ie);Ne=Ne<0?0:Ne>1?1:Ne,B.push(xe,Ne),Q.minX=Math.min(Q.minX,xe),Q.minY=Math.min(Q.minY,Ne),Q.maxX=Math.max(Q.maxX,xe),Q.maxY=Math.max(Q.maxY,Ne)}function te(Qe,ie,B,Q=!1,xe=!1){const Ne=[];for(const Ze of Qe)re(Ze,Ne,B);ie.push(Ne),Q&&function(Ze,ot){let mt=0;for(let Nt=0,Bt=Ze.length,Lt=Bt-2;Nt<Bt;Lt=Nt,Nt+=2)mt+=(Ze[Nt]-Ze[Lt])*(Ze[Nt+1]+Ze[Lt+1]);if(mt>0===ot)for(let Nt=0,Bt=Ze.length;Nt<Bt/2;Nt+=2){const Lt=Ze[Nt],Yt=Ze[Nt+1];Ze[Nt]=Ze[Bt-2-Nt],Ze[Nt+1]=Ze[Bt-1-Nt],Ze[Bt-2-Nt]=Lt,Ze[Bt-1-Nt]=Yt}}(Ne,xe)}function ye(Qe,ie,B,Q=!1){for(let xe=0;xe<Qe.length;xe++)te(Qe[xe],ie,B,Q,xe===0)}function ue(Qe,ie,B,Q){const{id:xe,type:Ne,geometry:Ze,tags:ot}=Qe,mt=[];if(Ne===1)(function(Nt,Bt,Lt,Yt,cr){for(let gr=0;gr<Nt.length;gr+=2){const Pr=Math.round(t.ag*(Nt[gr+0]*Bt-Lt)),Jr=Math.round(t.ag*(Nt[gr+1]*Bt-Yt));cr.push([Pr,Jr])}})(Ze,ie,B,Q,mt);else for(const Nt of Ze)Se(Nt,ie,B,Q,mt);return{id:xe,type:Ne,geometry:mt,tags:ot}}function Se(Qe,ie,B,Q,xe){const Ze=t.ag+Z;let ot;for(let mt=0;mt<Qe.length-2;mt+=2){let Nt=Math.round(t.ag*(Qe[mt+0]*ie-B)),Bt=Math.round(t.ag*(Qe[mt+1]*ie-Q)),Lt=Math.round(t.ag*(Qe[mt+2]*ie-B)),Yt=Math.round(t.ag*(Qe[mt+3]*ie-Q));const cr=Lt-Nt,gr=Yt-Bt;Nt<-128&&Lt<-128||(Nt<-128?(Bt+=Math.round(gr*((-128-Nt)/cr)),Nt=-128):Lt<-128&&(Yt=Bt+Math.round(gr*((-128-Nt)/cr)),Lt=-128),Bt<-128&&Yt<-128||(Bt<-128?(Nt+=Math.round(cr*((-128-Bt)/gr)),Bt=-128):Yt<-128&&(Lt=Nt+Math.round(cr*((-128-Bt)/gr)),Yt=-128),Nt>=Ze&&Lt>=Ze||(Nt>=Ze?(Bt+=Math.round(gr*((Ze-Nt)/cr)),Nt=Ze):Lt>=Ze&&(Yt=Bt+Math.round(gr*((Ze-Nt)/cr)),Lt=Ze),Bt>=Ze&&Yt>=Ze||(Bt>=Ze?(Nt+=Math.round(cr*((Ze-Bt)/gr)),Bt=Ze):Yt>=Ze&&(Lt=Nt+Math.round(cr*((Ze-Bt)/gr)),Yt=Ze),ot&&Nt===ot[ot.length-1][0]&&Bt===ot[ot.length-1][1]||(ot=[[Nt,Bt]],xe.push(ot)),ot.push([Lt,Yt])))))}}var Le,Pe,Ee,Me={exports:{}},He=function(){if(Ee)return Me.exports;Ee=1;var Qe=t.e7(),ie=function(){if(Pe)return Le;Pe=1;var Bt=t.e5(),Lt=t.e6().VectorTileFeature;function Yt(gr,Pr){this.options=Pr||{},this.features=gr,this.length=gr.length}function cr(gr,Pr){this.id=typeof gr.id=="number"?gr.id:void 0,this.type=gr.type,this.rawGeometry=gr.type===1?[gr.geometry]:gr.geometry,this.properties=gr.tags,this.extent=Pr||4096}return Le=Yt,Yt.prototype.feature=function(gr){return new cr(this.features[gr],this.options.extent)},cr.prototype.loadGeometry=function(){var gr=this.rawGeometry;this.geometry=[];for(var Pr=0;Pr<gr.length;Pr++){for(var Jr=gr[Pr],Br=[],Ur=0;Ur<Jr.length;Ur++)Br.push(new Bt(Jr[Ur][0],Jr[Ur][1]));this.geometry.push(Br)}return this.geometry},cr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var gr=this.geometry,Pr=1/0,Jr=-1/0,Br=1/0,Ur=-1/0,oi=0;oi<gr.length;oi++)for(var si=gr[oi],Kr=0;Kr<si.length;Kr++){var Wr=si[Kr];Pr=Math.min(Pr,Wr.x),Jr=Math.max(Jr,Wr.x),Br=Math.min(Br,Wr.y),Ur=Math.max(Ur,Wr.y)}return[Pr,Br,Jr,Ur]},cr.prototype.toGeoJSON=Lt.prototype.toGeoJSON,Le}();function B(Bt){var Lt=new Qe;return function(Yt,cr){for(var gr in Yt.layers)cr.writeMessage(3,Q,Yt.layers[gr])}(Bt,Lt),Lt.finish()}function Q(Bt,Lt){var Yt;Lt.writeVarintField(15,Bt.version||1),Lt.writeStringField(1,Bt.name||""),Lt.writeVarintField(5,Bt.extent||4096);var cr={keys:[],values:[],keycache:{},valuecache:{}};for(Yt=0;Yt<Bt.length;Yt++)cr.feature=Bt.feature(Yt),Lt.writeMessage(2,xe,cr);var gr=cr.keys;for(Yt=0;Yt<gr.length;Yt++)Lt.writeStringField(3,gr[Yt]);var Pr=cr.values;for(Yt=0;Yt<Pr.length;Yt++)Lt.writeMessage(4,Nt,Pr[Yt])}function xe(Bt,Lt){var Yt=Bt.feature;Yt.id!==void 0&&Lt.writeVarintField(1,Yt.id),Lt.writeMessage(2,Ne,Bt),Lt.writeVarintField(3,Yt.type),Lt.writeMessage(4,mt,Yt)}function Ne(Bt,Lt){var Yt=Bt.feature,cr=Bt.keys,gr=Bt.values,Pr=Bt.keycache,Jr=Bt.valuecache;for(var Br in Yt.properties){var Ur=Yt.properties[Br],oi=Pr[Br];if(Ur!==null){oi===void 0&&(cr.push(Br),Pr[Br]=oi=cr.length-1),Lt.writeVarint(oi);var si=typeof Ur;si!=="string"&&si!=="boolean"&&si!=="number"&&(Ur=JSON.stringify(Ur));var Kr=si+":"+Ur,Wr=Jr[Kr];Wr===void 0&&(gr.push(Ur),Jr[Kr]=Wr=gr.length-1),Lt.writeVarint(Wr)}}}function Ze(Bt,Lt){return(Lt<<3)+(7&Bt)}function ot(Bt){return Bt<<1^Bt>>31}function mt(Bt,Lt){for(var Yt=Bt.loadGeometry(),cr=Bt.type,gr=0,Pr=0,Jr=Yt.length,Br=0;Br<Jr;Br++){var Ur=Yt[Br],oi=1;cr===1&&(oi=Ur.length),Lt.writeVarint(Ze(1,oi));for(var si=cr===3?Ur.length-1:Ur.length,Kr=0;Kr<si;Kr++){Kr===1&&cr!==1&&Lt.writeVarint(Ze(2,si-1));var Wr=Ur[Kr].x-gr,Pi=Ur[Kr].y-Pr;Lt.writeVarint(ot(Wr)),Lt.writeVarint(ot(Pi)),gr+=Wr,Pr+=Pi}cr===3&&Lt.writeVarint(Ze(7,1))}}function Nt(Bt,Lt){var Yt=typeof Bt;Yt==="string"?Lt.writeStringField(1,Bt):Yt==="boolean"?Lt.writeBooleanField(7,Bt):Yt==="number"&&(Bt%1!=0?Lt.writeDoubleField(3,Bt):Bt<0?Lt.writeSVarintField(6,Bt):Lt.writeVarintField(5,Bt))}return Me.exports=B,Me.exports.fromVectorTileJs=B,Me.exports.fromGeojsonVt=function(Bt,Lt){Lt=Lt||{};var Yt={};for(var cr in Bt)Yt[cr]=new ie(Bt[cr].features,Lt),Yt[cr].name=cr,Yt[cr].version=Lt.version,Yt[cr].extent=Lt.extent;return B({layers:Yt})},Me.exports.GeoJSONWrapper=ie,Me.exports}(),nt=t.e8(He);const ht={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Qe=>Qe},Fe=Math.fround||(Ce=new Float32Array(1),Qe=>(Ce[0]=+Qe,Ce[0]));var Ce;const Be=3,Ae=5,se=6;class pe{constructor(ie){this.options=Object.assign(Object.create(ht),ie),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ie){const{log:B,minZoom:Q,maxZoom:xe}=this.options;B&&console.time("total time");const Ne=`prepare ${ie.length} points`;B&&console.time(Ne),this.points=ie;const Ze=[];for(let mt=0;mt<ie.length;mt++){const Nt=ie[mt];if(!Nt.geometry)continue;const[Bt,Lt]=Nt.geometry.coordinates,Yt=Fe(ke(Bt)),cr=Fe(qe(Lt));Ze.push(Yt,cr,1/0,mt,-1,1),this.options.reduce&&Ze.push(0)}let ot=this.trees[xe+1]=this._createTree(Ze);B&&console.timeEnd(Ne);for(let mt=xe;mt>=Q;mt--){const Nt=+Date.now();ot=this.trees[mt]=this._createTree(this._cluster(ot,mt)),B&&console.log("z%d: %d clusters in %dms",mt,ot.numItems,+Date.now()-Nt)}return B&&console.timeEnd("total time"),this}getClusters(ie,B){let Q=((ie[0]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,ie[1]));let Ne=ie[2]===180?180:((ie[2]+180)%360+360)%360-180;const Ze=Math.max(-90,Math.min(90,ie[3]));if(ie[2]-ie[0]>=360)Q=-180,Ne=180;else if(Q>Ne){const Lt=this.getClusters([Q,xe,180,Ze],B),Yt=this.getClusters([-180,xe,Ne,Ze],B);return Lt.concat(Yt)}const ot=this.trees[this._limitZoom(B)],mt=ot.range(ke(Q),qe(Ze),ke(Ne),qe(xe)),Nt=ot.data,Bt=[];for(const Lt of mt){const Yt=this.stride*Lt;Bt.push(Nt[Yt+Ae]>1?Ke(Nt,Yt,this.clusterProps):this.points[Nt[Yt+Be]])}return Bt}getChildren(ie){const B=this._getOriginId(ie),Q=this._getOriginZoom(ie),xe="No cluster with the specified id.",Ne=this.trees[Q];if(!Ne)throw new Error(xe);const Ze=Ne.data;if(B*this.stride>=Ze.length)throw new Error(xe);const ot=this.options.radius/(this.options.extent*Math.pow(2,Q-1)),mt=Ne.within(Ze[B*this.stride],Ze[B*this.stride+1],ot),Nt=[];for(const Bt of mt){const Lt=Bt*this.stride;Ze[Lt+4]===ie&&Nt.push(Ze[Lt+Ae]>1?Ke(Ze,Lt,this.clusterProps):this.points[Ze[Lt+Be]])}if(Nt.length===0)throw new Error(xe);return Nt}getLeaves(ie,B,Q){const xe=[];return this._appendLeaves(xe,ie,B=B||10,Q=Q||0,0),xe}getTile(ie,B,Q){const xe=this.trees[this._limitZoom(ie)],Ne=Math.pow(2,ie),{extent:Ze,radius:ot}=this.options,mt=ot/Ze,Nt=(Q-mt)/Ne,Bt=(Q+1+mt)/Ne,Lt={features:[]};return this._addTileFeatures(xe.range((B-mt)/Ne,Nt,(B+1+mt)/Ne,Bt),xe.data,B,Q,Ne,Lt),B===0&&this._addTileFeatures(xe.range(1-mt/Ne,Nt,1,Bt),xe.data,Ne,Q,Ne,Lt),B===Ne-1&&this._addTileFeatures(xe.range(0,Nt,mt/Ne,Bt),xe.data,-1,Q,Ne,Lt),Lt.features.length?Lt:null}getClusterExpansionZoom(ie){let B=this._getOriginZoom(ie)-1;for(;B<=this.options.maxZoom;){const Q=this.getChildren(ie);if(B++,Q.length!==1)break;ie=Q[0].properties.cluster_id}return B}_appendLeaves(ie,B,Q,xe,Ne){const Ze=this.getChildren(B);for(const ot of Ze){const mt=ot.properties;if(mt&&mt.cluster?Ne+mt.point_count<=xe?Ne+=mt.point_count:Ne=this._appendLeaves(ie,mt.cluster_id,Q,xe,Ne):Ne<xe?Ne++:ie.push(ot),ie.length===Q)break}return Ne}_createTree(ie){const B=new t.bE(ie.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Q=0;Q<ie.length;Q+=this.stride)B.add(ie[Q],ie[Q+1]);return B.finish(),B.data=ie,B}_addTileFeatures(ie,B,Q,xe,Ne,Ze){for(const ot of ie){const mt=ot*this.stride,Nt=B[mt+Ae]>1;let Bt,Lt,Yt;if(Nt)Bt=_e(B,mt,this.clusterProps),Lt=B[mt],Yt=B[mt+1];else{const Pr=this.points[B[mt+Be]];Bt=Pr.properties;const[Jr,Br]=Pr.geometry.coordinates;Lt=ke(Jr),Yt=qe(Br)}const cr={type:1,geometry:[[Math.round(this.options.extent*(Lt*Ne-Q)),Math.round(this.options.extent*(Yt*Ne-xe))]],tags:Bt};let gr;gr=Nt||this.options.generateId?B[mt+Be]:this.points[B[mt+Be]].id,gr!==void 0&&(cr.id=gr),Ze.features.push(cr)}}_limitZoom(ie){return Math.max(this.options.minZoom,Math.min(Math.floor(+ie),this.options.maxZoom+1))}_cluster(ie,B){const{radius:Q,extent:xe,reduce:Ne,minPoints:Ze}=this.options,ot=Q/(xe*Math.pow(2,B)),mt=ie.data,Nt=[],Bt=this.stride;for(let Lt=0;Lt<mt.length;Lt+=Bt){if(mt[Lt+2]<=B)continue;mt[Lt+2]=B;const Yt=mt[Lt],cr=mt[Lt+1],gr=ie.within(mt[Lt],mt[Lt+1],ot),Pr=mt[Lt+Ae];let Jr=Pr;for(const Br of gr){const Ur=Br*Bt;mt[Ur+2]>B&&(Jr+=mt[Ur+Ae])}if(Jr>Pr&&Jr>=Ze){let Br,Ur=Yt*Pr,oi=cr*Pr,si=-1;const Kr=(Lt/Bt<<5)+(B+1)+this.points.length;for(const Wr of gr){const Pi=Wr*Bt;if(mt[Pi+2]<=B)continue;mt[Pi+2]=B;const Ki=mt[Pi+Ae];Ur+=mt[Pi]*Ki,oi+=mt[Pi+1]*Ki,mt[Pi+4]=Kr,Ne&&(Br||(Br=this._map(mt,Lt,!0),si=this.clusterProps.length,this.clusterProps.push(Br)),Ne(Br,this._map(mt,Pi)))}mt[Lt+4]=Kr,Nt.push(Ur/Jr,oi/Jr,1/0,Kr,-1,Jr),Ne&&Nt.push(si)}else{for(let Br=0;Br<Bt;Br++)Nt.push(mt[Lt+Br]);if(Jr>1)for(const Br of gr){const Ur=Br*Bt;if(!(mt[Ur+2]<=B)){mt[Ur+2]=B;for(let oi=0;oi<Bt;oi++)Nt.push(mt[Ur+oi])}}}}return Nt}_getOriginId(ie){return ie-this.points.length>>5}_getOriginZoom(ie){return(ie-this.points.length)%32}_map(ie,B,Q){if(ie[B+Ae]>1){const Ze=this.clusterProps[ie[B+se]];return Q?Object.assign({},Ze):Ze}const xe=this.points[ie[B+Be]].properties,Ne=this.options.map(xe);return Q&&Ne===xe?Object.assign({},Ne):Ne}}function Ke(Qe,ie,B){return{type:"Feature",id:Qe[ie+Be],properties:_e(Qe,ie,B),geometry:{type:"Point",coordinates:[(Q=Qe[ie],360*(Q-.5)),tt(Qe[ie+1])]}};var Q}function _e(Qe,ie,B){const Q=Qe[ie+Ae],xe=Q>=1e4?`${Math.round(Q/1e3)}k`:Q>=1e3?Math.round(Q/100)/10+"k":Q,Ne=Qe[ie+se],Ze=Ne===-1?{}:Object.assign({},B[Ne]);return Object.assign(Ze,{cluster:!0,cluster_id:Qe[ie+Be],point_count:Q,point_count_abbreviated:xe})}function ke(Qe){return Qe/360+.5}function qe(Qe){const ie=Math.sin(Qe*Math.PI/180),B=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return B<0?0:B>1?1:B}function tt(Qe){const ie=(180-360*Qe)*Math.PI/180;return 360*Math.atan(Math.exp(ie))/Math.PI-90}function Ge(Qe,ie,B,Q){let xe=Q;const Ne=ie+(B-ie>>1);let Ze,ot=B-ie;const mt=Qe[ie],Nt=Qe[ie+1],Bt=Qe[B],Lt=Qe[B+1];for(let Yt=ie+3;Yt<B;Yt+=3){const cr=We(Qe[Yt],Qe[Yt+1],mt,Nt,Bt,Lt);if(cr>xe)Ze=Yt,xe=cr;else if(cr===xe){const gr=Math.abs(Yt-Ne);gr<ot&&(Ze=Yt,ot=gr)}}xe>Q&&(Ze-ie>3&&Ge(Qe,ie,Ze,Q),Qe[Ze+2]=xe,B-Ze>3&&Ge(Qe,Ze,B,Q))}function We(Qe,ie,B,Q,xe,Ne){let Ze=xe-B,ot=Ne-Q;if(Ze!==0||ot!==0){const mt=((Qe-B)*Ze+(ie-Q)*ot)/(Ze*Ze+ot*ot);mt>1?(B=xe,Q=Ne):mt>0&&(B+=Ze*mt,Q+=ot*mt)}return Ze=Qe-B,ot=ie-Q,Ze*Ze+ot*ot}function Je(Qe,ie,B,Q){const xe={id:Qe??null,type:ie,geometry:B,tags:Q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ie==="Point"||ie==="MultiPoint"||ie==="LineString")it(xe,B);else if(ie==="Polygon")it(xe,B[0]);else if(ie==="MultiLineString")for(const Ne of B)it(xe,Ne);else if(ie==="MultiPolygon")for(const Ne of B)it(xe,Ne[0]);return xe}function it(Qe,ie){for(let B=0;B<ie.length;B+=3)Qe.minX=Math.min(Qe.minX,ie[B]),Qe.minY=Math.min(Qe.minY,ie[B+1]),Qe.maxX=Math.max(Qe.maxX,ie[B]),Qe.maxY=Math.max(Qe.maxY,ie[B+1])}function ze(Qe,ie,B,Q){if(!ie.geometry)return;const xe=ie.geometry.coordinates;if(xe&&xe.length===0)return;const Ne=ie.geometry.type,Ze=Math.pow(B.tolerance/((1<<B.maxZoom)*B.extent),2);let ot=[],mt=ie.id;if(B.promoteId?mt=ie.properties[B.promoteId]:B.generateId&&(mt=Q||0),Ne==="Point")de(xe,ot);else if(Ne==="MultiPoint")for(const Nt of xe)de(Nt,ot);else if(Ne==="LineString")ve(xe,ot,Ze,!1);else if(Ne==="MultiLineString"){if(B.lineMetrics){for(const Nt of xe)ot=[],ve(Nt,ot,Ze,!1),Qe.push(Je(mt,"LineString",ot,ie.properties));return}be(xe,ot,Ze,!1)}else if(Ne==="Polygon")be(xe,ot,Ze,!0);else{if(Ne!=="MultiPolygon"){if(Ne==="GeometryCollection"){for(const Nt of ie.geometry.geometries)ze(Qe,{id:mt,geometry:Nt,properties:ie.properties},B,Q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Nt of xe){const Bt=[];be(Nt,Bt,Ze,!0),ot.push(Bt)}}Qe.push(Je(mt,Ne,ot,ie.properties))}function de(Qe,ie){ie.push(Oe(Qe[0]),ge(Qe[1]),0)}function ve(Qe,ie,B,Q){let xe,Ne,Ze=0;for(let mt=0;mt<Qe.length;mt++){const Nt=Oe(Qe[mt][0]),Bt=ge(Qe[mt][1]);ie.push(Nt,Bt,0),mt>0&&(Ze+=Q?(xe*Bt-Nt*Ne)/2:Math.sqrt(Math.pow(Nt-xe,2)+Math.pow(Bt-Ne,2))),xe=Nt,Ne=Bt}const ot=ie.length-3;ie[2]=1,Ge(ie,0,ot,B),ie[ot+2]=1,ie.size=Math.abs(Ze),ie.start=0,ie.end=ie.size}function be(Qe,ie,B,Q){for(let xe=0;xe<Qe.length;xe++){const Ne=[];ve(Qe[xe],Ne,B,Q),ie.push(Ne)}}function Oe(Qe){return Qe/360+.5}function ge(Qe){const ie=Math.sin(Qe*Math.PI/180),B=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return B<0?0:B>1?1:B}function le(Qe,ie,B,Q,xe,Ne,Ze,ot){if(Q/=ie,Ne>=(B/=ie)&&Ze<Q)return Qe;if(Ze<B||Ne>=Q)return null;const mt=[];for(const Nt of Qe){const Bt=Nt.geometry;let Lt=Nt.type;const Yt=xe===0?Nt.minX:Nt.minY,cr=xe===0?Nt.maxX:Nt.maxY;if(Yt>=B&&cr<Q){mt.push(Nt);continue}if(cr<B||Yt>=Q)continue;let gr=[];if(Lt==="Point"||Lt==="MultiPoint")et(Bt,gr,B,Q,xe);else if(Lt==="LineString")wt(Bt,gr,B,Q,xe,!1,ot.lineMetrics);else if(Lt==="MultiLineString")Wt(Bt,gr,B,Q,xe,!1);else if(Lt==="Polygon")Wt(Bt,gr,B,Q,xe,!0);else if(Lt==="MultiPolygon")for(const Pr of Bt){const Jr=[];Wt(Pr,Jr,B,Q,xe,!0),Jr.length&&gr.push(Jr)}if(gr.length){if(ot.lineMetrics&&Lt==="LineString"){for(const Pr of gr)mt.push(Je(Nt.id,Lt,Pr,Nt.tags));continue}Lt!=="LineString"&&Lt!=="MultiLineString"||(gr.length===1?(Lt="LineString",gr=gr[0]):Lt="MultiLineString"),Lt!=="Point"&&Lt!=="MultiPoint"||(Lt=gr.length===3?"Point":"MultiPoint"),mt.push(Je(Nt.id,Lt,gr,Nt.tags))}}return mt.length?mt:null}function et(Qe,ie,B,Q,xe){for(let Ne=0;Ne<Qe.length;Ne+=3){const Ze=Qe[Ne+xe];Ze>=B&&Ze<=Q&&or(ie,Qe[Ne],Qe[Ne+1],Qe[Ne+2])}}function wt(Qe,ie,B,Q,xe,Ne,Ze){let ot=Ft(Qe);const mt=xe===0?Or:xr;let Nt,Bt,Lt=Qe.start;for(let Jr=0;Jr<Qe.length-3;Jr+=3){const Br=Qe[Jr],Ur=Qe[Jr+1],oi=Qe[Jr+2],si=Qe[Jr+3],Kr=Qe[Jr+4],Wr=xe===0?Br:Ur,Pi=xe===0?si:Kr;let Ki=!1;Ze&&(Nt=Math.sqrt(Math.pow(Br-si,2)+Math.pow(Ur-Kr,2))),Wr<B?Pi>B&&(Bt=mt(ot,Br,Ur,si,Kr,B),Ze&&(ot.start=Lt+Nt*Bt)):Wr>Q?Pi<Q&&(Bt=mt(ot,Br,Ur,si,Kr,Q),Ze&&(ot.start=Lt+Nt*Bt)):or(ot,Br,Ur,oi),Pi<B&&Wr>=B&&(Bt=mt(ot,Br,Ur,si,Kr,B),Ki=!0),Pi>Q&&Wr<=Q&&(Bt=mt(ot,Br,Ur,si,Kr,Q),Ki=!0),!Ne&&Ki&&(Ze&&(ot.end=Lt+Nt*Bt),ie.push(ot),ot=Ft(Qe)),Ze&&(Lt+=Nt)}let Yt=Qe.length-3;const cr=Qe[Yt],gr=Qe[Yt+1],Pr=xe===0?cr:gr;Pr>=B&&Pr<=Q&&or(ot,cr,gr,Qe[Yt+2]),Yt=ot.length-3,Ne&&Yt>=3&&(ot[Yt]!==ot[0]||ot[Yt+1]!==ot[1])&&or(ot,ot[0],ot[1],ot[2]),ot.length&&ie.push(ot)}function Ft(Qe){const ie=[];return ie.size=Qe.size,ie.start=Qe.start,ie.end=Qe.end,ie}function Wt(Qe,ie,B,Q,xe,Ne){for(const Ze of Qe)wt(Ze,ie,B,Q,xe,Ne,!1)}function or(Qe,ie,B,Q){Qe.push(ie,B,Q)}function Or(Qe,ie,B,Q,xe,Ne){const Ze=(Ne-ie)/(Q-ie);return or(Qe,Ne,B+(xe-B)*Ze,1),Ze}function xr(Qe,ie,B,Q,xe,Ne){const Ze=(Ne-B)/(xe-B);return or(Qe,ie+(Q-ie)*Ze,Ne,1),Ze}function Tr(Qe,ie){const B=[];for(let Q=0;Q<Qe.length;Q++){const xe=Qe[Q],Ne=xe.type;let Ze;if(Ne==="Point"||Ne==="MultiPoint"||Ne==="LineString")Ze=br(xe.geometry,ie);else if(Ne==="MultiLineString"||Ne==="Polygon"){Ze=[];for(const ot of xe.geometry)Ze.push(br(ot,ie))}else if(Ne==="MultiPolygon"){Ze=[];for(const ot of xe.geometry){const mt=[];for(const Nt of ot)mt.push(br(Nt,ie));Ze.push(mt)}}B.push(Je(xe.id,Ne,Ze,xe.tags))}return B}function br(Qe,ie){const B=[];B.size=Qe.size,Qe.start!==void 0&&(B.start=Qe.start,B.end=Qe.end);for(let Q=0;Q<Qe.length;Q+=3)B.push(Qe[Q]+ie,Qe[Q+1],Qe[Q+2]);return B}function fr(Qe,ie){if(Qe.transformed)return Qe;const B=1<<Qe.z,Q=Qe.x,xe=Qe.y;for(const Ne of Qe.features){const Ze=Ne.geometry,ot=Ne.type;if(Ne.geometry=[],ot===1)for(let mt=0;mt<Ze.length;mt+=2)Ne.geometry.push(Vr(Ze[mt],Ze[mt+1],ie,B,Q,xe));else for(let mt=0;mt<Ze.length;mt++){const Nt=[];for(let Bt=0;Bt<Ze[mt].length;Bt+=2)Nt.push(Vr(Ze[mt][Bt],Ze[mt][Bt+1],ie,B,Q,xe));Ne.geometry.push(Nt)}}return Qe.transformed=!0,Qe}function Vr(Qe,ie,B,Q,xe,Ne){return[Math.round(B*(Qe*Q-xe)),Math.round(B*(ie*Q-Ne))]}function Ir(Qe,ie,B,Q,xe){const Ne=ie===xe.maxZoom?0:xe.tolerance/((1<<ie)*xe.extent),Ze={features:[],numPoints:0,numSimplified:0,numFeatures:Qe.length,source:null,x:B,y:Q,z:ie,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ot of Qe)De(Ze,ot,Ne,xe);return Ze}function De(Qe,ie,B,Q){const xe=ie.geometry,Ne=ie.type,Ze=[];if(Qe.minX=Math.min(Qe.minX,ie.minX),Qe.minY=Math.min(Qe.minY,ie.minY),Qe.maxX=Math.max(Qe.maxX,ie.maxX),Qe.maxY=Math.max(Qe.maxY,ie.maxY),Ne==="Point"||Ne==="MultiPoint")for(let ot=0;ot<xe.length;ot+=3)Ze.push(xe[ot],xe[ot+1]),Qe.numPoints++,Qe.numSimplified++;else if(Ne==="LineString")St(Ze,xe,Qe,B,!1,!1);else if(Ne==="MultiLineString"||Ne==="Polygon")for(let ot=0;ot<xe.length;ot++)St(Ze,xe[ot],Qe,B,Ne==="Polygon",ot===0);else if(Ne==="MultiPolygon")for(let ot=0;ot<xe.length;ot++){const mt=xe[ot];for(let Nt=0;Nt<mt.length;Nt++)St(Ze,mt[Nt],Qe,B,!0,Nt===0)}if(Ze.length){let ot=ie.tags||null;if(Ne==="LineString"&&Q.lineMetrics){ot={};for(const Nt in ie.tags)ot[Nt]=ie.tags[Nt];ot.mapbox_clip_start=xe.start/xe.size,ot.mapbox_clip_end=xe.end/xe.size}const mt={geometry:Ze,type:Ne==="Polygon"||Ne==="MultiPolygon"?3:Ne==="LineString"||Ne==="MultiLineString"?2:1,tags:ot};ie.id!==null&&(mt.id=ie.id),Qe.features.push(mt)}}function St(Qe,ie,B,Q,xe,Ne){const Ze=Q*Q;if(Q>0&&ie.size<(xe?Ze:Q))return void(B.numPoints+=ie.length/3);const ot=[];for(let mt=0;mt<ie.length;mt+=3)(Q===0||ie[mt+2]>Ze)&&(B.numSimplified++,ot.push(ie[mt],ie[mt+1])),B.numPoints++;xe&&function(mt,Nt){let Bt=0;for(let Lt=0,Yt=mt.length,cr=Yt-2;Lt<Yt;cr=Lt,Lt+=2)Bt+=(mt[Lt]-mt[cr])*(mt[Lt+1]+mt[cr+1]);if(Bt>0===Nt)for(let Lt=0,Yt=mt.length;Lt<Yt/2;Lt+=2){const cr=mt[Lt],gr=mt[Lt+1];mt[Lt]=mt[Yt-2-Lt],mt[Lt+1]=mt[Yt-1-Lt],mt[Yt-2-Lt]=cr,mt[Yt-1-Lt]=gr}}(ot,Ne),Qe.push(ot)}const Ut={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ir{constructor(ie,B){const Q=(B=this.options=function(Ne,Ze){for(const ot in Ze)Ne[ot]=Ze[ot];return Ne}(Object.create(Ut),B)).debug;if(Q&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");let xe=function(Ne,Ze){const ot=[];if(Ne.type==="FeatureCollection")for(let mt=0;mt<Ne.features.length;mt++)ze(ot,Ne.features[mt],Ze,mt);else ze(ot,Ne.type==="Feature"?Ne:{geometry:Ne},Ze);return ot}(ie,B);this.tiles={},this.tileCoords=[],Q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),xe=function(Ne,Ze){const ot=Ze.buffer/Ze.extent;let mt=Ne;const Nt=le(Ne,1,-1-ot,ot,0,-1,2,Ze),Bt=le(Ne,1,1-ot,2+ot,0,-1,2,Ze);return(Nt||Bt)&&(mt=le(Ne,1,-ot,1+ot,0,-1,2,Ze)||[],Nt&&(mt=Tr(Nt,1).concat(mt)),Bt&&(mt=mt.concat(Tr(Bt,-1)))),mt}(xe,B),xe.length&&this.splitTile(xe,0,0,0),Q&&(xe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ie,B,Q,xe,Ne,Ze,ot){const mt=[ie,B,Q,xe],Nt=this.options,Bt=Nt.debug;for(;mt.length;){xe=mt.pop(),Q=mt.pop(),B=mt.pop(),ie=mt.pop();const Lt=1<<B,Yt=Rt(B,Q,xe);let cr=this.tiles[Yt];if(!cr&&(Bt>1&&console.time("creation"),cr=this.tiles[Yt]=Ir(ie,B,Q,xe,Nt),this.tileCoords.push({z:B,x:Q,y:xe}),Bt)){Bt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,Q,xe,cr.numFeatures,cr.numPoints,cr.numSimplified),console.timeEnd("creation"));const Ki=`z${B}`;this.stats[Ki]=(this.stats[Ki]||0)+1,this.total++}if(cr.source=ie,Ne==null){if(B===Nt.indexMaxZoom||cr.numPoints<=Nt.indexMaxPoints)continue}else{if(B===Nt.maxZoom||B===Ne)continue;if(Ne!=null){const Ki=Ne-B;if(Q!==Ze>>Ki||xe!==ot>>Ki)continue}}if(cr.source=null,ie.length===0)continue;Bt>1&&console.time("clipping");const gr=.5*Nt.buffer/Nt.extent,Pr=.5-gr,Jr=.5+gr,Br=1+gr;let Ur=null,oi=null,si=null,Kr=null,Wr=le(ie,Lt,Q-gr,Q+Jr,0,cr.minX,cr.maxX,Nt),Pi=le(ie,Lt,Q+Pr,Q+Br,0,cr.minX,cr.maxX,Nt);ie=null,Wr&&(Ur=le(Wr,Lt,xe-gr,xe+Jr,1,cr.minY,cr.maxY,Nt),oi=le(Wr,Lt,xe+Pr,xe+Br,1,cr.minY,cr.maxY,Nt),Wr=null),Pi&&(si=le(Pi,Lt,xe-gr,xe+Jr,1,cr.minY,cr.maxY,Nt),Kr=le(Pi,Lt,xe+Pr,xe+Br,1,cr.minY,cr.maxY,Nt),Pi=null),Bt>1&&console.timeEnd("clipping"),mt.push(Ur||[],B+1,2*Q,2*xe),mt.push(oi||[],B+1,2*Q,2*xe+1),mt.push(si||[],B+1,2*Q+1,2*xe),mt.push(Kr||[],B+1,2*Q+1,2*xe+1)}}getTile(ie,B,Q){ie=+ie,B=+B,Q=+Q;const xe=this.options,{extent:Ne,debug:Ze}=xe;if(ie<0||ie>24)return null;const ot=1<<ie,mt=Rt(ie,B=B+ot&ot-1,Q);if(this.tiles[mt])return fr(this.tiles[mt],Ne);Ze>1&&console.log("drilling down to z%d-%d-%d",ie,B,Q);let Nt,Bt=ie,Lt=B,Yt=Q;for(;!Nt&&Bt>0;)Bt--,Lt>>=1,Yt>>=1,Nt=this.tiles[Rt(Bt,Lt,Yt)];return Nt&&Nt.source?(Ze>1&&(console.log("found parent tile z%d-%d-%d",Bt,Lt,Yt),console.time("drilling down")),this.splitTile(Nt.source,Bt,Lt,Yt,ie,B,Q),Ze>1&&console.timeEnd("drilling down"),this.tiles[mt]?fr(this.tiles[mt],Ne):null):null}}function Rt(Qe,ie,B){return 32*((1<<Qe)*B+ie)+Qe}function $t(Qe,ie){const B=Qe.tileID.canonical;if(!this._geoJSONIndex)return void ie(null,null);const Q=this._geoJSONIndex.getTile(B.z,B.x,B.y);if(!Q)return void ie(null,null);const xe=new U(Q.features);let Ne=nt(xe);Ne.byteOffset===0&&Ne.byteLength===Ne.buffer.byteLength||(Ne=new Uint8Array(Ne)),ie(null,{vectorTile:xe,rawData:Ne.buffer})}class rt extends z{constructor(ie,B,Q,xe,Ne,Ze){super(ie,B,Q,xe,$t,Ze),Ne&&(this.loadGeoJSON=Ne),this._dynamicIndex=new X}loadData(ie,B){const Q=ie&&ie.request,xe=Q&&Q.collectResourceTiming;this.loadGeoJSON(ie,(Ne,Ze)=>{if(Ne||!Ze)return B(Ne);if(typeof Ze!="object")return B(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`));{try{if(ie.filter){const mt=t.U(ie.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(mt.result==="error")throw new Error(mt.value.map(Nt=>`${Nt.key}: ${Nt.message}`).join(", "));Ze.features=Ze.features.filter(Nt=>mt.value.evaluate({zoom:0},Nt))}ie.dynamic?(Ze.type==="Feature"&&(Ze={type:"FeatureCollection",features:[Ze]}),ie.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ze.features,this.loaded),ie.cluster&&(Ze.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ie.cluster?new pe(function({superclusterOptions:mt,clusterProperties:Nt}){if(!Nt||!mt)return mt;const Bt={},Lt={},Yt={accumulated:null,zoom:0},cr={properties:null},gr=Object.keys(Nt);for(const Pr of gr){const[Jr,Br]=Nt[Pr],Ur=t.U(Br),oi=t.U(typeof Jr=="string"?[Jr,["accumulated"],["get",Pr]]:Jr);Bt[Pr]=Ur.value,Lt[Pr]=oi.value}return mt.map=Pr=>{cr.properties=Pr;const Jr={};for(const Br of gr)Jr[Br]=Bt[Br].evaluate(Yt,cr);return Jr},mt.reduce=(Pr,Jr)=>{cr.properties=Jr;for(const Br of gr)Yt.accumulated=Pr[Br],Pr[Br]=Lt[Br].evaluate(Yt,cr)},mt}(ie)).load(Ze.features):ie.dynamic?this._dynamicIndex:function(mt,Nt){return new ir(mt,Nt)}(Ze,ie.geojsonVtOptions)}catch(mt){return B(mt)}const ot={};if(xe){const mt=S(Q);mt&&(ot.resourceTiming={},ot.resourceTiming[ie.source]=JSON.parse(JSON.stringify(mt)))}B(null,ot)}})}reloadTile(ie,B){const Q=this.loaded;return Q&&Q[ie.uid]?ie.partial?B(null,void 0):super.reloadTile(ie,B):this.loadTile(ie,B)}loadGeoJSON(ie,B){if(ie.request)t.n(ie.request,B);else{if(typeof ie.data!="string")return B(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`));try{return B(null,JSON.parse(ie.data))}catch{return B(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ie,B){try{B(null,this._geoJSONIndex.getClusterExpansionZoom(ie.clusterId))}catch(Q){B(Q)}}getClusterChildren(ie,B){try{B(null,this._geoJSONIndex.getChildren(ie.clusterId))}catch(Q){B(Q)}}getClusterLeaves(ie,B){try{B(null,this._geoJSONIndex.getLeaves(ie.clusterId,ie.limit,ie.offset))}catch(Q){B(Q)}}}class sr{constructor(ie,B){this.tileID=new t.aG(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),this.tileZoom=ie.tileZoom,this.uid=ie.uid,this.zoom=ie.zoom,this.canonical=ie.tileID.canonical,this.pixelRatio=ie.pixelRatio,this.tileSize=ie.tileSize,this.source=ie.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ie.projection,this.brightness=B}parse(ie,B,Q,xe){this.status="parsing";const Ne=new t.aG(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),Ze=[],ot=B.familiesBySource[Q.source],mt=new t.dZ(Ne,Q.promoteId);return mt.bucketLayerIDs=[],mt.is3DTile=!0,t.e9(ie).then(Nt=>{if(!Nt)return xe(new Error("Could not parse tile"));const Bt=t.ea(Nt,1/t.cc(Q.tileID.canonical)),Lt=Nt.json.extensionsUsed&&Nt.json.extensionsUsed.includes("MAPBOX_mesh_features")||Nt.json.asset.extras&&Nt.json.asset.extras.MAPBOX_mesh_features,Yt=Nt.json.extensionsUsed&&Nt.json.extensionsUsed.includes("EXT_meshopt_compression"),cr=new t.a8(this.zoom,{brightness:this.brightness});for(const gr in ot)for(const Pr of ot[gr]){const Jr=Pr[0];mt.bucketLayerIDs.push(Pr.map(Ur=>t.aC(Ur.id,Ur.scope))),Jr.recalculate(cr,[]);const Br=new t.eb(Pr,Bt,Ne,Lt,Yt,this.brightness,mt);Lt||(Br.needsUpload=!0),Ze.push(Br),Br.evaluate(Jr)}this.status="done",xe(null,{buckets:Ze,featureIndex:mt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Nt=>xe(new Error(Nt.message)))}}class Fr{constructor(ie,B,Q,xe,Ne,Ze){this.actor=ie,this.layerIndex=B,this.availableImages=Q,this.brightness=Ze,this.loading={},this.loaded={}}loadTile(ie,B){const Q=ie.uid,xe=this.loading[Q]=new sr(ie,this.brightness);t.bi(ie.request,(Ne,Ze)=>{const ot=!this.loading[Q];return delete this.loading[Q],ot||Ne?(xe.status="done",ot||(this.loaded[Q]=xe),B(Ne)):Ze&&Ze.byteLength!==0?void xe.parse(Ze,this.layerIndex,ie,(mt,Nt)=>{xe.status="done",this.loaded=this.loaded||{},this.loaded[Q]=xe,mt||!Nt?B(mt):B(null,Nt)}):(xe.status="done",this.loaded[Q]=xe,B())})}reloadTile(ie,B){const Q=this.loaded,xe=ie.uid;if(Q&&Q[xe]){const Ne=Q[xe];Ne.projection=ie.projection,Ne.brightness=ie.brightness;const Ze=(ot,mt)=>{Ne.reloadCallback&&(delete Ne.reloadCallback,this.loadTile(ie,B)),B(ot,mt)};Ne.status==="parsing"?Ne.reloadCallback=Ze:Ne.status==="done"&&this.loadTile(ie,B)}}abortTile(ie,B){const Q=ie.uid;this.loading[Q]&&delete this.loading[Q],B()}removeTile(ie,B){const Q=this.loaded,xe=ie.uid;Q&&Q[xe]&&delete Q[xe],B()}}class ee{constructor(ie){this.self=ie,this.actor=new t.ec(ie,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new t.I,this.projections={},this.defaultProjection=t.bP({name:"mercator"}),this.workerSourceTypes={vector:z,geojson:rt,"batched-model":Fr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(B,Q)=>{if(this.workerSourceTypes[B])throw new Error(`Worker source with name "${B}" already registered.`);this.workerSourceTypes[B]=Q},this.self.registerRTLTextPlugin=B=>{if(t.ed.isParsed())throw new Error("RTL text plugin already registered.");t.ed.applyArabicShaping=B.applyArabicShaping,t.ed.processBidirectionalText=B.processBidirectionalText,t.ed.processStyledBidirectionalText=B.processStyledBidirectionalText}}clearCaches(ie,B,Q){delete this.layerIndexes[ie],delete this.availableImages[ie],delete this.workerSources[ie],delete this.demWorkerSources[ie],delete this.rasterArrayWorkerSource,Q()}checkIfReady(ie,B,Q){Q()}setReferrer(ie,B){this.referrer=B}spriteLoaded(ie,{scope:B,isLoaded:Q}){if(this.isSpriteLoaded[ie]||(this.isSpriteLoaded[ie]={}),this.isSpriteLoaded[ie][B]=Q,this.workerSources[ie]&&this.workerSources[ie][B])for(const xe in this.workerSources[ie][B]){const Ne=this.workerSources[ie][B][xe];for(const Ze in Ne){const ot=Ne[Ze];ot instanceof z&&(ot.isSpriteLoaded=Q,ot.fire(new t.z("isSpriteLoaded")))}}}setImages(ie,{scope:B,images:Q},xe){if(this.availableImages[ie]||(this.availableImages[ie]={}),this.availableImages[ie][B]=Q,this.workerSources[ie]&&this.workerSources[ie][B]){for(const Ne in this.workerSources[ie][B]){const Ze=this.workerSources[ie][B][Ne];for(const ot in Ze)Ze[ot].availableImages=Q}xe()}else xe()}setProjection(ie,B){this.projections[ie]=t.bP(B)}setBrightness(ie,B,Q){this.brightness=B,Q()}setLayers(ie,B,Q){this.getLayerIndex(ie,B.scope).replace(B.layers,B.options),Q()}updateLayers(ie,B,Q){this.getLayerIndex(ie,B.scope).update(B.layers,B.removedIds,B.options),Q()}loadTile(ie,B,Q){B.projection=this.projections[ie]||this.defaultProjection,this.getWorkerSource(ie,B.type,B.source,B.scope).loadTile(B,Q)}loadDEMTile(ie,B,Q){this.getDEMWorkerSource(ie,B.source,B.scope).loadTile(B,Q)}decodeRasterArray(ie,B,Q){this.getRasterArrayWorkerSource().decodeRasterArray(B,Q)}reloadTile(ie,B,Q){B.projection=this.projections[ie]||this.defaultProjection,this.getWorkerSource(ie,B.type,B.source,B.scope).reloadTile(B,Q)}abortTile(ie,B,Q){this.getWorkerSource(ie,B.type,B.source,B.scope).abortTile(B,Q)}removeTile(ie,B,Q){this.getWorkerSource(ie,B.type,B.source,B.scope).removeTile(B,Q)}removeSource(ie,B,Q){if(!(this.workerSources[ie]&&this.workerSources[ie][B.scope]&&this.workerSources[ie][B.scope][B.type]&&this.workerSources[ie][B.scope][B.type][B.source]))return;const xe=this.workerSources[ie][B.scope][B.type][B.source];delete this.workerSources[ie][B.scope][B.type][B.source],xe.removeSource!==void 0?xe.removeSource(B,Q):Q()}loadWorkerSource(ie,B,Q){try{this.self.importScripts(B.url),Q()}catch(xe){Q(xe.toString())}}syncRTLPluginState(ie,B,Q){try{t.ed.setState(B);const xe=t.ed.getPluginURL();if(t.ed.isLoaded()&&!t.ed.isParsed()&&xe!=null){this.self.importScripts(xe);const Ne=t.ed.isParsed();Q(Ne?void 0:new Error(`RTL Text Plugin failed to import scripts from ${xe}`),Ne)}}catch(xe){Q(xe.toString())}}setDracoUrl(ie,B){this.dracoUrl=B}getAvailableImages(ie,B){this.availableImages[ie]||(this.availableImages[ie]={});let Q=this.availableImages[ie][B];return Q||(Q=[]),Q}getLayerIndex(ie,B){this.layerIndexes[ie]||(this.layerIndexes[ie]={});let Q=this.layerIndexes[ie][B];return Q||(Q=this.layerIndexes[ie][B]=new E,Q.scope=B),Q}getWorkerSource(ie,B,Q,xe){return this.workerSources[ie]||(this.workerSources[ie]={}),this.workerSources[ie][xe]||(this.workerSources[ie][xe]={}),this.workerSources[ie][xe][B]||(this.workerSources[ie][xe][B]={}),this.isSpriteLoaded[ie]||(this.isSpriteLoaded[ie]={}),this.workerSources[ie][xe][B][Q]||(this.workerSources[ie][xe][B][Q]=new this.workerSourceTypes[B]({send:(Ne,Ze,ot,mt,Nt,Bt)=>{this.actor.send(Ne,Ze,ot,ie,Nt,Bt)},scheduler:this.actor.scheduler},this.getLayerIndex(ie,xe),this.getAvailableImages(ie,xe),this.isSpriteLoaded[ie][xe],void 0,this.brightness)),this.workerSources[ie][xe][B][Q]}rasterizeImages(ie,B,Q){const{imageTasks:xe,scope:Ne}=B,Ze={};for(const ot in xe){const{image:mt,imageIdWithOptions:Nt}=xe[ot];Ze[ot]=this.imageRasterizer.rasterize(Nt,mt,Ne,ie)}Q(void 0,Ze)}removeRasterizedImages(ie,B,Q){const{imageIds:xe,scope:Ne}=B;this.imageRasterizer.removeImagesFromCacheByIds(xe,Ne,ie),Q()}getDEMWorkerSource(ie,B,Q){return this.demWorkerSources[ie]||(this.demWorkerSources[ie]={}),this.demWorkerSources[ie][Q]||(this.demWorkerSources[ie][Q]={}),this.demWorkerSources[ie][Q][B]||(this.demWorkerSources[ie][Q][B]=new A),this.demWorkerSources[ie][Q][B]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new P),this.rasterArrayWorkerSource}enforceCacheSizeLimit(ie,B){t.ee(B)}getWorkerPerformanceMetrics(ie,B,Q){Q(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ee(self)),ee}),b(["./shared"],function(t){var S="3.9.4";const D={create:"create",load:"load",fullLoad:"fullLoad"},w={mark(u){performance.mark(u)},measure(u,r,n){performance.measure(u,r,n)}};function E(u){const r=u.name.split("?")[0];return t.a(r)&&r.includes("mapbox-gl.js")?"javascript":t.a(r)&&r.includes("mapbox-gl.css")?"css":t.b(r)?"fontRange":t.c(r)?"sprite":t.i(r)?"style":t.d(r)?"tilejson":"other"}var m,y={},p=function(){if(m)return y;function u(c){return!r(c)}function r(c){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var M,L,q=new Blob([""],{type:"text/javascript"}),K=URL.createObjectURL(q);try{L=new Worker(K),M=!0}catch{M=!1}return L&&L.terminate(),URL.revokeObjectURL(K),M}()?function(){var M=document.createElement("canvas");M.width=M.height=1;var L=M.getContext("2d");if(!L)return!1;var q=L.getImageData(0,0,1,1);return q&&q.width===M.width}()?(n[g=c&&c.failIfMajorPerformanceCaveat]===void 0&&(n[g]=function(M){var L,q=function(K){var ne=document.createElement("canvas"),ae=Object.create(u.webGLContextAttributes);return ae.failIfMajorPerformanceCaveat=K,ne.getContext("webgl2",ae)}(M);if(!q)return!1;try{L=q.createShader(q.VERTEX_SHADER)}catch{return!1}return!(!L||q.isContextLost())&&(q.shaderSource(L,"void main() {}"),q.compileShader(L),q.getShaderParameter(L,q.COMPILE_STATUS)===!0)}(g)),n[g]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var g}m=1,y.supported=u,y.notSupportedReason=r;var n={};return u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},y}();function C(u,r,n){const c=document.createElement(u);return r!=null&&(c.className=r),n&&n.appendChild(c),c}function z(u,r,n){const c=document.createElementNS("http://www.w3.org/2000/svg",u);for(const g of Object.keys(r))c.setAttributeNS(null,g,String(r[g]));return n&&n.appendChild(c),c}const A=typeof document<"u"?document.documentElement&&document.documentElement.style:null,P=A&&A.userSelect!==void 0?"userSelect":"WebkitUserSelect";let x;function O(){A&&P&&(x=A[P],A[P]="none")}function U(){A&&P&&(A[P]=x)}function G(u){u.preventDefault(),u.stopPropagation(),window.removeEventListener("click",G,!0)}function Z(){window.addEventListener("click",G,!0),window.setTimeout(()=>{window.removeEventListener("click",G,!0)},0)}function X(u,r){const n=u.getBoundingClientRect();return re(u,n,r)}function W(u,r){const n=u.getBoundingClientRect(),c=[];for(let g=0;g<r.length;g++)c.push(re(u,n,r[g]));return c}function J(u){return window.InstallTrigger!==void 0&&u.button===2&&u.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:u.button}function re(u,r,n){const c=u.offsetWidth===r.width?1:u.offsetWidth/r.width;return new t.P((n.clientX-r.left)*c,(n.clientY-r.top)*c)}const te="01",ye="NO_ACCESS_TOKEN";class ue{constructor(r,n,c){this._transformRequestFn=r,this._customAccessToken=n,this._silenceAuthErrors=!!c,this._createSkuToken()}_createSkuToken(){const r=function(){let n="";for(let c=0;c<10;c++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",te,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,n){return this._transformRequestFn&&this._transformRequestFn(r,n)||{url:r}}normalizeStyleURL(r,n){if(!t.f(r))return r;const c=Le(r);return c.params.push(`sdk=js-${S}`),c.path=`/styles/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||n)}normalizeGlyphsURL(r,n){if(!t.f(r))return r;const c=Le(r);return c.path=`/fonts/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||n)}normalizeModelURL(r,n){if(!t.f(r))return r;const c=Le(r);return c.path=`/models/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||n)}normalizeSourceURL(r,n,c,g){if(!t.f(r))return r;const M=Le(r);return M.path=`/v4/${M.authority}.json`,M.params.push("secure"),c&&M.params.push(`language=${c}`),g&&M.params.push(`worldview=${g}`),this._makeAPIURL(M,this._customAccessToken||n)}normalizeIconsetURL(r,n){const c=Le(r);return t.f(r)?(c.path=`/styles/v1${c.path}/iconset.pbf`,this._makeAPIURL(c,this._customAccessToken||n)):Pe(c)}normalizeSpriteURL(r,n,c,g){const M=Le(r);return t.f(r)?(M.path=`/styles/v1${M.path}/sprite${n}${c}`,this._makeAPIURL(M,this._customAccessToken||g)):(M.path+=`${n}${c}`,Pe(M))}normalizeTileURL(r,n,c){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!t.f(r))return r;const g=Le(r);g.path=g.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||c&&g.authority!=="raster"&&c===512?"@2x":""}${t.m.supported?".webp":"$1"}`),g.authority==="raster"?g.path=`/${t.e.RASTER_URL_PREFIX}${g.path}`:g.authority==="rasterarrays"?g.path=`/${t.e.RASTERARRAYS_URL_PREFIX}${g.path}`:g.authority==="3dtiles"?g.path=`/${t.e.TILES3D_URL_PREFIX}${g.path}`:(g.path=g.path.replace(/^.+\/v4\//,"/"),g.path=`/${t.e.TILE_URL_VERSION}${g.path}`);const M=this._customAccessToken||function(L){for(const q of L){const K=q.match(/^access_token=(.*)$/);if(K)return K[1]}return null}(g.params)||t.e.ACCESS_TOKEN;return t.e.REQUIRE_ACCESS_TOKEN&&M&&this._skuToken&&g.params.push(`sku=${this._skuToken}`),this._makeAPIURL(g,M)}canonicalizeTileURL(r,n){const c=Le(r);if(!c.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!c.path.match(/\.[\w]+$/))return r;let g="mapbox://";c.path.match(/^\/raster\/v1\//)?g+=`raster/${c.path.replace(`/${t.e.RASTER_URL_PREFIX}/`,"")}`:c.path.match(/^\/rasterarrays\/v1\//)?g+=`rasterarrays/${c.path.replace(`/${t.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:g+=`tiles/${c.path.replace(`/${t.e.TILE_URL_VERSION}/`,"")}`;let M=c.params;return n&&(M=M.filter(L=>!L.match(/^access_token=/))),M.length&&(g+=`?${M.join("&")}`),g}canonicalizeTileset(r,n){const c=!!n&&t.f(n),g=[];for(const M of r.tiles||[])t.h(M)?g.push(this.canonicalizeTileURL(M,c)):g.push(M);return g}_makeAPIURL(r,n){const c="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",g=Le(t.e.API_URL);if(r.protocol=g.protocol,r.authority=g.authority,r.protocol==="http"){const M=r.params.indexOf("secure");M>=0&&r.params.splice(M,1)}if(g.path!=="/"&&(r.path=`${g.path}${r.path}`),!t.e.REQUIRE_ACCESS_TOKEN)return Pe(r);if(n=n||t.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${c}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${c}`)}return r.params=r.params.filter(M=>M.indexOf("access_token")===-1),r.params.push(`access_token=${n||""}`),Pe(r)}}const Se=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Le(u){const r=u.match(Se);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Pe(u){const r=u.params.length?`?${u.params.join("&")}`:"";return`${u.protocol}://${u.authority}${u.path}${r}`}const Ee="mapbox.eventData";function Me(u){if(!u)return null;const r=u.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(t.j(r[1]))}catch{return null}}class He{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const n=Me(t.e.ACCESS_TOKEN);let c="";return c=n&&n.u?t.k(n.u):t.e.ACCESS_TOKEN||"",r?`${Ee}.${r}:${c}`:`${Ee}:${c}`}fetchEventData(){const r=t.s("localStorage"),n=this.getStorageKey(),c=this.getStorageKey("uuid");if(r)try{const g=localStorage.getItem(n);g&&(this.eventData=JSON.parse(g));const M=localStorage.getItem(c);M&&(this.anonId=M)}catch{t.w("Unable to read from LocalStorage")}}saveEventData(){const r=t.s("localStorage"),n=this.getStorageKey(),c=this.getStorageKey("uuid"),g=this.anonId;if(r&&g)try{localStorage.setItem(c,g),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{t.w("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,n,c,g){if(!t.e.EVENTS_URL)return;const M=Le(t.e.EVENTS_URL);M.params.push(`access_token=${g||t.e.ACCESS_TOKEN||""}`);const L={event:this.type,created:new Date(r).toISOString()},q=n?t.l(L,n):L,K={url:Pe(M),headers:{"Content-Type":"text/plain"},body:JSON.stringify([q])};this.pendingRequest=t.p(K,ne=>{this.pendingRequest=null,c(ne),this.saveEventData(),this.processRequests(g)})}queueRequest(r,n){this.queue.push(r),this.processRequests(n)}}const nt=new class extends He{constructor(u){super("appUserTurnstile"),this._customAccessToken=u}postTurnstileEvent(u,r){t.e.EVENTS_URL&&t.e.ACCESS_TOKEN&&Array.isArray(u)&&u.some(n=>t.f(n)||t.h(n))&&this.queueRequest(Date.now(),r)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=Me(t.e.ACCESS_TOKEN),n=r?r.u:t.e.ACCESS_TOKEN;let c=n!==this.eventData.tokenU;t.v(this.anonId)||(this.anonId=t.u(),c=!0);const g=this.queue.shift();if(this.eventData.lastSuccess){const M=new Date(this.eventData.lastSuccess),L=new Date(g),q=(g-this.eventData.lastSuccess)/864e5;c=c||q>=1||q<-1||M.getDate()!==L.getDate()}else c=!0;c?this.postEvent(g,{sdkIdentifier:"mapbox-gl-js",sdkVersion:S,skuId:te,"enabled.telemetry":!1,userId:this.anonId},M=>{M||(this.eventData.lastSuccess=g,this.eventData.tokenU=n)},u):this.processRequests()}},ht=nt.postTurnstileEvent.bind(nt),Fe=new class extends He{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(u,r,n,c){this.skuToken=r,this.errorCb=c,t.e.EVENTS_URL&&(n||t.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},n):this.errorCb(new Error(ye)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:n}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),t.v(this.anonId)||(this.anonId=t.u()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:S,skuId:te,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):r&&(this.success[r]=!0)},u))}remove(){this.errorCb=null}},Ce=Fe.postMapLoadEvent.bind(Fe),Be=new class extends He{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(u){let r=this.mapInstanceIdMap.get(u);return r||(r=t.u(),this.mapInstanceIdMap.set(u,r)),r}getEventId(u){const r=this.eventIdPerMapInstanceMap.get(u)||0;return this.eventIdPerMapInstanceMap.set(u,r+1),r}postStyleLoadEvent(u,r){const{map:n,style:c,importedStyles:g}=r;if(!t.e.EVENTS_URL||!u&&!t.e.ACCESS_TOKEN)return;const M=this.getMapInstanceId(n),L={mapInstanceId:M,eventId:this.getEventId(M),style:c};g.length&&(L.importedStyles=g),this.queueRequest({timestamp:Date.now(),payload:L},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,payload:n}=this.queue.shift();this.postEvent(r,n,()=>{},u)}},Ae=Be.postStyleLoadEvent.bind(Be),se=new class extends He{constructor(){super("gljs.performance")}postPerformanceEvent(u,r){t.e.EVENTS_URL&&(u||t.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:n}=this.queue.shift(),c=function(g){const M=performance.getEntriesByType("resource"),L=performance.getEntriesByType("mark"),q=function(Te){const Ve={};if(Te){for(const je in Te)if(je!=="other")for(const Xe of Te[je]){const Ye=`${je}ResolveRangeMin`,at=`${je}ResolveRangeMax`,pt=`${je}RequestCount`,ft=`${je}RequestCachedCount`;Ve[Ye]=Math.min(Ve[Ye]||1/0,Xe.startTime),Ve[at]=Math.max(Ve[at]||-1/0,Xe.responseEnd);const bt=gt=>{Ve[gt]===void 0&&(Ve[gt]=0),++Ve[gt]};Xe.transferSize!==void 0&&Xe.transferSize===0&&bt(ft),bt(pt)}}return Ve}(function(Te,Ve){const je={};if(Te)for(const Xe of Te){const Ye=Ve(Xe);je[Ye]===void 0&&(je[Ye]=[]),je[Ye].push(Xe)}return je}(M,E)),K=window.devicePixelRatio,ne=navigator.connection||navigator.mozConnection||navigator.webkitConnection,ae=ne?ne.effectiveType:void 0,he={counters:[],metadata:[],attributes:[]},fe=(Te,Ve,je)=>{je!=null&&Te.push({name:Ve,value:je.toString()})};for(const Te in q)fe(he.counters,Te,q[Te]);if(g.interactionRange[0]!==1/0&&g.interactionRange[1]!==-1/0&&(fe(he.counters,"interactionRangeMin",g.interactionRange[0]),fe(he.counters,"interactionRangeMax",g.interactionRange[1])),L)for(const Te of Object.keys(D)){const Ve=D[Te],je=L.find(Xe=>Xe.name===Ve);je&&fe(he.counters,Ve,je.startTime)}return fe(he.counters,"visibilityHidden",g.visibilityHidden),fe(he.attributes,"style",function(Te){if(Te)for(const Ve of Te){const je=Ve.name.split("?")[0];if(t.i(je)){const Xe=je.split("/").slice(-2);if(Xe.length===2)return`mapbox://styles/${Xe[0]}/${Xe[1]}`}}}(M)),fe(he.attributes,"terrainEnabled",g.terrainEnabled?"true":"false"),fe(he.attributes,"fogEnabled",g.fogEnabled?"true":"false"),fe(he.attributes,"projection",g.projection),fe(he.attributes,"zoom",g.zoom),fe(he.metadata,"devicePixelRatio",K),fe(he.metadata,"connectionEffectiveType",ae),fe(he.metadata,"navigatorUserAgent",navigator.userAgent),fe(he.metadata,"screenWidth",window.screen.width),fe(he.metadata,"screenHeight",window.screen.height),fe(he.metadata,"windowWidth",window.innerWidth),fe(he.metadata,"windowHeight",window.innerHeight),fe(he.metadata,"mapWidth",g.width/K),fe(he.metadata,"mapHeight",g.height/K),fe(he.metadata,"webglRenderer",g.renderer),fe(he.metadata,"webglVendor",g.vendor),fe(he.metadata,"sdkVersion",S),fe(he.metadata,"sdkIdentifier","mapbox-gl-js"),he}(n);for(const g of c.metadata);for(const g of c.counters);for(const g of c.attributes);this.postEvent(r,c,()=>{},u)}},pe=se.postPerformanceEvent.bind(se),Ke=new class extends He{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(u,r,n,c){if(!t.e.API_URL||!t.e.SESSION_PATH)return;const g=Le(t.e.API_URL+t.e.SESSION_PATH);g.params.push(`sku=${r||""}`),g.params.push(`access_token=${c||t.e.ACCESS_TOKEN||""}`);const M={url:Pe(g),headers:{"Content-Type":"text/plain"}};this.pendingRequest=t.g(M,L=>{this.pendingRequest=null,n(L),this.saveEventData(),this.processRequests(c)})}getSessionAPI(u,r,n,c){this.skuToken=r,this.errorCb=c,t.e.SESSION_PATH&&t.e.API_URL&&(n||t.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},n):this.errorCb(new Error(ye)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:n}=this.queue.shift();r&&this.success[r]||this.getSession(n,this.skuToken,c=>{c?this.errorCb(c):r&&(this.success[r]=!0)},u)}remove(){this.errorCb=null}},_e=Ke.getSessionAPI.bind(Ke),ke=new Set;function qe(u,r){r?ke.add(u):ke.delete(u)}class tt{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,n){this._updatedSourceCaches[r]=n,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){const n=r.scope;this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._updatedLayers[n].add(r.id),this.setDirty()}removeLayer(r){const n=r.scope;this._removedLayers[n]=this._removedLayers[n]||{},this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._removedLayers[n][r.id]=r,this._updatedLayers[n].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){const r={};for(const n in this._updatedLayers)r[n]=r[n]||{},r[n].updatedIds=Array.from(this._updatedLayers[n].values());for(const n in this._removedLayers)r[n]=r[n]||{},r[n].removedIds=Object.keys(this._removedLayers[n]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(r){this._updatedImages.add(r),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Ge(u){const{userImage:r}=u;return!!(r&&r.render&&r.render())&&(u.data.replace(new Uint8Array(r.data.buffer)),!0)}class We extends t.E{constructor(r){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=r,r!=="raster"&&t.t()&&(this.imageRasterizerDispatcher=new t.D(t.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new t.I),this._imageRasterizer}createScope(r){this.images[r]={},this.loaded[r]=!1,this.updatedImages[r]={},this.patterns[r]={},this.callbackDispatchedThisFrame[r]={},this.atlasImage[r]=new t.r({width:1,height:1})}isLoaded(){for(const r in this.loaded)if(!this.loaded[r])return!1;return!0}setLoaded(r,n){if(this.loaded[n]!==r&&(this.loaded[n]=r,r)){for(const{ids:c,callback:g}of this.requestors)this._notify(c,n,g);this.requestors=[]}}hasImage(r,n){return!!this.getImage(r,n)}getImage(r,n){return this.images[n][r]}addImage(r,n,c){this._validate(r,c)&&(this.images[n][r]=c)}_validate(r,n){let c=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new t.y(new Error(`Image "${r}" has invalid "stretchX" value`))),c=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new t.y(new Error(`Image "${r}" has invalid "stretchY" value`))),c=!1),this._validateContent(n.content,n)||(this.fire(new t.y(new Error(`Image "${r}" has invalid "content" value`))),c=!1),c}_validateStretch(r,n){if(!r)return!0;let c=0;for(const g of r){if(g[0]<c||g[1]<g[0]||n<g[1])return!1;c=g[1]}return!0}_validateContent(r,n){return r?r.length!==4||!n.usvg&&(r[0]<0||n.data.width<r[0]||r[1]<0||n.data.height<r[1]||r[2]<0||n.data.width<r[2]||r[3]<0||n.data.height<r[3])?!1:!(r[2]<r[0]||r[3]<r[1]):!0}updateImage(r,n,c){c.version=this.images[n][r].version+1,this.images[n][r]=c,this.updatedImages[n][r]=!0,this.removeFromImageRasterizerCache(r,n)}removeFromImageRasterizerCache(r,n){this.spriteFormat!=="raster"&&(t.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[r],scope:n}):this.imageRasterizer.removeImagesFromCacheByIds([r],n))}removeImage(r,n){const c=this.images[n][r];delete this.images[n][r],delete this.patterns[n][r],this.removeFromImageRasterizerCache(r,n),c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(r){return Object.keys(this.images[r])}getImages(r,n,c){let g=!0;const M=!!this.loaded[n];if(!M)for(const L of r)this.images[n][L]||(g=!1);M||g?this._notify(r,n,c):this.requestors.push({ids:r,scope:n,callback:c})}rasterizeImages({scope:r,imageTasks:n},c){const g={};for(const M in n){const L=n[M],q=this.getImage(L.id,r);q&&(g[M]={image:q,imageIdWithOptions:L})}t.t()?this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{imageTasks:g,scope:r},c):this.rasterizeImagesInMainThread({imageTasks:g,scope:r},c)}rasterizeImagesInMainThread(r,n){const{imageTasks:c,scope:g}=r,M={};for(const L in c){const{image:q,imageIdWithOptions:K}=c[L];M[L]=this.imageRasterizer.rasterize(K,q,g,"")}n(void 0,M)}getUpdatedImages(r){return this.updatedImages[r]}_notify(r,n,c){const g={};for(const M of r){this.images[n][M]||this.fire(new t.z("styleimagemissing",{id:M}));const L=this.images[n][M];L?g[M]={data:L.usvg?null:L.data.clone(),pixelRatio:L.pixelRatio,sdf:L.sdf,usvg:L.usvg,version:L.version,stretchX:L.stretchX,stretchY:L.stretchY,content:L.content,hasRenderCallback:!!(L.userImage&&L.userImage.render)}:t.w(`Image "${M}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,g)}getPixelSize(r){const{width:n,height:c}=this.atlasImage[r];return{width:n,height:c}}getPattern(r,n,c){const g=this.patterns[n][r],M=this.getImage(r,n);if(!M)return null;if(g&&g.position.version===M.version)return g.position;if(g)g.position.version=M.version;else{M.usvg&&!M.data&&(M.data=this.imageRasterizer.rasterize(t.A.from(r).getPrimary(),M,n,""));const L={w:M.data.width+2*t.B,h:M.data.height+2*t.B,x:0,y:0},q=new t.F(L,M,t.B);this.patterns[n][r]={bin:L,position:q}}return this._updatePatternAtlas(n,c),this.patterns[n][r].position}bind(r,n){const c=r.gl;let g=this.atlasTexture[n];g?this.dirty&&(g.update(this.atlasImage[n]),this.dirty=!1):(g=new t.T(r,this.atlasImage[n],c.RGBA8),this.atlasTexture[n]=g),g.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(r,n){const c=[];for(const q in this.patterns[r])c.push(this.patterns[r][q].bin);const{w:g,h:M}=t.C(c),L=this.atlasImage[r];L.resize({width:g||1,height:M||1});for(const q in this.patterns[r]){const{bin:K,position:ne}=this.patterns[r][q];let ae=ne.padding;const he=K.x+ae,fe=K.y+ae,Te=this.images[r][q].data,Ve=Te.width,je=Te.height;ae=ae>1?ae-1:ae,t.r.copy(Te,L,{x:0,y:0},{x:he,y:fe},{width:Ve,height:je},n),t.r.copy(Te,L,{x:0,y:je-ae},{x:he,y:fe-ae},{width:Ve,height:ae},n),t.r.copy(Te,L,{x:0,y:0},{x:he,y:fe+je},{width:Ve,height:ae},n),t.r.copy(Te,L,{x:Ve-ae,y:0},{x:he-ae,y:fe},{width:ae,height:je},n),t.r.copy(Te,L,{x:0,y:0},{x:he+Ve,y:fe},{width:ae,height:je},n),t.r.copy(Te,L,{x:Ve-ae,y:je-ae},{x:he-ae,y:fe-ae},{width:ae,height:ae},n),t.r.copy(Te,L,{x:0,y:je-ae},{x:he+Ve,y:fe-ae},{width:ae,height:ae},n),t.r.copy(Te,L,{x:0,y:0},{x:he+Ve,y:fe+je},{width:ae,height:ae},n),t.r.copy(Te,L,{x:Ve-ae,y:0},{x:he-ae,y:fe+je},{width:ae,height:ae},n)}this.dirty=!0}beginFrame(){for(const r in this.images)this.callbackDispatchedThisFrame[r]={}}dispatchRenderCallbacks(r,n){for(const c of r){if(this.callbackDispatchedThisFrame[n][c])continue;this.callbackDispatchedThisFrame[n][c]=!0;const g=this.images[n][c];Ge(g)&&this.updateImage(c,n,g)}}}function Je(u){const r=u.key,n=u.value,c=u.valueSpec||{},g=u.objectElementValidators||{},M=u.style,L=u.styleSpec;let q=[];const K=t.H(n);if(K!=="object")return[new t.V(r,n,`object expected, ${K} found`)];for(const ne in n){const ae=ne.split(".")[0];let he;g[ae]?he=g[ae]:c[ae]?he=St:g["*"]?he=g["*"]:c["*"]&&(he=St),he?q=q.concat(he({key:(r&&`${r}.`)+ne,value:n[ne],valueSpec:c[ae]||c["*"],style:M,styleSpec:L,object:n,objectKey:ne},n)):q.push(new t.G(r,n[ne],`unknown property "${ne}"`))}for(const ne in c)g[ne]||c[ne].required&&c[ne].default===void 0&&n[ne]===void 0&&q.push(new t.V(r,n,`missing required property "${ne}"`));return q}function it(u){const r=u.value,n=u.valueSpec,c=u.style,g=u.styleSpec,M=u.key,L=u.arrayElementValidator||St;if(t.H(r)!=="array")return[new t.V(M,r,`array expected, ${t.H(r)} found`)];if(n.length&&r.length!==n.length)return[new t.V(M,r,`array length ${n.length} expected, length ${r.length} found`)];if(n["min-length"]&&r.length<n["min-length"])return[new t.V(M,r,`array length at least ${n["min-length"]} expected, length ${r.length} found`)];let q={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};g.$version<7&&(q.function=n.function),t.H(n.value)==="object"&&(q=n.value);let K=[];for(let ne=0;ne<r.length;ne++)K=K.concat(L({array:r,arrayIndex:ne,value:r[ne],valueSpec:q,style:c,styleSpec:g,key:`${M}[${ne}]`},!0));return K}function ze(u){const r=u.key,n=u.value,c=u.valueSpec;let g=t.H(n);if(g==="number"&&n!=n&&(g="NaN"),g!=="number")return[new t.V(r,n,`number expected, ${g} found`)];if("minimum"in c){let M=c.minimum;if(t.H(c.minimum)==="array"&&(M=c.minimum[u.arrayIndex]),n<M)return[new t.V(r,n,`${n} is less than the minimum value ${M}`)]}if("maximum"in c){let M=c.maximum;if(t.H(c.maximum)==="array"&&(M=c.maximum[u.arrayIndex]),n>M)return[new t.V(r,n,`${n} is greater than the maximum value ${M}`)]}return[]}function de(u){const r=u.valueSpec,n=t.K(u.value.type);let c,g,M,L={};const q=n!=="categorical"&&u.value.property===void 0,K=!q,ne=t.H(u.value.stops)==="array"&&t.H(u.value.stops[0])==="array"&&t.H(u.value.stops[0][0])==="object",ae=Je({key:u.key,value:u.value,valueSpec:u.styleSpec.function,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(Te){if(n==="identity")return[new t.V(Te.key,Te.value,'identity function may not have a "stops" property')];let Ve=[];const je=Te.value;return Ve=Ve.concat(it({key:Te.key,value:je,valueSpec:Te.valueSpec,style:Te.style,styleSpec:Te.styleSpec,arrayElementValidator:he})),t.H(je)==="array"&&je.length===0&&Ve.push(new t.V(Te.key,je,"array must have at least one stop")),Ve},default:function(Te){return St({key:Te.key,value:Te.value,valueSpec:r,style:Te.style,styleSpec:Te.styleSpec})}}});return n==="identity"&&q&&ae.push(new t.V(u.key,u.value,'missing required property "property"')),n==="identity"||u.value.stops||ae.push(new t.V(u.key,u.value,'missing required property "stops"')),n==="exponential"&&u.valueSpec.expression&&!t.L(u.valueSpec)&&ae.push(new t.V(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(K&&!t.M(u.valueSpec)?ae.push(new t.V(u.key,u.value,"property functions not supported")):q&&!t.N(u.valueSpec)&&ae.push(new t.V(u.key,u.value,"zoom functions not supported"))),n!=="categorical"&&!ne||u.value.property!==void 0||ae.push(new t.V(u.key,u.value,'"property" property is required')),ae;function he(Te){let Ve=[];const je=Te.value,Xe=Te.key;if(t.H(je)!=="array")return[new t.V(Xe,je,`array expected, ${t.H(je)} found`)];if(je.length!==2)return[new t.V(Xe,je,`array length 2 expected, length ${je.length} found`)];if(ne){if(t.H(je[0])!=="object")return[new t.V(Xe,je,`object expected, ${t.H(je[0])} found`)];if(je[0].zoom===void 0)return[new t.V(Xe,je,"object stop key must have zoom")];if(je[0].value===void 0)return[new t.V(Xe,je,"object stop key must have value")];const Ye=t.K(je[0].zoom);if(typeof Ye!="number")return[new t.V(Xe,je[0].zoom,"stop zoom values must be numbers")];if(M&&M>Ye)return[new t.V(Xe,je[0].zoom,"stop zoom values must appear in ascending order")];Ye!==M&&(M=Ye,g=void 0,L={}),Ve=Ve.concat(Je({key:`${Xe}[0]`,value:je[0],valueSpec:{zoom:{}},style:Te.style,styleSpec:Te.styleSpec,objectElementValidators:{zoom:ze,value:fe}}))}else Ve=Ve.concat(fe({key:`${Xe}[0]`,value:je[0],style:Te.style,styleSpec:Te.styleSpec},je));return t.O(t.Q(je[1]))?Ve.concat([new t.V(`${Xe}[1]`,je[1],"expressions are not allowed in function stops.")]):Ve.concat(St({key:`${Xe}[1]`,value:je[1],valueSpec:r,style:Te.style,styleSpec:Te.styleSpec}))}function fe(Te,Ve){const je=t.H(Te.value),Xe=t.K(Te.value),Ye=Te.value!==null?Te.value:Ve;if(c){if(je!==c)return[new t.V(Te.key,Ye,`${je} stop domain type must match previous stop domain type ${c}`)]}else c=je;if(je!=="number"&&je!=="string"&&je!=="boolean"&&typeof Xe!="number"&&typeof Xe!="string"&&typeof Xe!="boolean")return[new t.V(Te.key,Ye,"stop domain value must be a number, string, or boolean")];if(je!=="number"&&n!=="categorical"){let at=`number expected, ${je} found`;return t.M(r)&&n===void 0&&(at+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new t.V(Te.key,Ye,at)]}return n!=="categorical"||je!=="number"||typeof Xe=="number"&&isFinite(Xe)&&Math.floor(Xe)===Xe?n!=="categorical"&&je==="number"&&typeof Xe=="number"&&typeof g=="number"&&g!==void 0&&Xe<g?[new t.V(Te.key,Ye,"stop domain values must appear in ascending order")]:(g=Xe,n==="categorical"&&Xe in L?[new t.V(Te.key,Ye,"stop domain values must be unique")]:(L[Xe]=!0,[])):[new t.V(Te.key,Ye,`integer expected, found ${String(Xe)}`)]}}function ve(u){const r=(u.expressionContext==="property"?t.S:t.U)(t.Q(u.value),u.valueSpec);if(r.result==="error")return r.value.map(c=>new t.V(`${u.key}${c.key}`,u.value,c.message));const n=r.value.expression||r.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!n.outputDefined())return[new t.V(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!t.W(n))return[new t.V(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter")return be(n,u);if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!t.X(n,["zoom","feature-state"]))return[new t.V(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!t.Y(n))return[new t.V(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function be(u,r){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const g of r.valueSpec.expression.parameters)n.delete(g);if(n.size===0)return[];const c=[];return u instanceof t.Z&&n.has(u.name)?[new t.V(r.key,r.value,`["${u.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(u.eachChild(g=>{c.push(...be(g,r))}),c)}function Oe(u){const r=u.key,n=u.value,c=u.valueSpec,g=[];return Array.isArray(c.values)?c.values.indexOf(t.K(n))===-1&&g.push(new t.V(r,n,`expected one of [${c.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(c.values).indexOf(t.K(n))===-1&&g.push(new t.V(r,n,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(n)} found`)),g}function ge(u){return t.$(t.Q(u.value))?ve(t.J({},u,{expressionContext:"filter",valueSpec:u.styleSpec[`filter_${u.layerType||"fill"}`]})):le(u)}function le(u){const r=u.value,n=u.key;if(t.H(r)!=="array")return[new t.V(n,r,`array expected, ${t.H(r)} found`)];const c=u.styleSpec;let g,M=[];if(r.length<1)return[new t.V(n,r,"filter array must have at least 1 element")];switch(M=M.concat(Oe({key:`${n}[0]`,value:r[0],valueSpec:c.filter_operator,style:u.style,styleSpec:u.styleSpec})),t.K(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&t.K(r[1])==="$type"&&M.push(new t.V(n,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&M.push(new t.V(n,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(g=t.H(r[1]),g!=="string"&&M.push(new t.V(`${n}[1]`,r[1],`string expected, ${g} found`)));for(let L=2;L<r.length;L++)g=t.H(r[L]),t.K(r[1])==="$type"?M=M.concat(Oe({key:`${n}[${L}]`,value:r[L],valueSpec:c.geometry_type,style:u.style,styleSpec:u.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&M.push(new t.V(`${n}[${L}]`,r[L],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let L=1;L<r.length;L++)M=M.concat(le({key:`${n}[${L}]`,value:r[L],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":g=t.H(r[1]),r.length!==2?M.push(new t.V(n,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="string"&&M.push(new t.V(`${n}[1]`,r[1],`string expected, ${g} found`))}return M}function et(u,r){const n=u.key,c=u.style,g=u.layer,M=u.styleSpec,L=u.value,q=u.objectKey,K=M[`${r}_${u.layerType}`];if(!K)return[];const ne=q.match(/^(.*)-use-theme$/);if(r==="paint"&&ne&&K[ne[1]])return St({key:n,value:L,valueSpec:{type:"string"},style:c,styleSpec:M});const ae=q.match(/^(.*)-transition$/);if(r==="paint"&&ae&&K[ae[1]]&&K[ae[1]].transition)return St({key:n,value:L,valueSpec:M.transition,style:c,styleSpec:M});const he=u.valueSpec||K[q];if(!he)return[new t.G(n,L,`unknown property "${q}"`)];let fe;if(t.H(L)==="string"&&t.M(he)&&!he.tokens&&(fe=/^{([^}]+)}$/.exec(L))){const Ve=`\`{ "type": "identity", "property": ${fe?JSON.stringify(fe[1]):'"_"'} }\``;return[new t.V(n,L,`"${q}" does not support interpolation syntax
Use an identity property function instead: ${Ve}.`)]}const Te=[];if(u.layerType==="symbol")q!=="text-field"||!c||c.glyphs||c.imports||Te.push(new t.V(n,L,'use of "text-field" requires a style "glyphs" property')),q==="text-font"&&t.a0(t.Q(L))&&t.K(L.type)==="identity"&&Te.push(new t.V(n,L,'"text-font" does not support identity functions'));else if(u.layerType==="model"&&r==="paint"&&g&&g.layout&&g.layout.hasOwnProperty("model-id")&&t.M(he)&&(t.a1(he)||t.N(he))){const Ve=t.S(t.Q(L),he),je=Ve.value.expression||Ve.value._styleExpression.expression;je&&!t.X(je,["measure-light"])&&(q==="model-emissive-strength"&&t.Y(je)&&t.W(je)||Te.push(new t.V(n,L,`${q} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Te.concat(St({key:u.key,value:L,valueSpec:he,style:c,styleSpec:M,expressionContext:"property",propertyType:r,propertyKey:q}))}function wt(u){return et(u,"paint")}function Ft(u){return et(u,"layout")}function Wt(u){let r=[];const n=u.value,c=u.key,g=u.style,M=u.styleSpec;n.type||n.ref||r.push(new t.V(c,n,'either "type" or "ref" is required'));let L=t.K(n.type);const q=t.K(n.ref);if(n.id){const K=t.K(n.id);for(let ne=0;ne<u.arrayIndex;ne++){const ae=g.layers[ne];t.K(ae.id)===K&&r.push(new t.V(c,n.id,`duplicate layer id "${n.id}", previously used at line ${ae.id.__line__}`))}}if("ref"in n){let K;["type","source","source-layer","filter","layout"].forEach(ne=>{ne in n&&r.push(new t.V(c,n[ne],`"${ne}" is prohibited for ref layers`))}),g.layers.forEach(ne=>{t.K(ne.id)===q&&(K=ne)}),K?K.ref?r.push(new t.V(c,n.ref,"ref cannot reference another ref layer")):L=t.K(K.type):typeof q=="string"&&r.push(new t.V(c,n.ref,`ref layer "${q}" not found`))}else if(L!=="background"&&L!=="sky"&&L!=="slot")if(n.source){const K=g.sources&&g.sources[n.source],ne=K&&t.K(K.type);K?ne==="vector"&&L==="raster"?r.push(new t.V(c,n.source,`layer "${n.id}" requires a raster source`)):ne==="raster"&&L!=="raster"?r.push(new t.V(c,n.source,`layer "${n.id}" requires a vector source`)):ne!=="vector"||n["source-layer"]?ne==="raster-dem"&&L!=="hillshade"?r.push(new t.V(c,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):ne!=="raster-array"||["raster","raster-particle"].includes(L)?L!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||ne==="geojson"&&K.lineMetrics?L==="raster-particle"&&ne!=="raster-array"&&r.push(new t.V(c,n.source,`layer "${n.id}" requires a 'raster-array' source.`)):r.push(new t.V(c,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new t.V(c,n.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new t.V(c,n,`layer "${n.id}" must specify a "source-layer"`)):r.push(new t.V(c,n.source,`source "${n.source}" not found`))}else r.push(new t.V(c,n,'missing required property "source"'));return r=r.concat(Je({key:c,value:n,valueSpec:M.layer,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{"*":()=>[],type:()=>St({key:`${c}.type`,value:n.type,valueSpec:M.layer.type,style:u.style,styleSpec:u.styleSpec,object:n,objectKey:"type"}),filter:K=>ge(t.J({layerType:L},K)),layout:K=>Je({layer:n,key:K.key,value:K.value,valueSpec:{},style:K.style,styleSpec:K.styleSpec,objectElementValidators:{"*":ne=>Ft(t.J({layerType:L},ne))}}),paint:K=>Je({layer:n,key:K.key,value:K.value,valueSpec:{},style:K.style,styleSpec:K.styleSpec,objectElementValidators:{"*":ne=>wt(t.J({layerType:L,layer:n},ne))}})}})),r}function or(u){const r=u.value,n=u.key,c=t.H(r);return c!=="string"?[new t.V(n,r,`string expected, ${c} found`)]:[]}const Or={promoteId:function({key:u,value:r}){if(t.H(r)==="string")return or({key:u,value:r});{const n=[];for(const c in r)n.push(...or({key:`${u}.${c}`,value:r[c]}));return n}}};function xr(u){const r=u.value,n=u.key,c=u.styleSpec,g=u.style;if(!r.type)return[new t.V(n,r,'"type" is required')];const M=t.K(r.type);let L=[];switch(["vector","raster","raster-dem","raster-array"].includes(M)&&(r.url||r.tiles||L.push(new t.G(n,r,'Either "url" or "tiles" is required.'))),M){case"vector":case"raster":case"raster-dem":case"raster-array":return L=L.concat(Je({key:n,value:r,valueSpec:c[`source_${M.replace("-","_")}`],style:u.style,styleSpec:c,objectElementValidators:Or})),L;case"geojson":if(L=Je({key:n,value:r,valueSpec:c.source_geojson,style:g,styleSpec:c,objectElementValidators:Or}),r.cluster)for(const q in r.clusterProperties){const[K,ne]=r.clusterProperties[q],ae=typeof K=="string"?[K,["accumulated"],["get",q]]:K;L.push(...ve({key:`${n}.${q}.map`,value:ne,expressionContext:"cluster-map"})),L.push(...ve({key:`${n}.${q}.reduce`,value:ae,expressionContext:"cluster-reduce"}))}return L;case"video":return Je({key:n,value:r,valueSpec:c.source_video,style:g,styleSpec:c});case"image":return Je({key:n,value:r,valueSpec:c.source_image,style:g,styleSpec:c});case"canvas":return[new t.V(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Oe({key:`${n}.type`,value:r.type,valueSpec:{values:Tr(c)}})}}function Tr(u){return u.source.reduce((r,n)=>{const c=u[n];return c.type.type==="enum"&&(r=r.concat(Object.keys(c.type.values))),r},[])}function br(u){const r=u.value,n=u.styleSpec,c=n.light,g=u.style;let M=[];const L=t.H(r);if(r===void 0)return M;if(L!=="object")return M=M.concat([new t.V("light",r,`object expected, ${L} found`)]),M;for(const q in r){const K=q.match(/^(.*)-transition$/),ne=q.match(/^(.*)-use-theme$/);M=M.concat(ne&&c[ne[1]]?St({key:q,value:r[q],valueSpec:{type:"string"},style:g,styleSpec:n}):K&&c[K[1]]&&c[K[1]].transition?St({key:q,value:r[q],valueSpec:n.transition,style:g,styleSpec:n}):c[q]?St({key:q,value:r[q],valueSpec:c[q],style:g,styleSpec:n}):[new t.V(q,r[q],`unknown property "${q}"`)])}return M}function fr(u){const r=u.value;let n=[];if(!r)return n;const c=t.H(r);if(c!=="object")return n=n.concat([new t.V("light-3d",r,`object expected, ${c} found`)]),n;const g=u.styleSpec,M=g["light-3d"],L=u.key,q=u.style,K=u.style.lights;for(const he of["type","id"])if(!(he in r))return n=n.concat([new t.V("light-3d",r,`missing property ${he} on light`)]),n;if(r.type&&K)for(let he=0;he<u.arrayIndex;he++){const fe=t.K(r.type),Te=K[he];t.K(Te.type)===fe&&n.push(new t.V(L,r.id,`duplicate light type "${r.type}", previously defined at line ${Te.id.__line__}`))}const ne=`properties_light_${r.type}`;if(!(ne in g))return n=n.concat([new t.V("light-3d",r,`Invalid light type ${r.type}`)]),n;const ae=g[ne];for(const he in r)if(he==="properties"){const fe=r[he],Te=t.H(fe);if(Te!=="object")return n=n.concat([new t.V("properties",fe,`object expected, ${Te} found`)]),n;for(const Ve in fe)n=n.concat(ae[Ve]?St({key:Ve,value:fe[Ve],valueSpec:ae[Ve],style:q,styleSpec:g}):[new t.G(u.key,fe[Ve],`unknown property "${Ve}"`)])}else{const fe=he.match(/^(.*)-transition$/),Te=he.match(/^(.*)-use-theme$/);n=n.concat(Te&&M[Te[1]]?St({key:he,value:r[he],valueSpec:{type:"string"},style:q,styleSpec:g}):fe&&M[fe[1]]&&M[fe[1]].transition?St({key:he,value:r[he],valueSpec:g.transition,style:q,styleSpec:g}):M[he]?St({key:he,value:r[he],valueSpec:M[he],style:q,styleSpec:g}):[new t.G(he,r[he],`unknown property "${he}"`)])}return n}function Vr(u){const r=u.value,n=u.key,c=u.style,g=u.styleSpec,M=g.terrain;let L=[];const q=t.H(r);if(r===void 0||q==="null")return L;if(q!=="object")return L=L.concat([new t.V("terrain",r,`object expected, ${q} found`)]),L;for(const K in r){const ne=K.match(/^(.*)-transition$/),ae=K.match(/^(.*)-use-theme$/);L=L.concat(ae&&M[ae[1]]?St({key:K,value:r[K],valueSpec:{type:"string"},style:c,styleSpec:g}):ne&&M[ne[1]]&&M[ne[1]].transition?St({key:K,value:r[K],valueSpec:g.transition,style:c,styleSpec:g}):M[K]?St({key:K,value:r[K],valueSpec:M[K],style:c,styleSpec:g}):[new t.G(K,r[K],`unknown property "${K}"`)])}if(r.source){const K=c.sources&&c.sources[r.source],ne=K&&t.K(K.type);K?ne!=="raster-dem"&&L.push(new t.V(n,r.source,`terrain cannot be used with a source of type ${String(ne)}, it only be used with a "raster-dem" source type`)):L.push(new t.V(n,r.source,`source "${r.source}" not found`))}else L.push(new t.V(n,r,'terrain is missing required property "source"'));return L}function Ir(u){const r=u.value,n=u.style,c=u.styleSpec,g=c.fog;let M=[];const L=t.H(r);if(r===void 0)return M;if(L!=="object")return M=M.concat([new t.V("fog",r,`object expected, ${L} found`)]),M;for(const q in r){const K=q.match(/^(.*)-transition$/),ne=q.match(/^(.*)-use-theme$/);M=M.concat(ne&&g[ne[1]]?St({key:q,value:r[q],valueSpec:{type:"string"},style:n,styleSpec:c}):K&&g[K[1]]&&g[K[1]].transition?St({key:q,value:r[q],valueSpec:c.transition,style:n,styleSpec:c}):g[q]?St({key:q,value:r[q],valueSpec:g[q],style:n,styleSpec:c}):[new t.G(q,r[q],`unknown property "${q}"`)])}return M}const De={"*":()=>[],array:it,boolean:function(u){const r=u.value,n=u.key,c=t.H(r);return c!=="boolean"?[new t.V(n,r,`boolean expected, ${c} found`)]:[]},number:ze,color:function(u){const r=u.key,n=u.value,c=t.H(n);return c!=="string"?[new t.V(r,n,`color expected, ${c} found`)]:t._.parseCSSColor(n)===null?[new t.V(r,n,`color expected, "${n}" found`)]:[]},enum:Oe,filter:ge,function:de,layer:Wt,object:Je,source:xr,model:t.a2,light:br,"light-3d":fr,terrain:Vr,fog:Ir,string:or,formatted:function(u){return or(u).length===0?[]:ve(u)},resolvedImage:function(u){return or(u).length===0?[]:ve(u)},projection:function(u){const r=u.value,n=u.styleSpec,c=n.projection,g=u.style;let M=[];const L=t.H(r);if(L==="object")for(const q in r)M=M.concat(St({key:q,value:r[q],valueSpec:c[q],style:g,styleSpec:n}));else L!=="string"&&(M=M.concat([new t.V("projection",r,`object or string expected, ${L} found`)]));return M},import:function(u){const{value:r,styleSpec:n}=u,{data:c,...g}=r;Object.defineProperty(g,"__line__",{value:r.__line__,enumerable:!1});let M=Je(t.J({},u,{value:g,valueSpec:n.import}));return t.K(g.id)===""&&M.push(new t.V(`${u.key}.id`,g,"import id can't be an empty string")),c&&(M=M.concat(ir(c,n,{key:`${u.key}.data`}))),M}};function St(u,r=!1){const n=u.value,c=u.valueSpec,g=u.styleSpec;if(c.expression&&t.a0(t.K(n)))return de(u);if(c.expression&&t.O(t.Q(n)))return ve(u);if(c.type&&De[c.type]){const M=De[c.type](u);return r===!0&&M.length>0&&t.H(u.value)==="array"?ve(u):M}return Je(t.J({},u,{valueSpec:c.type?g[c.type]:c}))}function Ut(u){const r=u.value,n=u.key,c=or(u);return c.length||(r.indexOf("{fontstack}")===-1&&c.push(new t.V(n,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&c.push(new t.V(n,r,'"glyphs" url must include a "{range}" token'))),c}function ir(u,r=t.a3,n={}){return St({key:n.key||"",value:u,valueSpec:r.$root,styleSpec:r,style:u,objectElementValidators:{glyphs:Ut,"*":()=>[]}})}function Rt(u,r=t.a3){return ot(ir(u,r))}const $t=u=>ot(xr(u)),rt=u=>ot(br(u)),sr=u=>ot(fr(u)),Fr=u=>ot(Vr(u)),ee=u=>ot(Ir(u)),Qe=u=>ot(function(r){const n=r.value,c=r.style,g=r.styleSpec,M=g.snow;let L=[];const q=t.H(n);if(n===void 0)return L;if(q!=="object")return L=L.concat([new t.V("snow",n,`object expected, ${q} found`)]),L;for(const K in n){const ne=K.match(/^(.*)-transition$/);L=L.concat(ne&&M[ne[1]]&&M[ne[1]].transition?St({key:K,value:n[K],valueSpec:g.transition,style:c,styleSpec:g}):M[K]?St({key:K,value:n[K],valueSpec:M[K],style:c,styleSpec:g}):[new t.G(K,n[K],`unknown property "${K}"`)])}return L}(u)),ie=u=>ot(function(r){const n=r.value,c=r.style,g=r.styleSpec,M=g.rain;let L=[];const q=t.H(n);if(n===void 0)return L;if(q!=="object")return L=L.concat([new t.V("rain",n,`object expected, ${q} found`)]),L;for(const K in n){const ne=K.match(/^(.*)-transition$/);L=L.concat(ne&&M[ne[1]]&&M[ne[1]].transition?St({key:K,value:n[K],valueSpec:g.transition,style:c,styleSpec:g}):M[K]?St({key:K,value:n[K],valueSpec:M[K],style:c,styleSpec:g}):[new t.G(K,n[K],`unknown property "${K}"`)])}return L}(u)),B=u=>ot(Wt(u)),Q=u=>ot(ge(u)),xe=u=>ot(wt(u)),Ne=u=>ot(Ft(u)),Ze=u=>ot(t.a2(u));function ot(u){return u.slice().sort((r,n)=>r.line&&n.line?r.line-n.line:0)}function mt(u,r){let n=!1;if(r&&r.length)for(const c of r)c instanceof t.G?t.w(c.message):(u.fire(new t.y(new Error(c.message))),n=!0);return n}let Nt;class Bt extends t.E{constructor(r,n="flat"){super(),this._transitionable=new t.a4(Nt||(Nt=new t.a5({anchor:new t.a6(t.a3.light.anchor),position:new t.a7(t.a3.light.position),color:new t.a6(t.a3.light.color),intensity:new t.a6(t.a3.light.intensity)}))),this.setLight(r,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,n,c={}){this._validate(rt,r,c)||(this._transitionable.setTransitionOrValue(r),this.id=n)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,n,c){return(!c||c.validate!==!1)&&mt(this,r.call(Rt,t.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.a3})))}}let Lt=class extends t.E{constructor(u,r,n,c){super(),this.scope=n,this._transitionable=new t.a4(new t.a5({source:new t.a6(t.a3.terrain.source),exaggeration:new t.a6(t.a3.terrain.exaggeration)}),n,c),this._transitionable.setTransitionOrValue(u,c),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(u,r){this._transitionable.setTransitionOrValue(u,r)}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}getExaggeration(u){return this._transitioning.possiblyEvaluate(new t.a8(u)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const u=this._transitionable._values.exaggeration;if(!u)return null;const r=u.value.expression;if(!r)return null;let n=-1,c=-1,g=1;for(const M of r.zoomStops)g=r.evaluate(new t.a8(M)),g>.01?(n=M,c=-1):c=M;return g<.01&&n>0&&c>n?[n,c]:null}isZoomDependent(){const u=this._transitionable._values.exaggeration;return u!=null&&u.value!=null&&u.value.expression!=null&&u.value.expression instanceof t.a9}};const Yt=45,cr=65,gr=.05;function Pr(u,r,n,c){const g=t.ac(Yt,cr,n),[M,L]=Jr(u,c);let q=1-Math.min(1,Math.exp((r-M)/(L-M)*-6));return q*=q*q,q=Math.min(1,1.00747*q),q*g*u.alpha}function Jr(u,r){const n=.5/Math.tan(.5*r);return[u.range[0]+n,u.range[1]+n]}function Br(u,r,n,c,g){const M=t.ab.vec3.transformMat4([],[r,n,c],g.mercatorFogMatrix);return Pr(u,t.ab.vec3.length(M),g.pitch,g._fov)}function Ur(u,r,n,c,g,M,L){const q=[[n,c,0],[g,c,0],[g,M,0],[n,M,0]];let K=Number.MAX_VALUE,ne=-Number.MAX_VALUE;for(const ae of q){const he=t.ab.vec3.transformMat4([],ae,r),fe=t.ab.vec3.length(he);K=Math.min(K,fe),ne=Math.max(ne,fe)}return[Pr(u,K,L.pitch,L._fov),Pr(u,ne,L.pitch,L._fov)]}class oi extends t.E{constructor(r,n,c,g){super();const M=new t.a5({range:new t.a6(t.a3.fog.range),color:new t.a6(t.a3.fog.color),"color-use-theme":new t.a6({type:"string","property-type":"data-constant",default:"default"}),"high-color":new t.a6(t.a3.fog["high-color"]),"high-color-use-theme":new t.a6({type:"string","property-type":"data-constant",default:"default"}),"space-color":new t.a6(t.a3.fog["space-color"]),"space-color-use-theme":new t.a6({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new t.a6(t.a3.fog["horizon-blend"]),"star-intensity":new t.a6(t.a3.fog["star-intensity"]),"vertical-range":new t.a6(t.a3.fog["vertical-range"])});this._transitionable=new t.a4(M,c,new Map(g)),this.set(r,g),this._transitioning=this._transitionable.untransitioned(),this._transform=n,this.properties=new t.ad(M),this.scope=c}get state(){const r=this._transform,n=r.projection.name==="globe",c=t.ae(r.zoom),g=this.properties.get("range"),M=[.5,3];return{range:n?[t.af(M[0],g[0],c),t.af(M[1],g[1],c)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,n,c={}){if(this._validate(ee,r,c))return;const g=t.l({},r);for(const M of Object.keys(t.a3.fog))g[M]===void 0&&(g[M]=t.a3.fog[M].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,n)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:t.ac(Yt,cr,r))*n.a}getOpacityAtLatLng(r,n){return this._transform.projection.supportsFog?function(c,g,M){const L=t.aa.fromLngLat(g),q=M.elevation?M.elevation.getAtPointOrZero(L):0;return Br(c,L.x,L.y,q,M)}(this.state,r,n):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(r.toUnwrapped());return Ur(this.state,n,0,0,t.ag,t.ag,this._transform)}getOpacityForBounds(r,n,c,g,M){return this._transform.projection.supportsFog?Ur(this.state,r,n,c,g,M,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?Jr(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const c of n){const g=r.points[c];let M;if(g[2]>=0)M=g;else{const L=r.points[c-4];M=t.ah(L,g,L[2]/(L[2]-g[2]))}if(Br(this.state,M[0],M[1],0,this._transform)>=gr)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,n,c){return(!c||c.validate!==!1)&&mt(this,r.call(Rt,t.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.a3})))}}let si,Kr,Wr,Pi,Ki=class extends t.E{constructor(u,r,n,c){super();const g=si||(si=new t.a5({density:new t.a6(t.a3.snow.density),intensity:new t.a6(t.a3.snow.intensity),color:new t.a6(t.a3.snow.color),opacity:new t.a6(t.a3.snow.opacity),vignette:new t.a6(t.a3.snow.vignette),"vignette-color":new t.a6(t.a3.snow["vignette-color"]),"center-thinning":new t.a6(t.a3.snow["center-thinning"]),direction:new t.a6(t.a3.snow.direction),"flake-size":new t.a6(t.a3.snow["flake-size"])}));this._transitionable=new t.a4(g,n,new Map(c)),this.set(u,c),this._transitioning=this._transitionable.untransitioned(),this.properties=new t.ad(g),this.scope=n}get state(){const u=this.properties.get("opacity"),r=this.properties.get("color"),n=this.properties.get("direction"),c=t.ai(n[0]),g=-Math.max(t.ai(n[1]),.01),M=[Math.cos(c)*Math.cos(g),Math.sin(c)*Math.cos(g),Math.sin(g)],L=this.properties.get("vignette"),q=this.properties.get("vignette-color");return q.a=L,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new t.aj(r.r,r.g,r.b,r.a*u),direction:M,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:q}}get(){return this._transitionable.serialize()}set(u,r,n={}){if(this._validate(Qe,u,n))return;const c=t.l({},u);for(const g of Object.keys(t.a3.snow))c[g]===void 0&&(c[g]=t.a3.snow[g].default);this._options=c,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,r,n){return(!n||n.validate!==!1)&&mt(this,u.call(Rt,t.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:t.a3})))}},xn=class extends t.E{constructor(u,r,n,c){super();const g=Kr||(Kr=new t.a5({density:new t.a6(t.a3.rain.density),intensity:new t.a6(t.a3.rain.intensity),color:new t.a6(t.a3.rain.color),opacity:new t.a6(t.a3.rain.opacity),vignette:new t.a6(t.a3.rain.vignette),"vignette-color":new t.a6(t.a3.rain["vignette-color"]),"center-thinning":new t.a6(t.a3.rain["center-thinning"]),direction:new t.a6(t.a3.rain.direction),"droplet-size":new t.a6(t.a3.rain["droplet-size"]),"distortion-strength":new t.a6(t.a3.rain["distortion-strength"])}));this._transitionable=new t.a4(g,n,new Map(c)),this.set(u,c),this._transitioning=this._transitionable.untransitioned(),this.properties=new t.ad(g),this.scope=n}get state(){const u=this.properties.get("opacity"),r=this.properties.get("color"),n=this.properties.get("direction"),c=t.ai(n[0]),g=-Math.max(t.ai(n[1]),.01),M=[Math.cos(c)*Math.cos(g),Math.sin(c)*Math.cos(g),Math.sin(g)],L=this.properties.get("vignette-color");return L.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new t.aj(r.r,r.g,r.b,r.a*u),direction:M,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:L}}get(){return this._transitionable.serialize()}set(u,r,n={}){if(this._validate(ie,u,n))return;const c=t.l({},u);for(const g of Object.keys(t.a3.rain))c[g]===void 0&&(c[g]=t.a3.rain[g].default);this._options=c,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,r,n){return(!n||n.validate!==!1)&&mt(this,u.call(Rt,t.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:t.a3})))}};class en extends t.E{constructor(r,n,c,g){super(),this.scope=c,this._options=r,this.properties=new t.ad(n),this._transitionable=new t.a4(n,c,new Map(g)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,n){this._options=r,this._transitionable.setTransitionOrValue(r.properties,n)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class ut{constructor(r,n,c,g){this.screenBounds=r,this.cameraPoint=n,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(r,n){let c,g;if(r instanceof t.P||typeof r[0]=="number"){const M=t.P.convert(r);c=[M],g=n.isPointAboveHorizon(M)}else{const M=t.P.convert(r[0]),L=t.P.convert(r[1]);c=[M,L],g=t.al(M,L).every(q=>n.isPointAboveHorizon(q))}return new ut(c,n.getCameraPoint(),g,n)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return t.al(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const n=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],g=t.al(n,c,0,!1);return this.cameraPoint.y>c.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<c.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=c.x?g[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(g[3]=this.cameraPoint)),t.am(g,r)}bufferedCameraGeometryGlobe(r){const n=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],g=t.al(n,c,r),M=this.cameraPoint.clone();switch(3*((M.y>n.y)+(M.y>c.y))+((M.x>n.x)+(M.x>c.x))){case 0:g[0]=M,g[4]=M.clone();break;case 1:g.splice(1,0,M);break;case 2:g[1]=M;break;case 3:g.splice(4,0,M);break;case 5:g.splice(2,0,M);break;case 6:g[3]=M;break;case 7:g.splice(3,0,M);break;case 8:g[2]=M}return g}containsTile(r,n,c,g=0){const M=r.queryPadding/n._pixelsPerMercatorPixel+1,L=c?this._bufferedCameraMercator(M,n):this._bufferedScreenMercator(M,n);let q=r.tileID.wrap+(L.unwrapped?g:0);const K=L.polygon.map(Xe=>t.an(r.tileTransform,Xe,q));if(!t.ao(K,0,0,t.ag,t.ag))return;q=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);const ne=this.screenGeometryMercator.polygon.map(Xe=>t.ap(r.tileTransform,Xe,q)),ae=ne.map(Xe=>new t.P(Xe[0],Xe[1])),he=n.getFreeCameraOptions().position||new t.aa(0,0,0),fe=t.ap(r.tileTransform,he,q),Te=ne.map(Xe=>{const Ye=t.ab.vec3.sub(Xe,Xe,fe);return t.ab.vec3.normalize(Ye,Ye),new t.aq(fe,Ye)}),Ve=t.ar(r,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:ae,tilespaceRays:Te,bufferedTilespaceGeometry:K,bufferedTilespaceBounds:(je=t.as(K),je.min.x=t.aw(je.min.x,0,t.ag),je.min.y=t.aw(je.min.y,0,t.ag),je.max.x=t.aw(je.max.x,0,t.ag),je.max.y=t.aw(je.max.y,0,t.ag),je),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:Ve};var je}_bufferedScreenMercator(r,n){const c=At(r);if(this._screenRaycastCache[c])return this._screenRaycastCache[c];{let g;return g=n.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),n):{polygon:this.bufferedScreenGeometry(r).map(M=>n.pointCoordinate3D(M)),unwrapped:!0},this._screenRaycastCache[c]=g,g}}_bufferedCameraMercator(r,n){const c=At(r);if(this._cameraRaycastCache[c])return this._cameraRaycastCache[c];{let g;return g=n.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),n):{polygon:this.bufferedCameraGeometry(r).map(M=>n.pointCoordinate3D(M)),unwrapped:!0},this._cameraRaycastCache[c]=g,g}}_projectAndResample(r,n){const c=function(M,L){const q=t.ab.mat4.multiply([],L.pixelMatrix,L.globeMatrix),K=[0,-t.ax,0,1],ne=[0,t.ax,0,1],ae=[0,0,0,1];t.ab.vec4.transformMat4(K,K,q),t.ab.vec4.transformMat4(ne,ne,q),t.ab.vec4.transformMat4(ae,ae,q);const he=new t.P(K[0]/K[3],K[1]/K[3]),fe=new t.P(ne[0]/ne[3],ne[1]/ne[3]),Te=t.au(M,he)&&K[3]<ae[3],Ve=t.au(M,fe)&&ne[3]<ae[3];if(!Te&&!Ve)return null;const je=function(vt,yt,Tt){for(let Dt=1;Dt<vt.length;Dt++){const Zt=Vt(yt.pointCoordinate3D(vt[Dt-1]).x),Ht=Vt(yt.pointCoordinate3D(vt[Dt]).x);if(Tt<0){if(Zt<Ht)return{idx:Dt,t:-Zt/(Ht-1-Zt)}}else if(Ht<Zt)return{idx:Dt,t:(1-Zt)/(Ht+1-Zt)}}return null}(M,L,Te?-1:1);if(!je)return null;const{idx:Xe,t:Ye}=je;let at=Xe>1?_t(M.slice(0,Xe),L):[],pt=Xe<M.length?_t(M.slice(Xe),L):[];at=at.map(vt=>new t.P(Vt(vt.x),vt.y)),pt=pt.map(vt=>new t.P(Vt(vt.x),vt.y));const ft=[...at];ft.length===0&&ft.push(pt[pt.length-1]);const bt=t.af(ft[ft.length-1].y,(pt.length===0?at[0]:pt[0]).y,Ye);let gt;return gt=Te?[new t.P(0,bt),new t.P(0,0),new t.P(1,0),new t.P(1,bt)]:[new t.P(1,bt),new t.P(1,1),new t.P(0,1),new t.P(0,bt)],ft.push(...gt),pt.length===0?ft.push(at[0]):ft.push(...pt),{polygon:ft.map(vt=>new t.aa(vt.x,vt.y)),unwrapped:!1}}(r,n);if(c)return c;const g=function(M,L){let q=!1,K=-1/0,ne=0;for(let he=0;he<M.length-1;he++)M[he].x>K&&(K=M[he].x,ne=he);for(let he=0;he<M.length-1;he++){const fe=(ne+he)%(M.length-1),Te=M[fe],Ve=M[fe+1];Math.abs(Te.x-Ve.x)>.5&&(Te.x<Ve.x?(Te.x+=1,fe===0&&(M[M.length-1].x+=1)):(Ve.x+=1,fe+1===M.length-1&&(M[0].x+=1)),q=!0)}const ae=t.at(L.center.lng);return q&&ae<Math.abs(ae-1)&&M.forEach(he=>{he.x-=1}),{polygon:M,unwrapped:q}}(_t(r,n).map(M=>new t.P(Vt(M.x),M.y)),n);return{polygon:g.polygon.map(M=>new t.aa(M.x,M.y)),unwrapped:g.unwrapped}}}function _t(u,r){return t.av(u,n=>{const c=r.pointCoordinate3D(n);n.x=c.x,n.y=c.y},1/256)}function Vt(u){return u<0?1+u%1:u%1}function At(u){return 100*u|0}function Qt(u,r,n,c,g){const M=function(q,K){if(q)return g(q);if(K){if(u.url&&K.tiles&&u.tiles&&delete u.tiles,K.variants){if(!Array.isArray(K.variants))return g(new Error("variants must be an array"));for(const ae of K.variants){if(ae==null||typeof ae!="object"||ae.constructor!==Object)return g(new Error("variant must be an object"));if(!Array.isArray(ae.capabilities))return g(new Error("capabilities must be an array"));if(ae.capabilities.length===1&&ae.capabilities[0]==="meshopt"){K=t.l(K,ae);break}}}const ne=t.ay(t.l({},K,u),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);ne.tiles=r.canonicalizeTileset(ne,u.url),g(null,ne)}},L=function(q,K,ne){if(!q)return null;if(!K&&!ne)return q;ne=ne||q.worldview_default;const ae=Object.values(q.language||{});if(ae.length===0)return null;const he=Object.values(q.worldview||{});if(he.length===0)return null;const fe=ae.every(Ve=>Ve===K),Te=he.every(Ve=>Ve===ne);return fe&&Te?q:K in(q.language_options||{})||ne in(q.worldview_options||{})?null:q.language_options&&q.worldview_options?q:null}(u.data,n,c);return L?t.q.frame(()=>M(null,L)):u.url?t.n(r.transformRequest(r.normalizeSourceURL(u.url,null,n,c),t.R.Source),M):t.q.frame(()=>{const{data:q,...K}=u;M(null,K)})}class Cr{constructor(r,n,c){this.bounds=t.az.convert(this.validateBounds(r)),this.minzoom=n||0,this.maxzoom=c||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const n=Math.pow(2,r.z),c=Math.floor(t.at(this.bounds.getWest())*n),g=Math.floor(t.aA(this.bounds.getNorth())*n),M=Math.ceil(t.at(this.bounds.getEast())*n),L=Math.ceil(t.aA(this.bounds.getSouth())*n);return r.x>=c&&r.x<M&&r.y>=g&&r.y<L}}class Ca extends t.E{constructor(r,n,c,g){if(super(),this.id=r,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.l(this,t.ay(n,["url","scheme","tileSize","promoteId"])),this._options=t.l({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new t.aB}load(r){this._loaded=!1,this.fire(new t.z("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=Qt(this._options,this.map._requestManager,n,c,(g,M)=>{if(this._tileJSONRequest=null,this._loaded=!0,g)n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),c&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new t.y(g));else if(M){if(t.l(this,M),this.hasWorldviews=!!M.worldview_options,M.worldview_default&&(this.worldviewDefault=M.worldview_default),M.vector_layers){this.vectorLayers=M.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const L of M.vector_layers)this.vectorLayerIds.push(L.id),M.worldview&&M.worldview[L.source]&&this.localizableLayerIds.add(L.id)}M.bounds&&(this.tileBounds=new Cr(M.bounds,this.minzoom,this.maxzoom)),ht(M.tiles,this.map._requestManager._customAccessToken),this.fire(new t.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.z("data",{dataType:"source",sourceDataType:"content"}))}r&&r(g)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=t.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return t.l({},this._options)}loadTile(r,n){const c=r.tileID.canonical.url(this.tiles,this.scheme),g=this.map._requestManager.normalizeTileURL(c),M=this.map._requestManager.transformRequest(g,t.R.Tile),L=this.map.style?this.map.style.getLut(this.scope):null,q=L?{image:L.image.clone()}:null,K={request:M,data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,lut:q,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:t.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&t.f(c)&&(K.worldview=this.map.getWorldview()||this.worldviewDefault,K.localizableLayerIds=this.localizableLayerIds),K.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=n:r.request=r.actor.send("reloadTile",K,ne.bind(this));else if(r.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",K,ne.bind(this),void 0,!0);else{const ae=t.aD.call({deduped:this._deduped},K,(he,fe)=>{he||!fe?ne.call(this,he):(K.data={cacheControl:fe.cacheControl,expires:fe.expires,rawData:fe.rawData.slice(0)},r.actor&&r.actor.send("loadTile",K,ne.bind(this),void 0,!0))},!0);r.request={cancel:ae}}function ne(ae,he){return delete r.request,r.aborted?n(null):ae&&ae.status!==404?n(ae):(he&&he.resourceTiming&&(r.resourceTiming=he.resourceTiming),this.map._refreshExpiredTiles&&he&&r.setExpiryData(he),r.loadVectorData(he,this.map.painter),t.aE(this.dispatcher),n(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,n){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Wa extends t.E{constructor(r,n,c,g){super(),this.id=r,this.dispatcher=c,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.l({type:"raster"},n),t.l(this,t.ay(n,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new t.z("dataloading",{dataType:"source"})),this._tileJSONRequest=Qt(this._options,this.map._requestManager,null,null,(n,c)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new t.y(n)):c&&(t.l(this,c),c.raster_layers&&(this.rasterLayers=c.raster_layers,this.rasterLayerIds=this.rasterLayers.map(g=>g.id)),c.bounds&&(this.tileBounds=new Cr(c.bounds,this.minzoom,this.maxzoom)),ht(c.tiles),this.fire(new t.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.z("data",{dataType:"source",sourceDataType:"content"}))),r&&r(n)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=t.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return t.l({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,n){const c=t.q.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),c,this.tileSize);r.request=t.o(this.map._requestManager.transformRequest(g,t.R.Tile),(M,L,q,K)=>(delete r.request,r.aborted?(r.state="unloaded",n(null)):M?(r.state="errored",n(M)):L?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:q,expires:K}),r.setTexture(L,this.map.painter),r.state="loaded",t.aE(this.dispatcher),void n(null)):n(null)))}abortTile(r,n){r.request&&(r.request.cancel(),delete r.request),n&&n()}unloadTile(r,n){r.texture&&r.texture instanceof t.T?(r.destroy(!0),r.texture&&r.texture instanceof t.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),n&&n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ea extends Wa{constructor(r,n,c,g){super(r,n,c,g),this.type="raster-array",this.maxzoom=22,this._options=t.l({type:"raster-array"},n)}triggerRepaint(r){const n=this.map.painter._terrain,c=this.map.style.getSourceCache(this.id);n&&n.enabled&&c&&n._clearRenderCacheForTile(c.id,r.tileID),this.map.triggerRepaint()}loadTile(r,n){const c=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(c,t.R.Tile);r.requestParams=g,r.actor||(r.actor=this.dispatcher.getActor()),r.request=r.fetchHeader(void 0,(M,L,q,K)=>{if(delete r.request,r.aborted)return r.state="unloaded",n(null);if(M)return M.code===20?void 0:(r.state="errored",n(M));this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:q,expires:K}),r.state="empty",n(null)})}unloadTile(r,n){const c=r.texture;c&&c instanceof t.T?(r.destroy(!0),this.map.painter.saveTileTexture(c)):(r.destroy(),r.flushQueues(),r._isHeaderLoaded=!1,delete r._mrt,delete r.textureDescriptor),r.fbo&&(r.fbo.destroy(),delete r.fbo),delete r.request,delete r.requestParams,delete r.neighboringTiles,r.state="unloaded"}prepareTile(r,n,c){r._isHeaderLoaded&&(r.state!=="empty"&&(r.state="reloading"),r.fetchBand(n,c,(g,M)=>{if(g)return r.state="errored",this.fire(new t.y(g)),void this.triggerRepaint(r);M&&(r.setTexture(M,this.map.painter),r.state="loaded",this.triggerRepaint(r))}))}getInitialBand(r){if(!this.rasterLayers)return 0;const n=this.rasterLayers.find(({id:M})=>M===r),c=n&&n.fields,g=c&&c.bands&&c.bands;return g?g[0]:0}getTextureDescriptor(r,n,c){if(!r)return;const g=n.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!g)return;let M=null;n instanceof t.aH?M=n.paint.get("raster-array-band"):n instanceof t.aI&&(M=n.paint.get("raster-particle-array-band"));const L=M||this.getInitialBand(g);if(L!=null)if(r.textureDescriptor){if(!r.updateNeeded(g,L)||c)return Object.assign({},r.textureDescriptor,{texture:r.texture})}else this.prepareTile(r,g,L)}}const Ra={vector:Ca,raster:Wa,"raster-dem":class extends Wa{constructor(u,r,n,c){super(u,r,n,c),this.type="raster-dem",this.maxzoom=22,this._options=t.l({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(u,r){const n=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function c(g,M){g&&(u.state="errored",r(g)),M&&(u.dem=M,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",r(null))}u.request=t.o(this.map._requestManager.transformRequest(n,t.R.Tile),function(g,M,L,q){if(delete u.request,u.aborted)u.state="unloaded",r(null);else if(g)u.state="errored",r(g);else if(M){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:L,expires:q});const K=ImageBitmap&&M instanceof ImageBitmap&&t.t(),ne=1-(M.width-t.aF(M.width))/2;ne<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const ae=K?M:t.q.getImageData(M,ne),he={uid:u.uid,coord:u.tileID,source:this.id,scope:this.scope,rawImageData:ae,encoding:this.encoding,padding:ne};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",he,c.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(u){const r=u.canonical,n=Math.pow(2,r.z),c=(r.x-1+n)%n,g=r.x===0?u.wrap-1:u.wrap,M=(r.x+1+n)%n,L=r.x+1===n?u.wrap+1:u.wrap,q={};return q[new t.aG(u.overscaledZ,g,r.z,c,r.y).key]={backfilled:!1},q[new t.aG(u.overscaledZ,L,r.z,M,r.y).key]={backfilled:!1},r.y>0&&(q[new t.aG(u.overscaledZ,g,r.z,c,r.y-1).key]={backfilled:!1},q[new t.aG(u.overscaledZ,u.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},q[new t.aG(u.overscaledZ,L,r.z,M,r.y-1).key]={backfilled:!1}),r.y+1<n&&(q[new t.aG(u.overscaledZ,g,r.z,c,r.y+1).key]={backfilled:!1},q[new t.aG(u.overscaledZ,u.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},q[new t.aG(u.overscaledZ,L,r.z,M,r.y+1).key]={backfilled:!1}),q}},"raster-array":ea,geojson:class extends t.E{constructor(u,r,n,c){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(c),this._data=r.data,this._options=t.l({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.minzoom!==void 0&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const g=t.ag/this.tileSize;this.workerOptions=t.l({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*g,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*g,extent:t.ag,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:t.ag,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*g,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}updateData(u){if(!this._options.dynamic)return this.fire(new t.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof u!="string"&&(u.type==="Feature"&&(u={type:"FeatureCollection",features:[u]}),u.type!=="FeatureCollection"))return this.fire(new t.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof u!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const r=new Map;for(const n of this._data.features)r.set(n.id,n);for(const n of u.features)r.set(n.id,n);this._data.features=[...r.values()]}else this._data=u;return this._updateWorkerData(!0),this}getClusterExpansionZoom(u,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id,scope:this.scope},r),this}getClusterChildren(u,r){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id,scope:this.scope},r),this}getClusterLeaves(u,r,n,c){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:u,limit:r,offset:n},c),this}_updateWorkerData(u=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.z("dataloading",{dataType:"source"})),this._loaded=!1;const r=t.l({append:u},this.workerOptions);r.scope=this.scope;const n=this._data;typeof n=="string"?(r.request=this.map._requestManager.transformRequest(t.q.resolveURL(n),t.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,(c,g)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new t.y(c));else{const M={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(M.resourceTiming=g.resourceTiming[this.id]),u&&(this._partialReload=!0),this.fire(new t.z("data",M)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(u),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(u,r){const n=u.actor?"reloadTile":"loadTile";u.actor=this.actor;const c=this.map.style?this.map.style.getLut(this.scope):null,g=c?{image:c.image.clone()}:null,M=this._partialReload,L={type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g,scope:this.scope,pixelRatio:t.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:M};u.request=this.actor.send(n,L,(q,K)=>M&&!K?(u.state="loaded",r(null)):(delete u.request,u.destroy(),u.aborted?r(null):q?r(q):(u.loadVectorData(K,this.map.painter,n==="reloadTile"),r(null))),void 0,n==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u,r){this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope}),u.destroy()}onRemove(u){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return t.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends t.aJ{constructor(u,r,n,c){super(u,r,n,c),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const r of u.urls)this.urls.push(this.map._requestManager.transformRequest(r,t.R.Source).url);t.aK(this.urls,(r,n)=>{this._loaded=!0,r?this.fire(new t.y(r)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const r=this.video.seekable;u<r.start(0)||u>r.end(0)?this.fire(new t.y(new t.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,r=u.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new t.T(u,this.video,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:t.aJ,model:class extends t.E{constructor(u,r,n,c){super(),this.id=u,this.type="model",this.models=[],this._loaded=!1,this._options=r}load(){const u=[];for(const r in this._options.models){const n=this._options.models[r],c=t.aM(this.map._requestManager.transformRequest(n.uri,t.R.Model).url).then(g=>{if(!g)return;const M=t.aN(g),L=new t.aO(r,n.position,n.orientation,M);L.computeBoundsAndApplyParent(),this.models.push(L)}).catch(g=>{this.fire(new t.y(new Error(`Could not load model ${r} from ${n.uri}: ${g.message}`)))});u.push(c)}return Promise.allSettled(u).then(()=>{this._loaded=!0,this.fire(new t.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(r=>{this.fire(new t.y(new Error(`Could not load models: ${r.message}`)))})}onAdd(u){this.map=u,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(u,r){}serialize(){return{type:"model"}}},"batched-model":class extends t.E{constructor(u,r,n,c){super(),this.type="batched-model",this.id=u,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(c)}onAdd(u){this.map=u,this.load()}load(u){this._loaded=!1,this.fire(new t.z("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map.getWorldview();this._tileJSONRequest=Qt(this._options,this.map._requestManager,r,n,(c,g)=>{this._tileJSONRequest=null,this._loaded=!0,c?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),n&&n.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new t.y(c))):g&&(t.l(this,g),g.bounds&&(this.tileBounds=new Cr(g.bounds,this.minzoom,this.maxzoom)),ht(g.tiles,this.map._requestManager._customAccessToken),this.fire(new t.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.z("data",{dataType:"source",sourceDataType:"content"}))),u&&u(c)})}hasTransition(){return!1}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loaded(){return this._loaded}loadTile(u,r){const n=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),c={request:this.map._requestManager.transformRequest(n,t.R.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:u.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(u.actor&&u.state!=="expired")if(u.state==="loading")u.reloadCallback=r;else{if(u.buckets){const M=Object.values(u.buckets);for(const L of M)L.dirty=!0;return void(u.state="loaded")}u.request=u.actor.send("reloadTile",c,g.bind(this))}else u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",c,g.bind(this),void 0,!0);function g(M,L){return u.aborted?r(null):M&&M.status!==404?r(M):(this.map._refreshExpiredTiles&&L&&u.setExpiryData(L),u.loadModelData(L,this.map.painter),u.state="loaded",void r(null))}}serialize(){return t.l({},this._options)}},canvas:class extends t.aJ{constructor(u,r,n,c){super(u,r,n,c),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(M=>typeof M!="number"))||this.fire(new t.y(new t.V(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.y(new t.V(`sources.${u}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new t.y(new t.V(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new t.y(new t.V(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.y(new t.V(`sources.${u}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(u){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?!u&&!this._playing||this.texture instanceof t.aL||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.T(r,this.canvas,r.gl.RGBA8,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends t.E{constructor(u,r,n,c){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=r,this.setEventedParent(c),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new t.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new t.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Cr(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),t.l(this,t.ay(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return t.ay(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new t.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this.map=u,this._loaded=!1,this.fire(new t.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){const{x:r,y:n,z:c}=u.canonical;return this._implementation.hasTile({x:r,y:n,z:c})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,r){const{x:n,y:c,z:g}=u.tileID.canonical,M=new AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:n,y:c,z:g},{signal:M.signal})).then(function(L){return delete u.request,u.aborted?(u.state="unloaded",r(null)):L===void 0?(u.state="errored",r(null)):L===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",r(null)):function(q){return q instanceof ImageData||q instanceof HTMLCanvasElement||q instanceof ImageBitmap||q instanceof HTMLImageElement}(L)?(this.loadTileData(u,L),u.state="loaded",void r(null)):(u.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(L=>{L.code!==20&&(u.state="errored",r(L))}),u.request.cancel=()=>M.abort()}loadTileData(u,r){u.setTexture(r,this.map.painter)}unloadTile(u,r){if(u.texture&&u.texture instanceof t.T?(u.destroy(!0),u.texture&&u.texture instanceof t.T&&this.map.painter.saveTileTexture(u.texture)):u.destroy(),this._implementation.unloadTile){const{x:n,y:c,z:g}=u.tileID.canonical;this._implementation.unloadTile({x:n,y:c,z:g})}r&&r()}abortTile(u,r){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),r&&r()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){const u=t.aC(this.id,this.scope);this.map.style.clearSource(u)}_update(){this.fire(new t.z("data",{dataType:"source",sourceDataType:"content"}))}}},To=function(u,r,n,c){const g=new Ra[r.type](u,r,n,c);if(g.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${g.id}`);return t.aP(["load","abort","unload","serialize","prepare"],g),g};function Es(u,r,n,c,g=!1){const M=r.sourceCache.transform,L=r.sourceCache.tilesIn(u,r.has3DLayers,g);L.sort(hu);const q=[];for(const K of L){const ne=K.tile.queryRenderedFeatures(r,K,n,c,M,g);Object.keys(ne).length&&q.push({wrappedTileID:K.tile.tileID.wrapped().key,queryResults:ne})}return q.length===0?{}:function(K){const ne={},ae={};for(const he of K){const fe=he.queryResults,Te=he.wrappedTileID,Ve=ae[Te]=ae[Te]||{};for(const je in fe){const Xe=fe[je],Ye=Ve[je]=Ve[je]||{},at=ne[je]=ne[je]||[];for(const pt of Xe)Ye[pt.featureIndex]||(Ye[pt.featureIndex]=!0,at.push(pt))}}return ne}(q)}function cu(u,r,n,c,g){const M={},L=c.queryRenderedSymbols(u),q=[];for(const K of Object.keys(L).map(Number))q.push(g[K]);q.sort(hu);for(const K of q){const ne=K.featureIndex.lookupSymbolFeatures(L[K.bucketInstanceId],K.bucketIndex,K.sourceLayerIndex,r,n);for(const ae in ne){const he=M[ae]=M[ae]||[],fe=ne[ae];fe.sort((Te,Ve)=>{const je=K.featureSortOrder;if(je){const Xe=je.indexOf(Te.featureIndex);return je.indexOf(Ve.featureIndex)-Xe}return Ve.featureIndex-Te.featureIndex});for(const Te of fe)he.push(Te)}}return M}function dl(u,r){const n=u.getRenderableIds().map(M=>u.getTileByID(M)),c=[],g={};for(let M=0;M<n.length;M++){const L=n[M],q=L.tileID.canonical.key;g[q]||(g[q]=!0,L.querySourceFeatures(c,r))}return c}function hu(u,r){const n=u.tileID,c=r.tileID;return n.overscaledZ-c.overscaledZ||n.canonical.y-c.canonical.y||n.wrap-c.wrap||n.canonical.x-c.canonical.x}function Vc(u,r){const n={};if(!r)return n;for(const c of u){const g=c.layerIds.map(M=>r.getLayer(M)).filter(Boolean);if(g.length!==0){c.layers=g,c.stateDependentLayerIds&&(c.stateDependentLayers=c.stateDependentLayerIds.map(M=>g.filter(L=>L.id===M)[0]));for(const M of g)n[M.fqid]=c}}return n}const pa=32,Da=33,ga=new Uint16Array(8184);for(let u=0;u<2046;u++){let r=u+2,n=0,c=0,g=0,M=0,L=0,q=0;for(1&r?g=M=L=pa:n=c=q=pa;(r>>=1)>1;){const ne=n+g>>1,ae=c+M>>1;1&r?(g=n,M=c,n=L,c=q):(n=g,c=M,g=L,M=q),L=ne,q=ae}const K=4*u;ga[K+0]=n,ga[K+1]=c,ga[K+2]=g,ga[K+3]=M}const La=new Uint16Array(2178),ro=new Uint8Array(1089),fu=new Uint16Array(1089);function pl(u){return u===0?-.03125:u===32?.03125:0}const So={type:2,extent:t.ag,loadGeometry:()=>[[new t.P(0,0),new t.P(t.ag+1,0),new t.P(t.ag+1,t.ag+1),new t.P(0,t.ag+1),new t.P(0,0)]]};class Mo{constructor(r,n,c,g,M){this.tileID=r,this.uid=t.aV(),this.uses=0,this.tileSize=n,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=M,g&&g.style&&(this._lastUpdatedBrightness=g.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection)}registerFadeDuration(r){const n=r+this.timeAdded;n<t.q.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=t.aQ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,n,c){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=Vc(r.buckets,n.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const M=this.buckets[g];if(M instanceof t.aX){if(this.hasSymbolBuckets=!0,!c)break;M.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const M=this.buckets[g];if(M instanceof t.aX&&M.hasRTLText){this.hasRTLText=!0,t.aY();break}}this.queryPadding=0;for(const g in this.buckets){const M=this.buckets[g],L=n.style.getOwnLayer(g);if(!L)continue;const q=L.queryRadius(M);this.queryPadding=Math.max(this.queryPadding,q)}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas),this._lastUpdatedBrightness=r.brightness}else this.collisionBoxArray=new t.aW}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(r,n,c){r&&(r.resourceTiming&&(this.resourceTiming=r.resourceTiming),this.buckets={...this.buckets,...Vc(r.buckets,n.style)},r.featureIndex&&(this.latestFeatureIndex=r.featureIndex))}getBucket(r){return this.buckets[r.fqid]}upload(r){for(const g in this.buckets){const M=this.buckets[g];M.uploadPending()&&M.upload(r)}const n=r.gl,c=this.imageAtlas;if(c&&!c.uploaded){const g=!!Object.keys(c.patternPositions).length;this.imageAtlasTexture=new t.T(r,c.image,n.RGBA8,{useMipmap:g}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new t.T(r,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new t.T(r,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(r,n,c){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture,c),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const g=n.style.getBrightness();(this._lastUpdatedBrightness||g)&&(this._lastUpdatedBrightness&&g&&Math.abs(this._lastUpdatedBrightness-g)<.001||(this.updateBuckets(n,this._lastUpdatedBrightness!==g),this._lastUpdatedBrightness=g))}queryRenderedFeatures(r,n,c,g,M,L){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const q=function(K,ne){const ae=t.ab.mat4.fromScaling([],[.5*K.width,.5*-K.height,1]);return t.ab.mat4.translate(ae,ae,[1,-1,0]),t.ab.mat4.multiply(ae,ae,K.calculateProjMatrix(ne.toUnwrapped())),Float32Array.from(ae)}(M,this.tileID);return this.latestFeatureIndex.query(r,{tilespaceGeometry:n,pixelPosMatrix:q,transform:g,availableImages:c,tileTransform:this.tileTransform})}querySourceFeatures(r,n){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const g=c.loadVTLayers(),M=n?n.sourceLayer:"",L=g._geojsonTileLayer||g[M];if(!L)return;const q=t.aZ(n&&n.filter),{z:K,x:ne,y:ae}=this.tileID.canonical,he={z:K,x:ne,y:ae};for(let fe=0;fe<L.length;fe++){const Te=L.feature(fe);if(q.needGeometry){const Xe=t.a_(Te,!0);if(!q.filter(new t.a8(this.tileID.overscaledZ),Xe,this.tileID.canonical))continue}else if(!q.filter(new t.a8(this.tileID.overscaledZ),Te))continue;const Ve=c.getId(Te,M),je=new t.a$(Te,K,ne,ae,Ve);je.tile=he,r.push(je)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const n=this.expirationTime;if(r.cacheControl){const c=t.b0(r.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const c=Date.now();let g=!1;if(this.expirationTime>c)g=!1;else if(n)if(this.expirationTime<n)g=!0;else{const M=this.expirationTime-n;M?this.expirationTime=c+Math.max(M,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(r){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&r&&this.updateBuckets(r)}updateBuckets(r,n){if(!this.latestFeatureIndex||!r.style)return;const c=this.latestFeatureIndex.loadVTLayers(),g=r.style.listImages(),M=r.style.getBrightness();for(const L in this.buckets){if(!r.style.hasLayer(L))continue;const q=this.buckets[L],K=q.layers[0],ne=K.sourceLayer||"_geojsonTileLayer",ae=c[ne],he=r.style.getLayerSourceCache(K);let fe={};he&&(fe=he._state.getState(ne,void 0));const Te=this.imageAtlas&&this.imageAtlas.patternPositions||{},Ve=Object.keys(fe).length>0&&!n;Ve&&!q.stateDependentLayers.length&&!n||q.update(fe,ae,g,Te,Ve?q.stateDependentLayers:q.layers,n,M),(q instanceof t.b1||q instanceof t.b2)&&r._terrain&&r._terrain.enabled&&he&&q.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(he.id,this.tileID);const je=r&&r.style&&r.style.getOwnLayer(L);je&&(this.queryPadding=Math.max(this.queryPadding,je.queryRadius(q)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<t.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=t.q.now()+r}setTexture(r,n){const c=n.context,g=c.gl;this.texture=this.texture||n.getTileTexture(r.width),this.texture&&this.texture instanceof t.T?this.texture.update(r):(this.texture=new t.T(c,r,g.RGBA8,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE))}setDependencies(r,n){const c={};for(const g of n)c[g]=!0;this.dependencies[r]=c}hasDependency(r,n){for(const c of r){const g=this.dependencies[c];if(g){for(const M of n)if(g[M])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const c=t.b3(So,this.tileID.canonical,this.tileTransform)[0],g=new t.b4,M=new t.b5;for(let L=0;L<c.length;L++){const{x:q,y:K}=c[L];g.emplaceBack(q,K),M.emplaceBack(L)}M.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(M),this._tileDebugBuffer=r.createVertexBuffer(g,t.b6.members),this._tileDebugSegments=t.b7.simpleSegment(0,0,g.length,M.length)}_makeTileBoundsBuffers(r,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const c=t.b3(So,this.tileID.canonical,this.tileTransform)[0];let g,M;if(this.isRaster){const L=function(q,K){const ne=t.aQ(q,K),ae=Math.pow(2,q.z);for(let Xe=0;Xe<Da;Xe++)for(let Ye=0;Ye<Da;Ye++){const at=t.aR((q.x+(Ye+pl(Ye))/pa)/ae),pt=t.aS((q.y+(Xe+pl(Xe))/pa)/ae),ft=K.project(at,pt),bt=Xe*Da+Ye;La[2*bt+0]=Math.round((ft.x*ne.scale-ne.x)*t.ag),La[2*bt+1]=Math.round((ft.y*ne.scale-ne.y)*t.ag)}ro.fill(0),fu.fill(0);for(let Xe=2045;Xe>=0;Xe--){const Ye=4*Xe,at=ga[Ye+0],pt=ga[Ye+1],ft=ga[Ye+2],bt=ga[Ye+3],gt=at+ft>>1,vt=pt+bt>>1,yt=gt+vt-pt,Tt=vt+at-gt,Dt=pt*Da+at,Zt=bt*Da+ft,Ht=vt*Da+gt,Pt=Math.hypot((La[2*Dt+0]+La[2*Zt+0])/2-La[2*Ht+0],(La[2*Dt+1]+La[2*Zt+1])/2-La[2*Ht+1])>=16;ro[Ht]=ro[Ht]||(Pt?1:0),Xe<1022&&(ro[Ht]=ro[Ht]||ro[(pt+Tt>>1)*Da+(at+yt>>1)]||ro[(bt+Tt>>1)*Da+(ft+yt>>1)])}const he=new t.aT,fe=new t.aU;let Te=0;function Ve(Xe,Ye){const at=Ye*Da+Xe;return fu[at]===0&&(he.emplaceBack(La[2*at+0],La[2*at+1],Xe*t.ag/pa,Ye*t.ag/pa),fu[at]=++Te),fu[at]-1}function je(Xe,Ye,at,pt,ft,bt){const gt=Xe+at>>1,vt=Ye+pt>>1;if(Math.abs(Xe-ft)+Math.abs(Ye-bt)>1&&ro[vt*Da+gt])je(ft,bt,Xe,Ye,gt,vt),je(at,pt,ft,bt,gt,vt);else{const yt=Ve(Xe,Ye),Tt=Ve(at,pt),Dt=Ve(ft,bt);fe.emplaceBack(yt,Tt,Dt)}}return je(0,0,pa,pa,pa,0),je(pa,pa,0,0,0,pa),{vertices:he,indices:fe}}(this.tileID.canonical,n);g=L.vertices,M=L.indices}else{g=new t.aT,M=new t.aU;for(const{x:q,y:K}of c)g.emplaceBack(q,K,0,0);const L=t.b8(g.int16,void 0,4);for(let q=0;q<L.length;q+=3)M.emplaceBack(L[q],L[q+1],L[q+2])}this._tileBoundsBuffer=r.createVertexBuffer(g,t.b9.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(M),this._tileBoundsSegments=t.b7.simpleSegment(0,0,g.length,M.length)}_makeGlobeTileDebugBuffers(r,n){const c=n.projection;if(!c||c.name!=="globe"||n.freezeTileCoverage)return;const g=this.tileID.canonical,M=t.ba(g,n),L=t.bb(M),q=t.ae(n.zoom);let K;q>0&&(K=t.ab.mat4.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,g,n,L,K,q),this._makeGlobeTileDebugTextBuffer(r,g,n,L,K,q)}_globePoint(r,n,c,g,M,L,q){let K=t.bc(r,n,c);if(L){const ne=1<<c.z,ae=t.at(g.center.lng),he=t.aA(g.center.lat),fe=(c.x+.5)/ne-ae;let Te=0;fe>.5?Te=-1:fe<-.5&&(Te=1);let Ve=(r/t.ag+c.x)/ne+Te,je=(n/t.ag+c.y)/ne;Ve=(Ve-ae)*g._pixelsPerMercatorPixel+ae,je=(je-he)*g._pixelsPerMercatorPixel+he;const Xe=[Ve*g.worldSize,je*g.worldSize,0];t.ab.vec3.transformMat4(Xe,Xe,L),K=t.bd(K,Xe,q)}return t.ab.vec3.transformMat4(K,K,M)}_makeGlobeTileDebugBorderBuffer(r,n,c,g,M,L){const q=new t.b4,K=new t.b5,ne=new t.be,ae=(fe,Te,Ve,je,Xe)=>{const Ye=(Ve-fe)/(Xe-1),at=(je-Te)/(Xe-1),pt=q.length;for(let ft=0;ft<Xe;ft++){const bt=fe+ft*Ye,gt=Te+ft*at;q.emplaceBack(bt,gt);const vt=this._globePoint(bt,gt,n,c,g,M,L);ne.emplaceBack(vt[0],vt[1],vt[2]),K.emplaceBack(pt+ft)}},he=t.ag;ae(0,0,he,0,16),ae(he,0,he,he,16),ae(he,he,0,he,16),ae(0,he,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(K),this._tileDebugBuffer=r.createVertexBuffer(q,t.b6.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(ne,t.bf.members),this._tileDebugSegments=t.b7.simpleSegment(0,0,q.length,K.length)}_makeGlobeTileDebugTextBuffer(r,n,c,g,M,L){const q=t.ag/4,K=new t.b4,ne=new t.aU,ae=new t.be,he=25;ne.reserve(32),K.reserve(he),ae.reserve(he);const fe=(Te,Ve)=>he*Te+Ve;for(let Te=0;Te<he;Te++){const Ve=Te*q;for(let je=0;je<he;je++){const Xe=je*q;K.emplaceBack(Xe,Ve);const Ye=this._globePoint(Xe,Ve,n,c,g,M,L);ae.emplaceBack(Ye[0],Ye[1],Ye[2])}}for(let Te=0;Te<4;Te++)for(let Ve=0;Ve<4;Ve++){const je=fe(Te,Ve),Xe=fe(Te,Ve+1),Ye=fe(Te+1,Ve),at=fe(Te+1,Ve+1);ne.emplaceBack(je,Xe,Ye),ne.emplaceBack(Ye,Xe,at)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(ne),this._tileDebugTextBuffer=r.createVertexBuffer(K,t.b6.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(ae,t.bf.members),this._tileDebugTextSegments=t.b7.simpleSegment(0,0,he,32)}destroy(r=!1){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!r&&this.texture&&this.texture instanceof t.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}t.bg.setPbf(t.bh);class du extends Mo{constructor(r,n,c,g,M){super(r,n,c,g,M),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(r,n){const c=n.context,g=c.gl;this.texture=this.texture||n.getTileTexture(r.width),this.texture&&this.texture instanceof t.T?this.texture.update(r,{premultiply:!1}):this.texture=new t.T(c,r,g.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(r=16384,n){const c=this._mrt=new t.bg(30),g=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(r-1)}});return this.entireBuffer=null,this.request=t.bi(g,(M,L,q,K)=>{if(M)n(M);else try{const ne=c.getHeaderLength(L);if(ne>r)return void(this.request=this.fetchHeader(ne,n));c.parseHeader(L),this._isHeaderLoaded=!0;let ae=0;for(const he of Object.values(c.layers))ae=Math.max(ae,he.dataIndex[he.dataIndex.length-1].last_byte);L.byteLength>=ae&&(this.entireBuffer=L),n(null,this.entireBuffer||L,q,K)}catch(ne){n(ne)}}),this.request}fetchBand(r,n,c){const g=this._mrt;if(!this._isHeaderLoaded||!g)return void c(new Error("Tile header is not ready"));const M=this.actor;if(!M)return void c(new Error("Can't fetch tile band without an actor"));let L;const q=(he,fe)=>{L.complete(he,fe),he?c(he):(this.updateTextureDescriptor(r,n),c(null,this.textureDescriptor&&this.textureDescriptor.img))},K=(he,fe)=>{if(he)return c(he);const Te=M.send("decodeRasterArray",{buffer:fe,task:L},q,void 0,!0);this._workQueue.push(()=>{Te&&Te.cancel(),L.cancel()})},ne=g.getLayer(r);if(!ne)return void c(new Error(`Unknown sourceLayer "${r}"`));if(ne.hasDataForBand(n))return this.updateTextureDescriptor(r,n),void c(null,this.textureDescriptor?this.textureDescriptor.img:null);const ae=ne.getDataRange([n]);if(L=g.createDecodingTask(ae),!L||L.tasks.length)if(this.flushQueues(),this.entireBuffer)K(null,this.entireBuffer.slice(ae.firstByte,ae.lastByte+1));else{const he=Object.assign({},this.requestParams,{headers:{Range:`bytes=${ae.firstByte}-${ae.lastByte}`}}),fe=t.bi(he,K);this._fetchQueue.push(()=>{fe.cancel(),L.cancel()})}else c(null)}updateNeeded(r,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==r)&&this.state!=="errored"}updateTextureDescriptor(r,n){if(!this._mrt)return;const c=this._mrt.getLayer(r);if(!c||!c.hasBand(n)||!c.hasDataForBand(n))return;const{bytes:g,tileSize:M,buffer:L,offset:q,scale:K}=c.getBandView(n),ne=M+2*L,ae={data:g,width:ne,height:ne},he=this.texture;he&&he instanceof t.T&&he.update(ae,{premultiply:!1}),this.textureDescriptor={layer:r,band:n,img:ae,buffer:L,offset:q,tileSize:M,format:c.pixelFormat,mix:[K,256*K,65536*K,16777216*K]}}}class Gc{constructor(r,n){this.max=r,this.onRemove=n,this.reset()}reset(){for(const r in this.data)for(const n of this.data[r])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(r,n,c){const g=r.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const M={value:n,timeout:void 0};if(c!==void 0&&(M.timeout=setTimeout(()=>{this.remove(r,M)},c)),this.data[g].push(M),this.order.push(g),this.order.length>this.max){const L=this._getAndRemoveByKey(this.order[0]);L&&this.onRemove(L)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const n=this.data[r].shift();return n.timeout&&clearTimeout(n.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),n.value}getByKey(r){const n=this.data[r];return n?n[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,n){if(!this.has(r))return this;const c=r.wrapped().key,g=n===void 0?0:this.data[c].indexOf(n),M=this.data[c][g];return this.data[c].splice(g,1),M.timeout&&clearTimeout(M.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(M.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(r){const n=[];for(const c in this.data)for(const g of this.data[c])r(g.value)||n.push(g);for(const c of n)this.remove(c.value.tileID,c)}}class Ts{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,n,c){const g=String(n);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][g]=this.stateChanges[r][g]||{},t.l(this.stateChanges[r][g],c),this.deletedStates[r]===null){this.deletedStates[r]={};for(const M in this.state[r])M!==g&&(this.deletedStates[r][M]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][g]===null){this.deletedStates[r][g]={};for(const M in this.state[r][g])c[M]||(this.deletedStates[r][g][M]=null)}else for(const M in c)this.deletedStates[r]&&this.deletedStates[r][g]&&this.deletedStates[r][g][M]===null&&delete this.deletedStates[r][g][M]}removeFeatureState(r,n,c){if(this.deletedStates[r]===null)return;const g=String(n);if(this.deletedStates[r]=this.deletedStates[r]||{},c&&n!==void 0)this.deletedStates[r][g]!==null&&(this.deletedStates[r][g]=this.deletedStates[r][g]||{},this.deletedStates[r][g][c]=null);else if(n!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][g])for(c in this.deletedStates[r][g]={},this.stateChanges[r][g])this.deletedStates[r][g][c]=null;else this.deletedStates[r][g]=null;else this.deletedStates[r]=null}getState(r,n){const c=this.state[r]||{},g=this.stateChanges[r]||{},M=this.deletedStates[r];if(M===null)return{};if(n!==void 0){const q=String(n),K=t.l({},c[q],g[q]);if(M){const ne=M[n];if(ne===null)return{};for(const ae in ne)delete K[ae]}return K}const L=t.l({},c,g);if(M)for(const q in M)delete L[q];return L}initializeTileState(r,n){r.refreshFeatureState(n)}coalesceChanges(r,n){const c={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const M={};for(const L in this.stateChanges[g])this.state[g][L]||(this.state[g][L]={}),t.l(this.state[g][L],this.stateChanges[g][L]),M[L]=this.state[g][L];c[g]=M}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const M={};if(this.deletedStates[g]===null)for(const L in this.state[g])M[L]={},this.state[g][L]={};else for(const L in this.deletedStates[g]){if(this.deletedStates[g][L]===null)this.state[g][L]={};else if(this.state[g][L])for(const q of Object.keys(this.deletedStates[g][L]))delete this.state[g][L][q];M[L]=this.state[g][L]}c[g]=c[g]||{},t.l(c[g],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const g in r)r[g].refreshFeatureState(n)}}class ya extends t.E{constructor(r,n,c){super(),this.id=r,this._onlySymbols=c,n.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new Gc(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Ts,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const n=this._tiles[r];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,n){return r.isSymbolTile=this._onlySymbols,r.isExtraShadowCaster=this._shadowCasterTiles[r.tileID.key],this._source.loadTile(r,n)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r)}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r)}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const c=this._tiles[n];c.upload(r),c.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return t.bj(this._tiles).map(r=>r.tileID).sort(pu).map(r=>r.key)}getRenderableIds(r,n){const c=[];for(const g in this._tiles)this._isIdRenderable(+g,r,n)&&c.push(this._tiles[g]);return r?c.sort((g,M)=>{const L=g.tileID,q=M.tileID,K=new t.P(L.canonical.x,L.canonical.y)._rotate(this.transform.angle),ne=new t.P(q.canonical.x,q.canonical.y)._rotate(this.transform.angle);return L.overscaledZ-q.overscaledZ||ne.y-K.y||ne.x-K.x}).map(g=>g.tileID.key):c.map(g=>g.tileID).sort(pu).map(g=>g.key)}hasRenderableParent(r){const n=this.findLoadedParent(r,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(r,n,c){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(n||!this._tiles[r].holdingForFade())&&(c||!this._shadowCasterTiles[r])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,n){const c=this._tiles[r];c&&(c.state!=="loading"&&(c.state=n),this._loadTile(c,this._tileLoaded.bind(this,c,r,n)))}_tileLoaded(r,n,c,g){if(g)if(r.state="errored",g.status!==404)this._source.fire(new t.y(g,{tile:r}));else{if(this._source.fire(new t.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:r})),!(r.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const M=this.map.painter.terrain;this.update(this.transform,M.getScaledDemTileSize(),!0),M.resetTileLookupCache(this.id)}else this.update(this.transform)}else r.timeAdded=t.q.now(),c==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(n,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new t.z("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const n=this.getRenderableIds();for(let g=0;g<n.length;g++){const M=n[g];if(r.neighboringTiles&&r.neighboringTiles[M]){const L=this.getTileByID(M);c(r,L),c(L,r)}}function c(g,M){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let L=M.tileID.canonical.x-g.tileID.canonical.x;const q=M.tileID.canonical.y-g.tileID.canonical.y,K=Math.pow(2,g.tileID.canonical.z),ne=M.tileID.key;L===0&&q===0||Math.abs(q)>1||(Math.abs(L)>1&&(Math.abs(L+K)===1?L+=K:Math.abs(L-K)===1&&(L-=K)),M.dem&&g.dem&&(g.dem.backfillBorder(M.dem,L,q),g.neighboringTiles&&g.neighboringTiles[ne]&&(g.neighboringTiles[ne].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,n,c,g){for(const M in this._tiles){let L=this._tiles[M];if(g[M]||!L.hasData()||L.tileID.overscaledZ<=n||L.tileID.overscaledZ>c)continue;let q=L.tileID;for(;L&&L.tileID.overscaledZ>n+1;){const ne=L.tileID.scaledTo(L.tileID.overscaledZ-1);L=this._tiles[ne.key],L&&L.hasData()&&(q=ne)}let K=q;for(;K.overscaledZ>n;)if(K=K.scaledTo(K.overscaledZ-1),r[K.key]){g[q.key]=q;break}}}findLoadedParent(r,n){if(r.key in this._loadedParentTiles){const c=this._loadedParentTiles[r.key];return c&&c.tileID.overscaledZ>=n?c:null}for(let c=r.overscaledZ-1;c>=n;c--){const g=r.scaledTo(c),M=this._getLoadedTile(g);if(M)return M}}_getLoadedTile(r){const n=this._tiles[r.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,n){n=n||this._source.tileSize;const c=Math.ceil(r.width/n)+1,g=Math.ceil(r.height/n)+1,M=Math.floor(c*g*5),L=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,M):M,q=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,L):L;this._cache.setMaxSize(q)}handleWrapJump(r){const n=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,n){const c={};for(const g in this._tiles){const M=this._tiles[g];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+n),c[M.tileID.key]=M}this._tiles=c;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(r,n,c,g){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;this.updateCacheSize(r,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const M=this._source.type==="batched-model";let L,q=this._source.maxzoom;const K=this.map&&this.map.painter?this.map.painter._terrain:null;if(K&&K.sourceCache===this&&K.attenuationRange()){const he=K.attenuationRange()[0],fe=Math.floor(he)-Math.log2(K.getDemUpscale());q>fe&&(q=fe)}if(this.used||this.usedForTerrain){if(this._source.tileID)L=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(he=>new t.aG(he.canonical.z,he.wrap,he.canonical.z,he.canonical.x,he.canonical.y));else if(this.tileCoverLift!==0){const he=r.clone();he.tileCoverLift=this.tileCoverLift,L=he.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:q,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:M}),this._source.minzoom<=1&&r.projection.name==="globe"&&(L.push(new t.aG(1,0,1,0,0)),L.push(new t.aG(1,0,1,1,0)),L.push(new t.aG(1,0,1,0,1)),L.push(new t.aG(1,0,1,1,1)))}else if(L=r.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:q,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:M}),this._source.hasTile){const he=this._source.hasTile.bind(this._source);L=L.filter(fe=>he(fe))}}else L=[];if(L.length>0&&this.castsShadows&&g&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!mu(this._source.type)){const he=r.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!c}),fe=Math.min(he,this._source.maxzoom);if(M){const Te=r.extendTileCover(L,fe);for(const Ve of Te)L.push(Ve)}else{const Te=r.extendTileCover(L,fe,g);for(const Ve of Te)this._shadowCasterTiles[Ve.key]=!0,L.push(Ve)}}const ne=this._updateRetainedTiles(L);if(mu(this._source.type)&&L.length!==0){const he={},fe={},Te=Object.keys(ne);for(const je of Te){const Xe=ne[je],Ye=this._tiles[je];if(!Ye||Ye.fadeEndTime&&Ye.fadeEndTime<=t.q.now())continue;const at=this.findLoadedParent(Xe,Math.max(Xe.overscaledZ-ya.maxOverzooming,this._source.minzoom));at&&(this._addTile(at.tileID),he[at.tileID.key]=at.tileID),fe[je]=Xe}const Ve=L[L.length-1].overscaledZ;for(const je in this._tiles){const Xe=this._tiles[je];if(ne[je]||!Xe.hasData())continue;let Ye=Xe.tileID;for(;Ye.overscaledZ>Ve;){Ye=Ye.scaledTo(Ye.overscaledZ-1);const at=this._tiles[Ye.key];if(at&&at.hasData()&&fe[Ye.key]){ne[je]=Xe.tileID;break}}}for(const je in he)ne[je]||(this._coveredTiles[je]=!0,ne[je]=he[je])}for(const he in ne)this._tiles[he].clearFadeHold();const ae=t.bk(this._tiles,ne);for(const he of ae){const fe=this._tiles[he];fe.hasSymbolBuckets&&!fe.holdingForFade()?fe.setHoldDuration(this.map._fadeDuration):fe.hasSymbolBuckets&&!fe.symbolFadeFinished()||this._removeTile(+he)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const n={};if(r.length===0)return n;const c={},g=r.reduce((ne,ae)=>Math.min(ne,ae.overscaledZ),1/0),M=r[0].overscaledZ,L=Math.max(M-ya.maxOverzooming,this._source.minzoom),q=Math.max(M+ya.maxUnderzooming,this._source.minzoom),K={};for(const ne of r){const ae=this._addTile(ne);n[ne.key]=ne,ae.hasData()||g<this._source.maxzoom&&(K[ne.key]=ne)}this._retainLoadedChildren(K,g,q,n);for(const ne of r){let ae=this._tiles[ne.key];if(ae.hasData())continue;if(ne.canonical.z>=this._source.maxzoom){const fe=ne.children(this._source.maxzoom)[0],Te=this.getTile(fe);if(Te&&Te.hasData()){n[fe.key]=fe;continue}}else{const fe=ne.children(this._source.maxzoom);if(n[fe[0].key]&&n[fe[1].key]&&n[fe[2].key]&&n[fe[3].key])continue}let he=ae.wasRequested();for(let fe=ne.overscaledZ-1;fe>=L;--fe){const Te=ne.scaledTo(fe);if(c[Te.key]||(c[Te.key]=!0,ae=this.getTile(Te),!ae&&he&&(ae=this._addTile(Te)),ae&&(n[Te.key]=Te,he=ae.wasRequested(),ae.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const n=[];let c,g=this._tiles[r].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){c=this._loadedParentTiles[g.key];break}n.push(g.key);const M=g.scaledTo(g.overscaledZ-1);if(c=this._getLoadedTile(M),c)break;g=M}for(const M of n)this._loadedParentTiles[M]=c}}_addTile(r){let n=this._tiles[r.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[r.key]||this._reloadTile(r.key,"reloading"),n;n=this._cache.getAndRemove(r),n&&(this._setTileReloadTimer(r.key,n),n.tileID=r,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,n)));const c=!!n;if(!c){const g=this.map?this.map.painter:null,M=this._source.tileSize*r.overscaleFactor();n=this._source.type==="raster-array"?new du(r,M,this.transform.tileZoom,g,this._isRaster):new Mo(r,M,this.transform.tileZoom,g,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,r.key,n.state))}return n?(n.uses++,this._tiles[r.key]=n,c||this._source.fire(new t.z("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(r,n){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const c=n.getExpiryTimeout();c&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},c))}_removeTile(r){const n=this._tiles[r];n&&(n.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,n,c){const g=[],M=this.transform;if(!M)return g;const L=M.projection.name==="globe",q=t.at(M.center.lng);for(const K in this._tiles){const ne=this._tiles[K];if(c&&ne.clearQueryDebugViz(),ne.holdingForFade())continue;let ae;if(L){const he=ne.tileID.canonical;if(he.z===0){const fe=[Math.abs(t.aw(q,...Mi(he,-1))-q),Math.abs(t.aw(q,...Mi(he,1))-q)];ae=[0,2*fe.indexOf(Math.min(...fe))-1]}else{const fe=[Math.abs(t.aw(q,...Mi(he,-1))-q),Math.abs(t.aw(q,...Mi(he,0))-q),Math.abs(t.aw(q,...Mi(he,1))-q)];ae=[fe.indexOf(Math.min(...fe))-1]}}else ae=[0];for(const he of ae){const fe=r.containsTile(ne,M,n,he);fe&&g.push(fe)}}return g}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(r){return this._getRenderableCoordinates(r)}_getRenderableCoordinates(r,n){const c=this.getRenderableIds(r,n).map(M=>this._tiles[M].tileID),g=this.transform.projection.name==="globe";for(const M of c)M.projMatrix=this.transform.calculateProjMatrix(M.toUnwrapped()),M.expandedProjMatrix=g?this.transform.calculateProjMatrix(M.toUnwrapped(),!1,!0):M.projMatrix;return c}sortCoordinatesByDistance(r){const n=r.slice(),c=this.transform._camera.position,g=this.transform._camera.forward(),M={};for(const L of n){const q=1/(1<<L.canonical.z);M[L.key]=((L.canonical.x+.5)*q+L.wrap-c[0])*g[0]+((L.canonical.y+.5)*q-c[1])*g[1]-c[2]*g[2]}return n.sort((L,q)=>M[L.key]-M[q.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(mu(this._source.type))for(const r in this._tiles){const n=this._tiles[r];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=t.q.now())return!0}return!1}setFeatureState(r,n,c){this._state.updateState(r=r||"_geojsonTileLayer",n,c)}removeFeatureState(r,n,c){this._state.removeFeatureState(r=r||"_geojsonTileLayer",n,c)}getFeatureState(r,n){return this._state.getState(r=r||"_geojsonTileLayer",n)}setDependencies(r,n,c){const g=this._tiles[r];g&&g.setDependencies(n,c)}reloadTilesForDependencies(r,n){for(const c in this._tiles)this._tiles[c].hasDependency(r,n)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(r,n))}_preloadTiles(r,n){if(!this._sourceLoaded){const K=()=>{this._sourceLoaded&&(this._source.off("data",K),this._preloadTiles(r,n))};return void this._source.on("data",K)}const c=new Map,g=Array.isArray(r)?r:[r],M=this.map.painter.terrain,L=this.usedForTerrain&&M?M.getScaledDemTileSize():this._source.tileSize;for(const K of g){const ne=K.coveringTiles({tileSize:L,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const ae of ne)c.set(ae.key,ae);this.usedForTerrain&&K.updateElevation(!1)}const q=Array.from(c.values());t.bl(q,(K,ne)=>{const ae=new Mo(K,this._source.tileSize*K.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(ae,he=>{this._source.type==="raster-dem"&&ae.dem&&this._backfillDEM(ae),ne(he,ae)})},n)}}function pu(u,r){const n=Math.abs(2*u.wrap)-+(u.wrap<0),c=Math.abs(2*r.wrap)-+(r.wrap<0);return u.overscaledZ-r.overscaledZ||c-n||r.canonical.y-u.canonical.y||r.canonical.x-u.canonical.x}function mu(u){return u==="raster"||u==="image"||u==="video"||u==="custom"}function Mi(u,r){const n=1<<u.z;return[u.x/n+r,(u.x+1)/n+r]}ya.maxOverzooming=10,ya.maxUnderzooming=3;class am{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const r=!1,n=!1;for(const c in this.style._mergedLayers){const g=this.style._mergedLayers[c];if(g.type==="fill-extrusion")this.layers.push({layer:g,visible:r,visibilityChanged:n});else if(g.type==="model"){const M=this.style.getLayerSource(g);M&&M.type==="batched-model"&&this.layers.push({layer:g,visible:r,visibilityChanged:n})}}}onNewFrame(r){this.layersGotHidden=!1;for(const n of this.layers){const c=n.layer;let g=!1;c.type==="fill-extrusion"?g=!c.isHidden(r)&&c.paint.get("fill-extrusion-opacity")>0:c.type==="model"&&(g=!c.isHidden(r)&&c.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!g&&n.visible,n.visible=g}}updateZOffset(r,n){this.currentBuildingBuckets=[];for(const g of this.layers){const M=g.layer,L=this.style.getLayerSourceCache(M);let q=1;M.type==="fill-extrusion"&&(q=g.visible?M.paint.get("fill-extrusion-vertical-scale"):0);let K=L?L.getTile(n):null;if(!K&&L&&n.canonical.z>L.getSource().minzoom){let ne=n.scaledTo(Math.min(L.getSource().maxzoom,n.overscaledZ-1));for(;ne.overscaledZ>=L.getSource().minzoom&&(K=L.getTile(ne),!K&&ne.overscaledZ!==0);)ne=ne.scaledTo(ne.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:K?K.getBucket(M):null,tileID:K?K.tileID:n,verticalScale:q})}r.hasAnyZOffset=!1;let c=!1;for(let g=0;g<r.symbolInstances.length;g++){const M=r.symbolInstances.get(g),L=M.zOffset,q=this._getHeightAtTileOffset(n,M.tileAnchorX,M.tileAnchorY);M.zOffset=q!==Number.NEGATIVE_INFINITY?q:L,c||L===M.zOffset||(c=!0),r.hasAnyZOffset||M.zOffset===0||(r.hasAnyZOffset=!0)}c&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,n,c,g){let M=n,L=c;if(r.canonical.z!==g.canonical.z){const q=g.canonical,K=1/(1<<r.canonical.z-q.z);M=(n+r.canonical.x*t.ag)*K-q.x*t.ag|0,L=(c+r.canonical.y*t.ag)*K-q.y*t.ag|0}return{tileX:M,tileY:L}}_getHeightAtTileOffset(r,n,c){let g,M;for(let L=0;L<this.layers.length;++L){if(this.layers[L].layer.type!=="fill-extrusion")continue;const{bucket:q,tileID:K,verticalScale:ne}=this.currentBuildingBuckets[L];if(!q)continue;const{tileX:ae,tileY:he}=this._mapCoordToOverlappingTile(r,n,c,K),fe=q.getHeightAtTileCoord(ae,he);fe&&fe.height!==void 0&&(fe.hidden?g=fe.height:M=Math.max(fe.height*ne,M||0))}if(M!==void 0)return M;for(let L=0;L<this.layers.length;++L){const q=this.layers[L];if(q.layer.type!=="model"||!q.visible)continue;const{bucket:K,tileID:ne}=this.currentBuildingBuckets[L];if(!K)continue;const{tileX:ae,tileY:he}=this._mapCoordToOverlappingTile(r,n,c,ne),fe=K.getHeightAtTileCoord(ae,he);if(fe&&!fe.hidden)return fe.height===void 0&&g!==void 0?Math.min(fe.maxHeight,g)*fe.verticalScale:fe.height?fe.height*fe.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Qr(u,r){const n={};for(const c in u)c!=="ref"&&(n[c]=u[c]);return t.bm.forEach(c=>{c in r&&(n[c]=r[c])}),n}function Hc(u){u=u.slice();const r=Object.create(null);for(let n=0;n<u.length;n++)r[u[n].id]=u[n];for(let n=0;n<u.length;n++)"ref"in u[n]&&(u[n]=Qr(u[n],r[u[n].ref]));return u}const Ti={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function _u(u,r,n){n.push({command:Ti.addSource,args:[u,r[u]]})}function va(u,r,n){r.push({command:Ti.removeSource,args:[u]}),n[u]=!0}function qc(u,r,n,c){va(u,n,c),_u(u,r,n)}function Ss(u,r,n){let c;for(c in u[n])if(u[n].hasOwnProperty(c)&&c!=="data"&&!t.bn(u[n][c],r[n][c]))return!1;for(c in r[n])if(r[n].hasOwnProperty(c)&&c!=="data"&&!t.bn(u[n][c],r[n][c]))return!1;return!0}function Rr(u,r,n,c,g,M){let L;for(L in r=r||{},u=u||{})u.hasOwnProperty(L)&&(t.bn(u[L],r[L])||n.push({command:M,args:[c,L,r[L],g]}));for(L in r)r.hasOwnProperty(L)&&!u.hasOwnProperty(L)&&(t.bn(u[L],r[L])||n.push({command:M,args:[c,L,r[L],g]}))}function Ci(u){return u.id}function Si(u,r){return u[r.id]=r,u}class ta{constructor(r,n){this.reset(r,n)}reset(r,n){this.points=r||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=t.aw(r,0,1);let n=1,c=this._distances[n];const g=r*this.paddedLength+this.padding;for(;c<g&&n<this._distances.length;)c=this._distances[++n];const M=n-1,L=this._distances[M],q=c-L,K=q>0?(g-L)/q:0;return this.points[M].mult(1-K).add(this.points[n].mult(K))}}class $o{constructor(r,n,c){const g=this.boxCells=[],M=this.circleCells=[];this.xCellCount=Math.ceil(r/c),this.yCellCount=Math.ceil(n/c);for(let L=0;L<this.xCellCount*this.yCellCount;L++)g.push([]),M.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=n,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,n,c,g,M){this._forEachCell(n,c,g,M,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(c),this.bboxes.push(g),this.bboxes.push(M)}insertCircle(r,n,c,g){this._forEachCell(n-g,c-g,n+g,c+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(n),this.circles.push(c),this.circles.push(g)}_insertBoxCell(r,n,c,g,M,L){this.boxCells[M].push(L)}_insertCircleCell(r,n,c,g,M,L){this.circleCells[M].push(L)}_query(r,n,c,g,M,L){if(c<0||r>this.width||g<0||n>this.height)return!M&&[];const q=[];if(r<=0&&n<=0&&this.width<=c&&this.height<=g){if(M)return!0;for(let K=0;K<this.boxKeys.length;K++)q.push({key:this.boxKeys[K],x1:this.bboxes[4*K],y1:this.bboxes[4*K+1],x2:this.bboxes[4*K+2],y2:this.bboxes[4*K+3]});for(let K=0;K<this.circleKeys.length;K++){const ne=this.circles[3*K],ae=this.circles[3*K+1],he=this.circles[3*K+2];q.push({key:this.circleKeys[K],x1:ne-he,y1:ae-he,x2:ne+he,y2:ae+he})}return L?q.filter(L):q}return this._forEachCell(r,n,c,g,this._queryCell,q,{hitTest:M,seenUids:{box:{},circle:{}}},L),M?q.length>0:q}_queryCircle(r,n,c,g,M){const L=r-c,q=r+c,K=n-c,ne=n+c;if(q<0||L>this.width||ne<0||K>this.height)return!g&&[];const ae=[];return this._forEachCell(L,K,q,ne,this._queryCellCircle,ae,{hitTest:g,circle:{x:r,y:n,radius:c},seenUids:{box:{},circle:{}}},M),g?ae.length>0:ae}query(r,n,c,g,M){return this._query(r,n,c,g,!1,M)}hitTest(r,n,c,g,M){return this._query(r,n,c,g,!0,M)}hitTestCircle(r,n,c,g){return this._queryCircle(r,n,c,!0,g)}_queryCell(r,n,c,g,M,L,q,K){const ne=q.seenUids,ae=this.boxCells[M];if(ae!==null){const fe=this.bboxes;for(const Te of ae)if(!ne.box[Te]){ne.box[Te]=!0;const Ve=4*Te;if(r<=fe[Ve+2]&&n<=fe[Ve+3]&&c>=fe[Ve+0]&&g>=fe[Ve+1]&&(!K||K(this.boxKeys[Te]))){if(q.hitTest)return L.push(!0),!0;L.push({key:this.boxKeys[Te],x1:fe[Ve],y1:fe[Ve+1],x2:fe[Ve+2],y2:fe[Ve+3]})}}}const he=this.circleCells[M];if(he!==null){const fe=this.circles;for(const Te of he)if(!ne.circle[Te]){ne.circle[Te]=!0;const Ve=3*Te;if(this._circleAndRectCollide(fe[Ve],fe[Ve+1],fe[Ve+2],r,n,c,g)&&(!K||K(this.circleKeys[Te]))){if(q.hitTest)return L.push(!0),!0;{const je=fe[Ve],Xe=fe[Ve+1],Ye=fe[Ve+2];L.push({key:this.circleKeys[Te],x1:je-Ye,y1:Xe-Ye,x2:je+Ye,y2:Xe+Ye})}}}}}_queryCellCircle(r,n,c,g,M,L,q,K){const ne=q.circle,ae=q.seenUids,he=this.boxCells[M];if(he!==null){const Te=this.bboxes;for(const Ve of he)if(!ae.box[Ve]){ae.box[Ve]=!0;const je=4*Ve;if(this._circleAndRectCollide(ne.x,ne.y,ne.radius,Te[je+0],Te[je+1],Te[je+2],Te[je+3])&&(!K||K(this.boxKeys[Ve])))return L.push(!0),!0}}const fe=this.circleCells[M];if(fe!==null){const Te=this.circles;for(const Ve of fe)if(!ae.circle[Ve]){ae.circle[Ve]=!0;const je=3*Ve;if(this._circlesCollide(Te[je],Te[je+1],Te[je+2],ne.x,ne.y,ne.radius)&&(!K||K(this.circleKeys[Ve])))return L.push(!0),!0}}}_forEachCell(r,n,c,g,M,L,q,K){const ne=this._convertToXCellCoord(r),ae=this._convertToYCellCoord(n),he=this._convertToXCellCoord(c),fe=this._convertToYCellCoord(g);for(let Te=ne;Te<=he;Te++)for(let Ve=ae;Ve<=fe;Ve++)if(M.call(this,r,n,c,g,this.xCellCount*Ve+Te,L,q,K))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,n,c,g,M,L){const q=g-r,K=M-n,ne=c+L;return ne*ne>q*q+K*K}_circleAndRectCollide(r,n,c,g,M,L,q){const K=(L-g)/2,ne=Math.abs(r-(g+K));if(ne>K+c)return!1;const ae=(q-M)/2,he=Math.abs(n-(M+ae));if(he>ae+c)return!1;if(ne<=K||he<=ae)return!0;const fe=ne-K,Te=he-ae;return fe*fe+Te*Te<=c*c}}const xi={unknown:0,flipRequired:1,flipNotRequired:2},gu=Math.tan(85*Math.PI/180);function io(u,r,n,c,g,M,L){const q=t.ab.mat4.create();if(n)if(M.name==="globe"){const K=t.bo(g,r);t.ab.mat4.multiply(q,q,K)}else{const K=t.ab.mat2.invert([],L);q[0]=K[0],q[1]=K[1],q[4]=K[2],q[5]=K[3],c||t.ab.mat4.rotateZ(q,q,g.angle)}else t.ab.mat4.multiply(q,g.labelPlaneMatrix,u);return q}function Zo(u,r,n,c,g,M,L){const q=io(u,r,n,c,g,M,L);return M.name==="globe"&&n||(q[2]=q[6]=q[10]=q[14]=0),q}function Fn(u,r,n,c,g,M,L){if(n){if(M.name==="globe"){const q=io(u,r,n,c,g,M,L);return t.ab.mat4.invert(q,q),t.ab.mat4.multiply(q,u,q),q}{const q=t.ab.mat4.clone(u),K=t.ab.mat4.identity([]);return K[0]=L[0],K[1]=L[1],K[4]=L[2],K[5]=L[3],t.ab.mat4.multiply(q,q,K),c||t.ab.mat4.rotateZ(q,q,-g.angle),q}}return g.glCoordMatrix}function Wi(u,r,n,c){const g=[u,r,n,1];n?t.ab.vec4.transformMat4(g,g,c):Yo(g,g,c);const M=g[3];return g[0]/=M,g[1]/=M,g[2]/=M,g}function Vf(u,r){return Math.min(.5+u/r*.5,1.5)}function ml(u,r){const n=u[0]/u[3],c=u[1]/u[3];return n>=-r[0]&&n<=r[0]&&c>=-r[1]&&c<=r[1]}function yu(u,r,n,c,g,M,L,q,K,ne){const ae=n.transform,he=c?u.textSizeData:u.iconSizeData,fe=t.bp(he,n.transform.zoom),Te=ae.projection.name==="globe",Ve=[256/n.width*2+1,256/n.height*2+1],je=c?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;je.clear();let Xe=null;Te&&(Xe=c?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);const Ye=u.lineVertexArray,at=c?u.text.placedSymbolArray:u.icon.placedSymbolArray,pt=n.transform.width/n.transform.height;let ft,bt=!1;for(let gt=0;gt<at.length;gt++){const vt=at.get(gt),{numGlyphs:yt,writingMode:Tt}=vt;if(Tt!==t.bq.vertical||bt||ft===t.bq.horizontal||(bt=!0),ft=Tt,(vt.hidden||Tt===t.bq.vertical)&&!bt){Xo(yt,je);continue}bt=!1;const Dt=new t.P(vt.tileAnchorX,vt.tileAnchorY);let{x:Zt,y:Ht,z:Pt}=ae.projection.projectTilePoint(Dt.x,Dt.y,ne.canonical);if(K){const[er,Sr,mr]=K(Dt);Zt+=er,Ht+=Sr,Pt+=mr}const zt=[Zt,Ht,Pt,1];if(t.ab.vec4.transformMat4(zt,zt,r),!ml(zt,Ve)){Xo(yt,je);continue}const tr=zt[3],lr=Vf(n.transform.getCameraToCenterDistance(ae.projection),tr),pr=t.br(he,fe,vt),Gt=L?pr/lr:pr*lr,nr=Wi(Zt,Ht,Pt,g);if(nr[3]<=0){Xo(yt,je);continue}let Xt={};const hr=L?null:K,ar=_l(vt,Gt,!1,q,r,g,M,u.glyphOffsetArray,Ye,je,Xe,nr,Dt,Xt,pt,hr,ae.projection,ne,L);bt=ar.useVertical,hr&&ar.needsFlipping&&(Xt={}),(ar.notEnoughRoom||bt||ar.needsFlipping&&_l(vt,Gt,!0,q,r,g,M,u.glyphOffsetArray,Ye,je,Xe,nr,Dt,Xt,pt,hr,ae.projection,ne,L).notEnoughRoom)&&Xo(yt,je)}c?(u.text.dynamicLayoutVertexBuffer.updateData(je),Xe&&u.text.globeExtVertexBuffer&&u.text.globeExtVertexBuffer.updateData(Xe)):(u.icon.dynamicLayoutVertexBuffer.updateData(je),Xe&&u.icon.globeExtVertexBuffer&&u.icon.globeExtVertexBuffer.updateData(Xe))}function Ms(u,r,n,c,g,M,L,q,K,ne,ae,he,fe,Te,Ve,je){const{lineStartIndex:Xe,glyphStartIndex:Ye,segment:at}=q,pt=Ye+q.numGlyphs,ft=Xe+q.lineLength,bt=r.getoffsetX(Ye),gt=r.getoffsetX(pt-1),vt=Mn(u*bt,n,c,g,M,L,at,Xe,ft,K,ne,ae,he,fe,!0,Te,Ve,je);if(!vt)return null;const yt=Mn(u*gt,n,c,g,M,L,at,Xe,ft,K,ne,ae,he,fe,!0,Te,Ve,je);return yt?{first:vt,last:yt}:null}function vu(u,r,n,c){return u===t.bq.horizontal&&Math.abs(c)>Math.abs(n)?{useVertical:!0}:u===t.bq.vertical?c>0?{needsFlipping:!0}:null:r!==xi.unknown&&function(g,M){return g===0||Math.abs(M/g)>gu}(n,c)?r===xi.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function _l(u,r,n,c,g,M,L,q,K,ne,ae,he,fe,Te,Ve,je,Xe,Ye,at){const pt=r/24,ft=u.lineOffsetX*pt,bt=u.lineOffsetY*pt,{lineStartIndex:gt,glyphStartIndex:vt,numGlyphs:yt,segment:Tt,writingMode:Dt,flipState:Zt}=u,Ht=gt+u.lineLength,Pt=zt=>{if(ae){const[Gt,nr,Xt]=zt.up,hr=ne.length;t.bs(ae,hr+0,Gt,nr,Xt),t.bs(ae,hr+1,Gt,nr,Xt),t.bs(ae,hr+2,Gt,nr,Xt),t.bs(ae,hr+3,Gt,nr,Xt)}const[tr,lr,pr]=zt.point;t.bt(ne,tr,lr,pr,zt.angle)};if(yt>1){const zt=Ms(pt,q,ft,bt,n,he,fe,u,K,M,Te,je,!1,Xe,Ye,at);if(!zt)return{notEnoughRoom:!0};if(c&&!n){let[tr,lr,pr]=zt.first.point,[Gt,nr,Xt]=zt.last.point;[tr,lr]=Wi(tr,lr,pr,L),[Gt,nr]=Wi(Gt,nr,Xt,L);const hr=vu(Dt,Zt,(Gt-tr)*Ve,nr-lr);if(u.flipState=hr&&hr.needsFlipping?xi.flipRequired:xi.flipNotRequired,hr)return hr}Pt(zt.first);for(let tr=vt+1;tr<vt+yt-1;tr++){const lr=Mn(pt*q.getoffsetX(tr),ft,bt,n,he,fe,Tt,gt,Ht,K,M,Te,je,!1,!1,Xe,Ye,at);if(!lr)return ne.length-=4*(tr-vt),{notEnoughRoom:!0};Pt(lr)}Pt(zt.last)}else{if(c&&!n){const tr=Wi(fe.x,fe.y,0,g),lr=gt+Tt+1,pr=new t.P(K.getx(lr),K.gety(lr)),Gt=Wi(pr.x,pr.y,0,g),nr=Gt[3]>0?Gt:$a(fe,pr,tr,1,g,void 0,Xe,Ye.canonical),Xt=vu(Dt,Zt,(nr[0]-tr[0])*Ve,nr[1]-tr[1]);if(u.flipState=Xt&&Xt.needsFlipping?xi.flipRequired:xi.flipNotRequired,Xt)return Xt}const zt=Mn(pt*q.getoffsetX(vt),ft,bt,n,he,fe,Tt,gt,Ht,K,M,Te,je,!1,!1,Xe,Ye,at);if(!zt)return{notEnoughRoom:!0};Pt(zt)}return{}}function Nn(u,r,n,c,g){const{x:M,y:L,z:q}=c.projectTilePoint(u.x,u.y,r);if(!g)return Wi(M,L,q,n);const[K,ne,ae]=g(u);return Wi(M+K,L+ne,q+ae,n)}function $a(u,r,n,c,g,M,L,q){const K=Nn(u.sub(r)._unit()._add(u),q,g,L,M);return t.ab.vec3.sub(K,n,K),t.ab.vec3.normalize(K,K),t.ab.vec3.scaleAndAdd(K,n,K,c)}function Mn(u,r,n,c,g,M,L,q,K,ne,ae,he,fe,Te,Ve,je,Xe,Ye){const at=c?u-r:u+r;let pt=at>0?1:-1,ft=0;c&&(pt*=-1,ft=Math.PI),pt<0&&(ft+=Math.PI);let bt=q+L+(pt>0?0:1)|0,gt=g,vt=g,yt=0,Tt=0;const Dt=Math.abs(at),Zt=[],Ht=[];let Pt=M,zt=Pt;const tr=()=>$a(zt,Pt,vt,Dt-yt+1,ae,fe,je,Xe.canonical);for(;yt+Tt<=Dt;){if(bt+=pt,bt<q||bt>=K)return null;if(vt=gt,zt=Pt,Zt.push(vt),Te&&Ht.push(zt),Pt=new t.P(ne.getx(bt),ne.gety(bt)),gt=he[bt],!gt){const Sr=Nn(Pt,Xe.canonical,ae,je,fe);gt=Sr[3]>0?he[bt]=Sr:tr()}yt+=Tt,Tt=t.ab.vec3.distance(vt,gt)}Ve&&fe&&(he[bt]&&(gt=tr(),Tt=t.ab.vec3.distance(vt,gt)),he[bt]=gt);const lr=(Dt-yt)/Tt,pr=Pt.sub(zt)._mult(lr)._add(zt),Gt=t.ab.vec3.sub([],gt,vt),nr=t.ab.vec3.scaleAndAdd([],vt,Gt,lr);let Xt=[0,0,1],hr=Gt[0],ar=Gt[1];if(Ye&&(Xt=je.upVector(Xe.canonical,pr.x,pr.y),Xt[0]!==0||Xt[1]!==0||Xt[2]!==1)){const Sr=[Xt[2],0,-Xt[0]],mr=t.ab.vec3.cross([],Xt,Sr);t.ab.vec3.normalize(Sr,Sr),t.ab.vec3.normalize(mr,mr),hr=t.ab.vec3.dot(Gt,Sr),ar=t.ab.vec3.dot(Gt,mr)}if(n){const Sr=t.ab.vec3.cross([],Xt,Gt);t.ab.vec3.normalize(Sr,Sr),t.ab.vec3.scaleAndAdd(nr,nr,Sr,n*pt)}const er=ft+Math.atan2(ar,hr);return Zt.push(nr),Te&&Ht.push(pr),{point:nr,angle:er,path:Zt,tilePath:Ht,up:Xt}}function Xo(u,r){const n=r.length,c=n+4*u;r.resize(c),r.float32.fill(-1/0,4*n,4*c)}function Yo(u,r,n){const c=r[0],g=r[1];return u[0]=n[0]*c+n[4]*g+n[12],u[1]=n[1]*c+n[5]*g+n[13],u[3]=n[3]*c+n[7]*g+n[15],u}const Ji=100;class Oa{constructor(r,n,c=new $o(r.width+200,r.height+200,25),g=new $o(r.width+200,r.height+200,25)){this.transform=r,this.grid=c,this.ignoredGrid=g,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Ji,this.screenBottomBoundary=r.height+Ji,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=n}placeCollisionBox(r,n,c,g,M,L,q,K){let ne=c.projectedAnchorX,ae=c.projectedAnchorY,he=c.projectedAnchorZ;const fe=c.elevation,Te=c.tileID,Ve=r.getProjection();if(fe&&Te){const[gt,vt,yt]=Ve.upVector(Te.canonical,c.tileAnchorX,c.tileAnchorY),Tt=Ve.upVectorScale(Te.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;ne+=gt*fe*Tt,ae+=vt*fe*Tt,he+=yt*fe*Tt}const je=this.projectAndGetPerspectiveRatio(q,ne,ae,he,c.tileID,Ve.name==="globe"||!!fe||this.transform.pitch>0,Ve),Xe=L*je.perspectiveRatio,Ye=(c.x1*n+g.x-c.padding)*Xe+je.point.x,at=(c.y1*n+g.y-c.padding)*Xe+je.point.y,pt=(c.x2*n+g.x+c.padding)*Xe+je.point.x,ft=(c.y2*n+g.y+c.padding)*Xe+je.point.y,bt=je.perspectiveRatio<=.55||je.occluded;return!this.isInsideGrid(Ye,at,pt,ft)||!M&&this.grid.hitTest(Ye,at,pt,ft,K)||bt?{box:[],offscreen:!1,occluded:je.occluded}:{box:[Ye,at,pt,ft],offscreen:this.isOffscreen(Ye,at,pt,ft),occluded:!1}}placeCollisionCircles(r,n,c,g,M,L,q,K,ne,ae,he,fe,Te,Ve,je){const Xe=[],Ye=this.transform.elevation,at=r.getProjection(),pt=Ye?Ye.getAtTileOffsetFunc(je,this.transform.center.lat,this.transform.worldSize,at):null,ft=new t.P(c.tileAnchorX,c.tileAnchorY);let{x:bt,y:gt,z:vt}=at.projectTilePoint(ft.x,ft.y,je.canonical);if(pt){const[pr,Gt,nr]=pt(ft);bt+=pr,gt+=Gt,vt+=nr}const yt=at.name==="globe",Tt=this.projectAndGetPerspectiveRatio(q,bt,gt,vt,je,yt||!!Ye||this.transform.pitch>0,at),{perspectiveRatio:Dt}=Tt,Zt=(he?L/Dt:L*Dt)/t.bw,Ht=Wi(bt,gt,vt,K),Pt=Tt.signedDistanceFromCamera>0?Ms(Zt,M,c.lineOffsetX*Zt,c.lineOffsetY*Zt,!1,Ht,ft,c,g,K,{},Ye&&!he?pt:null,he&&!!Ye,at,je,he):null;let zt=!1,tr=!1,lr=!0;if(Pt&&!Tt.occluded){const pr=.5*Te*Dt+Ve,Gt=new t.P(-100,-100),nr=new t.P(this.screenRightBoundary,this.screenBottomBoundary),Xt=new ta,{first:hr,last:ar}=Pt,er=hr.path.length;let Sr=[];for(let Lr=er-1;Lr>=1;Lr--)Sr.push(hr.path[Lr]);for(let Lr=1;Lr<ar.path.length;Lr++)Sr.push(ar.path[Lr]);const mr=2.5*pr;ne&&(Sr=Sr.map(([Lr,ri,Gr],Zr)=>(pt&&!yt&&(Gr=pt(Zr<er-1?hr.tilePath[er-1-Zr]:ar.tilePath[Zr-er+2])[2]),Wi(Lr,ri,Gr,ne))),Sr.some(Lr=>Lr[3]<=0)&&(Sr=[]));let Mr=[];if(Sr.length>0){let Lr=1/0,ri=-1/0,Gr=1/0,Zr=-1/0;for(const ii of Sr)Lr=Math.min(Lr,ii[0]),Gr=Math.min(Gr,ii[1]),ri=Math.max(ri,ii[0]),Zr=Math.max(Zr,ii[1]);ri>=Gt.x&&Lr<=nr.x&&Zr>=Gt.y&&Gr<=nr.y&&(Mr=[Sr.map(ii=>new t.P(ii[0],ii[1]))],(Lr<Gt.x||ri>nr.x||Gr<Gt.y||Zr>nr.y)&&(Mr=t.bu(Mr,Gt.x,Gt.y,nr.x,nr.y)))}for(const Lr of Mr){Xt.reset(Lr,.25*pr);let ri=0;ri=Xt.length<=.5*pr?1:Math.ceil(Xt.paddedLength/mr)+1;for(let Gr=0;Gr<ri;Gr++){const Zr=Gr/Math.max(ri-1,1),ii=Xt.lerp(Zr),vi=ii.x+Ji,di=ii.y+Ji;Xe.push(vi,di,pr,0);const Hi=vi-pr,Yi=di-pr,Di=vi+pr,ki=di+pr;if(lr=lr&&this.isOffscreen(Hi,Yi,Di,ki),tr=tr||this.isInsideGrid(Hi,Yi,Di,ki),!n&&this.grid.hitTestCircle(vi,di,pr,fe)&&(zt=!0,!ae))return{circles:[],offscreen:!1,collisionDetected:zt,occluded:!1}}}}return{circles:!ae&&zt||!tr?[]:Xe,offscreen:lr,collisionDetected:zt,occluded:Tt.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let c=1/0,g=1/0,M=-1/0,L=-1/0;for(const ae of r){const he=new t.P(ae.x+Ji,ae.y+Ji);c=Math.min(c,he.x),g=Math.min(g,he.y),M=Math.max(M,he.x),L=Math.max(L,he.y),n.push(he)}const q=this.grid.query(c,g,M,L).concat(this.ignoredGrid.query(c,g,M,L)),K={},ne={};for(const ae of q){const he=ae.key;if(K[he.bucketInstanceId]===void 0&&(K[he.bucketInstanceId]={}),K[he.bucketInstanceId][he.featureIndex])continue;const fe=[new t.P(ae.x1,ae.y1),new t.P(ae.x2,ae.y1),new t.P(ae.x2,ae.y2),new t.P(ae.x1,ae.y2)];t.bv(n,fe)&&(K[he.bucketInstanceId][he.featureIndex]=!0,ne[he.bucketInstanceId]===void 0&&(ne[he.bucketInstanceId]=[]),ne[he.bucketInstanceId].push(he.featureIndex))}return ne}insertCollisionBox(r,n,c,g,M){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:g,collisionGroupID:M},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,n,c,g,M){const L=n?this.ignoredGrid:this.grid,q={bucketInstanceId:c,featureIndex:g,collisionGroupID:M};for(let K=0;K<r.length;K+=4)L.insertCircle(q,r[K],r[K+1],r[K+2])}projectAndGetPerspectiveRatio(r,n,c,g,M,L,q){const K=[n,c,g,1];let ne=!1;g||this.transform.pitch>0?(t.ab.vec4.transformMat4(K,K,r),this.fogState&&M&&q.name!=="globe"&&(ne=function(fe,Te,Ve,je,Xe,Ye){const at=Ye.calculateFogTileMatrix(Xe),pt=[Te,Ve,je];return t.ab.vec3.transformMat4(pt,pt,at),Pr(fe,t.ab.vec3.length(pt),Ye.pitch,Ye._fov)}(this.fogState,n,c,g,M.toUnwrapped(),this.transform)>.9)):Yo(K,K,r);const ae=K[3];return{point:new t.P((K[0]/ae+1)/2*this.transform.width+Ji,(-K[1]/ae+1)/2*this.transform.height+Ji),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(q)/ae*.5,1.5),signedDistanceFromCamera:ae,occluded:L&&K[2]>ae||ne}}isOffscreen(r,n,c,g){return c<Ji||r>=this.screenRightBoundary||g<Ji||n>this.screenBottomBoundary}isInsideGrid(r,n,c,g){return c>=0&&r<this.gridRightBoundary&&g>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const r=t.ab.mat4.identity([]);return t.ab.mat4.translate(r,r,[-100,-100,0]),r}}function ba(u,r,n){const c=r.createTileMatrix(u,u.worldSize,n.toUnwrapped());return t.ab.mat4.multiply(new Float32Array(16),u.projMatrix,c)}function dn(u,r,n){if(r.projection.name===n.projection.name)return u.projMatrix;const c=n.clone();return c.setProjection(r.projection),ba(c,r.getProjection(),u)}function gl(u,r,n){return r.name===n.projection.name?u.projMatrix:ba(n,r,u)}class xa{constructor(r,n,c,g){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?n:-n))):g&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class no{constructor(r,n,c,g,M,L=!1){this.text=new xa(r?r.text:null,n,c,M),this.icon=new xa(r?r.icon:null,n,g,M),this.clipped=L}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class As{constructor(r,n,c,g=!1){this.text=r,this.icon=n,this.skipFade=c,this.clipped=g}}class Ko{constructor(){this.invProjMatrix=t.ab.mat4.create(),this.viewportMatrix=t.ab.mat4.create(),this.circles=[]}}class om{constructor(r,n,c,g,M){this.bucketInstanceId=r,this.featureIndex=n,this.sourceLayerIndex=c,this.bucketIndex=g,this.tileID=M}}class ao{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const n=++this.maxGroupID;this.collisionGroups[r]={ID:n,predicate:c=>c.collisionGroupID===n}}return this.collisionGroups[r]}}function Gf(u,r,n,c,g){const{horizontalAlign:M,verticalAlign:L}=t.bD(u),q=-(M-.5)*r,K=-(L-.5)*n,ne=t.bC(u,c);return new t.P(q+ne[0]*g,K+ne[1]*g)}function bu(u,r,n,c,g){const M=new t.P(u,r);return n&&M._rotate(c?g:-g),M}class ra{constructor(r,n,c,g,M,L){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new Oa(this.transform,M),this.buildingIndex=L,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new ao(c),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,n,c,g,M=1){const L=c.getBucket(n),q=c.latestFeatureIndex;if(!L||!q||n.fqid!==L.layerIds[0])return;const K=L.layers[0].layout,ne=L.layers[0].paint,ae=c.collisionBoxArray,he=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),fe=c.tileSize/t.ag,Te=c.tileID.toUnwrapped();this.transform.setProjection(L.projection);const Ve=(je=c.tileID,Xe=L.getProjection(),Ye=this.transform,Xe.name===this.projection?Ye.calculateProjMatrix(je.toUnwrapped()):ba(Ye,Xe,je));var je,Xe,Ye;const at=K.get("text-pitch-alignment")==="map",pt=K.get("text-rotation-alignment")==="map";n.compileFilter(n.options);const ft=n.dynamicFilter(),bt=n.dynamicFilterNeedsFeature(),gt=this.transform.calculatePixelsToTileUnitsMatrix(c),vt=Zo(Ve,c.tileID.canonical,at,pt,this.transform,L.getProjection(),gt);let yt=null;if(at){const pr=Fn(Ve,c.tileID.canonical,at,pt,this.transform,L.getProjection(),gt);yt=t.ab.mat4.multiply([],this.transform.labelPlaneMatrix,pr)}let Tt=null;ft&&c.latestFeatureIndex&&(Tt={unwrappedTileID:Te,dynamicFilter:ft,dynamicFilterNeedsFeature:bt}),this.retainedQueryData[L.bucketInstanceId]=new om(L.bucketInstanceId,q,L.sourceLayerIndex,L.index,c.tileID);const[Dt,Zt]=L.layers[0].layout.get("text-size-scale-range"),Ht=t.aw(M,Dt,Zt),[Pt,zt]=K.get("icon-size-scale-range"),tr=t.aw(M,Pt,zt),lr={bucket:L,layout:K,paint:ne,posMatrix:Ve,textLabelPlaneMatrix:vt,labelToScreenMatrix:yt,clippingData:Tt,scale:he,textPixelRatio:fe,holdingForFade:c.holdingForFade(),collisionBoxArray:ae,partiallyEvaluatedTextSize:t.bp(L.textSizeData,this.transform.zoom,Ht),partiallyEvaluatedIconSize:t.bp(L.iconSizeData,this.transform.zoom,tr),collisionGroup:this.collisionGroups.get(L.sourceID),latestFeatureIndex:c.latestFeatureIndex};if(g)for(const pr of L.sortKeyRanges){const{sortKey:Gt,symbolInstanceStart:nr,symbolInstanceEnd:Xt}=pr;r.push({sortKey:Gt,symbolInstanceStart:nr,symbolInstanceEnd:Xt,parameters:lr})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:L.symbolInstances.length,parameters:lr})}attemptAnchorPlacement(r,n,c,g,M,L,q,K,ne,ae,he,fe,Te,Ve,je,Xe,Ye,at){const{textOffset0:pt,textOffset1:ft,crossTileID:bt}=fe,gt=[pt,ft],vt=Gf(r,c,g,gt,M),yt=this.collisionIndex.placeCollisionBox(Ve,M,n,bu(vt.x,vt.y,L,q,this.transform.angle),he,K,ne,ae.predicate);if(Xe){const Tt=Ve.getSymbolInstanceIconSize(at,this.transform.zoom,fe.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Ve,Tt,Xe,bu(vt.x,vt.y,L,q,this.transform.angle),he,K,ne,ae.predicate).box.length===0)return}if(yt.box.length>0){let Tt;return this.prevPlacement&&this.prevPlacement.variableOffsets[bt]&&this.prevPlacement.placements[bt]&&this.prevPlacement.placements[bt].text&&(Tt=this.prevPlacement.variableOffsets[bt].anchor),this.variableOffsets[bt]={textOffset:gt,width:c,height:g,anchor:r,textScale:M,prevAnchor:Tt},this.markUsedJustification(Ve,r,fe,je),Ve.allowVerticalPlacement&&(this.markUsedOrientation(Ve,je,fe),this.placedOrientations[bt]=je),{shift:vt,placedGlyphBoxes:yt}}}placeLayerBucketPart(r,n,c,g,M=1){const{bucket:L,layout:q,paint:K,posMatrix:ne,textLabelPlaneMatrix:ae,labelToScreenMatrix:he,clippingData:fe,textPixelRatio:Te,holdingForFade:Ve,collisionBoxArray:je,partiallyEvaluatedTextSize:Xe,partiallyEvaluatedIconSize:Ye,collisionGroup:at,latestFeatureIndex:pt}=r.parameters,ft=q.get("text-optional"),bt=q.get("icon-optional"),gt=q.get("text-allow-overlap"),vt=q.get("icon-allow-overlap"),yt=q.get("text-rotation-alignment")==="map",Tt=q.get("text-pitch-alignment")==="map",Dt=q.get("symbol-z-elevate"),Zt=K.get("symbol-z-offset"),Ht=q.get("symbol-elevation-reference")==="sea",[Pt,zt]=q.get("text-size-scale-range"),[tr,lr]=q.get("icon-size-scale-range"),pr=t.aw(M,Pt,zt),Gt=t.aw(M,tr,lr);this.transform.setProjection(L.projection);let nr=gt&&(vt||!L.hasIconData()||bt),Xt=vt&&(gt||!L.hasTextData()||ft);const hr=!Zt.isConstant();!L.collisionArrays&&je&&L.deserializeCollisionBoxes(je),c&&g&&L.updateCollisionDebugBuffers(this.transform.zoom,je,pr,Gt);const ar=(er,Sr,mr)=>{const{crossTileID:Mr,numVerticalGlyphVertices:Lr}=er;let ri=null;if(fe&&fe.dynamicFilterNeedsFeature||hr){const ji=this.retainedQueryData[L.bucketInstanceId];ri=pt.loadFeature({featureIndex:er.featureIndex,bucketIndex:ji.bucketIndex,sourceLayerIndex:ji.sourceLayerIndex,layoutVertexArrayOffset:0})}if(fe&&!(0,fe.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},ri,this.retainedQueryData[L.bucketInstanceId].tileID.canonical,new t.P(er.tileAnchorX,er.tileAnchorY),this.transform.calculateDistanceTileData(fe.unwrappedTileID)))return this.placements[Mr]=new As(!1,!1,!1,!0),void n.add(Mr);const Gr=Zt.evaluate(ri,{});if(n.has(Mr))return;if(Ve)return void(this.placements[Mr]=new As(!1,!1,!1));let Zr=!1,ii=!1,vi=!0,di=!1,Hi=!1,Yi=null,Di={box:null,offscreen:null,occluded:null},ki={box:null},ui=null,Xr=null,Ii=null,Li=0,tn=0,Pn=0;mr.textFeatureIndex?Li=mr.textFeatureIndex:er.useRuntimeCollisionCircles&&(Li=er.featureIndex),mr.verticalTextFeatureIndex&&(tn=mr.verticalTextFeatureIndex);const $n=ji=>{ji.tileID=this.retainedQueryData[L.bucketInstanceId].tileID;const qi=this.transform.elevation;ji.elevation=Ht?Gr:Gr+(qi?qi.getAtTileOffset(ji.tileID,ji.tileAnchorX,ji.tileAnchorY):0),ji.elevation+=er.zOffset},pn=mr.textBox;if(pn){$n(pn);const ji=wi=>{let cn=t.bq.horizontal;if(L.allowVerticalPlacement&&!wi&&this.prevPlacement){const Cn=this.prevPlacement.placedOrientations[Mr];Cn&&(this.placedOrientations[Mr]=Cn,cn=Cn,this.markUsedOrientation(L,cn,er))}return cn},qi=(wi,cn)=>{if(L.allowVerticalPlacement&&Lr>0&&mr.verticalTextBox){for(const Cn of L.writingModes)if(Cn===t.bq.vertical?(Di=cn(),ki=Di):Di=wi(),Di&&Di.box&&Di.box.length)break}else Di=wi()};if(q.get("text-variable-anchor")){let wi=q.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Mr]){const Ni=this.prevPlacement.variableOffsets[Mr];wi.indexOf(Ni.anchor)>0&&(wi=wi.filter(jn=>jn!==Ni.anchor),wi.unshift(Ni.anchor))}const cn=(Ni,jn,ma)=>{const ua=L.getSymbolInstanceTextSize(Xe,er,this.transform.zoom,Sr),go=(Ni.x2-Ni.x1)*ua+2*Ni.padding,Zn=(Ni.y2-Ni.y1)*ua+2*Ni.padding,ja=er.hasIconTextFit&&!vt?jn:null;ja&&$n(ja);let ca={box:[],offscreen:!1,occluded:!1};const No=gt?2*wi.length:wi.length;for(let Ka=0;Ka<No;++Ka){const hs=this.attemptAnchorPlacement(wi[Ka%wi.length],Ni,go,Zn,ua,yt,Tt,Te,ne,at,Ka>=wi.length,er,Sr,L,ma,ja,Xe,Ye);if(hs&&(ca=hs.placedGlyphBoxes,ca&&ca.box&&ca.box.length)){Zr=!0,Yi=hs.shift;break}}return ca};qi(()=>cn(pn,mr.iconBox,t.bq.horizontal),()=>{const Ni=mr.verticalTextBox;return Ni&&$n(Ni),L.allowVerticalPlacement&&!(Di&&Di.box&&Di.box.length)&&Lr>0&&Ni?cn(Ni,mr.verticalIconBox,t.bq.vertical):{box:null,offscreen:null,occluded:null}}),Di&&(Zr=Di.box,vi=Di.offscreen,di=Di.occluded);const Cn=ji(!(!Di||!Di.box));if(!Zr&&this.prevPlacement){const Ni=this.prevPlacement.variableOffsets[Mr];Ni&&(this.variableOffsets[Mr]=Ni,this.markUsedJustification(L,Ni.anchor,er,Cn))}}else{const wi=(cn,Cn)=>{const Ni=L.getSymbolInstanceTextSize(Xe,er,this.transform.zoom,Sr,M),jn=this.collisionIndex.placeCollisionBox(L,Ni,cn,new t.P(0,0),gt,Te,ne,at.predicate);return jn&&jn.box&&jn.box.length&&(this.markUsedOrientation(L,Cn,er),this.placedOrientations[Mr]=Cn),jn};qi(()=>wi(pn,t.bq.horizontal),()=>{const cn=mr.verticalTextBox;return L.allowVerticalPlacement&&Lr>0&&cn?($n(cn),wi(cn,t.bq.vertical)):{box:null,offscreen:null,occluded:null}}),ji(!!(Di&&Di.box&&Di.box.length))}}if(ui=Di,Zr=ui&&ui.box&&ui.box.length>0,vi=ui&&ui.offscreen,di=ui&&ui.occluded,er.useRuntimeCollisionCircles){const ji=L.text.placedSymbolArray.get(er.centerJustifiedTextSymbolIndex>=0?er.centerJustifiedTextSymbolIndex:er.verticalPlacedTextSymbolIndex),qi=t.br(L.textSizeData,Xe,ji),wi=q.get("text-padding");Xr=this.collisionIndex.placeCollisionCircles(L,gt,ji,L.lineVertexArray,L.glyphOffsetArray,qi,ne,ae,he,c,Tt,at.predicate,er.collisionCircleDiameter*qi/t.bw,wi,this.retainedQueryData[L.bucketInstanceId].tileID),Zr=gt||Xr.circles.length>0&&!Xr.collisionDetected,vi=vi&&Xr.offscreen,di=Xr.occluded}if(mr.iconFeatureIndex&&(Pn=mr.iconFeatureIndex),mr.iconBox){const ji=qi=>{$n(qi);const wi=er.hasIconTextFit&&Yi?bu(Yi.x,Yi.y,yt,Tt,this.transform.angle):new t.P(0,0),cn=L.getSymbolInstanceIconSize(Ye,this.transform.zoom,er.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(L,cn,qi,wi,vt,Te,ne,at.predicate)};ki&&ki.box&&ki.box.length&&mr.verticalIconBox?(Ii=ji(mr.verticalIconBox),ii=Ii.box.length>0):(Ii=ji(mr.iconBox),ii=Ii.box.length>0),vi=vi&&Ii.offscreen,Hi=Ii.occluded}const An=ft||er.numHorizontalGlyphVertices===0&&Lr===0,Un=bt||er.numIconVertices===0;if(An||Un?Un?An||(ii=ii&&Zr):Zr=ii&&Zr:ii=Zr=ii&&Zr,Zr&&ui&&ui.box&&this.collisionIndex.insertCollisionBox(ui.box,q.get("text-ignore-placement"),L.bucketInstanceId,ki&&ki.box&&tn?tn:Li,at.ID),ii&&Ii&&this.collisionIndex.insertCollisionBox(Ii.box,q.get("icon-ignore-placement"),L.bucketInstanceId,Pn,at.ID),Xr&&(Zr&&this.collisionIndex.insertCollisionCircles(Xr.circles,q.get("text-ignore-placement"),L.bucketInstanceId,Li,at.ID),c)){const ji=L.bucketInstanceId;let qi=this.collisionCircleArrays[ji];qi===void 0&&(qi=this.collisionCircleArrays[ji]=new Ko);for(let wi=0;wi<Xr.circles.length;wi+=4)qi.circles.push(Xr.circles[wi+0]),qi.circles.push(Xr.circles[wi+1]),qi.circles.push(Xr.circles[wi+2]),qi.circles.push(Xr.collisionDetected?1:0)}const un=L.projection.name!=="globe";nr=nr&&(un||!di),Xt=Xt&&(un||!Hi),this.placements[Mr]=new As(Zr||nr,ii||Xt,vi||L.justReloaded),n.add(Mr)};if(Dt&&this.buildingIndex&&(this.buildingIndex.updateZOffset(L,this.retainedQueryData[L.bucketInstanceId].tileID),L.updateZOffset()),L.sortFeaturesByY){const er=L.getSortedSymbolIndexes(this.transform.angle);for(let Sr=er.length-1;Sr>=0;--Sr){const mr=er[Sr];ar(L.symbolInstances.get(mr),mr,L.collisionArrays[mr])}L.hasAnyZOffset&&t.w(`${L.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(L.hasAnyZOffset){const er=L.getSortedIndexesByZOffset();for(let Sr=0;Sr<er.length;++Sr){const mr=er[Sr];ar(L.symbolInstances.get(mr),mr,L.collisionArrays[mr])}}else for(let er=r.symbolInstanceStart;er<r.symbolInstanceEnd;er++)ar(L.symbolInstances.get(er),er,L.collisionArrays[er]);if(c&&L.bucketInstanceId in this.collisionCircleArrays){const er=this.collisionCircleArrays[L.bucketInstanceId];t.ab.mat4.invert(er.invProjMatrix,ne),er.viewportMatrix=this.collisionIndex.getViewportMatrix()}L.justReloaded=!1}markUsedJustification(r,n,c,g){const{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:L,rightJustifiedTextSymbolIndex:q,verticalPlacedTextSymbolIndex:K,crossTileID:ne}=c,ae=t.bB(n),he=g===t.bq.vertical?K:ae==="left"?M:ae==="center"?L:ae==="right"?q:-1;M>=0&&(r.text.placedSymbolArray.get(M).crossTileID=he>=0&&M!==he?0:ne),L>=0&&(r.text.placedSymbolArray.get(L).crossTileID=he>=0&&L!==he?0:ne),q>=0&&(r.text.placedSymbolArray.get(q).crossTileID=he>=0&&q!==he?0:ne),K>=0&&(r.text.placedSymbolArray.get(K).crossTileID=he>=0&&K!==he?0:ne)}markUsedOrientation(r,n,c){const g=n===t.bq.horizontal||n===t.bq.horizontalOnly?n:0,M=n===t.bq.vertical?n:0,{leftJustifiedTextSymbolIndex:L,centerJustifiedTextSymbolIndex:q,rightJustifiedTextSymbolIndex:K,verticalPlacedTextSymbolIndex:ne}=c,ae=r.text.placedSymbolArray;L>=0&&(ae.get(L).placedOrientation=g),q>=0&&(ae.get(q).placedOrientation=g),K>=0&&(ae.get(K).placedOrientation=g),ne>=0&&(ae.get(ne).placedOrientation=M)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let c=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const g=n?n.symbolFadeChange(r):1,M=n?n.opacities:{},L=n?n.variableOffsets:{},q=n?n.placedOrientations:{};for(const K in this.placements){const ne=this.placements[K],ae=M[K];ae?(this.opacities[K]=new no(ae,g,ne.text,ne.icon,null,ne.clipped),c=c||ne.text!==ae.text.placed||ne.icon!==ae.icon.placed):(this.opacities[K]=new no(null,g,ne.text,ne.icon,ne.skipFade,ne.clipped),c=c||ne.text||ne.icon)}for(const K in M){const ne=M[K];if(!this.opacities[K]){const ae=new no(ne,g,!1,!1);ae.isHidden()||(this.opacities[K]=ae,c=c||ne.text.placed||ne.icon.placed)}}for(const K in L)this.variableOffsets[K]||!this.opacities[K]||this.opacities[K].isHidden()||(this.variableOffsets[K]=L[K]);for(const K in q)this.placedOrientations[K]||!this.opacities[K]||this.opacities[K].isHidden()||(this.placedOrientations[K]=q[K]);c?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:r)}updateLayerOpacities(r,n,c,g){const M=new Set;for(const L of n){const q=L.getBucket(r);q&&L.latestFeatureIndex&&r.fqid===q.layerIds[0]&&(this.updateBucketOpacities(q,M,L,L.collisionBoxArray,c,g,L.tileID,r.scope),q.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(q,L.tileID),q.updateZOffset()))}}updateBucketOpacities(r,n,c,g,M,L,q,K){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const ne=r.layers[0].layout,ae=r.layers[0].paint,he=!!r.layers[0].dynamicFilter(),fe=new no(null,0,!1,!1,!0),Te=ne.get("text-allow-overlap"),Ve=ne.get("icon-allow-overlap"),je=ne.get("text-variable-anchor"),Xe=ne.get("text-rotation-alignment")==="map",Ye=ne.get("text-pitch-alignment")==="map",at=ae.get("symbol-z-offset"),pt=ne.get("symbol-elevation-reference")==="sea",ft=!at.isConstant(),bt=new no(null,0,Te&&(Ve||!r.hasIconData()||ne.get("icon-optional")),Ve&&(Te||!r.hasTextData()||ne.get("text-optional")),!0);!r.collisionArrays&&g&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(g);const gt=(yt,Tt,Dt)=>{for(let Zt=0;Zt<Tt/4;Zt++)yt.opacityVertexArray.emplaceBack(Dt)};let vt=0;L&&r.updateReplacement(q,L);for(let yt=0;yt<r.symbolInstances.length;yt++){const Tt=r.symbolInstances.get(yt),{numHorizontalGlyphVertices:Dt,numVerticalGlyphVertices:Zt,crossTileID:Ht,numIconVertices:Pt,tileAnchorX:zt,tileAnchorY:tr}=Tt;let lr=null;const pr=this.retainedQueryData[r.bucketInstanceId];ft&&Tt&&pr&&(lr=c.latestFeatureIndex.loadFeature({featureIndex:Tt.featureIndex,bucketIndex:pr.bucketIndex,sourceLayerIndex:pr.sourceLayerIndex,layoutVertexArrayOffset:0}));const Gt=at.evaluate(lr,{}),nr=n.has(Ht);let Xt=this.opacities[Ht];nr?Xt=fe:Xt||(Xt=bt,this.opacities[Ht]=Xt),n.add(Ht);const hr=Dt>0||Zt>0,ar=Pt>0,er=this.placedOrientations[Ht],Sr=er===t.bq.vertical,mr=er===t.bq.horizontal||er===t.bq.horizontalOnly;!hr&&!ar||Xt.isHidden()||vt++;let Mr=!1;if((hr||ar)&&L)for(const Lr of r.activeReplacements){if(t.bx(Lr,M,t.by.Symbol,K)||Lr.min.x>zt||zt>Lr.max.x||Lr.min.y>tr||tr>Lr.max.y)continue;const ri=t.bz(zt,tr,q.canonical,Lr.footprintTileId.canonical);if(Mr=t.bA(ri,Lr.footprint),Mr)break}if(hr){const Lr=Mr?za:qf(Xt.text);gt(r.text,Dt,Sr?za:Lr),gt(r.text,Zt,mr?za:Lr);const ri=Xt.text.isHidden(),{leftJustifiedTextSymbolIndex:Gr,centerJustifiedTextSymbolIndex:Zr,rightJustifiedTextSymbolIndex:ii,verticalPlacedTextSymbolIndex:vi}=Tt,di=r.text.placedSymbolArray,Hi=ri||Sr?1:0;Gr>=0&&(di.get(Gr).hidden=Hi),Zr>=0&&(di.get(Zr).hidden=Hi),ii>=0&&(di.get(ii).hidden=Hi),vi>=0&&(di.get(vi).hidden=ri||mr?1:0);const Yi=this.variableOffsets[Ht];Yi&&this.markUsedJustification(r,Yi.anchor,Tt,er);const Di=this.placedOrientations[Ht];Di&&(this.markUsedJustification(r,"left",Tt,Di),this.markUsedOrientation(r,Di,Tt))}if(ar){const Lr=Mr?za:qf(Xt.icon),{placedIconSymbolIndex:ri,verticalPlacedIconSymbolIndex:Gr}=Tt,Zr=r.icon.placedSymbolArray,ii=Xt.icon.isHidden()?1:0;ri>=0&&(gt(r.icon,Pt,Sr?za:Lr),Zr.get(ri).hidden=ii),Gr>=0&&(gt(r.icon,Tt.numVerticalIconVertices,mr?za:Lr),Zr.get(Gr).hidden=ii)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Lr=r.collisionArrays[yt];if(Lr){let ri=new t.P(0,0),Gr=!0;if(Lr.textBox||Lr.verticalTextBox){if(je){const ii=this.variableOffsets[Ht];ii?(ri=Gf(ii.anchor,ii.width,ii.height,ii.textOffset,ii.textScale),Xe&&ri._rotate(Ye?this.transform.angle:-this.transform.angle)):Gr=!1}he&&(Gr=!Xt.clipped),Lr.textBox&&xu(r.textCollisionBox.collisionVertexArray,Xt.text.placed,!Gr||Sr,Gt,pt,ri.x,ri.y),Lr.verticalTextBox&&xu(r.textCollisionBox.collisionVertexArray,Xt.text.placed,!Gr||mr,Gt,pt,ri.x,ri.y)}const Zr=Gr&&!!(!mr&&Lr.verticalIconBox);Lr.iconBox&&xu(r.iconCollisionBox.collisionVertexArray,Xt.icon.placed,Zr,Gt,pt,Tt.hasIconTextFit?ri.x:0,Tt.hasIconTextFit?ri.y:0),Lr.verticalIconBox&&xu(r.iconCollisionBox.collisionVertexArray,Xt.icon.placed,!Zr,Gt,pt,Tt.hasIconTextFit?ri.x:0,Tt.hasIconTextFit?ri.y:0)}}}if(r.fullyClipped=vt===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const yt=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=yt.invProjMatrix,r.placementViewportMatrix=yt.viewportMatrix,r.collisionCircleArray=yt.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,n){const c=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*c>r}setStale(){this.stale=!0}}function xu(u,r,n,c,g,M,L){u.emplaceBack(r?1:0,n?1:0,M||0,L||0,c,g?1:0),u.emplaceBack(r?1:0,n?1:0,M||0,L||0,c,g?1:0),u.emplaceBack(r?1:0,n?1:0,M||0,L||0,c,g?1:0),u.emplaceBack(r?1:0,n?1:0,M||0,L||0,c,g?1:0)}const wu=Math.pow(2,25),Hf=Math.pow(2,24),yl=Math.pow(2,17),sm=Math.pow(2,16),lm=Math.pow(2,9),vl=Math.pow(2,8),bl=Math.pow(2,1);function qf(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const r=u.placed?1:0,n=Math.floor(127*u.opacity);return n*wu+r*Hf+n*yl+r*sm+n*lm+r*vl+n*bl+r}const za=0;class Wf{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,n,c,g,M,L){const q=this._bucketParts;for(;this._currentTileIndex<r.length;)if(n.getBucketParts(q,g,r[this._currentTileIndex],this._sortAcrossTiles,L),this._currentTileIndex++,M())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,q.sort((K,ne)=>K.sortKey-ne.sortKey));this._currentPartIndex<q.length;){const K=q[this._currentPartIndex];if(n.placeLayerBucketPart(K,this._seenCrossTileIDs,c,K.symbolInstanceStart===0,L),this._currentPartIndex++,M())return!0}return!1}}class Eu{constructor(r,n,c,g,M,L,q,K,ne){this.placement=new ra(r,M,L,q,K,ne),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(r,n,c,g,M){const L=t.q.now(),q=()=>{const K=t.q.now()-L;return!this._forceFullPlacement&&K>2};for(;this._currentPlacementIndex>=0;){const K=n[r[this._currentPlacementIndex]],ne=this.placement.collisionIndex.transform.zoom;if(K.type==="symbol"&&(!K.minzoom||K.minzoom<=ne)&&(!K.maxzoom||K.maxzoom>ne)){const ae=K,he=ae.layout.get("symbol-z-elevate"),fe=ae.layout.get("symbol-sort-key").constantOr(1)!==void 0,Te=ae.layout.get("symbol-z-order"),Ve=Te==="viewport-y"||Te==="auto"&&!(Te!=="viewport-y"&&fe),je=ae.layout.get("text-allow-overlap")||ae.layout.get("icon-allow-overlap")||ae.layout.get("text-ignore-placement")||ae.layout.get("icon-ignore-placement"),Xe=Ve&&je,Ye=this._inProgressLayer=this._inProgressLayer||new Wf(ae),at=t.aC(K.source,K.scope);if(Ye.continuePlacement(he||Xe?g[at]:c[at],this.placement,this._showCollisionBoxes,K,q,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Za=512/t.ag/2;class um{constructor(r,n,c){this.tileID=r,this.bucketInstanceId=c,this.index=new t.bE(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const g=r.canonical.x*t.ag,M=r.canonical.y*t.ag;for(let L=0;L<n.length;L++){const{key:q,crossTileID:K,tileAnchorX:ne,tileAnchorY:ae}=n.get(L),he=Math.floor((g+ne)*Za),fe=Math.floor((M+ae)*Za);this.index.add(he,fe),this.keys.push(q),this.crossTileIDs.push(K)}this.index.finish()}findMatches(r,n,c){const g=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),M=Za/Math.pow(2,n.canonical.z-this.tileID.canonical.z),L=n.canonical.x*t.ag,q=n.canonical.y*t.ag;for(let K=0;K<r.length;K++){const ne=r.get(K);if(ne.crossTileID)continue;const{key:ae,tileAnchorX:he,tileAnchorY:fe}=ne,Te=Math.floor((L+he)*M),Ve=Math.floor((q+fe)*M),je=this.index.range(Te-g,Ve-g,Te+g,Ve+g);for(const Xe of je){const Ye=this.crossTileIDs[Xe];if(this.keys[Xe]===ae&&!c.has(Ye)){c.add(Ye),ne.crossTileID=Ye;break}}}}}class cm{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class hm{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const n=Math.round((r-this.lng)/360);if(n!==0)for(const c in this.indexes){const g=this.indexes[c],M={};for(const L in g){const q=g[L];q.tileID=q.tileID.unwrapTo(q.tileID.wrap+n),M[q.tileID.key]=q}this.indexes[c]=M}this.lng=r}addBucket(r,n,c){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let M=0;M<n.symbolInstances.length;M++)n.symbolInstances.get(M).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const g=this.usedCrossTileIDs[r.overscaledZ];for(const M in this.indexes){const L=this.indexes[M];if(Number(M)>r.overscaledZ)for(const q in L){const K=L[q];K.tileID.isChildOf(r)&&K.findMatches(n.symbolInstances,r,g)}else{const q=L[r.scaledTo(Number(M)).key];q&&q.findMatches(n.symbolInstances,r,g)}}for(let M=0;M<n.symbolInstances.length;M++){const L=n.symbolInstances.get(M);L.crossTileID||(L.crossTileID=c.generate(),g.add(L.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new um(r,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(r,n){for(const c of n.crossTileIDs)this.usedCrossTileIDs[r].delete(c)}removeStaleBuckets(r){let n=!1;for(const c in this.indexes){const g=this.indexes[c];for(const M in g)r[g[M].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,g[M]),delete g[M],n=!0)}return n}}class $f{constructor(){this.layerIndexes={},this.crossTileIDs=new cm,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,n,c,g){let M=this.layerIndexes[r.fqid];M===void 0&&(M=this.layerIndexes[r.fqid]=new hm);let L=!1;const q={};g.name!=="globe"&&M.handleWrapJump(c);for(const K of n){const ne=K.getBucket(r);ne&&r.fqid===ne.layerIds[0]&&(ne.bucketInstanceId||(ne.bucketInstanceId=++this.maxBucketInstanceId),M.addBucket(K.tileID,ne,this.crossTileIDs)&&(L=!0),q[ne.bucketInstanceId]=!0)}return M.removeStaleBuckets(q)&&(L=!0),L}pruneUnusedLayers(r){const n={};r.forEach(c=>{n[c]=!0});for(const c in this.layerIndexes)n[c]||delete this.layerIndexes[c]}}const Is=771;class pi{constructor(r,n,c,g){this.blendFunction=r,this.blendColor=n,this.mask=c,this.blendEquation=g}}pi.Replace=[1,0,1,0],pi.disabled=new pi(pi.Replace,t.aj.transparent,[!1,!1,!1,!1]),pi.unblended=new pi(pi.Replace,t.aj.transparent,[!0,!0,!0,!0]),pi.alphaBlended=new pi([1,Is,1,Is],t.aj.transparent,[!0,!0,!0,!0]),pi.alphaBlendedNonPremultiplied=new pi([770,Is,770,Is],t.aj.transparent,[!0,!0,!0,!0]),pi.multiply=new pi([774,0,774,0],t.aj.transparent,[!0,!0,!0,!0]);class qr{constructor(r,n,c){this.func=r,this.mask=n,this.range=c}}qr.ReadOnly=!1,qr.ReadWrite=!0,qr.disabled=new qr(519,qr.ReadOnly,[0,1]);const Tu=7680;class ai{constructor(r,n,c,g,M,L){this.test=r,this.ref=n,this.mask=c,this.fail=g,this.depthFail=M,this.pass=L}}ai.disabled=new ai({func:519,mask:0},0,0,Tu,Tu,Tu);const Su=1029,oo=2305;class ei{constructor(r,n,c){this.enable=r,this.mode=n,this.frontFace=c}}function Wc(u,r){const n=t.bG(u,3);t.ab.mat4.fromQuat(u,r),t.bI(u,3,n)}function Mu(u,r){const n=t.ab.quat.identity([]);return t.ab.quat.rotateZ(n,n,-r),t.ab.quat.rotateX(n,n,-u),n}function Ps(u,r){const n=[u[0],u[1],0],c=[r[0],r[1],0];if(t.ab.vec3.length(n)>=1e-15){const L=t.ab.vec3.normalize([],n);t.ab.vec3.scale(c,L,t.ab.vec3.dot(c,L)),r[0]=c[0],r[1]=c[1]}const g=t.ab.vec3.cross([],r,u);if(t.ab.vec3.len(g)<1e-15)return null;const M=Math.atan2(-g[1],g[0]);return Mu(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),M)}ei.disabled=new ei(!1,Su,oo),ei.backCCW=new ei(!0,Su,oo),ei.backCW=new ei(!0,Su,2304),ei.frontCW=new ei(!0,1028,2304),ei.frontCCW=new ei(!0,1028,oo);class Cs{constructor(r,n){this.position=r,this.orientation=n}get position(){return this._position}set position(r){if(r){const n=r instanceof t.aa?r:new t.aa(r[0],r[1],r[2]);this._renderWorldCopies&&(n.x=t.bF(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(r,n){if(this.orientation=null,!this.position)return;const c=this.position,g=this._elevation?this._elevation.getAtPointOrZero(t.aa.fromLngLat(r)):0,M=t.aa.fromLngLat(r,g),L=[M.x-c.x,M.y-c.y,M.z-c.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=Ps(L,n)}setPitchBearing(r,n){this.orientation=Mu(t.ai(r),t.ai(-n))}}class xl{constructor(r,n){this._transform=t.ab.mat4.identity([]),this.orientation=n,this.position=r}get mercatorPosition(){const r=this.position;return new t.aa(r[0],r[1],r[2])}get position(){const r=t.bG(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var n;r&&t.bI(this._transform,3,[(n=r)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||t.ab.quat.identity([]),r&&Wc(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),n=this.right();return{bearing:Math.atan2(-n[1],n[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,n){this._orientation=Mu(r,n),Wc(this._transform,this._orientation)}forward(){const r=t.bG(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=t.bG(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=t.bG(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,n){const c=new Float64Array(16);return t.ab.mat4.invert(c,this.getWorldToCamera(r,n)),c}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,n,c){const g=this.position;t.ab.vec3.scale(g,g,-r);const M=new Float64Array(16);return t.ab.mat4.fromScaling(M,[c,c,c]),t.ab.mat4.translate(M,M,g),M[10]*=n,M}getWorldToCamera(r,n){const c=new Float64Array(16),g=new Float64Array(4),M=this.position;return t.ab.quat.conjugate(g,this._orientation),t.ab.vec3.scale(M,M,-r),t.ab.mat4.fromQuat(c,g),t.ab.mat4.translate(c,c,M),c[1]*=-1,c[5]*=-1,c[9]*=-1,c[13]*=-1,c[8]*=n,c[9]*=n,c[10]*=n,c[11]*=n,c}getCameraToClipPerspective(r,n,c,g){const M=new Float64Array(16);return t.ab.mat4.perspective(M,r,n,c,g),M}getCameraToClipOrthographic(r,n,c,g,M,L){const q=new Float64Array(16);return t.ab.mat4.ortho(q,r,n,c,g,M,L),q}getDistanceToElevation(r,n=!1){const c=r===0?0:t.bH(r,n?t.aS(this.position[1]):this.position[1]),g=this.forward();return(c-this.position[2])/g[2]}clone(){return new xl([...this.position],[...this.orientation])}}const Ln={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ia{constructor(r=0,n=0,c=0,g=0){if(isNaN(r)||r<0||isNaN(n)||n<0||isNaN(c)||c<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=n,this.left=c,this.right=g}interpolate(r,n,c){return n.top!=null&&r.top!=null&&(this.top=t.af(r.top,n.top,c)),n.bottom!=null&&r.bottom!=null&&(this.bottom=t.af(r.bottom,n.bottom,c)),n.left!=null&&r.left!=null&&(this.left=t.af(r.left,n.left,c)),n.right!=null&&r.right!=null&&(this.right=t.af(r.right,n.right,c)),this}getCenter(r,n){const c=t.aw((this.left+r-this.right)/2,0,r),g=t.aw((this.top+n-this.bottom)/2,0,n);return new t.P(c,g)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new ia(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Au=(u,r,n)=>(1-n)*u+n*r,wr=u=>u*u*u*u*u;class Iu{constructor(r,n,c,g,M,L,q){this.tileSize=512,this._renderWorldCopies=M===void 0||M,this._minZoom=r||0,this._maxZoom=n||22,this._minPitch=c??0,this._maxPitch=g??60,this.setProjection(L),this.setMaxBounds(q),this.width=0,this.height=0,this._center=new t.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ia,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new xl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const r=new Iu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(r,n=!1){const c=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||c)&&this._updateCameraOnTerrain(),(r||c)&&this._constrainCamera(n),this._calcMatrices()}getProjection(){return t.ay(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=t.bP(this.projectionOptions);const c=this.getProjection(),g=!t.bn(n,c);return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=t.bP({name:"mercator"});const n=r!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return t.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this.width,this.height)}get bearing(){return t.bF(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const n=-r*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=t.ab.mat2.create(),t.ab.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const n=t.aw(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=t.ai(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const n=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._setZoom(n),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){const r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,n=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!n||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;n||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&c.exaggeration()&&this._centerAltitudeValidForExaggeration!==c.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*c.exaggeration(),this._centerAltitudeValidForExaggeration=c.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=c.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],c=this.horizonLineFromTop();let g=0,M=0;for(let L=0;L<n.length;L++){const q=new t.P(n[L][0]*this.width,c+n[L][1]*(this.height-c)),K=r.pointCoordinate(q);if(!K)continue;const ne=1/Math.hypot(K[0]-this._camera.position[0],K[1]-this._camera.position[1]);g+=K[3]*ne,M+=ne}return M===0?NaN:g/M}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),c=this.pixelsPerMeter/this.worldSize*n,g=this._mercatorZfromZoom(r),M=this._mercatorZfromZoom(this._maxZoom),L=Math.max(g-c,M);this._setZoom(this._zoomFromMercatorZ(L))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let c;c=r.z<this._camera.position[2]?[n.x,n.y,n.z]:[r.x,r.y,r.z];const g=t.ab.vec3.length(t.ab.vec3.sub([],this._camera.position,c));return t.aw(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let n=!1;if(r.orientation&&!t.ab.quat.exactEquals(r.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(r.orientation)),r.position){const c=[r.position.x,r.position.y,r.position.z];t.ab.vec3.exactEquals(c,this._camera.position)||(this._setCameraPosition(c),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,n=new Cs;return n.position=new t.aa(r[0],r[1],r[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(r){if(!t.ab.quat.length(r))return!1;t.ab.quat.normalize(r,r);const n=t.ab.vec3.transformQuat([],[0,0,-1],r),c=t.ab.vec3.transformQuat([],[0,-1,0],r);if(c[2]<0)return!1;const g=Ps(n,c);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(r){const n=this.zoomScale(this.minZoom)*this.tileSize,c=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;r[2]=t.aw(r[2],g/c,g/n),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,n,c){this._unmodified=!1,this._edgeInsets.interpolate(r,n,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const n=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(r){const n=[new t.bQ(0,r)];if(this.renderWorldCopies){const c=this.pointCoordinate(new t.P(0,0)),g=this.pointCoordinate(new t.P(this.width,0)),M=this.pointCoordinate(new t.P(this.width,this.height)),L=this.pointCoordinate(new t.P(0,this.height)),q=Math.floor(Math.min(c.x,g.x,M.x,L.x)),K=Math.floor(Math.max(c.x,g.x,M.x,L.x)),ne=1;for(let ae=q-ne;ae<=K+ne;ae++)ae!==0&&n.push(new t.bQ(ae,r))}return n}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(r,n,c){let g=[];const M=c!==void 0,L=!M;if(L&&this.zoom<n||M&&c[0]===0&&c[1]===0)return g;const q=new Set,K=(ae,he,fe,Te,Ve)=>{const je=t.c5(he,ae,fe,Te,Ve);q.has(je)||(g.push(new t.aG(ae,he,fe,Te,Ve)),q.add(je))};for(let ae=0;ae<r.length;ae++){const he=r[ae];if(L&&he.canonical.z!==n)continue;const fe=he.canonical,Te=he.overscaledZ,Ve=he.wrap,je=1<<fe.z,Xe=fe.x+1<je,Ye=fe.x>0,at=fe.y+1<je,pt=fe.y>0,ft=he.wrap-(Ye?0:1),bt=he.wrap+(Xe?0:1),gt=Ye?fe.x-1:je-1,vt=Xe?fe.x+1:0;if(M)c[0]<0?(K(Te,bt,fe.z,vt,fe.y),c[1]<0&&at&&(K(Te,Ve,fe.z,fe.x,fe.y+1),K(Te,bt,fe.z,vt,fe.y+1)),c[1]>0&&pt&&(K(Te,Ve,fe.z,fe.x,fe.y-1),K(Te,bt,fe.z,vt,fe.y-1))):c[0]>0?(K(Te,ft,fe.z,gt,fe.y),c[1]<0&&at&&(K(Te,Ve,fe.z,fe.x,fe.y+1),K(Te,ft,fe.z,gt,fe.y+1)),c[1]>0&&pt&&(K(Te,Ve,fe.z,fe.x,fe.y-1),K(Te,ft,fe.z,gt,fe.y-1))):c[1]<0&&at?K(Te,Ve,fe.z,fe.x,fe.y+1):pt&&K(Te,Ve,fe.z,fe.x,fe.y-1);else{const yt=he.visibleQuadrants;1&yt&&(K(Te,ft,fe.z,gt,fe.y),pt&&(K(Te,Ve,fe.z,fe.x,fe.y-1),K(Te,ft,fe.z,gt,fe.y-1))),2&yt&&(K(Te,bt,fe.z,vt,fe.y),pt&&(K(Te,Ve,fe.z,fe.x,fe.y-1),K(Te,bt,fe.z,vt,fe.y-1))),4&yt&&(K(Te,ft,fe.z,gt,fe.y),at&&(K(Te,Ve,fe.z,fe.x,fe.y+1),K(Te,ft,fe.z,gt,fe.y+1))),8&yt&&(K(Te,bt,fe.z,vt,fe.y),at&&(K(Te,Ve,fe.z,fe.x,fe.y+1),K(Te,bt,fe.z,vt,fe.y+1)))}}const ne=[];for(const ae of g)g.some(he=>ae.isChildOf(he))||ne.push(ae);if(g=ne.filter(ae=>!r.some(he=>!!(ae.overscaledZ<n&&he.isChildOf(ae))||ae.equals(he)||ae.isChildOf(he))),L){const ae=1<<n,he=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),fe=[ae*he.x,ae*he.y],Te=4,Ve=Te*Te;g=g.filter(je=>{const Xe=je.canonical.x+.5-fe[0],Ye=je.canonical.y+.5-fe[1];return Xe*Xe+Ye*Ye<Ve})}return g}coveringTiles(r){let n=this.coveringZoomLevel(r);const c=n,g=this.elevation&&this.elevation.exaggeration(),M=g&&!r.isTerrainDEM,L=this.projection.name==="mercator";if(r.minzoom!==void 0&&n<r.minzoom)return[];r.maxzoom!==void 0&&n>r.maxzoom&&(n=r.maxzoom);const q=this.locationCoordinate(this.center),K=this.center.lat,ne=1<<n,ae=[ne*q.x,ne*q.y,0],he=this.projection.name==="globe",fe=!he,Te=t.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,fe),Ve=he?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),je=ne*t.bH(1,this.center.lat),Xe=this._camera.position[2]/t.bH(1,this.center.lat),Ye=[ne*Ve.x,ne*Ve.y,Xe*(fe?1:je)],at=he||g,pt=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),ft=this.isLODDisabled(!0)?n:0;let bt;if(this._elevation&&r.isTerrainDEM)bt=1e4*this._elevation.exaggeration();else if(this._elevation){const Gt=this._elevation.getMinMaxForVisibleTiles();bt=Gt?Gt.max:this._centerAltitude}else bt=this._centerAltitude;const gt=r.isTerrainDEM?-bt:this._elevation?this._elevation.getMinElevationBelowMSL():0,vt=this.projection.isReprojectedInTileSpace?t.bS(this):1,yt=Gt=>{const Xt=new t.aa(Gt.x+25e-6,Gt.y,Gt.z),hr=new t.aa(Gt.x,Gt.y+25e-6,Gt.z),ar=Gt.toLngLat(),er=Xt.toLngLat(),Sr=hr.toLngLat(),mr=this.locationCoordinate(ar),Mr=this.locationCoordinate(er),Lr=this.locationCoordinate(Sr),ri=Math.hypot(Mr.x-mr.x,Mr.y-mr.y),Gr=Math.hypot(Lr.x-mr.x,Lr.y-mr.y);return Math.sqrt(ri*Gr)*vt/25e-6},Tt=Gt=>{const nr=bt,Xt=gt;return{aabb:t.bV(this,ne,0,0,0,Gt,Xt,nr,this.projection),zoom:0,x:0,y:0,minZ:Xt,maxZ:nr,wrap:Gt,fullyVisible:!1}},Dt=[];let Zt=[];const Ht=n,Pt=r.reparseOverscaled?c:n,zt=(Xe-this._centerAltitude)*je,tr=Gt=>{if(!this._elevation||!Gt.tileID||!L)return;const nr=this._elevation.getMinMaxForTile(Gt.tileID),Xt=Gt.aabb;nr?(Xt.min[2]=nr.min,Xt.max[2]=nr.max,Xt.center[2]=(Xt.min[2]+Xt.max[2])/2):(Gt.shouldSplit=pr(Gt),Gt.shouldSplit||(Xt.min[2]=Xt.max[2]=Xt.center[2]=this._centerAltitude))},lr=(Gt,nr)=>{if(.707*nr<Gt)return 1;const Xt=nr/Gt;return Xt/(1.4144271570014144+(Math.pow(1.1,Xt-1.4144271570014144+1)-1)/(1.1-1)-1)},pr=Gt=>{if(Gt.zoom<ft)return!0;if(Gt.zoom===Ht)return!1;if(Gt.shouldSplit!=null)return Gt.shouldSplit;const nr=Gt.aabb.distanceX(Ye),Xt=Gt.aabb.distanceY(Ye);let hr=zt,ar=1;if(he){hr=Gt.aabb.distanceZ(Ye);const Gr=Math.pow(2,Gt.zoom),Zr=t.aS((Gt.y+1)/Gr),ii=t.aS(Gt.y/Gr),vi=Math.min(Math.max(K,Zr),ii),di=t.c9(vi)/t.c9(K);if(ar=vi===K?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,di/this._mercatorScaleRatio),this.zoom<=t.c6&&Gt.zoom===Ht-1&&di>=.9)return!0}else if(M&&(hr=Gt.aabb.distanceZ(Ye)*je),this.projection.isReprojectedInTileSpace&&c<=5){const Gr=Math.pow(2,Gt.zoom),Zr=yt(new t.aa((Gt.x+.5)/Gr,(Gt.y+.5)/Gr));ar=Zr>.85?1:Zr}if(!L){const Gr=Math.sqrt(nr*nr+Xt*Xt+hr*hr);let Zr=(1<<Ht-Gt.zoom)*pt*ar;return Zr*=lr(Math.max(hr,zt),Gr),Gr<Zr}let er=Number.MAX_VALUE,Sr=0;const mr=Gt.aabb.getCorners(),Mr=[];for(const Gr of mr){t.ab.vec3.sub(Mr,Gr,Ye),he||(M?Mr[2]*=je:Mr[2]=zt);const Zr=t.ab.vec3.dot(Mr,this._camera.forward());Zr<er&&(er=Zr,Sr=Math.abs(Mr[2]))}let Lr=(1<<Ht-Gt.zoom)*pt*ar;if(Lr*=lr(Math.max(Sr,zt),er),er<Lr)return!0;const ri=Gt.aabb.closestPoint(ae);return ri[0]===ae[0]&&ri[1]===ae[1]};if(this.renderWorldCopies)for(let Gt=1;Gt<=3;Gt++)Dt.push(Tt(-Gt)),Dt.push(Tt(Gt));for(Dt.push(Tt(0));Dt.length>0;){const Gt=Dt.pop(),nr=Gt.x,Xt=Gt.y;let hr=Gt.fullyVisible;const ar=()=>this.projection.name==="globe"&&(Gt.y===0||Gt.y===(1<<Gt.zoom)-1);if(!hr){let er=at?Gt.aabb.intersects(Te):Gt.aabb.intersectsFlat(Te);if(er===0&&ar()){const Sr=new t.bT(Gt.zoom,nr,Xt);er=t.bU(this,ne,Sr,!0).intersects(Te)}if(er===0)continue;hr=er===2}if(Gt.zoom!==Ht&&pr(Gt))for(let er=0;er<4;er++){const Sr=(nr<<1)+er%2,mr=(Xt<<1)+(er>>1),Mr={aabb:L?Gt.aabb.quadrant(er):t.bV(this,ne,Gt.zoom+1,Sr,mr,Gt.wrap,Gt.minZ,Gt.maxZ,this.projection),zoom:Gt.zoom+1,x:Sr,y:mr,wrap:Gt.wrap,fullyVisible:hr,tileID:void 0,shouldSplit:void 0,minZ:Gt.minZ,maxZ:Gt.maxZ};M&&!he&&(Mr.tileID=new t.aG(Gt.zoom+1===Ht?Pt:Gt.zoom+1,Gt.wrap,Gt.zoom+1,Sr,mr),tr(Mr)),Dt.push(Mr)}else{const er=Gt.zoom===Ht?Pt:Gt.zoom;if(r.minzoom&&r.minzoom>er)continue;let Sr=0;if(!hr){let ri=at?Gt.aabb.intersectsPrecise(Te):Gt.aabb.intersectsPreciseFlat(Te);if(ri===0&&ar()){const Gr=new t.bT(Gt.zoom,nr,Xt);ri=t.bU(this,ne,Gr,!0).intersectsPrecise(Te)}if(ri===0)continue;if(r.calculateQuadrantVisibility)if(Te.containsPoint(Gt.aabb.center))Sr=15;else for(let Gr=0;Gr<4;Gr++)Gt.aabb.quadrant(Gr).intersects(Te)!==0&&(Sr|=1<<Gr)}const mr=ae[0]-(.5+nr+(Gt.wrap<<Gt.zoom))*(1<<n-Gt.zoom),Mr=ae[1]-.5-Xt,Lr=Gt.tileID?Gt.tileID:new t.aG(er,Gt.wrap,Gt.zoom,nr,Xt);r.calculateQuadrantVisibility&&(Lr.visibleQuadrants=Sr),Zt.push({tileID:Lr,distanceSq:mr*mr+Mr*Mr})}}if(this.fogCullDistSq){const Gt=this.fogCullDistSq,nr=this.horizonLineFromTop();Zt=Zt.filter(Xt=>{const hr=[0,0,0,1],ar=[t.ag,t.ag,0,1],er=this.calculateFogTileMatrix(Xt.tileID.toUnwrapped());t.ab.vec4.transformMat4(hr,hr,er),t.ab.vec4.transformMat4(ar,ar,er);const Sr=t.ab.vec4.min([],hr,ar),mr=t.ab.vec4.max([],hr,ar),Mr=t.bW(Sr,mr);if(Mr===0)return!0;let Lr=!1;const ri=this._elevation;if(ri&&Mr>Gt&&nr!==0){const Gr=this.calculateProjMatrix(Xt.tileID.toUnwrapped());let Zr;r.isTerrainDEM||(Zr=ri.getMinMaxForTile(Xt.tileID)),Zr||(Zr={min:gt,max:bt});const ii=t.c7(this.rotation),vi=[ii[0]*t.ag,ii[1]*t.ag,Zr.max];t.ab.vec3.transformMat4(vi,vi,Gr),Lr=(1-vi[1])*this.height*.5<nr}return Mr<Gt||Lr})}return Zt.sort((Gt,nr)=>Gt.distanceSq-nr.distanceSq).map(Gt=>Gt.tileID)}resize(r,n){this.width=r,this.height=n,this.pixelsToGLUnits=[2/r,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const n=t.aw(r.lat,-t.bX,t.bX),c=this.projection.project(r.lng,n);return new t.P(c.x*this.worldSize,c.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/t.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,n){let c,g;const M=this.centerPoint;if(this.projection.name==="globe"){const q=this.worldSize;c=(n.x-M.x)/q,g=(n.y-M.y)/q}else{const q=this.pointCoordinate(n),K=this.pointCoordinate(M);c=q.x-K.x,g=q.y-K.y}const L=this.locationCoordinate(r);this.setLocation(new t.aa(L.x-c,L.y-g))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,n){const c=n?t.bH(n,r.lat):void 0,g=this.projection.project(r.lng,r.lat);return new t.aa(g.x,g.y,c)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,n){const c=n??this._centerAltitude,g=[r.x,r.y,0,1],M=[r.x,r.y,1,1];t.ab.vec4.transformMat4(g,g,this.pixelMatrixInverse),t.ab.vec4.transformMat4(M,M,this.pixelMatrixInverse);const L=M[3];t.ab.vec4.scale(g,g,1/g[3]),t.ab.vec4.scale(M,M,1/L);const q=g[2],K=M[2];return{p0:g,p1:M,t:q===K?0:(c-q)/(K-q)}}screenPointToMercatorRay(r){const n=[r.x,r.y,0,1],c=[r.x,r.y,1,1];return t.ab.vec4.transformMat4(n,n,this.pixelMatrixInverse),t.ab.vec4.transformMat4(c,c,this.pixelMatrixInverse),t.ab.vec4.scale(n,n,1/n[3]),t.ab.vec4.scale(c,c,1/c[3]),n[2]=t.bH(n[2],this._center.lat)*this.worldSize,c[2]=t.bH(c[2],this._center.lat)*this.worldSize,t.ab.vec4.scale(n,n,1/this.worldSize),t.ab.vec4.scale(c,c,1/this.worldSize),new t.aq([n[0],n[1],n[2]],t.ab.vec3.normalize([],t.ab.vec3.sub([],c,n)))}rayIntersectionCoordinate(r){const{p0:n,p1:c,t:g}=r,M=t.bH(n[2],this._center.lat),L=t.bH(c[2],this._center.lat);return new t.aa(t.af(n[0],c[0],g)/this.worldSize,t.af(n[1],c[1],g)/this.worldSize,t.af(M,L,g))}pointCoordinate(r,n=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,n)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let n=this.projection.pointCoordinate3D(this,r.x,r.y);if(n)return new t.aa(n[0],n[1],n[2]);let c=0,g=this.horizonLineFromTop();if(r.y>g)return this.pointCoordinate(r);const M=.02*g,L=r.clone();for(let q=0;q<10&&g-c>M;q++){L.y=t.af(c,g,.66);const K=this.projection.pointCoordinate3D(this,L.x,L.y);K?(g=L.y,n=K):c=L.y}return n?new t.aa(n[0],n[1],n[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=t.bY)return!this.isPointAboveHorizon(r);const n=this.pointCoordinate(r);return n.y>=0&&n.y<=1}_coordinatePoint(r,n){const c=n&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,g=[r.x*this.worldSize,r.y*this.worldSize,c+r.toAltitude(),1];return t.ab.vec4.transformMat4(g,g,this.pixelMatrix),g[3]>0?new t.P(g[0]/g[3],g[1]/g[3]):new t.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:n}=this._edgeInsets,c=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,M=this.pointLocation3D(new t.P(n,r)),L=this.pointLocation3D(new t.P(g,r)),q=this.pointLocation3D(new t.P(g,c)),K=this.pointLocation3D(new t.P(n,c));let ne=Math.min(M.lng,L.lng,q.lng,K.lng),ae=Math.max(M.lng,L.lng,q.lng,K.lng),he=Math.min(M.lat,L.lat,q.lat,K.lat),fe=Math.max(M.lat,L.lat,q.lat,K.lat);const Te=Math.pow(2,-this.zoom)/16*270,Ve=this.projection.name==="globe"?1:4,je=(Xe,Ye,at,pt,ft)=>{const bt=(Xe+at)/2,gt=(Ye+pt)/2,vt=new t.P(bt,gt),{lng:yt,lat:Tt}=this.pointLocation3D(vt),Dt=Math.max(0,ne-yt,he-Tt,yt-ae,Tt-fe);ne=Math.min(ne,yt),ae=Math.max(ae,yt),he=Math.min(he,Tt),fe=Math.max(fe,Tt),(ft<Ve||Dt>Te)&&(je(Xe,Ye,bt,gt,ft+1),je(bt,gt,at,pt,ft+1))};if(je(n,r,g,r,1),je(g,r,g,c,1),je(g,c,n,c,1),je(n,c,n,r,1),this.projection.name==="globe"){const[Xe,Ye]=t.bZ(this);Xe?(fe=90,ae=180,ne=-180):Ye&&(he=-90,ae=180,ne=-180)}return new t.az(new t.bO(ne,he),new t.bO(ae,fe))}_getBoundsRectangular(r,n){const{top:c,left:g}=this._edgeInsets,M=this.height-this._edgeInsets.bottom,L=this.width-this._edgeInsets.right,q=new t.P(g,c),K=new t.P(L,c),ne=new t.P(L,M),ae=new t.P(g,M);let he=this.pointCoordinate(q,r),fe=this.pointCoordinate(K,r);const Te=this.pointCoordinate(ne,n),Ve=this.pointCoordinate(ae,n),je=(Xe,Ye)=>(Ye.y-Xe.y)/(Ye.x-Xe.x);return he.y>1&&fe.y>=0?he=new t.aa((1-Ve.y)/je(Ve,he)+Ve.x,1):he.y<0&&fe.y<=1&&(he=new t.aa(-Ve.y/je(Ve,he)+Ve.x,0)),fe.y>1&&he.y>=0?fe=new t.aa((1-Te.y)/je(Te,fe)+Te.x,1):fe.y<0&&he.y<=1&&(fe=new t.aa(-Te.y/je(Te,fe)+Te.x,0)),new t.az().extend(this.coordinateLocation(he)).extend(this.coordinateLocation(fe)).extend(this.coordinateLocation(Ve)).extend(this.coordinateLocation(Te))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const n=r.visibleDemTiles.reduce((c,g)=>{if(g.dem){const M=g.dem.tree;c.min=Math.min(c.min,M.minimums[0]),c.max=Math.max(c.max,M.maximums[0])}return c},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(n.min*r.exaggeration(),n.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const n=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,c=this.height/2-n*(1-this._horizonShift);return r?Math.max(0,c):c}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-t.bX,this.maxLat=t.bX,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=t.at(this.minLng)*this.tileSize,this.worldMaxX=t.at(this.maxLng)*this.tileSize,this.worldMinY=t.aA(this.maxLat)*this.tileSize,this.worldMaxY=t.aA(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,n){return this.projection.createTileMatrix(this,n,r)}calculateDistanceTileData(r){const n=r.key,c=this._distanceTileDataCache;if(c[n])return c[n];const g=r.canonical,M=1/this.height,L=this.cameraWorldSize,q=L/this.zoomScale(g.z),K=(g.x+Math.pow(2,g.z)*r.wrap)*q,ne=g.y*q,ae=this.point;ae.x*=L/this.worldSize,ae.y*=L/this.worldSize;const he=this.angle,fe=Math.sin(-he),Te=-Math.cos(-he);return c[n]={bearing:[fe,Te],center:[(ae.x-K)*M,(ae.y-ne)*M],scale:q/t.ag*M},c[n]}calculateFogTileMatrix(r){const n=r.key,c=this._fogTileMatrixCache;if(c[n])return c[n];const g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return t.ab.mat4.multiply(g,this.worldToFogMatrix,g),c[n]=new Float32Array(g),c[n]}calculateProjMatrix(r,n=!1,c=!1){const g=r.key;let M;if(M=c?this._expandedProjMatrixCache:n?this._alignedProjMatrixCache:this._projMatrixCache,M[g])return M[g];const L=this.calculatePosMatrix(r,this.worldSize);let q;return q=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.expandedFarZProjMatrix:n?this.alignedProjMatrix:this.projMatrix,t.ab.mat4.multiply(L,q,L),M[g]=new Float32Array(L),M[g]}calculatePixelsToTileUnitsMatrix(r){const n=r.tileID.key,c=this._pixelsToTileUnitsCache;if(c[n])return c[n];const g=t.b_(r,this);return c[n]=g,c[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const r=1/this.worldSize,n=t.ab.mat4.fromScaling([],[r,r,r]);return t.ab.mat4.multiply(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const n=t.bH(1,this._center.lat)*this.worldSize,c=this._computeCameraPosition(n),g=this._camera.forward(),M=t.bH(1,this._center.lat);c[2]/=M,g[2]/=M,t.ab.vec3.normalize(g,g);const L=r.raycast(c,g,r.exaggeration());if(L){const q=t.ab.vec3.scaleAndAdd([],c,g,L),K=new t.aa(q[0],q[1],t.bH(q[2],t.aS(q[1]))),ne=(K.z+t.ab.vec3.length([K.x-c[0],K.y-c[1],K.z-c[2]*M]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(ne),this._centerAltitude=K.toAltitude(),this._center=this.coordinateLocation(K),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const n=this._elevation,c=t.bH(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(c),M=n.getAtPointOrZero(new t.aa(...g)),L=this.pixelsPerMeter/this.worldSize*M,q=this._minimumHeightOverTerrain(),K=g[2]-L;if(K<=q)if(K<0||r){const ne=this.locationCoordinate(this._center,this._centerAltitude),ae=[g[0],g[1],ne.z-g[2]],he=t.ab.vec3.length(ae);ae[2]-=(q-K)/this._pixelsPerMercatorPixel;const fe=t.ab.vec3.length(ae);if(fe===0)return;t.ab.vec3.scale(ae,ae,he/fe*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],ne.z*this._pixelsPerMercatorPixel-ae[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const fe=this.center;return fe.lat=t.aw(fe.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(fe.lng=t.aw(fe.lng,this.minLng,this.maxLng)),this.center=fe,void(this._constraining=!1)}const n=this._unmodified,{x:c,y:g}=this.point;let M=0,L=c,q=g;const K=this.width/2,ne=this.height/2,ae=this.worldMinY*this.scale,he=this.worldMaxY*this.scale;if(g-ne<ae&&(q=ae+ne),g+ne>he&&(q=he-ne),he-ae<this.height&&(M=Math.max(M,this.height/(he-ae)),q=(he+ae)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const fe=this.worldMinX*this.scale,Te=this.worldMaxX*this.scale,Ve=this.worldSize/2-(fe+Te)/2;L=(c+Ve+this.worldSize)%this.worldSize-Ve,L-K<fe&&(L=fe+K),L+K>Te&&(L=Te-K),Te-fe<this.width&&(M=Math.max(M,this.width/(Te-fe)),L=(Te+fe)/2)}L===c&&q===g||(this.center=this.unproject(new t.P(L,q))),M&&(this.zoom+=this.scaleZoom(M)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,n=this.projection.name==="globe",c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=t.bH(1,this.center.lat)/t.bH(1,t.c8));const g=t.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const M=this.projection.zAxisUnit==="meters"?c:1,L=this._camera.getWorldToCamera(this.worldSize,M);let q;const K=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(K[8]=2*-r.x/this.width,K[9]=2*r.y/this.height,this.isOrthographic){let Tt=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Dt=Tt*this.aspect,Zt=-Dt,Ht=-Tt;Dt-=r.x,Zt-=r.x,Tt+=r.y,Ht+=r.y,q=this._camera.getCameraToClipOrthographic(Zt,Dt,Ht,Tt,this._nearZ,this._farZ),((Pt,zt,tr,lr)=>{for(let pr=0;pr<16;pr++)Pt[pr]=Au(zt[pr],tr[pr],lr)})(q,q,K,wr(this.pitch>=15?1:this.pitch/15))}else q=K;const ne=t.ab.mat4.mul([],K,L);let ae=t.ab.mat4.mul([],q,L);if(this.projection.isReprojectedInTileSpace){const Tt=this.locationCoordinate(this.center),Dt=t.ab.mat4.identity([]);t.ab.mat4.translate(Dt,Dt,[Tt.x*this.worldSize,Tt.y*this.worldSize,0]),t.ab.mat4.multiply(Dt,Dt,t.c0(this)),t.ab.mat4.translate(Dt,Dt,[-Tt.x*this.worldSize,-Tt.y*this.worldSize,0]),t.ab.mat4.multiply(ae,ae,Dt),t.ab.mat4.multiply(ne,ne,Dt),this.inverseAdjustmentMatrix=t.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=t.ab.mat4.scale([],ae,[this.worldSize,this.worldSize,this.worldSize/M,1]),this.projMatrix=ae,this.invProjMatrix=t.ab.mat4.invert(new Float64Array(16),this.projMatrix),n){const Tt=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Tt[8]=2*-r.x/this.width,Tt[9]=2*r.y/this.height,this.expandedFarZProjMatrix=t.ab.mat4.mul([],Tt,L)}else this.expandedFarZProjMatrix=this.projMatrix;const he=t.ab.mat4.invert([],q);this.frustumCorners=t.c2.fromInvProjectionMatrix(he,this.horizonLineFromTop(),this.height),this.cameraFrustum=t.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const fe=new Float32Array(16);t.ab.mat4.identity(fe),t.ab.mat4.scale(fe,fe,[1,-1,1]),t.ab.mat4.rotateX(fe,fe,this._pitch),t.ab.mat4.rotateZ(fe,fe,this.angle);const Te=t.ab.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=t.ab.mat4.clone(Te);const Ve=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Te[8]=2*-r.x/this.width,Te[9]=2*(r.y+Ve)/this.height,this.skyboxMatrix=t.ab.mat4.multiply(fe,Te,fe);const je=this.point,Xe=je.x,Ye=je.y,at=this.width%2/2,pt=this.height%2/2,ft=Math.cos(this.angle),bt=Math.sin(this.angle),gt=Xe-Math.round(Xe)+ft*at+bt*pt,vt=Ye-Math.round(Ye)+ft*pt+bt*at,yt=new Float64Array(ae);if(t.ab.mat4.translate(yt,yt,[gt>.5?gt-1:gt,vt>.5?vt-1:vt,0]),this.alignedProjMatrix=yt,ae=t.ab.mat4.create(),t.ab.mat4.scale(ae,ae,[this.width/2,-this.height/2,1]),t.ab.mat4.translate(ae,ae,[1,-1,0]),this.labelPlaneMatrix=ae,ae=t.ab.mat4.create(),t.ab.mat4.scale(ae,ae,[1,-1,1]),t.ab.mat4.translate(ae,ae,[-1,-1,0]),t.ab.mat4.scale(ae,ae,[2/this.width,2/this.height,1]),this.glCoordMatrix=ae,this.pixelMatrix=t.ab.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,ne),this._calcFogMatrices(),this._distanceTileDataCache={},ae=t.ab.mat4.invert(new Float64Array(16),this.pixelMatrix),!ae)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=ae,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=t.c3(this);const Tt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=t.ab.vec3.transformMat4(Tt,Tt,L),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=ae;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,c=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,M=[r,r,n];t.ab.vec3.scale(M,M,g),t.ab.vec3.scale(c,c,-1),t.ab.vec3.multiply(c,c,M);const L=t.ab.mat4.create();t.ab.mat4.translate(L,L,c),t.ab.mat4.scale(L,L,M),this.mercatorFogMatrix=L,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,n,g)}_computeCameraPosition(r){const n=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,c=this._camera.forward(),g=this.point,M=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*n-r/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-c[0]*M,g.y/this.worldSize-c[1]*M,r/this.worldSize*this._centerAltitude-c[2]*M]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),c=this._camera.position[2],g=r[2];let M=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(M=Math.min((n-c)/g,1)),this._camera.position=t.ab.vec3.scaleAndAdd([],this._camera.position,r,M),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,n=this._camera.forward(),{pitch:c,bearing:g}=this._camera.getPitchBearing(),M=t.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,L=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.ai(this._maxPitch)),q=Math.max((r[2]-M)/Math.cos(c),L),K=this._zoomFromMercatorZ(q);t.ab.vec3.scaleAndAdd(r,r,n,q),this._pitch=t.aw(c,t.ai(this.minPitch),t.ai(this.maxPitch)),this.angle=t.bF(g,-Math.PI,Math.PI),this._setZoom(t.aw(K,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new t.aa(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let n=0,c=t.bY,g=0,M=1/0;for(;c-n>1e-6&&c>n;){const L=n+.5*(c-n),q=this.tileSize*Math.pow(2,L),K=this.getCameraToCenterDistance(this.projection,L,q),ne=this.scaleZoom(K/(r*this.tileSize)),ae=Math.abs(L-ne);ae<M&&(M=ae,g=L),L<ne?n=L:c=L}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(t.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,n){const c=Math.min(r.x,n.x),g=Math.max(r.x,n.x),M=Math.min(r.y,n.y),L=Math.max(r.y,n.y);if(M<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const q=[new t.P(c,M),new t.P(g,L),new t.P(c,L),new t.P(g,M)],K=this.renderWorldCopies?-3:0,ne=this.renderWorldCopies?4:1;for(const ae of q){const he=this.pointRayIntersection(ae);if(he.t<0)return!0;const fe=this.rayIntersectionCoordinate(he);if(fe.x<K||fe.y<0||fe.x>ne||fe.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new t.P(0,0),new t.P(this.width,this.height))}zoomDeltaToMovement(r,n){const c=t.ab.vec3.length(t.ab.vec3.sub([],this._camera.position,r)),g=this._zoomFromMercatorZ(c)+n;return c-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([n,c,g],M){const L=[n,c,g,1];t.ab.vec4.transformMat4(L,L,M);const q=L[3]=Math.max(L[3],1e-6);return L[0]/=q,L[1]/=q,L[2]/=q,L}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new t.P(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(0,r))}}getCameraToCenterDistance(r,n=this.zoom,c=this.worldSize){const g=t.b$(r,n,this.width,this.height,1024),M=r.pixelSpaceConversion(this.center.lat,c,g);let L=.5/Math.tan(.5*this._fov)*this.height*M;return this.isOrthographic&&(L=Au(1,L,wr(this.pitch>=15?1:this.pitch/15))),L}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&t.ab.mat4.multiply(r,r,this.globeMatrix),r}getFrustum(r){return t.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,this.projection.zAxisUnit==="meters")}}const so=(u,r)=>{if(r>0&&u.terrain&&t.w("Cutoff is currently disabled on terrain"),r<=0||u.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const n=u.transform,c=Math.max(Math.abs(n._zoom-(u.minCutoffZoom-1)),1),g=n.isLODDisabled(!1)?t.ac(60,45,n.pitch):t.ac(30,15,n.pitch),M=n._farZ-n._nearZ,L=r*n.height,q=((1-(K=g))*n.cameraToCenterDistance+K*(n._farZ+L))*c;var K;return{shouldRenderCutoff:g<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(q-n._nearZ)/M,(q-L-n._nearZ)/M]}}},On={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Zf{constructor(r,n){this.aabb=r,this.lastCascade=n}}class Pu{add(r,n){const c=this.receivers[r.key];c!==void 0?(c.aabb.min[0]=Math.min(c.aabb.min[0],n.min[0]),c.aabb.min[1]=Math.min(c.aabb.min[1],n.min[1]),c.aabb.min[2]=Math.min(c.aabb.min[2],n.min[2]),c.aabb.max[0]=Math.max(c.aabb.max[0],n.max[0]),c.aabb.max[1]=Math.max(c.aabb.max[1],n.max[1]),c.aabb.max[2]=Math.max(c.aabb.max[2],n.max[2])):this.receivers[r.key]=new Zf(n,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,n,c){const g=t.cd.fromPoints(r.points);let M=0;for(const L in this.receivers){const q=this.receivers[L];if(!q||!g.intersectsAabb(q.aabb))continue;q.aabb.min=g.closestPoint(q.aabb.min),q.aabb.max=g.closestPoint(q.aabb.max);const K=q.aabb.getCorners();for(let ne=0;ne<c.length;ne++){let ae=!0;for(const he of K){const fe=[he[0]*n,he[1]*n,he[2]];if(t.ab.vec3.transformMat4(fe,fe,c[ne].matrix),fe[0]<-1||fe[0]>1||fe[1]<-1||fe[1]>1){ae=!1;break}}if(q.lastCascade=ne,M=Math.max(M,ne),ae)break}}return M+1}}class lo{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Pu,this._depthMode=new qr(r.context.gl.LEQUAL,qr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,r.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),r.tp.registerParameter(On,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),r.tp.registerParameter(On,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),r.tp.registerParameter(On,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),r.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,n){const c=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const g=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||g<=0||(this._shadowLayerCount=c.style.order.reduce((Ve,je)=>{const Xe=c.style._mergedLayers[je];return Ve+(Xe.hasShadowPass()&&!Xe.isHidden(r.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const M=c.context,L=On.shadowMapResolution,q=On.shadowMapResolution;if(this._cascades.length===0||On.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Ve=0;Ve<On.cascadeCount;++Ve){const je=c._shadowMapDebug,Xe=M.gl,Ye=M.createFramebuffer(L,q,je,"texture"),at=new t.T(M,{width:L,height:q,data:null},Xe.DEPTH_COMPONENT16);if(Ye.depthAttachment.set(at.texture),je){const pt=new t.T(M,{width:L,height:q,data:null},Xe.RGBA8);Ye.colorAttachment.set(pt.texture)}this._cascades.push({framebuffer:Ye,texture:at,matrix:[],far:0,boundingSphereRadius:0,frustum:new t.bR,scale:0})}}this.shadowDirection=Ao(n);let K=0;if(r.elevation){const Ve=r.elevation,je=[1e4,-1e4];Ve.visibleDemTiles.filter(Xe=>Xe.dem).forEach(Xe=>{const Ye=Xe.dem.tree;je[0]=Math.min(je[0],Ye.minimums[0]),je[1]=Math.max(je[1],Ye.maximums[0])}),je[0]!==1e4&&(K=(je[1]-je[0])*Ve.exaggeration())}const ne=1.5*r.cameraToCenterDistance,ae=3*ne,he=new Float64Array(16);for(let Ve=0;Ve<this._cascades.length;++Ve){const je=this._cascades[Ve];let Xe=r.height/50,Ye=1;On.cascadeCount===1?Ye=ae:Ve===0?Ye=ne:(Xe=ne,Ye=ae);const[at,pt]=Ls(r,this.shadowDirection,Xe,Ye,On.shadowMapResolution,K);je.scale=r.scale,je.matrix=at,je.boundingSphereRadius=pt,t.ab.mat4.invert(he,je.matrix),je.frustum=t.bR.fromInvProjectionMatrix(he,1,0,!0),je.far=Ye}const fe=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[fe].far,this._cascades[fe].far],this._uniformValues.u_shadow_intensity=g,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/On.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=On.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ln.ShadowMap0,this._uniformValues.u_shadowmap_1=Ln.ShadowMap0+1,this._groundShadowTiles=c.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Te=c.transform.elevation;for(const Ve of this._groundShadowTiles){let je={min:0,max:0};if(Te){const Xe=Te.getMinMaxForTile(Ve);Xe&&(je=Xe)}this.addShadowReceiver(Ve.toUnwrapped(),je.min,je.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(r){this._enabled=r}drawShadowPass(r,n){if(!this.enabled)return;const c=this.painter,g=c.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(c.transform.getFrustum(0),c.transform.worldSize,this._cascades),g.viewport.set([0,0,On.shadowMapResolution,On.shadowMapResolution]);for(let M=0;M<this._numCascadesToRender;++M){c.currentShadowCascade=M,g.bindFramebuffer.set(this._cascades[M].framebuffer.framebuffer),g.clear({color:t.aj.white,depth:1});for(const L of r.order){const q=r._mergedLayers[L];if(!q.hasShadowPass()||q.isHidden(c.transform.zoom))continue;const K=r.getLayerSourceCache(q),ne=K?n[K.id]:void 0;(q.type==="model"||ne&&ne.length)&&c.renderLayer(c,K,q,ne)}}c.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const r=this.painter,n=r.style,c=r.context,g=n.directionalLight,M=n.ambientLight;if(!g||!M)return;const L=[],q=so(r,r.longestCutoffRange);q.shouldRenderCutoff&&L.push("RENDER_CUTOFF"),L.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&L.push("NORMAL_OFFSET");const K=Ds(n,g,M),ne=new qr(c.gl.LEQUAL,qr.ReadOnly,r.depthRangeFor3D);for(const ae of this._groundShadowTiles){const he=ae.toUnwrapped(),fe=r.isTileAffectedByFog(ae),Te=r.getOrCreateProgram("groundShadow",{defines:L,overrideFog:fe});this.setupShadows(he,Te),r.uploadCommonUniforms(c,Te,he,null,q);const Ve={u_matrix:r.transform.calculateProjMatrix(he),u_ground_shadow_factor:K};Te.draw(r,c.gl.TRIANGLES,ne,ai.disabled,pi.multiply,ei.disabled,Ve,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,{},r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?pi.unblended:pi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){const n=this.painter.transform,c=n.calculatePosMatrix(r,n.worldSize);return t.ab.mat4.multiply(c,this._cascades[this.painter.currentShadowCascade].matrix,c),Float32Array.from(c)}calculateShadowPassMatrixFromMatrix(r){return t.ab.mat4.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}setupShadows(r,n,c,g=0){if(!this.enabled)return;const M=this.painter.transform,L=this.painter.context,q=L.gl,K=this._uniformValues,ne=new Float64Array(16),ae=M.calculatePosMatrix(r,M.worldSize);for(let he=0;he<this._cascades.length;he++)t.ab.mat4.multiply(ne,this._cascades[he].matrix,ae),K[he===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(ne),L.activeTexture.set(q.TEXTURE0+Ln.ShadowMap0+he),this._cascades[he].texture.bind(q.NEAREST,q.CLAMP_TO_EDGE);if(this.useNormalOffset=!!c,this.useNormalOffset){const he=t.cc(r.canonical),fe=2/M.tileSize*t.ag/On.shadowMapResolution,Te=fe*this._cascades[0].boundingSphereRadius,Ve=fe*this._cascades[this._cascades.length-1].boundingSphereRadius,je=(c==="vector-tile"?1:3)/Math.pow(2,g-r.canonical.z-(1-M.zoom+Math.floor(M.zoom)));K.u_shadow_normal_offset=[he,Te*je,Ve*je],K.u_shadow_bias=[6e-5,.0012,.012]}else K.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(L,K)}setupShadowsFromMatrix(r,n,c=!1){if(!this.enabled)return;const g=this.painter.context,M=g.gl,L=this._uniformValues,q=new Float64Array(16);for(let K=0;K<On.cascadeCount;K++)t.ab.mat4.multiply(q,this._cascades[K].matrix,r),L[K===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(q),g.activeTexture.set(M.TEXTURE0+Ln.ShadowMap0+K),this._cascades[K].texture.bind(M.NEAREST,M.CLAMP_TO_EDGE);if(this.useNormalOffset=c,c){const K=On.normalOffset;L.u_shadow_normal_offset=[1,K,K],L.u_shadow_bias=[6e-5,.0012,.012]}else L.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(g,L)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,n,c,g){if(g[2]>=0)return{};const M=function(K,ne,ae){const he=ae/(1<<K.canonical.z);return new t.cd([K.canonical.x*he+K.wrap*ae,K.canonical.y*he+K.wrap*ae,0],[(K.canonical.x+1)*he+K.wrap*ae,(K.canonical.y+1)*he+K.wrap*ae,ne])}(r,n,c).getCorners(),L=n/-g[2];g[0]<0?(t.ab.vec3.add(M[0],M[0],[g[0]*L,0,0]),t.ab.vec3.add(M[3],M[3],[g[0]*L,0,0])):g[0]>0&&(t.ab.vec3.add(M[1],M[1],[g[0]*L,0,0]),t.ab.vec3.add(M[2],M[2],[g[0]*L,0,0])),g[1]<0?(t.ab.vec3.add(M[0],M[0],[0,g[1]*L,0]),t.ab.vec3.add(M[1],M[1],[0,g[1]*L,0])):g[1]>0&&(t.ab.vec3.add(M[2],M[2],[0,g[1]*L,0]),t.ab.vec3.add(M[3],M[3],[0,g[1]*L,0]));const q={};return q.vertices=M,q.planes=[Rs(M[1],M[0],M[4]),Rs(M[2],M[1],M[5]),Rs(M[3],M[2],M[6]),Rs(M[0],M[3],M[7])],q}addShadowReceiver(r,n,c){this._receivers.add(r,t.cd.fromTileIdAndHeight(r,n,c))}getMaxCascadeForTile(r){const n=this._receivers.get(r);return n&&n.lastCascade?n.lastCascade:0}}function Rs(u,r,n){const c=t.ab.vec3.sub([],n,r),g=t.ab.vec3.sub([],u,r),M=t.ab.vec3.cross([],c,g),L=t.ab.vec3.length(M);return L===0?[0,0,1,0]:(t.ab.vec3.scale(M,M,1/L),[M[0],M[1],M[2],-t.ab.vec3.dot(M,r)])}function Ao(u){const r=u.properties.get("direction"),n=t.cb(r.x,r.y,r.z);n[2]=t.aw(n[2],0,75);const c=t.ce([n[0],n[1],n[2]]);return t.ab.vec3.fromValues(c.x,c.y,c.z)}function Ds(u,r,n){const c=r.properties.get("color-use-theme")==="none",g=r.properties.get("color"),M=r.properties.get("intensity"),L=r.properties.get("direction"),q=[L.x,L.y,L.z],K=n.properties.get("color-use-theme")==="none",ne=n.properties.get("color"),ae=n.properties.get("intensity"),he=Math.max(t.ab.vec3.dot([0,0,1],q),0),fe=[0,0,0];t.ab.vec3.scale(fe,ne.toRenderColor(K?null:u.getLut(r.scope)).toArray01Linear().slice(0,3),ae);const Te=[0,0,0];return t.ab.vec3.scale(Te,g.toRenderColor(c?null:u.getLut(n.scope)).toArray01Linear().slice(0,3),he*M),t.cf([fe[0]>0?fe[0]/(fe[0]+Te[0]):0,fe[1]>0?fe[1]/(fe[1]+Te[1]):0,fe[2]>0?fe[2]/(fe[2]+Te[2]):0])}function Ls(u,r,n,c,g,M){const L=u.zoom,q=u.scale,K=u.worldSize,ne=1/K,ae=u.aspect,he=Math.sqrt(1+ae*ae)*Math.tan(.5*u.fovX),fe=he*he,Te=c-n,Ve=c+n;let je,Xe;fe>Te/Ve?(je=c,Xe=c*he):(je=.5*Ve*(1+fe),Xe=.5*Math.sqrt(Te*Te+2*(c*c+n*n)*fe+Ve*Ve*fe*fe));const Ye=u.projection.pixelsPerMeter(u.center.lat,K),at=u._camera.getCameraToWorldMercator(),pt=[0,0,-je*ne];t.ab.vec3.transformMat4(pt,pt,at);let ft=Xe*ne;const bt=u._edgeInsets;if(!(bt.left===0&&bt.top===0&&bt.right===0&&bt.bottom===0||bt.left===bt.right&&bt.top===bt.bottom)){const hr=u._camera.getWorldToCamera(u.worldSize,u.projection.zAxisUnit==="meters"?Ye:1),ar=u._camera.getCameraToClipPerspective(u._fov,u.width/u.height,n,c);ar[8]=2*-u.centerOffset.x/u.width,ar[9]=2*u.centerOffset.y/u.height;const er=new Float64Array(16);t.ab.mat4.mul(er,ar,hr);const Sr=new Float64Array(16);t.ab.mat4.invert(Sr,er);const mr=t.bR.fromInvProjectionMatrix(Sr,K,L,!0);for(const Mr of mr.points){const Lr=((gt=Mr)[0]/=q,gt[1]/=q,gt[2]=t.bH(gt[2],u._center.lat),gt);ft=Math.max(ft,t.ab.vec3.len(t.ab.vec3.subtract([],pt,Lr)))}}var gt;ft*=g/(g-1);const vt=Math.acos(r[2]),yt=Math.atan2(-r[0],-r[1]),Tt=new xl;Tt.position=pt,Tt.setPitchBearing(vt,yt);const Dt=Tt.getWorldToCamera(K,Ye),Zt=ft*K,Ht=Math.min(u._mercatorZfromZoom(17)*K*-2,-2*Zt),Pt=Tt.getCameraToClipOrthographic(-Zt,Zt,-Zt,Zt,Ht,(Zt+M*Ye)/r[2]),zt=new Float64Array(16);t.ab.mat4.multiply(zt,Pt,Dt);const tr=t.ab.vec3.fromValues(Math.floor(1e6*pt[0])/1e6*K,Math.floor(1e6*pt[1])/1e6*K,0),lr=.5*g,pr=[0,0,0];t.ab.vec3.transformMat4(pr,tr,zt),t.ab.vec3.scale(pr,pr,lr);const Gt=[Math.floor(pr[0]),Math.floor(pr[1]),Math.floor(pr[2])],nr=[0,0,0];t.ab.vec3.sub(nr,pr,Gt),t.ab.vec3.scale(nr,nr,-1/lr);const Xt=new Float64Array(16);return t.ab.mat4.identity(Xt),t.ab.mat4.translate(Xt,Xt,nr),t.ab.mat4.multiply(zt,Xt,zt),[zt,Zt]}class fm extends t.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.numModelsLoading={}}loadModel(r,n){return t.aM(this.requestManager.transformRequest(n,t.R.Model).url).then(c=>{if(!c)return;const g=t.aN(c),M=new t.aO(r,void 0,void 0,g);return M.computeBoundsAndApplyParent(),M}).catch(c=>{if(c&&c.status===404)return null;this.fire(new t.y(new Error(`Could not load model ${r} from ${n}: ${c.message}`)))})}load(r,n){this.models[n]||(this.models[n]={});const c=Object.keys(r);this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+c.length;const g=[];for(const M of c)g.push(this.loadModel(M,r[M]));Promise.allSettled(g).then(M=>{for(let L=0;L<M.length;L++){const{status:q,value:K}=M[L];q==="fulfilled"&&K&&(this.models[n][c[L]]={model:K,numReferences:1})}this.numModelsLoading[n]-=c.length,this.fire(new t.z("data",{dataType:"style"}))}).catch(M=>{this.fire(new t.y(new Error(`Could not load models: ${M.message}`)))})}isLoaded(){for(const r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,n){return!!this.getModel(r,n)}getModel(r,n){return this.models[n]||(this.models[n]={}),this.models[n][r]?this.models[n][r].model:void 0}addModel(r,n,c){this.models[c]||(this.models[c]={}),this.hasModel(r,c)&&this.models[c][r].numReferences++,this.load({[r]:this.requestManager.normalizeModelURL(n)},c)}addModels(r,n){this.models[n]||(this.models[n]={});const c={};for(const g in r)this.models[n][g]={},c[g]=this.requestManager.normalizeModelURL(r[g]);this.load(c,n)}addModelsFromBucket(r,n){this.models[n]||(this.models[n]={});const c={};for(const g of r)this.hasModel(g,n)?this.models[n][g].numReferences++:c[g]=this.requestManager.normalizeModelURL(g);this.load(c,n)}removeModel(r,n){if(this.models[n]&&this.models[n][r]&&(this.models[n][r].numReferences--,this.models[n][r].numReferences===0)){const c=this.models[n][r].model;delete this.models[n][r],c.destroy()}}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,n){this.models[n]||(this.models[n]={});for(const c in this.models[n])this.models[n][c].model&&this.models[n][c].model.upload(r.context)}}const dm=new t.a5({data:new t.a6(t.a3.colorTheme.data)}),$c={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Xf(u){return u=u||{},Object.assign(u,$c)}class Yf extends t.E{constructor(r){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},t.aP(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=r,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(r=>{r.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new t.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=r.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=r.stylesheet.indoor.buildingFeaturesetId,this._scope=r.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:r=>(r.feature&&r.feature.properties.floorplan&&this.selectFloorplan(r.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(r){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(L,q){const[K,ne]=L,{center:ae,radius:he}=q,[fe,Te]=ae,Ve=Math.abs(K-fe);return Math.sqrt((Ve>180?360-Ve:Ve)**2+(ne-Te)**2)<=he}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new t.z("floorplangone")));const n={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},c=new t.P(this._map.transform.width/2,this._map.transform.height/2),g=[new t.P(0,0),new t.P(this._map.transform.width,this._map.transform.height)],M=this._map.queryRenderedFeatures(r?g:c,n);M.length>0&&(this._selectedFloorplan&&M[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=M[0],this._floorplanSelected(!1)))}_floorplanSelected(r){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(M){const[[L,q],[K,ne]]=M,ae=(K-L+360)%360,he=ae>180?360-ae:ae;return{center:[(L+he/2+360)%360,(q+ne)/2],radius:Math.sqrt(he**2+(ne-q)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const n=this._floorplanStates[this._indoorData.id].selectedBuilding,c=this._floorplanStates[this._indoorData.id].selectedLevel;let g;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const M of this._indoorData.levels)M.id===this._selectedLevel.id&&(g=M.id);if(this.fire(new t.z("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:g})),n){const M=this._indoorData.buildings.find(L=>L.id===n);this._buildingSelected(M,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(c){const M=this._indoorData.levels.find(L=>L.id===c);this._updateLevels(M,r)}else r&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(r,n){n&&r&&r.extent&&this._map.fitBounds(r.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=r?r.id:void 0;const c=this._indoorData.levels.filter(g=>r.levels.includes(g.id));this.fire(new t.z("buildingselected",{buildingId:r.id,levels:c}))}_levelSelected(r){if(r==="overview")this._updateLevels(void 0,!0);else{const n=this._indoorData.levels.find(c=>c.id===r);this._updateLevels(n,!0)}this.fire(new t.z("levelselected",{levelId:r==="overview"?void 0:r}))}_updateLevels(r,n){if(!r)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(n&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function c(ne){const ae=ne.indexOf("/floor/");if(ae===-1)return ne;const he=ae+7,fe=ne.indexOf("/",he);return fe===-1?ne.slice(he):ne.slice(he,fe)}this._selectedLevel=r,this._floorplanStates[this._indoorData.id].selectedLevel=r?r.id:void 0;const g=[],M={},L={},q={},K={};for(const ne of this._indoorData.levels)if(g.push(ne.id),M[ne.id]=ne.height,L[ne.id]=ne.base,r){if(this.mergeFloors){const ae=c(r.id),he=c(ne.id);q[ne.id]=he===ae?"true":"false"}else q[ne.id]=ne.id===r.id?"true":"false";K[ne.id]=ne.base<r.base?"true":"false"}else K[ne.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",g]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",M]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",L]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",q]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",K]),r&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!r.isUnderground),n&&r.extent)){const ne=this._map.cameraForBounds(r.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),ae=this._map.getZoom(),he=ne.zoom?Math.abs(ae-ne.zoom):0;this._map.fitBounds(r.extent,he>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:ae})}}selectFloorplan(r){const n={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},c=[new t.P(0,0),new t.P(this._map.transform.width,this._map.transform.height)],g=this._map.queryRenderedFeatures(c,n);if(g.length>0){for(const M of g)if(JSON.parse(M.properties["indoor-data"]).floorplanIDs.includes(r)){this._selectedFloorplan=M,this._floorplanSelected(!0);break}}}selectBuilding(r){const n=this._indoorData.buildings.find(c=>c.id===r);this._buildingSelected(n,!0)}selectLevel(r){this._levelSelected(r)}}function Kf(u){if(!u.metadata||!u.metadata.content_area)return;const r=t.q.devicePixelRatio,{left:n,top:c,width:g,height:M}=u.metadata.content_area,L=n*r,q=c*r;return[L,q,L+g*r,q+M*r]}function Cu(u){if(u)return u.map(([r,n])=>[r*t.q.devicePixelRatio,n*t.q.devicePixelRatio])}const Jo=(u,r)=>mt(u,r&&r.filter(n=>n.identifier!=="source.canvas")),pm=t.ay(Ti,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),mm=t.ay(Ti,["setCenter","setZoom","setBearing","setPitch"]),Zc=new Set(["background","sky","slot","custom"]),Xc={version:8,layers:[],sources:{}},Jf={duration:300,delay:0};class na extends t.E{constructor(r,n={}){super(),this.map=r,this.scope=n.scope||"",this.globalId=null,this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=t.l({},Jf),this._buildingIndex=new am(this),this.crossTileSymbolIndex=new $f,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new tt,this.dispatcher=n.dispatcher?n.dispatcher:new t.D(t.ci(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new We(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new t.cj(r._requestManager,n.localFontFamily?t.ck.all:n.localIdeographFontFamily?t.ck.ideographs:t.ck.none,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new fm(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=n.configOptions?n.configOptions:new Map,this._configDependentLayers=n.configDependentLayers?n.configDependentLayers:new Set,this._config=n.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:n.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=n.initialConfig,this.dispatcher.broadcast("setReferrer",t.cl());const c=this;this._rtlTextPluginCallback=na.registerForPluginStateChange(g=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(M,L)=>{if(t.cm(M),L&&L.every(q=>q))for(const q in c._sourceCaches){const K=c._sourceCaches[q],ne=K.getSource().type;ne!=="vector"&&ne!=="geojson"||K.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const M=this.getOwnSource(g.sourceId);if(M&&M.vectorLayerIds)for(const L in this._layers){const q=this._layers[L];q.source===M.id&&this._validateLayer(q)}})}load(r){return r?(typeof r=="string"?this.loadURL(r):this.loadJSON(r),this):this}_getGlobalId(r){if(!r)return null;if(typeof r=="string"){if(t.f(r))return r;const n=t.cn(r);if(!n.startsWith("http"))try{return new URL(n,location.href).toString()}catch{return n}return n}return`json://${t.co(JSON.stringify(r))}`}_diffStyle(r,n,c){this.globalId=this._getGlobalId(r);const g=(M,L)=>{try{L(null,this.setState(M,c))}catch(q){L(q,!1)}};if(typeof r=="string"){const M=this.map._requestManager.normalizeStyleURL(r),L=this.map._requestManager.transformRequest(M,t.R.Style);t.n(L,(q,K)=>{q?this.fire(new t.y(q)):K&&g(K,n)})}else typeof r=="object"&&g(r,n)}loadURL(r,n={}){this.fire(new t.z("dataloading",{dataType:"style"}));const c=typeof n.validate=="boolean"?n.validate:!t.f(r);this.globalId=this._getGlobalId(r),r=this.map._requestManager.normalizeStyleURL(r,n.accessToken),this.resolvedImports.add(r);const g=this.importsCache.get(r);if(g)return this._load(g,c);const M=this.map._requestManager.transformRequest(r,t.R.Style);this._request=t.n(M,(L,q)=>{if(this._request=null,L)this.fire(new t.y(L));else if(q)return this.importsCache.set(r,q),this._load(q,c)})}loadJSON(r,n={}){this.fire(new t.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(r),this._request=t.q.frame(()=>{this._request=null,this._load(r,n.validate!==!1)})}loadEmpty(){this.fire(new t.z("dataloading",{dataType:"style"})),this._load(Xc,!1)}_loadImports(r,n,c){if(this.importDepth>=4)return t.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const g=[];for(const M of r){const L=this._createFragmentStyle(M),q=new Promise(ae=>{L.once("style.import.load",ae),L.once("error",ae)}).then(()=>this.mergeAll());if(g.push(q),this.resolvedImports.has(M.url)){L.loadEmpty();continue}const K=M.data||this.importsCache.get(M.url);K?(L.loadJSON(K,{validate:n}),this._isInternalStyle(K)&&(L.globalId=null)):M.url?L.loadURL(M.url,{validate:n}):L.loadEmpty();const ne={style:L,id:M.id,config:M.config};if(c){const ae=this.fragments.findIndex(({id:he})=>he===c);this.fragments=this.fragments.slice(0,ae).concat(ne).concat(this.fragments.slice(ae))}else this.fragments.push(ne)}return Promise.allSettled(g)}getImportGlobalIds(r=this,n=new Set){for(const c of r.fragments)c.style.globalId&&n.add(c.style.globalId),this.getImportGlobalIds(c.style,n);return[...n.values()]}_createFragmentStyle(r){const n=this.scope?t.aC(r.id,this.scope):r.id;let c;const g=this._initialConfig&&this._initialConfig[n];(r.config||g)&&(c=t.l({},r.config,g));const M=new na(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:c,configOptions:this.options,colorThemeOverride:r["color-theme"],configDependentLayers:this._configDependentLayers});return M.setEventedParent(this.map,{style:M}),M}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(r){return this.isRootStyle()&&(r.fragment||!!r.schema&&r.fragment!==!1)}_load(r,n){const c=r.indoor?Xf(r.schema):r.schema;if(this._isInternalStyle(r)){const L=t.l({},Xc,{imports:[{id:"basemap",data:r,url:""}]});return void this._load(L,n)}if(this.updateConfig(this._config,c),n&&Jo(this,Rt(r)))return;this._loaded=!0,this.stylesheet=t.cp(r);const g=()=>{for(const ne in r.sources)this.addSource(ne,r.sources[ne],{validate:!1,isInitialLoad:!0});r.sprite?this._loadIconset(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(r.glyphs,this.scope);const L=Hc(this.stylesheet.layers);if(this._order=L.map(ne=>ne.id),this.stylesheet.light&&t.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const ne=this.stylesheet.lights[0];this.light=new Bt(ne.properties,ne.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Bt(this.stylesheet.light)),this._layers={};for(const ne of L){const ae=t.cu(ne,this.scope,this._styleColorTheme.lut,this.options);ae.configDependencies.size!==0&&this._configDependentLayers.add(ae.fqid),ae.setEventedParent(this,{layer:{id:ae.id}}),this._layers[ae.id]=ae;const he=this.getOwnLayerSourceCache(ae),fe=!!this.directionalLight&&this.directionalLight.shadowsEnabled();he&&ae.canCastShadows()&&fe&&(he.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const q=this.stylesheet.terrain;q&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(q,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new t.z("data",{dataType:"style"}));const K=this.isRootStyle();r.imports?this._loadImports(r.imports,n).then(()=>{this._reloadImports(),this.fire(new t.z(K?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new t.z(K?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const M=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(M){const L=this._evaluateColorThemeData(M);this._loadColorTheme(L).then(()=>{g()}).catch(q=>{t.w(`Couldn't load color theme from the stylesheet: ${q}`),g()})}else this._styleColorTheme.lut=null,g()}isRootStyle(){return this.importDepth===0}mergeAll(){let r,n,c,g,M,L,q,K,ne,ae;const he={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(fe=>{if(fe.stylesheet){if(fe.light!=null&&(r=fe.light),fe.stylesheet.lights)for(const Te of fe.stylesheet.lights)Te.type==="ambient"&&fe.ambientLight!=null&&(n=fe.ambientLight),Te.type==="directional"&&fe.directionalLight!=null&&(c=fe.directionalLight);g=this._prioritizeTerrain(g,fe.terrain,fe.stylesheet.terrain),fe.stylesheet.fog&&fe.fog!=null&&(M=fe.fog),fe.stylesheet.snow&&fe.snow!=null&&(L=fe.snow),fe.stylesheet.rain&&fe.rain!=null&&(q=fe.rain),fe.stylesheet.camera!=null&&(ae=fe.stylesheet.camera),fe.stylesheet.projection!=null&&(K=fe.stylesheet.projection),fe.stylesheet.transition!=null&&(ne=fe.stylesheet.transition),he[fe.scope]=fe._styleColorTheme}}),this.light=r,this.ambientLight=n,this.directionalLight=c,this.fog=M,this.snow=L,this.rain=q,this._styleColorThemeForScope=he,g===null?delete this.terrain:this.terrain=g,this.camera=ae||{"camera-projection":"perspective"},this.projection=K||{name:"mercator"},this.transition=t.l({},Jf,ne),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(r){const n=c=>{for(const g of c.fragments)n(g.style);r(c)};n(this)}_prioritizeTerrain(r,n,c){const g=r&&r.drapeRenderMode===0;return c===null?n&&n.drapeRenderMode===0?n:g?r:null:n!=null&&(!r||g||n&&n.drapeRenderMode===1)?n:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(n=>{r=this._prioritizeTerrain(r,n.terrain,n.stylesheet.terrain)}),r===null?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle(n=>{n.stylesheet.projection!=null&&(r=n.stylesheet.projection)}),this.projection=r||{name:"mercator"}}mergeSources(){const r={},n={},c={};this.forEachFragmentStyle(g=>{for(const M in g._sourceCaches){const L=t.aC(M,g.scope);r[L]=g._sourceCaches[M]}for(const M in g._otherSourceCaches){const L=t.aC(M,g.scope);n[L]=g._otherSourceCaches[M]}for(const M in g._symbolSourceCaches){const L=t.aC(M,g.scope);c[L]=g._symbolSourceCaches[M]}}),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=c}mergeLayers(){const r={},n=[],c={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(M=>{for(const L of M._order){const q=M._layers[L];if(q.type==="slot"){const K=t.cq(L);if(r[K])continue;r[K]=[]}q.slot&&r[q.slot]?r[q.slot].push(q):n.push(q)}}),this._mergedOrder=[];const g=(M=[])=>{for(const L of M)if(L.type==="slot"){const q=t.cq(L.id);r[q]&&g(r[q]),this._mergedSlots.push(q)}else{const q=t.aC(L.id,L.scope);this._mergedOrder.push(q),c[q]=L,L.is3D()&&(this._has3DLayers=!0),L.type==="circle"&&(this._hasCircleLayers=!0),L.type==="symbol"&&(this._hasSymbolLayers=!0),L.type==="clip"&&(this._clipLayerPresent=!0)}};g(n),this._mergedOrder.sort((M,L)=>{const q=c[M],K=c[L];return q.hasInitialOcclusionOpacityProperties?K.is3D()?1:0:q.is3D()&&K.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=c,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=t.l({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(r){return r.data?function(n,c,g){const M=t.l({},c);for(const q of Object.keys(t.a3.colorTheme))M[q]===void 0&&(M[q]=t.a3.colorTheme[q].default);const L=new t.a4(dm,n,new Map(g));return L.setTransitionOrValue(M,g),L.untransitioned().possiblyEvaluate(new t.a8(0))}(this.scope,r,this.options).get("data"):null}_loadColorTheme(r){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const n=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((c,g)=>{const M="data:image/png;base64,";if(!r||r.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void c();let L=r;L.startsWith(M)||(L=M+L);const q="mapbox-reserved-lut",K=new Image;K.src=L,K.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},K.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==n)return void c();this._styleColorTheme.lutLoading=!1;const{width:ne,height:ae,data:he}=t.q.getImageData(K);if(ae>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(ne!==ae*ae)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(q)&&this.removeImage(q),this.addImage(q,{data:new t.r({width:ne,height:ae},he),pixelRatio:1,sdf:!1,usvg:!1,version:0});const fe=this.imageManager.getImage(q,this.scope);fe?(this._styleColorTheme.lut={image:fe.data,data:r},c()):g(new Error("Missing LUT image."))}})}getLut(r){const n=this._styleColorThemeForScope[r];return n?n.lut:null}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=function(n,c,g){let M,L,q;const K=t.q.devicePixelRatio>1?"@2x":"";let ne=t.n(c.transformRequest(c.normalizeSpriteURL(n,K,".json"),t.R.SpriteJSON),(fe,Te)=>{ne=null,q||(q=fe,M=Te,he())}),ae=t.o(c.transformRequest(c.normalizeSpriteURL(n,K,".png"),t.R.SpriteImage),(fe,Te)=>{ae=null,q||(q=fe,L=Te,he())});function he(){if(q)g(q);else if(M&&L){const fe=t.q.getImageData(L),Te={};for(const Ve in M){const{width:je,height:Xe,x:Ye,y:at,sdf:pt,pixelRatio:ft,stretchX:bt,stretchY:gt,content:vt}=M[Ve],yt=new t.r({width:je,height:Xe});t.r.copy(fe,yt,{x:Ye,y:at},{x:0,y:0},{width:je,height:Xe},null),Te[Ve]={data:yt,pixelRatio:ft,sdf:pt,stretchX:bt,stretchY:gt,content:vt,usvg:!1}}g(null,Te)}}return{cancel(){ne&&(ne.cancel(),ne=null),ae&&(ae.cancel(),ae=null)}}}(r,this.map._requestManager,(n,c)=>{if(this._spriteRequest=null,n)this.fire(new t.y(n));else if(c)for(const g in c)this.imageManager.addImage(g,this.scope,c[g]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new t.z("data",{dataType:"style"}))})}_loadIconset(r){if(!t.f(r)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(r);const n=this.map._spriteFormat==="auto";var c,g;this._spriteRequest=(g=(M,L)=>{if(this._spriteRequest=null,M)n?this._loadSprite(r):this.fire(new t.y(M));else if(L)for(const q in L)this.imageManager.addImage(q,this.scope,L[q]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new t.z("data",{dataType:"style"}))},t.bi((c=this.map._requestManager).transformRequest(c.normalizeIconsetURL(r),t.R.Iconset),(M,L)=>{if(M)return void g(M);const q={},K=t.cg(new t.bh(L));for(const ne of K.icons){const ae={version:1,pixelRatio:t.q.devicePixelRatio,content:Kf(ne),stretchX:ne.metadata?Cu(ne.metadata.stretch_x_areas):void 0,stretchY:ne.metadata?Cu(ne.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:ne};q[ne.name]=ae}g(null,q)}))}_validateLayer(r){const n=this.getOwnSource(r.source);if(!n)return;const c=r.sourceLayer;c&&(n.type==="geojson"||n.vectorLayerIds&&n.vectorLayerIds.indexOf(c)===-1)&&this.fire(new t.y(new Error(`Source layer "${c}" does not exist on source "${n.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((r,n)=>{const c=this.fragments[n];return c&&c.style&&(r.data=c.style.serialize()),r})}_serializeSources(){const r={};for(const n in this._sourceCaches){const c=this._sourceCaches[n].getSource();r[c.id]||(r[c.id]=c.serialize())}return r}_serializeLayers(r){const n=[];for(const c of r){const g=this._layers[c];g&&g.type!=="custom"&&n.push(g.serialize())}return n}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(r){return r?this.order:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&r.isDraped(this.getLayerSourceCache(r))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){const n=this.getOwnLayer(r);if(n)return n;this.fire(new t.y(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){const n=this.getOwnSource(r);if(n)return n;this.fire(new t.y(new Error(`The source '${r}' does not exist in the map's style.`)))}precompilePrograms(r,n){const c=this.map.painter;if(c)for(let g=r.minzoom||0;g<(r.maxzoom||25.5);g++){const M=r.getProgramIds();if(M)for(const L of M){const q=r.getDefaultProgramParams(L,n.zoom,this._styleColorTheme.lut);q&&(c.style=this,this.fog&&(c._fogVisible=!0,q.overrideFog=!0,c.getOrCreateProgram(L,q)),c._fogVisible=!1,q.overrideFog=!1,c.getOrCreateProgram(L,q),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(q.overrideRtt=!0,c.getOrCreateProgram(L,q)))}}}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);const n=this.calculateLightsBrightness();r.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n));const c=this._changes.isDirty();let g=!1;if(this._changes.isDirty()){const L=this._changes.getLayerUpdatesByScope();for(const q in L){const{updatedIds:K,removedIds:ne}=L[q];(K||ne)&&(this._updateWorkerLayers(q,K,ne),g=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this.snow&&this.snow.updateTransitions(r),this.rain&&this.rain.updateTransitions(r),this._changes.reset()}const M={};for(const L in this._mergedSourceCaches){const q=this._mergedSourceCaches[L];M[L]=q.used,q.used=!1,q.tileCoverLift=0}for(const L of this._mergedOrder){const q=this._mergedLayers[L];if(q.recalculate(r,this._availableImages),!q.isHidden(r.zoom)){const K=this.getLayerSourceCache(q);K&&(K.used=!0,K.tileCoverLift=Math.max(K.tileCoverLift,q.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(q,r)}):this.precompilePrograms(q,r))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&g&&this.mergeLayers();for(const L in M){const q=this._mergedSourceCaches[L];M[L]!==q.used&&q.getSource().fire(new t.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:q.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.snow&&this.snow.recalculate(r),this.rain&&this.rain.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new t.z("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=this._changes.getUpdatedImages();if(r.length){for(const n in this._sourceCaches)this._sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],r);this._changes.resetUpdatedImages()}}_updateWorkerLayers(r,n,c){const g=this.getFragmentStyle(r);g&&this.dispatcher.broadcast("updateLayers",{layers:n?g._serializeLayers(n):[],scope:r,removedIds:c||[],options:g.options})}setState(r,n){if(this._checkLoaded(),Jo(this,Rt(r)))return!1;(r=t.cp(r)).layers=Hc(r.layers);const c=function(L,q){if(!L)return[{command:Ti.setStyle,args:[q]}];let K=[];try{if(!t.bn(L.version,q.version))return[{command:Ti.setStyle,args:[q]}];if(t.bn(L.center,q.center)||K.push({command:Ti.setCenter,args:[q.center]}),t.bn(L.zoom,q.zoom)||K.push({command:Ti.setZoom,args:[q.zoom]}),t.bn(L.bearing,q.bearing)||K.push({command:Ti.setBearing,args:[q.bearing]}),t.bn(L.pitch,q.pitch)||K.push({command:Ti.setPitch,args:[q.pitch]}),t.bn(L.sprite,q.sprite)||K.push({command:Ti.setSprite,args:[q.sprite]}),t.bn(L.glyphs,q.glyphs)||K.push({command:Ti.setGlyphs,args:[q.glyphs]}),t.bn(L.imports,q.imports)||function(Te=[],Ve=[],je){Ve=Ve||[];const Xe=(Te=Te||[]).map(Ci),Ye=Ve.map(Ci),at=Te.reduce(Si,{}),pt=Ve.reduce(Si,{}),ft=Xe.slice();let bt,gt,vt,yt;for(bt=0,gt=0;bt<Xe.length;bt++)vt=Xe[bt],pt.hasOwnProperty(vt)?gt++:(je.push({command:Ti.removeImport,args:[vt]}),ft.splice(ft.indexOf(vt,gt),1));for(bt=0,gt=0;bt<Ye.length;bt++)vt=Ye[Ye.length-1-bt],ft[ft.length-1-bt]!==vt&&(at.hasOwnProperty(vt)?(je.push({command:Ti.removeImport,args:[vt]}),ft.splice(ft.lastIndexOf(vt,ft.length-gt),1)):gt++,yt=ft[ft.length-bt],je.push({command:Ti.addImport,args:[pt[vt],yt]}),ft.splice(ft.length-bt,0,vt));for(const Tt of Ve){const Dt=at[Tt.id];Dt&&!t.bn(Dt,Tt)&&je.push({command:Ti.updateImport,args:[Tt.id,Tt]})}}(L.imports,q.imports,K),t.bn(L.transition,q.transition)||K.push({command:Ti.setTransition,args:[q.transition]}),t.bn(L.light,q.light)||K.push({command:Ti.setLight,args:[q.light]}),t.bn(L.fog,q.fog)||K.push({command:Ti.setFog,args:[q.fog]}),t.bn(L.snow,q.snow)||K.push({command:Ti.setSnow,args:[q.snow]}),t.bn(L.rain,q.rain)||K.push({command:Ti.setRain,args:[q.rain]}),t.bn(L.projection,q.projection)||K.push({command:Ti.setProjection,args:[q.projection]}),t.bn(L.lights,q.lights)||K.push({command:Ti.setLights,args:[q.lights]}),t.bn(L.camera,q.camera)||K.push({command:Ti.setCamera,args:[q.camera]}),!t.bn(L["color-theme"],q["color-theme"]))return[{command:Ti.setStyle,args:[q]}];const ne={},ae=[];(function(Te,Ve,je,Xe){let Ye;for(Ye in Ve=Ve||{},Te=Te||{})Te.hasOwnProperty(Ye)&&(Ve.hasOwnProperty(Ye)||va(Ye,je,Xe));for(Ye in Ve){if(!Ve.hasOwnProperty(Ye))continue;const at=Ve[Ye];Te.hasOwnProperty(Ye)?t.bn(Te[Ye],at)||(Te[Ye].type==="geojson"&&at.type==="geojson"&&Ss(Te,Ve,Ye)?je.push({command:Ti.setGeoJSONSourceData,args:[Ye,at.data]}):qc(Ye,Ve,je,Xe)):_u(Ye,Ve,je)}})(L.sources,q.sources,ae,ne);const he=[];L.layers&&L.layers.forEach(Te=>{Te.source&&ne[Te.source]?K.push({command:Ti.removeLayer,args:[Te.id]}):he.push(Te)});let fe=L.terrain;fe&&ne[fe.source]&&(K.push({command:Ti.setTerrain,args:[void 0]}),fe=void 0),K=K.concat(ae),t.bn(fe,q.terrain)||K.push({command:Ti.setTerrain,args:[q.terrain]}),function(Te,Ve,je){Ve=Ve||[];const Xe=(Te=Te||[]).map(Ci),Ye=Ve.map(Ci),at=Te.reduce(Si,{}),pt=Ve.reduce(Si,{}),ft=Xe.slice(),bt=Object.create(null);let gt,vt,yt,Tt,Dt,Zt,Ht;for(gt=0,vt=0;gt<Xe.length;gt++)yt=Xe[gt],pt.hasOwnProperty(yt)?vt++:(je.push({command:Ti.removeLayer,args:[yt]}),ft.splice(ft.indexOf(yt,vt),1));for(gt=0,vt=0;gt<Ye.length;gt++)yt=Ye[Ye.length-1-gt],ft[ft.length-1-gt]!==yt&&(at.hasOwnProperty(yt)?(je.push({command:Ti.removeLayer,args:[yt]}),ft.splice(ft.lastIndexOf(yt,ft.length-vt),1)):vt++,Zt=ft[ft.length-gt],je.push({command:Ti.addLayer,args:[pt[yt],Zt]}),ft.splice(ft.length-gt,0,yt),bt[yt]=!0);for(gt=0;gt<Ye.length;gt++)if(yt=Ye[gt],Tt=at[yt],Dt=pt[yt],!bt[yt]&&!t.bn(Tt,Dt))if(t.bn(Tt.source,Dt.source)&&t.bn(Tt["source-layer"],Dt["source-layer"])&&t.bn(Tt.type,Dt.type)){for(Ht in Rr(Tt.layout,Dt.layout,je,yt,null,Ti.setLayoutProperty),Rr(Tt.paint,Dt.paint,je,yt,null,Ti.setPaintProperty),t.bn(Tt.slot,Dt.slot)||je.push({command:Ti.setSlot,args:[yt,Dt.slot]}),t.bn(Tt.filter,Dt.filter)||je.push({command:Ti.setFilter,args:[yt,Dt.filter]}),t.bn(Tt.minzoom,Dt.minzoom)&&t.bn(Tt.maxzoom,Dt.maxzoom)||je.push({command:Ti.setLayerZoomRange,args:[yt,Dt.minzoom,Dt.maxzoom]}),Tt)Tt.hasOwnProperty(Ht)&&Ht!=="layout"&&Ht!=="paint"&&Ht!=="filter"&&Ht!=="metadata"&&Ht!=="minzoom"&&Ht!=="maxzoom"&&Ht!=="slot"&&(Ht.indexOf("paint.")===0?Rr(Tt[Ht],Dt[Ht],je,yt,Ht.slice(6),Ti.setPaintProperty):t.bn(Tt[Ht],Dt[Ht])||je.push({command:Ti.setLayerProperty,args:[yt,Ht,Dt[Ht]]}));for(Ht in Dt)Dt.hasOwnProperty(Ht)&&!Tt.hasOwnProperty(Ht)&&Ht!=="layout"&&Ht!=="paint"&&Ht!=="filter"&&Ht!=="metadata"&&Ht!=="minzoom"&&Ht!=="maxzoom"&&Ht!=="slot"&&(Ht.indexOf("paint.")===0?Rr(Tt[Ht],Dt[Ht],je,yt,Ht.slice(6),Ti.setPaintProperty):t.bn(Tt[Ht],Dt[Ht])||je.push({command:Ti.setLayerProperty,args:[yt,Ht,Dt[Ht]]}))}else je.push({command:Ti.removeLayer,args:[yt]}),Zt=ft[ft.lastIndexOf(yt)+1],je.push({command:Ti.addLayer,args:[Dt,Zt]})}(he,q.layers,K)}catch(ne){console.warn("Unable to compute style diff:",ne),K=[{command:Ti.setStyle,args:[q]}]}return K}(this.serialize(),r).filter(L=>!(L.command in mm));if(c.length===0)return!1;const g=c.filter(L=>!(L.command in pm));if(g.length>0)throw new Error(`Unimplemented: ${g.map(L=>L.command).join(", ")}.`);const M=[];return c.forEach(L=>{M.push(this[L.command].apply(this,L.args))}),n&&Promise.all(M).then(n),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(r,n){return this.getImage(r)?this.fire(new t.y(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,this.scope,n),this._afterImageUpdated(r),this)}updateImage(r,n,c=!1){this.imageManager.updateImage(r,this.scope,n),c&&this._afterImageUpdated(r)}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._afterImageUpdated(r),this):this.fire(new t.y(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(r),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new t.z("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(r,n,c={}){return this._checkLoaded(),this._validate(Ze,`models.${r}`,n,null,c)||(this.modelManager.addModel(r,n,this.scope),this._changes.setDirty()),this}hasModel(r){return this.modelManager.hasModel(r,this.scope)}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.scope),this):this.fire(new t.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(r,n,c={}){if(this._checkLoaded(),this.getOwnSource(r)!==void 0)throw new Error(`There is already a source with ID "${r}".`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate($t,`sources.${r}`,n,null,c))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const g=To(r,n,this.dispatcher,this);g.scope=this.scope,g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(g.id),source:g.serialize(),sourceId:g.id}));const M=L=>{const q=(L?"symbol:":"other:")+g.id,K=t.aC(q,this.scope),ne=this._sourceCaches[q]=new ya(K,g,L);(L?this._symbolSourceCaches:this._otherSourceCaches)[g.id]=ne,ne.onAdd(this.map)};M(!1),n.type!=="vector"&&n.type!=="geojson"||M(!0),g.onAdd&&g.onAdd(this.map),c.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();const n=this.getOwnSource(r);if(!n)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===r)return this.fire(new t.y(new Error(`Source "${r}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new t.y(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const c=this.getOwnSourceCaches(r);for(const g of c){const M=t.cq(g.id);delete this._sourceCaches[M],this._changes.discardSourceCacheUpdate(g.id),g.fire(new t.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,n){this._checkLoaded(),this.getOwnSource(r).setData(n),this._changes.setDirty()}getOwnSource(r){const n=this.getOwnSourceCache(r);return n&&n.getSource()}getOwnSources(){const r=[];for(const n in this._otherSourceCaches){const c=this.getOwnSourceCache(n);c&&r.push(c.getSource())}return r}areTilesLoaded(){const r=this._mergedSourceCaches;for(const n in r){const c=r[n]._tiles;for(const g in c){const M=c[g];if(M.state!=="loaded"&&M.state!=="errored")return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const g of r){if(this._validate(sr,"lights",g))return;switch(g.type){case"ambient":if(this.ambientLight){const M=this.ambientLight;M.set(g),M.updateTransitions(n)}else this.ambientLight=new en(g,Wr||(Wr=new t.a5({color:new t.a6(t.a3.properties_light_ambient.color),"color-use-theme":new t.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new t.a6(t.a3.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const M=this.directionalLight;M.set(g),M.updateTransitions(n)}else this.directionalLight=new en(g,Pi||(Pi=new t.a5({direction:new t.ak(t.a3.properties_light_directional.direction),color:new t.a6(t.a3.properties_light_directional.color),"color-use-theme":new t.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new t.a6(t.a3.properties_light_directional.intensity),"cast-shadows":new t.a6(t.a3.properties_light_directional["cast-shadows"]),"shadow-quality":new t.a6(t.a3.properties_light_directional["shadow-quality"]),"shadow-intensity":new t.a6(t.a3.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const c=new t.a8(this.z||0,n);this.ambientLight&&this.ambientLight.recalculate(c),this.directionalLight&&this.directionalLight.recalculate(c),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const r=this.directionalLight,n=this.ambientLight;if(!r||!n)return;const c=fe=>.2126*(fe[0]<=.03928?fe[0]/12.92:Math.pow((fe[0]+.055)/1.055,2.4))+.7152*(fe[1]<=.03928?fe[1]/12.92:Math.pow((fe[1]+.055)/1.055,2.4))+.0722*(fe[2]<=.03928?fe[2]/12.92:Math.pow((fe[2]+.055)/1.055,2.4)),g=r.properties.get("color").toRenderColor(null).toArray01(),M=r.properties.get("intensity"),L=r.properties.get("direction"),q=1-t.cb(L.x,L.y,L.z)[2]/90,K=c(g)*M*q,ne=n.properties.get("color").toRenderColor(null).toArray01(),ae=n.properties.get("intensity"),he=c(ne)*ae;return Number(((K+he)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(!r)return this;if(t.cr(r)){const n=t.cs(r),c=this.fragments.find(({id:M})=>M===n);if(!c)throw new Error(`Style import '${r}' not found`);const g=t.cq(r);return c.style.getFragmentStyle(g)}{const n=this.fragments.find(({id:c})=>c===r);if(!n)throw new Error(`Style import '${r}' not found`);return n.style}}setFeaturesetSelectors(r){if(!r)return;const n={},c=(g,M="")=>`${g}::${M}`;this.featuresetSelectors={};for(const g in r){const M=this.featuresetSelectors[g]=[];for(const L of r[g].selectors){if(L.featureNamespace){const K=this.getOwnLayer(L.layer);if(!K){t.w(`Layer is undefined for selector: ${L.layer}`);continue}const ne=c(K.source,K.sourceLayer);if(ne in n&&n[ne]!==L.featureNamespace){t.w(`"featureNamespace ${L.featureNamespace} of featureset ${g}'s selector is not associated to the same source, skip this selector`);continue}n[ne]=L.featureNamespace}let q;if(L.properties)for(const K in L.properties){const ne=t.U(L.properties[K]);ne.result==="success"&&(q=q||{},q[K]=ne.value)}M.push({layerId:L.layer,namespace:L.featureNamespace,properties:q})}}}getFeaturesetDescriptors(r){const n=this.getFragmentStyle(r);if(!n||!n.stylesheet.featuresets)return[];const c=[];for(const g in n.stylesheet.featuresets)c.push({featuresetId:g,importId:n.scope?n.scope:void 0});return c}getFeaturesetLayers(r,n){const c=this.getFragmentStyle(n),g=c.stylesheet.featuresets;if(!g||!g[r])return this.fire(new t.y(new Error(`The featureset '${r}' does not exist in the map's style and cannot be queried.`))),[];const M=[];for(const L of g[r].selectors){const q=c.getOwnLayer(L.layer);q&&M.push(q)}return M}getConfigProperty(r,n){const c=this.getFragmentStyle(r);if(!c)return null;const g=t.aC(n,c.scope),M=c.options.get(g),L=M?M.value||M.default:null;return L?L.serialize():null}setConfigProperty(r,n,c){const g=this.getFragmentStyle(r);if(!g)return;const M=g.stylesheet.indoor?Xf(g.stylesheet.schema):g.stylesheet.schema;if(!M||!M[n])return;const L=t.U(c);if(L.result!=="success")return void Jo(this,L.value);const q=L.value.expression,K=t.aC(n,g.scope),ne=g.options.get(K);if(!ne)return;let ae;const{minValue:he,maxValue:fe,stepValue:Te,type:Ve,values:je}=M[n],Xe=t.U(M[n].default);Xe.result==="success"&&(ae=Xe.value.expression),ae?(this.options.set(K,{...ne,value:q,default:ae,minValue:he,maxValue:fe,stepValue:Te,type:Ve,values:je}),this.updateConfigDependencies(n)):this.fire(new t.y(new Error(`No schema defined for the config option "${n}" in the "${r}" fragment.`)))}getConfig(r){const n=this.getFragmentStyle(r);if(!n)return null;const c=n.stylesheet.schema;if(!c)return null;const g={};for(const M in c){const L=t.aC(M,n.scope),q=n.options.get(L),K=q?q.value||q.default:null;g[M]=K?K.serialize():null}return g}setConfig(r,n){const c=this.getFragmentStyle(r);c&&(c.updateConfig(n,c.stylesheet.schema),this.updateConfigDependencies())}getSchema(r){const n=this.getFragmentStyle(r);return n?n.stylesheet.schema:null}setSchema(r,n){const c=this.getFragmentStyle(r);c&&(c.stylesheet.schema=n,c.updateConfig(c._config,n),this.updateConfigDependencies())}updateConfig(r,n){if(this._config=r,r||n)if(n)for(const c in n){let g,M;const L=t.U(n[c].default);if(L.result==="success"&&(g=L.value.expression),r&&r[c]!==void 0){const fe=t.U(r[c]);fe.result==="success"&&(M=fe.value.expression)}const{minValue:q,maxValue:K,stepValue:ne,type:ae,values:he}=n[c];if(g){const fe=t.aC(c,this.scope);this.options.set(fe,{default:g,value:M,minValue:q,maxValue:K,stepValue:ne,type:ae,values:he})}else this.fire(new t.y(new Error(`No schema defined for config option "${c}".`)))}else this.fire(new t.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(r){for(const n of this._configDependentLayers){const c=this.getLayer(n);if(c){if(r&&!c.configDependencies.has(r))continue;c.possiblyEvaluateVisibility(),this._updateLayer(c)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(n=>{const c=n._styleColorTheme.colorThemeOverride?n._styleColorTheme.colorThemeOverride:n._styleColorTheme.colorTheme;if(c){const g=n._evaluateColorThemeData(c);(!n._styleColorTheme.lut&&g!==""||n._styleColorTheme.lut&&g!==n._styleColorTheme.lut.data)&&n.setColorTheme(c)}}),this._changes.setDirty()}addLayer(r,n,c={}){this._checkLoaded();const g=r.id;if(this._layers[g])return void this.fire(new t.y(new Error(`Layer with id "${g}" already exists on this map`)));let M;if(r.type==="custom"){if(Jo(this,t.ct(r)))return;M=t.cu(r,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof r.source=="object"&&(this.addSource(g,r.source),r=t.cp(r),r=t.l(r,{source:g})),this._validate(B,`layers.${g}`,r,{arrayIndex:-1},c))return;M=t.cu(r,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(M),M.setEventedParent(this,{layer:{id:g}})}M.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid);let L=this._order.length;if(n){const ae=this._order.indexOf(n);if(ae===-1)return void this.fire(new t.y(new Error(`Layer with id "${n}" does not exist on this map.`)));M.slot===this._layers[n].slot?L=ae:t.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(L,0,g),this._layerOrderChanged=!0,this._layers[g]=M;const q=this.getOwnLayerSourceCache(M),K=!!this.directionalLight&&this.directionalLight.shadowsEnabled();q&&M.canCastShadows()&&K&&(q.castsShadows=!0);const ne=this._changes.getRemovedLayer(M);if(ne&&M.source&&q&&M.type!=="custom"){this._changes.discardLayerRemoval(M);const ae=t.aC(M.source,M.scope);ne.type!==M.type?this._changes.updateSourceCache(ae,"clear"):(this._changes.updateSourceCache(ae,"reload"),q.pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map),M.scope=this.scope,this.mergeLayers()}moveLayer(r,n){this._checkLoaded();const c=this._checkLayer(r);if(!c||r===n)return;const g=this._order.indexOf(r);this._order.splice(g,1);let M=this._order.length;if(n){const L=this._order.indexOf(n);if(L===-1)return void this.fire(new t.y(new Error(`Layer with id "${n}" does not exist on this map.`)));c.slot===this._layers[n].slot?M=L:t.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(M,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();const n=this._checkLayer(r);if(!n)return;n.setEventedParent(null);const c=this._order.indexOf(r);this._order.splice(c,1),delete this._layers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(n.fqid),this._changes.removeLayer(n);const g=this.getOwnLayerSourceCache(n);if(g&&g.castsShadows){let M=!1;for(const L in this._layers)if(this._layers[L].source===n.source&&this._layers[L].canCastShadows()){M=!0;break}g.castsShadows=M}n.onRemove&&n.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(const n in this._layers)if(this._layers[n].type===r)return!0;return!1}setLayerZoomRange(r,n,c){this._checkLoaded();const g=this._checkLayer(r);g&&(g.minzoom===n&&g.maxzoom===c||(n!=null&&(g.minzoom=n),c!=null&&(g.maxzoom=c),this._updateLayer(g)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(r,n){this._checkLoaded();const c=this._checkLayer(r);c&&c.slot!==n&&(c.slot=n,this._updateLayer(c))}setFilter(r,n,c={}){this._checkLoaded();const g=this._checkLayer(r);if(g&&!t.bn(g.filter,n))return n==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(Q,`layers.${g.id}.filter`,n,{layerType:g.type},c)||(g.filter=t.cp(n),this._updateLayer(g)))}getFilter(r){const n=this._checkLayer(r);if(n)return t.cp(n.filter)}setLayoutProperty(r,n,c,g={}){this._checkLoaded();const M=this._checkLayer(r);if(M&&!t.bn(M.getLayoutProperty(n),c)){if(c!=null&&(!g||g.validate!==!1)&&Jo(M,Ne.call(Rt,{key:`layers.${r}.layout.${n}`,layerType:M.type,objectKey:n,value:c,styleSpec:t.a3,style:{glyphs:!0,sprite:!0}})))return;M.setLayoutProperty(n,c),M.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid),this._updateLayer(M)}}getLayoutProperty(r,n){const c=this._checkLayer(r);if(c)return c.getLayoutProperty(n)}setPaintProperty(r,n,c,g={}){this._checkLoaded();const M=this._checkLayer(r);if(!M||t.bn(M.getPaintProperty(n),c)||c!=null&&(!g||g.validate!==!1)&&Jo(M,xe.call(Rt,{key:`layers.${r}.paint.${n}`,layerType:M.type,objectKey:n,value:c,styleSpec:t.a3})))return;const L=M.setPaintProperty(n,c);M.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid),L&&this._updateLayer(M),this._changes.updatePaintProperties(M)}getPaintProperty(r,n){const c=this._checkLayer(r);if(c)return c.getPaintProperty(n)}setFeatureState(r,n){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:K,importId:ne}=r.target,ae=this.getFragmentStyle(ne),he=ae.getFeaturesetLayers(K);for(const{source:fe,sourceLayer:Te}of he)ae.setFeatureState({id:r.id,source:fe,sourceLayer:Te},n)}else if("layerId"in r.target){const{layerId:K}=r.target,ne=this.getLayer(K);this.setFeatureState({id:r.id,source:ne.source,sourceLayer:ne.sourceLayer},n)}return}const c=r.source,g=r.sourceLayer,M=this._checkSource(c);if(!M)return;const L=M.type;if(L==="geojson"&&g)return void this.fire(new t.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(L==="vector"&&!g)return void this.fire(new t.y(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new t.y(new Error("The feature id parameter must be provided.")));const q=this.getOwnSourceCaches(c);for(const K of q)K.setFeatureState(g,r.id,n)}removeFeatureState(r,n){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:K,importId:ne}=r.target,ae=this.getFragmentStyle(ne),he=ae.getFeaturesetLayers(K);for(const{source:fe,sourceLayer:Te}of he)ae.removeFeatureState({id:r.id,source:fe,sourceLayer:Te},n)}else if("layerId"in r.target){const{layerId:K}=r.target,ne=this.getLayer(K);this.removeFeatureState({id:r.id,source:ne.source,sourceLayer:ne.sourceLayer},n)}return}const c=r.source,g=this._checkSource(c);if(!g)return;const M=g.type,L=M==="vector"?r.sourceLayer:void 0;if(M==="vector"&&!L)return void this.fire(new t.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new t.y(new Error("A feature id is required to remove its specific state property.")));const q=this.getOwnSourceCaches(c);for(const K of q)K.removeFeatureState(L,r.id,n)}getFeatureState(r){if(this._checkLoaded(),"target"in r){let M;if("featuresetId"in r.target){const{featuresetId:L,importId:q}=r.target,K=this.getFragmentStyle(q),ne=K.getFeaturesetLayers(L);for(const{source:ae,sourceLayer:he}of ne){const fe=K.getFeatureState({id:r.id,source:ae,sourceLayer:he});if(fe&&!M)M=fe;else if(!t.bn(M,fe))return void this.fire(new t.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in r.target){const{layerId:L}=r.target,q=this.getLayer(L);M=this.getFeatureState({id:r.id,source:q.source,sourceLayer:q.sourceLayer})}return M}const n=r.source,c=r.sourceLayer,g=this._checkSource(n);if(g){if(g.type!=="vector"||c)return r.id===void 0&&this.fire(new t.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(c,r.id);this.fire(new t.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=t.l({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return t.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const r=this.getTerrain(),n=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return t.cv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},c=>c!==void 0)}_updateFilteredLayers(r){for(const n of Object.values(this._mergedLayers))r(n)&&this._updateLayer(n)}_updateLayer(r){this._changes.updateLayer(r);const n=this.getLayerSourceCache(r),c=t.aC(r.source,r.scope),g=this._changes.getUpdatedSourceCaches();r.source&&!g[c]&&n&&n.getSource().type!=="raster"&&(this._changes.updateSourceCache(c,"reload"),n.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const n=q=>this._mergedLayers[q].is3D(),c=this.order,g={},M=[];for(let q=c.length-1;q>=0;q--){const K=c[q];if(n(K)){g[K]=q;for(const ne of r){const ae=ne[K];if(ae)for(const he of ae)M.push(he)}}}M.sort((q,K)=>K.intersectionZ-q.intersectionZ);const L=[];for(let q=c.length-1;q>=0;q--){const K=c[q];if(n(K))for(let ne=M.length-1;ne>=0;ne--){const ae=M[ne].feature;if(ae.layer&&g[ae.layer.id]<q)break;L.push(ae),M.pop()}else for(const ne of r){const ae=ne[K];if(ae)for(const he of ae)L.push(he.feature)}}return L}queryRenderedFeatures(r,n,c){let g;n&&!Array.isArray(n)&&n.filter&&(this._validate(Q,"queryRenderedFeatures.filter",n.filter,null,n),g=t.aZ(n.filter));const M={},L=ae=>{if(Zc.has(ae.type))return;const he=this.getOwnLayerSourceCache(ae),fe=M[he.id]=M[he.id]||{sourceCache:he,layers:{},has3DLayers:!1};ae.is3D()&&(fe.has3DLayers=!0),fe.layers[ae.fqid]=fe.layers[ae.fqid]||{styleLayer:ae,targets:[]},fe.layers[ae.fqid].targets.push({filter:g})};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new t.y(new Error("parameters.layers must be an Array."))),[];for(const ae of n.layers){const he=this._layers[ae];if(!he)return this.fire(new t.y(new Error(`The layer '${ae}' does not exist in the map's style and cannot be queried for features.`))),[];L(he)}}else for(const ae in this._layers)L(this._layers[ae]);const q=this._queryRenderedFeatures(r,M,c),K=this._flattenAndSortRenderedFeatures(q),ne=[];for(const ae of K)t.cs(ae.layer.id)===this.scope&&ne.push(ae);return ne}queryRenderedFeatureset(r,n,c){let g;n&&!Array.isArray(n)&&n.filter&&(this._validate(Q,"queryRenderedFeatures.filter",n.filter,null,n),g=t.aZ(n.filter));const M="mock",L=[];if(n&&n.target)L.push({...n,targetId:M,filter:g});else{const ne=this.getFeaturesetDescriptors();for(const ae of ne)L.push({targetId:M,filter:g,target:ae});for(const{style:ae}of this.fragments){const he=ae.getFeaturesetDescriptors();for(const fe of he)L.push({targetId:M,filter:g,target:fe})}}const q=this.queryRenderedTargets(r,L,c),K=[];for(const ne of q)for(const ae of ne.variants[M])K.push(new t.cw(ne,ae));return K}queryRenderedTargets(r,n,c){const g={},M=(q,K,ne,ae)=>{const he=g[K.id]=g[K.id]||{sourceCache:K,layers:{},has3DLayers:!1};he.layers[q.fqid]=he.layers[q.fqid]||{styleLayer:q,targets:[]},q.is3D()&&(he.has3DLayers=!0),he.layers[q.fqid].targets.push(ae?{...ne,namespace:ae.namespace,properties:ae.properties}:ne)};for(const q of n)if("featuresetId"in q.target){const{featuresetId:K,importId:ne}=q.target,ae=this.getFragmentStyle(ne),he=ae.featuresetSelectors[K];if(!he){this.fire(new t.y(new Error(`The featureset '${K}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const fe of he){const Te=ae.getOwnLayer(fe.layerId);Te&&!Zc.has(Te.type)&&M(Te,ae.getOwnLayerSourceCache(Te),q,fe)}}else if("layerId"in q.target){const{layerId:K}=q.target,ne=this.getLayer(K);if(!ne||Zc.has(ne.type))continue;M(ne,this.getLayerSourceCache(ne),q)}const L=this._queryRenderedFeatures(r,g,c);return this._flattenAndSortRenderedFeatures(L)}_queryRenderedFeatures(r,n,c){const g=[],M=!!this.map._showQueryGeometry,L=ut.createFromScreenPoints(r,c);for(const q in n){const K=Es(L,n[q],this._availableImages,c,M);Object.keys(K).length&&g.push(K)}if(this.placement)for(const q in n){if(!n[q].sourceCache._onlySymbols)continue;const K=cu(L.screenGeometry,n[q],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(K).length&&g.push(K)}return g}querySourceFeatures(r,n){const c=n&&n.filter;c&&this._validate(Q,"querySourceFeatures.filter",c,null,n);let g=[];const M=this.getOwnSourceCaches(r);for(const L of M)g=g.concat(dl(L,n));return g}addSourceType(r,n,c){return na.getSourceType(r)?c(new Error(`A source type called "${r}" already exists.`)):(na.setSourceType(r,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:n.workerSourceURL},c):c(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,n,c={}){this._checkLoaded();const g=this.light.getLight();let M=!1;for(const q in r)if(!t.bn(r[q],g[q])){M=!0;break}if(!M)return;const L=this._getTransitionParameters();this.light.setLight(r,n,c),this.light.updateTransitions(L)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=t.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&t.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(r,n=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),n===0&&delete this.terrain,r===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let c=r;const g=r.source==null;if(n===1){if(this.disableElevatedTerrain)return;if(typeof c.source=="object"){const q="terrain-dem-src";this.addSource(q,c.source),c=t.cp(c),c=t.l(c,{source:q})}const M=t.l({},c),L={};if(this.terrain&&g){M.source=this.terrain.get().source;const q=this.terrain?this.getFragmentStyle(this.terrain.scope):null;q&&(L.style=q.serialize())}if(this._validate(Fr,"terrain",M,L))return}if(!this.terrain||this.terrain.scope!==this.scope&&!g||this.terrain&&n!==this.terrain.drapeRenderMode){if(!c)return;this._createTerrain(c,n),this.fire(new t.z("data",{dataType:"style"}))}else{const M=this.terrain,L=M.get();for(const q of Object.keys(t.a3.terrain))!c.hasOwnProperty(q)&&t.a3.terrain[q].default&&(c[q]=t.a3.terrain[q].default);for(const q in r)if(!t.bn(r[q],L[q])){M.set(r,this.options),this.stylesheet.terrain=r;const K=this._getTransitionParameters({duration:0});M.updateTransitions(K),this.fire(new t.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const n=this.fog=new oi(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=n.get();const c=this._getTransitionParameters({duration:0});n.updateTransitions(c)}_createSnow(r){const n=this.snow=new Ki(r,this.map.transform,this.scope,this.options);this.stylesheet.snow=n.get();const c=this._getTransitionParameters({duration:0});n.updateTransitions(c)}_createRain(r){const n=this.rain=new xn(r,this.map.transform,this.scope,this.options);this.stylesheet.rain=n.get();const c=this._getTransitionParameters({duration:0});n.updateTransitions(c)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!t.bn(n.get(),r)){n.set(r,this.options),this.stylesheet.fog=n.get();const c=this._getTransitionParameters({duration:0});n.updateTransitions(c)}}else this._createFog(r);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(r){if(this._checkLoaded(),!r)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const n=this.snow;if(!t.bn(n.get(),r)){n.set(r,this.options),this.stylesheet.snow=n.get();const c=this._getTransitionParameters({duration:0});n.updateTransitions(c)}}else this._createSnow(r);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(r){if(this._checkLoaded(),!r)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const n=this.rain;if(!t.bn(n.get(),r)){n.set(r,this.options),this.stylesheet.rain=n.get();const c=this._getTransitionParameters({duration:0});n.updateTransitions(c)}}else this._createRain(r);this._markersNeedUpdate=!0}_reloadColorTheme(){const r=()=>{for(const g in this._layers)this._layers[g].lut=this._styleColorTheme.lut;for(const g in this._sourceCaches)this._sourceCaches[g].clearTiles()},n=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!n)return this._styleColorTheme.lut=null,void r();const c=this._evaluateColorThemeData(n);this._loadColorTheme(c).then(()=>{this.fire(new t.z("colorthemeset")),r()}).catch(g=>{t.w(`Couldn't set color theme: ${g}`)})}setColorTheme(r){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&t.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=r,this._reloadColorTheme()}setImportColorTheme(r,n){const c=this.getFragmentStyle(r);c&&(c._styleColorTheme.colorThemeOverride=n,c._reloadColorTheme())}_getTransitionParameters(r){return{now:t.q.now(),transition:t.l(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;const r=[],n=[];for(const c of this._mergedOrder)this.isLayerDraped(this._mergedLayers[c])?r.push(c):n.push(c);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...n)}_createTerrain(r,n){const c=this.terrain=new Lt(r,n,this.scope,this.options);n===1&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}_force3DLayerUpdate(){for(const r in this._layers){const n=this._layers[r];n.type==="fill-extrusion"&&this._updateLayer(n)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const n=this._layers[r];n.type==="symbol"&&this._updateLayer(n)}}_validate(r,n,c,g,M={}){if(M&&M.validate===!1)return!1;const L=t.l({},this.serialize());return Jo(this,r.call(Rt,t.l({key:n,style:L,value:c,styleSpec:t.a3},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.cx.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(r){const n=this.getSourceCaches(r);for(const c of n)c.clearTiles()}clearSources(){for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}reloadSource(r){const n=this.getSourceCaches(r);for(const c of n)c.resume(),c.reload()}reloadSources(){for(const r of this.getSources())r.reload&&r.reload()}updateSources(r){let n;this.directionalLight&&(n=Ao(this.directionalLight));for(const c in this._mergedSourceCaches)this._mergedSourceCaches[c].update(r,void 0,void 0,n)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const n=this._sourceCaches[r];n.resume(),n.reload()}}_updatePlacement(r,n,c,g,M,L,q=!1){let K=!1,ne=!1;const ae={},he={};for(const fe of this._mergedOrder){const Te=this._mergedLayers[fe];if(Te.type!=="symbol")continue;const Ve=t.aC(Te.source,Te.scope);let je=ae[Ve];if(!je){const Ye=this.getLayerSourceCache(Te);if(!Ye)continue;const at=Ye.getRenderableIds(!0).map(pt=>Ye.getTileByID(pt));he[Ve]=at.slice(),je=ae[Ve]=at.sort((pt,ft)=>ft.tileID.overscaledZ-pt.tileID.overscaledZ||(pt.tileID.isLessThan(ft.tileID)?-1:1))}const Xe=this.crossTileSymbolIndex.addLayer(Te,je,n.center.lng,n.projection);K=K||Xe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),q=q||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new t.z("neworder")),(q||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.q.now(),n.zoom))&&(this.pauseablePlacement=new Eu(n,this._mergedOrder,q,c,g,M,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,ae,he,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.q.now()),ne=!0),K&&this.pauseablePlacement.placement.setStale()),ne||K){this._buildingIndex.onNewFrame(n.zoom);for(let fe=0;fe<this._mergedOrder.length;fe++){const Te=this._mergedLayers[this._mergedOrder[fe]];if(Te.type!=="symbol")continue;const Ve=this.isLayerClipped(Te);this.placement.updateLayerOpacities(Te,ae[t.aC(Te.source,Te.scope)],fe,Ve?L:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.q.now())}}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,n){this._checkLoaded();const c=this.stylesheet.imports=this.stylesheet.imports||[];if(c.findIndex(({id:M})=>M===r.id)!==-1)return void this.fire(new t.y(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!n)return c.push(r),this._loadImports([r],!0);const g=c.findIndex(({id:M})=>M===n);return g===-1&&this.fire(new t.y(new Error(`Import with id "${n}" does not exist on this map.`))),this.stylesheet.imports=c.slice(0,g).concat(r).concat(c.slice(g)),this._loadImports([r],!0,n)}updateImport(r,n){this._checkLoaded();const c=this.stylesheet.imports||[],g=this.getImportIndex(r);return g===-1?this:typeof n=="string"?(this.setImportUrl(r,n),this):(n.url&&n.url!==c[g].url&&this.setImportUrl(r,n.url),t.bn(n.config,c[g].config)||this.setImportConfig(r,n.config),t.bn(n.data,c[g].data)||this.setImportData(r,n.data),this)}moveImport(r,n){this._checkLoaded();let c=this.stylesheet.imports||[];const g=this.getImportIndex(r);if(g===-1)return this;const M=this.getImportIndex(n);if(M===-1)return this;const L=c[g],q=this.fragments[g];return c=c.filter(({id:K})=>K!==r),this.fragments=this.fragments.filter(({id:K})=>K!==r),this.stylesheet.imports=c.slice(0,M).concat(L).concat(c.slice(M)),this.fragments=this.fragments.slice(0,M).concat(q).concat(this.fragments.slice(M)),this.mergeLayers(),this}setImportUrl(r,n){this._checkLoaded();const c=this.stylesheet.imports||[],g=this.getImportIndex(r);if(g===-1)return this;c[g].url=n;const M=this.fragments[g];return M.style=this._createFragmentStyle(c[g]),M.style.on("style.import.load",()=>this.mergeAll()),M.style.loadURL(n),this}setImportData(r,n){this._checkLoaded();const c=this.getImportIndex(r),g=this.stylesheet.imports||[];return c===-1?this:n?(this.fragments[c].style.setState(n),this._reloadImports(),this):(delete g[c].data,this.setImportUrl(r,g[c].url))}setImportConfig(r,n){this._checkLoaded();const c=this.getImportIndex(r),g=this.stylesheet.imports||[];if(c===-1)return this;n?g[c].config=n:delete g[c].config;const M=this.fragments[c],L=M.style.stylesheet&&M.style.stylesheet.schema;return M.config=n,M.style.updateConfig(n,L),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();const n=this.stylesheet.imports||[],c=this.getImportIndex(r);c!==-1&&(n.splice(c,1),this.fragments[c].style._remove(),this.fragments.splice(c,1),this._reloadImports())}getImportIndex(r){const n=(this.stylesheet.imports||[]).findIndex(c=>c.id===r);return n===-1&&this.fire(new t.y(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),n}getLayer(r){return this._mergedLayers[r]}getSources(){const r=[];for(const n in this._mergedOtherSourceCaches){const c=this._mergedOtherSourceCaches[n];c&&r.push(c.getSource())}return r}getSource(r,n){const c=this.getSourceCache(r,n);return c&&c.getSource()}getLayerSource(r){const n=this.getLayerSourceCache(r);return n&&n.getSource()}getSourceCache(r,n){const c=t.aC(r,n);return this._mergedOtherSourceCaches[c]}getLayerSourceCache(r){const n=t.aC(r.source,r.scope);return r.type==="symbol"?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(r){if(r==null)return Object.values(this._mergedSourceCaches);const n=[];return this._mergedOtherSourceCaches[r]&&n.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&n.push(this._mergedSymbolSourceCaches[r]),n}updateSourceCaches(){const r=this._changes.getUpdatedSourceCaches();for(const n in r){const c=r[n];c==="reload"?this.reloadSource(n):c==="clear"&&this.clearSource(n)}}updateLayers(r){const n=this._changes.getUpdatedPaintProperties();for(const c of n){const g=this.getLayer(c);g&&g.updateTransitions(r)}}getImages(r,n,c){this.imageManager.getImages(n.icons,n.scope,c),this._updateTilesForChangedImages();const g=M=>{M&&M.setDependencies(n.tileID.key,n.type,n.icons)};g(this._otherSourceCaches[n.source]),g(this._symbolSourceCaches[n.source])}rasterizeImages(r,n,c){this.imageManager.rasterizeImages(n,c)}getGlyphs(r,n,c){this.glyphManager.getGlyphs(n.stacks,n.scope,c)}getResource(r,n,c){return t.cy(n,c)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){const n=[];return this._otherSourceCaches[r]&&n.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&n.push(this._symbolSourceCaches[r]),n}_isSourceCacheLoaded(r){const n=this.getOwnSourceCaches(r);return n.length===0?(this.fire(new t.y(new Error(`There is no source with ID '${r}'`))),!1):n.every(c=>c.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(r,n){if(!this._clipLayerPresent&&r.type!=="fill-extrusion")return!1;const c=r.type==="fill-extrusion"&&r.sourceLayer==="building";if(r.is3D()){if(c||n&&n.type==="batched-model"||r.type==="model")return!0}else if(r.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(r=>{r.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}na.getSourceType=function(u){return Ra[u]},na.setSourceType=function(u,r){Ra[u]=r},na.registerForPluginStateChange=t.ch;var Qf=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Yc=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Ru=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,wl="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Du=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Io=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Lu=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Kc=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Qo=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Os=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,El=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const es=[];co(Qf,es),co(Ru,es),co(Yc,es);const uo={"_prelude_fog.vertex.glsl":Io,"_prelude_terrain.vertex.glsl":Du,"_prelude_shadow.vertex.glsl":Os,"_prelude_fog.fragment.glsl":Lu,"_prelude_shadow.fragment.glsl":El,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Kc,"_prelude_raster_particle.glsl":Qo},ts={};gi("",Du),gi(Lu,Io),gi(El,Os),gi(Kc,""),gi(Qo,"");const Ou=gi(Yc,Ru),Jc=Qf;var zu={background:gi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:gi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:gi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:gi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:gi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:gi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:gi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:gi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:gi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:gi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:gi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:gi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:gi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:gi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:gi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:gi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:gi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:gi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:gi(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:gi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:gi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec2 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
halfwidth=(u_width_scale*a_z_offset_width.y)/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:gi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec2 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:gi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:gi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:gi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:gi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:gi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:gi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:gi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:gi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:gi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,wl),skyboxGradient:gi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,wl),skyboxCapture:gi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:gi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:gi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:gi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:gi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:gi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:gi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:gi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:gi("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:gi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function co(u,r){const n=u.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let c of n)if(c=c.trim(),c[0]==="#"&&c.includes("if")&&!c.includes("endif")){c=c.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const g=c.split(" ");for(const M of g)r.includes(M)||r.push(M)}}function gi(u,r){const n=/#include\s+"([^"]+)"/g,c=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let g=r.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);g&&(g=g.map(ne=>{const ae=ne.split(" ");return ae[ae.length-1]}),g=[...new Set(g)]);const M={},L=[],q=[];if(u=u.replace(n,(ne,ae)=>(q.push(ae),"")),(r=r.replace(n,(ne,ae)=>(L.push(ae),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let K=[...es];co(u,K),co(r,K);for(const ne of[...L,...q])uo[ne]||console.error(`Undefined include: ${ne}`),ts[ne]||(ts[ne]=[],co(uo[ne],ts[ne])),K=[...K,...ts[ne]];return{fragmentSource:u=u.replace(c,(ne,ae,he,fe,Te)=>(M[Te]=!0,ae==="define"?`
#ifndef HAS_UNIFORM_u_${Te}
in ${he} ${fe} ${Te};
#else
uniform ${he} ${fe} u_${Te};
#endif
`:ae==="initialize"?`
#ifdef HAS_UNIFORM_u_${Te}
    ${he} ${fe} ${Te} = u_${Te};
#endif
`:ae==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Te}
    in ${he} ${fe} ${Te};
#endif
`:ae==="initialize-attribute"?"":void 0)),vertexSource:r=r.replace(c,(ne,ae,he,fe,Te)=>{const Ve=fe==="float"?"vec2":fe,je=Te.match(/color/)?"color":Ve;return ae==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Te}
in ${he} ${fe} a_${Te};
#endif
`:M[Te]?ae==="define"?`
#ifndef HAS_UNIFORM_u_${Te}
uniform lowp float u_${Te}_t;
in ${he} ${Ve} a_${Te};
out ${he} ${fe} ${Te};
#else
uniform ${he} ${fe} u_${Te};
#endif
`:ae==="initialize"?je==="vec4"?`
#ifndef HAS_UNIFORM_u_${Te}
    ${Te} = a_${Te};
#else
    ${he} ${fe} ${Te} = u_${Te};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Te}
    ${Te} = unpack_mix_${je}(a_${Te}, u_${Te}_t);
#else
    ${he} ${fe} ${Te} = u_${Te};
#endif
`:ae==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Te}
    in ${he} ${fe} a_${Te};
    out ${he} ${fe} ${Te};
#endif
`:ae==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Te}
    ${Te} = a_${Te};
#endif
`:void 0:ae==="define"?`
#ifndef HAS_UNIFORM_u_${Te}
uniform lowp float u_${Te}_t;
in ${he} ${Ve} a_${Te};
#else
uniform ${he} ${fe} u_${Te};
#endif
`:ae==="define-instanced"?je==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Te}0;
in vec4 a_${Te}1;
in vec4 a_${Te}2;
in vec4 a_${Te}3;
#else
uniform ${he} ${fe} u_${Te};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${he} ${Ve} a_${Te};
#else
uniform ${he} ${fe} u_${Te};
#endif
`:ae==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Te}
    ${he} ${fe} ${Te} = a_${Te};
#endif
`:je==="vec4"?`
#ifndef HAS_UNIFORM_u_${Te}
    ${he} ${fe} ${Te} = a_${Te};
#else
    ${he} ${fe} ${Te} = u_${Te};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Te}
    ${he} ${fe} ${Te} = unpack_mix_${je}(a_${Te}, u_${Te}_t);
#else
    ${he} ${fe} ${Te} = u_${Te};
#endif
`}),staticAttributes:g,usedDefines:K,vertexIncludes:L,fragmentIncludes:q}}class ed{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,n,c,g,M,L,q,K){this.context=r;let ne=this.boundPaintVertexBuffers.length!==g.length;for(let he=0;!ne&&he<g.length;he++)this.boundPaintVertexBuffers[he]!==g[he]&&(ne=!0);let ae=this.boundDynamicVertexBuffers.length!==q.length;for(let he=0;!ae&&he<q.length;he++)this.boundDynamicVertexBuffers[he]!==q[he]&&(ae=!0);if(!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==c||ne||ae||this.boundIndexBuffer!==M||this.boundVertexOffset!==L)this.freshBind(n,c,g,M,L,q,K);else{r.bindVertexArrayOES.set(this.vao);for(const he of q)he&&(he.bind(),K&&he.instanceCount&&he.setVertexAttribDivisor(r.gl,n,K));M&&M.dynamicDraw&&M.bind()}}freshBind(r,n,c,g,M,L,q){const K=r.numAttributes,ne=this.context,ae=ne.gl;this.vao&&this.destroy(),this.vao=ne.gl.createVertexArray(),ne.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=g,this.boundVertexOffset=M,this.boundDynamicVertexBuffers=L,n.enableAttributes(ae,r),n.bind(),n.setVertexAttribPointers(ae,r,M);for(const he of c)he.enableAttributes(ae,r),he.bind(),he.setVertexAttribPointers(ae,r,M);for(const he of L)he&&(he.enableAttributes(ae,r),he.bind(),he.setVertexAttribPointers(ae,r,M),q&&he.instanceCount&&he.setVertexAttribDivisor(ae,r,q));g&&g.bind(),ne.currentNumAttributes=K}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function td(u,r){const n=Math.pow(2,r.canonical.z),c=r.canonical.y;return[new t.aa(0,c/n).toLngLat().lat,new t.aa(0,(c+1)/n).toLngLat().lat]}function rd(u,r,n,c,g,M,L){const q=u.context,K=q.gl,ne=n.hillshadeFBO;if(!ne)return;u.prepareDrawTile();const ae=u.isTileAffectedByFog(r),he=u.getOrCreateProgram("hillshade",{overrideFog:ae});q.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_2D,ne.colorAttachment.get());const fe=((Xe,Ye,at,pt)=>{const ft=at.paint.get("hillshade-shadow-color"),bt=at.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",gt=at.paint.get("hillshade-highlight-color"),vt=at.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",yt=at.paint.get("hillshade-accent-color"),Tt=at.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Dt=at.paint.get("hillshade-emissive-strength");let Zt=t.ai(at.paint.get("hillshade-illumination-direction"));if(at.paint.get("hillshade-illumination-anchor")==="viewport")Zt-=Xe.transform.angle;else if(Xe.style&&Xe.style.enable3dLights()&&Xe.style.directionalLight){const Pt=Xe.style.directionalLight.properties.get("direction"),zt=t.cb(Pt.x,Pt.y,Pt.z);Zt=t.ai(zt[1])}const Ht=!Xe.options.moving;return{u_matrix:pt||Xe.transform.calculateProjMatrix(Ye.tileID.toUnwrapped(),Ht),u_image:0,u_latrange:td(0,Ye.tileID),u_light:[at.paint.get("hillshade-exaggeration"),Zt],u_shadow:ft.toRenderColor(bt?null:at.lut),u_highlight:gt.toRenderColor(vt?null:at.lut),u_emissive_strength:Dt,u_accent:yt.toRenderColor(Tt?null:at.lut)}})(u,n,c,u.terrain?r.projMatrix:null);u.uploadCommonUniforms(q,he,r.toUnwrapped());const{tileBoundsBuffer:Te,tileBoundsIndexBuffer:Ve,tileBoundsSegments:je}=u.getTileBoundsBuffers(n);he.draw(u,K.TRIANGLES,g,M,L,ei.disabled,fe,c.id,Te,Ve,je)}function rs(u,r,n){if(!r.needsDEMTextureUpload)return;const c=u.context,g=c.gl;c.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||u.getTileTexture(n.stride);const M=n.getPixels();r.demTexture?r.demTexture.update(M,{premultiply:!1}):r.demTexture=new t.T(c,M,g.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function id(u,r,n){const c=u.context,g=c.gl;if(!r.dem)return;const M=r.dem;if(c.activeTexture.set(g.TEXTURE1),rs(u,r,M),!r.demTexture)return;r.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);const L=M.dim;c.activeTexture.set(g.TEXTURE0);let q=r.hillshadeFBO;if(!q){const fe=new t.T(c,{width:L,height:L,data:null},g.RGBA8);fe.bind(g.LINEAR,g.CLAMP_TO_EDGE),q=r.hillshadeFBO=c.createFramebuffer(L,L,!0,"renderbuffer"),q.colorAttachment.set(fe.texture)}c.bindFramebuffer.set(q.framebuffer),c.viewport.set([0,0,L,L]);const{tileBoundsBuffer:K,tileBoundsIndexBuffer:ne,tileBoundsSegments:ae}=u.getMercatorTileBoundsBuffers(),he=[];u.linearFloatFilteringSupported()&&he.push("TERRAIN_DEM_FLOAT_FORMAT"),u.getOrCreateProgram("hillshadePrepare",{defines:he}).draw(u,g.TRIANGLES,qr.disabled,ai.disabled,pi.unblended,ei.disabled,((fe,Te)=>{const Ve=Te.stride,je=t.ab.mat4.create();return t.ab.mat4.ortho(je,0,t.ag,-t.ag,0,0,1),t.ab.mat4.translate(je,je,[0,-t.ag,0]),{u_matrix:je,u_image:1,u_dimension:[Ve,Ve],u_zoom:fe.overscaledZ}})(r.tileID,M),n.id,K,ne,ae),r.needsHillshadePrepare=!1}class Zi{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class _m extends Zi{getDefault(){return t.aj.transparent}set(r){const n=this.current;(r.r!==n.r||r.g!==n.g||r.b!==n.b||r.a!==n.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class gm extends Zi{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Qc extends Zi{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class eh extends Zi{getDefault(){return[!0,!0,!0,!0]}set(r){const n=this.current;(r[0]!==n[0]||r[1]!==n[1]||r[2]!==n[2]||r[3]!==n[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class th extends Zi{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class rh extends Zi{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class nd extends Zi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const n=this.current;(r.func!==n.func||r.ref!==n.ref||r.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class ad extends Zi{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const n=this.current;(r[0]!==n[0]||r[1]!==n[1]||r[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class ym extends Zi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const n=this.gl;r?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=r,this.dirty=!1}}class Tl extends Zi{getDefault(){return[0,1]}set(r){const n=this.current;(r[0]!==n[0]||r[1]!==n[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Sl extends Zi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const n=this.gl;r?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=r,this.dirty=!1}}class od extends Zi{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class aa extends Zi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const n=this.gl;r?n.enable(n.BLEND):n.disable(n.BLEND),this.current=r,this.dirty=!1}}class ih extends Zi{getDefault(){const r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){const n=this.current;(r[0]!==n[0]||r[1]!==n[1]||r[2]!==n[2]||r[3]!==n[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class ku extends Zi{getDefault(){return t.aj.transparent}set(r){const n=this.current;(r.r!==n.r||r.g!==n.g||r.b!==n.b||r.a!==n.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Bu extends Zi{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class nh extends Zi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const n=this.gl;r?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=r,this.dirty=!1}}class ah extends Zi{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Fu extends Zi{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let oh=class extends Zi{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}};class sh extends Zi{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Nu extends Zi{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const n=this.current;(r[0]!==n[0]||r[1]!==n[1]||r[2]!==n[2]||r[3]!==n[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class sd extends Zi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class ld extends Zi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class zs extends Zi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class vm extends Zi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class bm extends Zi{getDefault(){return null}set(r){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class xm extends Zi{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class wm extends Zi{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Em extends Zi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Tm extends Zi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Ml extends Zi{constructor(r,n){super(r),this.context=r,this.parent=n}getDefault(){return null}}class lh extends Ml{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class uh extends Ml{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,this.attachment(),n.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class ks extends Ml{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,this.attachment(),n.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class ud extends uh{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const cd=(u,r,n)=>({u_matrix:u,u_image0:0,u_skirt_height:r,u_ground_shadow_factor:n}),ch=(u,r,n,c,g,M,L,q,K,ne,ae,he,fe,Te,Ve,je)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(c),u_merc_matrix:n,u_zoom_transition:g,u_merc_center:M,u_image0:0,u_frustum_tl:L,u_frustum_tr:q,u_frustum_br:K,u_frustum_bl:ne,u_globe_pos:ae,u_globe_radius:he,u_viewport:fe,u_grid_matrix:je?Float32Array.from(je):new Float32Array(9),u_skirt_height:Te,u_far_z_cutoff:Ve});function Uu(u,r){return u!=null&&r!=null&&!(!u.hasData()||!r.hasData())&&u.demTexture!=null&&r.demTexture!=null&&u.tileID.key!==r.tileID.key}const wa=new class{constructor(){this.operations={}}newMorphing(u,r,n,c,g){if(u in this.operations){const M=this.operations[u];M.to.tileID.key!==n.tileID.key&&(M.queued=n)}else this.operations[u]={startTime:c,phase:0,duration:g,from:r,to:n,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const r=this.operations[u];return{from:r.from,to:r.to,phase:r.phase}}update(u){for(const r in this.operations){const n=this.operations[r];for(n.phase=(u-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,u)){delete this.operations[r];break}}}_nextOp(u,r){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=r,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},hh={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ho(u,r,n){if(r===0)return 0;const c=r<1&&n===514?.25/r:1;return 6*Math.pow(1.5,22-u)*Math.max(r,1)*c}function fh(u,r){const n=1<<u.z;return!r&&(u.x===0||u.x===n-1)||u.y===0||u.y===n-1}const Bs=u=>({u_matrix:u});function ju(u,r,n,c,g){if(g>0){const M=t.q.now(),L=(M-u.timeAdded)/g,q=r?(M-r.timeAdded)/g:-1,K=n.getSource(),ne=c.coveringZoomLevel({tileSize:K.tileSize,roundZoom:K.roundZoom}),ae=!r||Math.abs(r.tileID.overscaledZ-ne)>Math.abs(u.tileID.overscaledZ-ne),he=ae&&u.refreshedUponExpiration?1:t.aw(ae?L:1-q,0,1);return u.refreshedUponExpiration&&L>=1&&(u.refreshedUponExpiration=!1),r?{opacity:1,mix:1-he}:{opacity:he,mix:0}}return{opacity:1,mix:0}}class hd extends ya{constructor(r){const n={type:"raster-dem",maxzoom:r.transform.maxZoom},c=new t.D(t.ci(),null),g=To("mock-dem",n,c,r.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,n){r.state="loaded",n(null)}}class dh extends ya{constructor(r){const n=To("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new t.D(t.ci(),null),r.style);super("proxy",n,!1),n.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,n,c){if(r.freezeTileCoverage)return;this.transform=r;const g=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((M,L)=>{if(M[L.key]="",!this._tiles[L.key]){const q=new Mo(L,this._source.tileSize*L.overscaleFactor(),r.tileZoom);q.state="loaded",this._tiles[L.key]=q}return M},{});for(const M in this._tiles)M in g||(this.freeFBO(M),this._tiles[M].unloadVectorData(),delete this._tiles[M])}freeFBO(r){const n=this.proxyCachedFBO[r];if(n!==void 0){const c=Object.values(n);this.renderCachePool.push(...c),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Vu extends t.aG{constructor(r,n,c){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=n,this.projMatrix=c}}class fd extends t.cJ{constructor(r,n){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},r.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[c,g,M]=function(K){const ne=new t.b4,ae=new t.aU,he=131;ne.reserve(17161),ae.reserve(33800);const fe=t.ag/128,Te=t.ag+fe/2,Ve=Te+fe;for(let Xe=-fe;Xe<Ve;Xe+=fe)for(let Ye=-fe;Ye<Ve;Ye+=fe){const at=Ye<0||Ye>Te||Xe<0||Xe>Te?24575:0,pt=t.aw(Math.round(Ye),0,t.ag),ft=t.aw(Math.round(Xe),0,t.ag);ne.emplaceBack(pt+at,ft)}const je=(Xe,Ye)=>{const at=Ye*he+Xe;ae.emplaceBack(at+1,at,at+he),ae.emplaceBack(at+he,at+he+1,at+1)};for(let Xe=1;Xe<129;Xe++)for(let Ye=1;Ye<129;Ye++)je(Ye,Xe);return[0,129].forEach(Xe=>{for(let Ye=0;Ye<130;Ye++)je(Ye,Xe),je(Xe,Ye)}),[ne,ae,32768]}(),L=r.context;this.gridBuffer=L.createVertexBuffer(c,t.b6.members),this.gridIndexBuffer=L.createIndexBuffer(g),this.gridSegments=t.b7.simpleSegment(0,0,c.length,g.length),this.gridNoSkirtSegments=t.b7.simpleSegment(0,0,c.length,M),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new dh(n.map),this.orthoMatrix=t.ab.mat4.create(),t.ab.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,t.ag,0,t.ag,0,1);const q=L.gl;this._overlapStencilMode=new ai({func:q.GEQUAL,mask:255},0,255,q.KEEP,q.KEEP,q.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new hd(n.map),this._pendingGroundEffectLayers=[]}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,n,c){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);const g=r.terrain.properties,M=r.terrain.drapeRenderMode===0,L=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=t.q.now();const q=r.terrain&&r.terrain.scope,K=g.get("source"),ne=M?this._mockSourceCache:r.getSourceCache(K,q);if(!ne)return void t.w(`Couldn't find terrain source "${K}".`);if(this.sourceCache=ne,this._attenuationRange=r.terrain.getAttenuationRange(),this._exaggeration=L?this.calculateExaggeration(n):g.get("exaggeration"),!n.projection.requiresDraping&&L&&this._exaggeration===0)return void this._disable();this.enabled=!0;const ae=()=>{this.sourceCache.used&&t.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const he=this.getScaledDemTileSize();this.sourceCache.update(n,he,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,ae(),this._initializing=!0),ae(),n.updateElevation(!0,c),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(r){if(this._attenuationRange&&r.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(r.zoom);const n=this._previousCameraAltitude,c=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=c;const g=n!=null?c-n:Number.MAX_VALUE;if(Math.abs(g)<2)return this._exaggeration;const M=r.zoom,L=this._style.terrain;if(!this._previousUpdateTimestamp)return L.getExaggeration(M);let q=M-this._previousZoom;const K=this._previousUpdateTimestamp;let ne=M;this._evaluationZoom!=null&&(ne=this._evaluationZoom,Math.abs(M-ne)>.5&&(q=.5*(M-ne+q)),q*g<0&&(ne+=q)),this._evaluationZoom=ne;const ae=L.getExaggeration(ne),he=ae===L.getExaggeration(Math.max(0,ne-.1));if(he&&Math.abs(ae-this._exaggeration)<.01)return ae;let fe=Math.min(.1,.00375*(this._updateTimestamp-K));return(he||ae<.1||Math.abs(q)<1e-4)&&(fe=Math.min(.2,4*fe)),t.af(this._exaggeration,ae,fe)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,c=this.painter.transform;this._initializing&&(this._initializing=c._centerAltitude===0&&this.getAtPointOrZero(t.aa.fromLngLat(c.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const g=this.proxyCoords=n.getIds().map(K=>{const ne=n.getTileByID(K).tileID;return ne.projMatrix=c.calculateProjMatrix(ne.toUnwrapped()),ne});(function(K,ne){const ae=ne.transform.pointCoordinate(ne.transform.getCameraPoint()),he=new t.P(ae.x,ae.y);K.sort((fe,Te)=>{if(Te.overscaledZ-fe.overscaledZ)return Te.overscaledZ-fe.overscaledZ;const Ve=new t.P(fe.canonical.x+(1<<fe.canonical.z)*fe.wrap,fe.canonical.y),je=new t.P(Te.canonical.x+(1<<Te.canonical.z)*Te.wrap,Te.canonical.y),Xe=he.mult(1<<fe.canonical.z);return Xe.x-=.5,Xe.y-=.5,Xe.distSqr(Ve)-Xe.distSqr(je)})})(g,this.painter);const M=this.proxyToSource||{};this.proxyToSource={},g.forEach(K=>{this.proxyToSource[K.key]={}}),this.terrainTileForTile={};const L=this._style._mergedSourceCaches;for(const K in L){const ne=L[K];if(!ne.used||(ne!==this.sourceCache&&this.resetTileLookupCache(ne.id),this._setupProxiedCoordsForOrtho(ne,r[K],M),ne.usedForTerrain))continue;const ae=r[K];ne.getSource().reparseOverscaled&&this._assignTerrainTiles(ae)}this.proxiedCoords[n.id]=g.map(K=>new Vu(K,K.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(M),this.renderingToTexture=!1;const q={};this._visibleDemTiles=[];for(const K of this.proxyCoords){const ne=this.terrainTileForTile[K.key];if(!ne)continue;const ae=ne.tileID.key;ae in q||(this._visibleDemTiles.push(ne),q[ae]=ae)}}_assignTerrainTiles(r){this._initializing||r.forEach(n=>{if(this.terrainTileForTile[n.key])return;const c=this._findTileCoveringTileID(n,this.sourceCache);c&&(this.terrainTileForTile[n.key]=c)})}_prepareDEMTextures(){const r=this.painter.context,n=r.gl;for(const c in this.terrainTileForTile){const g=this.terrainTileForTile[c],M=g.dem;!M||g.demTexture&&!g.needsDEMTextureUpload||(r.activeTexture.set(n.TEXTURE1),rs(this.painter,g,M))}}_prepareDemTileUniforms(r,n,c,g){if(!n||n.demTexture==null)return!1;const M=r.tileID.canonical,L=Math.pow(2,n.tileID.canonical.z-M.z),q=g||"";return c[`u_dem_tl${q}`]=[M.x*L%1,M.y*L%1],c[`u_dem_scale${q}`]=L,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let r=0;const n=this._visibleDemTiles.reduce((c,g)=>{if(!g.dem)return c;const M=g.dem.tree.minimums[0];return M>0&&r++,c+M},0);return r?n/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,n=r.gl;r.activeTexture.set(n.TEXTURE2);const c=this._getLoadedAreaMinimum(),g=new t.cK({width:1,height:1},new Float32Array([c]));this._emptyDEMTextureDirty=!1;let M=this._emptyDEMTexture;return M?M.update(g,{premultiply:!1}):M=this._emptyDEMTexture=new t.T(r,g,n.R32F,{premultiply:!1}),M}setupElevationDraw(r,n,c){const g=this.painter.context,M=g.gl,L={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};L.u_exaggeration=this.exaggeration();let q=null,K=null,ne=1;if(c&&c.morphing&&this._useVertexMorphing){const Te=c.morphing.srcDemTile,Ve=c.morphing.dstDemTile;ne=c.morphing.phase,Te&&Ve&&(this._prepareDemTileUniforms(r,Te,L,"_prev")&&(K=Te),this._prepareDemTileUniforms(r,Ve,L)&&(q=Ve))}const ae=Te=>Te&&Te.demTexture&&this.painter.linearFloatFilteringSupported()?M.LINEAR:M.NEAREST;let he=null;var fe;if(this.enabled?K&&q?(he=q.demTexture,g.activeTexture.set(M.TEXTURE4),K.demTexture.bind(ae(K),M.CLAMP_TO_EDGE),L.u_dem_lerp=ne):(q=this.terrainTileForTile[r.tileID.key],he=this._prepareDemTileUniforms(r,q,L)?q.demTexture:this.emptyDEMTexture):he=this.emptyDEMTexture,g.activeTexture.set(M.TEXTURE2),he&&(L.u_dem_size=(fe=he).size[0]===1?1:fe.size[0]-2,he.bind(ae(q),M.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(c&&c.useDepthForOcclusion,n,L),c&&c.useMeterToDem&&q){const Te=(1<<q.tileID.canonical.z)*t.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;L.u_meter_to_dem=Te}if(c&&c.labelPlaneMatrixInv&&(L.u_label_plane_matrix_inv=c.labelPlaneMatrixInv),n.setTerrainUniformValues(g,L),this.painter.transform.projection.name==="globe"){const Te=this.globeUniformValues(this.painter.transform,r.tileID.canonical,c&&c.useDenormalizedUpVectorScale);n.setGlobeUniformValues(g,Te)}}globeUniformValues(r,n,c){const g=r.projection;return{u_tile_tl_up:g.upVector(n,0,0),u_tile_tr_up:g.upVector(n,t.ag,0),u_tile_br_up:g.upVector(n,t.ag,t.ag),u_tile_bl_up:g.upVector(n,0,t.ag),u_tile_up_scale:c?t.cL(1):g.upVectorScale(n,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const n=this.painter,c=this.painter.context;r.length!==0&&(c.bindFramebuffer.set(null),c.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,M,L,q,K){if(g.transform.projection.name==="globe")(function(ne,ae,he,fe,Te){const Ve=ne.context,je=Ve.gl;let Xe,Ye;const at=ne.transform,pt=t.cC(ne,Ve,at),ft=(Pt,zt)=>{if(Ye===zt)return;const tr=[hh[zt],"PROJECTION_GLOBE_VIEW"];pt&&tr.push("CUSTOM_ANTIALIASING");const lr=ne.isTileAffectedByFog(Pt);Xe=ne.getOrCreateProgram("globeRaster",{defines:tr,overrideFog:lr}),Ye=zt},bt=ne.colorModeForRenderPass(),gt=new qr(je.LEQUAL,qr.ReadWrite,ne.depthRangeFor3D);wa.update(Te);const vt=t.cD(at),yt=[t.at(at.center.lng),t.aA(at.center.lat)],Tt=ne.globeSharedBuffers,Dt=[at.width*t.q.devicePixelRatio,at.height*t.q.devicePixelRatio],Zt=Float32Array.from(at.globeMatrix),Ht={useDenormalizedUpVectorScale:!0};{const Pt=ne.transform,zt=ho(Pt.zoom,ae.exaggeration(),ae.sourceCache._source.tileSize);Ye=-1;const tr=je.TRIANGLES;for(const lr of fe){const pr=he.getTile(lr),Gt=ai.disabled,nr=ae.prevTerrainTileForTile[lr.key],Xt=ae.terrainTileForTile[lr.key];Uu(nr,Xt)&&wa.newMorphing(lr.key,nr,Xt,Te,250),Ve.activeTexture.set(je.TEXTURE0),pr.texture&&pr.texture.bind(je.LINEAR,je.CLAMP_TO_EDGE);const hr=wa.getMorphValuesForProxy(lr.key),ar=hr?1:0;hr&&t.J(Ht,{morphing:{srcDemTile:hr.from,dstDemTile:hr.to,phase:t.cB(hr.phase)}});const er=t.cE(lr.canonical),Sr=t.cF(er.getCenter().lat),mr=t.cG(lr.canonical,er,Sr,Pt.worldSize/Pt._pixelsPerMercatorPixel),Mr=t.bb(t.cH(lr.canonical)),Lr=ch(Pt.expandedFarZProjMatrix,Zt,vt,Mr,t.ae(Pt.zoom),yt,Pt.frustumCorners.TL,Pt.frustumCorners.TR,Pt.frustumCorners.BR,Pt.frustumCorners.BL,Pt.globeCenterInViewSpace,Pt.globeRadius,Dt,zt,Pt._farZ,mr);if(ft(lr,ar),Xe&&(ae.setupElevationDraw(pr,Xe,Ht),ne.uploadCommonUniforms(Ve,Xe,lr.toUnwrapped()),Tt)){const[ri,Gr,Zr]=Tt.getGridBuffers(Sr,zt!==0);Xe.draw(ne,tr,gt,Gt,bt,ei.backCCW,Lr,"globe_raster",ri,Gr,Zr)}}}if(Tt&&(ne.renderDefaultNorthPole||ne.renderDefaultSouthPole)){const Pt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pt&&Pt.push("CUSTOM_ANTIALIASING"),Xe=ne.getOrCreateProgram("globeRaster",{defines:Pt});for(const zt of fe){const{x:tr,y:lr,z:pr}=zt.canonical,Gt=lr===0,nr=lr===(1<<pr)-1,[Xt,hr,ar,er]=Tt.getPoleBuffers(pr,!1);if(er&&(Gt||nr)){const Sr=he.getTile(zt);Ve.activeTexture.set(je.TEXTURE0),Sr.texture&&Sr.texture.bind(je.LINEAR,je.CLAMP_TO_EDGE);let mr=t.cI(pr,tr,at);const Mr=t.bb(t.cH(zt.canonical)),Lr=(ri,Gr)=>ri.draw(ne,je.TRIANGLES,gt,ai.disabled,bt,ei.disabled,ch(at.expandedFarZProjMatrix,mr,mr,Mr,0,yt,at.frustumCorners.TL,at.frustumCorners.TR,at.frustumCorners.BR,at.frustumCorners.BL,at.globeCenterInViewSpace,at.globeRadius,Dt,0,at._farZ),"globe_pole_raster",Gr,ar,er);ae.setupElevationDraw(Sr,Xe,Ht),ne.uploadCommonUniforms(Ve,Xe,zt.toUnwrapped()),Gt&&ne.renderDefaultNorthPole&&Lr(Xe,Xt),nr&&ne.renderDefaultSouthPole&&(mr=t.ab.mat4.scale(t.ab.mat4.create(),mr,[1,-1,1]),Lr(Xe,hr))}}}})(g,M,L,q,K);else{const ne=g.context,ae=ne.gl;let he,fe;const Te=g.shadowRenderer,Ve=so(g,g.longestCutoffRange),je=bt=>{if(fe===bt)return;const gt=[];gt.push(hh[bt]),Ve.shouldRenderCutoff&&gt.push("RENDER_CUTOFF"),Te&&(gt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Te.useNormalOffset&&gt.push("NORMAL_OFFSET")),he=g.getOrCreateProgram("terrainRaster",{defines:gt}),fe=bt},Xe=g.colorModeForRenderPass(),Ye=new qr(ae.LEQUAL,qr.ReadWrite,g.depthRangeFor3D);wa.update(K);const at=g.transform,pt=ho(at.zoom,M.exaggeration(),M.sourceCache._source.tileSize);let ft=[0,0,0];if(Te){const bt=g.style.directionalLight,gt=g.style.ambientLight;bt&&gt&&(ft=Ds(g.style,bt,gt))}{fe=-1;const bt=ae.TRIANGLES,[gt,vt]=[M.gridIndexBuffer,M.gridSegments];for(const yt of q){const Tt=L.getTile(yt),Dt=ai.disabled,Zt=M.prevTerrainTileForTile[yt.key],Ht=M.terrainTileForTile[yt.key];Uu(Zt,Ht)&&wa.newMorphing(yt.key,Zt,Ht,K,250),ne.activeTexture.set(ae.TEXTURE0),Tt.texture&&Tt.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);const Pt=wa.getMorphValuesForProxy(yt.key),zt=Pt?1:0;let tr;Pt&&(tr={morphing:{srcDemTile:Pt.from,dstDemTile:Pt.to,phase:t.cB(Pt.phase)}});const lr=cd(yt.projMatrix,fh(yt.canonical,at.renderWorldCopies)?pt/10:pt,ft);if(je(zt),!he)continue;M.setupElevationDraw(Tt,he,tr);const pr=yt.toUnwrapped();Te&&Te.setupShadows(pr,he),g.uploadCommonUniforms(ne,he,pr,null,Ve),he.draw(g,bt,Ye,Dt,Xe,ei.backCCW,lr,"terrain_raster",M.gridBuffer,gt,vt)}}}}(n,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const n=this.painter,c=this.painter.context,g=this.proxySourceCache,M=this.proxiedCoords[g.id],L=this._drapedRenderBatches.shift(),q=n.style.order,K=[];let ne=0;for(const ae of M){const he=g.getTileByID(ae.proxyTileKey),fe=g.proxyCachedFBO[ae.key]?g.proxyCachedFBO[ae.key][r]:void 0,Te=fe!==void 0?g.renderCache[fe]:this.pool[ne++],Ve=fe!==void 0;if(he.texture=Te.tex,Ve&&!Te.dirty){K.push(he.tileID);continue}let je;c.bindFramebuffer.set(Te.fb.framebuffer),this.renderedToTile=!1,Te.dirty&&(c.clear({color:t.aj.transparent,stencil:0}),Te.dirty=!1);for(let Xe=L.start;Xe<=L.end;++Xe){const Ye=n.style._mergedLayers[q[Xe]];if(Ye.isHidden(n.transform.zoom))continue;const at=n.style.getLayerSourceCache(Ye),pt=at?this.proxyToSource[ae.key][at.id]:[ae];if(!pt)continue;const ft=pt;c.viewport.set([0,0,Te.fb.width,Te.fb.height]),je!==(at?at.id:null)&&(this._setupStencil(Te,pt,Ye,at),je=at?at.id:null),n.renderLayer(n,at,Ye,ft)}if(this._drapedRenderBatches.length===0)for(const Xe of this._pendingGroundEffectLayers){const Ye=n.style._mergedLayers[q[Xe]];if(Ye.isHidden(n.transform.zoom))continue;const at=n.style.getLayerSourceCache(Ye),pt=at?this.proxyToSource[ae.key][at.id]:[ae];if(!pt)continue;const ft=pt;c.viewport.set([0,0,Te.fb.width,Te.fb.height]),je!==(at?at.id:null)&&(this._setupStencil(Te,pt,Ye,at),je=at?at.id:null),n.renderLayer(n,at,Ye,ft)}this.renderedToTile?(Te.dirty=!0,K.push(he.tileID)):Ve||--ne,ne===5&&(ne=0,this.renderToBackBuffer(K))}return this.renderToBackBuffer(K),this.renderingToTexture=!1,c.bindFramebuffer.set(null),c.viewport.set([0,0,n.width,n.height]),L.end+1}postRender(){}isLayerOrderingCorrect(r){const n=r.order.length;let c=-1,g=n;for(let M=0;M<n;++M)this._style.isLayerDraped(r._mergedLayers[r.order[M]])?c=Math.max(c,M):g=Math.min(g,M);return g>c}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(n=>n.dem).forEach(n=>{r=Math.min(r,n.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,n,c){if(!this._visibleDemTiles)return null;const g=this._visibleDemTiles.filter(M=>M.dem).map(M=>{const L=M.tileID,q=1<<L.overscaledZ,{x:K,y:ne}=L.canonical,ae=K/q,he=(K+1)/q,fe=ne/q,Te=(ne+1)/q;return{minx:ae,miny:fe,maxx:he,maxy:Te,t:M.dem.tree.raycastRoot(ae,fe,he,Te,r,n,c),tile:M}});g.sort((M,L)=>(M.t!==null?M.t:Number.MAX_VALUE)-(L.t!==null?L.t:Number.MAX_VALUE));for(const M of g){if(M.t==null)return null;const L=M.tile.dem.tree.raycast(M.minx,M.miny,M.maxx,M.maxy,r,n,c);if(L!=null)return L}return null}_createFBO(){const r=this.painter.context,n=r.gl,c=this.drapeBufferSize;r.activeTexture.set(n.TEXTURE0);const g=new t.T(r,{width:c[0],height:c[1],data:null},n.RGBA8);g.bind(n.LINEAR,n.CLAMP_TO_EDGE);const M=r.createFramebuffer(c[0],c[1],!0,null);return M.colorAttachment.set(g.texture),M.depthAttachment=new ud(r,M.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,c[0],c[1]),this._stencilRef=0,M.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):M.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:M,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const n=this._style._mergedLayers[r],c=n.isHidden(this.painter.transform.zoom);return n.type==="hillshade"||n.type==="custom"?!c&&n.shouldRedrape():!c&&n.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const c of this._style.getSources())if(c instanceof Ca){r=!0;break}if(!r)return;const n={};for(let c=0;c<this._style.order.length;++c){const g=this._style._mergedLayers[this._style.order[c]],M=this._style.getLayerSourceCache(g);if(M&&!n[M.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof t.a9){n[M.id]=!0;for(const L of this.proxyCoords){const q=this.proxyToSource[L.key][M.id];if(q)for(const K of q)this._clearRenderCacheForTile(M.id,K)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const c in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[c]._source instanceof Wa){r=!0;break}if(!r)return;const n={};for(let c=0;c<this._style.order.length;++c){const g=this._style._mergedLayers[this._style.order[c]],M=this._style.getLayerSourceCache(g);if(!M||n[M.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;const L=g.paint.get("raster-fade-duration");for(const q of this.proxyCoords){const K=this.proxyToSource[q.key][M.id];if(K)for(const ne of K){const ae=ju(M.getTile(ne),M.findLoadedParent(ne,0),M,this.painter.transform,L);(ae.opacity!==1||ae.mix!==0)&&this._clearRenderCacheForTile(M.id,ne)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const r=this._style.order,n=r.length;if(n===0)return;const c=[];this._pendingGroundEffectLayers=[];let g,M=0,L=this._style._mergedLayers[r[M]];for(;!this._style.isLayerDraped(L)&&L.isHidden(this.painter.transform.zoom)&&++M<n;)L=this._style._mergedLayers[r[M]];for(;M<n;++M){const q=this._style._mergedLayers[r[M]];q.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(q)?g===void 0&&(g=M):(q.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(M),g!==void 0&&(c.push({start:g,end:M-1}),g=void 0)))}if(g!==void 0&&c.push({start:g,end:M-1}),c.length!==0){const q=c[c.length-1];this._pendingGroundEffectLayers.every(K=>K>q.end)||t.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=c}_setupRenderCache(r){const n=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,n.renderCache.length>n.renderCachePool.length){const L=Object.values(n.proxyCachedFBO);n.proxyCachedFBO={};for(let q=0;q<L.length;++q){const K=Object.values(L[q]);n.renderCachePool.push(...K)}}return}this._clearRasterLayersFromRenderCache();const c=this.proxyCoords,g=this._tilesDirty;for(let L=c.length-1;L>=0;L--){const q=c[L];if(n.getTileByID(q.key),n.proxyCachedFBO[q.key]!==void 0){const K=r[q.key],ne=this.proxyToSource[q.key];let ae=0;for(const he in ne){const fe=ne[he],Te=K[he];if(!Te||Te.length!==fe.length||fe.some((Ve,je)=>Ve!==Te[je]||g[he]&&g[he].hasOwnProperty(Ve.key))){ae=-1;break}++ae}for(const he in n.proxyCachedFBO[q.key])n.renderCache[n.proxyCachedFBO[q.key][he]].dirty=ae<0||ae!==Object.values(K).length}}const M=[...this._drapedRenderBatches];M.sort((L,q)=>q.end-q.start-(L.end-L.start));for(const L of M)for(const q of c){if(n.proxyCachedFBO[q.key])continue;let K=n.renderCachePool.pop();K===void 0&&n.renderCache.length<50&&(K=n.renderCache.length,n.renderCache.push(this._createFBO())),K!==void 0&&(n.proxyCachedFBO[q.key]={},n.proxyCachedFBO[q.key][L.start]=K,n.renderCache[K].dirty=!0)}this._tilesDirty={}}_setupStencil(r,n,c,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const M=this.painter.context,L=M.gl;if(n.length<=1)return void(this._overlapStencilType=!1);let q;if(c.isTileClipped())q=n.length,this._overlapStencilMode.test={func:L.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(n[0].overscaledZ>n[n.length-1].overscaledZ))return void(this._overlapStencilType=!1);q=1,this._overlapStencilMode.test={func:L.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+q>255&&(M.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=q,this._overlapStencilMode.ref=this._stencilRef,c.isTileClipped()&&this._renderTileClippingMasks(n,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):ai.disabled}_renderTileClippingMasks(r,n){const c=this.painter,g=this.painter.context,M=g.gl;c._tileClippingMaskIDs={},g.setColorMode(pi.disabled),g.setDepthMode(qr.disabled);const L=c.getOrCreateProgram("clippingMask");for(const q of r){const K=c._tileClippingMaskIDs[q.key]=--n;L.draw(c,M.TRIANGLES,qr.disabled,new ai({func:M.ALWAYS,mask:0},K,255,M.KEEP,M.KEEP,M.REPLACE),pi.disabled,ei.disabled,Bs(q.projMatrix),"$clipping",c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}pointCoordinate(r){const n=this.painter.transform;if(r.x<0||r.x>n.width||r.y<0||r.y>n.height)return null;const c=[r.x,r.y,1,1];t.ab.vec4.transformMat4(c,c,n.pixelMatrixInverse),t.ab.vec4.scale(c,c,1/c[3]),c[0]/=n.worldSize,c[1]/=n.worldSize;const g=n._camera.position,M=t.bH(1,n.center.lat),L=[g[0],g[1],g[2]/M,0],q=t.ab.vec3.subtract([],c.slice(0,3),L);t.ab.vec3.normalize(q,q);const K=this.raycast(L,q,this._exaggeration);return K!==null&&K?(t.ab.vec3.scaleAndAdd(L,L,q,K),L[3]=L[2],L[2]*=M,L):null}_setupProxiedCoordsForOrtho(r,n,c){if(r.getSource()instanceof t.aJ)return this._setupProxiedCoordsForImageSource(r,n,c);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const g=this.proxiedCoords[r.id]=[],M=this.proxyCoords;for(let K=0;K<M.length;K++){const ne=M[K],ae=this._findTileCoveringTileID(ne,r);if(ae){const he=this._createProxiedId(ne,ae,c[ne.key]&&c[ne.key][r.id]);g.push(he),this.proxyToSource[ne.key][r.id]=[he]}}let L=!1;const q=new Set;for(let K=0;K<n.length;K++){const ne=r.getTile(n[K]);if(!ne||!ne.hasData())continue;const ae=this._findTileCoveringTileID(ne.tileID,this.proxySourceCache);if(ae&&ae.tileID.canonical.z!==ne.tileID.canonical.z){const he=this.proxyToSource[ae.tileID.key][r.id],fe=this._createProxiedId(ae.tileID,ne,c[ae.tileID.key]&&c[ae.tileID.key][r.id]);he?he.splice(he.length-1,0,fe):this.proxyToSource[ae.tileID.key][r.id]=[fe];const Te=this.proxyToSource[ae.tileID.key][r.id];q.has(Te)||q.add(Te),g.push(fe),L=!0}}if(this._sourceTilesOverlap[r.id]=L,L&&this._debugParams.sortTilesHiZFirst)for(const K of q)K.sort((ne,ae)=>ae.overscaledZ-ne.overscaledZ)}_setupProxiedCoordsForImageSource(r,n,c){if(!r.getSource().loaded())return;const g=this.proxiedCoords[r.id]=[],M=this.proxyCoords,L=r.getSource(),q=L.tileID;if(!q)return;const K=new t.P(q.x,q.y)._div(1<<q.z),ne=L.coordinates.map(t.aa.fromLngLat).reduce((he,fe)=>(he.min.x=Math.min(he.min.x,fe.x-K.x),he.min.y=Math.min(he.min.y,fe.y-K.y),he.max.x=Math.max(he.max.x,fe.x-K.x),he.max.y=Math.max(he.max.y,fe.y-K.y),he),{min:new t.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),ae=(he,fe)=>{const Te=he.wrap+he.canonical.x/(1<<he.canonical.z),Ve=he.canonical.y/(1<<he.canonical.z),je=t.ag/(1<<he.canonical.z),Xe=fe.wrap+fe.canonical.x/(1<<fe.canonical.z),Ye=fe.canonical.y/(1<<fe.canonical.z);return Te+je<Xe+ne.min.x||Te>Xe+ne.max.x||Ve+je<Ye+ne.min.y||Ve>Ye+ne.max.y};for(let he=0;he<M.length;he++){const fe=M[he];for(let Te=0;Te<n.length;Te++){const Ve=r.getTile(n[Te]);if(!Ve||!Ve.hasData()||ae(fe,Ve.tileID))continue;const je=this._createProxiedId(fe,Ve,c[fe.key]&&c[fe.key][r.id]),Xe=this.proxyToSource[fe.key][r.id];Xe?Xe.push(je):this.proxyToSource[fe.key][r.id]=[je],g.push(je)}}}_createProxiedId(r,n,c){let g=this.orthoMatrix;if(c){const M=c.find(L=>L.key===n.tileID.key);if(M)return M}if(n.tileID.key!==r.key){const M=r.canonical.z-n.tileID.canonical.z;let L,q,K;g=t.ab.mat4.create();const ne=n.tileID.wrap-r.wrap<<r.overscaledZ;M>0?(L=t.ag>>M,q=L*((n.tileID.canonical.x<<M)-r.canonical.x+ne),K=L*((n.tileID.canonical.y<<M)-r.canonical.y)):(L=t.ag<<-M,q=t.ag*(n.tileID.canonical.x-(r.canonical.x+ne<<-M)),K=t.ag*(n.tileID.canonical.y-(r.canonical.y<<-M))),t.ab.mat4.ortho(g,0,L,0,L,0,1),t.ab.mat4.translate(g,g,[q,K,0])}return new Vu(n.tileID,r.key,g)}_findTileCoveringTileID(r,n){let c=n.getTile(r);if(c&&c.hasData())return c;const g=this._findCoveringTileCache[n.id],M=g[r.key];if(c=M?n.getTileByID(M):null,c&&c.hasData()||M===null)return c;let L=c?c.tileID:r,q=L.overscaledZ;const K=n.getSource().minzoom,ne=[];if(!M){const he=n.getSource().maxzoom;if(r.canonical.z>=he){const fe=r.canonical.z-he;n.getSource().reparseOverscaled?(q=Math.max(r.canonical.z+2,n.transform.tileZoom),L=new t.aG(q,r.wrap,he,r.canonical.x>>fe,r.canonical.y>>fe)):fe!==0&&(q=he,L=new t.aG(q,r.wrap,he,r.canonical.x>>fe,r.canonical.y>>fe))}L.key!==r.key&&(ne.push(L.key),c=n.getTile(L))}const ae=he=>{ne.forEach(fe=>{g[fe]=he}),ne.length=0};for(q-=1;q>=K&&(!c||!c.hasData());q--){c&&ae(c.tileID.key);const he=L.calculateScaledKey(q);if(c=n.getTileByID(he),c&&c.hasData())break;const fe=g[he];if(fe===null)break;fe===void 0?ne.push(he):c=n.getTileByID(fe)}return ae(c?c.tileID.key:null),c&&c.hasData()?c:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,n){let c=this._tilesDirty[r];c||(c=this._tilesDirty[r]={}),c[n.key]=!0}}function dd(u,r,n){const c=function(q,K,ne){const ae=t.ab.vec3.dot(K,q),he=t.ab.vec3.dot(ne,[.2126,.7152,.0722]),fe=(Ve,je,Xe)=>(1-Xe)*Ve+Xe*je,Te=fe(1-.3*Math.min(he,1),1,Math.min(ae+1,1));return fe(.92,1,Math.asin(t.aw(K[2],-1,1))/Math.PI+.5)*Te}(u,[0,0,1],r),g=[0,0,0];t.ab.vec3.scale(g,n.slice(0,3),c);const M=[0,0,0];t.ab.vec3.scale(M,r.slice(0,3),u[2]);const L=[0,0,0];return t.ab.vec3.add(L,g,M),t.cf(L)}const Al=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Sm=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class pd{static cacheKey(r,n,c,g){let M=`${n}${g?g.cacheKey:""}`;for(const L of c)r.usedDefines.includes(L)&&(M+=`/${L}`);return M}constructor(r,n,c,g,M,L){const q=r.gl;this.program=q.createProgram(),this.configuration=g,this.name=n,this.fixedDefines=[...L];const K=g?g.getBinderAttributes():[],ne=(c.staticAttributes||[]).concat(K);let ae=g?g.defines():[];ae=ae.concat(L.map(Xe=>`#define ${Xe}`));const he=`#version 300 es
`;let fe=he+ae.concat("precision mediump float;",Jc,Ou.fragmentSource).join(`
`);for(const Xe of c.fragmentIncludes)fe+=`
${uo[Xe]}`;fe+=`
${c.fragmentSource}`;let Te=he+ae.concat("precision highp float;",Jc,Ou.vertexSource).join(`
`);for(const Xe of c.vertexIncludes)Te+=`
${uo[Xe]}`;this.forceManualRenderingForInstanceIDShaders=r.forceManualRenderingForInstanceIDShaders&&c.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(Te+=`
uniform int u_instanceID;
`),Te+=`
${c.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(Te=Te.replaceAll("gl_InstanceID","u_instanceID"));const Ve=q.createShader(q.FRAGMENT_SHADER);if(q.isContextLost())return void(this.failedToCreate=!0);q.shaderSource(Ve,fe),q.compileShader(Ve),q.attachShader(this.program,Ve);const je=q.createShader(q.VERTEX_SHADER);if(q.isContextLost())this.failedToCreate=!0;else{q.shaderSource(je,Te),q.compileShader(je),q.attachShader(this.program,je),this.attributes={},this.numAttributes=ne.length;for(let Xe=0;Xe<this.numAttributes;Xe++)if(ne[Xe]){const Ye=ne[Xe].startsWith("a_")?ne[Xe]:`a_${ne[Xe]}`;q.bindAttribLocation(this.program,Xe,Ye),this.attributes[Ye]=Xe}q.linkProgram(this.program),q.deleteShader(je),q.deleteShader(Ve),this.fixedUniforms=M(r),this.binderUniforms=g?g.getUniforms(r):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Xe=>({u_instanceID:new t.bN(Xe)}))(r)),(L.includes("TERRAIN")||n.indexOf("symbol")!==-1||n.indexOf("circle")!==-1)&&(this.terrainUniforms=(Xe=>({u_dem:new t.bN(Xe),u_dem_prev:new t.bN(Xe),u_dem_tl:new t.bK(Xe),u_dem_scale:new t.bM(Xe),u_dem_tl_prev:new t.bK(Xe),u_dem_scale_prev:new t.bM(Xe),u_dem_size:new t.bM(Xe),u_dem_lerp:new t.bM(Xe),u_exaggeration:new t.bM(Xe),u_depth:new t.bN(Xe),u_depth_size_inv:new t.bK(Xe),u_depth_range_unpack:new t.bK(Xe),u_occluder_half_size:new t.bM(Xe),u_occlusion_depth_offset:new t.bM(Xe),u_meter_to_dem:new t.bM(Xe),u_label_plane_matrix_inv:new t.bJ(Xe)}))(r)),L.includes("GLOBE")&&(this.globeUniforms=(Xe=>({u_tile_tl_up:new t.bL(Xe),u_tile_tr_up:new t.bL(Xe),u_tile_br_up:new t.bL(Xe),u_tile_bl_up:new t.bL(Xe),u_tile_up_scale:new t.bM(Xe)}))(r)),L.includes("FOG")&&(this.fogUniforms=(Xe=>({u_fog_matrix:new t.bJ(Xe),u_fog_range:new t.bK(Xe),u_fog_color:new t.ca(Xe),u_fog_horizon_blend:new t.bM(Xe),u_fog_vertical_limit:new t.bK(Xe),u_fog_temporal_offset:new t.bM(Xe),u_frustum_tl:new t.bL(Xe),u_frustum_tr:new t.bL(Xe),u_frustum_br:new t.bL(Xe),u_frustum_bl:new t.bL(Xe),u_globe_pos:new t.bL(Xe),u_globe_radius:new t.bM(Xe),u_globe_transition:new t.bM(Xe),u_is_globe:new t.bN(Xe),u_viewport:new t.bK(Xe)}))(r)),L.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Xe=>({u_cutoff_params:new t.ca(Xe)}))(r)),L.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Xe=>({u_lighting_ambient_color:new t.bL(Xe),u_lighting_directional_dir:new t.bL(Xe),u_lighting_directional_color:new t.bL(Xe),u_ground_radiance:new t.bL(Xe)}))(r)),L.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Xe=>({u_light_matrix_0:new t.bJ(Xe),u_light_matrix_1:new t.bJ(Xe),u_fade_range:new t.bK(Xe),u_shadow_normal_offset:new t.bL(Xe),u_shadow_intensity:new t.bM(Xe),u_shadow_texel_size:new t.bM(Xe),u_shadow_map_resolution:new t.bM(Xe),u_shadow_direction:new t.bL(Xe),u_shadow_bias:new t.bL(Xe),u_shadowmap_0:new t.bN(Xe),u_shadowmap_1:new t.bN(Xe)}))(r))}}setTerrainUniformValues(r,n){if(!this.terrainUniforms)return;const c=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const g in n)c[g]&&c[g].set(this.program,g,n[g])}}setGlobeUniformValues(r,n){if(!this.globeUniforms)return;const c=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const g in n)c[g]&&c[g].set(this.program,g,n[g])}}setFogUniformValues(r,n){if(!this.fogUniforms)return;const c=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const g in n)c[g].set(this.program,g,n[g])}}setCutoffUniformValues(r,n){if(!this.cutoffUniforms)return;const c=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const g in n)c[g].set(this.program,g,n[g])}}setLightsUniformValues(r,n){if(!this.lightsUniforms)return;const c=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const g in n)c[g].set(this.program,g,n[g])}}setShadowUniformValues(r,n){if(this.failedToCreate||!this.shadowUniforms)return;const c=this.shadowUniforms;r.program.set(this.program);for(const g in n)c[g].set(this.program,g,n[g])}_drawDebugWireframe(r,n,c,g,M,L,q,K,ne,ae){const he=r.options.wireframe;if(he.terrain===!1&&he.layers2D===!1&&he.layers3D===!1)return;const fe=r.context;if(!(!(!he.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!he.layers2D||r._terrain&&r._terrain.renderingToTexture||!Al.includes(this.name))||!(!he.layers3D||!Sm.includes(this.name))))return;const Te=fe.gl,Ve=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,M,fe);if(!Ve)return;const je=[...this.fixedDefines];je.push("DEBUG_WIREFRAME");const Xe=r.getOrCreateProgram(this.name,{config:this.configuration,defines:je});fe.program.set(Xe.program);const Ye=(ft,bt,gt)=>{if(bt[ft]&&gt[ft])for(const vt in bt[ft])gt[ft][vt]&&gt[ft][vt].set(gt.program,vt,bt[ft][vt].current)};ne&&ne.setUniforms(Xe.program,fe,Xe.binderUniforms,q,{zoom:K}),Ye("fixedUniforms",this,Xe),Ye("terrainUniforms",this,Xe),Ye("globeUniforms",this,Xe),Ye("fogUniforms",this,Xe),Ye("lightsUniforms",this,Xe),Ye("shadowUniforms",this,Xe),Ve.bind(),fe.setColorMode(new pi([Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ZERO,Te.ONE],t.aj.transparent,[!0,!0,!0,!1])),fe.setDepthMode(new qr(n.func===Te.LESS?Te.LEQUAL:n.func,qr.ReadOnly,n.range)),fe.setStencilMode(ai.disabled);const at=3*L.primitiveLength*2,pt=3*L.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ft=ae||1;for(let bt=0;bt<ft;++bt)Xe.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",bt),Te.drawElements(Te.LINES,at,Te.UNSIGNED_SHORT,pt)}else ae&&ae>1?Te.drawElementsInstanced(Te.LINES,at,Te.UNSIGNED_SHORT,pt,ae):Te.drawElements(Te.LINES,at,Te.UNSIGNED_SHORT,pt);M.bind(),fe.program.set(this.program),fe.setDepthMode(n),fe.setStencilMode(c),fe.setColorMode(g)}checkUniforms(r,n,c){if(this.fixedDefines.includes(n)){for(const g of Object.keys(c))if(!c[g].initialized)throw new Error(`Program '${this.name}', from draw '${r}': uniform ${g} not set but required by ${n} being defined`)}}draw(r,n,c,g,M,L,q,K,ne,ae,he,fe,Te,Ve,je,Xe){const Ye=r.context,at=Ye.gl;if(this.failedToCreate)return;Ye.program.set(this.program),Ye.setDepthMode(c),Ye.setStencilMode(g),Ye.setColorMode(M),Ye.setCullFace(L);for(const bt of Object.keys(this.fixedUniforms))this.fixedUniforms[bt].set(this.program,bt,q[bt]);Ve&&Ve.setUniforms(this.program,Ye,this.binderUniforms,fe,{zoom:Te});const pt={[at.POINTS]:1,[at.LINES]:2,[at.TRIANGLES]:3,[at.LINE_STRIP]:1}[n];this.checkUniforms(K,"RENDER_SHADOWS",this.shadowUniforms);const ft=Xe&&Xe>0?1:void 0;for(const bt of he.get()){const gt=bt.vaos||(bt.vaos={});if((gt[K]||(gt[K]=new ed)).bind(Ye,this,ne,Ve?Ve.getPaintVertexBuffers():[],ae,bt.vertexOffset,je||[],ft),this.forceManualRenderingForInstanceIDShaders){const vt=Xe||1;for(let yt=0;yt<vt;++yt)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",yt),ae?at.drawElements(n,bt.primitiveLength*pt,at.UNSIGNED_SHORT,bt.primitiveOffset*pt*2):at.drawArrays(n,bt.vertexOffset,bt.vertexLength)}else Xe&&Xe>1?at.drawElementsInstanced(n,bt.primitiveLength*pt,at.UNSIGNED_SHORT,bt.primitiveOffset*pt*2,Xe):ae?at.drawElements(n,bt.primitiveLength*pt,at.UNSIGNED_SHORT,bt.primitiveOffset*pt*2):at.drawArrays(n,bt.vertexOffset,bt.vertexLength);n===at.TRIANGLES&&ae&&this._drawDebugWireframe(r,c,g,M,ae,bt,fe,Te,Ve,Xe)}}}function ph(u,r){const n=Math.pow(2,r.tileID.overscaledZ),c=r.tileSize*Math.pow(2,u.transform.tileZoom)/n,g=c*(r.tileID.canonical.x+r.tileID.wrap*n),M=c*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/t.ar(r,1,u.transform.tileZoom),u_pixel_coord_upper:[g>>16,M>>16],u_pixel_coord_lower:[65535&g,65535&M]}}const Gu={terrain:0,flat:1},mh=t.ab.mat4.create(),Hu=(u,r,n,c,g,M,L,q,K,ne,ae,he,fe,Te,Ve,je,Xe,Ye)=>{const at=r.style.light,pt=at.properties.get("position"),ft=[pt.x,pt.y,pt.z],bt=t.ab.mat3.create();at.properties.get("anchor")==="viewport"&&(t.ab.mat3.fromRotation(bt,-r.transform.angle),t.ab.vec3.transformMat3(ft,ft,bt));const gt=at.properties.get("color"),vt=r.transform,yt={u_matrix:u,u_lightpos:ft,u_lightintensity:at.properties.get("intensity"),u_lightcolor:[gt.r,gt.g,gt.b],u_vertical_gradient:+n,u_opacity:c,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:mh,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Gu[ne],u_base_type:Gu[ae],u_ao:g,u_edge_radius:M,u_width_scale:L,u_flood_light_color:Ve,u_vertical_scale:je,u_flood_light_intensity:Xe,u_ground_shadow_factor:Ye};return vt.projection.name==="globe"&&(yt.u_tile_id=[q.canonical.x,q.canonical.y,1<<q.canonical.z],yt.u_zoom_transition=he,yt.u_inv_rot_matrix=Te,yt.u_merc_center=fe,yt.u_up_dir=vt.projection.upVector(new t.bT(0,0,0),fe[0]*t.ag,fe[1]*t.ag),yt.u_height_lift=K),yt},Il=(u,r,n,c,g,M)=>({u_matrix:u,u_edge_radius:r,u_width_scale:n,u_vertical_scale:c,u_height_type:Gu[g],u_base_type:Gu[M]}),_h=(u,r,n,c,g,M,L,q,K,ne,ae,he,fe,Te,Ve,je,Xe)=>{const Ye=Hu(u,r,n,c,g,M,L,q,ne,ae,he,fe,Te,Ve,je,Xe,1,[0,0,0]),at={u_height_factor:-Math.pow(2,q.overscaledZ)/K.tileSize/8};return t.l(Ye,ph(r,K),at)},Fs=(u,r)=>({u_matrix:u,u_emissive_strength:r}),gh=(u,r,n,c)=>t.l(Fs(u,r),ph(n,c)),qu=(u,r,n)=>({u_matrix:u,u_world:n,u_emissive_strength:r}),Wu=(u,r,n,c,g)=>t.l(gh(u,r,n,c),{u_world:g}),yh=(u,r,n,c)=>{const g=t.ag/n.tileSize;return{u_matrix:u,u_camera_to_center_distance:r.getCameraToCenterDistance(c),u_extrude_scale:[r.pixelsToGLUnits[0]/g,r.pixelsToGLUnits[1]/g]}},vh=(u,r,n=1)=>({u_matrix:u,u_color:r.toRenderColor(null),u_overlay:0,u_overlay_scale:n}),Mm=t.ab.mat4.create(),Ns=(u,r,n,c,g,M,L)=>{const q=u.transform,K=q.projection.name==="globe",ne=K?t.cN(q.zoom,r.canonical)*q._pixelsPerMercatorPixel:t.ar(n,1,M),ae={u_matrix:r.projMatrix,u_extrude_scale:ne,u_intensity:L,u_inv_rot_matrix:Mm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(K){ae.u_inv_rot_matrix=c,ae.u_merc_center=g,ae.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],ae.u_zoom_transition=t.ae(q.zoom);const he=g[0]*t.ag,fe=g[1]*t.ag;ae.u_up_dir=q.projection.upVector(new t.bT(0,0,0),he,fe)}return ae};function Pl(u,[r,n,c,g],[M,L]){if(M===L)return[0,0,0,0];const q=255*(u-1)/(u*(L-M));return[r*q,n*q,c*q,g*q]}function Dr(u,r,[n,c]){return n===c?0:.5/u+(r-n)*(u-1)/(u*(c-n))}const bh=(u,r,n,c,g,M,L,q,K,ne,ae,he,fe,Te,Ve,je,Xe,Ye,at,pt,ft)=>({u_matrix:u,u_normalize_matrix:r,u_globe_matrix:n,u_merc_matrix:c,u_grid_matrix:g,u_tl_parent:M,u_scale_parent:ne,u_fade_t:ae.mix,u_opacity:ae.opacity*he.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:he.paint.get("raster-brightness-min"),u_brightness_high:he.paint.get("raster-brightness-max"),u_saturation_factor:t.cO(he.paint.get("raster-saturation")),u_contrast_factor:t.cP(he.paint.get("raster-contrast")),u_spin_weights:md(he.paint.get("raster-hue-rotate")),u_perspective_transform:fe,u_raster_elevation:Te,u_zoom_transition:L,u_merc_center:q,u_cutoff_params:K,u_colorization_mix:Pl(t.cQ,je,Ye),u_colorization_offset:Dr(t.cQ,Xe,Ye),u_color_ramp:Ve,u_texture_offset:[pt/(at+2*pt),at/(at+2*pt)],u_texture_res:[at+2*pt,at+2*pt],u_emissive_strength:ft});function md(u){u*=Math.PI/180;const r=Math.sin(u),n=Math.cos(u);return[(2*n+1)/3,(-Math.sqrt(3)*r-n+1)/3,(Math.sqrt(3)*r-n+1)/3]}const Ea=.05,is=(u,r,n,c,g,M,L,q,K,ne,ae,he)=>({u_matrix:u,u_normalize_matrix:r,u_globe_matrix:n,u_merc_matrix:c,u_grid_matrix:g,u_tl_parent:M,u_scale_parent:ne,u_fade_t:ae.mix,u_opacity:ae.opacity,u_image0:0,u_image1:1,u_raster_elevation:he,u_zoom_transition:L,u_merc_center:q,u_cutoff_params:K}),jr=(u,r,n,c,g,M,L,q,K,ne)=>({u_particle_texture:u,u_particle_texture_side_len:r,u_tile_offset:n,u_velocity:c,u_color_ramp:M,u_velocity_res:g,u_max_speed:L,u_uv_offset:q,u_data_scale:[255*K[0],255*K[1]],u_data_offset:ne,u_particle_pos_scale:1.1,u_particle_pos_offset:[Ea,Ea]}),xh=(u,r,n,c,g,M,L,q,K,ne)=>({u_particle_texture:u,u_particle_texture_side_len:r,u_velocity:n,u_velocity_res:c,u_max_speed:g,u_speed_factor:M,u_reset_rate:L,u_rand_seed:Math.random(),u_uv_offset:q,u_data_scale:[255*K[0],255*K[1]],u_data_offset:ne,u_particle_pos_scale:1.1,u_particle_pos_offset:[Ea,Ea]}),_d=t.ab.mat4.create(),gd=(u,r,n,c,g,M,L,q,K,ne,ae,he,fe,Te,Ve,je,Xe,Ye,at,pt,ft,bt)=>{const gt=g.transform,vt={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:gt.getCameraToCenterDistance(at),u_rotate_symbol:+n,u_aspect_ratio:gt.width/gt.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:M,u_label_plane_matrix:L,u_coord_matrix:q,u_is_text:+ne,u_elevation_from_sea:K?1:0,u_pitch_with_map:+c,u_texsize:ae,u_texsize_icon:he,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:_d,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:_d,u_up_vector:[0,-1,0],u_color_adj_mat:pt,u_icon_transition:ft||0,u_gamma_scale:c?g.transform.getCameraToCenterDistance(at)*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:t.q.devicePixelRatio,u_is_halo:1,u_scale_factor:bt||1};return at.name==="globe"&&(vt.u_tile_id=[Te.canonical.x,Te.canonical.y,1<<Te.canonical.z],vt.u_zoom_transition=Ve,vt.u_inv_rot_matrix=Xe,vt.u_merc_center=je,vt.u_camera_forward=gt._camera.forward(),vt.u_ecef_origin=t.cR(gt.globeMatrix,Te.toUnwrapped()),vt.u_tile_matrix=Float32Array.from(gt.globeMatrix),vt.u_up_vector=Ye),vt},$u=(u,r,n,c)=>({u_matrix:u,u_emissive_strength:r,u_opacity:n,u_color:c}),wh=(u,r,n,c,g,M,L,q,K)=>t.l(function(ne,ae,he,fe,Te,Ve){const{width:je,height:Xe}=fe.imageManager.getPixelSize(ae),Ye=Math.pow(2,Ve.tileID.overscaledZ),at=Ve.tileSize*Math.pow(2,fe.transform.tileZoom)/Ye,pt=at*(Ve.tileID.canonical.x+Ve.tileID.wrap*Ye),ft=at*Ve.tileID.canonical.y;return{u_image:0,u_pattern_tl:he.tl,u_pattern_br:he.br,u_texsize:[je,Xe],u_pattern_size:he.displaySize,u_pattern_units_to_pixels:Te?[fe.transform.width,-1*fe.transform.height]:[1/t.ar(Ve,1,fe.transform.tileZoom),1/t.ar(Ve,1,fe.transform.tileZoom)],u_pixel_coord_upper:[pt>>16,ft>>16],u_pixel_coord_lower:[65535&pt,65535&ft]}}(0,M,L,c,q,K),{u_matrix:u,u_emissive_strength:r,u_opacity:n}),Zu=new Float32Array(t.ab.mat4.identity([])),Eh=(u,r,n,c,g,M,L,q,K,ne,ae,he,fe,Te=[0,0,0],Ve)=>{const je=g.style.light,Xe=je.properties.get("position"),Ye=[-Xe.x,-Xe.y,Xe.z],at=t.ab.mat3.create();je.properties.get("anchor")==="viewport"&&(t.ab.mat3.fromRotation(at,-g.transform.angle),t.ab.vec3.transformMat3(Ye,Ye,at));const pt=ae.alphaMode==="MASK",ft=je.properties.get("color").toRenderColor(null),bt=fe.paint.get("model-ambient-occlusion-intensity"),gt=fe.paint.get("model-color").constantOr(t.aj.white).toRenderColor(null),vt=fe.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:u,u_lighting_matrix:r,u_normal_matrix:n,u_node_matrix:c||Zu,u_lightpos:Ye,u_lightintensity:je.properties.get("intensity"),u_lightcolor:[ft.r,ft.g,ft.b],u_camera_pos:Te,u_opacity:M,u_baseTextureIsAlpha:0,u_alphaMask:+pt,u_alphaCutoff:ae.alphaCutoff,u_baseColorFactor:[L.r,L.g,L.b,L.a],u_emissiveFactor:[q[0],q[1],q[2],1],u_metallicFactor:K,u_roughnessFactor:ne,u_baseColorTexture:Ln.BaseColor,u_metallicRoughnessTexture:Ln.MetallicRoughness,u_normalTexture:Ln.Normal,u_occlusionTexture:Ln.Occlusion,u_emissionTexture:Ln.Emission,u_lutTexture:Ln.LUT,u_color_mix:[gt.r,gt.g,gt.b,vt],u_aoIntensity:bt,u_emissive_strength:he,u_occlusionTextureTransform:Ve||[0,0,0,0]}},yd=(u,r=Zu,n=Zu)=>({u_matrix:u,u_instance:r,u_node_matrix:n}),Th={fillExtrusion:u=>({u_matrix:new t.bJ(u),u_lightpos:new t.bL(u),u_lightintensity:new t.bM(u),u_lightcolor:new t.bL(u),u_vertical_gradient:new t.bM(u),u_opacity:new t.bM(u),u_edge_radius:new t.bM(u),u_width_scale:new t.bM(u),u_ao:new t.bK(u),u_height_type:new t.bN(u),u_base_type:new t.bN(u),u_tile_id:new t.bL(u),u_zoom_transition:new t.bM(u),u_inv_rot_matrix:new t.bJ(u),u_merc_center:new t.bK(u),u_up_dir:new t.bL(u),u_height_lift:new t.bM(u),u_flood_light_color:new t.bL(u),u_vertical_scale:new t.bM(u),u_flood_light_intensity:new t.bM(u),u_ground_shadow_factor:new t.bL(u)}),fillExtrusionDepth:u=>({u_matrix:new t.bJ(u),u_edge_radius:new t.bM(u),u_width_scale:new t.bM(u),u_vertical_scale:new t.bM(u),u_height_type:new t.bN(u),u_base_type:new t.bN(u)}),fillExtrusionPattern:u=>({u_matrix:new t.bJ(u),u_lightpos:new t.bL(u),u_lightintensity:new t.bM(u),u_lightcolor:new t.bL(u),u_vertical_gradient:new t.bM(u),u_height_factor:new t.bM(u),u_edge_radius:new t.bM(u),u_width_scale:new t.bM(u),u_ao:new t.bK(u),u_height_type:new t.bN(u),u_base_type:new t.bN(u),u_tile_id:new t.bL(u),u_zoom_transition:new t.bM(u),u_inv_rot_matrix:new t.bJ(u),u_merc_center:new t.bK(u),u_up_dir:new t.bL(u),u_height_lift:new t.bM(u),u_image:new t.bN(u),u_texsize:new t.bK(u),u_pixel_coord_upper:new t.bK(u),u_pixel_coord_lower:new t.bK(u),u_tile_units_to_pixels:new t.bM(u),u_opacity:new t.bM(u)}),fillExtrusionGroundEffect:u=>({u_matrix:new t.bJ(u),u_opacity:new t.bM(u),u_ao_pass:new t.bM(u),u_meter_to_tile:new t.bM(u),u_ao:new t.bK(u),u_flood_light_intensity:new t.bM(u),u_flood_light_color:new t.bL(u),u_attenuation:new t.bM(u),u_edge_radius:new t.bM(u),u_fb:new t.bN(u),u_fb_size:new t.bM(u),u_dynamic_offset:new t.bM(u)}),fill:u=>({u_matrix:new t.bJ(u),u_emissive_strength:new t.bM(u)}),fillPattern:u=>({u_matrix:new t.bJ(u),u_emissive_strength:new t.bM(u),u_image:new t.bN(u),u_texsize:new t.bK(u),u_pixel_coord_upper:new t.bK(u),u_pixel_coord_lower:new t.bK(u),u_tile_units_to_pixels:new t.bM(u)}),fillOutline:u=>({u_matrix:new t.bJ(u),u_emissive_strength:new t.bM(u),u_world:new t.bK(u)}),fillOutlinePattern:u=>({u_matrix:new t.bJ(u),u_emissive_strength:new t.bM(u),u_world:new t.bK(u),u_image:new t.bN(u),u_texsize:new t.bK(u),u_pixel_coord_upper:new t.bK(u),u_pixel_coord_lower:new t.bK(u),u_tile_units_to_pixels:new t.bM(u)}),circle:t.cS,collisionBox:u=>({u_matrix:new t.bJ(u),u_camera_to_center_distance:new t.bM(u),u_extrude_scale:new t.bK(u)}),collisionCircle:u=>({u_matrix:new t.bJ(u),u_inv_matrix:new t.bJ(u),u_camera_to_center_distance:new t.bM(u),u_viewport_size:new t.bK(u)}),debug:u=>({u_color:new t.cz(u),u_matrix:new t.bJ(u),u_overlay:new t.bN(u),u_overlay_scale:new t.bM(u)}),clippingMask:u=>({u_matrix:new t.bJ(u)}),heatmap:u=>({u_extrude_scale:new t.bM(u),u_intensity:new t.bM(u),u_matrix:new t.bJ(u),u_inv_rot_matrix:new t.bJ(u),u_merc_center:new t.bK(u),u_tile_id:new t.bL(u),u_zoom_transition:new t.bM(u),u_up_dir:new t.bL(u)}),heatmapTexture:u=>({u_image:new t.bN(u),u_color_ramp:new t.bN(u),u_opacity:new t.bM(u)}),hillshade:u=>({u_matrix:new t.bJ(u),u_image:new t.bN(u),u_latrange:new t.bK(u),u_light:new t.bK(u),u_shadow:new t.cz(u),u_highlight:new t.cz(u),u_emissive_strength:new t.bM(u),u_accent:new t.cz(u)}),hillshadePrepare:u=>({u_matrix:new t.bJ(u),u_image:new t.bN(u),u_dimension:new t.bK(u),u_zoom:new t.bM(u)}),line:t.cT,linePattern:t.cU,raster:u=>({u_matrix:new t.bJ(u),u_normalize_matrix:new t.bJ(u),u_globe_matrix:new t.bJ(u),u_merc_matrix:new t.bJ(u),u_grid_matrix:new t.cA(u),u_tl_parent:new t.bK(u),u_scale_parent:new t.bM(u),u_fade_t:new t.bM(u),u_opacity:new t.bM(u),u_image0:new t.bN(u),u_image1:new t.bN(u),u_brightness_low:new t.bM(u),u_brightness_high:new t.bM(u),u_saturation_factor:new t.bM(u),u_contrast_factor:new t.bM(u),u_spin_weights:new t.bL(u),u_perspective_transform:new t.bK(u),u_raster_elevation:new t.bM(u),u_zoom_transition:new t.bM(u),u_merc_center:new t.bK(u),u_cutoff_params:new t.ca(u),u_colorization_mix:new t.ca(u),u_colorization_offset:new t.bM(u),u_color_ramp:new t.bN(u),u_texture_offset:new t.bK(u),u_texture_res:new t.bK(u),u_emissive_strength:new t.bM(u)}),rasterParticle:u=>({u_matrix:new t.bJ(u),u_normalize_matrix:new t.bJ(u),u_globe_matrix:new t.bJ(u),u_merc_matrix:new t.bJ(u),u_grid_matrix:new t.cA(u),u_tl_parent:new t.bK(u),u_scale_parent:new t.bM(u),u_fade_t:new t.bM(u),u_opacity:new t.bM(u),u_image0:new t.bN(u),u_image1:new t.bN(u),u_raster_elevation:new t.bM(u),u_zoom_transition:new t.bM(u),u_merc_center:new t.bK(u),u_cutoff_params:new t.ca(u)}),rasterParticleTexture:u=>({u_texture:new t.bN(u),u_opacity:new t.bM(u)}),rasterParticleDraw:u=>({u_particle_texture:new t.bN(u),u_particle_texture_side_len:new t.bM(u),u_tile_offset:new t.bK(u),u_velocity:new t.bN(u),u_color_ramp:new t.bN(u),u_velocity_res:new t.bK(u),u_max_speed:new t.bM(u),u_uv_offset:new t.bK(u),u_data_scale:new t.bK(u),u_data_offset:new t.bM(u),u_particle_pos_scale:new t.bM(u),u_particle_pos_offset:new t.bK(u)}),rasterParticleUpdate:u=>({u_particle_texture:new t.bN(u),u_particle_texture_side_len:new t.bM(u),u_velocity:new t.bN(u),u_velocity_res:new t.bK(u),u_max_speed:new t.bM(u),u_speed_factor:new t.bM(u),u_reset_rate:new t.bM(u),u_rand_seed:new t.bM(u),u_uv_offset:new t.bK(u),u_data_scale:new t.bK(u),u_data_offset:new t.bM(u),u_particle_pos_scale:new t.bM(u),u_particle_pos_offset:new t.bK(u)}),symbol:u=>({u_is_size_zoom_constant:new t.bN(u),u_is_size_feature_constant:new t.bN(u),u_size_t:new t.bM(u),u_size:new t.bM(u),u_camera_to_center_distance:new t.bM(u),u_rotate_symbol:new t.bN(u),u_aspect_ratio:new t.bM(u),u_fade_change:new t.bM(u),u_matrix:new t.bJ(u),u_label_plane_matrix:new t.bJ(u),u_coord_matrix:new t.bJ(u),u_is_text:new t.bN(u),u_elevation_from_sea:new t.bN(u),u_pitch_with_map:new t.bN(u),u_texsize:new t.bK(u),u_texsize_icon:new t.bK(u),u_texture:new t.bN(u),u_texture_icon:new t.bN(u),u_gamma_scale:new t.bM(u),u_device_pixel_ratio:new t.bM(u),u_tile_id:new t.bL(u),u_zoom_transition:new t.bM(u),u_inv_rot_matrix:new t.bJ(u),u_merc_center:new t.bK(u),u_camera_forward:new t.bL(u),u_tile_matrix:new t.bJ(u),u_up_vector:new t.bL(u),u_ecef_origin:new t.bL(u),u_is_halo:new t.bN(u),u_icon_transition:new t.bM(u),u_color_adj_mat:new t.bJ(u),u_scale_factor:new t.bM(u)}),background:u=>({u_matrix:new t.bJ(u),u_emissive_strength:new t.bM(u),u_opacity:new t.bM(u),u_color:new t.cz(u)}),backgroundPattern:u=>({u_matrix:new t.bJ(u),u_emissive_strength:new t.bM(u),u_opacity:new t.bM(u),u_image:new t.bN(u),u_pattern_tl:new t.bK(u),u_pattern_br:new t.bK(u),u_texsize:new t.bK(u),u_pattern_size:new t.bK(u),u_pixel_coord_upper:new t.bK(u),u_pixel_coord_lower:new t.bK(u),u_pattern_units_to_pixels:new t.bK(u)}),terrainRaster:u=>({u_matrix:new t.bJ(u),u_image0:new t.bN(u),u_skirt_height:new t.bM(u),u_ground_shadow_factor:new t.bL(u)}),skybox:u=>({u_matrix:new t.bJ(u),u_sun_direction:new t.bL(u),u_cubemap:new t.bN(u),u_opacity:new t.bM(u),u_temporal_offset:new t.bM(u)}),skyboxGradient:u=>({u_matrix:new t.bJ(u),u_color_ramp:new t.bN(u),u_center_direction:new t.bL(u),u_radius:new t.bM(u),u_opacity:new t.bM(u),u_temporal_offset:new t.bM(u)}),skyboxCapture:u=>({u_matrix_3f:new t.cA(u),u_sun_direction:new t.bL(u),u_sun_intensity:new t.bM(u),u_color_tint_r:new t.ca(u),u_color_tint_m:new t.ca(u),u_luminance:new t.bM(u)}),globeRaster:u=>({u_proj_matrix:new t.bJ(u),u_globe_matrix:new t.bJ(u),u_normalize_matrix:new t.bJ(u),u_merc_matrix:new t.bJ(u),u_zoom_transition:new t.bM(u),u_merc_center:new t.bK(u),u_image0:new t.bN(u),u_grid_matrix:new t.cA(u),u_skirt_height:new t.bM(u),u_far_z_cutoff:new t.bM(u),u_frustum_tl:new t.bL(u),u_frustum_tr:new t.bL(u),u_frustum_br:new t.bL(u),u_frustum_bl:new t.bL(u),u_globe_pos:new t.bL(u),u_globe_radius:new t.bM(u),u_viewport:new t.bK(u)}),globeAtmosphere:u=>({u_frustum_tl:new t.bL(u),u_frustum_tr:new t.bL(u),u_frustum_br:new t.bL(u),u_frustum_bl:new t.bL(u),u_horizon:new t.bM(u),u_transition:new t.bM(u),u_fadeout_range:new t.bM(u),u_color:new t.ca(u),u_high_color:new t.ca(u),u_space_color:new t.ca(u),u_temporal_offset:new t.bM(u),u_horizon_angle:new t.bM(u)}),model:u=>({u_matrix:new t.bJ(u),u_lighting_matrix:new t.bJ(u),u_normal_matrix:new t.bJ(u),u_node_matrix:new t.bJ(u),u_lightpos:new t.bL(u),u_lightintensity:new t.bM(u),u_lightcolor:new t.bL(u),u_camera_pos:new t.bL(u),u_opacity:new t.bM(u),u_baseColorFactor:new t.ca(u),u_emissiveFactor:new t.ca(u),u_metallicFactor:new t.bM(u),u_roughnessFactor:new t.bM(u),u_baseTextureIsAlpha:new t.bN(u),u_alphaMask:new t.bN(u),u_alphaCutoff:new t.bM(u),u_baseColorTexture:new t.bN(u),u_metallicRoughnessTexture:new t.bN(u),u_normalTexture:new t.bN(u),u_occlusionTexture:new t.bN(u),u_emissionTexture:new t.bN(u),u_lutTexture:new t.bN(u),u_color_mix:new t.ca(u),u_aoIntensity:new t.bM(u),u_emissive_strength:new t.bM(u),u_occlusionTextureTransform:new t.ca(u)}),modelDepth:u=>({u_matrix:new t.bJ(u),u_instance:new t.bJ(u),u_node_matrix:new t.bJ(u)}),groundShadow:u=>({u_matrix:new t.bJ(u),u_ground_shadow_factor:new t.bL(u)}),stars:u=>({u_matrix:new t.bJ(u),u_up:new t.bL(u),u_right:new t.bL(u),u_intensity_multiplier:new t.bM(u)}),snowParticle:u=>({u_modelview:new t.bJ(u),u_projection:new t.bJ(u),u_time:new t.bM(u),u_cam_pos:new t.bL(u),u_velocityConeAperture:new t.bM(u),u_velocity:new t.bM(u),u_horizontalOscillationRadius:new t.bM(u),u_horizontalOscillationRate:new t.bM(u),u_boxSize:new t.bM(u),u_billboardSize:new t.bM(u),u_simpleShapeParameters:new t.bK(u),u_screenSize:new t.bK(u),u_thinningCenterPos:new t.bK(u),u_thinningShape:new t.bL(u),u_thinningAffectedRatio:new t.bM(u),u_thinningParticleOffset:new t.bM(u),u_particleColor:new t.ca(u),u_direction:new t.bL(u)}),rainParticle:u=>({u_modelview:new t.bJ(u),u_projection:new t.bJ(u),u_time:new t.bM(u),u_cam_pos:new t.bL(u),u_texScreen:new t.bN(u),u_velocityConeAperture:new t.bM(u),u_velocity:new t.bM(u),u_boxSize:new t.bM(u),u_rainDropletSize:new t.bK(u),u_distortionStrength:new t.bM(u),u_rainDirection:new t.bL(u),u_color:new t.ca(u),u_screenSize:new t.bK(u),u_thinningCenterPos:new t.bK(u),u_thinningShape:new t.bL(u),u_thinningAffectedRatio:new t.bM(u),u_thinningParticleOffset:new t.bM(u),u_shapeDirectionalPower:new t.bM(u),u_shapeNormalPower:new t.bM(u),u_mode:new t.bM(u)}),vignette:u=>({u_vignetteShape:new t.bL(u),u_vignetteColor:new t.ca(u)}),occlusion:u=>({u_matrix:new t.bJ(u),u_anchorPos:new t.bL(u),u_screenSizePx:new t.bK(u),u_occluderSizePx:new t.bK(u),u_color:new t.ca(u)})};class Xa{constructor(r,n,c,g){this.id=Xa.uniqueIdxCounter,Xa.uniqueIdxCounter++,this.context=r;const M=r.gl;this.buffer=M.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),M.bufferData(M.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||g||n.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){this.id=Xa.uniqueIdxCounter,Xa.uniqueIdxCounter++;const n=this.context.gl;this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Xa.uniqueIdxCounter=0;const Sh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Mh{constructor(r,n,c,g,M,L){this.length=n.length,this.attributes=c,this.itemSize=n.bytesPerElement,this.dynamicDraw=g,this.instanceCount=L,this.context=r;const q=r.gl;this.buffer=q.createBuffer(),r.bindVertexBuffer.set(this.buffer),q.bufferData(q.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?q.DYNAMIC_DRAW:q.STATIC_DRAW),this.dynamicDraw||M||n.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,n){for(let c=0;c<this.attributes.length;c++){const g=n.attributes[this.attributes[c].name];g!==void 0&&r.enableVertexAttribArray(g)}}setVertexAttribPointers(r,n,c){for(let g=0;g<this.attributes.length;g++){const M=this.attributes[g],L=n.attributes[M.name];L!==void 0&&r.vertexAttribPointer(L,M.components,r[Sh[M.type]],!1,this.itemSize,M.offset+this.itemSize*(c||0))}}setVertexAttribDivisor(r,n,c){for(let g=0;g<this.attributes.length;g++){const M=n.attributes[this.attributes[g].name];M!==void 0&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(M,c)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Yn{constructor(r,n,c,g,M){this.context=r,this.width=n,this.height=c;const L=this.framebuffer=r.gl.createFramebuffer();g&&(this.colorAttachment=new lh(r,L)),M&&(this.depthAttachmentType=M,this.depthAttachment=M==="renderbuffer"?new uh(r,L):new ks(r,L))}destroy(){const r=this.context.gl;if(this.colorAttachment){const n=this.colorAttachment.get();n&&r.deleteTexture(n)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const n=this.depthAttachment.get();n&&r.deleteRenderbuffer(n)}else{const n=this.depthAttachment.get();n&&r.deleteTexture(n)}r.deleteFramebuffer(this.framebuffer)}}class Po{constructor(r,n){this.gl=r,this.clearColor=new _m(this),this.clearDepth=new gm(this),this.clearStencil=new Qc(this),this.colorMask=new eh(this),this.depthMask=new th(this),this.stencilMask=new rh(this),this.stencilFunc=new nd(this),this.stencilOp=new ad(this),this.stencilTest=new ym(this),this.depthRange=new Tl(this),this.depthTest=new Sl(this),this.depthFunc=new od(this),this.blend=new aa(this),this.blendFunc=new ih(this),this.blendColor=new ku(this),this.blendEquation=new Bu(this),this.cullFace=new nh(this),this.cullFaceSide=new ah(this),this.frontFace=new Fu(this),this.program=new oh(this),this.activeTexture=new sh(this),this.viewport=new Nu(this),this.bindFramebuffer=new sd(this),this.bindRenderbuffer=new ld(this),this.bindTexture=new zs(this),this.bindVertexBuffer=new vm(this),this.bindElementBuffer=new bm(this),this.bindVertexArrayOES=new xm(this),this.pixelStoreUnpack=new wm(this),this.pixelStoreUnpackPremultiplyAlpha=new Em(this),this.pixelStoreUnpackFlipY=new Tm(this),this.options=n?{...n}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=n&&!!n.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.maxPointSize=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,n,c){return new Xa(this,r,n,c)}createVertexBuffer(r,n,c,g,M){return new Mh(this,r,n,c,g,M)}createRenderbuffer(r,n,c){const g=this.gl,M=g.createRenderbuffer();return this.bindRenderbuffer.set(M),g.renderbufferStorage(g.RENDERBUFFER,r,n,c),this.bindRenderbuffer.set(null),M}createFramebuffer(r,n,c,g){return new Yn(this,r,n,c,g)}clear({color:r,depth:n,stencil:c,colorMask:g}){const M=this.gl;let L=0;r&&(L|=M.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set(g||[!0,!0,!0,!0])),n!==void 0&&(L|=M.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),c!==void 0&&(L|=M.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),M.clear(L)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){t.bn(r.blendFunction,pi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Cl;function Xu(u,r,n,c,g,M,L){const q=u.context,K=q.gl,ne=u.transform,ae=u.getOrCreateProgram("collisionBox"),he=[];let fe=0,Te=0;for(let ft=0;ft<c.length;ft++){const bt=c[ft],gt=r.getTile(bt),vt=gt.getBucket(n);if(!vt)continue;const yt=dn(bt,vt,ne);let Tt=yt;g[0]===0&&g[1]===0||(Tt=u.translatePosMatrix(yt,gt,g,M));const Dt=L?vt.textCollisionBox:vt.iconCollisionBox,Zt=vt.collisionCircleArray;if(Zt.length>0){const Ht=t.ab.mat4.create(),Pt=Tt;t.ab.mat4.mul(Ht,vt.placementInvProjMatrix,ne.glCoordMatrix),t.ab.mat4.mul(Ht,Ht,vt.placementViewportMatrix),he.push({circleArray:Zt,circleOffset:Te,transform:Pt,invTransform:Ht,projection:vt.getProjection()}),fe+=Zt.length/4,Te=fe}Dt&&(u.terrain&&u.terrain.setupElevationDraw(gt,ae),ae.draw(u,K.LINES,qr.disabled,ai.disabled,u.colorModeForRenderPass(),ei.disabled,yh(Tt,ne,gt,vt.getProjection()),n.id,Dt.layoutVertexBuffer,Dt.indexBuffer,Dt.segments,null,ne.zoom,null,[Dt.collisionVertexBuffer,Dt.collisionVertexBufferExt]))}if(!L||!he.length)return;const Ve=u.getOrCreateProgram("collisionCircle"),je=new t.cV;je.resize(4*fe),je._trim();let Xe=0;for(const ft of he)for(let bt=0;bt<ft.circleArray.length/4;bt++){const gt=4*bt,vt=ft.circleArray[gt+0],yt=ft.circleArray[gt+1],Tt=ft.circleArray[gt+2],Dt=ft.circleArray[gt+3];je.emplace(Xe++,vt,yt,Tt,Dt,0),je.emplace(Xe++,vt,yt,Tt,Dt,1),je.emplace(Xe++,vt,yt,Tt,Dt,2),je.emplace(Xe++,vt,yt,Tt,Dt,3)}(!Cl||Cl.length<2*fe)&&(Cl=function(ft){const bt=2*ft,gt=new t.aU;gt.resize(bt),gt._trim();for(let vt=0;vt<bt;vt++){const yt=6*vt;gt.uint16[yt+0]=4*vt+0,gt.uint16[yt+1]=4*vt+1,gt.uint16[yt+2]=4*vt+2,gt.uint16[yt+3]=4*vt+2,gt.uint16[yt+4]=4*vt+3,gt.uint16[yt+5]=4*vt+0}return gt}(fe));const Ye=q.createIndexBuffer(Cl,!0),at=q.createVertexBuffer(je,t.cW.members,!0);for(const ft of he){const bt={u_matrix:ft.transform,u_inv_matrix:ft.invTransform,u_camera_to_center_distance:(pt=ne).getCameraToCenterDistance(ft.projection),u_viewport_size:[pt.width,pt.height]};Ve.draw(u,K.TRIANGLES,qr.disabled,ai.disabled,u.colorModeForRenderPass(),ei.disabled,bt,n.id,at,Ye,t.b7.simpleSegment(0,2*ft.circleOffset,ft.circleArray.length,ft.circleArray.length/2),null,ne.zoom)}var pt;at.destroy(),Ye.destroy()}const Us=t.ab.mat4.create();function Yu(u){const r=u._camera.getWorldToCamera(u.worldSize,1),n=t.ab.mat4.multiply([],r,u.globeMatrix);t.ab.mat4.invert(n,n);const c=[0,0,0],g=[0,1,0,0];return t.ab.vec4.transformMat4(g,g,n),c[0]=g[0],c[1]=g[1],c[2]=g[2],t.ab.vec3.normalize(c,c),c}function vd({width:u,height:r,anchor:n,textOffset:c,textScale:g},M){const{horizontalAlign:L,verticalAlign:q}=t.bD(n),K=-(L-.5)*u,ne=-(q-.5)*r,ae=t.bC(n,c);return new t.P((K/g+ae[0])*M,(ne/g+ae[1])*M)}function Ta(u,r,n,c,g,M,L,q,K,ne,ae){const he=u.text.placedSymbolArray,fe=u.text.dynamicLayoutVertexArray,Te=u.icon.dynamicLayoutVertexArray,Ve={},je=u.getProjection(),Xe=gl(q,je,M),Ye=M.elevation,at=je.upVectorScale(q.canonical,M.center.lat,M.worldSize).metersToTile;fe.clear();for(let pt=0;pt<he.length;pt++){const ft=he.get(pt),{tileAnchorX:bt,tileAnchorY:gt,numGlyphs:vt}=ft,yt=ft.hidden||!ft.crossTileID||u.allowVerticalPlacement&&!ft.placedOrientation?null:c[ft.crossTileID];if(yt){let Tt=0,Dt=0,Zt=0;if(Ye){const Xt=Ye?Ye.getAtTileOffset(q,bt,gt):0,[hr,ar,er]=je.upVector(q.canonical,bt,gt);Tt=Xt*hr*at,Dt=Xt*ar*at,Zt=Xt*er*at}let[Ht,Pt,zt,tr]=Wi(ft.projectedAnchorX+Tt,ft.projectedAnchorY+Dt,ft.projectedAnchorZ+Zt,n?Xe:L);const lr=Vf(M.getCameraToCenterDistance(je),tr);let pr=g.evaluateSizeForFeature(u.textSizeData,ne,ft)*lr/t.bw;n&&(pr*=u.tilePixelRatio/K);const Gt=vd(yt,pr);n?({x:Ht,y:Pt,z:zt}=je.projectTilePoint(bt+Gt.x,gt+Gt.y,q.canonical),[Ht,Pt,zt]=Wi(Ht+Tt,Pt+Dt,zt+Zt,L)):(r&&Gt._rotate(-M.angle),Ht+=Gt.x,Pt+=Gt.y,zt=0);const nr=u.allowVerticalPlacement&&ft.placedOrientation===t.bq.vertical?Math.PI/2:0;for(let Xt=0;Xt<vt;Xt++)t.bt(fe,Ht,Pt,zt,nr);ae&&ft.associatedIconIndex>=0&&(Ve[ft.associatedIconIndex]={x:Ht,y:Pt,z:zt,angle:nr})}else Xo(vt,fe)}if(ae){Te.clear();const pt=u.icon.placedSymbolArray;for(let ft=0;ft<pt.length;ft++){const bt=pt.get(ft),{numGlyphs:gt}=bt,vt=Ve[ft];if(bt.hidden||!vt)Xo(gt,Te);else{const{x:yt,y:Tt,z:Dt,angle:Zt}=vt;for(let Ht=0;Ht<gt;Ht++)t.bt(Te,yt,Tt,Dt,Zt)}}u.icon.dynamicLayoutVertexBuffer.updateData(Te)}u.text.dynamicLayoutVertexBuffer.updateData(fe)}function Xi(u,r,n,c,g,M,L={}){const q=n.paint.get("icon-translate"),K=n.paint.get("text-translate"),ne=n.paint.get("icon-translate-anchor"),ae=n.paint.get("text-translate-anchor"),he=n.layout.get("icon-rotation-alignment"),fe=n.layout.get("text-rotation-alignment"),Te=n.layout.get("icon-pitch-alignment"),Ve=n.layout.get("text-pitch-alignment"),je=n.layout.get("icon-keep-upright"),Xe=n.layout.get("text-keep-upright"),Ye=n.paint.get("icon-color-saturation"),at=n.paint.get("icon-color-contrast"),pt=n.paint.get("icon-color-brightness-min"),ft=n.paint.get("icon-color-brightness-max"),bt=n.layout.get("symbol-elevation-reference")==="sea",gt=u.context,vt=gt.gl,yt=u.transform,Tt=he==="map",Dt=fe==="map",Zt=Te==="map",Ht=Ve==="map",Pt=n.layout.get("symbol-sort-key").constantOr(1)!==void 0;let zt=!1;const tr=u.depthModeForSublayer(0,qr.ReadOnly),lr=[t.at(yt.center.lng),t.aA(yt.center.lat)],pr=n.layout.get("text-variable-anchor"),Gt=yt.projection.name==="globe",nr=[],Xt=[0,-1,0];for(const hr of c){const ar=r.getTile(hr),er=ar.getBucket(n);if(!er||er.projection.name==="mercator"&&Gt||er.fullyClipped)continue;const Sr=er.projection.name==="globe",mr=Sr?t.ae(yt.zoom):0,Mr=gl(hr,er.getProjection(),yt),Lr=yt.calculatePixelsToTileUnitsMatrix(ar),ri=pr&&er.hasTextData(),Gr=er.hasIconTextFit()&&ri&&er.hasIconData(),Zr=er.getProjection().createInversionMatrix(yt,hr.canonical),ii=Ii=>{yt.depthOcclusionForSymbolsAndCircles&&(n.hasInitialOcclusionOpacityProperties||u.terrain)&&(Ii.push("DEPTH_D24"),Ii.push("DEPTH_OCCLUSION"))},vi=()=>{const Ii=Tt&&n.layout.get("symbol-placement")!=="point",Li=[];ii(Li);const tn=Ii||Gr,Pn=n.paint.get("icon-image-cross-fade").constantOr(0);u.terrainRenderModeElevated()&&Zt&&Li.push("PITCH_WITH_MAP_TERRAIN"),Sr&&(Li.push("PROJECTION_GLOBE_VIEW"),tn&&Li.push("PROJECTED_POS_ON_VIEWPORT")),Pn>0&&Li.push("ICON_TRANSITION"),er.icon.zOffsetVertexBuffer&&Li.push("Z_OFFSET"),Ye===0&&at===0&&pt===0&&ft===1||Li.push("COLOR_ADJUSTMENT"),er.sdfIcons&&Li.push("RENDER_SDF");const $n=er.icon.programConfigurations.get(n.id),pn=u.getOrCreateProgram("symbol",{config:$n,defines:Li}),An=ar.imageAtlasTexture?ar.imageAtlasTexture.size:[0,0],Un=er.iconSizeData,un=t.bp(Un,yt.zoom),ji=Zt||yt.pitch!==0,qi=io(Mr,ar.tileID.canonical,Zt,Tt,yt,er.getProjection(),Lr),wi=Fn(Mr,ar.tileID.canonical,Zt,Tt,yt,er.getProjection(),Lr),cn=u.translatePosMatrix(wi,ar,q,ne,!0),Cn=u.translatePosMatrix(Mr,ar,q,ne),Ni=tn?Us:qi,jn=Tt&&!Zt&&!Ii;let ma=Xt;!Gt&&!yt.mercatorFromTransition||Tt||(ma=Yu(yt));const ua=Sr?ma:Xt,go=n.getColorAdjustmentMatrix(Ye,at,pt,ft),Zn=gd(Un.kind,un,jn,Zt,u,Cn,Ni,cn,bt,!1,An,[0,0],!0,hr,mr,lr,Zr,ua,er.getProjection(),go,Pn),ja=ar.imageAtlasTexture?ar.imageAtlasTexture:null,ca=n.layout.get("icon-size").constantOr(0)!==1||er.iconsNeedLinear,No=er.sdfIcons||u.options.rotating||u.options.zooming||ca||ji?vt.LINEAR:vt.NEAREST,Ka=er.sdfIcons&&n.paint.get("icon-halo-width").constantOr(1)!==0,hs=u.terrain&&Zt&&Ii?t.ab.mat4.invert(t.ab.mat4.create(),qi):Us;if(Ii&&er.icon){const $l=yt.elevation,_c=$l?$l.getAtTileOffsetFunc(hr,yt.center.lat,yt.worldSize,er.getProjection()):null,gc=Zo(Mr,ar.tileID.canonical,Zt,Tt,yt,er.getProjection(),Lr);yu(er,Mr,u,!1,gc,wi,Zt,je,_c,hr)}return{program:pn,buffers:er.icon,uniformValues:Zn,atlasTexture:ja,atlasTextureIcon:null,atlasInterpolation:No,atlasInterpolationIcon:null,isSDF:er.sdfIcons,hasHalo:Ka,tile:ar,labelPlaneMatrixInv:hs}},di=()=>{const Ii=Dt&&n.layout.get("symbol-placement")!=="point",Li=[],tn=Ii||pr||Gr;u.terrainRenderModeElevated()&&Ht&&Li.push("PITCH_WITH_MAP_TERRAIN"),Sr&&(Li.push("PROJECTION_GLOBE_VIEW"),tn&&Li.push("PROJECTED_POS_ON_VIEWPORT")),er.text.zOffsetVertexBuffer&&Li.push("Z_OFFSET"),er.iconsInText&&Li.push("RENDER_TEXT_AND_SYMBOL"),Li.push("RENDER_SDF"),ii(Li);const Pn=er.text.programConfigurations.get(n.id),$n=u.getOrCreateProgram("symbol",{config:Pn,defines:Li});let pn,An=[0,0],Un=null;const un=er.textSizeData;er.iconsInText&&(An=ar.imageAtlasTexture?ar.imageAtlasTexture.size:[0,0],Un=ar.imageAtlasTexture?ar.imageAtlasTexture:null,pn=Ht||yt.pitch!==0||u.options.rotating||u.options.zooming||un.kind==="composite"||un.kind==="camera"?vt.LINEAR:vt.NEAREST);const ji=ar.glyphAtlasTexture?ar.glyphAtlasTexture.size:[0,0],qi=n.layout.get("text-size-scale-range"),wi=t.aw(u.scaleFactor,qi[0],qi[1]),cn=t.bp(un,yt.zoom,wi),Cn=io(Mr,ar.tileID.canonical,Ht,Dt,yt,er.getProjection(),Lr),Ni=Fn(Mr,ar.tileID.canonical,Ht,Dt,yt,er.getProjection(),Lr),jn=u.translatePosMatrix(Ni,ar,K,ae,!0),ma=u.translatePosMatrix(Mr,ar,K,ae),ua=tn?Us:Cn,go=Dt&&!Ht&&!Ii;let Zn=Xt;!Gt&&!yt.mercatorFromTransition||Dt||(Zn=Yu(yt));const ja=gd(un.kind,cn,go,Ht,u,ma,ua,jn,bt,!0,ji,An,!0,hr,mr,lr,Zr,Sr?Zn:Xt,er.getProjection(),null,null,wi),ca=ar.glyphAtlasTexture?ar.glyphAtlasTexture:null,No=vt.LINEAR,Ka=n.paint.get("text-halo-width").constantOr(1)!==0,hs=u.terrain&&Ht&&Ii?t.ab.mat4.invert(t.ab.mat4.create(),Cn):Us;if(Ii&&er.text){const $l=yt.elevation,_c=$l?$l.getAtTileOffsetFunc(hr,yt.center.lat,yt.worldSize,er.getProjection()):null,gc=Zo(Mr,ar.tileID.canonical,Ht,Dt,yt,er.getProjection(),Lr);yu(er,Mr,u,!0,gc,Ni,Ht,Xe,_c,hr)}return{program:$n,buffers:er.text,uniformValues:ja,atlasTexture:ca,atlasTextureIcon:Un,atlasInterpolation:No,atlasInterpolationIcon:pn,isSDF:!0,hasHalo:Ka,tile:ar,labelPlaneMatrixInv:hs}},Hi=er.icon.segments.get().length,Yi=er.text.segments.get().length,Di=Hi&&!L.onlyText?vi():null,ki=Yi&&!L.onlyIcons?di():null,ui=n.paint.get("icon-opacity").constantOr(1),Xr=n.paint.get("text-opacity").constantOr(1);if(Pt&&er.canOverlap){zt=!0;const Ii=ui&&!L.onlyText?er.icon.segments.get():[],Li=Xr&&!L.onlyIcons?er.text.segments.get():[];for(const tn of Ii)nr.push({segments:new t.b7([tn]),sortKey:tn.sortKey,state:Di});for(const tn of Li)nr.push({segments:new t.b7([tn]),sortKey:tn.sortKey,state:ki})}else L.onlyText||nr.push({segments:ui?er.icon.segments:new t.b7([]),sortKey:0,state:Di}),L.onlyIcons||nr.push({segments:Xr?er.text.segments:new t.b7([]),sortKey:0,state:ki})}zt&&nr.sort((hr,ar)=>hr.sortKey-ar.sortKey);for(const hr of nr){const ar=hr.state;if(ar)if(u.terrain?u.terrain.setupElevationDraw(ar.tile,ar.program,{useDepthForOcclusion:yt.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ar.labelPlaneMatrixInv}):u.setupDepthForOcclusion(yt.depthOcclusionForSymbolsAndCircles,ar.program),gt.activeTexture.set(vt.TEXTURE0),ar.atlasTexture&&ar.atlasTexture.bind(ar.atlasInterpolation,vt.CLAMP_TO_EDGE,!0),ar.atlasTextureIcon&&(gt.activeTexture.set(vt.TEXTURE1),ar.atlasTextureIcon&&ar.atlasTextureIcon.bind(ar.atlasInterpolationIcon,vt.CLAMP_TO_EDGE,!0)),u.uploadCommonLightUniforms(u.context,ar.program),ar.hasHalo){const er=ar.uniformValues;er.u_is_halo=1,js(ar.buffers,hr.segments,n,u,ar.program,tr,g,M,er,2),er.u_is_halo=0}else{if(ar.isSDF){const er=ar.uniformValues;ar.hasHalo&&(er.u_is_halo=1,js(ar.buffers,hr.segments,n,u,ar.program,tr,g,M,er,1)),er.u_is_halo=0}js(ar.buffers,hr.segments,n,u,ar.program,tr,g,M,ar.uniformValues,1)}}}function js(u,r,n,c,g,M,L,q,K,ne){const ae=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.iconTransitioningVertexBuffer,u.globeExtVertexBuffer,u.zOffsetVertexBuffer];g.draw(c,c.context.gl.TRIANGLES,M,L,q,ei.disabled,K,n.id,u.layoutVertexBuffer,u.indexBuffer,r,n.paint,c.transform.zoom,u.programConfigurations.get(n.id),ae,ne)}function Ku(u,r,n,c,g,M,L){const q=u.context.gl,K=n.paint.get("fill-pattern"),ne=n.is3D(),ae=ne?u.stencilModeFor3D():ai.disabled,he=K&&K.constantOr(1);let fe,Te,Ve,je,Xe;L?(Te=he&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",fe=q.LINES):(Te=he?"fillPattern":"fill",fe=q.TRIANGLES);for(const Ye of c){const at=r.getTile(Ye);if(he&&!at.patternsLoaded())continue;const pt=at.getBucket(n);if(!pt)continue;u.prepareDrawTile();const ft=pt.programConfigurations.get(n.id),bt=u.isTileAffectedByFog(Ye),gt=u.getOrCreateProgram(Te,{config:ft,overrideFog:bt});he&&(u.context.activeTexture.set(q.TEXTURE0),at.imageAtlasTexture&&at.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),ft.updatePaintBuffers());const vt=K.constantOr(null);if(vt&&at.imageAtlas){const Dt=at.imageAtlas,Zt=t.A.from(vt),Ht=Dt.patternPositions[Zt.getSerializedPrimary()];Ht&&ft.setConstantPatternPositions(Ht)}const yt=u.translatePosMatrix(Ye.projMatrix,at,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),Tt=n.paint.get("fill-emissive-strength");if(L){je=pt.indexBuffer2,Xe=pt.segments2;const Dt=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[q.drawingBufferWidth,q.drawingBufferHeight];Ve=Te==="fillOutlinePattern"&&he?Wu(yt,Tt,u,at,Dt):qu(yt,Tt,Dt)}else je=pt.indexBuffer,Xe=pt.segments,Ve=he?gh(yt,Tt,u,at):Fs(yt,Tt);u.uploadCommonUniforms(u.context,gt,Ye.toUnwrapped()),gt.draw(u,fe,g,ne?ae:u.stencilModeForClipping(Ye),M,ei.disabled,Ve,n.id,pt.layoutVertexBuffer,je,Xe,n.paint,u.transform.zoom,ft,void 0)}}function Rl(u,r,n,c,g,M,L,q){n.resetLayerRenderingStats(u);const K=u.context,ne=K.gl,ae=u.transform,he=n.paint.get("fill-extrusion-pattern"),fe=he.constantOr(1),Te=n.paint.get("fill-extrusion-opacity"),Ve=u.style.enable3dLights(),je=n.paint.get(Ve&&!fe?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Xe=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),je],Ye=n.layout.get("fill-extrusion-edge-radius"),at=Ye>0&&!n.paint.get("fill-extrusion-rounded-roof"),pt=at?0:Ye,ft=ae.projection.name==="globe"?t.d3():0,bt=ae.projection.name==="globe",gt=bt?t.ae(ae.zoom):0,vt=[t.at(ae.center.lng),t.aA(ae.center.lat)],yt=n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Tt=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(yt?null:n.lut).toArray01().slice(0,3),Dt=n.paint.get("fill-extrusion-flood-light-intensity"),Zt=n.paint.get("fill-extrusion-vertical-scale"),Ht=n.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Pt=n.paint.get("fill-extrusion-height-alignment"),zt=n.paint.get("fill-extrusion-base-alignment"),tr=so(u,n.paint.get("fill-extrusion-cutoff-fade-range")),lr=[];let pr;bt&&lr.push("PROJECTION_GLOBE_VIEW"),Xe[0]>0&&lr.push("FAUX_AO"),at&&lr.push("ZERO_ROOF_RADIUS"),q&&lr.push("HAS_CENTROID"),Dt>0&&lr.push("FLOOD_LIGHT"),tr.shouldRenderCutoff&&lr.push("RENDER_CUTOFF"),Ht&&lr.push("RENDER_WALL_MODE");const Gt=u.renderPass==="shadow",nr=u.shadowRenderer,Xt=Gt&&!!nr;u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!0);let hr=[0,0,0];if(nr){const Sr=u.style.directionalLight,mr=u.style.ambientLight;Sr&&mr&&(hr=Ds(u.style,Sr,mr)),Gt||(lr.push("RENDER_SHADOWS","DEPTH_TEXTURE"),nr.useNormalOffset&&lr.push("NORMAL_OFFSET")),pr=lr.concat(["SHADOWS_SINGLE_CASCADE"])}const ar=Xt?"fillExtrusionDepth":fe?"fillExtrusionPattern":"fillExtrusion",er=n.getLayerRenderingStats();for(const Sr of c){const mr=r.getTile(Sr),Mr=mr.getBucket(n);if(!Mr||Mr.projection.name!==ae.projection.name)continue;let Lr=!1;nr&&(Lr=nr.getMaxCascadeForTile(Sr.toUnwrapped())===0);const ri=u.isTileAffectedByFog(Sr),Gr=Mr.programConfigurations.get(n.id),Zr=u.getOrCreateProgram(ar,{config:Gr,defines:Lr?pr:lr,overrideFog:ri});if(u.terrain&&u.terrain.setupElevationDraw(mr,Zr,{useMeterToDem:!0}),!Mr.centroidVertexBuffer){const ki=Zr.attributes.a_centroid_pos;ki!==void 0&&ne.vertexAttrib2f(ki,0,0)}!Gt&&nr&&nr.setupShadows(mr.tileID.toUnwrapped(),Zr,"vector-tile",mr.tileID.overscaledZ),fe&&(u.context.activeTexture.set(ne.TEXTURE0),mr.imageAtlasTexture&&mr.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),Gr.updatePaintBuffers());const ii=he.constantOr(null);if(ii&&mr.imageAtlas){const ki=mr.imageAtlas,ui=t.A.from(ii),Xr=ki.patternPositions[ui.getSerializedPrimary()];Xr&&Gr.setConstantPatternPositions(Xr)}const vi=n.paint.get("fill-extrusion-vertical-gradient"),di=1/Mr.tileToMeter;let Hi;if(Gt&&nr){if(dr(mr.tileID,Mr,u))continue;const ki=nr.calculateShadowPassMatrixFromTile(mr.tileID.toUnwrapped());Hi=Il(ki,pt,di,Zt,Pt,zt)}else{const ki=u.translatePosMatrix(Sr.expandedProjMatrix,mr,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),ui=ae.projection.createInversionMatrix(ae,Sr.canonical);Hi=fe?_h(ki,u,vi,Te,Xe,pt,di,Sr,mr,ft,Pt,zt,gt,vt,ui,Tt,Zt):Hu(ki,u,vi,Te,Xe,pt,di,Sr,ft,Pt,zt,gt,vt,ui,Tt,Zt,Dt,hr)}u.uploadCommonUniforms(K,Zr,Sr.toUnwrapped(),null,tr);let Yi=Mr.segments;if(ae.projection.name==="mercator"&&!Gt&&(Yi=Mr.getVisibleSegments(mr.tileID,u.terrain,u.transform.getFrustum(0)),!Yi.get().length))continue;if(er)if(Gt)for(const ki of Yi.get())er.numRenderedVerticesInShadowPass+=ki.primitiveLength;else for(const ki of Yi.get())er.numRenderedVerticesInTransparentPass+=ki.primitiveLength;const Di=[];(u.terrain||q)&&Di.push(Mr.centroidVertexBuffer),bt&&Di.push(Mr.layoutVertexExtBuffer),Ht&&Di.push(Mr.wallVertexBuffer),Zr.draw(u,K.gl.TRIANGLES,g,M,L,ei.backCCW,Hi,n.id,Mr.layoutVertexBuffer,Mr.indexBuffer,Yi,n.paint,u.transform.zoom,Gr,Di)}u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!1)}function ns(u,r,n,c,g,M,L,q,K,ne,ae,he,fe,Te,Ve,je,Xe,Ye,at){const pt=u.context,ft=pt.gl,bt=u.transform,gt=u.transform.zoom,vt=[],yt=so(u,n.paint.get("fill-extrusion-cutoff-fade-range"));ne==="clear"?(vt.push("CLEAR_SUBPASS"),at&&(vt.push("CLEAR_FROM_TEXTURE"),pt.activeTexture.set(ft.TEXTURE0),at.bind(ft.LINEAR,ft.CLAMP_TO_EDGE))):ne==="sdf"&&vt.push("SDF_SUBPASS"),Xe&&vt.push("HAS_CENTROID"),yt.shouldRenderCutoff&&vt.push("RENDER_CUTOFF");const Tt=n.layout.get("fill-extrusion-edge-radius"),Dt=(Zt,Ht,Pt,zt,tr)=>{const lr=Ht.programConfigurations.get(n.id),pr=u.isTileAffectedByFog(Zt),Gt=u.getOrCreateProgram("fillExtrusionGroundEffect",{config:lr,defines:vt,overrideFog:pr}),nr=((hr,ar,er,Sr,mr,Mr,Lr,ri,Gr,Zr,ii)=>({u_matrix:ar,u_opacity:er,u_ao_pass:Sr?1:0,u_meter_to_tile:mr,u_ao:Mr,u_flood_light_intensity:Lr,u_flood_light_color:ri,u_attenuation:Gr,u_edge_radius:Zr,u_fb:0,u_fb_size:ii,u_dynamic_offset:1}))(0,zt,ae,K,tr,[he,fe*tr],Te,Ve,je,gt>=17?0:Tt*tr,at?at.size[0]:0),Xt=[];Xe&&Xt.push(Ht.hiddenByLandmarkVertexBuffer),u.uploadCommonUniforms(pt,Gt,Zt.toUnwrapped(),null,yt),Gt.draw(u,pt.gl.TRIANGLES,g,M,L,q,nr,n.id,Ht.vertexBuffer,Ht.indexBuffer,Pt,n.paint,gt,lr,Xt)};for(const Zt of c){const Ht=r.getTile(Zt),Pt=Ht.getBucket(n);if(!Pt||Pt.projection.name!==bt.projection.name||!Pt.groundEffect||Pt.groundEffect&&!Pt.groundEffect.hasData())continue;const zt=Pt.groundEffect,tr=1/Pt.tileToMeter;{const lr=u.translatePosMatrix(Zt.projMatrix,Ht,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),pr=zt.getDefaultSegment();Dt(Zt,zt,pr,lr,tr)}if(Ye)for(let lr=0;lr<4;lr++){const pr=t.d4[lr](Zt),Gt=r.getTile(pr);if(!Gt)continue;const nr=Gt.getBucket(n);if(!nr||nr.projection.name!==bt.projection.name||!nr.groundEffect||nr.groundEffect&&!nr.groundEffect.hasData())continue;const Xt=nr.groundEffect;let hr,ar;lr===0?(hr=[-t.ag,0,0],ar=1):lr===1?(hr=[t.ag,0,0],ar=0):lr===2?(hr=[0,-t.ag,0],ar=3):(hr=[0,t.ag,0],ar=2);const er=Xt.regionSegments[ar];if(!er)continue;const Sr=new Float32Array(16);t.ab.mat4.translate(Sr,Zt.projMatrix,hr),Dt(Zt,Xt,er,u.translatePosMatrix(Sr,Ht,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),tr)}}}function bd(u,r,n,c,g,M,L){c.centroidVertexArray.length===0&&c.createCentroidsBuffer();const q=M?M.findDEMTileFor(n):null;if(!(q&&q.dem||L))return;M&&q&&q.dem&&c.selfDEMTileTimestamp!==q.dem._timestamp&&(c.borderDoneWithNeighborZ=[-1,-1,-1,-1],c.selfDEMTileTimestamp=q.dem._timestamp);const K=Ye=>new t.P(Math.ceil((Ye+t.d7)*t.d8),0),ne=Ye=>{const at=r.getSource().minzoom,pt=bt=>{const gt=r.getTileByID(bt);if(gt&&gt.hasData())return gt.getBucket(g)},ft=[0,-1,1];for(const bt of ft){if(Ye.overscaledZ+bt<at)continue;const gt=pt(Ye.calculateScaledKey(Ye.overscaledZ+bt));if(gt)return gt}},ae=[0,0,0],he=(Ye,at)=>(ae[0]=Math.min(Ye.min.y,at.min.y),ae[1]=Math.max(Ye.max.y,at.max.y),ae[2]=t.ag-at.min.x>Ye.max.x?at.min.x-t.ag:Ye.max.x,ae),fe=(Ye,at)=>(ae[0]=Math.min(Ye.min.x,at.min.x),ae[1]=Math.max(Ye.max.x,at.max.x),ae[2]=t.ag-at.min.y>Ye.max.y?at.min.y-t.ag:Ye.max.y,ae),Te=[(Ye,at)=>he(Ye,at),(Ye,at)=>he(at,Ye),(Ye,at)=>fe(Ye,at),(Ye,at)=>fe(at,Ye)],Ve=(Ye,at,pt,ft,bt,gt,vt)=>{if(!M)return 0;const yt=[[gt?pt:Ye,gt?Ye:pt,0],[gt?pt:at,gt?at:pt,0]],Tt=vt<0?t.ag+vt:vt,Dt=[gt?Tt:(Ye+at)/2,gt?(Ye+at)/2:Tt,0];return pt===0&&vt<0||pt!==0&&vt>0?M.getForTilePoints(bt,[Dt],!0,ft):yt.push(Dt),M.getForTilePoints(n,yt,!0,q),Math.max(yt[0][2],yt[1][2],Dt[2])/M.exaggeration()};for(let Ye=0;Ye<4;Ye++){const at=c.borderFeatureIndices[Ye];if(at.length===0)continue;const pt=t.d4[Ye](n),ft=ne(pt);if(!(ft&&ft instanceof t.d5))continue;const bt=M?M.findDEMTileFor(pt):null;if(!(bt&&bt.dem||L)||(M&&bt&&bt.dem&&c.borderDEMTileTimestamp[Ye]!==bt.dem._timestamp&&(c.borderDoneWithNeighborZ[Ye]=-1,c.borderDEMTileTimestamp[Ye]=bt.dem._timestamp),c.borderDoneWithNeighborZ[Ye]===ft.canonical.z))continue;ft.centroidVertexArray.length===0&&ft.createCentroidsBuffer();const gt=(Ye<2?1:5)-Ye,vt=ft.borderDoneWithNeighborZ[gt]!==c.canonical.z,yt=ft.borderFeatureIndices[gt];let Tt=0;if(c.canonical.z!==ft.canonical.z){for(const Dt of at)c.showCentroid(c.featuresOnBorder[Dt]);if(vt)for(const Dt of yt)ft.showCentroid(ft.featuresOnBorder[Dt]);c.borderDoneWithNeighborZ[Ye]=ft.canonical.z,ft.borderDoneWithNeighborZ[gt]=c.canonical.z}for(const Dt of at){const Zt=c.featuresOnBorder[Dt],Ht=c.centroidData[Zt.centroidDataIndex],Pt=Zt.borders[Ye];let zt;for(;Tt<yt.length;){zt=ft.featuresOnBorder[yt[Tt]];const tr=zt.borders[gt];if(tr[1]>Pt[0]+3||tr[0]>Pt[0]-3)break;ft.showCentroid(zt),Tt++}if(zt&&Tt<yt.length){const tr=Tt;let lr=0;for(;!(zt.borders[gt][0]>Pt[1]-3)&&(lr++,++Tt!==yt.length);)zt=ft.featuresOnBorder[yt[Tt]];zt=ft.featuresOnBorder[yt[tr]];let pr=!1;if(lr>=1){const Xt=zt.borders[gt];Math.abs(Pt[0]-Xt[0])<3&&Math.abs(Pt[1]-Xt[1])<3&&(lr=1,pr=!0,Tt=tr+1)}else if(lr===0){c.showCentroid(Zt);continue}const Gt=ft.centroidData[zt.centroidDataIndex];L&&pr&&(((je=Ht).flags|(Xe=Gt).flags)&t.d6?(je.flags|=t.d6,Xe.flags|=t.d6):(je.flags&=~t.d6,Xe.flags&=~t.d6));const nr=Zt.intersectsCount()>1||zt.intersectsCount()>1;if(lr>1)Tt=tr,Ht.centroidXY=Gt.centroidXY=new t.P(0,0);else if(bt&&bt.dem&&!nr){const Xt=Te[Ye](Ht,Gt),hr=Ye%2?t.ag-1:0,ar=Ve(Xt[0],Math.min(t.ag-1,Xt[1]),hr,bt,pt,Ye<2,Xt[2]);Ht.centroidXY=Gt.centroidXY=K(ar)}else nr?Ht.centroidXY=Gt.centroidXY=new t.P(0,0):(Ht.centroidXY=c.encodeBorderCentroid(Zt),Gt.centroidXY=ft.encodeBorderCentroid(zt));c.writeCentroidToBuffer(Ht),ft.writeCentroidToBuffer(Gt)}else c.showCentroid(Zt)}c.borderDoneWithNeighborZ[Ye]=ft.canonical.z,ft.borderDoneWithNeighborZ[gt]=c.canonical.z}var je,Xe;(c.needsCentroidUpdate||!c.centroidVertexBuffer&&c.centroidVertexArray.length!==0)&&c.uploadCentroid(u)}const Am=[1,0,0],Vs=[0,1,0],Gs=[0,0,1];function dr(u,r,n){const c=n.transform,g=n.shadowRenderer;if(!g)return!0;const M=u.toUnwrapped(),L=c.tileSize*g._cascades[n.currentShadowCascade].scale;let q=r.maxHeight;if(c.elevation){const je=c.elevation.getMinMaxForTile(u);je&&(q+=je.max)}const K=[...g.shadowDirection];K[2]=-K[2];const ne=g.computeSimplifiedTileShadowVolume(M,q,L,K);if(!ne)return!1;const ae=[Am,Vs,Gs,K,[K[0],0,K[2]],[0,K[1],K[2]]],he=c.projection.name==="globe",fe=c.scaleZoom(L),Te=t.bR.fromInvProjectionMatrix(c.invProjMatrix,c.worldSize,fe,!he),Ve=g.getCurrentCascadeFrustum();return Te.intersectsPrecise(ne.vertices,ne.planes,ae)===0||Ve.intersectsPrecise(ne.vertices,ne.planes,ae)===0}function Ar(u){return[u[0]*t.d9,u[1]*t.d9,u[2]*t.d9,0]}function Co(u,r,n,c,g,M,L,q,K){const ne=c.getSource(),ae=n.globeSharedBuffers;if(!ae)return;let he,fe,Te;if(r&&(he=c.getTile(r)),ne instanceof t.aJ?(fe=ne.texture,Te=t.cI(0,0,n.transform)):he&&r&&(fe=he.texture,Te=t.cI(r.canonical.z,r.canonical.x,n.transform)),!fe||!Te)return;u||(Te=t.ab.mat4.scale(t.ab.mat4.create(),Te,[1,-1,1]));const Ve=n.context,je=Ve.gl,Xe=g.paint.get("raster-resampling")==="nearest"?je.NEAREST:je.LINEAR,Ye=n.colorModeForDrapableLayerRenderPass(M),at=L.defines;at.push("GLOBE_POLES");const pt=new qr(je.LEQUAL,qr.ReadWrite,n.depthRangeFor3D),ft=Float32Array.from(n.transform.expandedFarZProjMatrix),bt=Float32Array.from(t.bb(t.cH(new t.bT(0,0,0))));n.terrain&&n.terrain.prepareDrawTile(),Ve.activeTexture.set(je.TEXTURE0),fe.bind(Xe,je.CLAMP_TO_EDGE),Ve.activeTexture.set(je.TEXTURE1),fe.bind(Xe,je.CLAMP_TO_EDGE),fe.useMipmap&&Ve.extTextureFilterAnisotropic&&n.transform.pitch>20&&je.texParameterf(je.TEXTURE_2D,Ve.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Ve.extTextureFilterAnisotropicMax);const[gt,vt,yt,Tt]=r?ae.getPoleBuffers(r.canonical.z,!1):ae.getPoleBuffers(0,!0),Dt=g.paint.get("raster-elevation");let Zt;u?(Zt=gt,n.renderDefaultNorthPole=Dt!==0):(Zt=vt,n.renderDefaultSouthPole=Dt!==0);const Ht=Ar(L.mix),Pt=((tr,lr,pr,Gt,nr,Xt,hr,ar,er,Sr,mr,Mr,Lr)=>bh(tr,lr,pr,new Float32Array(16),new Float32Array(9),[0,0],Gt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Xt,[0,0],ar,2,Sr,mr,Mr,1,0,Lr))(ft,bt,Te,t.ae(n.transform.zoom),0,g,0,Dt,0,Ht,L.offset,L.range,M),zt=n.getOrCreateProgram("raster",{defines:at});n.uploadCommonUniforms(Ve,zt,null),zt.draw(n,je.TRIANGLES,pt,K,Ye,q,Pt,g.id,Zt,yt,Tt)}function on(u){const r=u._nearZ,n=u.projection.farthestPixelDistance(u),c=n-r,g=.2*u.height,M=r+g;return[r,n,(M-g-r)/c,(M-r)/c]}function qt(u,r,n,c){if(u)return r instanceof ea&&u instanceof du?r.getTextureDescriptor(u,n,!0):{texture:u.texture,mix:Ar(c.mix),offset:c.offset,buffer:0,tileSize:1}}var xd=t.da([{name:"a_index",type:"Int16",components:1}]);class Ju{constructor(r,n,c,g){const M={width:c[0],height:c[1],data:null},L=r.gl;this.targetColorTexture=new t.T(r,M,L.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new t.T(r,M,L.RGBA8,{useMipmap:!1}),this.context=r,this.updateParticleTexture(n,g),this.lastInvalidatedAt=0}updateParticleTexture(r,n){if(this.particleTextureDimension===n.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const c=this.context.gl,g=n.width*n.height;this.particleTexture0=new t.T(this.context,n,c.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new t.T(this.context,n,c.RGBA8,{premultiply:!1,useMipmap:!1});const M=new t.db;M.reserve(g);for(let L=0;L<g;L++)M.emplaceBack(L);this.particleIndexBuffer=this.context.createVertexBuffer(M,xd.members,!0),this.particleSegment=t.b7.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=n.width}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=t.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Ah(u,r,n){if(!u)return null;const c=r.getTextureDescriptor(u,n,!0);if(!c)return null;let{texture:g,mix:M,offset:L,tileSize:q,buffer:K,format:ne}=c;if(!g||!ne)return null;let ae=!1;return ne==="uint32"&&(ae=!0,M[3]=0,M=Pl(t.dc,M,[0,n.paint.get("raster-particle-max-speed")]),L=Dr(t.dc,L,[0,n.paint.get("raster-particle-max-speed")])),{texture:g,textureOffset:[K/(q+2*K),q/(q+2*K)],tileSize:q,scalarData:ae,scale:M,offset:L,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[ne]]}}function wd(u){const r=u._nearZ,n=u.projection.farthestPixelDistance(u),c=n-r,g=.2*u.height,M=r+g;return[r,n,(M-g-r)/c,(M-r)/c]}const Ed=new t.aj(1,0,0,1),Td=new t.aj(0,1,0,1),Hs=new t.aj(0,0,1,1),Im=new t.aj(1,0,1,1),Pm=new t.aj(0,1,1,1);function as(u,r,n,c,g,M,L){const q=u.context,K=u.transform,ne=q.gl,ae=K.projection.name==="globe",he=ae?["PROJECTION_GLOBE_VIEW"]:[];let fe=t.ab.mat4.clone(n.projMatrix);if(ae&&t.ae(K.zoom)>0){const Ht=t.ba(n.canonical,K),Pt=t.dd(Ht);fe=t.ab.mat4.multiply(new Float32Array(16),K.globeMatrix,Pt),t.ab.mat4.multiply(fe,K.projMatrix,fe)}const Te=t.ab.mat4.create();Te[12]+=2*g/(t.q.devicePixelRatio*K.width),Te[13]+=2*M/(t.q.devicePixelRatio*K.height),t.ab.mat4.multiply(fe,Te,fe);const Ve=u.getOrCreateProgram("debug",{defines:he}),je=r.getTileByID(n.key);u.terrain&&u.terrain.setupElevationDraw(je,Ve);const Xe=qr.disabled,Ye=ai.disabled,at=u.colorModeForRenderPass(),pt="$debug";q.activeTexture.set(ne.TEXTURE0),u.emptyTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),ae?je._makeGlobeTileDebugBuffers(u.context,K):je._makeDebugTileBoundsBuffers(u.context,K.projection);const ft=je._tileDebugBuffer||u.debugBuffer,bt=je._tileDebugIndexBuffer||u.debugIndexBuffer,gt=je._tileDebugSegments||u.debugSegments;if(Ve.draw(u,ne.LINE_STRIP,Xe,Ye,at,ei.disabled,vh(fe,c),pt,ft,bt,gt,null,null,null,[je._globeTileDebugBorderBuffer]),L){const Ht=je.latestRawTileData,Pt=Math.floor((Ht&&Ht.byteLength||0)/1024);let zt=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(zt+=` => ${n.overscaledZ}`),zt+=` ${je.state}`,zt+=` ${Pt}kb`,function(tr,lr){tr.initDebugOverlayCanvas();const pr=tr.debugOverlayCanvas,Gt=tr.context.gl,nr=tr.debugOverlayCanvas.getContext("2d");nr.clearRect(0,0,pr.width,pr.height),nr.shadowColor="white",nr.shadowBlur=2,nr.lineWidth=1.5,nr.strokeStyle="white",nr.textBaseline="top",nr.font="bold 36px Open Sans, sans-serif",nr.fillText(lr,5,5),nr.strokeText(lr,5,5),tr.debugOverlayTexture.update(pr),tr.debugOverlayTexture.bind(Gt.LINEAR,Gt.CLAMP_TO_EDGE)}(u,zt)}const vt=r.getTile(n).tileSize,yt=512/Math.min(vt,512)*(n.overscaledZ/K.zoom)*.5,Tt=je._tileDebugTextBuffer||u.debugBuffer,Dt=je._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,Zt=je._tileDebugTextSegments||u.debugSegments;Ve.draw(u,ne.TRIANGLES,Xe,Ye,pi.alphaBlended,ei.disabled,vh(fe,t.aj.transparent,yt),pt,Tt,Dt,Zt,null,null,null,[je._globeTileDebugTextBuffer])}function Dl(u,r,n,c){Ll(u,0,r+n/2,u.transform.width,n,c)}function Qu(u,r,n,c){Ll(u,r-n/2,0,n,u.transform.height,c)}function Ll(u,r,n,c,g,M){const L=u.context,q=L.gl;q.enable(q.SCISSOR_TEST),q.scissor(r*t.q.devicePixelRatio,n*t.q.devicePixelRatio,c*t.q.devicePixelRatio,g*t.q.devicePixelRatio),L.clear({color:M}),q.disable(q.SCISSOR_TEST)}const Sd=t.da([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ec}=Sd;function ka(u,r,n,c){u.emplaceBack(r,n,c)}class Ba{constructor(r){this.vertexArray=new t.de,this.indices=new t.aU,ka(this.vertexArray,-1,-1,1),ka(this.vertexArray,1,-1,1),ka(this.vertexArray,-1,1,1),ka(this.vertexArray,1,1,1),ka(this.vertexArray,-1,-1,-1),ka(this.vertexArray,1,-1,-1),ka(this.vertexArray,-1,1,-1),ka(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,ec),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=t.b7.simpleSegment(0,0,36,12)}}function os(u,r,n,c,g,M){const L=u.context.gl,q=r.paint.get("sky-atmosphere-color"),K=r.paint.get("sky-atmosphere-halo-color"),ne=r.paint.get("sky-atmosphere-sun-intensity"),ae=((he,fe,Te,Ve,je)=>({u_matrix_3f:he,u_sun_direction:fe,u_sun_intensity:Te,u_color_tint_r:[Ve.r,Ve.g,Ve.b,Ve.a],u_color_tint_m:[je.r,je.g,je.b,je.a],u_luminance:5e-5}))(t.ab.mat3.fromMat4(t.ab.mat3.create(),c),g,ne,q,K);L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_CUBE_MAP_POSITIVE_X+M,r.skyboxTexture,0),n.draw(u,L.TRIANGLES,qr.disabled,ai.disabled,pi.unblended,ei.frontCW,ae,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const Cm=t.da([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Kn{constructor(r){const n=new t.df;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const c=new t.aU;c.emplaceBack(0,1,2),c.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(n,Cm.members),this.indexBuffer=r.createIndexBuffer(c),this.segments=t.b7.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Rm=t.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Ol{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class $i{constructor(r){this.colorModeAlphaBlendedWriteRGB=new pi([1,Is,1,Is],t.aj.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new pi([1,0,1,0],t.aj.transparent,[!1,!1,!1,!0]),this.params=new Ol,this.updateNeeded=!0,r.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),r.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(r){const n=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Kn(n);const c=this.params.sizeRange,g=this.params.intensityRange,M=function(ae){const he=t.di(30),fe=[];for(let Te=0;Te<ae;++Te){const Ve=2*Math.PI*he(),je=Math.acos(1-2*he())-.5*Math.PI;fe.push(t.ab.vec3.fromValues(Math.cos(je)*Math.cos(Ve),Math.cos(je)*Math.sin(Ve),Math.sin(je)))}return fe}(this.params.starsCount),L=t.di(300),q=new t.dg,K=new t.aU;let ne=0;for(let ae=0;ae<M.length;++ae){const he=t.ab.vec3.scale([],M[ae],200),fe=Math.max(0,1+.01*c*(1*L()-.5)),Te=Math.max(0,1+.01*g*(1*L()-.5));q.emplaceBack(he[0],he[1],he[2],-1,-1,fe,Te),q.emplaceBack(he[0],he[1],he[2],1,-1,fe,Te),q.emplaceBack(he[0],he[1],he[2],1,1,fe,Te),q.emplaceBack(he[0],he[1],he[2],-1,1,fe,Te),K.emplaceBack(ne+0,ne+1,ne+2),K.emplaceBack(ne+0,ne+2,ne+3),ne+=4}this.starsVx=n.createVertexBuffer(q,Rm.members),this.starsIdx=n.createIndexBuffer(K),this.starsSegments=t.b7.simpleSegment(0,0,q.length,K.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,n){const c=r.context,g=c.gl,M=r.transform,L=new qr(g.LEQUAL,qr.ReadOnly,[0,1]),q=t.ae(M.zoom),K=r.style.getLut(n.scope),ne=n.properties.get("color-use-theme")==="none",ae=n.properties.get("color").toRenderColor(ne?null:K).toArray01(),he=n.properties.get("high-color-use-theme")==="none",fe=n.properties.get("high-color").toRenderColor(he?null:K).toArray01(),Te=n.properties.get("space-color-use-theme")==="none",Ve=n.properties.get("space-color").toRenderColor(Te?null:K).toArray01PremultipliedAlpha(),je=5e-4,Xe=t.dh(n.properties.get("horizon-blend"),0,1,je,.25),Ye=t.cC(r,c,M)&&Xe===je?M.worldSize/(2*Math.PI*1.025)-1:M.globeRadius,at=r.frameCounter/1e3%1,pt=t.ab.vec3.length(M.globeCenterInViewSpace),ft=Math.sqrt(Math.pow(pt,2)-Math.pow(Ye,2)),bt=Math.acos(ft/pt),gt=vt=>{const yt=M.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];vt&&yt.push("ALPHA_PASS");const Tt=r.getOrCreateProgram("globeAtmosphere",{defines:yt}),Dt=((Ht,Pt,zt,tr,lr,pr,Gt,nr,Xt,hr,ar,er)=>({u_frustum_tl:Ht,u_frustum_tr:Pt,u_frustum_br:zt,u_frustum_bl:tr,u_horizon:lr,u_transition:pr,u_fadeout_range:Gt,u_color:nr,u_high_color:Xt,u_space_color:hr,u_temporal_offset:ar,u_horizon_angle:er}))(M.frustumCorners.TL,M.frustumCorners.TR,M.frustumCorners.BR,M.frustumCorners.BL,M.frustumCorners.horizon,q,Xe,ae,fe,Ve,at,bt);r.uploadCommonUniforms(c,Tt);const Zt=this.atmosphereBuffer;Zt&&Tt.draw(r,g.TRIANGLES,L,ai.disabled,vt?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ei.backCW,Dt,vt?"atmosphere_glow_alpha":"atmosphere_glow",Zt.vertexBuffer,Zt.indexBuffer,Zt.segments)};gt(!1),gt(!0)}drawStars(r,n){const c=t.aw(n.properties.get("star-intensity"),0,1);if(c===0)return;const g=r.context,M=g.gl,L=r.transform,q=r.getOrCreateProgram("stars"),K=t.ab.quat.identity([]);t.ab.quat.rotateX(K,K,-L._pitch),t.ab.quat.rotateZ(K,K,-L.angle),t.ab.quat.rotateX(K,K,t.ai(L._center.lat)),t.ab.quat.rotateY(K,K,-t.ai(L._center.lng));const ne=t.ab.mat4.fromQuat(new Float32Array(16),K),ae=t.ab.mat4.multiply([],L.starsProjMatrix,ne),he=t.ab.mat3.fromMat4([],ne),fe=t.ab.mat3.invert([],he),Te=[0,1,0];t.ab.vec3.transformMat3(Te,Te,fe),t.ab.vec3.scale(Te,Te,this.params.sizeMultiplier);const Ve=[1,0,0];t.ab.vec3.transformMat3(Ve,Ve,fe),t.ab.vec3.scale(Ve,Ve,this.params.sizeMultiplier);const je=(Xe=Te,Ye=Ve,at=c,{u_matrix:Float32Array.from(ae),u_up:Xe,u_right:Ye,u_intensity_multiplier:at});var Xe,Ye,at;r.uploadCommonUniforms(g,q),this.starsVx&&this.starsIdx&&q.draw(r,M.TRIANGLES,qr.disabled,ai.disabled,this.colorModeAlphaBlendedWriteRGB,ei.disabled,je,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Ri(u,r){const n=[...u],c=r.cameraWorldSizeForFog/r.worldSize,g=t.ab.mat4.identity([]);return t.ab.mat4.scale(g,g,[c,c,1]),t.ab.mat4.multiply(n,g,n),t.ab.mat4.multiply(n,r.worldToFogMatrix,n),n}function tc(u,r,n,c,g){const M=n.material,L=c.context,{baseColorTexture:q,metallicRoughnessTexture:K}=M.pbrMetallicRoughness,{normalTexture:ne,occlusionTexture:ae,emissionTexture:he}=M;function fe(Ve,je,Xe){if(Ve&&(u.push(je),L.activeTexture.set(L.gl.TEXTURE0+Xe),Ve.gfxTexture)){const{minFilter:Ye,magFilter:at,wrapS:pt,wrapT:ft}=Ve.sampler;Ve.gfxTexture.bindExtraParam(Ye,at,pt,ft)}}fe(q,"HAS_TEXTURE_u_baseColorTexture",Ln.BaseColor),fe(K,"HAS_TEXTURE_u_metallicRoughnessTexture",Ln.MetallicRoughness),fe(ne,"HAS_TEXTURE_u_normalTexture",Ln.Normal),fe(ae,"HAS_TEXTURE_u_occlusionTexture",Ln.Occlusion),fe(he,"HAS_TEXTURE_u_emissionTexture",Ln.Emission),g&&(g.texture||(g.texture=new t.dk(c.context,g.image,[g.image.height,g.image.height,g.image.height],L.gl.RGBA8)),L.activeTexture.set(L.gl.TEXTURE0+Ln.LUT),g.texture&&g.texture.bind(L.gl.LINEAR,L.gl.CLAMP_TO_EDGE),u.push("APPLY_LUT_ON_GPU")),n.texcoordBuffer&&(u.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(n.texcoordBuffer)),n.colorBuffer&&(u.push(n.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(n.colorBuffer)),n.normalBuffer&&(u.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(n.normalBuffer)),n.pbrBuffer&&(u.push("HAS_ATTRIBUTE_a_pbr"),u.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(n.pbrBuffer)),M.alphaMode!=="OPAQUE"&&M.alphaMode!=="MASK"||u.push("UNPREMULT_TEXTURE_IN_SHADER"),M.defined||u.push("DIFFUSE_SHADED"),u.push("USE_STANDARD_DERIVATIVES");const Te=c.shadowRenderer;Te&&(u.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Te.useNormalOffset&&u.push("NORMAL_OFFSET"))}function Fa(u,r,n,c,g,M){const L=n.paint.get("model-opacity").constantOr(1),q=r.context,K=new qr(r.context.gl.LEQUAL,qr.ReadWrite,r.depthRangeFor3D),ne=r.transform,ae=u.mesh,he=ae.material,fe=he.pbrMetallicRoughness,Te=r.style.fog;let Ve;Ve=r.transform.projection.zAxisUnit==="pixels"?[...u.nodeModelMatrix]:t.ab.mat4.multiply([],c.zScaleMatrix,u.nodeModelMatrix),t.ab.mat4.multiply(Ve,c.negCameraPosMatrix,Ve);const je=t.ab.mat4.invert([],Ve);t.ab.mat4.transpose(je,je);const Xe=n.paint.get("model-color-use-theme").constantOr("default")==="none",Ye=n.paint.get("model-emissive-strength").constantOr(0),at=Eh(new Float32Array(u.worldViewProjection),new Float32Array(Ve),new Float32Array(je),null,r,L,fe.baseColorFactor.toRenderColor(null),he.emissiveFactor,fe.metallicFactor,fe.roughnessFactor,he,Ye,n),pt={defines:[]},ft=[],bt=r.shadowRenderer;bt&&(bt.useNormalOffset=!1),tc(pt.defines,ft,ae,r,Xe?null:n.lut);let gt=null;if(Te){const Tt=Ri(u.nodeModelMatrix,r.transform);if(gt=new Float32Array(Tt),ne.projection.name!=="globe"){const Dt=ae.aabb.min,Zt=ae.aabb.max,[Ht,Pt]=Te.getOpacityForBounds(Tt,Dt[0],Dt[1],Zt[0],Zt[1]);pt.overrideFog=Ht>=gr||Pt>=gr}}const vt=so(r,n.paint.get("model-cutoff-fade-range"));vt.shouldRenderCutoff&&pt.defines.push("RENDER_CUTOFF");const yt=r.getOrCreateProgram("model",pt);r.uploadCommonUniforms(q,yt,null,gt,vt),r.renderPass!=="shadow"&&bt&&bt.setupShadowsFromMatrix(u.nodeModelMatrix,yt),yt.draw(r,q.gl.TRIANGLES,K,g,M,ae.material.doubleSided?ei.disabled:ei.backCCW,at,n.id,ae.vertexBuffer,ae.indexBuffer,ae.segments,n.paint,r.transform.zoom,void 0,ft)}function zl(u,r,n,c,g,M,L){let q;q=u.projection.name==="globe"?t.dl(n,u):[...n],t.ab.mat4.multiply(q,q,r.matrix);const K=t.ab.mat4.multiply([],c,q);if(r.meshes)for(const ne of r.meshes){if(ne.material.alphaMode!=="BLEND"){L.push({mesh:ne,depth:0,modelIndex:g,worldViewProjection:K,nodeModelMatrix:q});continue}const ae=t.ab.vec3.transformMat4([],ne.centroid,K);ae[2]>0&&M.push({mesh:ne,depth:ae[2],modelIndex:g,worldViewProjection:K,nodeModelMatrix:q})}if(r.children)for(const ne of r.children)zl(u,ne,n,c,g,M,L)}function Ro(u,r,n,c){const g=n.shadowRenderer;if(!g)return;const M=g.getShadowPassDepthMode(),L=g.getShadowPassColorMode(),q=g.calculateShadowPassMatrixFromMatrix(r),K=yd(q);n.getOrCreateProgram("modelDepth",{defines:n._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,M,ai.disabled,L,ei.backCCW,K,c.id,u.vertexBuffer,u.indexBuffer,u.segments,c.paint,n.transform.zoom,void 0,void 0)}function Ih(u,r,n){const c=r.updateZoomBasedPaintProperties(),g=function(M,L,q){let K,ne,ae,he=M.terrain?M.terrain.exaggeration():0;if(M.terrain&&he>0){const fe=M.terrain,Te=fe.findDEMTileFor(q);Te&&Te.dem?K=t.dn.create(fe,q,Te):he=0}if(he===0&&(L.terrainElevationMin=0,L.terrainElevationMax=0),he===L.validForExaggeration&&(he===0||K&&K._demTile&&K._demTile.tileID===L.validForDEMTile.id&&K._dem._timestamp===L.validForDEMTile.timestamp))return!1;for(const fe in L.instancesPerModel){const Te=L.instancesPerModel[fe];for(let Ve=0;Ve<Te.instancedDataArray.length;++Ve){const je=(K?he*K.getElevationAt(0|Te.instancedDataArray.float32[16*Ve],0|Te.instancedDataArray.float32[16*Ve+1],!0,!0):0)+Te.instancesEvaluatedElevation[Ve];Te.instancedDataArray.float32[16*Ve+6]=je,ne=ne?Math.min(L.terrainElevationMin,je):je,ae=ae?Math.max(L.terrainElevationMax,je):je}}return L.terrainElevationMin=ne||0,L.terrainElevationMax=ae||0,L.validForExaggeration=he,L.validForDEMTile=K&&K._demTile?{id:K._demTile.tileID,timestamp:K._dem._timestamp}:{id:void 0,timestamp:0},!0}(u,r,n);(c||g)&&(r.uploaded=!1,r.upload(u.context))}const Sa={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new t.cd([0,0,0],[t.ag,t.ag,0])};function Do(u,r){const n=1<<u.canonical.z,c=r.getFreeCameraOptions().position,g=r.elevation,M=u.canonical.x/n,L=(u.canonical.x+1)/n,q=u.canonical.y/n,K=(u.canonical.y+1)/n;let ne=r._centerAltitude;if(g){const Te=g.getMinMaxForTile(u);Te&&Te.max>ne&&(ne=Te.max)}const ae=t.aw(c.x,M,L)-c.x,he=t.aw(c.y,q,K)-c.y,fe=t.bH(ne,r.center.lat)-c.z;return r._zoomFromMercatorZ(Math.sqrt(ae*ae+he*he+fe*fe))}function fo(u,r,n,c,g,M,L){const q=u.context,K=u.renderPass==="shadow",ne=u.shadowRenderer,ae=K&&ne?ne.getShadowPassDepthMode():new qr(q.gl.LEQUAL,qr.ReadWrite,u.depthRangeFor3D),he=u.isTileAffectedByFog(M);if(n.meshes)for(const fe of n.meshes){const Te=["MODEL_POSITION_ON_GPU"],Ve=[];let je,Xe,Ye;c.instancedDataArray.length>20&&Te.push("INSTANCED_ARRAYS");const at=so(u,r.paint.get("model-cutoff-fade-range"));if(at.shouldRenderCutoff&&Te.push("RENDER_CUTOFF"),K&&ne)je=u.getOrCreateProgram("modelDepth",{defines:Te}),Xe=yd(L.shadowTileMatrix,L.shadowTileMatrix,Float32Array.from(n.matrix)),Ye=ne.getShadowPassColorMode();else{tc(Te,Ve,fe,u,r.paint.get("model-color-use-theme").constantOr("default")==="none"?null:r.lut),je=u.getOrCreateProgram("model",{defines:Te,overrideFog:he});const ft=fe.material,bt=ft.pbrMetallicRoughness,gt=r.paint.get("model-opacity").constantOr(1),vt=r.paint.get("model-emissive-strength").constantOr(0);Xe=Eh(M.expandedProjMatrix,Float32Array.from(n.matrix),new Float32Array(16),null,u,gt,bt.baseColorFactor.toRenderColor(null),ft.emissiveFactor,bt.metallicFactor,bt.roughnessFactor,ft,vt,r,g),ne&&(L.shadowUniformsInitialized?je.setShadowUniformValues(q,ne.getShadowUniformValues()):(ne.setupShadows(M.toUnwrapped(),je,"model-tile",M.overscaledZ),L.shadowUniformsInitialized=!0)),Ye=at.shouldRenderCutoff||gt<1||ft.alphaMode!=="OPAQUE"?pi.alphaBlended:pi.unblended}u.uploadCommonUniforms(q,je,M.toUnwrapped(),null,at);const pt=fe.material.doubleSided?ei.disabled:ei.backCCW;if(c.instancedDataArray.length>20)Ve.push(c.instancedDataBuffer),je.draw(u,q.gl.TRIANGLES,ae,ai.disabled,Ye,pt,Xe,r.id,fe.vertexBuffer,fe.indexBuffer,fe.segments,r.paint,u.transform.zoom,void 0,Ve,c.instancedDataArray.length);else{const ft=K?"u_instance":"u_normal_matrix";for(let bt=0;bt<c.instancedDataArray.length;++bt)Xe[ft]=new Float32Array(c.instancedDataArray.arrayBuffer,64*bt,16),je.draw(u,q.gl.TRIANGLES,ae,ai.disabled,Ye,pt,Xe,r.id,fe.vertexBuffer,fe.indexBuffer,fe.segments,r.paint,u.transform.zoom,void 0,Ve)}}if(n.children)for(const fe of n.children)fo(u,r,fe,c,g,M,L)}const Lo=[1,-1,1];function rc(u,r,n,c){if(!n.modelManager)return!0;const g=n.modelManager;if(!n.shadowRenderer)return!0;const M=n.shadowRenderer,L=r.aabb;let q=!0,K=u.maxHeight;if(K===0){let ae=0;for(const he in u.instancesPerModel){const fe=g.getModel(he,c);fe?ae=Math.max(ae,Math.max(Math.max(fe.aabb.max[0],fe.aabb.max[1]),fe.aabb.max[2])):q=!1}K=u.maxScale*ae*1.41+u.maxVerticalOffset,q&&(u.maxHeight=K)}L.max[2]=K,L.min[2]+=u.terrainElevationMin,L.max[2]+=u.terrainElevationMax,t.ab.vec3.transformMat4(L.min,L.min,r.tileMatrix),t.ab.vec3.transformMat4(L.max,L.max,r.tileMatrix);const ne=L.intersects(M.getCurrentCascadeFrustum());return n.currentShadowCascade===0&&(u.isInsideFirstShadowMapFrustum=ne===2),ne===0}function ic(u,r){const n=u.uniformValues.u_cutoff_params[0],c=u.uniformValues.u_cutoff_params[1],g=u.uniformValues.u_cutoff_params[2],M=u.uniformValues.u_cutoff_params[3];return c===n||M===g?1:t.aw(((r-n)/(c-n)-g)/(M-g),0,1)}function Ph(u,r,n,c){if(r.pitch<20)return 1;const g=r.getWorldToCameraMatrix();t.ab.mat4.multiply(g,g,u);const M=t.ab.vec4.fromValues(n.min[0],n.min[1],n.min[2],1);let L=t.ab.vec4.transformMat4(t.ab.vec4.create(),M,g),q=L,K=L;M[1]=n.max[1],L=t.ab.vec4.transformMat4(t.ab.vec4.create(),M,g),q=L[1]<q[1]?L:q,K=L[1]>K[1]?L:K,M[0]=n.max[0],L=t.ab.vec4.transformMat4(t.ab.vec4.create(),M,g),q=L[1]<q[1]?L:q,K=L[1]>K[1]?L:K,M[1]=n.min[1],L=t.ab.vec4.transformMat4(t.ab.vec4.create(),M,g),q=L[1]<q[1]?L:q,K=L[1]>K[1]?L:K;const ne=t.aw(c[0],0,1),ae=100*r.pixelsPerMeter*t.aw(c[1],0,1),he=t.aw(c[2],0,1),fe=t.ab.vec4.lerp(t.ab.vec4.create(),q,K,ne),Te=Math.tan(.5*r.fovX),Ve=-fe[2]*Te;if(ae===0)return fe[1]<-Math.abs(Ve)?he:1;const je=(-Math.abs(Ve)-fe[1])/ae,Xe=(at,pt,ft)=>(1-ft)*at+ft*pt,Ye=t.aw(Xe(1,he,je),he,1);return Xe(1,Ye,t.aw((r.pitch-20)/20,0,1))}class Ch{}class Rh{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,n,c){{const he=this._storage.get(n.id);if(he)return he.lastUsedFrameIdx=r,he.buf}const g=c.gl,M=g.getBufferParameter(g.ELEMENT_ARRAY_BUFFER,g.BUFFER_SIZE),L=new ArrayBuffer(M),q=new Int16Array(L);g.getBufferSubData(g.ELEMENT_ARRAY_BUFFER,0,new Int16Array(L));const K=new t.dq;for(let he=0;he<M/2;he+=3){const fe=q[he],Te=q[he+1],Ve=q[he+2];K.emplaceBack(fe,Te),K.emplaceBack(Te,Ve),K.emplaceBack(Ve,fe)}const ne=c.bindVertexArrayOES.current,ae=new Ch;return ae.buf=new Xa(c,K),ae.lastUsedFrameIdx=r,this._storage.set(n.id,ae),c.bindVertexArrayOES.set(ne),ae.buf}update(r){for(const[n,c]of this._storage)r-c.lastUsedFrameIdx>30&&(c.buf.destroy(),this._storage.delete(n))}destroy(){for(const[r,n]of this._storage)n.buf.destroy(),this._storage.delete(r)}}class Oo{constructor(r){this.occluderSize=30,this.depthOffset=-1e-4,r.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),r.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Dh=t.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class nc{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class ac{constructor(r,n){this.revealStart=11,this.revealRange=2,r.registerParameter(this,[...n,"Reveal"],"revealStart",{min:0,max:17,step:.05}),r.registerParameter(this,[...n,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Lh=t.da([{type:"Float32",name:"a_pos_2f",components:2}]);class zn{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(r,n){const c=r.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const L=new t.dr,q=new t.aU;L.emplaceBack(-1,-1),L.emplaceBack(1,-1),L.emplaceBack(1,1),L.emplaceBack(-1,1),q.emplaceBack(0,1,2),q.emplaceBack(0,2,3),this.vignetteVx=r.context.createVertexBuffer(L,Lh.members),this.vignetteIdx=r.context.createIndexBuffer(q)}const g=t.b7.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){r.uploadCommonUniforms(r.context,c);const L={u_vignetteShape:(M={vignetteShape:[n.start,n.range,Math.pow(10,n.fadePower)],vignetteColor:[n.color.r,n.color.g,n.color.b,n.color.a*n.strength]}).vignetteShape,u_vignetteColor:M.vignetteColor};c.draw(r,r.context.gl.TRIANGLES,qr.disabled,ai.disabled,pi.alphaBlended,ei.disabled,L,"vignette",this.vignetteVx,this.vignetteIdx,g,{})}var M}}class Oh{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(r,n){const c=r.getFreeCameraOptions().position,g=c.toAltitude(),M=c.toLngLat(),L=t.ai(M.lng),q=t.ai(M.lat),K=r.pixelsPerMeter/n,ne=L*t.ds,ae=t.ds*Math.log(Math.tan(Math.PI/4+q/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const he=-this._offsetYPrev+ae,fe=-this._elevationPrev+g;this._accumulatedOffsetX+=(-this._offsetXPrev+ne)*K,this._accumulatedOffsetY+=he*K,this._accumulatedElevation+=fe*K,this._offsetXPrev=ne,this._offsetYPrev=ae,this._elevationPrev=g}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function oc(u,r){return[-(u[0]-Math.floor(u[0]/r)*r),-(u[1]-Math.floor(u[1]/r)*r),-(u[2]-Math.floor(u[2]/r)*r)]}function qs(u){const r=t.di(1323123451230),n=[];for(let c=0;c<u;++c){const g=2*r()-1,M=2*r()-1,L=2*r()-1;n.push(t.ab.vec3.fromValues(g,M,L))}return n}function oa(u,r,n,c,g){const M=t.aw((g-n)/(c-n),0,1);return(1-M)*u+M*r}class sc{constructor(r){this._movement=new Oh,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new zn,this._ppmScaleFactor=r}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(r,n){const c=r.transform;this._movement.update(c,this._ppmScaleFactor);const g=c.starsProjMatrix,M=t.ab.quat.identity([]);t.ab.quat.rotateX(M,M,t.ai(90)-c._pitch),t.ab.quat.rotateZ(M,M,-c.angle);const L=t.ab.mat4.fromQuat(new Float32Array(16),M),q=t.ab.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),K=t.ab.mat4.transpose([],q),ne=t.ab.mat4.multiply([],K,L),ae=Date.now()/1e3;return this._accumulatedTimeFromStart+=(ae-this._prevTime)*n,this._prevTime=ae,{projectionMatrix:g,modelviewMatrix:ne}}}class zh extends sc{constructor(r){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new ac(r.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(r){const n=r.context;if(!this.particlesVx){const c=qs(this.particlesCount),g=new t.dt,M=new t.aU;let L=0;const q=t.di(1323123451230);for(let K=0;K<c.length;++K){const ne=c[K],ae=[2*q()-1,q(),q(),q()];g.emplaceBack(ne[0],ne[1],ne[2],-1,-1,...ae),g.emplaceBack(ne[0],ne[1],ne[2],1,-1,...ae),g.emplaceBack(ne[0],ne[1],ne[2],1,1,...ae),g.emplaceBack(ne[0],ne[1],ne[2],-1,1,...ae),M.emplaceBack(L+0,L+1,L+2),M.emplaceBack(L+0,L+2,L+3),L+=4}this.particlesVx=n.createVertexBuffer(g,Dh.members),this.particlesIdx=n.createIndexBuffer(M)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.rain)return;const n=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},c=r.transform.zoom;if(n.revealStart>c)return;const g=oa(0,1,n.revealStart,n.revealStart+n.revealRange,c);if(!this.particlesVx||!this.particlesIdx)return;const M=structuredClone(this._params);let L=[-M.direction.x,M.direction.y,-100];t.ab.vec3.normalize(L,L);const q=structuredClone(this._vignetteParams);q.strength*=g,M.overrideStyleParameters||(M.intensity=r.style.rain.state.density,M.timeFactor=r.style.rain.state.intensity,M.color=structuredClone(r.style.rain.state.color),L=structuredClone(r.style.rain.state.direction),M.screenThinning.intensity=r.style.rain.state.centerThinning,M.dropletSizeX=r.style.rain.state.dropletSize[0],M.dropletSizeYScale=r.style.rain.state.dropletSize[1]/r.style.rain.state.dropletSize[0],M.distortionStrength=100*r.style.rain.state.distortionStrength,q.strength=1,q.color=structuredClone(r.style.rain.state.vignetteColor));const K=this.updateOnRender(r,M.timeFactor),ne=r.context,ae=ne.gl,he=r.transform;this.screenTexture&&this.screenTexture.size[0]===r.width&&this.screenTexture.size[1]===r.height||(this.screenTexture=new t.T(ne,{width:r.width,height:r.height,data:null},ae.RGBA8)),M.distortionStrength>0&&(ne.activeTexture.set(ae.TEXTURE0),this.screenTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),ae.copyTexSubImage2D(ae.TEXTURE_2D,0,0,0,0,0,r.width,r.height));const fe=r.getOrCreateProgram("rainParticle");r.uploadCommonUniforms(ne,fe),ne.activeTexture.set(ae.TEXTURE0),this.screenTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);const Te=[M.color.r,M.color.g,M.color.b,M.color.a],Ve=(je,Xe)=>{const Ye=oc(this._movement.getPosition(),je),at=M.dropletSizeX,pt=M.dropletSizeX*M.dropletSizeYScale,ft=r.width/2,bt=r.height/2,gt=oa(0,M.screenThinning.start,0,1,M.screenThinning.intensity),vt=oa(.001,M.screenThinning.range,0,1,M.screenThinning.intensity),yt=oa(0,M.screenThinning.particleOffset,0,1,M.screenThinning.intensity),Tt=(Dt={modelview:K.modelviewMatrix,projection:K.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Ye,velocityConeAperture:M.velocityConeAperture,velocity:M.velocity,boxSize:je,rainDropletSize:[at,pt],distortionStrength:M.distortionStrength,rainDirection:L,color:Te,screenSize:[he.width,he.height],thinningCenterPos:[ft,bt],thinningShape:[gt,vt,Math.pow(10,M.screenThinning.fadePower)],thinningAffectedRatio:M.screenThinning.affectedRatio,thinningParticleOffset:yt,shapeDirectionalPower:M.shapeDirPower,shapeNormalPower:M.shapeNormalPower,mode:Xe?0:1},{u_modelview:Float32Array.from(Dt.modelview),u_projection:Float32Array.from(Dt.projection),u_time:Dt.time,u_cam_pos:Dt.camPos,u_texScreen:0,u_velocityConeAperture:Dt.velocityConeAperture,u_velocity:Dt.velocity,u_boxSize:Dt.boxSize,u_rainDropletSize:Dt.rainDropletSize,u_distortionStrength:Dt.distortionStrength,u_rainDirection:Dt.rainDirection,u_color:Dt.color,u_screenSize:Dt.screenSize,u_thinningCenterPos:Dt.thinningCenterPos,u_thinningShape:Dt.thinningShape,u_thinningAffectedRatio:Dt.thinningAffectedRatio,u_thinningParticleOffset:Dt.thinningParticleOffset,u_shapeDirectionalPower:Dt.shapeDirectionalPower,u_shapeNormalPower:Dt.shapeNormalPower,u_mode:Dt.mode});var Dt;const Zt=Math.round(g*M.intensity*this.particlesCount),Ht=t.b7.simpleSegment(0,0,4*Zt,2*Zt);fe.draw(r,ae.TRIANGLES,qr.disabled,ai.disabled,pi.alphaBlended,ei.disabled,Tt,"rain_particles",this.particlesVx,this.particlesIdx,Ht,{})};M.distortionStrength>0&&Ve(M.boxSize,!0),Ve(M.boxSize,!1),this._vignette.draw(r,q)}}const kh=t.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class ss extends sc{constructor(r){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new ac(r.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(r){const n=r.context;if(!this.particlesVx){const c=qs(this.particlesCount),g=new t.du,M=new t.aU;let L=0;const q=t.di(1323123451230);for(let K=0;K<c.length;++K){const ne=c[K],ae=q(),he=q(),fe=q(),Te=[K/c.length,ae,he,fe],Ve=[q(),q()];g.emplaceBack(ne[0],ne[1],ne[2],-1,-1,...Te,...Ve),g.emplaceBack(ne[0],ne[1],ne[2],1,-1,...Te,...Ve),g.emplaceBack(ne[0],ne[1],ne[2],1,1,...Te,...Ve),g.emplaceBack(ne[0],ne[1],ne[2],-1,1,...Te,...Ve),M.emplaceBack(L+0,L+1,L+2),M.emplaceBack(L+0,L+2,L+3),L+=4}this.particlesVx=n.createVertexBuffer(g,kh.members),this.particlesIdx=n.createIndexBuffer(M)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.snow)return;const n=structuredClone(this._params);let c=[-n.direction.x,n.direction.y,-100];t.ab.vec3.normalize(c,c);const g=structuredClone(this._vignetteParams),M=n.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},L=r.transform.zoom;if(M.revealStart>L)return;const q=oa(0,1,M.revealStart,M.revealStart+M.revealRange,L);g.strength*=q,n.overrideStyleParameters||(n.intensity=r.style.snow.state.density,n.timeFactor=r.style.snow.state.intensity,n.color=structuredClone(r.style.snow.state.color),c=structuredClone(r.style.snow.state.direction),n.screenThinning.intensity=r.style.snow.state.centerThinning,n.billboardSize=2.79*r.style.snow.state.flakeSize,g.strength=1,g.color=structuredClone(r.style.snow.state.vignetteColor));const K=this.updateOnRender(r,n.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const ne=r.context,ae=ne.gl,he=r.transform,fe=r.getOrCreateProgram("snowParticle");r.uploadCommonUniforms(ne,fe),((Te,Ve,je)=>{const Xe=oc(this._movement.getPosition(),Te),Ye=he.width/2,at=he.height/2,pt=oa(0,je.screenThinning.start,0,1,je.screenThinning.intensity),ft=oa(.001,je.screenThinning.range,0,1,je.screenThinning.intensity),bt=oa(0,je.screenThinning.particleOffset,0,1,je.screenThinning.intensity),gt=(vt={modelview:K.modelviewMatrix,projection:K.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Xe,velocityConeAperture:je.velocityConeAperture,velocity:je.velocity,horizontalOscillationRadius:je.horizontalOscillationRadius,horizontalOscillationRate:je.horizontalOscillationRate,boxSize:Te,billboardSize:1*je.billboardSize,simpleShapeParameters:[je.shapeFadeStart,je.shapeFadePower],screenSize:[he.width,he.height],thinningCenterPos:[Ye,at],thinningShape:[pt,ft,Math.pow(10,je.screenThinning.fadePower)],thinningAffectedRatio:je.screenThinning.affectedRatio,thinningParticleOffset:bt,color:[je.color.r,je.color.g,je.color.b,je.color.a],direction:c},{u_modelview:Float32Array.from(vt.modelview),u_projection:Float32Array.from(vt.projection),u_time:vt.time,u_cam_pos:vt.camPos,u_velocityConeAperture:vt.velocityConeAperture,u_velocity:vt.velocity,u_horizontalOscillationRadius:vt.horizontalOscillationRadius,u_horizontalOscillationRate:vt.horizontalOscillationRate,u_boxSize:vt.boxSize,u_billboardSize:vt.billboardSize,u_simpleShapeParameters:vt.simpleShapeParameters,u_screenSize:vt.screenSize,u_thinningCenterPos:vt.thinningCenterPos,u_thinningShape:vt.thinningShape,u_thinningAffectedRatio:vt.thinningAffectedRatio,u_thinningParticleOffset:vt.thinningParticleOffset,u_particleColor:vt.color,u_direction:vt.direction});var vt;const yt=Math.round(q*je.intensity*this.particlesCount),Tt=t.b7.simpleSegment(0,0,4*yt,2*yt);this.particlesVx&&this.particlesIdx&&fe.draw(r,ae.TRIANGLES,qr.disabled,ai.disabled,pi.alphaBlended,ei.disabled,gt,"snow_particles",this.particlesVx,this.particlesIdx,Tt,{})})(n.boxSize,0,n),this._vignette.draw(r,g)}}const kl={symbol:function(u,r,n,c,g){if(u.renderPass!=="translucent")return;const M=ai.disabled,L=u.colorModeForRenderPass(),q=n.layout.get("text-variable-anchor"),K=n.layout.get("text-size-scale-range"),ne=t.aw(u.scaleFactor,K[0],K[1]);q&&function(fe,Te,Ve,je,Xe,Ye,at,pt){const ft=Te.transform,bt=Xe==="map",gt=Ye==="map";for(const vt of fe){const yt=je.getTile(vt),Tt=yt.getBucket(Ve);if(!Tt||!Tt.text||!Tt.text.segments.get().length)continue;const Dt=t.bp(Tt.textSizeData,ft.zoom,pt),Zt=gl(vt,Tt.getProjection(),ft),Ht=ft.calculatePixelsToTileUnitsMatrix(yt),Pt=io(Zt,yt.tileID.canonical,gt,bt,ft,Tt.getProjection(),Ht),zt=Tt.hasIconTextFit()&&Tt.hasIconData();if(Dt){const tr=Math.pow(2,ft.zoom-yt.tileID.overscaledZ);Ta(Tt,bt,gt,at,t.cX,ft,Pt,vt,tr,Dt,zt)}}}(c,u,n,r,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),g,ne);const ae=n.paint.get("icon-opacity").constantOr(1)!==0,he=n.paint.get("text-opacity").constantOr(1)!==0;n.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(ae||he)?Xi(u,r,n,c,M,L):(ae&&Xi(u,r,n,c,M,L,{onlyIcons:!0}),he&&Xi(u,r,n,c,M,L,{onlyText:!0})),r.map.showCollisionBoxes&&(Xu(u,r,n,c,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),Xu(u,r,n,c,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(u,r,n,c){if(u.renderPass!=="translucent")return;const g=n.paint.get("circle-opacity"),M=n.paint.get("circle-stroke-width"),L=n.paint.get("circle-stroke-opacity"),q=n.layout.get("circle-sort-key").constantOr(1)!==void 0,K=n.paint.get("circle-emissive-strength");if(g.constantOr(1)===0&&(M.constantOr(1)===0||L.constantOr(1)===0))return;const ne=u.context,ae=ne.gl,he=u.transform,fe=u.depthModeForSublayer(0,qr.ReadOnly),Te=ai.disabled,Ve=u.colorModeForDrapableLayerRenderPass(K),je=he.projection.name==="globe",Xe=[t.at(he.center.lng),t.aA(he.center.lat)],Ye=[];for(let pt=0;pt<c.length;pt++){const ft=c[pt],bt=r.getTile(ft),gt=bt.getBucket(n);if(!gt||gt.projection.name!==he.projection.name)continue;const vt=gt.programConfigurations.get(n.id),yt=t.cY(n),Tt=u.isTileAffectedByFog(ft);je&&yt.push("PROJECTION_GLOBE_VIEW"),yt.push("DEPTH_D24"),u.terrain&&he.depthOcclusionForSymbolsAndCircles&&yt.push("DEPTH_OCCLUSION");const Dt=u.getOrCreateProgram("circle",{config:vt,defines:yt,overrideFog:Tt}),Zt=gt.layoutVertexBuffer,Ht=gt.globeExtVertexBuffer,Pt=gt.indexBuffer,zt=he.projection.createInversionMatrix(he,ft.canonical),tr={programConfiguration:vt,program:Dt,layoutVertexBuffer:Zt,globeExtVertexBuffer:Ht,indexBuffer:Pt,uniformValues:t.cZ(u,ft,bt,zt,Xe,n),tile:bt};if(q){const lr=gt.segments.get();for(const pr of lr)Ye.push({segments:new t.b7([pr]),sortKey:pr.sortKey,state:tr})}else Ye.push({segments:gt.segments,sortKey:0,state:tr})}q&&Ye.sort((pt,ft)=>pt.sortKey-ft.sortKey);const at={useDepthForOcclusion:he.depthOcclusionForSymbolsAndCircles};for(const pt of Ye){const{programConfiguration:ft,program:bt,layoutVertexBuffer:gt,globeExtVertexBuffer:vt,indexBuffer:yt,uniformValues:Tt,tile:Dt}=pt.state,Zt=pt.segments;u.terrain&&u.terrain.setupElevationDraw(Dt,bt,at),u.uploadCommonUniforms(ne,bt,Dt.tileID.toUnwrapped()),bt.draw(u,ae.TRIANGLES,fe,Te,Ve,ei.disabled,Tt,n.id,gt,yt,Zt,n.paint,he.zoom,ft,[vt])}},heatmap:function(u,r,n,c){if(n.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const g=u.context,M=g.gl,L=ai.disabled,q=new pi([M.ONE,M.ONE,M.ONE,M.ONE],t.aj.transparent,[!0,!0,!0,!0]);(function(Te,Ve,je,Xe){const Ye=Te.gl,at=Ve.width*Xe,pt=Ve.height*Xe;Te.activeTexture.set(Ye.TEXTURE1),Te.viewport.set([0,0,at,pt]);let ft=je.heatmapFbo;if(!ft||ft&&(ft.width!==at||ft.height!==pt)){ft&&ft.destroy();const bt=Ye.createTexture();Ye.bindTexture(Ye.TEXTURE_2D,bt),Ye.texParameteri(Ye.TEXTURE_2D,Ye.TEXTURE_WRAP_S,Ye.CLAMP_TO_EDGE),Ye.texParameteri(Ye.TEXTURE_2D,Ye.TEXTURE_WRAP_T,Ye.CLAMP_TO_EDGE),Ye.texParameteri(Ye.TEXTURE_2D,Ye.TEXTURE_MIN_FILTER,Ye.LINEAR),Ye.texParameteri(Ye.TEXTURE_2D,Ye.TEXTURE_MAG_FILTER,Ye.LINEAR),ft=je.heatmapFbo=Te.createFramebuffer(at,pt,!0,null),function(gt,vt,yt,Tt,Dt,Zt){const Ht=gt.gl;Ht.texImage2D(Ht.TEXTURE_2D,0,gt.extRenderToTextureHalfFloat?Ht.RGBA16F:Ht.RGBA,Dt,Zt,0,Ht.RGBA,gt.extRenderToTextureHalfFloat?Ht.HALF_FLOAT:Ht.UNSIGNED_BYTE,null),Tt.colorAttachment.set(yt)}(Te,0,bt,ft,at,pt)}else Ye.bindTexture(Ye.TEXTURE_2D,ft.colorAttachment.get()),Te.bindFramebuffer.set(ft.framebuffer)})(g,u,n,u.transform.projection.name==="globe"?.5:.25),g.clear({color:t.aj.transparent});const K=u.transform,ne=K.projection.name==="globe",ae=ne?["PROJECTION_GLOBE_VIEW"]:[],he=ne?ei.frontCCW:ei.disabled,fe=[t.at(K.center.lng),t.aA(K.center.lat)];for(let Te=0;Te<c.length;Te++){const Ve=c[Te];if(r.hasRenderableParent(Ve))continue;const je=r.getTile(Ve),Xe=je.getBucket(n);if(!Xe||Xe.projection.name!==K.projection.name)continue;const Ye=u.isTileAffectedByFog(Ve),at=Xe.programConfigurations.get(n.id),pt=u.getOrCreateProgram("heatmap",{config:at,defines:ae,overrideFog:Ye}),{zoom:ft}=u.transform;u.terrain&&u.terrain.setupElevationDraw(je,pt),u.uploadCommonUniforms(g,pt,Ve.toUnwrapped());const bt=K.projection.createInversionMatrix(K,Ve.canonical);pt.draw(u,M.TRIANGLES,qr.disabled,L,q,he,Ns(u,Ve,je,bt,fe,ft,n.paint.get("heatmap-intensity")),n.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,n.paint,u.transform.zoom,at,ne?[Xe.globeExtVertexBuffer]:null)}g.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(g,M){const L=g.context,q=L.gl,K=M.heatmapFbo;if(!K)return;L.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,K.colorAttachment.get()),L.activeTexture.set(q.TEXTURE1);let ne=M.colorRampTexture;ne||(ne=M.colorRampTexture=new t.T(L,M.colorRamp,q.RGBA8)),ne.bind(q.LINEAR,q.CLAMP_TO_EDGE),g.getOrCreateProgram("heatmapTexture").draw(g,q.TRIANGLES,qr.disabled,ai.disabled,g.colorModeForRenderPass(),ei.disabled,((ae,he,fe,Te)=>({u_image:0,u_color_ramp:1,u_opacity:he.paint.get("heatmap-opacity")}))(0,M),M.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,M.paint,g.transform.zoom)}(u,n))},line:function(u,r,n,c){if(u.renderPass!=="translucent")return;const g=n.paint.get("line-opacity"),M=n.paint.get("line-width");if(g.constantOr(1)===0||M.constantOr(1)===0)return;const L=n.paint.get("line-emissive-strength"),q=n.paint.get("line-occlusion-opacity"),K=n.layout.get("line-elevation-reference"),ne=n.layout.get("line-width-unit")==="meters",ae=K==="sea",he=u.context,fe=he.gl,Te=!n.isDraped();if(Te&&u.transform.projection.name==="globe")return;const Ve=n.layout.get("line-cross-slope"),je=Ve!==void 0,Xe=Ve<1,Ye=Te?new qr(u.depthOcclusion?fe.GREATER:fe.LEQUAL,qr.ReadOnly,u.depthRangeFor3D):u.depthModeForSublayer(0,qr.ReadOnly),at=u.colorModeForDrapableLayerRenderPass(L),pt=u.terrain&&u.terrain.renderingToTexture,ft=pt?1:t.q.devicePixelRatio,bt=n.paint.get("line-dasharray"),gt=bt.constantOr(1),vt=n.layout.get("line-cap"),yt=bt.constantOr(null),Tt=vt.constantOr(null),Dt=n.paint.get("line-pattern"),Zt=Dt.constantOr(1),Ht=Dt.constantOr(null),Pt=n.paint.get("line-opacity").constantOr(1);let zt=!Zt&&Pt!==1||u.depthOcclusion&&q>0&&q<1;const tr=n.paint.get("line-gradient"),lr=Zt?"linePattern":"line",pr=t.c_(n);let Gt;if(pt&&u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(zt=!1),q!==0&&u.depthOcclusion){const Xt=n.paint._values["line-opacity"];Xt&&Xt.value&&Xt.value.kind==="constant"?Gt=Xt.value:t.w(`Occlusion opacity for layer ${n.id} is supported only when line-opacity isn't data-driven.`)}if(Te&&(u.forceTerrainMode=!0),!Te&&q!==0&&u.terrain&&!pt)return void t.w(`Occlusion opacity for layer ${n.id} is supported on terrain only if the layer has line-z-offset enabled.`);const nr=zt&&Te?u.stencilModeFor3D():ai.disabled;Te&&(pr.push("ELEVATED"),je&&pr.push(Xe?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),ae&&pr.push("ELEVATION_REFERENCE_SEA")),M.value.kind!=="constant"&&M.value.isLineProgressConstant===!1&&pr.push("VARIABLE_LINE_WIDTH");for(const Xt of c){const hr=r.getTile(Xt);if(Zt&&!hr.patternsLoaded())continue;const ar=hr.getBucket(n);if(!ar)continue;u.prepareDrawTile();const er=ar.programConfigurations.get(n.id),Sr=u.isTileAffectedByFog(Xt),mr=u.getOrCreateProgram(lr,{config:er,defines:pr,overrideFog:Sr,overrideRtt:!Te&&void 0});if(Ht&&hr.imageAtlas){const di=t.A.from(Ht),Hi=hr.imageAtlas.patternPositions[di.getSerializedPrimary()];Hi&&er.setConstantPatternPositions(Hi)}if(!Zt&&yt&&Tt&&hr.lineAtlas){const di=hr.lineAtlas.getDash(yt,Tt);di&&er.setConstantPatternPositions(di)}let[Mr,Lr]=n.paint.get("line-trim-offset");(Tt==="round"||Tt==="square")&&Mr!==Lr&&(Mr===0&&(Mr-=1),Lr===1&&(Lr+=1));const ri=pt?Xt.projMatrix:null,Gr=ne?1/ar.tileToMeter/t.ar(hr,1,u.transform.zoom):1,Zr=ne?1/ar.tileToMeter/t.ar(hr,1,Math.floor(u.transform.zoom)):1,ii=Zt?t.c$(u,hr,n,ri,ft,Gr,Zr,[Mr,Lr]):t.d0(u,hr,n,ri,ar.lineClipsArray.length,ft,Gr,Zr,[Mr,Lr]);if(tr){const di=ar.gradients[n.id];let Hi=di.texture;if(n.gradientVersion!==di.version){let Yi=256;if(n.stepInterpolant){const Di=r.getSource().maxzoom,ki=Xt.canonical.z===Di?Math.ceil(1<<u.transform.maxZoom-Xt.canonical.z):1;Yi=t.aw(t.d1(ar.maxLineLength/t.ag*1024*ki),256,he.maxTextureSize)}di.gradient=t.d2({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:Yi,image:di.gradient||void 0,clips:ar.lineClipsArray}),di.texture?di.texture.update(di.gradient):di.texture=new t.T(he,di.gradient,fe.RGBA8),di.version=n.gradientVersion,Hi=di.texture}he.activeTexture.set(fe.TEXTURE1),Hi.bind(n.stepInterpolant?fe.NEAREST:fe.LINEAR,fe.CLAMP_TO_EDGE)}gt&&(he.activeTexture.set(fe.TEXTURE0),hr.lineAtlasTexture&&hr.lineAtlasTexture.bind(fe.LINEAR,fe.REPEAT),er.updatePaintBuffers()),Zt&&(he.activeTexture.set(fe.TEXTURE0),hr.imageAtlasTexture&&hr.imageAtlasTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),er.updatePaintBuffers()),Te&&!ae&&u.terrain.setupElevationDraw(hr,mr),u.uploadCommonUniforms(he,mr,Xt.toUnwrapped());const vi=di=>{Gt!=null&&(Gt.value=Pt*q),mr.draw(u,fe.TRIANGLES,Ye,di,at,ei.disabled,ii,n.id,ar.layoutVertexBuffer,ar.indexBuffer,ar.segments,n.paint,u.transform.zoom,er,[ar.layoutVertexBuffer2,ar.patternVertexBuffer,ar.zOffsetVertexBuffer]),Gt!=null&&(Gt.value=Pt)};if(zt&&!Te){const di=u.stencilModeForClipping(Xt).ref;di===0&&pt&&he.clear({stencil:0});const Hi={func:fe.EQUAL,mask:255};ii.u_alpha_discard_threshold=.8,vi(new ai(Hi,di,255,fe.KEEP,fe.KEEP,fe.INVERT)),ii.u_alpha_discard_threshold=0,vi(new ai(Hi,di,255,fe.KEEP,fe.KEEP,fe.KEEP))}else zt&&Te&&(ii.u_alpha_discard_threshold=.001),vi(Te?nr:u.stencilModeForClipping(Xt))}Te&&(u.forceTerrainMode=!1),zt&&(u.resetStencilClippingMasks(),pt&&he.clear({stencil:0})),q===0||u.depthOcclusion||pt||u.layersWithOcclusionOpacity.push(u.currentLayer)},fill:function(u,r,n,c){const g=n.paint.get("fill-color"),M=n.paint.get("fill-opacity"),L=n.is3D(),q=new qr(u.context.gl.LEQUAL,qr.ReadWrite,u.depthRangeFor3D);if(M.constantOr(1)===0)return;const K=n.paint.get("fill-emissive-strength"),ne=u.colorModeForDrapableLayerRenderPass(K),ae=n.paint.get("fill-pattern"),he=u.opaquePassEnabledForLayer()&&!ae.constantOr(1)&&g.constantOr(t.aj.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===he){const fe=L?q:u.depthModeForSublayer(1,u.renderPass==="opaque"?qr.ReadWrite:qr.ReadOnly);Ku(u,r,n,c,fe,ne,!1)}if(!L&&u.renderPass==="translucent"&&n.paint.get("fill-antialias")){const fe=L?q:u.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,qr.ReadOnly);Ku(u,r,n,c,fe,ne,!0)}},"fill-extrusion":function(u,r,n,c){const g=n.paint.get("fill-extrusion-opacity"),M=u.context,L=M.gl,q=u.terrain,K=q&&q.renderingToTexture;if(g===0)return;const ne=u.conflationActive&&u.style.isLayerClipped(n,r.getSource()),ae=u.style.order.indexOf(n.fqid);if(ne&&function(he,fe,Te,Ve,je){for(const Xe of Ve){const Ye=fe.getTile(Xe).getBucket(Te);Ye&&(Ye.updateReplacement(Xe,he.replacementSource,je),Ye.uploadCentroid(he.context))}}(u,r,n,c,ae),q||ne)for(const he of c){const fe=r.getTile(he).getBucket(n);fe&&bd(u.context,r,he,fe,n,q,ne)}if(u.renderPass==="shadow"&&u.shadowRenderer){const he=u.shadowRenderer;if(q&&g<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof t.a9)return;const fe=he.getShadowPassDepthMode(),Te=he.getShadowPassColorMode();Rl(u,r,n,c,fe,ai.disabled,Te,ne)}else if(u.renderPass==="translucent"){const he=!n.paint.get("fill-extrusion-pattern").constantOr(1),fe=n.paint.get("fill-extrusion-color").constantOr(t.aj.white);if(!K&&fe.a!==0){const Te=new qr(u.context.gl.LEQUAL,qr.ReadWrite,u.depthRangeFor3D);g===1&&he?Rl(u,r,n,c,Te,ai.disabled,pi.unblended,ne):(Rl(u,r,n,c,Te,ai.disabled,pi.disabled,ne),Rl(u,r,n,c,Te,u.stencilModeFor3D(),u.colorModeForRenderPass(),ne),u.resetStencilClippingMasks())}if(u.style.enable3dLights()&&he&&(!q&&u.transform.projection.name!=="globe"||K)){const Te=n.paint.get("fill-extrusion-opacity"),Ve=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),je=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),Xe=n.paint.get("fill-extrusion-flood-light-intensity"),Ye=n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",at=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(Ye?null:n.lut).toArray01().slice(0,3),pt=Ve>0&&je>0,ft=Xe>0,bt=(vt,yt,Tt)=>(1-Tt)*vt+Tt*yt,gt=vt=>{const yt=u.depthModeForSublayer(1,qr.ReadOnly,L.LEQUAL,!0),Tt=n.paint.get(vt?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Dt=bt(.1,3,Tt),Zt=u._showOverdrawInspector;if(!Zt){const Ht=new ai({func:L.ALWAYS,mask:255},255,255,L.KEEP,L.KEEP,L.REPLACE),Pt=new pi([L.ONE,L.ONE,L.ONE,L.ONE],t.aj.transparent,[!1,!1,!1,!0],L.MIN);ns(u,r,n,c,yt,Ht,Pt,ei.disabled,vt,"sdf",Te,Ve,je,Xe,at,Dt,ne,!1)}{const Ht=Zt?ai.disabled:new ai({func:L.EQUAL,mask:255},255,255,L.KEEP,L.DECR,L.DECR),Pt=Zt?u.colorModeForRenderPass():new pi([L.ONE_MINUS_DST_ALPHA,L.DST_ALPHA,L.ONE,L.ONE],t.aj.transparent,[!0,!0,!0,!0]);ns(u,r,n,c,yt,Ht,Pt,ei.disabled,vt,"color",Te,Ve,je,Xe,at,Dt,ne,!1)}};if(K){const vt=(yt,Tt,Dt)=>{const Zt=u.depthModeForSublayer(1,qr.ReadOnly,L.LEQUAL,!1),Ht=n.paint.get(yt?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Pt=bt(.1,3,Ht);{const zt=new pi([L.ONE,L.ONE,L.ONE,L.ONE],t.aj.transparent,[!1,!1,!1,!0]);ns(u,r,n,c,Zt,ai.disabled,zt,ei.disabled,yt,"clear",Te,Ve,je,Xe,at,Pt,ne,Tt)}{const zt=new ai({func:L.ALWAYS,mask:255},255,255,L.KEEP,L.KEEP,L.REPLACE),tr=new pi([L.ONE,L.ONE,L.ONE,L.ONE],t.aj.transparent,[!1,!1,!1,!0],L.MIN);ns(u,r,n,c,Zt,zt,tr,ei.disabled,yt,"sdf",Te,Ve,je,Xe,at,Pt,ne,Tt)}{const zt=yt?L.ZERO:L.ONE_MINUS_DST_ALPHA,tr=new ai({func:L.EQUAL,mask:255},255,255,L.KEEP,L.DECR,L.DECR),lr=new pi([zt,L.DST_ALPHA,L.ONE_MINUS_DST_ALPHA,L.ZERO],t.aj.transparent,[!0,!0,!0,!0]);ns(u,r,n,c,Zt,tr,lr,ei.disabled,yt,"color",Te,Ve,je,Xe,at,Pt,ne,Tt)}{const zt=new pi([L.ONE,L.ONE,L.ONE,yt?L.ZERO:L.ONE],t.aj.transparent,[!1,!1,!1,!0],yt?L.FUNC_ADD:L.MAX);ns(u,r,n,c,Zt,ai.disabled,zt,ei.disabled,yt,"clear",Te,Ve,je,Xe,at,Pt,ne,Tt,Dt)}};if(pt||ft){let yt;if(u.prepareDrawTile(),q){const Tt=q.drapeBufferSize[0],Dt=q.drapeBufferSize[1];yt=q.framebufferCopyTexture,yt&&(!yt||yt.size[0]===Tt&&yt.size[1]===Dt)||(yt&&yt.destroy(),yt=q.framebufferCopyTexture=new t.T(M,new t.r({width:Tt,height:Dt}),L.RGBA8)),yt.bind(L.LINEAR,L.CLAMP_TO_EDGE),L.copyTexSubImage2D(L.TEXTURE_2D,0,0,0,0,0,Tt,Dt)}pt&&vt(!0,!1,yt),ft&&vt(!1,!0,yt)}}else pt&&gt(!0),ft&&gt(!1),(pt||ft)&&u.resetStencilClippingMasks()}}},hillshade:function(u,r,n,c){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent"||u.style.disableElevatedTerrain)return;const g=u.context,M=u.terrain&&u.terrain.renderingToTexture,[L,q]=u.renderPass!=="translucent"||M?[{},c]:u.stencilConfigForOverlap(c);for(const K of q){const ne=r.getTile(K);if(ne.needsHillshadePrepare&&u.renderPass==="offscreen")id(u,ne,n);else if(u.renderPass==="translucent"){const ae=u.depthModeForSublayer(0,qr.ReadOnly),he=n.paint.get("hillshade-emissive-strength"),fe=u.colorModeForDrapableLayerRenderPass(he),Te=M&&u.terrain?u.terrain.stencilModeForRTTOverlap(K):L[K.overscaledZ];rd(u,K,ne,n,ae,Te,fe)}}g.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,r,n,c,g,M){if(u.renderPass!=="translucent"||n.paint.get("raster-opacity")===0)return;const L=u.transform.projection.name==="globe",q=n.paint.get("raster-elevation")!==0,K=q&&L;if(u.renderElevatedRasterBackface&&!K)return;const ne=u.context,ae=ne.gl,he=r.getSource(),fe=function(gt,vt,yt,Tt){const Dt=vt.paint.get("raster-color"),Zt=gt.type==="raster-array",Ht=[],Pt=vt.paint.get("raster-resampling"),zt=vt.paint.get("raster-color-mix");let tr=vt.paint.get("raster-color-range");const lr=[zt[0],zt[1],zt[2],0],pr=zt[3];let Gt=Pt==="nearest"?Tt.NEAREST:Tt.LINEAR;if(Zt&&(Ht.push("RASTER_ARRAY"),Dt||Ht.push("RASTER_COLOR"),Pt==="linear"&&Ht.push("RASTER_ARRAY_LINEAR"),Gt=Tt.NEAREST,!tr&&gt.rasterLayers)){const nr=gt.rasterLayers.find(({id:Xt})=>Xt===vt.sourceLayer);nr&&nr.fields&&nr.fields.range&&(tr=nr.fields.range)}if(tr=tr||[0,1],Dt){Ht.push("RASTER_COLOR"),yt.activeTexture.set(Tt.TEXTURE2),vt.updateColorRamp(tr);let nr=vt.colorRampTexture;nr||(nr=vt.colorRampTexture=new t.T(yt,vt.colorRamp,Tt.RGBA8)),nr.bind(Tt.LINEAR,Tt.CLAMP_TO_EDGE)}return{mix:lr,range:tr,offset:pr,defines:Ht,resampling:Gt}}(he,n,ne,ae);if(he instanceof t.aJ&&!c.length&&!L)return;const Te=n.paint.get("raster-emissive-strength"),Ve=u.colorModeForDrapableLayerRenderPass(Te),je=u.terrain&&u.terrain.renderingToTexture,Xe=!u.options.moving,Ye=n.paint.get("raster-resampling")==="nearest"?ae.NEAREST:ae.LINEAR;if(he instanceof t.aJ&&!c.length&&(he.onNorthPole||he.onSouthPole)){const gt=q?u.stencilModeFor3D():ai.disabled;return void Co(!!he.onNorthPole,null,u,r,n,Te,fe,ei.disabled,gt)}if(!c.length)return;const[at,pt]=he instanceof t.aJ||je?[{},c]:u.stencilConfigForOverlap(c),ft=pt[pt.length-1].overscaledZ;K&&fe.defines.push("PROJECTION_GLOBE_VIEW"),q&&fe.defines.push("RENDER_CUTOFF");const bt=(gt,vt,yt)=>{for(const Tt of gt){const Dt=Tt.toUnwrapped(),Zt=r.getTile(Tt);if(je&&(!Zt||!Zt.hasData()))continue;ne.activeTexture.set(ae.TEXTURE0);const Ht=qt(Zt,he,n,fe);if(!Ht||!Ht.texture)continue;const{texture:Pt,mix:zt,offset:tr,tileSize:lr,buffer:pr}=Ht;let Gt,nr;je?(Gt=qr.disabled,nr=Tt.projMatrix):q?(Gt=new qr(ae.LEQUAL,qr.ReadWrite,u.depthRangeFor3D),nr=L?Float32Array.from(u.transform.expandedFarZProjMatrix):u.transform.calculateProjMatrix(Dt,Xe)):(Gt=u.depthModeForSublayer(Tt.overscaledZ-ft,n.paint.get("raster-opacity")===1?qr.ReadWrite:qr.ReadOnly,ae.LESS),nr=u.transform.calculateProjMatrix(Dt,Xe));const Xt=u.terrain&&je?u.terrain.stencilModeForRTTOverlap(Tt):at[Tt.overscaledZ],hr=M?0:n.paint.get("raster-fade-duration");Zt.registerFadeDuration(hr);const ar=r.findLoadedParent(Tt,0),er=ju(Zt,ar,r,u.transform,hr);let Sr,mr;u.terrain&&u.terrain.prepareDrawTile(),ne.activeTexture.set(ae.TEXTURE0),Pt.bind(Ye,ae.CLAMP_TO_EDGE),ne.activeTexture.set(ae.TEXTURE1),ar?(ar.texture&&ar.texture.bind(Ye,ae.CLAMP_TO_EDGE),Sr=Math.pow(2,ar.tileID.overscaledZ-Zt.tileID.overscaledZ),mr=[Zt.tileID.canonical.x*Sr%1,Zt.tileID.canonical.y*Sr%1]):Pt.bind(Ye,ae.CLAMP_TO_EDGE),Pt.useMipmap&&ne.extTextureFilterAnisotropic&&u.transform.pitch>20&&ae.texParameterf(ae.TEXTURE_2D,ne.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ne.extTextureFilterAnisotropicMax);const Mr=u.transform;let Lr;const ri=q?on(Mr):[0,0,0,0];let Gr,Zr,ii,vi,di,Hi=0;if(K&&he instanceof t.aJ&&he.coordinates.length>3)Gr=Float32Array.from(t.bb(t.cH(new t.bT(0,0,0)))),Zr=Float32Array.from(Mr.globeMatrix),ii=Float32Array.from(t.cD(Mr)),vi=[t.at(Mr.center.lng),t.aA(Mr.center.lat)],Lr=he.elevatedGlobePerspectiveTransform,di=he.elevatedGlobeGridMatrix||new Float32Array(9);else if(K){const ui=t.cE(Tt.canonical);Hi=t.cF(ui.getCenter().lat),Gr=Float32Array.from(t.bb(t.cH(Tt.canonical))),Zr=Float32Array.from(Mr.globeMatrix),ii=Float32Array.from(t.cD(Mr)),vi=[t.at(Mr.center.lng),t.aA(Mr.center.lat)],Lr=[0,0],di=Float32Array.from(t.cG(Tt.canonical,ui,Hi,Mr.worldSize/Mr._pixelsPerMercatorPixel))}else Lr=he instanceof t.aJ?he.perspectiveTransform:[0,0],Gr=new Float32Array(16),Zr=new Float32Array(9),ii=new Float32Array(16),vi=[0,0],di=new Float32Array(9);const Yi=bh(nr,Gr,Zr,ii,di,mr||[0,0],t.ae(u.transform.zoom),vi,ri,Sr||1,er,n,Lr,q?n.paint.get("raster-elevation"):0,2,zt,tr,fe.range,lr,pr,Te),Di=u.isTileAffectedByFog(Tt),ki=u.getOrCreateProgram("raster",{defines:fe.defines,overrideFog:Di});if(u.uploadCommonUniforms(ne,ki,Dt),he instanceof t.aJ){const ui=he.elevatedGlobeVertexBuffer,Xr=he.elevatedGlobeIndexBuffer;if(je||!L)he.boundsBuffer&&he.boundsSegments&&ki.draw(u,ae.TRIANGLES,Gt,ai.disabled,Ve,ei.disabled,Yi,n.id,he.boundsBuffer,u.quadTriangleIndexBuffer,he.boundsSegments);else if(ui&&Xr){const Ii=Mr.zoom<=t.c6?he.elevatedGlobeSegments:he.getSegmentsForLongitude(Mr.center.lng);Ii&&ki.draw(u,ae.TRIANGLES,Gt,ai.disabled,Ve,vt,Yi,n.id,ui,Xr,Ii)}}else if(K){Gt=new qr(ae.LEQUAL,qr.ReadOnly,u.depthRangeFor3D);const ui=u.globeSharedBuffers;if(ui){const[Xr,Ii,Li]=ui.getGridBuffers(Hi,!1);ki.draw(u,ae.TRIANGLES,Gt,yt||Xt,u.colorModeForRenderPass(),vt,Yi,n.id,Xr,Ii,Li)}}else{const{tileBoundsBuffer:ui,tileBoundsIndexBuffer:Xr,tileBoundsSegments:Ii}=u.getTileBoundsBuffers(Zt);ki.draw(u,ae.TRIANGLES,Gt,Xt,Ve,ei.disabled,Yi,n.id,ui,Xr,Ii)}}if(!(he instanceof t.aJ)&&K)for(const Tt of gt){const Dt=Tt.canonical.y===(1<<Tt.canonical.z)-1;Tt.canonical.y===0&&Co(!0,Tt,u,r,n,Te,fe,vt,yt||ai.disabled),Dt&&Co(!1,Tt,u,r,n,Te,fe,vt===ei.frontCW?ei.backCW:ei.frontCW,yt||ai.disabled)}};K?bt(pt,u.renderElevatedRasterBackface?ei.backCW:ei.frontCW,u.stencilModeFor3D()):bt(pt,ei.disabled,void 0),u.resetStencilClippingMasks()},"raster-particle":function(u,r,n,c,g,M){u.renderPass==="offscreen"&&function(L,q,K,ne){if(!ne.length)return;const ae=L.context,he=ae.gl,fe=q.getSource();if(!(fe instanceof ea))return;const Te=Math.ceil(Math.sqrt(K.paint.get("raster-particle-count")));let Ve=K.particlePositionRGBAImage;if(!Ve||Ve.width!==Te){const pt=function(ft){const bt=ft*ft,gt=new Uint8Array(4*bt),vt=function(Tt){return Tt|=0,Tt=Math.imul(2747636419^Tt,2654435769),Tt=Math.imul(Tt^Tt>>>16,2654435769),((Tt=Math.imul(Tt^Tt>>>16,2654435769))>>>0)/4294967296},yt=1/1.1;for(let Tt=0;Tt<bt;Tt++){const Dt=yt*(vt(2*Tt+0)+Ea),Zt=yt*(vt(2*Tt+1)+Ea),Ht=255*Dt%1,Pt=255*Zt%1,zt=Ht,tr=Zt-Pt/255,lr=Pt;gt[4*Tt+0]=255*(Dt-Ht/255),gt[4*Tt+1]=255*zt,gt[4*Tt+2]=255*tr,gt[4*Tt+3]=255*lr}return gt}(Te);Ve=K.particlePositionRGBAImage=new t.r({width:Te,height:Te},pt)}let je=K.particleFramebuffer;je?je.width!==Te&&(je.destroy(),je=K.particleFramebuffer=ae.createFramebuffer(Te,Te,!0,null)):je=K.particleFramebuffer=ae.createFramebuffer(Te,Te,!0,null);const Xe=[];for(const pt of ne){const ft=q.getTile(pt);if(!(ft instanceof du))continue;const bt=Ah(ft,fe,K);if(!bt)continue;const gt=[ft.tileSize,ft.tileSize];let vt=K.tileFramebuffer;vt||(vt=K.tileFramebuffer=ae.createFramebuffer(gt[0],gt[1],!0,null));let yt=ft.rasterParticleState;yt||(yt=ft.rasterParticleState=new Ju(ae,pt,gt,Ve));const Tt=yt.update(K.lastInvalidatedAt);yt.particleTextureDimension!==Te&&yt.updateParticleTexture(pt,Ve);const Dt=yt.targetColorTexture;yt.targetColorTexture=yt.backgroundColorTexture,yt.backgroundColorTexture=Dt;const Zt=yt.particleTexture0;yt.particleTexture0=yt.particleTexture1,yt.particleTexture1=Zt,Xe.push([pt,bt,yt,Tt])}if(Xe.length===0)return;const Ye=t.q.now(),at=K.previousDrawTimestamp?.001*(Ye-K.previousDrawTimestamp):.0167;if(K.previousDrawTimestamp=Ye,K.hasColorMap()){ae.activeTexture.set(he.TEXTURE0+2);let pt=K.colorRampTexture;pt||(pt=K.colorRampTexture=new t.T(ae,K.colorRamp,he.RGBA8)),pt.bind(he.LINEAR,he.CLAMP_TO_EDGE)}ae.bindFramebuffer.set(K.tileFramebuffer.framebuffer),function(pt,ft,bt){const gt=pt.context,vt=gt.gl,yt=ft.tileFramebuffer;gt.activeTexture.set(vt.TEXTURE0);const Tt={u_texture:0,u_opacity:1.05*(Zt=ft.paint.get("raster-particle-fade-opacity-factor"))/(Zt+.05)},Dt=pt.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Zt;for(const Ht of bt){const[,,Pt,zt]=Ht;yt.colorAttachment.set(Pt.targetColorTexture.texture),gt.viewport.set([0,0,yt.width,yt.height]),gt.clear({color:t.aj.transparent}),zt&&(Pt.backgroundColorTexture.bind(vt.NEAREST,vt.CLAMP_TO_EDGE),Dt.draw(pt,vt.TRIANGLES,qr.disabled,ai.disabled,pi.alphaBlended,ei.disabled,Tt,ft.id,pt.viewportBuffer,pt.quadTriangleIndexBuffer,pt.viewportSegments))}}(L,K,Xe),function(pt,ft,bt,gt){const vt=pt.context,yt=vt.gl,Tt=bt.tileFramebuffer,Dt=pt.transform.projection.name==="globe",Zt=bt.paint.get("raster-particle-max-speed");for(const Ht of gt){const[Pt,zt,tr]=Ht;vt.activeTexture.set(yt.TEXTURE0+0),zt.texture.bind(yt.LINEAR,yt.CLAMP_TO_EDGE),Tt.colorAttachment.set(tr.targetColorTexture.texture);const lr=pt.getOrCreateProgram("rasterParticleDraw",{defines:zt.defines,overrideFog:!1});vt.activeTexture.set(yt.TEXTURE0+1);const pr=zt.scalarData?[]:[0,1,2,3].map(Xt=>t.d4[Xt](Pt));pr.push(Pt);const Gt=Pt.canonical.x,nr=Pt.canonical.y;for(const Xt of pr){const hr=ft.getTile(Dt?Xt.wrapped():Xt);if(!hr)continue;const ar=hr.rasterParticleState;if(!ar)continue;const er=Xt.canonical.x+(1<<Xt.canonical.z)*(Xt.wrap-Pt.wrap),Sr=Xt.canonical.y;ar.particleTexture0.bind(yt.NEAREST,yt.CLAMP_TO_EDGE);const mr=jr(1,ar.particleTexture0.size[0],[er-Gt,Sr-nr],0,zt.texture.size,2,Zt,zt.textureOffset,zt.scale,zt.offset);lr.draw(pt,yt.POINTS,qr.disabled,ai.disabled,pi.alphaBlended,ei.disabled,mr,bt.id,ar.particleIndexBuffer,void 0,ar.particleSegment)}}}(L,q,K,Xe),ae.bindFramebuffer.set(K.particleFramebuffer.framebuffer),function(pt,ft,bt,gt){const vt=pt.context,yt=vt.gl,Tt=ft.paint.get("raster-particle-max-speed"),Dt=gt*ft.paint.get("raster-particle-speed-factor")*.15,Zt=function(Pt){return Math.pow(Pt,6)}(.01+1*ft.paint.get("raster-particle-reset-rate-factor")),Ht=ft.particleFramebuffer;vt.viewport.set([0,0,Ht.width,Ht.height]);for(const Pt of bt){const[,zt,tr]=Pt;vt.activeTexture.set(yt.TEXTURE0+0),zt.texture.bind(yt.LINEAR,yt.CLAMP_TO_EDGE),vt.activeTexture.set(yt.TEXTURE0+1);const lr=tr.particleTexture0;lr.bind(yt.NEAREST,yt.CLAMP_TO_EDGE);const pr=xh(1,lr.size[0],0,zt.texture.size,Tt,Dt,Zt,zt.textureOffset,zt.scale,zt.offset);Ht.colorAttachment.set(tr.particleTexture1.texture),vt.clear({color:t.aj.transparent}),pt.getOrCreateProgram("rasterParticleUpdate",{defines:zt.defines}).draw(pt,yt.TRIANGLES,qr.disabled,ai.disabled,pi.unblended,ei.disabled,pr,ft.id,pt.viewportBuffer,pt.quadTriangleIndexBuffer,pt.viewportSegments)}}(L,K,Xe,at)}(u,r,n,c),u.renderPass==="translucent"&&(function(L,q,K,ne,ae){const he=L.context,fe=he.gl,Te=q.getSource().tileSize,Ve=5*(1-t.ac(t.bY,t.bY+1,L.transform.zoom))*Te+K.paint.get("raster-particle-elevation"),je=!L.options.moving,Xe=L.transform.projection.name==="globe";if(!ne.length)return;const[Ye,at]=L.stencilConfigForOverlap(ne),pt=[];Xe&&pt.push("PROJECTION_GLOBE_VIEW");const ft=L.stencilModeFor3D();for(const bt of at){const gt=bt.toUnwrapped(),vt=q.getTile(bt);if(!vt.rasterParticleState)continue;const yt=vt.rasterParticleState,Tt=100;vt.registerFadeDuration(Tt);const Dt=q.findLoadedParent(bt,0),Zt=ju(vt,Dt,q,L.transform,Tt);let Ht,Pt;L.terrain&&L.terrain.prepareDrawTile(),he.activeTexture.set(fe.TEXTURE0),yt.targetColorTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),he.activeTexture.set(fe.TEXTURE1),Dt&&Dt.rasterParticleState?(Dt.rasterParticleState.targetColorTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),Ht=Math.pow(2,Dt.tileID.overscaledZ-vt.tileID.overscaledZ),Pt=[vt.tileID.canonical.x*Ht%1,vt.tileID.canonical.y*Ht%1]):yt.targetColorTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE);const zt=Xe?Float32Array.from(L.transform.expandedFarZProjMatrix):L.transform.calculateProjMatrix(gt,je),tr=L.transform,lr=wd(tr),pr=t.cE(bt.canonical),Gt=t.cF(pr.getCenter().lat);let nr,Xt,hr,ar,er;Xe?(nr=Float32Array.from(t.bb(t.cH(bt.canonical))),Xt=Float32Array.from(tr.globeMatrix),hr=Float32Array.from(t.cD(tr)),ar=[t.at(tr.center.lng),t.aA(tr.center.lat)],er=Float32Array.from(t.cG(bt.canonical,pr,Gt,tr.worldSize/tr._pixelsPerMercatorPixel))):(nr=new Float32Array(16),Xt=new Float32Array(9),hr=new Float32Array(16),ar=[0,0],er=new Float32Array(9));const Sr=is(zt,nr,Xt,hr,er,Pt||[0,0],t.ae(L.transform.zoom),ar,lr,Ht||1,Zt,Ve),mr=L.isTileAffectedByFog(bt),Mr=L.getOrCreateProgram("rasterParticle",{defines:pt,overrideFog:mr});if(L.uploadCommonUniforms(he,Mr,gt),Xe){const Lr=new qr(fe.LEQUAL,qr.ReadOnly,L.depthRangeFor3D),ri=0,Gr=L.globeSharedBuffers;if(Gr){const[Zr,ii,vi]=Gr.getGridBuffers(Gt,ri!==0);Mr.draw(L,fe.TRIANGLES,Lr,ft,pi.alphaBlended,L.renderElevatedRasterBackface?ei.frontCCW:ei.backCCW,Sr,K.id,Zr,ii,vi)}}else{const Lr=L.depthModeForSublayer(0,qr.ReadOnly),ri=Ye[bt.overscaledZ],{tileBoundsBuffer:Gr,tileBoundsIndexBuffer:Zr,tileBoundsSegments:ii}=L.getTileBoundsBuffers(vt);Mr.draw(L,fe.TRIANGLES,Lr,ri,pi.alphaBlended,ei.disabled,Sr,K.id,Gr,Zr,ii)}}L.resetStencilClippingMasks()}(u,r,n,c),u.style.map.triggerRepaint())},background:function(u,r,n,c){const g=n.paint.get("background-color"),M=n.paint.get("background-color-use-theme").constantOr("default")==="none",L=n.paint.get("background-opacity"),q=n.paint.get("background-emissive-strength"),K=n.paint.get("background-pitch-alignment")==="viewport";if(L===0)return;const ne=u.context,ae=ne.gl,he=u.transform,fe=he.tileSize,Te=n.paint.get("background-pattern");let Ve;if(Te!==void 0&&(Te===null||(Ve=u.imageManager.getPattern(Te.toString(),n.scope,u.style.getLut(n.scope)),!Ve)))return;const je=!Te&&g.a===1&&L===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==je)return;const Xe=ai.disabled,Ye=u.depthModeForSublayer(0,je==="opaque"?qr.ReadWrite:qr.ReadOnly),at=u.colorModeForDrapableLayerRenderPass(q),pt=Te?"backgroundPattern":"background";let ft,bt=c;if(bt||(ft=u.getBackgroundTiles(),bt=Object.values(ft).map(gt=>gt.tileID)),Te&&(ne.activeTexture.set(ae.TEXTURE0),u.imageManager.bind(u.context,n.scope)),K){const gt=u.getOrCreateProgram(pt,{overrideFog:!1,overrideRtt:!0}),vt=new Float32Array(t.ab.mat4.identity([])),yt=new t.aG(0,0,0,0,0),Tt=Te?wh(vt,q,L,u,0,n.scope,Ve,K,{tileID:yt,tileSize:fe}):$u(vt,q,L,g.toRenderColor(M?null:n.lut));gt.draw(u,ae.TRIANGLES,Ye,Xe,at,ei.disabled,Tt,n.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments)}else for(const gt of bt){const vt=u.isTileAffectedByFog(gt),yt=u.getOrCreateProgram(pt,{overrideFog:vt}),Tt=gt.toUnwrapped(),Dt=c?gt.projMatrix:u.transform.calculateProjMatrix(Tt);u.prepareDrawTile();const Zt=r?r.getTile(gt):ft?ft[gt.key]:new Mo(gt,fe,he.zoom,u),Ht=Te?wh(Dt,q,L,u,0,n.scope,Ve,K,{tileID:gt,tileSize:fe}):$u(Dt,q,L,g.toRenderColor(M?null:n.lut));u.uploadCommonUniforms(ne,yt,Tt);const{tileBoundsBuffer:Pt,tileBoundsIndexBuffer:zt,tileBoundsSegments:tr}=u.getTileBoundsBuffers(Zt);yt.draw(u,ae.TRIANGLES,Ye,Xe,at,ei.disabled,Ht,n.id,Pt,zt,tr)}},sky:function(u,r,n){const c=u._atmosphere?t.ae(u.transform.zoom):1,g=n.paint.get("sky-opacity")*c;if(g===0)return;const M=u.context,L=n.paint.get("sky-type"),q=new qr(M.gl.LEQUAL,qr.ReadOnly,[0,1]),K=u.frameCounter/1e3%1;L==="atmosphere"?u.renderPass==="offscreen"?n.needsSkyboxCapture(u)&&(function(ne,ae,he,fe){const Te=ne.context,Ve=Te.gl;let je=ae.skyboxFbo;if(!je){je=ae.skyboxFbo=Te.createFramebuffer(32,32,!0,null),ae.skyboxGeometry=new Ba(Te),ae.skyboxTexture=Te.gl.createTexture(),Ve.bindTexture(Ve.TEXTURE_CUBE_MAP,ae.skyboxTexture),Ve.texParameteri(Ve.TEXTURE_CUBE_MAP,Ve.TEXTURE_WRAP_S,Ve.CLAMP_TO_EDGE),Ve.texParameteri(Ve.TEXTURE_CUBE_MAP,Ve.TEXTURE_WRAP_T,Ve.CLAMP_TO_EDGE),Ve.texParameteri(Ve.TEXTURE_CUBE_MAP,Ve.TEXTURE_MIN_FILTER,Ve.LINEAR),Ve.texParameteri(Ve.TEXTURE_CUBE_MAP,Ve.TEXTURE_MAG_FILTER,Ve.LINEAR);for(let pt=0;pt<6;++pt)Ve.texImage2D(Ve.TEXTURE_CUBE_MAP_POSITIVE_X+pt,0,Ve.RGBA,32,32,0,Ve.RGBA,Ve.UNSIGNED_BYTE,null)}Te.bindFramebuffer.set(je.framebuffer),Te.viewport.set([0,0,32,32]);const Xe=ae.getCenter(ne,!0),Ye=ne.getOrCreateProgram("skyboxCapture"),at=new Float64Array(16);t.ab.mat4.identity(at),t.ab.mat4.rotateY(at,at,.5*-Math.PI),os(ne,ae,Ye,at,Xe,0),t.ab.mat4.identity(at),t.ab.mat4.rotateY(at,at,.5*Math.PI),os(ne,ae,Ye,at,Xe,1),t.ab.mat4.identity(at),t.ab.mat4.rotateX(at,at,.5*-Math.PI),os(ne,ae,Ye,at,Xe,2),t.ab.mat4.identity(at),t.ab.mat4.rotateX(at,at,.5*Math.PI),os(ne,ae,Ye,at,Xe,3),t.ab.mat4.identity(at),os(ne,ae,Ye,at,Xe,4),t.ab.mat4.identity(at),t.ab.mat4.rotateY(at,at,Math.PI),os(ne,ae,Ye,at,Xe,5),Te.viewport.set([0,0,ne.width,ne.height])}(u,n),n.markSkyboxValid(u)):u.renderPass==="sky"&&function(ne,ae,he,fe,Te){const Ve=ne.context,je=Ve.gl,Xe=ne.transform,Ye=ne.getOrCreateProgram("skybox");Ve.activeTexture.set(je.TEXTURE0),je.bindTexture(je.TEXTURE_CUBE_MAP,ae.skyboxTexture);const at=((pt,ft,bt,gt,vt)=>({u_matrix:pt,u_sun_direction:ft,u_cubemap:0,u_opacity:gt,u_temporal_offset:vt}))(Xe.skyboxMatrix,ae.getCenter(ne,!1),0,fe,Te);ne.uploadCommonUniforms(Ve,Ye),Ye.draw(ne,je.TRIANGLES,he,ai.disabled,ne.colorModeForRenderPass(),ei.backCW,at,"skybox",ae.skyboxGeometry.vertexBuffer,ae.skyboxGeometry.indexBuffer,ae.skyboxGeometry.segment)}(u,n,q,g,K):L==="gradient"&&u.renderPass==="sky"&&function(ne,ae,he,fe,Te){const Ve=ne.context,je=Ve.gl,Xe=ne.transform,Ye=ne.getOrCreateProgram("skyboxGradient");ae.skyboxGeometry||(ae.skyboxGeometry=new Ba(Ve)),Ve.activeTexture.set(je.TEXTURE0);let at=ae.colorRampTexture;at||(at=ae.colorRampTexture=new t.T(Ve,ae.colorRamp,je.RGBA8)),at.bind(je.LINEAR,je.CLAMP_TO_EDGE);const pt=((ft,bt,gt,vt,yt)=>({u_matrix:ft,u_color_ramp:0,u_center_direction:bt,u_radius:t.ai(gt),u_opacity:vt,u_temporal_offset:yt}))(Xe.skyboxMatrix,ae.getCenter(ne,!1),ae.paint.get("sky-gradient-radius"),fe,Te);ne.uploadCommonUniforms(Ve,Ye),Ye.draw(ne,je.TRIANGLES,he,ai.disabled,ne.colorModeForRenderPass(),ei.backCW,pt,"skyboxGradient",ae.skyboxGeometry.vertexBuffer,ae.skyboxGeometry.indexBuffer,ae.skyboxGeometry.segment)}(u,n,q,g,K)},debug:function(u,r,n,c,g,M){for(let L=0;L<n.length;L++)if(g){const ne=new t.aj(c.r*.8,c.g*.8,c.b*.8,1);as(u,r,n[L],c,-1,-1,M),as(u,r,n[L],c,-1,1,M),as(u,r,n[L],c,1,1,M),as(u,r,n[L],c,1,-1,M),as(u,r,n[L],ne,0,0,M)}else as(u,r,n[L],c,0,0,M)},custom:function(u,r,n,c){const g=u.context,M=n.implementation;if(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes("custom")||u.terrain&&(u.terrain.renderingToTexture||u.renderPass==="offscreen")&&n.isDraped(r)){if(u.renderPass==="offscreen"){const L=M.prerender;if(L){if(u.setCustomLayerDefaults(),g.setColorMode(u.colorModeForRenderPass()),u.transform.projection.name==="globe"){const q=u.transform.pointMerc;L.call(M,g.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),t.ae(u.transform.zoom),[q.x,q.y],u.transform.pixelsPerMeterRatio)}else L.call(M,g.gl,u.transform.customLayerMatrix());g.setDirty(),u.setBaseState()}}else if(u.renderPass==="translucent"){if(u.terrain&&u.terrain.renderingToTexture){const q=M.renderToTile;if(q){const K=c[0].canonical,ne=new t.aa(K.x+c[0].wrap*(1<<K.z),K.y,K.z);g.setDepthMode(qr.disabled),g.setStencilMode(ai.disabled),g.setColorMode(u.colorModeForRenderPass()),u.setCustomLayerDefaults(),q.call(M,g.gl,ne),g.setDirty(),u.setBaseState()}return}u.setCustomLayerDefaults(),g.setColorMode(u.colorModeForRenderPass()),g.setStencilMode(ai.disabled);const L=M.renderingMode==="3d"?new qr(u.context.gl.LEQUAL,qr.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,qr.ReadOnly);if(g.setDepthMode(L),u.transform.projection.name==="globe"){const q=u.transform.pointMerc;M.render(g.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),t.ae(u.transform.zoom),[q.x,q.y],u.transform.pixelsPerMeterRatio)}else M.render(g.gl,u.transform.customLayerMatrix());g.setDirty(),u.setBaseState(),g.bindFramebuffer.set(null)}}else t.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(u,r,n,c){if(u.renderPass==="opaque")return;const g=n.paint.get("model-opacity").constantOr(1);if(g===0)return;const M=n.paint.get("model-cast-shadows");if(u.renderPass==="shadow"&&(!M||u.terrain&&g<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof t.a9))return;const L=u.shadowRenderer,q=n.paint.get("model-receive-shadows");L&&(L.useNormalOffset=!0,q||(L.enabled=!1));const K=()=>{L&&(L.useNormalOffset=!0,q||(L.enabled=!0))},ne=r.getSource();if(u.renderPass==="light-beam"&&ne.type!=="batched-model")return;if(ne.type==="vector"||ne.type==="geojson")return function(Ye,at,pt,ft,bt){const gt=Ye.transform;if(gt.projection.name!=="mercator")return void t.w(`Drawing 3D models for ${gt.projection.name} projection is not yet implemented`);const vt=gt.getFreeCameraOptions().position;if(!Ye.modelManager)return;const yt=Ye.modelManager;pt.modelManager=yt;const Tt=Ye.shadowRenderer;if(!pt._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Dt=pt._unevaluatedLayout._values["model-id"],Zt={...pt.layout.get("model-id").parameters},Ht=Ye.style.order.indexOf(pt.fqid);for(const Pt of ft){const zt=at.getTile(Pt).getBucket(pt);if(!zt||zt.projection.name!==gt.projection.name)continue;const tr=zt.getModelUris();tr&&!zt.modelsRequested&&(yt.addModelsFromBucket(tr,bt),zt.modelsRequested=!0);const lr=Do(Pt,gt);Zt.zoom=lr;const pr=Dt.possiblyEvaluate(Zt);if(Ih(Ye,zt,Pt),Sa.shadowUniformsInitialized=!1,Sa.useSingleShadowCascade=!!Tt&&Tt.getMaxCascadeForTile(Pt.toUnwrapped())===0,Ye.renderPass==="shadow"&&Tt){if(Ye.currentShadowCascade===1&&zt.isInsideFirstShadowMapFrustum)continue;const Xt=gt.calculatePosMatrix(Pt.toUnwrapped(),gt.worldSize);if(Sa.tileMatrix.set(Xt),Sa.shadowTileMatrix=Float32Array.from(Tt.calculateShadowPassMatrixFromMatrix(Xt)),Sa.aabb.min.fill(0),Sa.aabb.max[0]=Sa.aabb.max[1]=t.ag,Sa.aabb.max[2]=0,rc(zt,Sa,Ye,pt.scope))continue}const Gt=1<<Pt.canonical.z,nr=[((vt.x-Pt.wrap)*Gt-Pt.canonical.x)*t.ag,(vt.y*Gt-Pt.canonical.y)*t.ag,vt.z*Gt*t.ag];Ye.conflationActive&&Object.keys(zt.instancesPerModel).length>0&&Ye.style.isLayerClipped(pt,at.getSource())&&zt.updateReplacement(Pt,Ye.replacementSource,Ht,bt)&&(zt.uploaded=!1,zt.upload(Ye.context));for(let Xt in zt.instancesPerModel){const hr=zt.instancesPerModel[Xt];hr.features.length>0&&(Xt=pr.evaluate(hr.features[0].feature,{}));const ar=yt.getModel(Xt,bt);if(ar&&ar.uploaded)for(const er of ar.nodes)fo(Ye,pt,er,hr,nr,Pt,Sa)}}}(u,r,n,c,ne.type==="vector"?n.scope:""),void K();if(!ne.loaded())return;if(ne.type==="batched-model")return function(Ye,at,pt,ft){pt.resetLayerRenderingStats(Ye);const bt=Ye.context,gt=Ye.transform,vt=Ye.style.fog,yt=Ye.shadowRenderer;if(gt.projection.name!=="mercator")return void t.w(`Drawing 3D landmark models for ${gt.projection.name} projection is not yet implemented`);const Tt=Ye.transform.getFreeCameraOptions().position,Dt=t.ab.vec3.scale([],[Tt.x,Tt.y,Tt.z],Ye.transform.worldSize),Zt=t.ab.vec3.negate([],Dt),Ht=t.ab.mat4.identity([]),Pt=t.dj(gt.center.lat,gt.zoom),zt=t.ab.mat4.fromScaling([],[1,1,1/Pt]);t.ab.mat4.translate(Ht,Ht,Zt);const tr=pt.paint.get("model-opacity").constantOr(1),lr=new qr(bt.gl.LEQUAL,qr.ReadWrite,Ye.depthRangeFor3D),pr=new qr(bt.gl.LEQUAL,qr.ReadOnly,Ye.depthRangeFor3D),Gt=new t.cd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),nr=Ye.renderPass==="shadow",Xt=nr&&yt?yt.getCurrentCascadeFrustum():gt.getFrustum(gt.scaleZoom(gt.worldSize)),hr=pt.paint.get("model-front-cutoff"),ar=hr[2]<1,er=so(Ye,pt.paint.get("model-cutoff-fade-range")),Sr=pt.getLayerRenderingStats();(function(mr,Mr,Lr,ri){const Gr=mr.terrain?mr.terrain.exaggeration():0,Zr=mr.transform.zoom;for(const ii of ri){const vi=Mr.getTile(ii).getBucket(Lr);vi&&(mr.conflationActive&&vi.updateReplacement(ii,mr.replacementSource),vi.evaluateScale(mr,Lr),mr.terrain&&Gr>0&&vi.elevationUpdate(mr.terrain,Gr,ii,Lr.source),vi.needsReEvaluation(mr,Zr,Lr)&&vi.evaluate(Lr))}})(Ye,at,pt,ft),function(){let mr,Mr,Lr;ar?(mr=ft.length-1,Mr=-1,Lr=-1):(mr=0,Mr=ft.length,Lr=1);const ri=new Float64Array(16),Gr=t.ab.vec3.create(),Zr=new t.P(0,0);for(let ii=mr;ii!==Mr;ii+=Lr){const vi=ft[ii],di=at.getTile(vi).getBucket(pt);if(!di||!di.uploaded)continue;let Hi=!1;yt&&(Hi=yt.getMaxCascadeForTile(vi.toUnwrapped())===0);const Yi=gt.calculatePosMatrix(vi.toUnwrapped(),gt.worldSize),Di=di.modelTraits;!nr&&ar&&(t.ab.mat4.invert(ri,Yi),t.ab.vec3.transformMat4(Gr,Dt,ri),Zr.x=Gr[0],Zr.y=Gr[1]);const ki=[];for(const ui of di.getNodesInfo()){if(ui.hiddenByReplacement||!ui.node.meshes)continue;const Xr=ui.node;let Ii=0;Ye.terrain&&Xr.elevation&&(Ii=Xr.elevation*Ye.terrain.exaggeration());const Li=(()=>{const wi=ui.aabb;return Gt.min=[...wi.min],Gt.max=[...wi.max],Gt.min[2]+=Ii,Gt.max[2]+=Ii,t.ab.vec3.transformMat4(Gt.min,Gt.min,Yi),t.ab.vec3.transformMat4(Gt.max,Gt.max,Yi),Gt})(),tn=ui.evaluatedScale;if(tn[0]<=1&&tn[1]<=1&&tn[2]<=1&&Li.intersects(Xt)===0)continue;if(!nr&&ar){const wi=.16666666666666666;ui.cameraCollisionOpacity=Dt[0]>Li.min[0]&&Dt[0]<Li.max[0]&&Dt[1]>Li.min[1]&&Dt[1]<Li.max[1]&&Dt[2]*Pt<Li.max[2]&&Xr.footprint&&t.bA(Zr,Xr.footprint)?Math.max(ui.cameraCollisionOpacity-wi,0):Math.min(1,ui.cameraCollisionOpacity+wi)}const Pn=[...Yi],$n=Xr.anchor?Xr.anchor[0]:0,pn=Xr.anchor?Xr.anchor[1]:0;t.ab.mat4.translate(Pn,Pn,[$n*(tn[0]-1),pn*(tn[1]-1),Ii]),t.ab.vec3.exactEquals(tn,t.dm)||t.ab.mat4.scale(Pn,Pn,tn);const An=t.ab.mat4.multiply([],Pn,Xr.matrix),Un=t.ab.mat4.multiply([],gt.expandedFarZProjMatrix,An),un=t.ab.mat4.multiply([],gt.expandedFarZProjMatrix,Pn),ji=t.ab.vec4.transformMat4([],[$n,pn,Ii,1],Un)[2];Xr.hidden=!1;let qi=tr;nr||(ar&&(qi*=ui.cameraCollisionOpacity,qi*=Ph(Pn,gt,ui.aabb,hr)),qi*=ic(er,ji)),qi!==0?ki.push({nodeInfo:ui,depth:ji,opacity:qi,wvpForNode:Un,wvpForTile:un,nodeModelMatrix:An,tileModelMatrix:Pn}):Xr.hidden=!0}nr||ki.sort((ui,Xr)=>!ar||ui.opacity===1&&Xr.opacity===1?ui.depth<Xr.depth?-1:1:ui.opacity===1?-1:Xr.opacity===1?1:ui.depth>Xr.depth?-1:1);for(const ui of ki){const Xr=ui.nodeInfo,Ii=Xr.node;let Li=t.ab.mat4.multiply([],zt,ui.tileModelMatrix);t.ab.mat4.multiply(Li,Ht,Li);const tn=t.ab.mat4.invert([],Li);t.ab.mat4.transpose(tn,tn),t.ab.mat4.scale(tn,tn,Lo),Li=t.ab.mat4.multiply(Li,Li,Ii.matrix);const Pn=Ye.renderPass==="light-beam",$n=pt.paint.get("model-color-use-theme").constantOr("default")==="none",pn=Di&t.dp.HasMapboxMeshFeatures,An=pn?0:Xr.evaluatedRMEA[0][2];for(let Un=0;Un<Ii.meshes.length;++Un){const un=Ii.meshes[Un],ji=Un===Ii.lightMeshIndex;let qi=ui.wvpForNode;if(ji){if(!Pn&&!Ye.terrain&&Ye.shadowRenderer){Ye.currentLayer<Ye.firstLightBeamLayer&&(Ye.firstLightBeamLayer=Ye.currentLayer);continue}qi=ui.wvpForTile}else if(Pn)continue;const wi={defines:[]},cn=[];if(!nr&&yt&&(yt.useNormalOffset=!!un.normalBuffer),tc(wi.defines,cn,un,Ye,$n?null:pt.lut),pn||wi.defines.push("DIFFUSE_SHADED"),Hi&&wi.defines.push("SHADOWS_SINGLE_CASCADE"),Sr&&(nr?Sr.numRenderedVerticesInShadowPass+=un.vertexArray.length:Sr.numRenderedVerticesInTransparentPass+=un.vertexArray.length),nr){Ro(un,ui.nodeModelMatrix,Ye,pt);continue}let Cn=null;if(vt){const Zn=Ri(ui.nodeModelMatrix,Ye.transform);if(Cn=new Float32Array(Zn),gt.projection.name!=="globe"){const ja=un.aabb.min,ca=un.aabb.max,[No,Ka]=vt.getOpacityForBounds(Zn,ja[0],ja[1],ca[0],ca[1]);wi.overrideFog=No>=gr||Ka>=gr}}const Ni=un.material;let jn;Ni.occlusionTexture&&Ni.occlusionTexture.offsetScale&&(jn=Ni.occlusionTexture.offsetScale,wi.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const ma=Ye.getOrCreateProgram("model",wi);!nr&&yt&&yt.setupShadowsFromMatrix(ui.tileModelMatrix,ma,yt.useNormalOffset),Ye.uploadCommonUniforms(bt,ma,null,Cn);const ua=Ni.pbrMetallicRoughness;ua.metallicFactor=.9,ua.roughnessFactor=.5;const go=Eh(new Float32Array(qi),new Float32Array(Li),new Float32Array(tn),new Float32Array(Ii.matrix),Ye,ui.opacity,ua.baseColorFactor.toRenderColor(null),Ni.emissiveFactor,ua.metallicFactor,ua.roughnessFactor,Ni,An,pt,[0,0,0],jn);!ji&&(Xr.hasTranslucentParts||ui.opacity<1)&&ma.draw(Ye,bt.gl.TRIANGLES,lr,ai.disabled,pi.disabled,ei.backCCW,go,pt.id,un.vertexBuffer,un.indexBuffer,un.segments,pt.paint,Ye.transform.zoom,void 0,cn),ma.draw(Ye,bt.gl.TRIANGLES,ji?pr:lr,ai.disabled,ji||ui.opacity<1||Xr.hasTranslucentParts?pi.alphaBlended:pi.unblended,ei.backCCW,go,pt.id,un.vertexBuffer,un.indexBuffer,un.segments,pt.paint,Ye.transform.zoom,void 0,cn)}}}}()}(u,r,n,c),void K();if(ne.type!=="model")return;const ae=ne.getModels(),he=[],fe=u.transform.getFreeCameraOptions().position,Te=t.ab.vec3.scale([],[fe.x,fe.y,fe.z],u.transform.worldSize);t.ab.vec3.negate(Te,Te);const Ve=[],je=[];let Xe=0;for(const Ye of ae){const at=n.paint.get("model-rotation").constantOr(null),pt=n.paint.get("model-scale").constantOr(null),ft=n.paint.get("model-translation").constantOr(null);Ye.computeModelMatrix(u,at,pt,ft,!0,!0,!1);const bt=t.ab.mat4.identity([]),gt=t.dj(Ye.position.lat,u.transform.zoom),vt=t.ab.mat4.fromScaling([],[1,1,1/gt]);t.ab.mat4.translate(bt,bt,Te),he.push({zScaleMatrix:vt,negCameraPosMatrix:bt});for(const yt of Ye.nodes)zl(u.transform,yt,Ye.matrix,u.transform.expandedFarZProjMatrix,Xe,Ve,je);Xe++}if(Ve.sort((Ye,at)=>at.depth-Ye.depth),u.renderPass!=="shadow"){if(g===1)for(const Ye of je)Fa(Ye,u,n,he[Ye.modelIndex],ai.disabled,u.colorModeForRenderPass());else{for(const Ye of je)Fa(Ye,u,n,he[Ye.modelIndex],ai.disabled,pi.disabled);for(const Ye of je)Fa(Ye,u,n,he[Ye.modelIndex],u.stencilModeFor3D(),u.colorModeForRenderPass());u.resetStencilClippingMasks()}for(const Ye of Ve)Fa(Ye,u,n,he[Ye.modelIndex],ai.disabled,u.colorModeForRenderPass());K()}else{for(const Ye of je)Ro(Ye.mesh,Ye.nodeModelMatrix,u,n);for(const Ye of Ve)Ro(Ye.mesh,Ye.nodeModelMatrix,u,n);K()}}},lc={model:function(u,r,n){const c=r.getSource();if(!c.loaded())return;if(c.type==="vector"||c.type==="geojson")return void(n.modelManager&&n.modelManager.upload(n,c.type==="vector"?u.scope:""));if(c.type==="batched-model"||c.type!=="model")return;const g=c.getModels();for(const M of g)M.upload(n.context)},raster:function(u,r,n){const c=r.getSource();if(!(c instanceof ea&&c.loaded()))return;const g=u.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!g)return;const M=u.paint.get("raster-array-band")||c.getInitialBand(g);if(M==null)return;const L=r.getIds().map(q=>r.getTileByID(q));for(const q of L)q.updateNeeded(g,M)&&c.prepareTile(q,g,M)},"raster-particle":function(u,r,n){const c=r.getSource();if(!(c instanceof ea&&c.loaded()))return;const g=u.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!g)return;const M=u.paint.get("raster-particle-array-band")||c.getInitialBand(g);if(M==null)return;const L=r.getIds().map(q=>r.getTileByID(q));for(const q of L)q.updateNeeded(g,M)&&c.prepareTile(q,g,M)}};class Bh{constructor(r,n,c,g,M){this.context=new Po(r,n),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=M,this._timeStamp=t.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const L=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const K of L)this._debugParams.enabledLayers[K]=!0;M.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),M.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),M.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),M.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),M.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),M.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const K of L)M.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],K);this.occlusionParams=new Oo(M),this.setup(),this.numSublayers=ya.maxUnderzooming+ya.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new t.dv,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new lo(this),this._wireframeDebugCache=new Rh,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const q=new t.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new t.T(this.context,q,r.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=g}updateTerrain(r,n){const c=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(c||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new fd(this,r));const g=this._terrain;this.transform.elevation=c?g:null,g.update(r,this.transform,n),this.transform.elevation&&!g.enabled&&(this.transform.elevation=null)}_updateFog(r){const n=r.fog;if(!n||this.transform.projection.name==="globe"||n.getOpacity(this.transform.pitch)<1||n.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[c,g]=n.getFovAdjustedRange(this.transform._fov);if(c>g)return void(this.transform.fogCullDistSq=null);const M=c+.78*(g-c);this.transform.fogCullDistSq=M*M}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(r){r&&!this._terrain&&(this._terrain=new fd(this,this.style)),this._forceTerrainMode=r}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,n){if(this.width=r*t.q.devicePixelRatio,this.height=n*t.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style.order)this.style._mergedLayers[c].resize()}setup(){const r=this.context,n=new t.b4;n.emplaceBack(0,0),n.emplaceBack(t.ag,0),n.emplaceBack(0,t.ag),n.emplaceBack(t.ag,t.ag),this.tileExtentBuffer=r.createVertexBuffer(n,t.b6.members),this.tileExtentSegments=t.b7.simpleSegment(0,0,4,2);const c=new t.b4;c.emplaceBack(0,0),c.emplaceBack(t.ag,0),c.emplaceBack(0,t.ag),c.emplaceBack(t.ag,t.ag),this.debugBuffer=r.createVertexBuffer(c,t.b6.members),this.debugSegments=t.b7.simpleSegment(0,0,4,5);const g=new t.b4;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(g,t.b6.members),this.viewportSegments=t.b7.simpleSegment(0,0,4,2);const M=new t.aT;M.emplaceBack(0,0,0,0),M.emplaceBack(t.ag,0,t.ag,0),M.emplaceBack(0,t.ag,0,t.ag),M.emplaceBack(t.ag,t.ag,t.ag,t.ag),this.mercatorBoundsBuffer=r.createVertexBuffer(M,t.b9.members),this.mercatorBoundsSegments=t.b7.simpleSegment(0,0,4,2);const L=new t.aU;L.emplaceBack(0,1,2),L.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(L);const q=new t.b5;for(const ne of[0,1,3,2,0])q.emplaceBack(ne);this.debugIndexBuffer=r.createIndexBuffer(q),this.emptyTexture=new t.T(r,new t.r({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA8),this.identityMat=t.ab.mat4.create();const K=this.context.gl;this.stencilClearMode=new ai({func:K.ALWAYS,mask:0},0,255,K.ZERO,K.ZERO,K.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,qr.disabled,this.stencilClearMode,pi.disabled,ei.disabled,Bs(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,n,c){if(!n||this.currentStencilSource===n.id||!r.isTileClipped()||!c||c.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let q=!1;for(const K of c)if(this._tileClippingMaskIDs[K.key]===void 0){q=!0;break}if(!q)return}this.currentStencilSource=n.id;const g=this.context,M=g.gl;this.nextStencilID+c.length>256&&this.clearStencil(),g.setColorMode(pi.disabled),g.setDepthMode(qr.disabled);const L=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const q of c){const K=n.getTile(q),ne=this._tileClippingMaskIDs[q.key]=this.nextStencilID++,{tileBoundsBuffer:ae,tileBoundsIndexBuffer:he,tileBoundsSegments:fe}=this.getTileBoundsBuffers(K);L.draw(this,M.TRIANGLES,qr.disabled,new ai({func:M.ALWAYS,mask:0},ne,255,M.KEEP,M.KEEP,M.REPLACE),pi.disabled,ei.disabled,Bs(q.projMatrix),"$clipping",ae,he,fe)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,n=this.context.gl;return new ai({func:n.NOTEQUAL,mask:255},r,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const n=this.context.gl;return new ai({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(r){const n=this.context.gl,c=r.sort((L,q)=>q.overscaledZ-L.overscaledZ),g=c[c.length-1].overscaledZ,M=c[0].overscaledZ-g+1;if(M>1){this.currentStencilSource=void 0,this.nextStencilID+M>256&&this.clearStencil();const L={};for(let q=0;q<M;q++)L[q+g]=new ai({func:n.GEQUAL,mask:255},q+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=M,[L,c]}return[{[g]:ai.disabled},c]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new pi([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new t.aj(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?pi.unblended:pi.alphaBlended}colorModeForDrapableLayerRenderPass(r){const n=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new pi([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new t.aj(0,0,0,r===void 0?0:r),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(r,n,c,g=!1){if(this.depthOcclusion)return new qr(this.context.gl.GREATER,qr.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!g)return qr.disabled;const M=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new qr(c||this.context.gl.LEQUAL,n,[M,M])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const r=this.context.gl,n=Math.ceil(this.width),c=Math.ceil(this.height),g=this.context.bindFramebuffer.get(),M=r.getParameter(r.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===n&&this.depthFBO.height===c||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),n!==0&&c!==0&&(this.depthFBO=new Yn(this.context,n,c,!1,"texture"),this.depthTexture=new t.T(this.context,{width:n,height:c,data:null},r.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(g),r.bindTexture(r.TEXTURE_2D,M),this.depthFBO&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),r.blitFramebuffer(0,0,n,c,0,0,n,c,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((r,n)=>r+n/this._fpsHistory.length,0))}render(r,n){const c=t.q.now();this._dt=c-this._timeStamp,this._timeStamp=c,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=r.map.repaint,this.style=r,this.options=n;const g=this.style._mergedLayers,M=this.style._getOrder(!(!this.terrain||!this.terrain.enabled)).filter(Pt=>{const zt=g[Pt];return!(zt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[zt.type]});let L=!1,q=!1;for(const Pt of M){const zt=g[Pt];zt.type==="circle"&&(L=!0),zt.type==="symbol"&&(zt.hasInitialOcclusionOpacityProperties?q=!0:L=!0)}const K=M.map(Pt=>g[Pt]),ne=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(t.q.now()),this.imageManager.beginFrame();let ae=0,he=!1;for(const Pt in ne){const zt=ne[Pt];zt.used&&(zt.prepare(this.context),zt.getSource().usedInConflation&&++ae)}let fe=!1;for(const Pt of K)Pt.isHidden(this.transform.zoom)||(Pt.type==="clip"&&(fe=!0),this.prepareLayer(Pt));const Te={},Ve={},je={},Xe={},Ye={};for(const Pt in ne){const zt=ne[Pt];Te[Pt]=zt.getVisibleCoordinates(),Ve[Pt]=Te[Pt].slice().reverse(),je[Pt]=zt.getVisibleCoordinates(!0).reverse(),Xe[Pt]=zt.getShadowCasterCoordinates(),Ye[Pt]=zt.sortCoordinatesByDistance(Te[Pt])}const at=Pt=>{const zt=this.style.getLayerSourceCache(Pt);return zt&&zt.used?zt.getSource():null};if(ae||fe||this._clippingActiveLastFrame){const Pt=[],zt=[];let tr=0;for(const lr of K)this.isSourceForClippingOrConflation(lr,at(lr))&&(Pt.push(lr),zt.push(tr)),tr++;if(Pt&&(fe||Pt.length>1)||this._clippingActiveLastFrame){fe=!1;const lr=[];for(let pr=0;pr<Pt.length;pr++){const Gt=Pt[pr],nr=zt[pr],Xt=this.style.getLayerSourceCache(Gt);if(!Xt||!Xt.used||!Xt.getSource().usedInConflation&&Gt.type!=="clip")continue;let hr=t.dx,ar=t.by.None;const er=[];let Sr=!0;if(Gt.type==="clip"){hr=nr;for(const mr of Gt.layout.get("clip-layer-types"))ar|=mr==="model"?t.by.Model:mr==="symbol"?t.by.Symbol:t.by.FillExtrusion;for(const mr of Gt.layout.get("clip-layer-scope"))er.push(mr);Gt.isHidden(this.transform.zoom)?Sr=!1:fe=!0}Sr&&lr.push({layer:Gt.fqid,cache:Xt,order:hr,clipMask:ar,clipScope:er})}this.replacementSource.setSources(lr),he=!0}}this._clippingActiveLastFrame=fe,he||this.replacementSource.clear(),this.conflationActive=he,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Pt=0;Pt<K.length;Pt++){const zt=K[Pt],tr=zt.cutoffRange();if(this.longestCutoffRange=Math.max(tr,this.longestCutoffRange),tr>0){const lr=at(zt);lr&&(this.minCutoffZoom=Math.max(lr.minzoom,this.minCutoffZoom)),zt.minzoom&&(this.minCutoffZoom=Math.max(zt.minzoom,this.minCutoffZoom))}zt.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Pt),this._lastOcclusionLayer=Pt)}const pt=this.style&&this.style.fog;pt?(this._fogVisible=pt.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=pt.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(je),this.opaquePassCutoff=0);const ft=this._shadowRenderer;if(ft){ft.updateShadowParameters(this.transform,this.style.directionalLight);for(const Pt in ne)for(const zt of Te[Pt]){let tr={min:0,max:0};this.terrain&&(tr=this.terrain.getMinMaxForTile(zt)||tr),ft.addShadowReceiver(zt.toUnwrapped(),tr.min,tr.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new t.dw(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new $i(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const bt=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),gt=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(bt&&!this._snow&&(this._snow=new ss(this)),!bt&&this._snow&&(this._snow.destroy(),delete this._snow),gt&&!this._rain&&(this._rain=new zh(this)),!gt&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!ke.has(this.context.gl))return;this.renderPass="offscreen";for(const Pt of K){const zt=r.getLayerSourceCache(Pt);if(!Pt.hasOffscreenPass()||Pt.isHidden(this.transform.zoom))continue;const tr=zt?Ve[zt.id]:void 0;(Pt.type==="custom"||Pt.type==="raster"||Pt.type==="raster-particle"||Pt.isSky()||tr&&tr.length)&&this.renderLayer(this,zt,Pt,tr)}this.depthRangeFor3D=[0,1-(K.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Xe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const vt=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),yt=(()=>{if(n.showOverdrawInspector)return t.aj.black;const Pt=this.style.fog;if(Pt&&this.transform.projection.supportsFog){const zt=this.style.getLut(Pt.scope);if(!vt){const tr=Pt.properties.get("color-use-theme")==="none",lr=Pt.properties.get("color").toRenderColor(tr?null:zt).toArray01();return new t.aj(...lr)}if(vt){const tr=Pt.properties.get("space-color-use-theme")==="none",lr=Pt.properties.get("space-color").toRenderColor(tr?null:zt).toArray01();return new t.aj(...lr)}}return t.aj.transparent})();if(this.context.clear({color:yt,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&vt&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=M.length-1;this.currentLayer>=0;this.currentLayer--){const Pt=K[this.currentLayer],zt=r.getLayerSourceCache(Pt);if(Pt.isSky())continue;const tr=zt?(Pt.is3D()?Ye:Ve)[zt.id]:void 0;this._renderTileClippingMasks(Pt,zt,tr),this.renderLayer(this,zt,Pt,tr)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&vt&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||t.ae(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<M.length;this.currentLayer++){const Pt=K[this.currentLayer],zt=r.getLayerSourceCache(Pt);Pt.isSky()&&this.renderLayer(this,zt,Pt,zt?Ve[zt.id]:void 0)}function Tt(Pt,zt){let tr;return zt&&(tr=(Pt.type==="symbol"?je:Pt.is3D()?Ye:Ve)[zt.id]),tr}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<M.length;){const Pt=K[this.currentLayer];if(Pt.type==="raster"||Pt.type==="raster-particle"){const zt=r.getLayerSourceCache(Pt);this.renderLayer(this,zt,Pt,Tt(Pt,zt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Dt=0;ft&&(Dt=ft.getShadowCastingLayerCount());let Zt=!1,Ht=-1;for(let Pt=0;Pt<M.length;++Pt){const zt=K[Pt];zt.isHidden(this.transform.zoom)||zt.is3D()&&(Ht=Pt)}for(q&&Ht===-1&&(L=!0);this.currentLayer<M.length;){const Pt=K[this.currentLayer],zt=r.getLayerSourceCache(Pt);if(Pt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Pt)){if(Pt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(L&&!Zt&&this.terrain&&!this.transform.isOrthographic&&(Zt=!0,this.blitDepth()),q&&Ht!==-1&&this.currentLayer===Ht+1&&!this.transform.isOrthographic&&this.blitDepth(),Pt.is3D()||this.terrain||this._renderTileClippingMasks(Pt,zt,zt?Te[zt.id]:void 0),this.renderLayer(this,zt,Pt,Tt(Pt,zt)),!this.terrain&&ft&&Dt>0&&Pt.hasShadowPass()&&--Dt==0&&(ft.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const tr=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=tr;this.currentLayer++){const lr=K[this.currentLayer];if(!lr.hasLightBeamPass())continue;const pr=r.getLayerSourceCache(lr);this.renderLayer(this,pr,lr,pr?Ve[pr.id]:void 0)}this.currentLayer=tr,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const tr=this.currentLayer;this.depthOcclusion=!0;for(const lr of this.layersWithOcclusionOpacity){this.currentLayer=lr;const pr=K[this.currentLayer],Gt=r.getLayerSourceCache(pr),nr=Gt?Ve[Gt.id]:void 0;pr.is3D()||this.terrain||this._renderTileClippingMasks(pr,Gt,Gt?Te[Gt.id]:void 0),this.renderLayer(this,Gt,pr,nr)}this.depthOcclusion=!1,this.currentLayer=tr,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Pt=null;K.forEach(zt=>{const tr=r.getLayerSourceCache(zt);tr&&!zt.isHidden(this.transform.zoom)&&tr.getVisibleCoordinates().length&&(!Pt||Pt.getSource().maxzoom<tr.getSource().maxzoom)&&(Pt=tr)}),Pt&&this.options.showTileBoundaries&&kl.debug(this,Pt,Pt.getVisibleCoordinates(),t.aj.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&kl.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new t.aj(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Pt){const zt=Pt.transform.padding;Dl(Pt,Pt.transform.height-(zt.top||0),3,Ed),Dl(Pt,zt.bottom||0,3,Td),Qu(Pt,zt.left||0,3,Hs),Qu(Pt,Pt.transform.width-(zt.right||0),3,Im);const tr=Pt.transform.centerPoint;(function(lr,pr,Gt,nr){Ll(lr,pr-1,Gt-10,2,20,nr),Ll(lr,pr-10,Gt-1,20,2,nr)})(Pt,tr.x,Pt.transform.height-tr.y,Pm)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),he||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);const{unsupportedLayers:n}=this.transform.projection,c=!n||!n.includes(r.type);if(lc[r.type]&&(c||this.terrain&&r.type==="custom")){const g=this.style.getLayerSourceCache(r);lc[r.type](r,g,this)}this.gpuTimingEnd()}renderLayer(r,n,c,g){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="sky"||c.type==="custom"||c.type==="model"||c.type==="raster"||c.type==="raster-particle"||g&&g.length)&&(this.id=c.id,this.gpuTimingStart(c),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(c.type)&&(!r.terrain||c.type!=="custom")||c.type==="clip"||kl[c.type](r,n,c,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery,c=this.context.gl;let g=this.gpuTimers[r.id];g||(g=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:c.createQuery()}),g.calls++,c.beginQuery(n.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,n=this.context.gl,c=n.createQuery();this.deferredRenderGpuTimeQueries.push(c),n.beginQuery(r.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const n={};for(const c in r){const g=r[c],M=this.context.extTimerQuery,L=M.getQueryParameter(g.query,this.context.gl.QUERY_RESULT)/1e6;M.deleteQueryEXT(g.query),n[c]=L}return n}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const n=this.context.gl;let c=0;for(const g of r)c+=n.getQueryParameter(g,n.QUERY_RESULT)/1e6,n.deleteQuery(g);return c}translatePosMatrix(r,n,c,g,M){if(!c[0]&&!c[1])return r;const L=M?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(L){const ne=Math.sin(L),ae=Math.cos(L);c=[c[0]*ae-c[1]*ne,c[0]*ne+c[1]*ae]}const q=[M?c[0]:t.ar(n,c[0],this.transform.zoom),M?c[1]:t.ar(n,c[1],this.transform.zoom),0],K=new Float32Array(16);return t.ab.mat4.translate(K,r,q),K}saveTileTexture(r){const n=r.size[0],c=this._tileTextures[n];c?c.push(r):this._tileTextures[n]=[r]}getTileTexture(r){const n=this._tileTextures[r];return n&&n.length>0?n.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(r,n,c){const g=c===void 0?this.terrain&&this.terrain.renderingToTexture:c,M=[];return this.style&&this.style.enable3dLights()&&(r==="globeRaster"||r==="terrainRaster"?(M.push("LIGHTING_3D_MODE"),M.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):g||M.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||M.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(M.push("TERRAIN"),this.linearFloatFilteringSupported()&&M.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&M.push("GLOBE"),!this._fogVisible||g||n!==void 0&&!n||M.push("FOG","FOG_DITHERING"),g&&M.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&M.push("OVERDRAW_INSPECTOR"),M}getOrCreateProgram(r,n){this.cache=this.cache||{};const c=n&&n.defines||[],g=n&&n.config,M=this.currentGlobalDefines(r,n&&n.overrideFog,n&&n.overrideRtt).concat(c),L=pd.cacheKey(zu[r],r,M,g);return this.cache[L]||(this.cache[L]=new pd(this.context,r,zu[r],g,Th[r],M)),this.cache[L]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,n){if(this.style.enable3dLights()){const c=this.style.directionalLight,g=this.style.ambientLight;if(c&&g){const M=((L,q,K)=>{const ne=L.properties.get("direction"),ae=L.properties.get("color-use-theme")==="none",he=L.properties.get("color").toRenderColor(ae?null:K.getLut(L.scope)).toArray01(),fe=L.properties.get("intensity"),Te=q.properties.get("color-use-theme")==="none",Ve=q.properties.get("color").toRenderColor(Te?null:K.getLut(q.scope)).toArray01(),je=q.properties.get("intensity"),Xe=[ne.x,ne.y,ne.z],Ye=t.cM(Ve,je),at=t.cM(he,fe);return{u_lighting_ambient_color:Ye,u_lighting_directional_dir:Xe,u_lighting_directional_color:at,u_ground_radiance:dd(Xe,at,Ye)}})(c,g,this.style);n.setLightsUniformValues(r,M)}}}uploadCommonUniforms(r,n,c,g,M){if(this.uploadCommonLightUniforms(r,n),this.terrain&&this.terrain.renderingToTexture)return;const L=this.style.fog;if(L){const q=L.getOpacity(this.transform.pitch),K=((ne,ae,he,fe,Te,Ve,je,Xe,Ye,at,pt,ft)=>{const bt=ne.transform,gt=ae.properties.get("color-use-theme")==="none",vt=ae.properties.get("color").toRenderColor(gt?null:ne.style.getLut(ae.scope)).toArray01();vt[3]=fe;const yt=ne.frameCounter/1e3%1,[Tt,Dt]=ae.properties.get("vertical-range");return{u_fog_matrix:he?bt.calculateFogTileMatrix(he):ft||ne.identityMat,u_fog_range:ae.getFovAdjustedRange(bt._fov),u_fog_color:vt,u_fog_horizon_blend:ae.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Tt,Dt),Dt],u_fog_temporal_offset:yt,u_frustum_tl:Te,u_frustum_tr:Ve,u_frustum_br:je,u_frustum_bl:Xe,u_globe_pos:Ye,u_globe_radius:at,u_viewport:pt,u_globe_transition:t.ae(bt.zoom),u_is_globe:+(bt.projection.name==="globe")}})(this,L,c,q,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*t.q.devicePixelRatio,this.transform.height*t.q.devicePixelRatio],g);n.setFogUniformValues(r,K)}M&&n.setCutoffUniformValues(r,M.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,n=r.createTexture();return r.bindTexture(r.TEXTURE_2D,n),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),n}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,n=this._backgroundTiles={},c=this.transform.coveringTiles({tileSize:512});for(const g of c)n[g.key]=r[g.key]||new Mo(g,512,this.transform.tileZoom,this);return n}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(r,n){return!(!r.is3D()||r.type!=="clip"&&(r.minzoom&&r.minzoom>this.transform.zoom||(this.style._clipLayerPresent||r.sourceLayer!=="building")&&(!n||n.type!=="batched-model")))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let n=this._cachedTileFogOpacities[r.key];return n||(this._cachedTileFogOpacities[r.key]=n=this.style.fog.getOpacityForTile(r)),n[0]>=gr||n[1]>=gr}setupDepthForOcclusion(r,n,c){const g=this.context,M=g.gl,L=!!c;var q;c||(c={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),g.activeTexture.set(M.TEXTURE3),r&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),c.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],c.u_depth_range_unpack=[2/((q=this.depthRangeFor3D)[1]-q[0]),-1-2*q[0]/(q[1]-q[0])],c.u_occluder_half_size=.5*this.occlusionParams.occluderSize,c.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),g.activeTexture.set(M.TEXTURE0),L||n.setTerrainUniformValues(g,c)}}function Bl(u,r){let n=!1,c=null;const g=()=>{c=null,n&&(u(),c=setTimeout(g,r),n=!1)};return()=>(n=!0,c||g(),c)}class Fh{constructor(r){this._hashName=r&&encodeURIComponent(r),t.aP(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Bl(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const n=uc(r);if(this._hashName){const c=this._hashName;let g=!1;const M=location.hash.slice(1).split("&").map(L=>{const q=L.split("=")[0];return q===c?(g=!0,`${q}=${n}`):L}).filter(L=>L);return g||M.push(`${c}=${n}`),`#${M.join("&")}`}return`#${n}`}_getCurrentHash(){const r=location.hash.replace("#","");if(this._hashName){let n;return r.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(n=c)}),(n&&n[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const n=this._getCurrentHash();if(n.length>=3&&!n.some(c=>isNaN(c))){const c=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(n[3]||0):r.getBearing();return r.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:c,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function uc(u,r){const n=u.getCenter(),c=Math.round(100*u.getZoom())/100,g=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),M=Math.pow(10,g),L=Math.round(n.lng*M)/M,q=Math.round(n.lat*M)/M,K=u.getBearing(),ne=u.getPitch();let ae=r?`/${L}/${q}/${c}`:`${c}/${q}/${L}`;return(K||ne)&&(ae+="/"+Math.round(10*K)/10),ne&&(ae+=`/${Math.round(ne)}`),ae}const Fl={linearity:.3,easing:t.dy(0,0,.3,1)},Md=t.l({deceleration:2500,maxSpeed:1400},Fl),Ad=t.l({deceleration:20,maxSpeed:1400},Fl),Id=t.l({deceleration:1e3,maxSpeed:360},Fl),Pd=t.l({deceleration:1e3,maxSpeed:90},Fl);class Cd{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.q.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,n=t.q.now();for(;r.length>0&&n-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const n={zoom:0,bearing:0,pitch:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:M}of this._inertiaBuffer)n.zoom+=M.zoomDelta||0,n.bearing+=M.bearingDelta||0,n.pitch+=M.pitchDelta||0,M.panDelta&&n.pan._add(M.panDelta),M.around&&(n.around=M.around),M.pinchAround&&(n.pinchAround=M.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(n.pan.mag()){const M=Ul(n.pan.mag(),c,t.l({},Md,r||{}));g.offset=n.pan.mult(M.amount/n.pan.mag()),g.center=this._map.transform.center,Nl(g,M)}if(n.zoom){const M=Ul(n.zoom,c,Ad);g.zoom=this._map.transform.zoom+M.amount,Nl(g,M)}if(n.bearing){const M=Ul(n.bearing,c,Id);g.bearing=this._map.transform.bearing+t.aw(M.amount,-179,179),Nl(g,M)}if(n.pitch){const M=Ul(n.pitch,c,Pd);g.pitch=this._map.transform.pitch+M.amount,Nl(g,M)}if(g.zoom||g.bearing){const M=n.pinchAround===void 0?n.around:n.pinchAround;g.around=M?this._map.unproject(M):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function Nl(u,r){(!u.duration||u.duration<r.duration)&&(u.duration=r.duration,u.easing=r.easing)}function Ul(u,r,n){const{maxSpeed:c,linearity:g,deceleration:M}=n,L=t.aw(u*g/(r/1e3),-c,c),q=Math.abs(L)/(M*g);return{easing:n.easing,duration:1e3*q,amount:L*(q/2)}}class sa extends t.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,n,c,g={}){const M=X(n.getCanvasContainer(),c),L=n.unproject(M);super(r,t.l({point:M,lngLat:L,originalEvent:c},g)),this._defaultPrevented=!1,this.target=n}}class jl extends t.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,n,c){const g=r==="touchend"?c.changedTouches:c.touches,M=W(n.getCanvasContainer(),g),L=M.map(K=>n.unproject(K)),q=M.reduce((K,ne,ae,he)=>K.add(ne.div(he.length)),new t.P(0,0));super(r,{points:M,point:q,lngLats:L,lngLat:n.unproject(q),originalEvent:c}),this._defaultPrevented=!1}}class Rd extends t.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,n){super("wheel",{originalEvent:n}),this._defaultPrevented=!1}}class Dd{constructor(r,n){this._map=r,this._clickTolerance=n.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Rd(this._map,r))}mousedown(r,n){return this._mousedownPos=n,this._firePreventable(new sa(r.type,this._map,r))}mouseup(r){this._map.fire(new sa(r.type,this._map,r))}preclick(r){const n=t.l({},r);n.type="preclick",this._map.fire(new sa(n.type,this._map,n))}click(r,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||(this.preclick(r),this._map.fire(new sa(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new sa(r.type,this._map,r))}mouseover(r){this._map.fire(new sa(r.type,this._map,r))}mouseout(r){this._map.fire(new sa(r.type,this._map,r))}touchstart(r){return this._firePreventable(new jl(r.type,this._map,r))}touchmove(r){this._map.fire(new jl(r.type,this._map,r))}touchend(r){this._map.fire(new jl(r.type,this._map,r))}touchcancel(r){this._map.fire(new jl(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ld{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new sa(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new sa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new sa(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Dm{constructor(r,n){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,n){this.isEnabled()&&r.shiftKey&&r.button===0&&(O(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(r,n){if(!this._active)return;const c=n,g=this._startPos,M=this._lastPos;if(!g||!M||M.equals(c)||!this._box&&c.dist(g)<this._clickTolerance)return;this._lastPos=c,this._box||(this._box=C("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const L=Math.min(g.x,c.x),q=Math.max(g.x,c.x),K=Math.min(g.y,c.y),ne=Math.max(g.y,c.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${L}px,${K}px)`,this._box.style.width=q-L+"px",this._box.style.height=ne-K+"px")})}mouseupWindow(r,n){if(!this._active)return;const c=this._startPos,g=n;if(c&&r.button===0){if(this.reset(),Z(),c.x!==g.x||c.y!==g.y)return this._map.fire(new t.z("boxzoomend",{originalEvent:r})),{cameraAnimation:M=>M.fitScreenCoordinates(c,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),U(),delete this._startPos,delete this._lastPos}_fireEvent(r,n){return this._map.fire(new t.z(r,{originalEvent:n}))}}function Nh(u,r){const n={};for(let c=0;c<u.length;c++)n[u[c].identifier]=r[c];return n}class hn{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,n,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),c.length===this.numTouches&&(this.centroid=function(g){const M=new t.P(0,0);for(const L of g)M._add(L);return M.div(g.length)}(n),this.touches=Nh(c,n)))}touchmove(r,n,c){if(this.aborted||!this.centroid)return;const g=Nh(c,n);for(const M in this.touches){const L=g[M];(!L||L.dist(this.touches[M])>30)&&(this.aborted=!0)}}touchend(r,n,c){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class cc{constructor(r){this.singleTap=new hn(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,n,c){this.singleTap.touchstart(r,n,c)}touchmove(r,n,c){this.singleTap.touchmove(r,n,c)}touchend(r,n,c){const g=this.singleTap.touchend(r,n,c);if(g){const M=r.timeStamp-this.lastTime<500,L=!this.lastTap||this.lastTap.dist(g)<30;if(M&&L||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Lm{constructor(){this._zoomIn=new cc({numTouches:1,numTaps:2}),this._zoomOut=new cc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,n,c){this._zoomIn.touchstart(r,n,c),this._zoomOut.touchstart(r,n,c)}touchmove(r,n,c){this._zoomIn.touchmove(r,n,c),this._zoomOut.touchmove(r,n,c)}touchend(r,n,c){const g=this._zoomIn.touchend(r,n,c),M=this._zoomOut.touchend(r,n,c);return g?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:L=>L.easeTo({duration:300,zoom:L.getZoom()+1,around:L.unproject(g)},{originalEvent:r})}):M?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:L=>L.easeTo({duration:300,zoom:L.getZoom()-1,around:L.unproject(M)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Om={0:1,2:2};class ls{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,n){return!1}_move(r,n){return{}}mousedown(r,n){if(this._lastPoint)return;const c=J(r);this._correctButton(r,c)&&(this._lastPoint=n,this._eventButton=c)}mousemoveWindow(r,n){const c=this._lastPoint;if(c){if(r.preventDefault(),this._eventButton!=null&&function(g,M){const L=Om[M];return g.buttons===void 0||(g.buttons&L)!==L}(r,this._eventButton))this.reset();else if(this._moved||!(n.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(c,n)}}mouseupWindow(r){this._lastPoint&&J(r)===this._eventButton&&(this._moved&&Z(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Od extends ls{mousedown(r,n){super.mousedown(r,n),this._lastPoint&&(this._active=!0)}_correctButton(r,n){return n===0&&!r.ctrlKey}_move(r,n){return{around:n,panDelta:n.sub(r)}}}class hc extends ls{_correctButton(r,n){return n===0&&r.ctrlKey||n===2}_move(r,n){const c=.8*(n.x-r.x);if(c)return this._active=!0,{bearingDelta:c}}contextmenu(r){r.preventDefault()}}class Vl extends ls{_correctButton(r,n){return n===0&&r.ctrlKey||n===2}_move(r,n){const c=-.5*(n.y-r.y);if(c)return this._active=!0,{pitchDelta:c}}contextmenu(r){r.preventDefault()}}class po{constructor(r,n){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),t.aP(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0)}touchstart(r,n,c){return this._calculateTransform(r,n,c)}touchmove(r,n,c){if(this._active&&!(c.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(c.length===1&&!t.dz())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,n,c)}}touchend(r,n,c){this._calculateTransform(r,n,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,n,c){c.length>0&&(this._active=!0);const g=Nh(c,n),M=new t.P(0,0),L=new t.P(0,0);let q=0;for(const ne in g){const ae=g[ne],he=this._touches[ne];he&&(M._add(ae),L._add(ae.sub(he)),q++,g[ne]=ae)}if(this._touches=g,q<this._minTouches||!L.mag())return;const K=L.div(q);return this._sum._add(K),this._sum.mag()<this._clickTolerance?void 0:{around:M.div(q),panDelta:K}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=C("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Ws{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,n,c){return{}}touchstart(r,n,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([n[0],n[1]]))}touchmove(r,n,c){const g=this._firstTwoTouches;if(!g)return;r.preventDefault();const[M,L]=g,q=sn(c,n,M),K=sn(c,n,L);if(!q||!K)return;const ne=this._aroundCenter?null:q.add(K).div(2);return this._move([q,K],ne,r)}touchend(r,n,c){if(!this._firstTwoTouches)return;const[g,M]=this._firstTwoTouches,L=sn(c,n,g),q=sn(c,n,M);L&&q||(this._active&&Z(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function sn(u,r,n){for(let c=0;c<u.length;c++)if(u[c].identifier===n)return r[c]}function Na(u,r){return Math.log(u/r)/Math.LN2}class Uh extends Ws{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,n){const c=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Na(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Na(this._distance,c),pinchAround:n}}}function Gl(u,r){return 180*u.angleWith(r)/Math.PI}class zd extends Ws{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,n){const c=this._vector;if(this._vector=r[0].sub(r[1]),c&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Gl(this._vector,c),pinchAround:n}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const n=25/(Math.PI*this._minDiameter)*360,c=this._startVector;if(!c)return!1;const g=Gl(r,c);return Math.abs(g)<n}}function jh(u){return Math.abs(u.y)>Math.abs(u.x)}class Hl extends Ws{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,jh(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,n,c){const g=this._lastPoints;if(!g)return;const M=r[0].sub(g[0]),L=r[1].sub(g[1]);return this._map._cooperativeGestures&&!t.dz()&&c.touches.length<3||(this._valid=this.gestureBeginsVertically(M,L,c.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(M.y+L.y)/2*-.5})}gestureBeginsVertically(r,n,c){if(this._valid!==void 0)return this._valid;const g=r.mag()>=2,M=n.mag()>=2;if(!g&&!M)return;if(!g||!M)return this._firstMove==null&&(this._firstMove=c),c-this._firstMove<100&&void 0;const L=r.y>0==n.y>0;return jh(r)&&jh(n)&&L}}const zm={panStep:100,bearingStep:15,pitchStep:10};class km{constructor(){const r=zm;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let n=0,c=0,g=0,M=0,L=0;switch(r.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:r.shiftKey?c=-1:(r.preventDefault(),M=-1);break;case 39:r.shiftKey?c=1:(r.preventDefault(),M=1);break;case 38:r.shiftKey?g=1:(r.preventDefault(),L=-1);break;case 40:r.shiftKey?g=-1:(r.preventDefault(),L=1);break;default:return}return this._rotationDisabled&&(c=0,g=0),{cameraAnimation:q=>{const K=q.getZoom();q.easeTo({duration:300,easeId:"keyboardHandler",easing:Vh,zoom:n?Math.round(K)+n*(r.shiftKey?2:1):K,bearing:q.getBearing()+c*this._bearingStep,pitch:q.getPitch()+g*this._pitchStep,offset:[-M*this._panStep,-L*this._panStep],center:q.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Vh(u){return u*(2-u)}const fc=4.000244140625,$s=1/450;class Zs{constructor(r,n){this._map=r,this._el=r.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=$s,t.aP(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||t.dz()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const c=t.q.now(),g=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,n!==0&&n%fc==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=n,this._timeout=window.setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(g*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),r.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=r,this._delta-=n,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=X(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:n,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const ne=this._type==="wheel"&&Math.abs(this._delta)>fc?this._wheelZoomRate:this._defaultZoomRate;let ae=2/(1+Math.exp(-Math.abs(this._delta*ne)));this._delta<0&&ae!==0&&(ae=1/ae);const he=n(),fe=Math.pow(2,he),Te=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):fe;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(Te*ae))),this._type==="wheel"&&(this._startZoom=he,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const c=typeof this._targetZoom=="number"?this._targetZoom:n(),g=this._startZoom,M=this._easing;let L,q=!1;if(this._type==="wheel"&&g&&M){const ne=Math.min((t.q.now()-this._lastWheelEventTime)/200,1),ae=M(ne);L=t.af(g,c,ae),ne<1?this._frameId||(this._frameId=!0):q=!0}else L=c,q=!0;this._active=!0,q&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let K=L-n();return K*this._lastDelta<0&&(K=0),{noInertia:!0,needsRenderFrame:!q,zoomDelta:K,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let n=t.dA;if(this._prevEase){const c=this._prevEase,g=(t.q.now()-c.start)/c.duration,M=c.easing(g+.01)-c.easing(g),L=.27/Math.sqrt(M*M+1e-4)*.01,q=Math.sqrt(.0729-L*L);n=t.dy(L,q,.25,1)}return this._prevEase={start:t.q.now(),duration:r,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=C("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class mo{constructor(r,n){this._clickZoom=r,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ua{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,n){return r.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:c.getZoom()+(r.shiftKey?-1:1),around:c.unproject(n)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zo{constructor(){this._tap=new cc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,n,c){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=n[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(r,n,c))}touchmove(r,n,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const g=n[0],M=g.y-this._swipePoint.y;return this._swipePoint=g,r.preventDefault(),this._active=!0,{zoomDelta:M/128}}}else this._tap.touchmove(r,n,c)}touchend(r,n,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(r,n,c)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class us{constructor(r,n,c){this._el=r,this._mousePan=n,this._touchPan=c}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ko{constructor(r,n,c){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=n,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Bm{constructor(r,n,c,g){this._el=r,this._touchZoom=n,this._touchRotate=c,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const dc=u=>u.zoom||u.drag||u.pitch||u.rotate;class Fm extends t.z{}class Nm{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,n){const c=t.ab.vec3.sub([],n,r);this.radius=t.ab.vec3.length(c[2]<0?t.ab.vec3.div([],c,this.constants):[c[0],c[1],0])}projectRay(r){t.ab.vec3.div(r,r,this.constants),t.ab.vec3.normalize(r,r),t.ab.vec3.mul(r,r,this.constants);const n=t.ab.vec3.scale([],r,this.radius);if(n[2]>0){const c=t.ab.vec3.scale([],[0,0,1],t.ab.vec3.dot(n,[0,0,1])),g=t.ab.vec3.scale([],t.ab.vec3.normalize([],[n[0],n[1],0]),this.radius),M=t.ab.vec3.add([],n,t.ab.vec3.scale([],t.ab.vec3.sub([],t.ab.vec3.add([],g,c),n),2));n[0]=M[0],n[1]=M[1]}return n}}function ql(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class Hn{constructor(r,n){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Cd(r),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Nm,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),t.aP(["handleEvent","handleWindowEvent"],this);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,M,L]of this._listeners){const q=g===document?this.handleWindowEvent:this.handleEvent;g.addEventListener(M,q,L)}}destroy(){for(const[r,n,c]of this._listeners){const g=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(n,g,c)}}_addDefaultHandlers(r){const n=this._map,c=n.getCanvasContainer();this._add("mapEvent",new Dd(n,r));const g=n.boxZoom=new Dm(n,r);this._add("boxZoom",g);const M=new Lm,L=new Ua;n.doubleClickZoom=new mo(L,M),this._add("tapZoom",M),this._add("clickZoom",L);const q=new zo;this._add("tapDragZoom",q);const K=n.touchPitch=new Hl(n);this._add("touchPitch",K);const ne=new hc(r),ae=new Vl(r);n.dragRotate=new ko(r,ne,ae),this._add("mouseRotate",ne,["mousePitch"]),this._add("mousePitch",ae,["mouseRotate"]);const he=new Od(r),fe=new po(n,r);n.dragPan=new us(c,he,fe),this._add("mousePan",he),this._add("touchPan",fe,["touchZoom","touchRotate"]);const Te=new zd,Ve=new Uh;n.touchZoomRotate=new Bm(c,Ve,Te,q),this._add("touchRotate",Te,["touchPan","touchZoom"]),this._add("touchZoom",Ve,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ld(n));const je=n.scrollZoom=new Zs(n,this);this._add("scrollZoom",je,["mousePan"]);const Xe=n.keyboard=new km;this._add("keyboard",Xe);for(const Ye of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[Ye]&&n[Ye].enable(r[Ye])}_add(r,n,c){this._handlers.push({handlerName:r,handler:n,allowed:c}),this._handlersById[r]=n}stop(r){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!dc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,n,c){for(const g in r)if(g!==c&&(!n||n.indexOf(g)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const n=[];for(const c of r)this._el.contains(c.target)&&n.push(c);return n}handleEvent(r,n){this._updatingCamera=!0;const c=r.type==="renderFrame",g=c?void 0:r,M={needsRenderFrame:!1},L={},q={},K=r.touches?this._getMapTouches(r.touches):void 0,ne=K?W(this._el,K):c?void 0:X(this._el,r);for(const{handlerName:fe,handler:Te,allowed:Ve}of this._handlers){if(!Te.isEnabled())continue;let je;this._blockedByActive(q,Ve,fe)?Te.reset():Te[n||r.type]&&(je=Te[n||r.type](r,ne,K),this.mergeHandlerResult(M,L,je,fe,g),je&&je.needsRenderFrame&&this._triggerRenderFrame()),(je||Te.isActive())&&(q[fe]=Te)}const ae={};for(const fe in this._previousActiveHandlers)q[fe]||(ae[fe]=g);this._previousActiveHandlers=q,(Object.keys(ae).length||ql(M))&&(this._changes.push([M,L,ae]),this._triggerRenderFrame()),(Object.keys(q).length||ql(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:he}=M;he&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],he(this._map))}mergeHandlerResult(r,n,c,g,M){if(!c)return;t.l(r,c);const L={handlerName:g,originalEvent:c.originalEvent||M};c.zoomDelta!==void 0&&(n.zoom=L),c.panDelta!==void 0&&(n.drag=L),c.pitchDelta!==void 0&&(n.pitch=L),c.bearingDelta!==void 0&&(n.rotate=L)}_applyChanges(){const r={},n={},c={};for(const[g,M,L]of this._changes)g.panDelta&&(r.panDelta=(r.panDelta||new t.P(0,0))._add(g.panDelta)),g.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(r.around=g.around),g.aroundCoord!==void 0&&(r.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(r.pinchAround=g.pinchAround),g.noInertia&&(r.noInertia=g.noInertia),t.l(n,M),t.l(c,L);this._updateMapTransform(r,n,c),this._changes=[]}_updateMapTransform(r,n,c){const g=this._map,M=g.transform,L=at=>[at.x,at.y,at.z];if((at=>{const pt=this._eventsInProgress.drag;return pt&&!this._handlersById[pt.handlerName].isActive()})()&&!ql(r)){const at=M.zoom;M.cameraElevationReference="sea",this._originalZoom!=null&&M._orthographicProjectionAtLowPitch&&M.projection.name!=="globe"&&M.pitch===0?(M.cameraElevationReference="ground",M.zoom=this._originalZoom):(M.recenterOnTerrain(),M.cameraElevationReference="ground"),at!==M.zoom&&this._map._update(!0)}if(M._isCameraConstrained&&g._stop(!0),!ql(r))return void this._fireEvents(n,c,!0);let{panDelta:q,zoomDelta:K,bearingDelta:ne,pitchDelta:ae,around:he,aroundCoord:fe,pinchAround:Te}=r;M._isCameraConstrained&&(K>0&&(K=0),M._isCameraConstrained=!1),Te!==void 0&&(he=Te),(K||(at=>n[at]&&!this._eventsInProgress[at])("drag"))&&he&&(this._dragOrigin=L(M.pointCoordinate3D(he)),this._originalZoom=M.zoom,this._trackingEllipsoid.setup(M._camera.position,this._dragOrigin)),M.cameraElevationReference="sea",g._stop(!0),he=he||g.transform.centerPoint,ne&&(M.bearing+=ne),ae&&(M.pitch+=ae),M._updateCameraState();const Ve=[0,0,0];if(q)if(M.projection.name==="mercator"){const at=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(he).dir),pt=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(he.sub(q)).dir);Ve[0]=pt[0]-at[0],Ve[1]=pt[1]-at[1]}else{const at=M.pointCoordinate(he);if(M.projection.name==="globe"){q=q.rotate(-M.angle);const pt=M._pixelsPerMercatorPixel/M.worldSize;Ve[0]=-q.x*t.dB(t.aS(at.y))*pt,Ve[1]=-q.y*t.dB(M.center.lat)*pt}else{const pt=M.pointCoordinate(he.sub(q));at&&pt&&(Ve[0]=pt.x-at.x,Ve[1]=pt.y-at.y)}}const je=M.zoom,Xe=[0,0,0];if(K){const at=L(fe||M.pointCoordinate3D(he)),pt={dir:t.ab.vec3.normalize([],t.ab.vec3.sub([],at,M._camera.position))};if(pt.dir[2]<0){const ft=M.zoomDeltaToMovement(at,K);t.ab.vec3.scale(Xe,pt.dir,ft)}}const Ye=t.ab.vec3.add(Ve,Ve,Xe);M._translateCameraConstrained(Ye),K&&Math.abs(M.zoom-je)>1e-4&&M.recenterOnTerrain(),M.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(n,c,!0)}_fireEvents(r,n,c){const g=dc(this._eventsInProgress),M=dc(r),L={};for(const ae in r){const{originalEvent:he}=r[ae];this._eventsInProgress[ae]||(L[`${ae}start`]=he),this._eventsInProgress[ae]=r[ae]}!g&&M&&this._fireEvent("movestart",M.originalEvent);for(const ae in L)this._fireEvent(ae,L[ae]);M&&this._fireEvent("move",M.originalEvent);for(const ae in r){const{originalEvent:he}=r[ae];this._fireEvent(ae,he)}const q={};let K;for(const ae in this._eventsInProgress){const{handlerName:he,originalEvent:fe}=this._eventsInProgress[ae];this._handlersById[he].isActive()||(delete this._eventsInProgress[ae],K=n[he]||fe,q[`${ae}end`]=K)}for(const ae in q)this._fireEvent(ae,q[ae]);const ne=dc(this._eventsInProgress);if(c&&(g||M)&&!ne){this._updatingCamera=!0;const ae=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),he=fe=>fe!==0&&-this._bearingSnap<fe&&fe<this._bearingSnap;ae?(he(ae.bearing||this._map.getBearing())&&(ae.bearing=0),this._map.easeTo(ae,{originalEvent:K})):(this._map.fire(new t.z("moveend",{originalEvent:K})),he(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,n){this._map.fire(new t.z(r,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new Fm("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const pc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class kd extends t.E{constructor(r,n){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=n.respectPrefersReducedMotion!==!1,t.aP(["_renderFrameCallback"],this)}getCenter(){return new t.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(r,n){return this.jumpTo({center:r},n)}panBy(r,n,c){return r=t.P.convert(r).mult(-1),this.panTo(this.transform.center,t.l({offset:r},n),c)}panTo(r,n,c){return this.easeTo(t.l({center:r},n),c)}getZoom(){return this.transform.zoom}setZoom(r,n){return this.jumpTo({zoom:r},n),this}zoomTo(r,n,c){return this.easeTo(t.l({zoom:r},n),c)}zoomIn(r,n){return this.zoomTo(this.getZoom()+1,r,n),this}zoomOut(r,n){return this.zoomTo(this.getZoom()-1,r,n),this}getBearing(){return this.transform.bearing}setBearing(r,n){return this.jumpTo({bearing:r},n),this}getPadding(){return this.transform.padding}setPadding(r,n){return this.jumpTo({padding:r},n),this}rotateTo(r,n,c){return this.easeTo(t.l({bearing:r},n),c)}resetNorth(r,n){return this.rotateTo(0,t.l({duration:1e3},r),n),this}resetNorthPitch(r,n){return this.easeTo(t.l({bearing:0,pitch:0,duration:1e3},r),n),this}snapToNorth(r,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,n):this}getPitch(){return this.transform.pitch}setPitch(r,n){return this.jumpTo({pitch:r},n),this}cameraForBounds(r,n){r=t.az.convert(r);const c=n&&n.bearing||0,g=n&&n.pitch||0,M=r.getNorthWest(),L=r.getSouthEast();return this._cameraForBounds(this.transform,M,L,c,g,n)}_extendPadding(r){const n={top:0,right:0,bottom:0,left:0};return r==null?t.l({},n,this.transform.padding):typeof r=="number"?{top:r,bottom:r,right:r,left:r}:t.l({},n,r)}_extendCameraOptions(r){return(r=t.l({offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=this._extendPadding(r.padding),r}_minimumAABBFrustumDistance(r,n){const c=n.max[0]-n.min[0],g=n.max[1]-n.min[1];return c/g>r.aspect?c/(2*Math.tan(.5*r.fovX)*r.aspect):g/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,n,c,g,M,L){const q=r.clone(),K=this._extendCameraOptions(L);q.bearing=g,q.pitch=M;const ne=t.bO.convert(n),ae=t.bO.convert(c),he=.5*(ne.lat+ae.lat),fe=.5*(ne.lng+ae.lng),Te=t.dC(he,fe),Ve=t.ab.vec3.normalize([],Te),je=t.ab.vec3.normalize([],t.ab.vec3.cross([],Ve,[0,1,0])),Xe=t.ab.vec3.cross([],je,Ve),Ye=[je[0],je[1],je[2],0,Xe[0],Xe[1],Xe[2],0,Ve[0],Ve[1],Ve[2],0,0,0,0,1],at=[Te,t.dC(ne.lat,ne.lng),t.dC(ae.lat,ne.lng),t.dC(ae.lat,ae.lng),t.dC(ne.lat,ae.lng),t.dC(he,ne.lng),t.dC(he,ae.lng),t.dC(ne.lat,fe),t.dC(ae.lat,fe)];let pt=t.cd.fromPoints(at.map(Xt=>[t.ab.vec3.dot(je,Xt),t.ab.vec3.dot(Xe,Xt),t.ab.vec3.dot(Ve,Xt)]));const ft=t.ab.vec3.transformMat4([],pt.center,Ye);t.ab.vec3.squaredLength(ft)===0&&t.ab.vec3.set(ft,0,0,1),t.ab.vec3.normalize(ft,ft),t.ab.vec3.scale(ft,ft,t.ax),q.center=t.dD(ft);const bt=q.getWorldToCameraMatrix(),gt=t.ab.mat4.invert(new Float64Array(16),bt);pt=t.cd.applyTransform(pt,t.ab.mat4.multiply([],bt,Ye));const vt=this._extendAABB(pt,q,K,g);if(!vt)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");pt=vt,t.ab.vec3.transformMat4(ft,ft,bt);const yt=.5*(pt.max[2]-pt.min[2]),Tt=this._minimumAABBFrustumDistance(q,pt),Dt=t.ab.vec3.scale([],[0,0,1],yt),Zt=t.ab.vec3.add(Dt,ft,Dt),Ht=Tt+(q.pitch===0?0:t.ab.vec3.distance(ft,Zt)),Pt=q.globeCenterInViewSpace,zt=t.ab.vec3.sub([],ft,[Pt[0],Pt[1],Pt[2]]);t.ab.vec3.normalize(zt,zt),t.ab.vec3.scale(zt,zt,Ht);const tr=t.ab.vec3.add([],ft,zt);t.ab.vec3.transformMat4(tr,tr,gt);const lr=t.ds/t.ax,pr=t.ab.vec3.length(tr),Gt=t.bH(Math.max(pr*lr-t.ds,Number.EPSILON),0),nr=Math.min(q.zoomFromMercatorZAdjusted(Gt),K.maxZoom);return nr>.5*(t.c6+t.bY)?(q.setProjection({name:"mercator"}),q.zoom=nr,this._cameraForBounds(q,n,c,g,M,L)):{center:q.center,zoom:nr,bearing:g,pitch:M}}_extendAABB(r,n,c,g){const M=.5*((c.padding.left||0)+(c.padding.right||0)),L=.5*((c.padding.top||0)+(c.padding.bottom||0)),q=L,K=M,ne=M,ae=L,he=n.width-(K+ne),fe=n.height-(q+ae),Te=t.ab.vec3.sub([],r.max,r.min),Ve=Math.min(he/Te[0],fe/Te[1]),je=Math.min(n.scaleZoom(n.scale*Ve),c.maxZoom);if(isNaN(je))return null;const Xe=n.scale/n.zoomScale(je),Ye=new t.cd([r.min[0]-K*Xe,r.min[1]-ae*Xe,r.min[2]],[r.max[0]+ne*Xe,r.max[1]+q*Xe,r.max[2]]),at=(typeof c.offset.x=="number"&&typeof c.offset.y=="number"?new t.P(c.offset.x,c.offset.y):t.P.convert(c.offset)).rotate(-t.ai(g));return Ye.center[0]-=at.x*Xe,Ye.center[1]+=at.y*Xe,Ye}queryTerrainElevation(r,n){const c=this.transform.elevation;return c?(n=t.l({},{exaggerated:!0},n),c.getAtPoint(t.aa.fromLngLat(r),null,n.exaggerated)):null}_cameraForBounds(r,n,c,g,M,L){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,n,c,g,M,L);const q=r.clone(),K=this._extendCameraOptions(L);q.bearing=g,q.pitch=M;const ne=t.bO.convert(n),ae=t.bO.convert(c),he=new t.bO(ne.lng,ae.lat),fe=new t.bO(ae.lng,ne.lat),Te=q.project(ne),Ve=q.project(ae),je=this.queryTerrainElevation(ne),Xe=this.queryTerrainElevation(ae),Ye=this.queryTerrainElevation(he),at=this.queryTerrainElevation(fe),pt=[[Te.x,Te.y,Math.min(je||0,Xe||0,Ye||0,at||0)],[Ve.x,Ve.y,Math.max(je||0,Xe||0,Ye||0,at||0)]];let ft=t.cd.fromPoints(pt);const bt=q.getWorldToCameraMatrix(),gt=t.ab.mat4.invert(new Float64Array(16),bt);ft=t.cd.applyTransform(ft,bt);const vt=this._extendAABB(ft,q,K,g);if(!vt)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ft=vt;const yt=.5*t.ab.vec3.sub([],ft.max,ft.min)[2],Tt=this._minimumAABBFrustumDistance(q,ft),Dt=[0,0,1,0];t.ab.vec4.transformMat4(Dt,Dt,bt),t.ab.vec4.normalize(Dt,Dt);const Zt=t.ab.vec3.scale([],Dt,Tt+yt),Ht=t.ab.vec3.add([],ft.center,Zt);t.ab.vec3.transformMat4(ft.center,ft.center,gt),t.ab.vec3.transformMat4(Ht,Ht,gt);const Pt=q.unproject(new t.P(ft.center[0],ft.center[1])),zt=t.dE(q.projection,Pt),tr=Math.pow(2,zt),lr=Math.min(q._zoomFromMercatorZ(Ht[2]*q.pixelsPerMeter*tr/q.worldSize),K.maxZoom);return q.mercatorFromTransition&&lr<.5*(t.c6+t.bY)?(q.setProjection({name:"globe"}),q.zoom=lr,this._cameraForBounds(q,n,c,g,M,L)):{center:Pt,zoom:lr,bearing:g,pitch:M}}fitBounds(r,n,c){const g=this.cameraForBounds(r,n);return this._fitInternal(g,n,c)}fitScreenCoordinates(r,n,c,g,M){const L=t.P.convert(r),q=t.P.convert(n),K=new t.P(Math.min(L.x,q.x),Math.min(L.y,q.y)),ne=new t.P(Math.max(L.x,q.x),Math.max(L.y,q.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(L,q))return this;const ae=this.transform.pointLocation3D(K),he=this.transform.pointLocation3D(ne),fe=this.transform.pointLocation3D(new t.P(K.x,ne.y)),Te=this.transform.pointLocation3D(new t.P(ne.x,K.y)),Ve=[Math.min(ae.lng,he.lng,fe.lng,Te.lng),Math.min(ae.lat,he.lat,fe.lat,Te.lat)],je=[Math.max(ae.lng,he.lng,fe.lng,Te.lng),Math.max(ae.lat,he.lat,fe.lat,Te.lat)],Xe=g&&g.pitch?g.pitch:this.getPitch(),Ye=this._cameraForBounds(this.transform,Ve,je,c,Xe,g);return this._fitInternal(Ye,g,M)}_fitInternal(r,n,c){return r?(n=t.l(r,n)).linear?this.easeTo(n,c):this.flyTo(n,c):this}jumpTo(r,n){this.stop();const c=r.preloadOnly?this.transform.clone():this.transform;let g=!1,M=!1,L=!1;"zoom"in r&&c.zoom!==+r.zoom&&(g=!0,c.zoom=+r.zoom),r.center!==void 0&&(c.center=t.bO.convert(r.center)),"bearing"in r&&c.bearing!==+r.bearing&&(M=!0,c.bearing=+r.bearing),"pitch"in r&&c.pitch!==+r.pitch&&(L=!0,c.pitch=+r.pitch);const q=typeof r.padding=="number"?this._extendPadding(r.padding):r.padding;if(r.padding!=null&&!c.isPaddingEqual(q))if(r.retainPadding===!1){const K=c.clone();K.padding=q,c.setLocationAtPoint(c.center,K.centerPoint)}else c.padding=q;return r.preloadOnly?(this._preloadTiles(c),this):(this.fire(new t.z("movestart",n)).fire(new t.z("move",n)),g&&this.fire(new t.z("zoomstart",n)).fire(new t.z("zoom",n)).fire(new t.z("zoomend",n)),M&&this.fire(new t.z("rotatestart",n)).fire(new t.z("rotate",n)).fire(new t.z("rotateend",n)),L&&this.fire(new t.z("pitchstart",n)).fire(new t.z("pitch",n)).fire(new t.z("pitchend",n)),this.fire(new t.z("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||t.w(pc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,n){const c=this.transform;if(!c.projection.supportsFreeCamera)return t.w(pc),this;this.stop();const g=c.zoom,M=c.pitch,L=c.bearing;c.setFreeCameraOptions(r);const q=g!==c.zoom,K=M!==c.pitch,ne=L!==c.bearing;return this.fire(new t.z("movestart",n)).fire(new t.z("move",n)),q&&this.fire(new t.z("zoomstart",n)).fire(new t.z("zoom",n)).fire(new t.z("zoomend",n)),ne&&this.fire(new t.z("rotatestart",n)).fire(new t.z("rotate",n)).fire(new t.z("rotateend",n)),K&&this.fire(new t.z("pitchstart",n)).fire(new t.z("pitch",n)).fire(new t.z("pitchend",n)),this.fire(new t.z("moveend",n)),this}easeTo(r,n){this._stop(!1,r.easeId),((r=t.l({offset:[0,0],duration:500,easing:t.dA},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);const c=this.transform,g=this.getZoom(),M=this.getBearing(),L=this.getPitch(),q=this.getPadding(),K="zoom"in r?+r.zoom:g,ne="bearing"in r?this._normalizeBearing(r.bearing,M):M,ae="pitch"in r?+r.pitch:L,he=this._extendPadding(r.padding),fe=t.P.convert(r.offset);let Te,Ve,je;if(c.projection.name==="globe"){const Dt=t.aa.fromLngLat(c.center),Zt=fe.rotate(-c.angle);Dt.x+=Zt.x/c.worldSize,Dt.y+=Zt.y/c.worldSize;const Ht=Dt.toLngLat(),Pt=t.bO.convert(r.center||Ht);this._normalizeCenter(Pt),Te=c.centerPoint.add(Zt),Ve=new t.P(Dt.x,Dt.y).mult(c.worldSize),je=new t.P(t.at(Pt.lng),t.aA(Pt.lat)).mult(c.worldSize).sub(Ve)}else{Te=c.centerPoint.add(fe);const Dt=c.pointLocation(Te),Zt=t.bO.convert(r.center||Dt);this._normalizeCenter(Zt),Ve=c.project(Dt),je=c.project(Zt).sub(Ve)}const Xe=c.zoomScale(K-g);let Ye,at;r.around&&(Ye=t.bO.convert(r.around),at=c.locationPoint(Ye));const pt=this._zooming||K!==g,ft=this._rotating||M!==ne,bt=this._pitching||ae!==L,gt=!c.isPaddingEqual(he),vt=r.retainPadding===!1?c.clone():c,yt=Dt=>Zt=>{if(pt&&(Dt.zoom=t.af(g,K,Zt)),ft&&(Dt.bearing=t.af(M,ne,Zt)),bt&&(Dt.pitch=t.af(L,ae,Zt)),gt&&(vt.interpolatePadding(q,he,Zt),Te=vt.centerPoint.add(fe)),Ye)Dt.setLocationAtPoint(Ye,at);else{const Ht=Dt.zoomScale(Dt.zoom-g),Pt=K>g?Math.min(2,Xe):Math.max(.5,Xe),zt=Math.pow(Pt,1-Zt),tr=Dt.unproject(Ve.add(je.mult(Zt*zt)).mult(Ht));Dt.setLocationAtPoint(Dt.renderWorldCopies?tr.wrap():tr,Te)}return r.preloadOnly||this._fireMoveEvents(n),Dt};if(r.preloadOnly){const Dt=this._emulate(yt,r.duration,c);return this._preloadTiles(Dt),this}const Tt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=pt,this._rotating=ft,this._pitching=bt,this._padding=gt,this._easeId=r.easeId,this._prepareEase(n,r.noMoveStart,Tt),this._ease(yt(c),Dt=>{c.cameraElevationReference==="sea"&&c.recenterOnTerrain(),this._afterEase(n,Dt)},r),this}_prepareEase(r,n,c={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),n||c.moving||this.fire(new t.z("movestart",r)),this._zooming&&!c.zooming&&this.fire(new t.z("zoomstart",r)),this._rotating&&!c.rotating&&this.fire(new t.z("rotatestart",r)),this._pitching&&!c.pitching&&this.fire(new t.z("pitchstart",r))}_fireMoveEvents(r){this.fire(new t.z("move",r)),this._zooming&&this.fire(new t.z("zoom",r)),this._rotating&&this.fire(new t.z("rotate",r)),this._pitching&&this.fire(new t.z("pitch",r))}_afterEase(r,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const c=this._zooming,g=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new t.z("zoomend",r)),g&&this.fire(new t.z("rotateend",r)),M&&this.fire(new t.z("pitchend",r)),this.fire(new t.z("moveend",r))}flyTo(r,n){if(this._prefersReducedMotion(r)){const Xt=t.ay(r,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Xt,n)}this.stop(),r=t.l({offset:[0,0],speed:1.2,curve:1.42,easing:t.dA},r);const c=this.transform,g=this.getZoom(),M=this.getBearing(),L=this.getPitch(),q=this.getPadding(),K="zoom"in r?t.aw(+r.zoom,c.minZoom,c.maxZoom):g,ne="bearing"in r?this._normalizeBearing(r.bearing,M):M,ae="pitch"in r?+r.pitch:L,he=this._extendPadding(r.padding),fe=c.zoomScale(K-g),Te=t.P.convert(r.offset);let Ve=c.centerPoint.add(Te);const je=c.pointLocation(Ve),Xe=t.bO.convert(r.center||je);this._normalizeCenter(Xe);const Ye=c.project(je),at=c.project(Xe).sub(Ye);let pt=r.curve;const ft=Math.max(c.width,c.height),bt=ft/fe,gt=at.mag();if("minZoom"in r){const Xt=t.aw(Math.min(r.minZoom,g,K),c.minZoom,c.maxZoom),hr=ft/c.zoomScale(Xt-g);pt=Math.sqrt(hr/gt*2)}const vt=pt*pt;function yt(Xt){const hr=(bt*bt-ft*ft+(Xt?-1:1)*vt*vt*gt*gt)/(2*(Xt?bt:ft)*vt*gt);return Math.log(Math.sqrt(hr*hr+1)-hr)}function Tt(Xt){return(Math.exp(Xt)-Math.exp(-Xt))/2}function Dt(Xt){return(Math.exp(Xt)+Math.exp(-Xt))/2}const Zt=yt(0);let Ht=function(Xt){return Dt(Zt)/Dt(Zt+pt*Xt)},Pt=function(Xt){return ft*((Dt(Zt)*(Tt(hr=Zt+pt*Xt)/Dt(hr))-Tt(Zt))/vt)/gt;var hr},zt=(yt(1)-Zt)/pt;if(Math.abs(gt)<1e-6||!isFinite(zt)){if(Math.abs(ft-bt)<1e-6)return this.easeTo(r,n);const Xt=bt<ft?-1:1;zt=Math.abs(Math.log(bt/ft))/pt,Pt=function(){return 0},Ht=function(hr){return Math.exp(Xt*pt*hr)}}r.duration="duration"in r?+r.duration:1e3*zt/("screenSpeed"in r?+r.screenSpeed/pt:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const tr=M!==ne,lr=ae!==L,pr=!c.isPaddingEqual(he),Gt=r.retainPadding===!1?c.clone():c,nr=Xt=>hr=>{const ar=hr*zt,er=1/Ht(ar);Xt.zoom=hr===1?K:g+Xt.scaleZoom(er),tr&&(Xt.bearing=t.af(M,ne,hr)),lr&&(Xt.pitch=t.af(L,ae,hr)),pr&&(Gt.interpolatePadding(q,he,hr),Ve=Gt.centerPoint.add(Te));const Sr=hr===1?Xe:Xt.unproject(Ye.add(at.mult(Pt(ar))).mult(er));return Xt.setLocationAtPoint(Xt.renderWorldCopies?Sr.wrap():Sr,Ve),Xt._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(n),Xt};if(r.preloadOnly){const Xt=this._emulate(nr,r.duration,c);return this._preloadTiles(Xt),this}return this._zooming=!0,this._rotating=tr,this._pitching=lr,this._padding=pr,this._prepareEase(n,!1),this._ease(nr(c),()=>this._afterEase(n),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(r){}_cancelRenderFrame(r){}_stop(r,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const c=this._onEaseEnd;this._onEaseEnd=void 0,c.call(this,n)}if(!r){const c=this.handlers;c&&c.stop(!1)}return this}_ease(r,n,c){c.animate===!1||c.duration===0?(r(1),n()):(this._easeStart=t.q.now(),this._easeOptions=c,this._onEaseFrame=r,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((t.q.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,n){r=t.bF(r,-180,180);const c=Math.abs(r-n);return Math.abs(r-360-n)<c&&(r-=360),Math.abs(r+360-n)<c&&(r+=360),r}_normalizeCenter(r){const n=this.transform;if(n.maxBounds||n.projection.name!=="globe"&&!n.renderWorldCopies)return;const c=r.lng-n.center.lng;r.lng+=c>180?-360:c<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&t.q.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,n,c){const g=Math.ceil(15*n/1e3),M=[],L=r(c.clone());for(let q=0;q<=g;q++){const K=L(q/g);M.push(K.clone())}return M}_preloadTiles(r,n){}}class Bd{constructor(r={}){this.options=r,t.aP(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const n=this.options&&this.options.compact,c=r._getUIString("AttributionControl.ToggleAttribution");this._map=r,this._container=C("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=C("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",c);const g=C("span","mapboxgl-ctrl-icon",this._compactButton);return g.setAttribute("aria-hidden","true"),g.setAttribute("title",c),this._innerContainer=C("div","mapboxgl-ctrl-attrib-inner",this._container),n&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),n===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.e.ACCESS_TOKEN}];if(r){const c=n.reduce((g,M,L)=>(M.value&&(g+=`${M.key}=${M.value}${L<n.length-1?"&":""}`),g),"?");r.href=`${t.e.FEEDBACK_URL}/${c}#${uc(this._map,!0)}`,r.rel="noopener nofollow"}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const n=this._map.style._mergedSourceCaches;for(const g in n){const M=n[g];if(M.used){const L=M.getSource();L.attribution&&r.indexOf(L.attribution)<0&&r.push(L.attribution)}}r.sort((g,M)=>g.length-M.length),r=r.filter((g,M)=>{for(let L=M+1;L<r.length;L++)if(r[L].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const c=r.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,r.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class cs{constructor(){t.aP(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=C("div","mapboxgl-ctrl");const n=C("a","mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://www.mapbox.com/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const n in r){const c=r[n].getSource();if(c.hasOwnProperty("mapbox_logo")&&!c.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const n=r[0];this._map.getCanvasContainer().offsetWidth<250?n.classList.add("mapboxgl-compact"):n.classList.remove("mapboxgl-compact")}}}class mc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const n=++this._id;return this._queue.push({callback:r,id:n,cancelled:!1}),n}remove(r){const n=this._currentlyRunning,c=n?this._queue.concat(n):this._queue;for(const g of c)if(g.id===r)return void(g.cancelled=!0)}run(r=0){const n=this._currentlyRunning=this._queue;this._queue=[];for(const c of n)if(!c.cancelled&&(c.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Ma{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const n=t.cB((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,n,c){this._start=this.getValue(n),this._end=r,this._startTime=n,this._endTime=n+c}}const Aa={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Xs=["mouseenter","mouseover","mouseleave","mouseout"];class Bo extends t.z{constructor(r,n,c,g){const{point:M,lngLat:L,originalEvent:q,target:K}=r;super(r.type,{point:M,lngLat:L,originalEvent:q,target:K}),this.preventDefault=()=>{r.preventDefault()},this.id=n,this.interaction=c,this.feature=g}}class Ys{constructor(r){this.map=r,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.delegatedHandlers=new Map,this.handleType=this.handleType.bind(this)}add(r,n){if(this.typeById.has(r))throw new Error(`Interaction id "${r}" already exists.`);const{type:c,filter:g}=n;g&&this.filters.set(r,t.aZ(g));const M=this.interactionsByType.get(c)||new Map;if(M.size===0){if(Xs.includes(c)){const{mousemove:L,mouseout:q}=this._createDelegatedHandlers(r,n);this.map.on("mousemove",L),this.map.on("mouseout",q),this.delegatedHandlers.set(r,{mousemove:L,mouseout:q})}else this.map.on(c,this.handleType);this.interactionsByType.set(c,M)}M.set(r,n),this.typeById.set(r,c)}get(r){const n=this.typeById.get(r);if(!n)return;const c=this.interactionsByType.get(n);return c?c.get(r):void 0}remove(r){const n=this.typeById.get(r);if(!n)return;this.typeById.delete(r),this.filters.delete(r);const c=this.interactionsByType.get(n);if(c){if(c.delete(r),this.delegatedHandlers.has(r)){const{mousemove:g,mouseout:M}=this.delegatedHandlers.get(r);this.map.off("mousemove",g),this.map.off("mouseout",M),this.delegatedHandlers.delete(r)}c.size===0&&this.map.off(n,this.handleType)}}queryTargets(r,n){const c=[];for(const[g,M]of n)M.target&&c.push({targetId:g,target:M.target,filter:this.filters.get(g)});return this.map.style.queryRenderedTargets(r,c,this.map.transform)}handleType(r,n){const c=this.interactionsByType.get(r.type),g=Array.from(c).reverse();n=n||this.queryTargets(r.point,g);let M=!1;for(const L of n){for(const[q,K]of g){if(!K.target)continue;const ne=L.variants?L.variants[q]:null;if(ne){for(const ae of ne){const he=new t.cw(L,ae);if(K.handler(new Bo(r,q,K,he))!==!1){M=!0;break}}if(M)break}}if(M)break}if(!M)for(const[L,q]of g){const{handler:K,target:ne}=q;if(!ne&&K(new Bo(r,L,q,null))!==!1)break}}_createDelegatedHandlers(r,n){switch(n.type){case"mouseenter":case"mouseover":{let c=!1,g=new Set;return{mousemove:M=>{const L=this.queryTargets(M.point,[[r,n]]),q=new Set;if(!L.length)return c=!1,void g.clear();const K=[];for(const ne of L)g.has(ne.id)||(q.add(ne.id),K.push(ne));c&&!K.length||(c=!0,g=q,M.type=n.type,this.handleType(M,K))},mouseout:()=>{c=!1,g.clear()}}}case"mouseleave":case"mouseout":{let c=[];return{mousemove:g=>{const M=this.queryTargets(g.point,[[r,n]]);if(!M.length)return g.type=n.type,this.handleType(g,c),void(c=M);const L=[],q=new Set(M.map(K=>K.id));for(const K of c)q.has(K.id)||L.push(K);L.length&&(g.type=n.type,this.handleType(g,L)),c=M},mouseout:g=>{c.length&&(g.type=n.type,this.handleType(g,c),c=[])}}}}}}function Gh(u,r){if(Array.isArray(u)&&Array.isArray(r)){const n=new Set(u),c=new Set(r);return n.size===c.size&&u.every(g=>c.has(g))}return t.bn(u,r)}const Ai={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Fo={showCompass:!0,showZoom:!0,visualizePitch:!1};class Um{constructor(r,n,c=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new hc({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,c&&(this.mousePitch=new Vl({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),t.aP(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(r,n){this.mouseRotate.mousedown(r,n),this.mousePitch&&this.mousePitch.mousedown(r,n),O()}move(r,n){const c=this.map,g=this.mouseRotate.mousemoveWindow(r,n),M=g&&g.bearingDelta;if(M&&c.setBearing(c.getBearing()+M),this.mousePitch){const L=this.mousePitch.mousemoveWindow(r,n),q=L&&L.pitchDelta;q&&c.setPitch(c.getPitch()+q)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){U(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(t.l({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),X(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,X(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=W(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=W(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Fd(u,r,n){if(u=new t.bO(u.lng,u.lat),r){const c=new t.bO(u.lng-360,u.lat),g=new t.bO(u.lng+360,u.lat),M=360*Math.ceil(Math.abs(u.lng-n.center.lng)/360),L=n.locationPoint(u).distSqr(r),q=r.x<0||r.y<0||r.x>n.width||r.y>n.height;n.locationPoint(c).distSqr(r)<L&&(q||Math.abs(c.lng-n.center.lng)<M)?u=c:n.locationPoint(g).distSqr(r)<L&&(q||Math.abs(g.lng-n.center.lng)<M)&&(u=g)}for(;Math.abs(u.lng-n.center.lng)>180;){const c=n.locationPoint(u);if(c.x>=0&&c.y>=0&&c.x<=n.width&&c.y<=n.height)break;u.lng>n.center.lng?u.lng-=360:u.lng+=360}return u}const Wl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ya extends t.E{constructor(r,n){if(super(),(r instanceof HTMLElement||n)&&(r=t.l({element:r},n)),t.aP(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=t.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=C("div");const M=41,L=27,q=z("svg",{display:"block",height:M*this._scale+"px",width:L*this._scale+"px",viewBox:`0 0 ${L} ${M}`},this._element),K=z("radialGradient",{id:"shadowGradient"},z("defs",{},q));z("stop",{offset:"10%","stop-opacity":.4},K),z("stop",{offset:"100%","stop-opacity":.05},K),z("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},q),z("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},q),z("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},q),z("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},q),this._offset=t.P.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",M=>{M.preventDefault()}),this._element.addEventListener("mousedown",M=>{M.preventDefault()});const c=this._element.classList;for(const M in Wl)c.remove(`mapboxgl-marker-anchor-${M}`);c.add(`mapboxgl-marker-anchor-${this._anchor}`);const g=r&&r.className?r.className.trim().split(/\s+/):[];c.add(...g),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=t.bO.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const n=r.code,c=r.charCode||r.keyCode;n!=="Space"&&n!=="Enter"&&c!==32&&c!==13||this.togglePopup()}_onMapClick(r){const n=r.originalEvent.target,c=this._element;this._popup&&(n===c||c.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,n=this._pos;if(!r||!n)return!1;const c=r.unproject(n),g=r.getFreeCameraOptions();if(!g.position)return!1;const M=g.position.toLngLat();return M.distanceTo(c)<.9*M.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const n=this._pos;if(!n||n.x<0||n.x>r.transform.width||n.y<0||n.y>r.transform.height)return void this._clearFadeTimer();const c=r.unproject(n);let g;r._showingGlobe()&&t.dH(r.transform,this._lngLat)?g=0:(g=1-r._queryFogOpacity(c),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const n=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${Wl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${n.x}px,${n.y}px)
        `}_calculateXYTransform(){const r=this._pos,n=this._map,c=this.getPitchAlignment();if(!n||!r||c!=="map")return"";if(!n._showingGlobe()){const K=n.getPitch();return K?`rotateX(${K}deg)`:""}const g=t.c4(t.dI(n.transform,this._lngLat)),M=r.sub(t.dJ(n.transform)),L=Math.abs(M.x)+Math.abs(M.y);if(L===0)return"";const q=g/L;return`rotateX(${-M.y*q}deg) rotateY(${M.x*q}deg)`}_calculateZTransform(){const r=this._pos,n=this._map;if(!n||!r)return"";let c=0;const g=this.getRotationAlignment();if(g==="map")if(n._showingGlobe()){const M=n.project(new t.bO(this._lngLat.lng,this._lngLat.lat+.001)),L=n.project(new t.bO(this._lngLat.lng,this._lngLat.lat-.001)).sub(M);c=t.c4(Math.atan2(L.y,L.x))-90}else c=-n.getBearing();else if(g==="horizon"){const M=t.ac(4,6,n.getZoom()),L=t.dJ(n.transform);L.y+=M*n.transform.height;const q=r.sub(L),K=t.c4(Math.atan2(q.y,q.x));c=(K>90?K-270:K+90)*(1-M)}return c+=this._rotation,c?`rotateZ(${c}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=Fd(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat),r===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=t.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){const n=this._map;if(!n)return;const c=this._pointerdownPos,g=this._positionDelta;if(c&&g){if(!this._isDragging){const M=this._clickTolerance||n._clickTolerance;if(r.point.dist(c)<M)return;this._isDragging=!0}this._pos=r.point.sub(g),this._lngLat=n.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new t.z("dragstart"))),this.fire(new t.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new t.z("dragend")),this._state="inactive"}_addDragHandler(r){const n=this._map,c=this._pos;n&&c&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(c),this._pointerdownPos=r.point,this._state="pending",n.on("mousemove",this._onMove),n.on("touchmove",this._onMove),n.once("mouseup",this._onUp),n.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const n=this._map;return n&&(r?(n.on("mousedown",this._addDragHandler),n.on("touchstart",this._addDragHandler)):(n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const _o={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},qn={maxWidth:100,unit:"metric"},la={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},In={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Nd=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Wn(u=new t.P(0,0),r="bottom"){if(typeof u=="number"){const n=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(r){case"top":return new t.P(0,u);case"top-left":return new t.P(n,n);case"top-right":return new t.P(-n,n);case"bottom":return new t.P(0,-u);case"bottom-left":return new t.P(n,-n);case"bottom-right":return new t.P(-n,-n);case"left":return new t.P(u,0);case"right":return new t.P(-u,0)}return new t.P(0,0)}return u instanceof t.P||Array.isArray(u)?t.P.convert(u):t.P.convert(u[r]||[0,0])}return{version:S,supported:p.supported,setRTLTextPlugin:t.dK,getRTLTextPluginStatus:t.dL,Map:class extends kd{constructor(u){w.mark(D.create);const r=u;if((u=t.l({},Ai,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&t.dF(window)&&(u.antialias=!1,t.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Iu(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),u),this._repaint=!!u.repaint,this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._collectResourceTiming=u.collectResourceTiming,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new mc,this._domRenderTaskQueue=new mc,this._controls=[],this._markers=[],this._popups=[],this._mapId=t.aV(),this._locale=t.l({},Aa,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._tessellationStep=u.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=u.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Ma(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=u.scaleFactor,this._requestManager=new ue(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,this._contextCreateOptions=u.contextCreateOptions?{...u.contextCreateOptions}:{},typeof u.container=="string"){const n=document.getElementById(u.container);if(!n)throw new Error(`Container '${u.container.toString()}' not found.`);this._container=n}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&t.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),this._spriteFormat=u.spriteFormat,t.aP(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new nc),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Hn(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,(u.style||!u.testMode)&&this.setStyle(u.style||t.e.DEFAULT_STYLE,{config:u.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),this.indoor=new Yf(this),u.hash&&(this._hash=new Fh(typeof u.hash=="string"&&u.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){r.center==null&&r.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch});const n=u.bounds;n&&(this.resize(),this.fitBounds(n,t.l({},u.fitBoundsOptions,{duration:0})))}this.resize(),u.attributionControl&&this.addControl(new Bd({customAttribution:u.customAttribution})),this._logoControl=new cs,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new t.z(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new t.z(`${n.dataType}dataloading`,n))}),this._interactions=new Ys(this)}_getMapId(){return this._mapId}addControl(u,r){if(r===void 0&&(r=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new t.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=u.onAdd(this);this._controls.push(u);const c=this._controlPositions[r];return r.indexOf("bottom")!==-1?c.insertBefore(n,c.firstChild):c.appendChild(n),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new t.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(u);return r>-1&&this._controls.splice(r,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new t.z("movestart",u)).fire(new t.z("move",u)),this.fire(new t.z("resize",u)),r&&this.fire(new t.z("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(t.az.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new t.z("zoomstart")).fire(new t.z("zoom")).fire(new t.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new t.z("zoomstart")).fire(new t.z("zoom")).fire(new t.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new t.z("pitchstart")).fire(new t.z("pitch")).fire(new t.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new t.z("pitchstart")).fire(new t.z("pitch")).fire(new t.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(u){return this._scaleFactor=u,this.painter.scaleFactor=u,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(r=>r.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(r=>r==="auto"?navigator.language:r):u}setLanguage(u){const r=this._parseLanguage(u);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const u=this.transform,r=u.projection.name;let n;r==="globe"&&u.zoom>=t.bY?(u.setMercatorFromTransition(),n=!0):r==="mercator"&&u.zoom<t.bY&&(u.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(u,r){return this._updateProjection(u||r||{name:"mercator"})}_updateProjection(u){let r;return r=u.name==="globe"&&this.transform.zoom>=t.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(u){return this.transform.locationPoint3D(t.bO.convert(u))}unproject(u){return this.transform.pointLocation3D(t.P.convert(u))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(u,r,n){const c=g=>{let M=[];if(Array.isArray(r)){const L=r.filter(q=>this.getLayer(q));M=L.length?this.queryRenderedFeatures(g,{layers:L}):[]}else M=this.queryRenderedFeatures(g,{target:r});return M};if(u==="mouseenter"||u==="mouseover"){let g=!1;return{listener:n,targets:r,delegates:{mousemove:L=>{const q=c(L.point);q.length?g||(g=!0,n.call(this,new sa(u,this,L.originalEvent,{features:q}))):g=!1},mouseout:()=>{g=!1}}}}if(u==="mouseleave"||u==="mouseout"){let g=!1;return{listener:n,targets:r,delegates:{mousemove:q=>{c(q.point).length?g=!0:g&&(g=!1,n.call(this,new sa(u,this,q.originalEvent)))},mouseout:q=>{g&&(g=!1,n.call(this,new sa(u,this,q.originalEvent)))}}}}{const g=M=>{const L=c(M.point);L.length&&(M.features=L,n.call(this,M),delete M.features)};return{listener:n,targets:r,delegates:{[u]:g}}}}on(u,r,n){if(typeof r=="function"||n===void 0)return super.on(u,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const c=this._createDelegatedListener(u,r,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(c);for(const g in c.delegates)this.on(g,c.delegates[g]);return this}once(u,r,n){if(typeof r=="function"||n===void 0)return super.once(u,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const c=this._createDelegatedListener(u,r,n);for(const g in c.delegates)this.once(g,c.delegates[g]);return this}off(u,r,n){if(typeof r=="function"||n===void 0)return super.off(u,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const c=this._delegatedListeners?this._delegatedListeners[u]:void 0;return c&&(g=>{for(let M=0;M<g.length;M++){const L=g[M];if(L.listener===n&&Gh(L.targets,r)){for(const q in L.delegates)this.off(q,L.delegates[q]);return g.splice(M,1),this}}})(c),this}queryRenderedFeatures(u,r){if(!this.style)return[];if(u===void 0||u instanceof t.P||Array.isArray(u)||r!==void 0||(r=u,u=void 0),u=u||[[0,0],[this.transform.width,this.transform.height]],!r){const M=this.style.queryRenderedFeatures(u,void 0,this.transform),L=this.style.queryRenderedFeatureset(u,void 0,this.transform);return M.concat(L)}let n=!0;if(r.target&&(n=this._isTargetValid(r.target),n&&!r.layers))return this.style.queryRenderedFeatureset(u,r,this.transform);let c=!0;if(r.layers&&Array.isArray(r.layers)){for(const M of r.layers)if(!this._isValidId(M)){c=!1;break}if(c&&!r.target)return this.style.queryRenderedFeatures(u,r,this.transform)}let g=[];return c&&(g=g.concat(this.style.queryRenderedFeatures(u,r,this.transform))),n&&(g=g.concat(this.style.queryRenderedFeatureset(u,r,this.transform))),g}querySourceFeatures(u,r){return!u||typeof u=="string"&&!this._isValidId(u)?[]:this.style.querySourceFeatures(u,r)}isPointOnSurface(u){const{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&t.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(t.P.convert(u))}addInteraction(u,r){return this._interactions.add(u,r),this}removeInteraction(u){return this._interactions.remove(u),this}setStyle(u,r){return r=t.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&u&&r.diff!==!1&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(u,(n,c)=>{n?(t.w(`Unable to perform style diff: ${String(n.message||n.error||n)}. Rebuilding the style from scratch.`),this._updateStyle(u,r)):c&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(u,r))}_getUIString(u){const r=this._locale[u];if(r==null)throw new Error(`Missing UI string '${u}'`);return r}_updateStyle(u,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u){const n=t.l({},r);r&&r.config&&(n.initialConfig=r.config,delete n.config),this.style=new na(this,n).load(u),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new na(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(t.w("There is no style added to the map."),!1)}_isValidId(u){return u==null?(this.fire(new t.y(new Error("IDs can't be empty."))),!1):!t.cr(u)||(this.fire(new t.y(new Error(`IDs can't contain special symbols: "${u}".`))),!1)}_isTargetValid(u){return"featuresetId"in u?this._isValidId("importId"in u?u.importId:u.featuresetId):"layerId"in u&&this._isValidId(u.layerId)}_areTargetsValid(u){if(Array.isArray(u)){for(const r of u)if(!this._isValidId(r))return!1;return!0}return this._isTargetValid(u)}addSource(u,r){return this._isValidId(u)?(this._lazyInitEmptyStyle(),this.style.addSource(u,r),this._update(!0)):this}isSourceLoaded(u){return!!this._isValidId(u)&&!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(u,r,n){this._lazyInitEmptyStyle(),this.style.addSourceType(u,r,n)}removeSource(u){return this._isValidId(u)?(this.style.removeSource(u),this._updateTerrain(),this._update(!0)):this}getSource(u){return this._isValidId(u)?this.style.getOwnSource(u):null}addImage(u,r,{pixelRatio:n=1,sdf:c=!1,stretchX:g,stretchY:M,content:L}={}){if(this._lazyInitEmptyStyle(),r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:q,height:K,data:ne}=t.q.getImageData(r);this.style.addImage(u,{data:new t.r({width:q,height:K},ne),pixelRatio:n,stretchX:g,stretchY:M,content:L,sdf:c,version:0,usvg:!1})}else if(r.width===void 0||r.height===void 0)this.fire(new t.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:q,height:K}=r,ne=r;this.style.addImage(u,{data:new t.r({width:q,height:K},new Uint8Array(ne.data)),pixelRatio:n,stretchX:g,stretchY:M,content:L,sdf:c,usvg:!1,version:0,userImage:ne}),ne.onAdd&&ne.onAdd(this,u)}}updateImage(u,r){this._lazyInitEmptyStyle();const n=this.style.getImage(u);if(!n)return void this.fire(new t.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?t.q.getImageData(r):r,{width:g,height:M,data:L}=c;if(g===void 0||M===void 0)return void this.fire(new t.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==(n.usvg?n.icon.usvg_tree.width:n.data.width)||M!==(n.usvg?n.icon.usvg_tree.height:n.data.height))return void this.fire(new t.y(new Error(`The width and height of the updated image (${g}, ${M})
                must be that same as the previous version of the image
                (${n.data.width}, ${n.data.height})`)));const q=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);let K=!1;n.usvg?(n.data=new t.r({width:g,height:M},new Uint8Array(L)),n.usvg=!1,n.icon=void 0,K=!0):n.data.replace(L,q),this.style.updateImage(u,n,K)}hasImage(u){return u?!!this.style&&!!this.style.getImage(u):(this.fire(new t.y(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,r){t.o(this._requestManager.transformRequest(u,t.R.Image),(n,c)=>{r(n,c instanceof HTMLImageElement?t.q.getImageData(c):c)})}listImages(){return this.style.listImages()}addModel(u,r){this._lazyInitEmptyStyle(),this.style.addModel(u,r)}hasModel(u){return u?this.style.hasModel(u):(this.fire(new t.y(new Error("Missing required model id"))),!1)}removeModel(u){this.style.removeModel(u)}listModels(){return this.style.listModels()}addLayer(u,r){return this._isValidId(u.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(u,r),this._update(!0)):this}getSlot(u){const r=this.getLayer(u);return r&&r.slot||null}setSlot(u,r){return this.style.setSlot(u,r),this.style.mergeLayers(),this._update(!0)}addImport(u,r){return this.style.addImport(u,r),this}updateImport(u,r){return typeof r!="string"&&r.id!==u?(this.removeImport(u),this.addImport(r)):(this.style.updateImport(u,r),this._update(!0))}removeImport(u){return this.style.removeImport(u),this}moveImport(u,r){return this.style.moveImport(u,r),this._update(!0)}moveLayer(u,r){return this._isValidId(u)?(this.style.moveLayer(u,r),this._update(!0)):this}removeLayer(u){return this._isValidId(u)?(this.style.removeLayer(u),this._update(!0)):this}getLayer(u){if(!this._isValidId(u))return null;const r=this.style.getOwnLayer(u);return r?r.type==="custom"?r.implementation:r.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(u,r,n){return this._isValidId(u)?(this.style.setLayerZoomRange(u,r,n),this._update(!0)):this}setFilter(u,r,n={}){return this._isValidId(u)?(this.style.setFilter(u,r,n),this._update(!0)):this}getFilter(u){return this._isValidId(u)?this.style.getFilter(u):null}setPaintProperty(u,r,n,c={}){return this._isValidId(u)?(this.style.setPaintProperty(u,r,n,c),this._update(!0)):this}getPaintProperty(u,r){return this._isValidId(u)?this.style.getPaintProperty(u,r):null}setLayoutProperty(u,r,n,c={}){return this._isValidId(u)?(this.style.setLayoutProperty(u,r,n,c),this._update(!0)):this}getLayoutProperty(u,r){return this._isValidId(u)?this.style.getLayoutProperty(u,r):null}getSchema(u){return this.style.getSchema(u)}setSchema(u,r){return this.style.setSchema(u,r),this._update(!0)}getConfig(u){return this.style.getConfig(u)}setConfig(u,r){return this.style.setConfig(u,r),this._update(!0)}getConfigProperty(u,r){return this.style.getConfigProperty(u,r)}setConfigProperty(u,r,n){return this.style.setConfigProperty(u,r,n),this._update(!0)}getFeaturesetDescriptors(u){return this.style.getFeaturesetDescriptors(u)}setLights(u){if(this._lazyInitEmptyStyle(),u&&u.length===1&&u[0].type==="flat"){const r=u[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(u),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const u=this.style.getLights()||[];return u.length===0&&u.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),u}setLight(u,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:u}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(u){return this._lazyInitEmptyStyle(),this.style.setSnow(u),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(u){return this._lazyInitEmptyStyle(),this.style.setRain(u),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(u){return this._lazyInitEmptyStyle(),this.style.setColorTheme(u),this._update(!0)}setImportColorTheme(u,r){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(u,r),this._update(!0)}setCamera(u){return this.style.setCamera(u),this._triggerCameraUpdate(u)}_triggerCameraUpdate(u){return this._update(this.transform.setOrthographicProjectionAtLowPitch(u["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.bO.convert(u),this.transform):0}setFeatureState(u,r){return u.source&&!this._isValidId(u.source)?this:(this.style.setFeatureState(u,r),this._update())}removeFeatureState(u,r){return u.source&&!this._isValidId(u.source)?this:(this.style.removeFeatureState(u,r),this._update())}getFeatureState(u){return u.source&&!this._isValidId(u.source)?null:this.style.getFeatureState(u)}_updateContainerDimensions(){if(!this._container)return;const u=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let n,c,g,M=this._container;for(;M&&(!c||!g);){const L=window.getComputedStyle(M).transform;L&&L!=="none"&&(n=L.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&n[0]!=="0"&&n[0]!=="1"&&(c=n[0]),n[3]&&n[3]!=="0"&&n[3]!=="1"&&(g=n[3])),M=M.parentElement}this._containerWidth=c?Math.abs(u/c):u,this._containerHeight=g?Math.abs(r/g):r}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&t.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=C("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=C("div","mapboxgl-canvas-container",u);this._canvas=C("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=C("div","mapboxgl-control-container",u),c=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(g=>{c[g]=C("div",`mapboxgl-ctrl-${g}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,r){const n=t.q.devicePixelRatio||1;this._canvas.width=n*Math.ceil(u),this._canvas.height=n*Math.ceil(r),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${r}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const r=this._markers.indexOf(u);r!==-1&&this._markers.splice(r,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){const r=this._popups.indexOf(u);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const u=t.l({},p.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",u);r?(qe(r,!0),this.painter=new Bh(r,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",n=>{n.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),t.m.testSupport(r)):this.fire(new t.y(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.z("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.resize(),this._update(),this.fire(new t.z("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let r;this.fire(new t.z("renderstart")),++this._frameId;const n=this.painter.context.extTimerQuery,c=t.q.now(),g=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=g.createQuery(),g.beginQuery(n.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();const M=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const ne=this.transform.zoom,ae=this.transform.pitch,he=t.q.now(),fe=new t.a8(ne,{now:he,fadeDuration:M,pitch:ae,transition:this.style.transition});this.style.update(fe)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let L=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),L=this._updateAverageElevation(c),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):L=this._updateAverageElevation(c);const q=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,M,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),q&&(this._placementDirty=q.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:M,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,w.mark(D.load),this.fire(new t.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const ne=t.q.now()-c;g.endQuery(n.TIME_ELAPSED_EXT),setTimeout(()=>{const ae=g.getQueryParameter(r,g.QUERY_RESULT)/1e6;g.deleteQuery(r),this.fire(new t.z("gpu-timing-frame",{cpuTime:ne,gpuTime:ae}))},50)}if(this.listens("gpu-timing-layer")){const ne=this.painter.collectGpuTimers();setTimeout(()=>{const ae=this.painter.queryGpuTimers(ne);this.fire(new t.z("gpu-timing-layer",{layerTimes:ae}))},50)}if(this.listens("gpu-timing-deferred-render")){const ne=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const ae=this.painter.queryGpuTimeDeferredRender(ne);this.fire(new t.z("gpu-timing-deferred-render",{gpuTime:ae}))},50)}const K=this._sourcesDirty||this._styleDirty||this._placementDirty||L;if(K||this._repaint)this.triggerRepaint();else{const ne=this.idle();if(ne&&(L=this._updateAverageElevation(c,!0)),L)this.triggerRepaint();else if(this._triggerFrame(!1),ne&&(this.fire(new t.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const ae=this._calculateSpeedIndex();this.fire(new t.z("speedindexcompleted",{speedIndex:ae})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||K||(this._fullyLoaded=!0,w.mark(D.fullLoad),this._performanceMetricsCollection&&pe(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(const r of this._markers)u&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!u||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(u,r=!1){const n=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&n(0);const c=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(c||(r||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const g=this.transform.averageElevation;let M=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(M)?M=0:this._averageElevationLastSampledAt=u;const L=Math.abs(g-M);if(L>1){if(this._isInitialLoad||c)return this._averageElevation.jumpTo(M),n(M);this._averageElevation.easeTo(M,u,300)}else if(L>1e-4)return this._averageElevation.jumpTo(M),n(M)}return!!this._averageElevation.isEasing(u)&&n(this._averageElevation.getValue(u))}_authenticate(){_e(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===ye||u.status===401)){const r=this.painter.context.gl;qe(r,!1),this._logoControl instanceof cs&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Ce(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Ae(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const u=this._isDragging();this.painter.updateTerrain(this.style,u)}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const n=this.painter.context.gl,c=n.createFramebuffer();function g(M){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,M,0);const L=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,L),L}return n.bindFramebuffer(n.FRAMEBUFFER,c),this._canvasPixelComparison(g(u),r.canvasCopies.map(g),r.timeStamps)}_canvasPixelComparison(u,r,n){let c=n[1]-n[0];const g=u.length/4;for(let M=0;M<r.length;M++){const L=r[M];let q=0;for(let K=0;K<L.length;K+=4)L[K]===u[K]&&L[K+1]===u[K+1]&&L[K+2]===u[K+2]&&L[K+3]===u[K+3]&&(q+=1);c+=(n[M+2]-n[M+1])*(1-q/g)}return c}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),ke.delete(this.painter.context.gl),Ke.remove(),Fe.remove(),this._removed=!0,this.fire(new t.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=t.q.frame(r=>{const n=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,n&&this._render(r)}))}_preloadTiles(u){const r=this.style?this.style.getSourceCaches():[];return t.bl(r,(n,c)=>n._preloadTiles(u,c),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(u){this._showParseStatus!==u&&(this._showParseStatus=u,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(u){this._showLayers2DWireframe!==u&&(this._showLayers2DWireframe=u,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(u){this._showLayers3DWireframe!==u&&(this._showLayers3DWireframe=u,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,this._tp.refreshUI(),u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,this._tp.refreshUI(),u&&this._update())}_setCacheLimits(u,r){t.dG(u,r)}get version(){return S}},NavigationControl:class{constructor(u={}){this.options=t.l({},Fo,u),this._container=C("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(t.aP(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),C("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),C("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(t.aP(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const n=this._map;n&&(this.options.visualizePitch?n.resetNorthPitch({},{originalEvent:r}):n.resetNorth({},{originalEvent:r}))}),this._compassIcon=C("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map;if(!u)return;const r=u.getZoom(),n=r===u.getMaxZoom(),c=r===u.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const u=this._map;if(!u)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Um(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){const u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,r){const n=C("button",u,this._container);return n.type="button",n.addEventListener("click",r),n}_setButtonTitle(u,r){if(!this._map)return;const n=this._map._getUIString(`NavigationControl.${r}`);u.setAttribute("aria-label",n),u.firstElementChild&&u.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends t.E{constructor(u={}){super();const r=navigator.geolocation;this.options=t.l({geolocation:r},_o,u),t.aP(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Bl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=C("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){const r=(n=!!this.options.geolocation)=>{this._supportsGeolocation=n,u(n)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(n=>r(n.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(u){const r=this._map.getMaxBounds(),n=u.coords;return!!r&&(n.longitude<r.getWest()||n.longitude>r.getEast()||n.latitude<r.getSouth()||n.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new t.z("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.z("geolocate",u)),this._finish()}}_updateCamera(u){const r=new t.bO(u.coords.longitude,u.coords.latitude),n=u.coords.accuracy,c=this._map.getBearing(),g=t.l({bearing:c},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(n),g,{geolocateSource:!0})}_updateMarker(u){if(u){const r=new t.bO(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map.transform,r=t.bH(1,u._center.lat)*u.worldSize,n=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.z("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=C("button","mapboxgl-ctrl-geolocate",this._container),C("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=C("div","mapboxgl-user-location"),this._dotElement.appendChild(C("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(C("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ya({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=C("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ya({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.z("trackuserlocationend")))})}}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Bd,ScaleControl:class{constructor(u={}){this.options=t.l({},qn,u),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),t.aP(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const u=this.options.maxWidth||100,r=this._map,n=r._containerHeight/2,c=r._containerWidth/2-u/2,g=r.unproject([c,n]),M=r.unproject([c+u,n]),L=g.distanceTo(M);if(this.options.unit==="imperial"){const q=3.2808*L;q>5280?this._setScale(u,q/5280,"mile"):this._setScale(u,q,"foot")}else this.options.unit==="nautical"?this._setScale(u,L/1852,"nautical-mile"):L>=1e3?this._setScale(u,L/1e3,"kilometer"):this._setScale(u,L,"meter")}_setScale(u,r,n){this._map._requestDomTask(()=>{const c=function(M){const L=Math.pow(10,`${Math.floor(M)}`.length-1);let q=M/L;return q=q>=10?10:q>=5?5:q>=3?3:q>=2?2:q>=1?1:function(K){const ne=Math.pow(10,Math.ceil(-Math.log(K)/Math.LN10));return Math.round(K*ne)/ne}(q),L*q}(r),g=c/r;this._container.innerHTML=this._isNumberFormatSupported&&n!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(c):`${c}&nbsp;${la[n]}`,this._container.style.width=u*g+"px"})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=C("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u={}){this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:t.w("Full screen control 'container' must be a DOM element.")),t.aP(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=C("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=C("button","mapboxgl-ctrl-fullscreen",this._controlContainer);C("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.E{constructor(u){super(),this.options=t.l(Object.create(In),u),t.aP(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new t.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new t.z("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=t.bO.convert(u),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const r=document.createDocumentFragment(),n=document.createElement("body");let c;for(n.innerHTML=u;c=n.firstChild,c;)r.appendChild(c);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=C("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(u),this.options.closeButton){const n=this._closeButton=C("button","mapboxgl-popup-close-button",r);n.type="button",n.setAttribute("aria-label","Close popup"),n.setAttribute("aria-hidden","true"),n.innerHTML="&#215;",n.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let r;return this._classList.delete(u)?r=!1:(this._classList.add(u),r=!0),this._updateClassList(),r}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const r=this._map,n=this._container,c=this._pos;if(!r||!n||!c)return"bottom";const g=n.offsetWidth,M=n.offsetHeight,L=c.x<g/2,q=c.x>r.transform.width-g/2;if(c.y+u<M)return L?"top-left":q?"top-right":"top";if(c.y>r.transform.height-M){if(L)return"bottom-left";if(q)return"bottom-right"}return L?"left":q?"right":"bottom"}_updateClassList(){const u=this._container;if(!u)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),u.className=r.join(" ")}_update(u){const r=this._map,n=this._content;if(!r||!this._lngLat&&!this._trackPointer||!n)return;let c=this._container;if(c||(c=this._container=C("div","mapboxgl-popup",r.getContainer()),this._tip=C("div","mapboxgl-popup-tip",c),c.appendChild(n)),this.options.maxWidth&&c.style.maxWidth!==this.options.maxWidth&&(c.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Fd(this._lngLat,this._pos,r.transform)),!this._trackPointer||u){const g=this._pos=this._trackPointer&&u instanceof t.P?u:r.project(this._lngLat),M=Wn(this.options.offset),L=this._anchor=this._getAnchor(M.y),q=Wn(this.options.offset,L),K=g.add(q).round();r._requestDomTask(()=>{this._container&&L&&(this._container.style.transform=`${Wl[L]} translate(${K.x}px,${K.y}px)`)})}if(!this._marker&&r._showingGlobe()){const g=t.dH(r.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(Nd);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:Ya,Style:na,LngLat:t.bO,LngLatBounds:t.az,Point:t.P,MercatorCoordinate:t.aa,FreeCameraOptions:Cs,Evented:t.E,config:t.e,prewarm:t.dM,clearPrewarmedResources:t.dN,get accessToken(){return t.e.ACCESS_TOKEN},set accessToken(u){t.e.ACCESS_TOKEN=u},get baseApiUrl(){return t.e.API_URL},set baseApiUrl(u){t.e.API_URL=u},get workerCount(){return t.dO.workerCount},set workerCount(u){t.dO.workerCount=u},get maxParallelImageRequests(){return t.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){t.e.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){t.dP(u)},get workerUrl(){return t.dQ.workerUrl},set workerUrl(u){t.dQ.workerUrl=u},get workerClass(){return t.dQ.workerClass},set workerClass(u){t.dQ.workerClass=u},get workerParams(){return t.dQ.workerParams},set workerParams(u){t.dQ.workerParams=u},get dracoUrl(){return t.dR()},set dracoUrl(u){t.dS(u)},get meshoptUrl(){return t.dT()},set meshoptUrl(u){t.dU(u)},setNow:t.q.setNow,restoreNow:t.q.restoreNow}});var T=k;return T})})(jE);var Df=jE.exports;const vs=Fy(Df);function ug(a){return a*(Math.PI/180)}function qx(a){return a*(180/Math.PI)}function U3(a){return a.reduce((h,v)=>h+v,0)/a.length}function cg(a,h,v){const k=v/6371,b=ug(a.lat),T=ug(a.lng),t=ug(h),S=Math.asin(Math.sin(b)*Math.cos(k)+Math.cos(b)*Math.sin(k)*Math.cos(t)),D=T+Math.atan2(Math.sin(t)*Math.sin(k)*Math.cos(b),Math.cos(k)-Math.sin(b)*Math.sin(S));return new Df.LngLat(qx(D),qx(S))}function GE(a,h){if(!a)return 0;const v=[cg(h,0,1),cg(h,90,1),cg(h,45,1)],_=a.project(h),k=v.map(T=>a.project(T).dist(_));return U3(k)}async function j3(a,h=64,v=64){try{const k=await(await fetch(a,{mode:"cors"})).blob(),b=await createImageBitmap(k),T=document.createElement("canvas"),t=T.getContext("2d");if(!t)throw new Error("Could not get canvas context");const S=h/b.width,D=v/b.height,w=Math.min(S,D,1);T.width=b.width*w,T.height=b.height*w,t.drawImage(b,0,0,T.width,T.height);const E=t.getImageData(0,0,T.width,T.height),m=E.data;for(let y=0;y<m.length;y+=4){const p=255-m[y+3];m[y]=p,m[y+1]=p,m[y+2]=p,m[y+3]=255}return t.putImageData(E,0,0),console.log("a"),T.toDataURL("image/png")}catch(_){throw console.log("b"),_}}var V3=bs("<div>");let hg;const[Wx,G3]=fa(),$x=[],H3=a=>(Kp(async()=>{vs.accessToken="pk.eyJ1Ijoiemltb25pdHJvbWUiLCJhIjoiY2xobW0zZGtwMWRldTNkbnVhNnk1NmIxeCJ9.oSRHcrxFqxJhaKps59a4Bw";const h=new vs.Map({container:hg,zoom:2,minZoom:0,center:[30,50],projection:{name:lu()}}),v=()=>{Ny()&&$x.forEach(_=>{const k=_.getLngLat(),b=GE(h,k),T=_.getElement().firstChild;T.style.scale=`${20*b}`,T.style.transformOrigin="bottom center"})};h.on("load",()=>{for(let k=0;k<1e3;k++){const b=Math.random()*360-180,T=Math.random()*180-90,t=new vs.Marker().setLngLat([b,T]).addTo(Wx());$x.push(t)}v()}),h.on("move",()=>{v()}),G3(h)}),Of(()=>{lu(),Wx()?.setProjection({name:lu()})}),(()=>{var h=V3(),v=hg;return typeof v=="function"?kf(v,h):hg=h,h.style.setProperty("width","600px"),h.style.setProperty("height","400px"),h})());var q3=bs("<div>");let fg;const[wf,W3]=fa(),$3=a=>(Kp(async()=>{vs.accessToken="pk.eyJ1Ijoiemltb25pdHJvbWUiLCJhIjoiY2xobW0zZGtwMWRldTNkbnVhNnk1NmIxeCJ9.oSRHcrxFqxJhaKps59a4Bw";const h=new vs.Map({container:fg,zoom:2,minZoom:0,center:[30,50],projection:{name:lu()}}),v=()=>{if(!Ny())return;const _=wf().getSource("points"),k=_._data.features;_&&(_.setData({type:"FeatureCollection",features:k.map(b=>{const T=b.geometry.coordinates,t=GE(h,new Df.LngLat(T[0],T[1]));return{...b,properties:{scale:20*t}}})}),wf().getLayer("points")&&(wf().removeLayer("points"),wf().addLayer({id:"points",type:"symbol",source:"points",layout:{"icon-image":"custom-marker","icon-allow-overlap":!0,"icon-ignore-placement":!0,"icon-size":["get","scale"]}})))};h.on("load",()=>{h.loadImage("https://docs.mapbox.com/mapbox-gl-js/assets/custom_marker.png",(k,b)=>{if(k)throw k;h.addImage("custom-marker",b);const T=[];for(let t=0;t<1e3;t++){const S=Math.random()*360-180,D=Math.random()*180-90;T.push(new Df.LngLat(S,D))}h.addSource("points",{type:"geojson",data:{type:"FeatureCollection",features:T.map((t,S)=>({type:"Feature",geometry:{type:"Point",coordinates:[t.lng,t.lat]},properties:{}}))}}),h.addLayer({id:"points",type:"symbol",source:"points",layout:{"icon-image":"custom-marker","icon-allow-overlap":!0,"icon-ignore-placement":!0}}),h.setLayoutProperty("points","icon-size",["get","scale"])}),v()}),h.on("move",()=>{v()}),W3(h)}),Of(()=>{lu(),wf()?.setProjection({name:lu()})}),(()=>{var h=q3(),v=fg;return typeof v=="function"?kf(v,h):fg=h,h.style.setProperty("width","600px"),h.style.setProperty("height","400px"),h})());var Z3=bs("<div><h1>MapboxGL Scaling Example</h1><div><div><h2>Marker Map</h2></div><div><h2>Layer Map</h2></div></div><div><label>Projection:&nbsp;<select><option value=mercator>Mercator</option><option value=globe>Globe</option></select></label><br><label>Scaling<input type=checkbox>");const[Ny,X3]=fa(!0),[lu,Y3]=fa("globe"),K3=()=>(()=>{var a=Z3(),h=a.firstChild,v=h.nextSibling,_=v.firstChild;_.firstChild;var k=_.nextSibling;k.firstChild;var b=v.nextSibling,T=b.firstChild,t=T.firstChild,S=t.nextSibling,D=T.nextSibling,w=D.nextSibling,E=w.firstChild,m=E.nextSibling;return a.style.setProperty("background-color","lightgrey"),a.style.setProperty("display","flex"),a.style.setProperty("flex-direction","column"),a.style.setProperty("align-items","center"),a.style.setProperty("gap","20px"),a.style.setProperty("padding","20px"),v.style.setProperty("display","flex"),v.style.setProperty("justify-content","space-around"),v.style.setProperty("width","100%"),_.style.setProperty("text-align","center"),cl(_,Gn(H3,{}),null),k.style.setProperty("text-align","center"),cl(k,Gn($3,{}),null),S.addEventListener("change",y=>{const p=y.target;Y3(p.value)}),m.addEventListener("change",y=>{const p=y.target;X3(p.checked)}),Pa(()=>S.value=lu()),Pa(()=>m.checked=Ny()),a})();var J3=bs("<div>");let dg;const[Ef,Q3]=fa(),eI=a=>(Kp(async()=>{vs.accessToken="pk.eyJ1Ijoiemltb25pdHJvbWUiLCJhIjoiY2xobW0zZGtwMWRldTNkbnVhNnk1NmIxeCJ9.oSRHcrxFqxJhaKps59a4Bw";const h=new vs.Map({container:dg,zoom:2,minZoom:0,center:[30,50],projection:{name:jp()}}),v=()=>{if(!HE())return;const _=Ef().getSource("points"),k=_._data.features;_&&(_.setData({type:"FeatureCollection",features:k.map(b=>{const T=.5*Math.pow(2,h.getZoom());return{...b,properties:{scale:T}}})}),Ef().getLayer("points")&&(Ef().removeLayer("points"),Ef().addLayer({id:"points",type:"symbol",source:"points",layout:{"icon-image":"custom-marker","icon-allow-overlap":!0,"icon-ignore-placement":!0,"icon-size":["get","scale"]}})))};h.on("load",()=>{h.loadImage("https://docs.mapbox.com/mapbox-gl-js/assets/custom_marker.png",(k,b)=>{if(k)throw k;h.addImage("custom-marker",b);const T=[];for(let t=0;t<1e3;t++){const S=Math.random()*360-180,D=Math.random()*180-90;T.push(new Df.LngLat(S,D))}h.addSource("points",{type:"geojson",data:{type:"FeatureCollection",features:T.map((t,S)=>({type:"Feature",geometry:{type:"Point",coordinates:[t.lng,t.lat]},properties:{}}))}}),h.addLayer({id:"points",type:"symbol",source:"points",layout:{"icon-image":"custom-marker","icon-allow-overlap":!0,"icon-ignore-placement":!0}}),h.setLayoutProperty("points","icon-size",["get","scale"])}),v()}),h.on("move",()=>{v()}),Q3(h)}),Of(()=>{jp(),Ef()?.setProjection({name:jp()})}),(()=>{var h=J3(),v=dg;return typeof v=="function"?kf(v,h):dg=h,h.style.setProperty("width","600px"),h.style.setProperty("height","400px"),h})());var tI=bs("<div><h1>MapboxGL Symbol Scaling Example</h1><div><div><h2>Layer Map</h2></div></div><div><label>Projection:&nbsp;<select><option value=mercator>Mercator</option><option value=globe>Globe</option></select></label><br><label>Scaling<input type=checkbox>");const[HE,rI]=fa(!0),[jp,iI]=fa("globe"),nI=()=>(()=>{var a=tI(),h=a.firstChild,v=h.nextSibling,_=v.firstChild;_.firstChild;var k=v.nextSibling,b=k.firstChild,T=b.firstChild,t=T.nextSibling,S=b.nextSibling,D=S.nextSibling,w=D.firstChild,E=w.nextSibling;return a.style.setProperty("background-color","lightgrey"),a.style.setProperty("display","flex"),a.style.setProperty("flex-direction","column"),a.style.setProperty("align-items","center"),a.style.setProperty("gap","20px"),a.style.setProperty("padding","20px"),v.style.setProperty("display","flex"),v.style.setProperty("justify-content","space-around"),v.style.setProperty("width","100%"),_.style.setProperty("text-align","center"),cl(_,Gn(eI,{}),null),t.addEventListener("change",m=>{const y=m.target;iI(y.value)}),E.addEventListener("change",m=>{const y=m.target;rI(y.checked)}),Pa(()=>t.value=jp()),Pa(()=>E.checked=HE()),a})();function Dp(a){throw new Error('Could not dynamically require "'+a+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var qE={exports:{}};(function(a,h){if((typeof v>"u"||!v)&&typeof self<"u")var v=self;(function(_){a.exports=_()})(function(){return function(){function _(k,b,T){function t(w,E){if(!b[w]){if(!k[w]){var m=typeof Dp=="function"&&Dp;if(!E&&m)return m(w,!0);if(S)return S(w,!0);var y=new Error("Cannot find module '"+w+"'");throw y.code="MODULE_NOT_FOUND",y}var p=b[w]={exports:{}};k[w][0].call(p.exports,function(C){var z=k[w][1][C];return t(z||C)},p,p.exports,_,k,b,T)}return b[w].exports}for(var S=typeof Dp=="function"&&Dp,D=0;D<T.length;D++)t(T[D]);return t}return _}()({1:[function(_,k,b){function T(t){if(Array.isArray(t))return t}k.exports=T},{}],2:[function(_,k,b){function T(t){if(Array.isArray(t)){for(var S=0,D=new Array(t.length);S<t.length;S++)D[S]=t[S];return D}}k.exports=T},{}],3:[function(_,k,b){function T(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}k.exports=T},{}],4:[function(_,k,b){function T(t,S){if(!(t instanceof S))throw new TypeError("Cannot call a class as a function")}k.exports=T},{}],5:[function(_,k,b){var T=_("./setPrototypeOf");function t(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function S(D,w,E){return t()?k.exports=S=Reflect.construct:k.exports=S=function(y,p,C){var z=[null];z.push.apply(z,p);var A=Function.bind.apply(y,z),P=new A;return C&&T(P,C.prototype),P},S.apply(null,arguments)}k.exports=S},{"./setPrototypeOf":18}],6:[function(_,k,b){function T(S,D){for(var w=0;w<D.length;w++){var E=D[w];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(S,E.key,E)}}function t(S,D,w){return D&&T(S.prototype,D),w&&T(S,w),S}k.exports=t},{}],7:[function(_,k,b){function T(t,S,D){return S in t?Object.defineProperty(t,S,{value:D,enumerable:!0,configurable:!0,writable:!0}):t[S]=D,t}k.exports=T},{}],8:[function(_,k,b){function T(){return k.exports=T=Object.assign||function(t){for(var S=1;S<arguments.length;S++){var D=arguments[S];for(var w in D)Object.prototype.hasOwnProperty.call(D,w)&&(t[w]=D[w])}return t},T.apply(this,arguments)}k.exports=T},{}],9:[function(_,k,b){function T(t){return k.exports=T=Object.setPrototypeOf?Object.getPrototypeOf:function(D){return D.__proto__||Object.getPrototypeOf(D)},T(t)}k.exports=T},{}],10:[function(_,k,b){var T=_("./setPrototypeOf");function t(S,D){if(typeof D!="function"&&D!==null)throw new TypeError("Super expression must either be null or a function");S.prototype=Object.create(D&&D.prototype,{constructor:{value:S,writable:!0,configurable:!0}}),D&&T(S,D)}k.exports=t},{"./setPrototypeOf":18}],11:[function(_,k,b){function T(t){return t&&t.__esModule?t:{default:t}}k.exports=T},{}],12:[function(_,k,b){var T=_("../helpers/typeof");function t(){if(typeof WeakMap!="function")return null;var D=new WeakMap;return t=function(){return D},D}function S(D){if(D&&D.__esModule)return D;if(D===null||T(D)!=="object"&&typeof D!="function")return{default:D};var w=t();if(w&&w.has(D))return w.get(D);var E={},m=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in D)if(Object.prototype.hasOwnProperty.call(D,y)){var p=m?Object.getOwnPropertyDescriptor(D,y):null;p&&(p.get||p.set)?Object.defineProperty(E,y,p):E[y]=D[y]}return E.default=D,w&&w.set(D,E),E}k.exports=S},{"../helpers/typeof":21}],13:[function(_,k,b){function T(t){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]")return Array.from(t)}k.exports=T},{}],14:[function(_,k,b){function T(t,S){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]"){var D=[],w=!0,E=!1,m=void 0;try{for(var y=t[Symbol.iterator](),p;!(w=(p=y.next()).done)&&(D.push(p.value),!(S&&D.length===S));w=!0);}catch(C){E=!0,m=C}finally{try{!w&&y.return!=null&&y.return()}finally{if(E)throw m}}return D}}k.exports=T},{}],15:[function(_,k,b){function T(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}k.exports=T},{}],16:[function(_,k,b){function T(){throw new TypeError("Invalid attempt to spread non-iterable instance")}k.exports=T},{}],17:[function(_,k,b){var T=_("../helpers/typeof"),t=_("./assertThisInitialized");function S(D,w){return w&&(T(w)==="object"||typeof w=="function")?w:t(D)}k.exports=S},{"../helpers/typeof":21,"./assertThisInitialized":3}],18:[function(_,k,b){function T(t,S){return k.exports=T=Object.setPrototypeOf||function(w,E){return w.__proto__=E,w},T(t,S)}k.exports=T},{}],19:[function(_,k,b){var T=_("./arrayWithHoles"),t=_("./iterableToArrayLimit"),S=_("./nonIterableRest");function D(w,E){return T(w)||t(w,E)||S()}k.exports=D},{"./arrayWithHoles":1,"./iterableToArrayLimit":14,"./nonIterableRest":15}],20:[function(_,k,b){var T=_("./arrayWithoutHoles"),t=_("./iterableToArray"),S=_("./nonIterableSpread");function D(w){return T(w)||t(w)||S()}k.exports=D},{"./arrayWithoutHoles":2,"./iterableToArray":13,"./nonIterableSpread":16}],21:[function(_,k,b){function T(S){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?T=function(w){return typeof w}:T=function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},T(S)}function t(S){return typeof Symbol=="function"&&T(Symbol.iterator)==="symbol"?k.exports=t=function(w){return T(w)}:k.exports=t=function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":T(w)},t(S)}k.exports=t},{}],22:[function(_,k,b){k.exports=_("regenerator-runtime")},{"regenerator-runtime":153}],23:[function(_,k,b){var T=_("./src/converter");function t(S,D){var w=new T(S,D);return function(E){return w.convert(E)}}t.BIN="01",t.OCT="01234567",t.DEC="0123456789",t.HEX="0123456789abcdef",k.exports=t},{"./src/converter":24}],24:[function(_,k,b){function T(t,S){if(!t||!S||!t.length||!S.length)throw new Error("Bad alphabet");this.srcAlphabet=t,this.dstAlphabet=S}T.prototype.convert=function(t){var S,D,w,E={},m=this.srcAlphabet.length,y=this.dstAlphabet.length,p=t.length,C=typeof t=="string"?"":[];if(!this.isValid(t))throw new Error('Number "'+t+'" contains of non-alphabetic digits ('+this.srcAlphabet+")");if(this.srcAlphabet===this.dstAlphabet)return t;for(S=0;S<p;S++)E[S]=this.srcAlphabet.indexOf(t[S]);do{for(D=0,w=0,S=0;S<p;S++)D=D*m+E[S],D>=y?(E[w++]=parseInt(D/y,10),D=D%y):w>0&&(E[w++]=0);p=w,C=this.dstAlphabet.slice(D,D+1).concat(C)}while(w!==0);return C},T.prototype.isValid=function(t){for(var S=0;S<t.length;++S)if(this.srcAlphabet.indexOf(t[S])===-1)return!1;return!0},k.exports=T},{}],25:[function(_,k,b){(function(T){var t=_("object-assign");/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function S(Pe,Ee){if(Pe===Ee)return 0;for(var Me=Pe.length,He=Ee.length,nt=0,ht=Math.min(Me,He);nt<ht;++nt)if(Pe[nt]!==Ee[nt]){Me=Pe[nt],He=Ee[nt];break}return Me<He?-1:He<Me?1:0}function D(Pe){return T.Buffer&&typeof T.Buffer.isBuffer=="function"?T.Buffer.isBuffer(Pe):!!(Pe!=null&&Pe._isBuffer)}var w=_("util/"),E=Object.prototype.hasOwnProperty,m=Array.prototype.slice,y=function(){return function(){}.name==="foo"}();function p(Pe){return Object.prototype.toString.call(Pe)}function C(Pe){return D(Pe)||typeof T.ArrayBuffer!="function"?!1:typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(Pe):Pe?!!(Pe instanceof DataView||Pe.buffer&&Pe.buffer instanceof ArrayBuffer):!1}var z=k.exports=Z,A=/\s*function\s+([^\(\s]*)\s*/;function P(Pe){if(w.isFunction(Pe)){if(y)return Pe.name;var Ee=Pe.toString(),Me=Ee.match(A);return Me&&Me[1]}}z.AssertionError=function(Ee){this.name="AssertionError",this.actual=Ee.actual,this.expected=Ee.expected,this.operator=Ee.operator,Ee.message?(this.message=Ee.message,this.generatedMessage=!1):(this.message=U(this),this.generatedMessage=!0);var Me=Ee.stackStartFunction||G;if(Error.captureStackTrace)Error.captureStackTrace(this,Me);else{var He=new Error;if(He.stack){var nt=He.stack,ht=P(Me),Fe=nt.indexOf(`
`+ht);if(Fe>=0){var Ce=nt.indexOf(`
`,Fe+1);nt=nt.substring(Ce+1)}this.stack=nt}}},w.inherits(z.AssertionError,Error);function x(Pe,Ee){return typeof Pe=="string"?Pe.length<Ee?Pe:Pe.slice(0,Ee):Pe}function O(Pe){if(y||!w.isFunction(Pe))return w.inspect(Pe);var Ee=P(Pe),Me=Ee?": "+Ee:"";return"[Function"+Me+"]"}function U(Pe){return x(O(Pe.actual),128)+" "+Pe.operator+" "+x(O(Pe.expected),128)}function G(Pe,Ee,Me,He,nt){throw new z.AssertionError({message:Me,actual:Pe,expected:Ee,operator:He,stackStartFunction:nt})}z.fail=G;function Z(Pe,Ee){Pe||G(Pe,!0,Ee,"==",z.ok)}z.ok=Z,z.equal=function(Ee,Me,He){Ee!=Me&&G(Ee,Me,He,"==",z.equal)},z.notEqual=function(Ee,Me,He){Ee==Me&&G(Ee,Me,He,"!=",z.notEqual)},z.deepEqual=function(Ee,Me,He){X(Ee,Me,!1)||G(Ee,Me,He,"deepEqual",z.deepEqual)},z.deepStrictEqual=function(Ee,Me,He){X(Ee,Me,!0)||G(Ee,Me,He,"deepStrictEqual",z.deepStrictEqual)};function X(Pe,Ee,Me,He){if(Pe===Ee)return!0;if(D(Pe)&&D(Ee))return S(Pe,Ee)===0;if(w.isDate(Pe)&&w.isDate(Ee))return Pe.getTime()===Ee.getTime();if(w.isRegExp(Pe)&&w.isRegExp(Ee))return Pe.source===Ee.source&&Pe.global===Ee.global&&Pe.multiline===Ee.multiline&&Pe.lastIndex===Ee.lastIndex&&Pe.ignoreCase===Ee.ignoreCase;if((Pe===null||typeof Pe!="object")&&(Ee===null||typeof Ee!="object"))return Me?Pe===Ee:Pe==Ee;if(C(Pe)&&C(Ee)&&p(Pe)===p(Ee)&&!(Pe instanceof Float32Array||Pe instanceof Float64Array))return S(new Uint8Array(Pe.buffer),new Uint8Array(Ee.buffer))===0;if(D(Pe)!==D(Ee))return!1;He=He||{actual:[],expected:[]};var nt=He.actual.indexOf(Pe);return nt!==-1&&nt===He.expected.indexOf(Ee)?!0:(He.actual.push(Pe),He.expected.push(Ee),J(Pe,Ee,Me,He))}function W(Pe){return Object.prototype.toString.call(Pe)=="[object Arguments]"}function J(Pe,Ee,Me,He){if(Pe==null||Ee===null||Ee===void 0)return!1;if(w.isPrimitive(Pe)||w.isPrimitive(Ee))return Pe===Ee;if(Me&&Object.getPrototypeOf(Pe)!==Object.getPrototypeOf(Ee))return!1;var nt=W(Pe),ht=W(Ee);if(nt&&!ht||!nt&&ht)return!1;if(nt)return Pe=m.call(Pe),Ee=m.call(Ee),X(Pe,Ee,Me);var Fe=Le(Pe),Ce=Le(Ee),Be,Ae;if(Fe.length!==Ce.length)return!1;for(Fe.sort(),Ce.sort(),Ae=Fe.length-1;Ae>=0;Ae--)if(Fe[Ae]!==Ce[Ae])return!1;for(Ae=Fe.length-1;Ae>=0;Ae--)if(Be=Fe[Ae],!X(Pe[Be],Ee[Be],Me,He))return!1;return!0}z.notDeepEqual=function(Ee,Me,He){X(Ee,Me,!1)&&G(Ee,Me,He,"notDeepEqual",z.notDeepEqual)},z.notDeepStrictEqual=re;function re(Pe,Ee,Me){X(Pe,Ee,!0)&&G(Pe,Ee,Me,"notDeepStrictEqual",re)}z.strictEqual=function(Ee,Me,He){Ee!==Me&&G(Ee,Me,He,"===",z.strictEqual)},z.notStrictEqual=function(Ee,Me,He){Ee===Me&&G(Ee,Me,He,"!==",z.notStrictEqual)};function te(Pe,Ee){if(!Pe||!Ee)return!1;if(Object.prototype.toString.call(Ee)=="[object RegExp]")return Ee.test(Pe);try{if(Pe instanceof Ee)return!0}catch{}return Error.isPrototypeOf(Ee)?!1:Ee.call({},Pe)===!0}function ye(Pe){var Ee;try{Pe()}catch(Me){Ee=Me}return Ee}function ue(Pe,Ee,Me,He){var nt;if(typeof Ee!="function")throw new TypeError('"block" argument must be a function');typeof Me=="string"&&(He=Me,Me=null),nt=ye(Ee),He=(Me&&Me.name?" ("+Me.name+").":".")+(He?" "+He:"."),Pe&&!nt&&G(nt,Me,"Missing expected exception"+He);var ht=typeof He=="string",Fe=!Pe&&w.isError(nt),Ce=!Pe&&nt&&!Me;if((Fe&&ht&&te(nt,Me)||Ce)&&G(nt,Me,"Got unwanted exception"+He),Pe&&nt&&Me&&!te(nt,Me)||!Pe&&nt)throw nt}z.throws=function(Pe,Ee,Me){ue(!0,Pe,Ee,Me)},z.doesNotThrow=function(Pe,Ee,Me){ue(!1,Pe,Ee,Me)},z.ifError=function(Pe){if(Pe)throw Pe};function Se(Pe,Ee){Pe||G(Pe,!0,Ee,"==",Se)}z.strict=t(Se,z,{equal:z.strictEqual,deepEqual:z.deepStrictEqual,notEqual:z.notStrictEqual,notDeepEqual:z.notDeepStrictEqual}),z.strict.strict=z.strict;var Le=Object.keys||function(Pe){var Ee=[];for(var Me in Pe)E.call(Pe,Me)&&Ee.push(Me);return Ee}}).call(this,typeof Hr<"u"?Hr:typeof self<"u"?self:typeof v<"u"?v:{})},{"object-assign":84,"util/":28}],26:[function(_,k,b){typeof Object.create=="function"?k.exports=function(t,S){t.super_=S,t.prototype=Object.create(S.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:k.exports=function(t,S){t.super_=S;var D=function(){};D.prototype=S.prototype,t.prototype=new D,t.prototype.constructor=t}},{}],27:[function(_,k,b){k.exports=function(t){return t&&typeof t=="object"&&typeof t.copy=="function"&&typeof t.fill=="function"&&typeof t.readUInt8=="function"}},{}],28:[function(_,k,b){(function(T,t){var S=/%[sdj%]/g;b.format=function(Ce){if(!J(Ce)){for(var Be=[],Ae=0;Ae<arguments.length;Ae++)Be.push(E(arguments[Ae]));return Be.join(" ")}for(var Ae=1,se=arguments,pe=se.length,Ke=String(Ce).replace(S,function(ke){if(ke==="%%")return"%";if(Ae>=pe)return ke;switch(ke){case"%s":return String(se[Ae++]);case"%d":return Number(se[Ae++]);case"%j":try{return JSON.stringify(se[Ae++])}catch{return"[Circular]"}default:return ke}}),_e=se[Ae];Ae<pe;_e=se[++Ae])Z(_e)||!ue(_e)?Ke+=" "+_e:Ke+=" "+E(_e);return Ke},b.deprecate=function(Ce,Be){if(te(t.process))return function(){return b.deprecate(Ce,Be).apply(this,arguments)};if(T.noDeprecation===!0)return Ce;var Ae=!1;function se(){if(!Ae){if(T.throwDeprecation)throw new Error(Be);T.traceDeprecation?console.trace(Be):console.error(Be),Ae=!0}return Ce.apply(this,arguments)}return se};var D={},w;b.debuglog=function(Ce){if(te(w)&&(w=T.env.NODE_DEBUG||""),Ce=Ce.toUpperCase(),!D[Ce])if(new RegExp("\\b"+Ce+"\\b","i").test(w)){var Be=T.pid;D[Ce]=function(){var Ae=b.format.apply(b,arguments);console.error("%s %d: %s",Ce,Be,Ae)}}else D[Ce]=function(){};return D[Ce]};function E(Ce,Be){var Ae={seen:[],stylize:y};return arguments.length>=3&&(Ae.depth=arguments[2]),arguments.length>=4&&(Ae.colors=arguments[3]),G(Be)?Ae.showHidden=Be:Be&&b._extend(Ae,Be),te(Ae.showHidden)&&(Ae.showHidden=!1),te(Ae.depth)&&(Ae.depth=2),te(Ae.colors)&&(Ae.colors=!1),te(Ae.customInspect)&&(Ae.customInspect=!0),Ae.colors&&(Ae.stylize=m),C(Ae,Ce,Ae.depth)}b.inspect=E,E.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},E.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function m(Ce,Be){var Ae=E.styles[Be];return Ae?"\x1B["+E.colors[Ae][0]+"m"+Ce+"\x1B["+E.colors[Ae][1]+"m":Ce}function y(Ce,Be){return Ce}function p(Ce){var Be={};return Ce.forEach(function(Ae,se){Be[Ae]=!0}),Be}function C(Ce,Be,Ae){if(Ce.customInspect&&Be&&Pe(Be.inspect)&&Be.inspect!==b.inspect&&!(Be.constructor&&Be.constructor.prototype===Be)){var se=Be.inspect(Ae,Ce);return J(se)||(se=C(Ce,se,Ae)),se}var pe=z(Ce,Be);if(pe)return pe;var Ke=Object.keys(Be),_e=p(Ke);if(Ce.showHidden&&(Ke=Object.getOwnPropertyNames(Be)),Le(Be)&&(Ke.indexOf("message")>=0||Ke.indexOf("description")>=0))return A(Be);if(Ke.length===0){if(Pe(Be)){var ke=Be.name?": "+Be.name:"";return Ce.stylize("[Function"+ke+"]","special")}if(ye(Be))return Ce.stylize(RegExp.prototype.toString.call(Be),"regexp");if(Se(Be))return Ce.stylize(Date.prototype.toString.call(Be),"date");if(Le(Be))return A(Be)}var qe="",tt=!1,Ge=["{","}"];if(U(Be)&&(tt=!0,Ge=["[","]"]),Pe(Be)){var We=Be.name?": "+Be.name:"";qe=" [Function"+We+"]"}if(ye(Be)&&(qe=" "+RegExp.prototype.toString.call(Be)),Se(Be)&&(qe=" "+Date.prototype.toUTCString.call(Be)),Le(Be)&&(qe=" "+A(Be)),Ke.length===0&&(!tt||Be.length==0))return Ge[0]+qe+Ge[1];if(Ae<0)return ye(Be)?Ce.stylize(RegExp.prototype.toString.call(Be),"regexp"):Ce.stylize("[Object]","special");Ce.seen.push(Be);var Je;return tt?Je=P(Ce,Be,Ae,_e,Ke):Je=Ke.map(function(it){return x(Ce,Be,Ae,_e,it,tt)}),Ce.seen.pop(),O(Je,qe,Ge)}function z(Ce,Be){if(te(Be))return Ce.stylize("undefined","undefined");if(J(Be)){var Ae="'"+JSON.stringify(Be).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return Ce.stylize(Ae,"string")}if(W(Be))return Ce.stylize(""+Be,"number");if(G(Be))return Ce.stylize(""+Be,"boolean");if(Z(Be))return Ce.stylize("null","null")}function A(Ce){return"["+Error.prototype.toString.call(Ce)+"]"}function P(Ce,Be,Ae,se,pe){for(var Ke=[],_e=0,ke=Be.length;_e<ke;++_e)Fe(Be,String(_e))?Ke.push(x(Ce,Be,Ae,se,String(_e),!0)):Ke.push("");return pe.forEach(function(qe){qe.match(/^\d+$/)||Ke.push(x(Ce,Be,Ae,se,qe,!0))}),Ke}function x(Ce,Be,Ae,se,pe,Ke){var _e,ke,qe;if(qe=Object.getOwnPropertyDescriptor(Be,pe)||{value:Be[pe]},qe.get?qe.set?ke=Ce.stylize("[Getter/Setter]","special"):ke=Ce.stylize("[Getter]","special"):qe.set&&(ke=Ce.stylize("[Setter]","special")),Fe(se,pe)||(_e="["+pe+"]"),ke||(Ce.seen.indexOf(qe.value)<0?(Z(Ae)?ke=C(Ce,qe.value,null):ke=C(Ce,qe.value,Ae-1),ke.indexOf(`
`)>-1&&(Ke?ke=ke.split(`
`).map(function(tt){return"  "+tt}).join(`
`).substr(2):ke=`
`+ke.split(`
`).map(function(tt){return"   "+tt}).join(`
`))):ke=Ce.stylize("[Circular]","special")),te(_e)){if(Ke&&pe.match(/^\d+$/))return ke;_e=JSON.stringify(""+pe),_e.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(_e=_e.substr(1,_e.length-2),_e=Ce.stylize(_e,"name")):(_e=_e.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),_e=Ce.stylize(_e,"string"))}return _e+": "+ke}function O(Ce,Be,Ae){var se=Ce.reduce(function(pe,Ke){return Ke.indexOf(`
`)>=0,pe+Ke.replace(/\u001b\[\d\d?m/g,"").length+1},0);return se>60?Ae[0]+(Be===""?"":Be+`
 `)+" "+Ce.join(`,
  `)+" "+Ae[1]:Ae[0]+Be+" "+Ce.join(", ")+" "+Ae[1]}function U(Ce){return Array.isArray(Ce)}b.isArray=U;function G(Ce){return typeof Ce=="boolean"}b.isBoolean=G;function Z(Ce){return Ce===null}b.isNull=Z;function X(Ce){return Ce==null}b.isNullOrUndefined=X;function W(Ce){return typeof Ce=="number"}b.isNumber=W;function J(Ce){return typeof Ce=="string"}b.isString=J;function re(Ce){return typeof Ce=="symbol"}b.isSymbol=re;function te(Ce){return Ce===void 0}b.isUndefined=te;function ye(Ce){return ue(Ce)&&Me(Ce)==="[object RegExp]"}b.isRegExp=ye;function ue(Ce){return typeof Ce=="object"&&Ce!==null}b.isObject=ue;function Se(Ce){return ue(Ce)&&Me(Ce)==="[object Date]"}b.isDate=Se;function Le(Ce){return ue(Ce)&&(Me(Ce)==="[object Error]"||Ce instanceof Error)}b.isError=Le;function Pe(Ce){return typeof Ce=="function"}b.isFunction=Pe;function Ee(Ce){return Ce===null||typeof Ce=="boolean"||typeof Ce=="number"||typeof Ce=="string"||typeof Ce=="symbol"||typeof Ce>"u"}b.isPrimitive=Ee,b.isBuffer=_("./support/isBuffer");function Me(Ce){return Object.prototype.toString.call(Ce)}function He(Ce){return Ce<10?"0"+Ce.toString(10):Ce.toString(10)}var nt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function ht(){var Ce=new Date,Be=[He(Ce.getHours()),He(Ce.getMinutes()),He(Ce.getSeconds())].join(":");return[Ce.getDate(),nt[Ce.getMonth()],Be].join(" ")}b.log=function(){console.log("%s - %s",ht(),b.format.apply(b,arguments))},b.inherits=_("inherits"),b._extend=function(Ce,Be){if(!Be||!ue(Be))return Ce;for(var Ae=Object.keys(Be),se=Ae.length;se--;)Ce[Ae[se]]=Be[Ae[se]];return Ce};function Fe(Ce,Be){return Object.prototype.hasOwnProperty.call(Ce,Be)}}).call(this,_("_process"),typeof Hr<"u"?Hr:typeof self<"u"?self:typeof v<"u"?v:{})},{"./support/isBuffer":27,_process:133,inherits:26}],29:[function(_,k,b){b.byteLength=y,b.toByteArray=C,b.fromByteArray=P;for(var T=[],t=[],S=typeof Uint8Array<"u"?Uint8Array:Array,D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",w=0,E=D.length;w<E;++w)T[w]=D[w],t[D.charCodeAt(w)]=w;t[45]=62,t[95]=63;function m(x){var O=x.length;if(O%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var U=x.indexOf("=");U===-1&&(U=O);var G=U===O?0:4-U%4;return[U,G]}function y(x){var O=m(x),U=O[0],G=O[1];return(U+G)*3/4-G}function p(x,O,U){return(O+U)*3/4-U}function C(x){var O,U=m(x),G=U[0],Z=U[1],X=new S(p(x,G,Z)),W=0,J=Z>0?G-4:G,re;for(re=0;re<J;re+=4)O=t[x.charCodeAt(re)]<<18|t[x.charCodeAt(re+1)]<<12|t[x.charCodeAt(re+2)]<<6|t[x.charCodeAt(re+3)],X[W++]=O>>16&255,X[W++]=O>>8&255,X[W++]=O&255;return Z===2&&(O=t[x.charCodeAt(re)]<<2|t[x.charCodeAt(re+1)]>>4,X[W++]=O&255),Z===1&&(O=t[x.charCodeAt(re)]<<10|t[x.charCodeAt(re+1)]<<4|t[x.charCodeAt(re+2)]>>2,X[W++]=O>>8&255,X[W++]=O&255),X}function z(x){return T[x>>18&63]+T[x>>12&63]+T[x>>6&63]+T[x&63]}function A(x,O,U){for(var G,Z=[],X=O;X<U;X+=3)G=(x[X]<<16&16711680)+(x[X+1]<<8&65280)+(x[X+2]&255),Z.push(z(G));return Z.join("")}function P(x){for(var O,U=x.length,G=U%3,Z=[],X=16383,W=0,J=U-G;W<J;W+=X)Z.push(A(x,W,W+X>J?J:W+X));return G===1?(O=x[U-1],Z.push(T[O>>2]+T[O<<4&63]+"==")):G===2&&(O=(x[U-2]<<8)+x[U-1],Z.push(T[O>>10]+T[O>>4&63]+T[O<<2&63]+"=")),Z.join("")}},{}],30:[function(_,k,b){var T=_("./lib/encoder"),t=_("./lib/decoder");k.exports={encode:T,decode:t}},{"./lib/decoder":31,"./lib/encoder":32}],31:[function(_,k,b){(function(T){function t(S,D){if(this.pos=0,this.buffer=S,this.is_with_alpha=!!D,this.bottom_up=!0,this.flag=this.buffer.toString("utf-8",0,this.pos+=2),this.flag!="BM")throw new Error("Invalid BMP File");this.parseHeader(),this.parseRGBA()}t.prototype.parseHeader=function(){if(this.fileSize=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.reserved=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.offset=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.headerSize=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.width=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.height=this.buffer.readInt32LE(this.pos),this.pos+=4,this.planes=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.bitPP=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.compress=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.rawSize=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.hr=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.vr=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.colors=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.importantColors=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var S=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(S);for(var D=0;D<S;D++){var w=this.buffer.readUInt8(this.pos++),E=this.buffer.readUInt8(this.pos++),m=this.buffer.readUInt8(this.pos++),y=this.buffer.readUInt8(this.pos++);this.palette[D]={red:m,green:E,blue:w,quad:y}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},t.prototype.parseRGBA=function(){var S="bit"+this.bitPP,D=this.width*this.height*4;this.data=new T(D),this[S]()},t.prototype.bit1=function(){for(var S=Math.ceil(this.width/8),D=S%4,w=this.height>=0?this.height-1:-this.height,w=this.height-1;w>=0;w--){for(var E=this.bottom_up?w:this.height-1-w,m=0;m<S;m++)for(var y=this.buffer.readUInt8(this.pos++),p=E*this.width*4+m*8*4,C=0;C<8&&m*8+C<this.width;C++){var z=this.palette[y>>7-C&1];this.data[p+C*4]=0,this.data[p+C*4+1]=z.blue,this.data[p+C*4+2]=z.green,this.data[p+C*4+3]=z.red}D!=0&&(this.pos+=4-D)}},t.prototype.bit4=function(){if(this.compress==2){let Z=function(X){var W=this.palette[X];this.data[S]=0,this.data[S+1]=W.blue,this.data[S+2]=W.green,this.data[S+3]=W.red,S+=4};this.data.fill(255);for(var S=0,D=this.bottom_up?this.height-1:0,w=!1;S<this.data.length;){var E=this.buffer.readUInt8(this.pos++),m=this.buffer.readUInt8(this.pos++);if(E==0)if(m==0){this.bottom_up?D--:D++,S=D*this.width*4,w=!1;continue}else{if(m==1)break;if(m==2){var y=this.buffer.readUInt8(this.pos++),p=this.buffer.readUInt8(this.pos++);this.bottom_up?D-=p:D+=p,S+=p*this.width*4+y*4}else{for(var C=this.buffer.readUInt8(this.pos++),z=0;z<m;z++)w?Z.call(this,C&15):Z.call(this,(C&240)>>4),z&1&&z+1<m&&(C=this.buffer.readUInt8(this.pos++)),w=!w;(m+1>>1&1)==1&&this.pos++}}else for(var z=0;z<E;z++)w?Z.call(this,m&15):Z.call(this,(m&240)>>4),w=!w}}else for(var A=Math.ceil(this.width/2),P=A%4,p=this.height-1;p>=0;p--){for(var x=this.bottom_up?p:this.height-1-p,y=0;y<A;y++){var m=this.buffer.readUInt8(this.pos++),S=x*this.width*4+y*2*4,O=m>>4,U=m&15,G=this.palette[O];if(this.data[S]=0,this.data[S+1]=G.blue,this.data[S+2]=G.green,this.data[S+3]=G.red,y*2+1>=this.width)break;G=this.palette[U],this.data[S+4]=0,this.data[S+4+1]=G.blue,this.data[S+4+2]=G.green,this.data[S+4+3]=G.red}P!=0&&(this.pos+=4-P)}},t.prototype.bit8=function(){if(this.compress==1){let x=function(O){var U=this.palette[O];this.data[S]=0,this.data[S+1]=U.blue,this.data[S+2]=U.green,this.data[S+3]=U.red,S+=4};this.data.fill(255);for(var S=0,D=this.bottom_up?this.height-1:0;S<this.data.length;){var w=this.buffer.readUInt8(this.pos++),E=this.buffer.readUInt8(this.pos++);if(w==0)if(E==0){this.bottom_up?D--:D++,S=D*this.width*4;continue}else{if(E==1)break;if(E==2){var m=this.buffer.readUInt8(this.pos++),y=this.buffer.readUInt8(this.pos++);this.bottom_up?D-=y:D+=y,S+=y*this.width*4+m*4}else{for(var p=0;p<E;p++){var C=this.buffer.readUInt8(this.pos++);x.call(this,C)}E&!0&&this.pos++}}else for(var p=0;p<w;p++)x.call(this,E)}}else for(var z=this.width%4,y=this.height-1;y>=0;y--){for(var A=this.bottom_up?y:this.height-1-y,m=0;m<this.width;m++){var E=this.buffer.readUInt8(this.pos++),S=A*this.width*4+m*4;if(E<this.palette.length){var P=this.palette[E];this.data[S]=0,this.data[S+1]=P.blue,this.data[S+2]=P.green,this.data[S+3]=P.red}else this.data[S]=0,this.data[S+1]=255,this.data[S+2]=255,this.data[S+3]=255}z!=0&&(this.pos+=4-z)}},t.prototype.bit15=function(){for(var S=this.width%3,D=parseInt("11111",2),w=D,E=this.height-1;E>=0;E--){for(var m=this.bottom_up?E:this.height-1-E,y=0;y<this.width;y++){var p=this.buffer.readUInt16LE(this.pos);this.pos+=2;var C=(p&w)/w*255|0,z=(p>>5&w)/w*255|0,A=(p>>10&w)/w*255|0,P=p>>15?255:0,x=m*this.width*4+y*4;this.data[x]=P,this.data[x+1]=C,this.data[x+2]=z,this.data[x+3]=A}this.pos+=S}},t.prototype.bit16=function(){var S=this.width%2*2;this.maskRed=31744,this.maskGreen=992,this.maskBlue=31,this.mask0=0,this.compress==3&&(this.maskRed=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.maskGreen=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.maskBlue=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.mask0=this.buffer.readUInt32LE(this.pos),this.pos+=4);for(var D=[0,0,0],w=0;w<16;w++)this.maskRed>>w&1&&D[0]++,this.maskGreen>>w&1&&D[1]++,this.maskBlue>>w&1&&D[2]++;D[1]+=D[0],D[2]+=D[1],D[0]=8-D[0],D[1]-=8,D[2]-=8;for(var E=this.height-1;E>=0;E--){for(var m=this.bottom_up?E:this.height-1-E,y=0;y<this.width;y++){var p=this.buffer.readUInt16LE(this.pos);this.pos+=2;var C=(p&this.maskBlue)<<D[0],z=(p&this.maskGreen)>>D[1],A=(p&this.maskRed)>>D[2],P=m*this.width*4+y*4;this.data[P]=0,this.data[P+1]=C,this.data[P+2]=z,this.data[P+3]=A}this.pos+=S}},t.prototype.bit24=function(){for(var S=this.height-1;S>=0;S--){for(var D=this.bottom_up?S:this.height-1-S,w=0;w<this.width;w++){var E=this.buffer.readUInt8(this.pos++),m=this.buffer.readUInt8(this.pos++),y=this.buffer.readUInt8(this.pos++),p=D*this.width*4+w*4;this.data[p]=0,this.data[p+1]=E,this.data[p+2]=m,this.data[p+3]=y}this.pos+=this.width%4}},t.prototype.bit32=function(){if(this.compress==3){this.maskRed=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.maskGreen=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.maskBlue=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.mask0=this.buffer.readUInt32LE(this.pos),this.pos+=4;for(var S=this.height-1;S>=0;S--)for(var D=this.bottom_up?S:this.height-1-S,w=0;w<this.width;w++){var E=this.buffer.readUInt8(this.pos++),m=this.buffer.readUInt8(this.pos++),y=this.buffer.readUInt8(this.pos++),p=this.buffer.readUInt8(this.pos++),C=D*this.width*4+w*4;this.data[C]=E,this.data[C+1]=m,this.data[C+2]=y,this.data[C+3]=p}}else for(var S=this.height-1;S>=0;S--)for(var D=this.bottom_up?S:this.height-1-S,w=0;w<this.width;w++){var m=this.buffer.readUInt8(this.pos++),y=this.buffer.readUInt8(this.pos++),p=this.buffer.readUInt8(this.pos++),E=this.buffer.readUInt8(this.pos++),C=D*this.width*4+w*4;this.data[C]=E,this.data[C+1]=m,this.data[C+2]=y,this.data[C+3]=p}},t.prototype.getData=function(){return this.data},k.exports=function(S){var D=new t(S);return D}}).call(this,_("buffer").Buffer)},{buffer:48}],32:[function(_,k,b){(function(T){function t(S){this.buffer=S.data,this.width=S.width,this.height=S.height,this.extraBytes=this.width%4,this.rgbSize=this.height*(3*this.width+this.extraBytes),this.headerInfoSize=40,this.data=[],this.flag="BM",this.reserved=0,this.offset=54,this.fileSize=this.rgbSize+this.offset,this.planes=1,this.bitPP=24,this.compress=0,this.hr=0,this.vr=0,this.colors=0,this.importantColors=0}t.prototype.encode=function(){var S=new T(this.offset+this.rgbSize);this.pos=0,S.write(this.flag,this.pos,2),this.pos+=2,S.writeUInt32LE(this.fileSize,this.pos),this.pos+=4,S.writeUInt32LE(this.reserved,this.pos),this.pos+=4,S.writeUInt32LE(this.offset,this.pos),this.pos+=4,S.writeUInt32LE(this.headerInfoSize,this.pos),this.pos+=4,S.writeUInt32LE(this.width,this.pos),this.pos+=4,S.writeInt32LE(-this.height,this.pos),this.pos+=4,S.writeUInt16LE(this.planes,this.pos),this.pos+=2,S.writeUInt16LE(this.bitPP,this.pos),this.pos+=2,S.writeUInt32LE(this.compress,this.pos),this.pos+=4,S.writeUInt32LE(this.rgbSize,this.pos),this.pos+=4,S.writeUInt32LE(this.hr,this.pos),this.pos+=4,S.writeUInt32LE(this.vr,this.pos),this.pos+=4,S.writeUInt32LE(this.colors,this.pos),this.pos+=4,S.writeUInt32LE(this.importantColors,this.pos),this.pos+=4;for(var D=0,w=3*this.width+this.extraBytes,E=0;E<this.height;E++){for(var m=0;m<this.width;m++){var y=this.pos+E*w+m*3;D++,S[y]=this.buffer[D++],S[y+1]=this.buffer[D++],S[y+2]=this.buffer[D++]}if(this.extraBytes>0){var p=this.pos+E*w+this.width*3;S.fill(0,p,p+this.extraBytes)}}return S},k.exports=function(S,D){var w=new t(S),E=w.encode();return{data:E,width:S.width,height:S.height}}}).call(this,_("buffer").Buffer)},{buffer:48}],33:[function(_,k,b){},{}],34:[function(_,k,b){(function(T,t){var S=_("assert"),D=_("pako/lib/zlib/zstream"),w=_("pako/lib/zlib/deflate.js"),E=_("pako/lib/zlib/inflate.js"),m=_("pako/lib/zlib/constants");for(var y in m)b[y]=m[y];b.NONE=0,b.DEFLATE=1,b.INFLATE=2,b.GZIP=3,b.GUNZIP=4,b.DEFLATERAW=5,b.INFLATERAW=6,b.UNZIP=7;var p=31,C=139;function z(A){if(typeof A!="number"||A<b.DEFLATE||A>b.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=A,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}z.prototype.close=function(){if(this.write_in_progress){this.pending_close=!0;return}this.pending_close=!1,S(this.init_done,"close before init"),S(this.mode<=b.UNZIP),this.mode===b.DEFLATE||this.mode===b.GZIP||this.mode===b.DEFLATERAW?w.deflateEnd(this.strm):(this.mode===b.INFLATE||this.mode===b.GUNZIP||this.mode===b.INFLATERAW||this.mode===b.UNZIP)&&E.inflateEnd(this.strm),this.mode=b.NONE,this.dictionary=null},z.prototype.write=function(A,P,x,O,U,G,Z){return this._write(!0,A,P,x,O,U,G,Z)},z.prototype.writeSync=function(A,P,x,O,U,G,Z){return this._write(!1,A,P,x,O,U,G,Z)},z.prototype._write=function(A,P,x,O,U,G,Z,X){if(S.equal(arguments.length,8),S(this.init_done,"write before init"),S(this.mode!==b.NONE,"already finalized"),S.equal(!1,this.write_in_progress,"write already in progress"),S.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,S.equal(!1,P===void 0,"must provide flush value"),this.write_in_progress=!0,P!==b.Z_NO_FLUSH&&P!==b.Z_PARTIAL_FLUSH&&P!==b.Z_SYNC_FLUSH&&P!==b.Z_FULL_FLUSH&&P!==b.Z_FINISH&&P!==b.Z_BLOCK)throw new Error("Invalid flush value");if(x==null&&(x=t.alloc(0),U=0,O=0),this.strm.avail_in=U,this.strm.input=x,this.strm.next_in=O,this.strm.avail_out=X,this.strm.output=G,this.strm.next_out=Z,this.flush=P,!A)return this._process(),this._checkError()?this._afterSync():void 0;var W=this;return T.nextTick(function(){W._process(),W._after()}),this},z.prototype._afterSync=function(){var A=this.strm.avail_out,P=this.strm.avail_in;return this.write_in_progress=!1,[P,A]},z.prototype._process=function(){var A=null;switch(this.mode){case b.DEFLATE:case b.GZIP:case b.DEFLATERAW:this.err=w.deflate(this.strm,this.flush);break;case b.UNZIP:switch(this.strm.avail_in>0&&(A=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(A===null)break;if(this.strm.input[A]===p){if(this.gzip_id_bytes_read=1,A++,this.strm.avail_in===1)break}else{this.mode=b.INFLATE;break}case 1:if(A===null)break;this.strm.input[A]===C?(this.gzip_id_bytes_read=2,this.mode=b.GUNZIP):this.mode=b.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case b.INFLATE:case b.GUNZIP:case b.INFLATERAW:for(this.err=E.inflate(this.strm,this.flush),this.err===b.Z_NEED_DICT&&this.dictionary&&(this.err=E.inflateSetDictionary(this.strm,this.dictionary),this.err===b.Z_OK?this.err=E.inflate(this.strm,this.flush):this.err===b.Z_DATA_ERROR&&(this.err=b.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===b.GUNZIP&&this.err===b.Z_STREAM_END&&this.strm.next_in[0]!==0;)this.reset(),this.err=E.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},z.prototype._checkError=function(){switch(this.err){case b.Z_OK:case b.Z_BUF_ERROR:if(this.strm.avail_out!==0&&this.flush===b.Z_FINISH)return this._error("unexpected end of file"),!1;break;case b.Z_STREAM_END:break;case b.Z_NEED_DICT:return this.dictionary==null?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},z.prototype._after=function(){if(this._checkError()){var A=this.strm.avail_out,P=this.strm.avail_in;this.write_in_progress=!1,this.callback(P,A),this.pending_close&&this.close()}},z.prototype._error=function(A){this.strm.msg&&(A=this.strm.msg),this.onerror(A,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},z.prototype.init=function(A,P,x,O,U){S(arguments.length===4||arguments.length===5,"init(windowBits, level, memLevel, strategy, [dictionary])"),S(A>=8&&A<=15,"invalid windowBits"),S(P>=-1&&P<=9,"invalid compression level"),S(x>=1&&x<=9,"invalid memlevel"),S(O===b.Z_FILTERED||O===b.Z_HUFFMAN_ONLY||O===b.Z_RLE||O===b.Z_FIXED||O===b.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(P,A,x,O,U),this._setDictionary()},z.prototype.params=function(){throw new Error("deflateParams Not supported")},z.prototype.reset=function(){this._reset(),this._setDictionary()},z.prototype._init=function(A,P,x,O,U){switch(this.level=A,this.windowBits=P,this.memLevel=x,this.strategy=O,this.flush=b.Z_NO_FLUSH,this.err=b.Z_OK,(this.mode===b.GZIP||this.mode===b.GUNZIP)&&(this.windowBits+=16),this.mode===b.UNZIP&&(this.windowBits+=32),(this.mode===b.DEFLATERAW||this.mode===b.INFLATERAW)&&(this.windowBits=-1*this.windowBits),this.strm=new D,this.mode){case b.DEFLATE:case b.GZIP:case b.DEFLATERAW:this.err=w.deflateInit2(this.strm,this.level,b.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case b.INFLATE:case b.GUNZIP:case b.INFLATERAW:case b.UNZIP:this.err=E.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==b.Z_OK&&this._error("Init error"),this.dictionary=U,this.write_in_progress=!1,this.init_done=!0},z.prototype._setDictionary=function(){if(this.dictionary!=null){switch(this.err=b.Z_OK,this.mode){case b.DEFLATE:case b.DEFLATERAW:this.err=w.deflateSetDictionary(this.strm,this.dictionary);break}this.err!==b.Z_OK&&this._error("Failed to set dictionary")}},z.prototype._reset=function(){switch(this.err=b.Z_OK,this.mode){case b.DEFLATE:case b.DEFLATERAW:case b.GZIP:this.err=w.deflateReset(this.strm);break;case b.INFLATE:case b.INFLATERAW:case b.GUNZIP:this.err=E.inflateReset(this.strm);break}this.err!==b.Z_OK&&this._error("Failed to reset stream")},b.Zlib=z}).call(this,_("_process"),_("buffer").Buffer)},{_process:133,assert:25,buffer:48,"pako/lib/zlib/constants":38,"pako/lib/zlib/deflate.js":40,"pako/lib/zlib/inflate.js":42,"pako/lib/zlib/zstream":46}],35:[function(_,k,b){(function(T){var t=_("buffer").Buffer,S=_("stream").Transform,D=_("./binding"),w=_("util"),E=_("assert").ok,m=_("buffer").kMaxLength,y="Cannot create final Buffer. It would be larger than 0x"+m.toString(16)+" bytes";D.Z_MIN_WINDOWBITS=8,D.Z_MAX_WINDOWBITS=15,D.Z_DEFAULT_WINDOWBITS=15,D.Z_MIN_CHUNK=64,D.Z_MAX_CHUNK=1/0,D.Z_DEFAULT_CHUNK=16*1024,D.Z_MIN_MEMLEVEL=1,D.Z_MAX_MEMLEVEL=9,D.Z_DEFAULT_MEMLEVEL=8,D.Z_MIN_LEVEL=-1,D.Z_MAX_LEVEL=9,D.Z_DEFAULT_LEVEL=D.Z_DEFAULT_COMPRESSION;for(var p=Object.keys(D),C=0;C<p.length;C++){var z=p[C];z.match(/^Z/)&&Object.defineProperty(b,z,{enumerable:!0,value:D[z],writable:!1})}for(var A={Z_OK:D.Z_OK,Z_STREAM_END:D.Z_STREAM_END,Z_NEED_DICT:D.Z_NEED_DICT,Z_ERRNO:D.Z_ERRNO,Z_STREAM_ERROR:D.Z_STREAM_ERROR,Z_DATA_ERROR:D.Z_DATA_ERROR,Z_MEM_ERROR:D.Z_MEM_ERROR,Z_BUF_ERROR:D.Z_BUF_ERROR,Z_VERSION_ERROR:D.Z_VERSION_ERROR},P=Object.keys(A),x=0;x<P.length;x++){var O=P[x];A[A[O]]=O}Object.defineProperty(b,"codes",{enumerable:!0,value:Object.freeze(A),writable:!1}),b.Deflate=Z,b.Inflate=X,b.Gzip=W,b.Gunzip=J,b.DeflateRaw=re,b.InflateRaw=te,b.Unzip=ye,b.createDeflate=function(Ee){return new Z(Ee)},b.createInflate=function(Ee){return new X(Ee)},b.createDeflateRaw=function(Ee){return new re(Ee)},b.createInflateRaw=function(Ee){return new te(Ee)},b.createGzip=function(Ee){return new W(Ee)},b.createGunzip=function(Ee){return new J(Ee)},b.createUnzip=function(Ee){return new ye(Ee)},b.deflate=function(Ee,Me,He){return typeof Me=="function"&&(He=Me,Me={}),U(new Z(Me),Ee,He)},b.deflateSync=function(Ee,Me){return G(new Z(Me),Ee)},b.gzip=function(Ee,Me,He){return typeof Me=="function"&&(He=Me,Me={}),U(new W(Me),Ee,He)},b.gzipSync=function(Ee,Me){return G(new W(Me),Ee)},b.deflateRaw=function(Ee,Me,He){return typeof Me=="function"&&(He=Me,Me={}),U(new re(Me),Ee,He)},b.deflateRawSync=function(Ee,Me){return G(new re(Me),Ee)},b.unzip=function(Ee,Me,He){return typeof Me=="function"&&(He=Me,Me={}),U(new ye(Me),Ee,He)},b.unzipSync=function(Ee,Me){return G(new ye(Me),Ee)},b.inflate=function(Ee,Me,He){return typeof Me=="function"&&(He=Me,Me={}),U(new X(Me),Ee,He)},b.inflateSync=function(Ee,Me){return G(new X(Me),Ee)},b.gunzip=function(Ee,Me,He){return typeof Me=="function"&&(He=Me,Me={}),U(new J(Me),Ee,He)},b.gunzipSync=function(Ee,Me){return G(new J(Me),Ee)},b.inflateRaw=function(Ee,Me,He){return typeof Me=="function"&&(He=Me,Me={}),U(new te(Me),Ee,He)},b.inflateRawSync=function(Ee,Me){return G(new te(Me),Ee)};function U(Ee,Me,He){var nt=[],ht=0;Ee.on("error",Ce),Ee.on("end",Be),Ee.end(Me),Fe();function Fe(){for(var Ae;(Ae=Ee.read())!==null;)nt.push(Ae),ht+=Ae.length;Ee.once("readable",Fe)}function Ce(Ae){Ee.removeListener("end",Be),Ee.removeListener("readable",Fe),He(Ae)}function Be(){var Ae,se=null;ht>=m?se=new RangeError(y):Ae=t.concat(nt,ht),nt=[],Ee.close(),He(se,Ae)}}function G(Ee,Me){if(typeof Me=="string"&&(Me=t.from(Me)),!t.isBuffer(Me))throw new TypeError("Not a string or buffer");var He=Ee._finishFlushFlag;return Ee._processChunk(Me,He)}function Z(Ee){if(!(this instanceof Z))return new Z(Ee);Se.call(this,Ee,D.DEFLATE)}function X(Ee){if(!(this instanceof X))return new X(Ee);Se.call(this,Ee,D.INFLATE)}function W(Ee){if(!(this instanceof W))return new W(Ee);Se.call(this,Ee,D.GZIP)}function J(Ee){if(!(this instanceof J))return new J(Ee);Se.call(this,Ee,D.GUNZIP)}function re(Ee){if(!(this instanceof re))return new re(Ee);Se.call(this,Ee,D.DEFLATERAW)}function te(Ee){if(!(this instanceof te))return new te(Ee);Se.call(this,Ee,D.INFLATERAW)}function ye(Ee){if(!(this instanceof ye))return new ye(Ee);Se.call(this,Ee,D.UNZIP)}function ue(Ee){return Ee===D.Z_NO_FLUSH||Ee===D.Z_PARTIAL_FLUSH||Ee===D.Z_SYNC_FLUSH||Ee===D.Z_FULL_FLUSH||Ee===D.Z_FINISH||Ee===D.Z_BLOCK}function Se(Ee,Me){var He=this;if(this._opts=Ee=Ee||{},this._chunkSize=Ee.chunkSize||b.Z_DEFAULT_CHUNK,S.call(this,Ee),Ee.flush&&!ue(Ee.flush))throw new Error("Invalid flush flag: "+Ee.flush);if(Ee.finishFlush&&!ue(Ee.finishFlush))throw new Error("Invalid flush flag: "+Ee.finishFlush);if(this._flushFlag=Ee.flush||D.Z_NO_FLUSH,this._finishFlushFlag=typeof Ee.finishFlush<"u"?Ee.finishFlush:D.Z_FINISH,Ee.chunkSize&&(Ee.chunkSize<b.Z_MIN_CHUNK||Ee.chunkSize>b.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+Ee.chunkSize);if(Ee.windowBits&&(Ee.windowBits<b.Z_MIN_WINDOWBITS||Ee.windowBits>b.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+Ee.windowBits);if(Ee.level&&(Ee.level<b.Z_MIN_LEVEL||Ee.level>b.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+Ee.level);if(Ee.memLevel&&(Ee.memLevel<b.Z_MIN_MEMLEVEL||Ee.memLevel>b.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+Ee.memLevel);if(Ee.strategy&&Ee.strategy!=b.Z_FILTERED&&Ee.strategy!=b.Z_HUFFMAN_ONLY&&Ee.strategy!=b.Z_RLE&&Ee.strategy!=b.Z_FIXED&&Ee.strategy!=b.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+Ee.strategy);if(Ee.dictionary&&!t.isBuffer(Ee.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new D.Zlib(Me);var nt=this;this._hadError=!1,this._handle.onerror=function(Ce,Be){Le(nt),nt._hadError=!0;var Ae=new Error(Ce);Ae.errno=Be,Ae.code=b.codes[Be],nt.emit("error",Ae)};var ht=b.Z_DEFAULT_COMPRESSION;typeof Ee.level=="number"&&(ht=Ee.level);var Fe=b.Z_DEFAULT_STRATEGY;typeof Ee.strategy=="number"&&(Fe=Ee.strategy),this._handle.init(Ee.windowBits||b.Z_DEFAULT_WINDOWBITS,ht,Ee.memLevel||b.Z_DEFAULT_MEMLEVEL,Fe,Ee.dictionary),this._buffer=t.allocUnsafe(this._chunkSize),this._offset=0,this._level=ht,this._strategy=Fe,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!He._handle},configurable:!0,enumerable:!0})}w.inherits(Se,S),Se.prototype.params=function(Ee,Me,He){if(Ee<b.Z_MIN_LEVEL||Ee>b.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+Ee);if(Me!=b.Z_FILTERED&&Me!=b.Z_HUFFMAN_ONLY&&Me!=b.Z_RLE&&Me!=b.Z_FIXED&&Me!=b.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+Me);if(this._level!==Ee||this._strategy!==Me){var nt=this;this.flush(D.Z_SYNC_FLUSH,function(){E(nt._handle,"zlib binding closed"),nt._handle.params(Ee,Me),nt._hadError||(nt._level=Ee,nt._strategy=Me,He&&He())})}else T.nextTick(He)},Se.prototype.reset=function(){return E(this._handle,"zlib binding closed"),this._handle.reset()},Se.prototype._flush=function(Ee){this._transform(t.alloc(0),"",Ee)},Se.prototype.flush=function(Ee,Me){var He=this,nt=this._writableState;(typeof Ee=="function"||Ee===void 0&&!Me)&&(Me=Ee,Ee=D.Z_FULL_FLUSH),nt.ended?Me&&T.nextTick(Me):nt.ending?Me&&this.once("end",Me):nt.needDrain?Me&&this.once("drain",function(){return He.flush(Ee,Me)}):(this._flushFlag=Ee,this.write(t.alloc(0),"",Me))},Se.prototype.close=function(Ee){Le(this,Ee),T.nextTick(Pe,this)};function Le(Ee,Me){Me&&T.nextTick(Me),Ee._handle&&(Ee._handle.close(),Ee._handle=null)}function Pe(Ee){Ee.emit("close")}Se.prototype._transform=function(Ee,Me,He){var nt,ht=this._writableState,Fe=ht.ending||ht.ended,Ce=Fe&&(!Ee||ht.length===Ee.length);if(Ee!==null&&!t.isBuffer(Ee))return He(new Error("invalid input"));if(!this._handle)return He(new Error("zlib binding closed"));Ce?nt=this._finishFlushFlag:(nt=this._flushFlag,Ee.length>=ht.length&&(this._flushFlag=this._opts.flush||D.Z_NO_FLUSH)),this._processChunk(Ee,nt,He)},Se.prototype._processChunk=function(Ee,Me,He){var nt=Ee&&Ee.length,ht=this._chunkSize-this._offset,Fe=0,Ce=this,Be=typeof He=="function";if(!Be){var Ae=[],se=0,pe;this.on("error",function(tt){pe=tt}),E(this._handle,"zlib binding closed");do var Ke=this._handle.writeSync(Me,Ee,Fe,nt,this._buffer,this._offset,ht);while(!this._hadError&&qe(Ke[0],Ke[1]));if(this._hadError)throw pe;if(se>=m)throw Le(this),new RangeError(y);var _e=t.concat(Ae,se);return Le(this),_e}E(this._handle,"zlib binding closed");var ke=this._handle.write(Me,Ee,Fe,nt,this._buffer,this._offset,ht);ke.buffer=Ee,ke.callback=qe;function qe(tt,Ge){if(this&&(this.buffer=null,this.callback=null),!Ce._hadError){var We=ht-Ge;if(E(We>=0,"have should not go down"),We>0){var Je=Ce._buffer.slice(Ce._offset,Ce._offset+We);Ce._offset+=We,Be?Ce.push(Je):(Ae.push(Je),se+=Je.length)}if((Ge===0||Ce._offset>=Ce._chunkSize)&&(ht=Ce._chunkSize,Ce._offset=0,Ce._buffer=t.allocUnsafe(Ce._chunkSize)),Ge===0){if(Fe+=nt-tt,nt=tt,!Be)return!0;var it=Ce._handle.write(Me,Ee,Fe,nt,Ce._buffer,Ce._offset,Ce._chunkSize);it.callback=qe,it.buffer=Ee;return}if(!Be)return!1;He()}}},w.inherits(Z,Se),w.inherits(X,Se),w.inherits(W,Se),w.inherits(J,Se),w.inherits(re,Se),w.inherits(te,Se),w.inherits(ye,Se)}).call(this,_("_process"))},{"./binding":34,_process:133,assert:25,buffer:48,stream:155,util:186}],36:[function(_,k,b){var T=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function t(w,E){return Object.prototype.hasOwnProperty.call(w,E)}b.assign=function(w){for(var E=Array.prototype.slice.call(arguments,1);E.length;){var m=E.shift();if(m){if(typeof m!="object")throw new TypeError(m+"must be non-object");for(var y in m)t(m,y)&&(w[y]=m[y])}}return w},b.shrinkBuf=function(w,E){return w.length===E?w:w.subarray?w.subarray(0,E):(w.length=E,w)};var S={arraySet:function(w,E,m,y,p){if(E.subarray&&w.subarray){w.set(E.subarray(m,m+y),p);return}for(var C=0;C<y;C++)w[p+C]=E[m+C]},flattenChunks:function(w){var E,m,y,p,C,z;for(y=0,E=0,m=w.length;E<m;E++)y+=w[E].length;for(z=new Uint8Array(y),p=0,E=0,m=w.length;E<m;E++)C=w[E],z.set(C,p),p+=C.length;return z}},D={arraySet:function(w,E,m,y,p){for(var C=0;C<y;C++)w[p+C]=E[m+C]},flattenChunks:function(w){return[].concat.apply([],w)}};b.setTyped=function(w){w?(b.Buf8=Uint8Array,b.Buf16=Uint16Array,b.Buf32=Int32Array,b.assign(b,S)):(b.Buf8=Array,b.Buf16=Array,b.Buf32=Array,b.assign(b,D))},b.setTyped(T)},{}],37:[function(_,k,b){function T(t,S,D,w){for(var E=t&65535|0,m=t>>>16&65535|0,y=0;D!==0;){y=D>2e3?2e3:D,D-=y;do E=E+S[w++]|0,m=m+E|0;while(--y);E%=65521,m%=65521}return E|m<<16|0}k.exports=T},{}],38:[function(_,k,b){k.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],39:[function(_,k,b){function T(){for(var D,w=[],E=0;E<256;E++){D=E;for(var m=0;m<8;m++)D=D&1?3988292384^D>>>1:D>>>1;w[E]=D}return w}var t=T();function S(D,w,E,m){var y=t,p=m+E;D^=-1;for(var C=m;C<p;C++)D=D>>>8^y[(D^w[C])&255];return D^-1}k.exports=S},{}],40:[function(_,k,b){var T=_("../utils/common"),t=_("./trees"),S=_("./adler32"),D=_("./crc32"),w=_("./messages"),E=0,m=1,y=3,p=4,C=5,z=0,A=1,P=-2,x=-3,O=-5,U=-1,G=1,Z=2,X=3,W=4,J=0,re=2,te=8,ye=9,ue=15,Se=8,Le=29,Pe=256,Ee=Pe+1+Le,Me=30,He=19,nt=2*Ee+1,ht=15,Fe=3,Ce=258,Be=Ce+Fe+1,Ae=32,se=42,pe=69,Ke=73,_e=91,ke=103,qe=113,tt=666,Ge=1,We=2,Je=3,it=4,ze=3;function de(ee,Qe){return ee.msg=w[Qe],Qe}function ve(ee){return(ee<<1)-(ee>4?9:0)}function be(ee){for(var Qe=ee.length;--Qe>=0;)ee[Qe]=0}function Oe(ee){var Qe=ee.state,ie=Qe.pending;ie>ee.avail_out&&(ie=ee.avail_out),ie!==0&&(T.arraySet(ee.output,Qe.pending_buf,Qe.pending_out,ie,ee.next_out),ee.next_out+=ie,Qe.pending_out+=ie,ee.total_out+=ie,ee.avail_out-=ie,Qe.pending-=ie,Qe.pending===0&&(Qe.pending_out=0))}function ge(ee,Qe){t._tr_flush_block(ee,ee.block_start>=0?ee.block_start:-1,ee.strstart-ee.block_start,Qe),ee.block_start=ee.strstart,Oe(ee.strm)}function le(ee,Qe){ee.pending_buf[ee.pending++]=Qe}function et(ee,Qe){ee.pending_buf[ee.pending++]=Qe>>>8&255,ee.pending_buf[ee.pending++]=Qe&255}function wt(ee,Qe,ie,B){var Q=ee.avail_in;return Q>B&&(Q=B),Q===0?0:(ee.avail_in-=Q,T.arraySet(Qe,ee.input,ee.next_in,Q,ie),ee.state.wrap===1?ee.adler=S(ee.adler,Qe,Q,ie):ee.state.wrap===2&&(ee.adler=D(ee.adler,Qe,Q,ie)),ee.next_in+=Q,ee.total_in+=Q,Q)}function Ft(ee,Qe){var ie=ee.max_chain_length,B=ee.strstart,Q,xe,Ne=ee.prev_length,Ze=ee.nice_match,ot=ee.strstart>ee.w_size-Be?ee.strstart-(ee.w_size-Be):0,mt=ee.window,Nt=ee.w_mask,Bt=ee.prev,Lt=ee.strstart+Ce,Yt=mt[B+Ne-1],cr=mt[B+Ne];ee.prev_length>=ee.good_match&&(ie>>=2),Ze>ee.lookahead&&(Ze=ee.lookahead);do if(Q=Qe,!(mt[Q+Ne]!==cr||mt[Q+Ne-1]!==Yt||mt[Q]!==mt[B]||mt[++Q]!==mt[B+1])){B+=2,Q++;do;while(mt[++B]===mt[++Q]&&mt[++B]===mt[++Q]&&mt[++B]===mt[++Q]&&mt[++B]===mt[++Q]&&mt[++B]===mt[++Q]&&mt[++B]===mt[++Q]&&mt[++B]===mt[++Q]&&mt[++B]===mt[++Q]&&B<Lt);if(xe=Ce-(Lt-B),B=Lt-Ce,xe>Ne){if(ee.match_start=Qe,Ne=xe,xe>=Ze)break;Yt=mt[B+Ne-1],cr=mt[B+Ne]}}while((Qe=Bt[Qe&Nt])>ot&&--ie!==0);return Ne<=ee.lookahead?Ne:ee.lookahead}function Wt(ee){var Qe=ee.w_size,ie,B,Q,xe,Ne;do{if(xe=ee.window_size-ee.lookahead-ee.strstart,ee.strstart>=Qe+(Qe-Be)){T.arraySet(ee.window,ee.window,Qe,Qe,0),ee.match_start-=Qe,ee.strstart-=Qe,ee.block_start-=Qe,B=ee.hash_size,ie=B;do Q=ee.head[--ie],ee.head[ie]=Q>=Qe?Q-Qe:0;while(--B);B=Qe,ie=B;do Q=ee.prev[--ie],ee.prev[ie]=Q>=Qe?Q-Qe:0;while(--B);xe+=Qe}if(ee.strm.avail_in===0)break;if(B=wt(ee.strm,ee.window,ee.strstart+ee.lookahead,xe),ee.lookahead+=B,ee.lookahead+ee.insert>=Fe)for(Ne=ee.strstart-ee.insert,ee.ins_h=ee.window[Ne],ee.ins_h=(ee.ins_h<<ee.hash_shift^ee.window[Ne+1])&ee.hash_mask;ee.insert&&(ee.ins_h=(ee.ins_h<<ee.hash_shift^ee.window[Ne+Fe-1])&ee.hash_mask,ee.prev[Ne&ee.w_mask]=ee.head[ee.ins_h],ee.head[ee.ins_h]=Ne,Ne++,ee.insert--,!(ee.lookahead+ee.insert<Fe)););}while(ee.lookahead<Be&&ee.strm.avail_in!==0)}function or(ee,Qe){var ie=65535;for(ie>ee.pending_buf_size-5&&(ie=ee.pending_buf_size-5);;){if(ee.lookahead<=1){if(Wt(ee),ee.lookahead===0&&Qe===E)return Ge;if(ee.lookahead===0)break}ee.strstart+=ee.lookahead,ee.lookahead=0;var B=ee.block_start+ie;if((ee.strstart===0||ee.strstart>=B)&&(ee.lookahead=ee.strstart-B,ee.strstart=B,ge(ee,!1),ee.strm.avail_out===0)||ee.strstart-ee.block_start>=ee.w_size-Be&&(ge(ee,!1),ee.strm.avail_out===0))return Ge}return ee.insert=0,Qe===p?(ge(ee,!0),ee.strm.avail_out===0?Je:it):(ee.strstart>ee.block_start&&(ge(ee,!1),ee.strm.avail_out===0),Ge)}function Or(ee,Qe){for(var ie,B;;){if(ee.lookahead<Be){if(Wt(ee),ee.lookahead<Be&&Qe===E)return Ge;if(ee.lookahead===0)break}if(ie=0,ee.lookahead>=Fe&&(ee.ins_h=(ee.ins_h<<ee.hash_shift^ee.window[ee.strstart+Fe-1])&ee.hash_mask,ie=ee.prev[ee.strstart&ee.w_mask]=ee.head[ee.ins_h],ee.head[ee.ins_h]=ee.strstart),ie!==0&&ee.strstart-ie<=ee.w_size-Be&&(ee.match_length=Ft(ee,ie)),ee.match_length>=Fe)if(B=t._tr_tally(ee,ee.strstart-ee.match_start,ee.match_length-Fe),ee.lookahead-=ee.match_length,ee.match_length<=ee.max_lazy_match&&ee.lookahead>=Fe){ee.match_length--;do ee.strstart++,ee.ins_h=(ee.ins_h<<ee.hash_shift^ee.window[ee.strstart+Fe-1])&ee.hash_mask,ie=ee.prev[ee.strstart&ee.w_mask]=ee.head[ee.ins_h],ee.head[ee.ins_h]=ee.strstart;while(--ee.match_length!==0);ee.strstart++}else ee.strstart+=ee.match_length,ee.match_length=0,ee.ins_h=ee.window[ee.strstart],ee.ins_h=(ee.ins_h<<ee.hash_shift^ee.window[ee.strstart+1])&ee.hash_mask;else B=t._tr_tally(ee,0,ee.window[ee.strstart]),ee.lookahead--,ee.strstart++;if(B&&(ge(ee,!1),ee.strm.avail_out===0))return Ge}return ee.insert=ee.strstart<Fe-1?ee.strstart:Fe-1,Qe===p?(ge(ee,!0),ee.strm.avail_out===0?Je:it):ee.last_lit&&(ge(ee,!1),ee.strm.avail_out===0)?Ge:We}function xr(ee,Qe){for(var ie,B,Q;;){if(ee.lookahead<Be){if(Wt(ee),ee.lookahead<Be&&Qe===E)return Ge;if(ee.lookahead===0)break}if(ie=0,ee.lookahead>=Fe&&(ee.ins_h=(ee.ins_h<<ee.hash_shift^ee.window[ee.strstart+Fe-1])&ee.hash_mask,ie=ee.prev[ee.strstart&ee.w_mask]=ee.head[ee.ins_h],ee.head[ee.ins_h]=ee.strstart),ee.prev_length=ee.match_length,ee.prev_match=ee.match_start,ee.match_length=Fe-1,ie!==0&&ee.prev_length<ee.max_lazy_match&&ee.strstart-ie<=ee.w_size-Be&&(ee.match_length=Ft(ee,ie),ee.match_length<=5&&(ee.strategy===G||ee.match_length===Fe&&ee.strstart-ee.match_start>4096)&&(ee.match_length=Fe-1)),ee.prev_length>=Fe&&ee.match_length<=ee.prev_length){Q=ee.strstart+ee.lookahead-Fe,B=t._tr_tally(ee,ee.strstart-1-ee.prev_match,ee.prev_length-Fe),ee.lookahead-=ee.prev_length-1,ee.prev_length-=2;do++ee.strstart<=Q&&(ee.ins_h=(ee.ins_h<<ee.hash_shift^ee.window[ee.strstart+Fe-1])&ee.hash_mask,ie=ee.prev[ee.strstart&ee.w_mask]=ee.head[ee.ins_h],ee.head[ee.ins_h]=ee.strstart);while(--ee.prev_length!==0);if(ee.match_available=0,ee.match_length=Fe-1,ee.strstart++,B&&(ge(ee,!1),ee.strm.avail_out===0))return Ge}else if(ee.match_available){if(B=t._tr_tally(ee,0,ee.window[ee.strstart-1]),B&&ge(ee,!1),ee.strstart++,ee.lookahead--,ee.strm.avail_out===0)return Ge}else ee.match_available=1,ee.strstart++,ee.lookahead--}return ee.match_available&&(B=t._tr_tally(ee,0,ee.window[ee.strstart-1]),ee.match_available=0),ee.insert=ee.strstart<Fe-1?ee.strstart:Fe-1,Qe===p?(ge(ee,!0),ee.strm.avail_out===0?Je:it):ee.last_lit&&(ge(ee,!1),ee.strm.avail_out===0)?Ge:We}function Tr(ee,Qe){for(var ie,B,Q,xe,Ne=ee.window;;){if(ee.lookahead<=Ce){if(Wt(ee),ee.lookahead<=Ce&&Qe===E)return Ge;if(ee.lookahead===0)break}if(ee.match_length=0,ee.lookahead>=Fe&&ee.strstart>0&&(Q=ee.strstart-1,B=Ne[Q],B===Ne[++Q]&&B===Ne[++Q]&&B===Ne[++Q])){xe=ee.strstart+Ce;do;while(B===Ne[++Q]&&B===Ne[++Q]&&B===Ne[++Q]&&B===Ne[++Q]&&B===Ne[++Q]&&B===Ne[++Q]&&B===Ne[++Q]&&B===Ne[++Q]&&Q<xe);ee.match_length=Ce-(xe-Q),ee.match_length>ee.lookahead&&(ee.match_length=ee.lookahead)}if(ee.match_length>=Fe?(ie=t._tr_tally(ee,1,ee.match_length-Fe),ee.lookahead-=ee.match_length,ee.strstart+=ee.match_length,ee.match_length=0):(ie=t._tr_tally(ee,0,ee.window[ee.strstart]),ee.lookahead--,ee.strstart++),ie&&(ge(ee,!1),ee.strm.avail_out===0))return Ge}return ee.insert=0,Qe===p?(ge(ee,!0),ee.strm.avail_out===0?Je:it):ee.last_lit&&(ge(ee,!1),ee.strm.avail_out===0)?Ge:We}function br(ee,Qe){for(var ie;;){if(ee.lookahead===0&&(Wt(ee),ee.lookahead===0)){if(Qe===E)return Ge;break}if(ee.match_length=0,ie=t._tr_tally(ee,0,ee.window[ee.strstart]),ee.lookahead--,ee.strstart++,ie&&(ge(ee,!1),ee.strm.avail_out===0))return Ge}return ee.insert=0,Qe===p?(ge(ee,!0),ee.strm.avail_out===0?Je:it):ee.last_lit&&(ge(ee,!1),ee.strm.avail_out===0)?Ge:We}function fr(ee,Qe,ie,B,Q){this.good_length=ee,this.max_lazy=Qe,this.nice_length=ie,this.max_chain=B,this.func=Q}var Vr;Vr=[new fr(0,0,0,0,or),new fr(4,4,8,4,Or),new fr(4,5,16,8,Or),new fr(4,6,32,32,Or),new fr(4,4,16,16,xr),new fr(8,16,32,32,xr),new fr(8,16,128,128,xr),new fr(8,32,128,256,xr),new fr(32,128,258,1024,xr),new fr(32,258,258,4096,xr)];function Ir(ee){ee.window_size=2*ee.w_size,be(ee.head),ee.max_lazy_match=Vr[ee.level].max_lazy,ee.good_match=Vr[ee.level].good_length,ee.nice_match=Vr[ee.level].nice_length,ee.max_chain_length=Vr[ee.level].max_chain,ee.strstart=0,ee.block_start=0,ee.lookahead=0,ee.insert=0,ee.match_length=ee.prev_length=Fe-1,ee.match_available=0,ee.ins_h=0}function De(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=te,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new T.Buf16(nt*2),this.dyn_dtree=new T.Buf16((2*Me+1)*2),this.bl_tree=new T.Buf16((2*He+1)*2),be(this.dyn_ltree),be(this.dyn_dtree),be(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new T.Buf16(ht+1),this.heap=new T.Buf16(2*Ee+1),be(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new T.Buf16(2*Ee+1),be(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function St(ee){var Qe;return!ee||!ee.state?de(ee,P):(ee.total_in=ee.total_out=0,ee.data_type=re,Qe=ee.state,Qe.pending=0,Qe.pending_out=0,Qe.wrap<0&&(Qe.wrap=-Qe.wrap),Qe.status=Qe.wrap?se:qe,ee.adler=Qe.wrap===2?0:1,Qe.last_flush=E,t._tr_init(Qe),z)}function Ut(ee){var Qe=St(ee);return Qe===z&&Ir(ee.state),Qe}function ir(ee,Qe){return!ee||!ee.state||ee.state.wrap!==2?P:(ee.state.gzhead=Qe,z)}function Rt(ee,Qe,ie,B,Q,xe){if(!ee)return P;var Ne=1;if(Qe===U&&(Qe=6),B<0?(Ne=0,B=-B):B>15&&(Ne=2,B-=16),Q<1||Q>ye||ie!==te||B<8||B>15||Qe<0||Qe>9||xe<0||xe>W)return de(ee,P);B===8&&(B=9);var Ze=new De;return ee.state=Ze,Ze.strm=ee,Ze.wrap=Ne,Ze.gzhead=null,Ze.w_bits=B,Ze.w_size=1<<Ze.w_bits,Ze.w_mask=Ze.w_size-1,Ze.hash_bits=Q+7,Ze.hash_size=1<<Ze.hash_bits,Ze.hash_mask=Ze.hash_size-1,Ze.hash_shift=~~((Ze.hash_bits+Fe-1)/Fe),Ze.window=new T.Buf8(Ze.w_size*2),Ze.head=new T.Buf16(Ze.hash_size),Ze.prev=new T.Buf16(Ze.w_size),Ze.lit_bufsize=1<<Q+6,Ze.pending_buf_size=Ze.lit_bufsize*4,Ze.pending_buf=new T.Buf8(Ze.pending_buf_size),Ze.d_buf=1*Ze.lit_bufsize,Ze.l_buf=3*Ze.lit_bufsize,Ze.level=Qe,Ze.strategy=xe,Ze.method=ie,Ut(ee)}function $t(ee,Qe){return Rt(ee,Qe,te,ue,Se,J)}function rt(ee,Qe){var ie,B,Q,xe;if(!ee||!ee.state||Qe>C||Qe<0)return ee?de(ee,P):P;if(B=ee.state,!ee.output||!ee.input&&ee.avail_in!==0||B.status===tt&&Qe!==p)return de(ee,ee.avail_out===0?O:P);if(B.strm=ee,ie=B.last_flush,B.last_flush=Qe,B.status===se)if(B.wrap===2)ee.adler=0,le(B,31),le(B,139),le(B,8),B.gzhead?(le(B,(B.gzhead.text?1:0)+(B.gzhead.hcrc?2:0)+(B.gzhead.extra?4:0)+(B.gzhead.name?8:0)+(B.gzhead.comment?16:0)),le(B,B.gzhead.time&255),le(B,B.gzhead.time>>8&255),le(B,B.gzhead.time>>16&255),le(B,B.gzhead.time>>24&255),le(B,B.level===9?2:B.strategy>=Z||B.level<2?4:0),le(B,B.gzhead.os&255),B.gzhead.extra&&B.gzhead.extra.length&&(le(B,B.gzhead.extra.length&255),le(B,B.gzhead.extra.length>>8&255)),B.gzhead.hcrc&&(ee.adler=D(ee.adler,B.pending_buf,B.pending,0)),B.gzindex=0,B.status=pe):(le(B,0),le(B,0),le(B,0),le(B,0),le(B,0),le(B,B.level===9?2:B.strategy>=Z||B.level<2?4:0),le(B,ze),B.status=qe);else{var Ne=te+(B.w_bits-8<<4)<<8,Ze=-1;B.strategy>=Z||B.level<2?Ze=0:B.level<6?Ze=1:B.level===6?Ze=2:Ze=3,Ne|=Ze<<6,B.strstart!==0&&(Ne|=Ae),Ne+=31-Ne%31,B.status=qe,et(B,Ne),B.strstart!==0&&(et(B,ee.adler>>>16),et(B,ee.adler&65535)),ee.adler=1}if(B.status===pe)if(B.gzhead.extra){for(Q=B.pending;B.gzindex<(B.gzhead.extra.length&65535)&&!(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>Q&&(ee.adler=D(ee.adler,B.pending_buf,B.pending-Q,Q)),Oe(ee),Q=B.pending,B.pending===B.pending_buf_size));)le(B,B.gzhead.extra[B.gzindex]&255),B.gzindex++;B.gzhead.hcrc&&B.pending>Q&&(ee.adler=D(ee.adler,B.pending_buf,B.pending-Q,Q)),B.gzindex===B.gzhead.extra.length&&(B.gzindex=0,B.status=Ke)}else B.status=Ke;if(B.status===Ke)if(B.gzhead.name){Q=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>Q&&(ee.adler=D(ee.adler,B.pending_buf,B.pending-Q,Q)),Oe(ee),Q=B.pending,B.pending===B.pending_buf_size)){xe=1;break}B.gzindex<B.gzhead.name.length?xe=B.gzhead.name.charCodeAt(B.gzindex++)&255:xe=0,le(B,xe)}while(xe!==0);B.gzhead.hcrc&&B.pending>Q&&(ee.adler=D(ee.adler,B.pending_buf,B.pending-Q,Q)),xe===0&&(B.gzindex=0,B.status=_e)}else B.status=_e;if(B.status===_e)if(B.gzhead.comment){Q=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>Q&&(ee.adler=D(ee.adler,B.pending_buf,B.pending-Q,Q)),Oe(ee),Q=B.pending,B.pending===B.pending_buf_size)){xe=1;break}B.gzindex<B.gzhead.comment.length?xe=B.gzhead.comment.charCodeAt(B.gzindex++)&255:xe=0,le(B,xe)}while(xe!==0);B.gzhead.hcrc&&B.pending>Q&&(ee.adler=D(ee.adler,B.pending_buf,B.pending-Q,Q)),xe===0&&(B.status=ke)}else B.status=ke;if(B.status===ke&&(B.gzhead.hcrc?(B.pending+2>B.pending_buf_size&&Oe(ee),B.pending+2<=B.pending_buf_size&&(le(B,ee.adler&255),le(B,ee.adler>>8&255),ee.adler=0,B.status=qe)):B.status=qe),B.pending!==0){if(Oe(ee),ee.avail_out===0)return B.last_flush=-1,z}else if(ee.avail_in===0&&ve(Qe)<=ve(ie)&&Qe!==p)return de(ee,O);if(B.status===tt&&ee.avail_in!==0)return de(ee,O);if(ee.avail_in!==0||B.lookahead!==0||Qe!==E&&B.status!==tt){var ot=B.strategy===Z?br(B,Qe):B.strategy===X?Tr(B,Qe):Vr[B.level].func(B,Qe);if((ot===Je||ot===it)&&(B.status=tt),ot===Ge||ot===Je)return ee.avail_out===0&&(B.last_flush=-1),z;if(ot===We&&(Qe===m?t._tr_align(B):Qe!==C&&(t._tr_stored_block(B,0,0,!1),Qe===y&&(be(B.head),B.lookahead===0&&(B.strstart=0,B.block_start=0,B.insert=0))),Oe(ee),ee.avail_out===0))return B.last_flush=-1,z}return Qe!==p?z:B.wrap<=0?A:(B.wrap===2?(le(B,ee.adler&255),le(B,ee.adler>>8&255),le(B,ee.adler>>16&255),le(B,ee.adler>>24&255),le(B,ee.total_in&255),le(B,ee.total_in>>8&255),le(B,ee.total_in>>16&255),le(B,ee.total_in>>24&255)):(et(B,ee.adler>>>16),et(B,ee.adler&65535)),Oe(ee),B.wrap>0&&(B.wrap=-B.wrap),B.pending!==0?z:A)}function sr(ee){var Qe;return!ee||!ee.state?P:(Qe=ee.state.status,Qe!==se&&Qe!==pe&&Qe!==Ke&&Qe!==_e&&Qe!==ke&&Qe!==qe&&Qe!==tt?de(ee,P):(ee.state=null,Qe===qe?de(ee,x):z))}function Fr(ee,Qe){var ie=Qe.length,B,Q,xe,Ne,Ze,ot,mt,Nt;if(!ee||!ee.state||(B=ee.state,Ne=B.wrap,Ne===2||Ne===1&&B.status!==se||B.lookahead))return P;for(Ne===1&&(ee.adler=S(ee.adler,Qe,ie,0)),B.wrap=0,ie>=B.w_size&&(Ne===0&&(be(B.head),B.strstart=0,B.block_start=0,B.insert=0),Nt=new T.Buf8(B.w_size),T.arraySet(Nt,Qe,ie-B.w_size,B.w_size,0),Qe=Nt,ie=B.w_size),Ze=ee.avail_in,ot=ee.next_in,mt=ee.input,ee.avail_in=ie,ee.next_in=0,ee.input=Qe,Wt(B);B.lookahead>=Fe;){Q=B.strstart,xe=B.lookahead-(Fe-1);do B.ins_h=(B.ins_h<<B.hash_shift^B.window[Q+Fe-1])&B.hash_mask,B.prev[Q&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=Q,Q++;while(--xe);B.strstart=Q,B.lookahead=Fe-1,Wt(B)}return B.strstart+=B.lookahead,B.block_start=B.strstart,B.insert=B.lookahead,B.lookahead=0,B.match_length=B.prev_length=Fe-1,B.match_available=0,ee.next_in=ot,ee.input=mt,ee.avail_in=Ze,B.wrap=Ne,z}b.deflateInit=$t,b.deflateInit2=Rt,b.deflateReset=Ut,b.deflateResetKeep=St,b.deflateSetHeader=ir,b.deflate=rt,b.deflateEnd=sr,b.deflateSetDictionary=Fr,b.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":36,"./adler32":37,"./crc32":39,"./messages":44,"./trees":45}],41:[function(_,k,b){var T=30,t=12;k.exports=function(D,w){var E,m,y,p,C,z,A,P,x,O,U,G,Z,X,W,J,re,te,ye,ue,Se,Le,Pe,Ee,Me;E=D.state,m=D.next_in,Ee=D.input,y=m+(D.avail_in-5),p=D.next_out,Me=D.output,C=p-(w-D.avail_out),z=p+(D.avail_out-257),A=E.dmax,P=E.wsize,x=E.whave,O=E.wnext,U=E.window,G=E.hold,Z=E.bits,X=E.lencode,W=E.distcode,J=(1<<E.lenbits)-1,re=(1<<E.distbits)-1;e:do{Z<15&&(G+=Ee[m++]<<Z,Z+=8,G+=Ee[m++]<<Z,Z+=8),te=X[G&J];t:for(;;){if(ye=te>>>24,G>>>=ye,Z-=ye,ye=te>>>16&255,ye===0)Me[p++]=te&65535;else if(ye&16){ue=te&65535,ye&=15,ye&&(Z<ye&&(G+=Ee[m++]<<Z,Z+=8),ue+=G&(1<<ye)-1,G>>>=ye,Z-=ye),Z<15&&(G+=Ee[m++]<<Z,Z+=8,G+=Ee[m++]<<Z,Z+=8),te=W[G&re];r:for(;;){if(ye=te>>>24,G>>>=ye,Z-=ye,ye=te>>>16&255,ye&16){if(Se=te&65535,ye&=15,Z<ye&&(G+=Ee[m++]<<Z,Z+=8,Z<ye&&(G+=Ee[m++]<<Z,Z+=8)),Se+=G&(1<<ye)-1,Se>A){D.msg="invalid distance too far back",E.mode=T;break e}if(G>>>=ye,Z-=ye,ye=p-C,Se>ye){if(ye=Se-ye,ye>x&&E.sane){D.msg="invalid distance too far back",E.mode=T;break e}if(Le=0,Pe=U,O===0){if(Le+=P-ye,ye<ue){ue-=ye;do Me[p++]=U[Le++];while(--ye);Le=p-Se,Pe=Me}}else if(O<ye){if(Le+=P+O-ye,ye-=O,ye<ue){ue-=ye;do Me[p++]=U[Le++];while(--ye);if(Le=0,O<ue){ye=O,ue-=ye;do Me[p++]=U[Le++];while(--ye);Le=p-Se,Pe=Me}}}else if(Le+=O-ye,ye<ue){ue-=ye;do Me[p++]=U[Le++];while(--ye);Le=p-Se,Pe=Me}for(;ue>2;)Me[p++]=Pe[Le++],Me[p++]=Pe[Le++],Me[p++]=Pe[Le++],ue-=3;ue&&(Me[p++]=Pe[Le++],ue>1&&(Me[p++]=Pe[Le++]))}else{Le=p-Se;do Me[p++]=Me[Le++],Me[p++]=Me[Le++],Me[p++]=Me[Le++],ue-=3;while(ue>2);ue&&(Me[p++]=Me[Le++],ue>1&&(Me[p++]=Me[Le++]))}}else if(ye&64){D.msg="invalid distance code",E.mode=T;break e}else{te=W[(te&65535)+(G&(1<<ye)-1)];continue r}break}}else if(ye&64)if(ye&32){E.mode=t;break e}else{D.msg="invalid literal/length code",E.mode=T;break e}else{te=X[(te&65535)+(G&(1<<ye)-1)];continue t}break}}while(m<y&&p<z);ue=Z>>3,m-=ue,Z-=ue<<3,G&=(1<<Z)-1,D.next_in=m,D.next_out=p,D.avail_in=m<y?5+(y-m):5-(m-y),D.avail_out=p<z?257+(z-p):257-(p-z),E.hold=G,E.bits=Z}},{}],42:[function(_,k,b){var T=_("../utils/common"),t=_("./adler32"),S=_("./crc32"),D=_("./inffast"),w=_("./inftrees"),E=0,m=1,y=2,p=4,C=5,z=6,A=0,P=1,x=2,O=-2,U=-3,G=-4,Z=-5,X=8,W=1,J=2,re=3,te=4,ye=5,ue=6,Se=7,Le=8,Pe=9,Ee=10,Me=11,He=12,nt=13,ht=14,Fe=15,Ce=16,Be=17,Ae=18,se=19,pe=20,Ke=21,_e=22,ke=23,qe=24,tt=25,Ge=26,We=27,Je=28,it=29,ze=30,de=31,ve=32,be=852,Oe=592,ge=15,le=ge;function et(Rt){return(Rt>>>24&255)+(Rt>>>8&65280)+((Rt&65280)<<8)+((Rt&255)<<24)}function wt(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new T.Buf16(320),this.work=new T.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Ft(Rt){var $t;return!Rt||!Rt.state?O:($t=Rt.state,Rt.total_in=Rt.total_out=$t.total=0,Rt.msg="",$t.wrap&&(Rt.adler=$t.wrap&1),$t.mode=W,$t.last=0,$t.havedict=0,$t.dmax=32768,$t.head=null,$t.hold=0,$t.bits=0,$t.lencode=$t.lendyn=new T.Buf32(be),$t.distcode=$t.distdyn=new T.Buf32(Oe),$t.sane=1,$t.back=-1,A)}function Wt(Rt){var $t;return!Rt||!Rt.state?O:($t=Rt.state,$t.wsize=0,$t.whave=0,$t.wnext=0,Ft(Rt))}function or(Rt,$t){var rt,sr;return!Rt||!Rt.state||(sr=Rt.state,$t<0?(rt=0,$t=-$t):(rt=($t>>4)+1,$t<48&&($t&=15)),$t&&($t<8||$t>15))?O:(sr.window!==null&&sr.wbits!==$t&&(sr.window=null),sr.wrap=rt,sr.wbits=$t,Wt(Rt))}function Or(Rt,$t){var rt,sr;return Rt?(sr=new wt,Rt.state=sr,sr.window=null,rt=or(Rt,$t),rt!==A&&(Rt.state=null),rt):O}function xr(Rt){return Or(Rt,le)}var Tr=!0,br,fr;function Vr(Rt){if(Tr){var $t;for(br=new T.Buf32(512),fr=new T.Buf32(32),$t=0;$t<144;)Rt.lens[$t++]=8;for(;$t<256;)Rt.lens[$t++]=9;for(;$t<280;)Rt.lens[$t++]=7;for(;$t<288;)Rt.lens[$t++]=8;for(w(m,Rt.lens,0,288,br,0,Rt.work,{bits:9}),$t=0;$t<32;)Rt.lens[$t++]=5;w(y,Rt.lens,0,32,fr,0,Rt.work,{bits:5}),Tr=!1}Rt.lencode=br,Rt.lenbits=9,Rt.distcode=fr,Rt.distbits=5}function Ir(Rt,$t,rt,sr){var Fr,ee=Rt.state;return ee.window===null&&(ee.wsize=1<<ee.wbits,ee.wnext=0,ee.whave=0,ee.window=new T.Buf8(ee.wsize)),sr>=ee.wsize?(T.arraySet(ee.window,$t,rt-ee.wsize,ee.wsize,0),ee.wnext=0,ee.whave=ee.wsize):(Fr=ee.wsize-ee.wnext,Fr>sr&&(Fr=sr),T.arraySet(ee.window,$t,rt-sr,Fr,ee.wnext),sr-=Fr,sr?(T.arraySet(ee.window,$t,rt-sr,sr,0),ee.wnext=sr,ee.whave=ee.wsize):(ee.wnext+=Fr,ee.wnext===ee.wsize&&(ee.wnext=0),ee.whave<ee.wsize&&(ee.whave+=Fr))),0}function De(Rt,$t){var rt,sr,Fr,ee,Qe,ie,B,Q,xe,Ne,Ze,ot,mt,Nt,Bt=0,Lt,Yt,cr,gr,Pr,Jr,Br,Ur,oi=new T.Buf8(4),si,Kr,Wr=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!Rt||!Rt.state||!Rt.output||!Rt.input&&Rt.avail_in!==0)return O;rt=Rt.state,rt.mode===He&&(rt.mode=nt),Qe=Rt.next_out,Fr=Rt.output,B=Rt.avail_out,ee=Rt.next_in,sr=Rt.input,ie=Rt.avail_in,Q=rt.hold,xe=rt.bits,Ne=ie,Ze=B,Ur=A;e:for(;;)switch(rt.mode){case W:if(rt.wrap===0){rt.mode=nt;break}for(;xe<16;){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}if(rt.wrap&2&&Q===35615){rt.check=0,oi[0]=Q&255,oi[1]=Q>>>8&255,rt.check=S(rt.check,oi,2,0),Q=0,xe=0,rt.mode=J;break}if(rt.flags=0,rt.head&&(rt.head.done=!1),!(rt.wrap&1)||(((Q&255)<<8)+(Q>>8))%31){Rt.msg="incorrect header check",rt.mode=ze;break}if((Q&15)!==X){Rt.msg="unknown compression method",rt.mode=ze;break}if(Q>>>=4,xe-=4,Br=(Q&15)+8,rt.wbits===0)rt.wbits=Br;else if(Br>rt.wbits){Rt.msg="invalid window size",rt.mode=ze;break}rt.dmax=1<<Br,Rt.adler=rt.check=1,rt.mode=Q&512?Ee:He,Q=0,xe=0;break;case J:for(;xe<16;){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}if(rt.flags=Q,(rt.flags&255)!==X){Rt.msg="unknown compression method",rt.mode=ze;break}if(rt.flags&57344){Rt.msg="unknown header flags set",rt.mode=ze;break}rt.head&&(rt.head.text=Q>>8&1),rt.flags&512&&(oi[0]=Q&255,oi[1]=Q>>>8&255,rt.check=S(rt.check,oi,2,0)),Q=0,xe=0,rt.mode=re;case re:for(;xe<32;){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}rt.head&&(rt.head.time=Q),rt.flags&512&&(oi[0]=Q&255,oi[1]=Q>>>8&255,oi[2]=Q>>>16&255,oi[3]=Q>>>24&255,rt.check=S(rt.check,oi,4,0)),Q=0,xe=0,rt.mode=te;case te:for(;xe<16;){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}rt.head&&(rt.head.xflags=Q&255,rt.head.os=Q>>8),rt.flags&512&&(oi[0]=Q&255,oi[1]=Q>>>8&255,rt.check=S(rt.check,oi,2,0)),Q=0,xe=0,rt.mode=ye;case ye:if(rt.flags&1024){for(;xe<16;){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}rt.length=Q,rt.head&&(rt.head.extra_len=Q),rt.flags&512&&(oi[0]=Q&255,oi[1]=Q>>>8&255,rt.check=S(rt.check,oi,2,0)),Q=0,xe=0}else rt.head&&(rt.head.extra=null);rt.mode=ue;case ue:if(rt.flags&1024&&(ot=rt.length,ot>ie&&(ot=ie),ot&&(rt.head&&(Br=rt.head.extra_len-rt.length,rt.head.extra||(rt.head.extra=new Array(rt.head.extra_len)),T.arraySet(rt.head.extra,sr,ee,ot,Br)),rt.flags&512&&(rt.check=S(rt.check,sr,ot,ee)),ie-=ot,ee+=ot,rt.length-=ot),rt.length))break e;rt.length=0,rt.mode=Se;case Se:if(rt.flags&2048){if(ie===0)break e;ot=0;do Br=sr[ee+ot++],rt.head&&Br&&rt.length<65536&&(rt.head.name+=String.fromCharCode(Br));while(Br&&ot<ie);if(rt.flags&512&&(rt.check=S(rt.check,sr,ot,ee)),ie-=ot,ee+=ot,Br)break e}else rt.head&&(rt.head.name=null);rt.length=0,rt.mode=Le;case Le:if(rt.flags&4096){if(ie===0)break e;ot=0;do Br=sr[ee+ot++],rt.head&&Br&&rt.length<65536&&(rt.head.comment+=String.fromCharCode(Br));while(Br&&ot<ie);if(rt.flags&512&&(rt.check=S(rt.check,sr,ot,ee)),ie-=ot,ee+=ot,Br)break e}else rt.head&&(rt.head.comment=null);rt.mode=Pe;case Pe:if(rt.flags&512){for(;xe<16;){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}if(Q!==(rt.check&65535)){Rt.msg="header crc mismatch",rt.mode=ze;break}Q=0,xe=0}rt.head&&(rt.head.hcrc=rt.flags>>9&1,rt.head.done=!0),Rt.adler=rt.check=0,rt.mode=He;break;case Ee:for(;xe<32;){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}Rt.adler=rt.check=et(Q),Q=0,xe=0,rt.mode=Me;case Me:if(rt.havedict===0)return Rt.next_out=Qe,Rt.avail_out=B,Rt.next_in=ee,Rt.avail_in=ie,rt.hold=Q,rt.bits=xe,x;Rt.adler=rt.check=1,rt.mode=He;case He:if($t===C||$t===z)break e;case nt:if(rt.last){Q>>>=xe&7,xe-=xe&7,rt.mode=We;break}for(;xe<3;){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}switch(rt.last=Q&1,Q>>>=1,xe-=1,Q&3){case 0:rt.mode=ht;break;case 1:if(Vr(rt),rt.mode=pe,$t===z){Q>>>=2,xe-=2;break e}break;case 2:rt.mode=Be;break;case 3:Rt.msg="invalid block type",rt.mode=ze}Q>>>=2,xe-=2;break;case ht:for(Q>>>=xe&7,xe-=xe&7;xe<32;){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}if((Q&65535)!==(Q>>>16^65535)){Rt.msg="invalid stored block lengths",rt.mode=ze;break}if(rt.length=Q&65535,Q=0,xe=0,rt.mode=Fe,$t===z)break e;case Fe:rt.mode=Ce;case Ce:if(ot=rt.length,ot){if(ot>ie&&(ot=ie),ot>B&&(ot=B),ot===0)break e;T.arraySet(Fr,sr,ee,ot,Qe),ie-=ot,ee+=ot,B-=ot,Qe+=ot,rt.length-=ot;break}rt.mode=He;break;case Be:for(;xe<14;){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}if(rt.nlen=(Q&31)+257,Q>>>=5,xe-=5,rt.ndist=(Q&31)+1,Q>>>=5,xe-=5,rt.ncode=(Q&15)+4,Q>>>=4,xe-=4,rt.nlen>286||rt.ndist>30){Rt.msg="too many length or distance symbols",rt.mode=ze;break}rt.have=0,rt.mode=Ae;case Ae:for(;rt.have<rt.ncode;){for(;xe<3;){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}rt.lens[Wr[rt.have++]]=Q&7,Q>>>=3,xe-=3}for(;rt.have<19;)rt.lens[Wr[rt.have++]]=0;if(rt.lencode=rt.lendyn,rt.lenbits=7,si={bits:rt.lenbits},Ur=w(E,rt.lens,0,19,rt.lencode,0,rt.work,si),rt.lenbits=si.bits,Ur){Rt.msg="invalid code lengths set",rt.mode=ze;break}rt.have=0,rt.mode=se;case se:for(;rt.have<rt.nlen+rt.ndist;){for(;Bt=rt.lencode[Q&(1<<rt.lenbits)-1],Lt=Bt>>>24,Yt=Bt>>>16&255,cr=Bt&65535,!(Lt<=xe);){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}if(cr<16)Q>>>=Lt,xe-=Lt,rt.lens[rt.have++]=cr;else{if(cr===16){for(Kr=Lt+2;xe<Kr;){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}if(Q>>>=Lt,xe-=Lt,rt.have===0){Rt.msg="invalid bit length repeat",rt.mode=ze;break}Br=rt.lens[rt.have-1],ot=3+(Q&3),Q>>>=2,xe-=2}else if(cr===17){for(Kr=Lt+3;xe<Kr;){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}Q>>>=Lt,xe-=Lt,Br=0,ot=3+(Q&7),Q>>>=3,xe-=3}else{for(Kr=Lt+7;xe<Kr;){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}Q>>>=Lt,xe-=Lt,Br=0,ot=11+(Q&127),Q>>>=7,xe-=7}if(rt.have+ot>rt.nlen+rt.ndist){Rt.msg="invalid bit length repeat",rt.mode=ze;break}for(;ot--;)rt.lens[rt.have++]=Br}}if(rt.mode===ze)break;if(rt.lens[256]===0){Rt.msg="invalid code -- missing end-of-block",rt.mode=ze;break}if(rt.lenbits=9,si={bits:rt.lenbits},Ur=w(m,rt.lens,0,rt.nlen,rt.lencode,0,rt.work,si),rt.lenbits=si.bits,Ur){Rt.msg="invalid literal/lengths set",rt.mode=ze;break}if(rt.distbits=6,rt.distcode=rt.distdyn,si={bits:rt.distbits},Ur=w(y,rt.lens,rt.nlen,rt.ndist,rt.distcode,0,rt.work,si),rt.distbits=si.bits,Ur){Rt.msg="invalid distances set",rt.mode=ze;break}if(rt.mode=pe,$t===z)break e;case pe:rt.mode=Ke;case Ke:if(ie>=6&&B>=258){Rt.next_out=Qe,Rt.avail_out=B,Rt.next_in=ee,Rt.avail_in=ie,rt.hold=Q,rt.bits=xe,D(Rt,Ze),Qe=Rt.next_out,Fr=Rt.output,B=Rt.avail_out,ee=Rt.next_in,sr=Rt.input,ie=Rt.avail_in,Q=rt.hold,xe=rt.bits,rt.mode===He&&(rt.back=-1);break}for(rt.back=0;Bt=rt.lencode[Q&(1<<rt.lenbits)-1],Lt=Bt>>>24,Yt=Bt>>>16&255,cr=Bt&65535,!(Lt<=xe);){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}if(Yt&&!(Yt&240)){for(gr=Lt,Pr=Yt,Jr=cr;Bt=rt.lencode[Jr+((Q&(1<<gr+Pr)-1)>>gr)],Lt=Bt>>>24,Yt=Bt>>>16&255,cr=Bt&65535,!(gr+Lt<=xe);){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}Q>>>=gr,xe-=gr,rt.back+=gr}if(Q>>>=Lt,xe-=Lt,rt.back+=Lt,rt.length=cr,Yt===0){rt.mode=Ge;break}if(Yt&32){rt.back=-1,rt.mode=He;break}if(Yt&64){Rt.msg="invalid literal/length code",rt.mode=ze;break}rt.extra=Yt&15,rt.mode=_e;case _e:if(rt.extra){for(Kr=rt.extra;xe<Kr;){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}rt.length+=Q&(1<<rt.extra)-1,Q>>>=rt.extra,xe-=rt.extra,rt.back+=rt.extra}rt.was=rt.length,rt.mode=ke;case ke:for(;Bt=rt.distcode[Q&(1<<rt.distbits)-1],Lt=Bt>>>24,Yt=Bt>>>16&255,cr=Bt&65535,!(Lt<=xe);){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}if(!(Yt&240)){for(gr=Lt,Pr=Yt,Jr=cr;Bt=rt.distcode[Jr+((Q&(1<<gr+Pr)-1)>>gr)],Lt=Bt>>>24,Yt=Bt>>>16&255,cr=Bt&65535,!(gr+Lt<=xe);){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}Q>>>=gr,xe-=gr,rt.back+=gr}if(Q>>>=Lt,xe-=Lt,rt.back+=Lt,Yt&64){Rt.msg="invalid distance code",rt.mode=ze;break}rt.offset=cr,rt.extra=Yt&15,rt.mode=qe;case qe:if(rt.extra){for(Kr=rt.extra;xe<Kr;){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}rt.offset+=Q&(1<<rt.extra)-1,Q>>>=rt.extra,xe-=rt.extra,rt.back+=rt.extra}if(rt.offset>rt.dmax){Rt.msg="invalid distance too far back",rt.mode=ze;break}rt.mode=tt;case tt:if(B===0)break e;if(ot=Ze-B,rt.offset>ot){if(ot=rt.offset-ot,ot>rt.whave&&rt.sane){Rt.msg="invalid distance too far back",rt.mode=ze;break}ot>rt.wnext?(ot-=rt.wnext,mt=rt.wsize-ot):mt=rt.wnext-ot,ot>rt.length&&(ot=rt.length),Nt=rt.window}else Nt=Fr,mt=Qe-rt.offset,ot=rt.length;ot>B&&(ot=B),B-=ot,rt.length-=ot;do Fr[Qe++]=Nt[mt++];while(--ot);rt.length===0&&(rt.mode=Ke);break;case Ge:if(B===0)break e;Fr[Qe++]=rt.length,B--,rt.mode=Ke;break;case We:if(rt.wrap){for(;xe<32;){if(ie===0)break e;ie--,Q|=sr[ee++]<<xe,xe+=8}if(Ze-=B,Rt.total_out+=Ze,rt.total+=Ze,Ze&&(Rt.adler=rt.check=rt.flags?S(rt.check,Fr,Ze,Qe-Ze):t(rt.check,Fr,Ze,Qe-Ze)),Ze=B,(rt.flags?Q:et(Q))!==rt.check){Rt.msg="incorrect data check",rt.mode=ze;break}Q=0,xe=0}rt.mode=Je;case Je:if(rt.wrap&&rt.flags){for(;xe<32;){if(ie===0)break e;ie--,Q+=sr[ee++]<<xe,xe+=8}if(Q!==(rt.total&4294967295)){Rt.msg="incorrect length check",rt.mode=ze;break}Q=0,xe=0}rt.mode=it;case it:Ur=P;break e;case ze:Ur=U;break e;case de:return G;case ve:default:return O}return Rt.next_out=Qe,Rt.avail_out=B,Rt.next_in=ee,Rt.avail_in=ie,rt.hold=Q,rt.bits=xe,(rt.wsize||Ze!==Rt.avail_out&&rt.mode<ze&&(rt.mode<We||$t!==p))&&Ir(Rt,Rt.output,Rt.next_out,Ze-Rt.avail_out),Ne-=Rt.avail_in,Ze-=Rt.avail_out,Rt.total_in+=Ne,Rt.total_out+=Ze,rt.total+=Ze,rt.wrap&&Ze&&(Rt.adler=rt.check=rt.flags?S(rt.check,Fr,Ze,Rt.next_out-Ze):t(rt.check,Fr,Ze,Rt.next_out-Ze)),Rt.data_type=rt.bits+(rt.last?64:0)+(rt.mode===He?128:0)+(rt.mode===pe||rt.mode===Fe?256:0),(Ne===0&&Ze===0||$t===p)&&Ur===A&&(Ur=Z),Ur}function St(Rt){if(!Rt||!Rt.state)return O;var $t=Rt.state;return $t.window&&($t.window=null),Rt.state=null,A}function Ut(Rt,$t){var rt;return!Rt||!Rt.state||(rt=Rt.state,!(rt.wrap&2))?O:(rt.head=$t,$t.done=!1,A)}function ir(Rt,$t){var rt=$t.length,sr,Fr,ee;return!Rt||!Rt.state||(sr=Rt.state,sr.wrap!==0&&sr.mode!==Me)?O:sr.mode===Me&&(Fr=1,Fr=t(Fr,$t,rt,0),Fr!==sr.check)?U:(ee=Ir(Rt,$t,rt,rt),ee?(sr.mode=de,G):(sr.havedict=1,A))}b.inflateReset=Wt,b.inflateReset2=or,b.inflateResetKeep=Ft,b.inflateInit=xr,b.inflateInit2=Or,b.inflate=De,b.inflateEnd=St,b.inflateGetHeader=Ut,b.inflateSetDictionary=ir,b.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":36,"./adler32":37,"./crc32":39,"./inffast":41,"./inftrees":43}],43:[function(_,k,b){var T=_("../utils/common"),t=15,S=852,D=592,w=0,E=1,m=2,y=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],p=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],C=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],z=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];k.exports=function(P,x,O,U,G,Z,X,W){var J=W.bits,re=0,te=0,ye=0,ue=0,Se=0,Le=0,Pe=0,Ee=0,Me=0,He=0,nt,ht,Fe,Ce,Be,Ae=null,se=0,pe,Ke=new T.Buf16(t+1),_e=new T.Buf16(t+1),ke=null,qe=0,tt,Ge,We;for(re=0;re<=t;re++)Ke[re]=0;for(te=0;te<U;te++)Ke[x[O+te]]++;for(Se=J,ue=t;ue>=1&&Ke[ue]===0;ue--);if(Se>ue&&(Se=ue),ue===0)return G[Z++]=1<<24|64<<16|0,G[Z++]=1<<24|64<<16|0,W.bits=1,0;for(ye=1;ye<ue&&Ke[ye]===0;ye++);for(Se<ye&&(Se=ye),Ee=1,re=1;re<=t;re++)if(Ee<<=1,Ee-=Ke[re],Ee<0)return-1;if(Ee>0&&(P===w||ue!==1))return-1;for(_e[1]=0,re=1;re<t;re++)_e[re+1]=_e[re]+Ke[re];for(te=0;te<U;te++)x[O+te]!==0&&(X[_e[x[O+te]]++]=te);if(P===w?(Ae=ke=X,pe=19):P===E?(Ae=y,se-=257,ke=p,qe-=257,pe=256):(Ae=C,ke=z,pe=-1),He=0,te=0,re=ye,Be=Z,Le=Se,Pe=0,Fe=-1,Me=1<<Se,Ce=Me-1,P===E&&Me>S||P===m&&Me>D)return 1;for(;;){tt=re-Pe,X[te]<pe?(Ge=0,We=X[te]):X[te]>pe?(Ge=ke[qe+X[te]],We=Ae[se+X[te]]):(Ge=96,We=0),nt=1<<re-Pe,ht=1<<Le,ye=ht;do ht-=nt,G[Be+(He>>Pe)+ht]=tt<<24|Ge<<16|We|0;while(ht!==0);for(nt=1<<re-1;He&nt;)nt>>=1;if(nt!==0?(He&=nt-1,He+=nt):He=0,te++,--Ke[re]===0){if(re===ue)break;re=x[O+X[te]]}if(re>Se&&(He&Ce)!==Fe){for(Pe===0&&(Pe=Se),Be+=ye,Le=re-Pe,Ee=1<<Le;Le+Pe<ue&&(Ee-=Ke[Le+Pe],!(Ee<=0));)Le++,Ee<<=1;if(Me+=1<<Le,P===E&&Me>S||P===m&&Me>D)return 1;Fe=He&Ce,G[Fe]=Se<<24|Le<<16|Be-Z|0}}return He!==0&&(G[Be+He]=re-Pe<<24|64<<16|0),W.bits=Se,0}},{"../utils/common":36}],44:[function(_,k,b){k.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],45:[function(_,k,b){var T=_("../utils/common"),t=4,S=0,D=1,w=2;function E(De){for(var St=De.length;--St>=0;)De[St]=0}var m=0,y=1,p=2,C=3,z=258,A=29,P=256,x=P+1+A,O=30,U=19,G=2*x+1,Z=15,X=16,W=7,J=256,re=16,te=17,ye=18,ue=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Se=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Le=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Pe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Ee=512,Me=new Array((x+2)*2);E(Me);var He=new Array(O*2);E(He);var nt=new Array(Ee);E(nt);var ht=new Array(z-C+1);E(ht);var Fe=new Array(A);E(Fe);var Ce=new Array(O);E(Ce);function Be(De,St,Ut,ir,Rt){this.static_tree=De,this.extra_bits=St,this.extra_base=Ut,this.elems=ir,this.max_length=Rt,this.has_stree=De&&De.length}var Ae,se,pe;function Ke(De,St){this.dyn_tree=De,this.max_code=0,this.stat_desc=St}function _e(De){return De<256?nt[De]:nt[256+(De>>>7)]}function ke(De,St){De.pending_buf[De.pending++]=St&255,De.pending_buf[De.pending++]=St>>>8&255}function qe(De,St,Ut){De.bi_valid>X-Ut?(De.bi_buf|=St<<De.bi_valid&65535,ke(De,De.bi_buf),De.bi_buf=St>>X-De.bi_valid,De.bi_valid+=Ut-X):(De.bi_buf|=St<<De.bi_valid&65535,De.bi_valid+=Ut)}function tt(De,St,Ut){qe(De,Ut[St*2],Ut[St*2+1])}function Ge(De,St){var Ut=0;do Ut|=De&1,De>>>=1,Ut<<=1;while(--St>0);return Ut>>>1}function We(De){De.bi_valid===16?(ke(De,De.bi_buf),De.bi_buf=0,De.bi_valid=0):De.bi_valid>=8&&(De.pending_buf[De.pending++]=De.bi_buf&255,De.bi_buf>>=8,De.bi_valid-=8)}function Je(De,St){var Ut=St.dyn_tree,ir=St.max_code,Rt=St.stat_desc.static_tree,$t=St.stat_desc.has_stree,rt=St.stat_desc.extra_bits,sr=St.stat_desc.extra_base,Fr=St.stat_desc.max_length,ee,Qe,ie,B,Q,xe,Ne=0;for(B=0;B<=Z;B++)De.bl_count[B]=0;for(Ut[De.heap[De.heap_max]*2+1]=0,ee=De.heap_max+1;ee<G;ee++)Qe=De.heap[ee],B=Ut[Ut[Qe*2+1]*2+1]+1,B>Fr&&(B=Fr,Ne++),Ut[Qe*2+1]=B,!(Qe>ir)&&(De.bl_count[B]++,Q=0,Qe>=sr&&(Q=rt[Qe-sr]),xe=Ut[Qe*2],De.opt_len+=xe*(B+Q),$t&&(De.static_len+=xe*(Rt[Qe*2+1]+Q)));if(Ne!==0){do{for(B=Fr-1;De.bl_count[B]===0;)B--;De.bl_count[B]--,De.bl_count[B+1]+=2,De.bl_count[Fr]--,Ne-=2}while(Ne>0);for(B=Fr;B!==0;B--)for(Qe=De.bl_count[B];Qe!==0;)ie=De.heap[--ee],!(ie>ir)&&(Ut[ie*2+1]!==B&&(De.opt_len+=(B-Ut[ie*2+1])*Ut[ie*2],Ut[ie*2+1]=B),Qe--)}}function it(De,St,Ut){var ir=new Array(Z+1),Rt=0,$t,rt;for($t=1;$t<=Z;$t++)ir[$t]=Rt=Rt+Ut[$t-1]<<1;for(rt=0;rt<=St;rt++){var sr=De[rt*2+1];sr!==0&&(De[rt*2]=Ge(ir[sr]++,sr))}}function ze(){var De,St,Ut,ir,Rt,$t=new Array(Z+1);for(Ut=0,ir=0;ir<A-1;ir++)for(Fe[ir]=Ut,De=0;De<1<<ue[ir];De++)ht[Ut++]=ir;for(ht[Ut-1]=ir,Rt=0,ir=0;ir<16;ir++)for(Ce[ir]=Rt,De=0;De<1<<Se[ir];De++)nt[Rt++]=ir;for(Rt>>=7;ir<O;ir++)for(Ce[ir]=Rt<<7,De=0;De<1<<Se[ir]-7;De++)nt[256+Rt++]=ir;for(St=0;St<=Z;St++)$t[St]=0;for(De=0;De<=143;)Me[De*2+1]=8,De++,$t[8]++;for(;De<=255;)Me[De*2+1]=9,De++,$t[9]++;for(;De<=279;)Me[De*2+1]=7,De++,$t[7]++;for(;De<=287;)Me[De*2+1]=8,De++,$t[8]++;for(it(Me,x+1,$t),De=0;De<O;De++)He[De*2+1]=5,He[De*2]=Ge(De,5);Ae=new Be(Me,ue,P+1,x,Z),se=new Be(He,Se,0,O,Z),pe=new Be(new Array(0),Le,0,U,W)}function de(De){var St;for(St=0;St<x;St++)De.dyn_ltree[St*2]=0;for(St=0;St<O;St++)De.dyn_dtree[St*2]=0;for(St=0;St<U;St++)De.bl_tree[St*2]=0;De.dyn_ltree[J*2]=1,De.opt_len=De.static_len=0,De.last_lit=De.matches=0}function ve(De){De.bi_valid>8?ke(De,De.bi_buf):De.bi_valid>0&&(De.pending_buf[De.pending++]=De.bi_buf),De.bi_buf=0,De.bi_valid=0}function be(De,St,Ut,ir){ve(De),ke(De,Ut),ke(De,~Ut),T.arraySet(De.pending_buf,De.window,St,Ut,De.pending),De.pending+=Ut}function Oe(De,St,Ut,ir){var Rt=St*2,$t=Ut*2;return De[Rt]<De[$t]||De[Rt]===De[$t]&&ir[St]<=ir[Ut]}function ge(De,St,Ut){for(var ir=De.heap[Ut],Rt=Ut<<1;Rt<=De.heap_len&&(Rt<De.heap_len&&Oe(St,De.heap[Rt+1],De.heap[Rt],De.depth)&&Rt++,!Oe(St,ir,De.heap[Rt],De.depth));)De.heap[Ut]=De.heap[Rt],Ut=Rt,Rt<<=1;De.heap[Ut]=ir}function le(De,St,Ut){var ir,Rt,$t=0,rt,sr;if(De.last_lit!==0)do ir=De.pending_buf[De.d_buf+$t*2]<<8|De.pending_buf[De.d_buf+$t*2+1],Rt=De.pending_buf[De.l_buf+$t],$t++,ir===0?tt(De,Rt,St):(rt=ht[Rt],tt(De,rt+P+1,St),sr=ue[rt],sr!==0&&(Rt-=Fe[rt],qe(De,Rt,sr)),ir--,rt=_e(ir),tt(De,rt,Ut),sr=Se[rt],sr!==0&&(ir-=Ce[rt],qe(De,ir,sr)));while($t<De.last_lit);tt(De,J,St)}function et(De,St){var Ut=St.dyn_tree,ir=St.stat_desc.static_tree,Rt=St.stat_desc.has_stree,$t=St.stat_desc.elems,rt,sr,Fr=-1,ee;for(De.heap_len=0,De.heap_max=G,rt=0;rt<$t;rt++)Ut[rt*2]!==0?(De.heap[++De.heap_len]=Fr=rt,De.depth[rt]=0):Ut[rt*2+1]=0;for(;De.heap_len<2;)ee=De.heap[++De.heap_len]=Fr<2?++Fr:0,Ut[ee*2]=1,De.depth[ee]=0,De.opt_len--,Rt&&(De.static_len-=ir[ee*2+1]);for(St.max_code=Fr,rt=De.heap_len>>1;rt>=1;rt--)ge(De,Ut,rt);ee=$t;do rt=De.heap[1],De.heap[1]=De.heap[De.heap_len--],ge(De,Ut,1),sr=De.heap[1],De.heap[--De.heap_max]=rt,De.heap[--De.heap_max]=sr,Ut[ee*2]=Ut[rt*2]+Ut[sr*2],De.depth[ee]=(De.depth[rt]>=De.depth[sr]?De.depth[rt]:De.depth[sr])+1,Ut[rt*2+1]=Ut[sr*2+1]=ee,De.heap[1]=ee++,ge(De,Ut,1);while(De.heap_len>=2);De.heap[--De.heap_max]=De.heap[1],Je(De,St),it(Ut,Fr,De.bl_count)}function wt(De,St,Ut){var ir,Rt=-1,$t,rt=St[0*2+1],sr=0,Fr=7,ee=4;for(rt===0&&(Fr=138,ee=3),St[(Ut+1)*2+1]=65535,ir=0;ir<=Ut;ir++)$t=rt,rt=St[(ir+1)*2+1],!(++sr<Fr&&$t===rt)&&(sr<ee?De.bl_tree[$t*2]+=sr:$t!==0?($t!==Rt&&De.bl_tree[$t*2]++,De.bl_tree[re*2]++):sr<=10?De.bl_tree[te*2]++:De.bl_tree[ye*2]++,sr=0,Rt=$t,rt===0?(Fr=138,ee=3):$t===rt?(Fr=6,ee=3):(Fr=7,ee=4))}function Ft(De,St,Ut){var ir,Rt=-1,$t,rt=St[0*2+1],sr=0,Fr=7,ee=4;for(rt===0&&(Fr=138,ee=3),ir=0;ir<=Ut;ir++)if($t=rt,rt=St[(ir+1)*2+1],!(++sr<Fr&&$t===rt)){if(sr<ee)do tt(De,$t,De.bl_tree);while(--sr!==0);else $t!==0?($t!==Rt&&(tt(De,$t,De.bl_tree),sr--),tt(De,re,De.bl_tree),qe(De,sr-3,2)):sr<=10?(tt(De,te,De.bl_tree),qe(De,sr-3,3)):(tt(De,ye,De.bl_tree),qe(De,sr-11,7));sr=0,Rt=$t,rt===0?(Fr=138,ee=3):$t===rt?(Fr=6,ee=3):(Fr=7,ee=4)}}function Wt(De){var St;for(wt(De,De.dyn_ltree,De.l_desc.max_code),wt(De,De.dyn_dtree,De.d_desc.max_code),et(De,De.bl_desc),St=U-1;St>=3&&De.bl_tree[Pe[St]*2+1]===0;St--);return De.opt_len+=3*(St+1)+5+5+4,St}function or(De,St,Ut,ir){var Rt;for(qe(De,St-257,5),qe(De,Ut-1,5),qe(De,ir-4,4),Rt=0;Rt<ir;Rt++)qe(De,De.bl_tree[Pe[Rt]*2+1],3);Ft(De,De.dyn_ltree,St-1),Ft(De,De.dyn_dtree,Ut-1)}function Or(De){var St=4093624447,Ut;for(Ut=0;Ut<=31;Ut++,St>>>=1)if(St&1&&De.dyn_ltree[Ut*2]!==0)return S;if(De.dyn_ltree[9*2]!==0||De.dyn_ltree[10*2]!==0||De.dyn_ltree[13*2]!==0)return D;for(Ut=32;Ut<P;Ut++)if(De.dyn_ltree[Ut*2]!==0)return D;return S}var xr=!1;function Tr(De){xr||(ze(),xr=!0),De.l_desc=new Ke(De.dyn_ltree,Ae),De.d_desc=new Ke(De.dyn_dtree,se),De.bl_desc=new Ke(De.bl_tree,pe),De.bi_buf=0,De.bi_valid=0,de(De)}function br(De,St,Ut,ir){qe(De,(m<<1)+(ir?1:0),3),be(De,St,Ut)}function fr(De){qe(De,y<<1,3),tt(De,J,Me),We(De)}function Vr(De,St,Ut,ir){var Rt,$t,rt=0;De.level>0?(De.strm.data_type===w&&(De.strm.data_type=Or(De)),et(De,De.l_desc),et(De,De.d_desc),rt=Wt(De),Rt=De.opt_len+3+7>>>3,$t=De.static_len+3+7>>>3,$t<=Rt&&(Rt=$t)):Rt=$t=Ut+5,Ut+4<=Rt&&St!==-1?br(De,St,Ut,ir):De.strategy===t||$t===Rt?(qe(De,(y<<1)+(ir?1:0),3),le(De,Me,He)):(qe(De,(p<<1)+(ir?1:0),3),or(De,De.l_desc.max_code+1,De.d_desc.max_code+1,rt+1),le(De,De.dyn_ltree,De.dyn_dtree)),de(De),ir&&ve(De)}function Ir(De,St,Ut){return De.pending_buf[De.d_buf+De.last_lit*2]=St>>>8&255,De.pending_buf[De.d_buf+De.last_lit*2+1]=St&255,De.pending_buf[De.l_buf+De.last_lit]=Ut&255,De.last_lit++,St===0?De.dyn_ltree[Ut*2]++:(De.matches++,St--,De.dyn_ltree[(ht[Ut]+P+1)*2]++,De.dyn_dtree[_e(St)*2]++),De.last_lit===De.lit_bufsize-1}b._tr_init=Tr,b._tr_stored_block=br,b._tr_flush_block=Vr,b._tr_tally=Ir,b._tr_align=fr},{"../utils/common":36}],46:[function(_,k,b){function T(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}k.exports=T},{}],47:[function(_,k,b){arguments[4][33][0].apply(b,arguments)},{dup:33}],48:[function(_,k,b){(function(y){var t=_("base64-js"),S=_("ieee754"),D=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;b.Buffer=y,b.SlowBuffer=Z,b.INSPECT_MAX_BYTES=50;var w=2147483647;b.kMaxLength=w,y.TYPED_ARRAY_SUPPORT=E(),!y.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function E(){try{var Oe=new Uint8Array(1),ge={foo:function(){return 42}};return Object.setPrototypeOf(ge,Uint8Array.prototype),Object.setPrototypeOf(Oe,ge),Oe.foo()===42}catch{return!1}}Object.defineProperty(y.prototype,"parent",{enumerable:!0,get:function(){if(y.isBuffer(this))return this.buffer}}),Object.defineProperty(y.prototype,"offset",{enumerable:!0,get:function(){if(y.isBuffer(this))return this.byteOffset}});function m(Oe){if(Oe>w)throw new RangeError('The value "'+Oe+'" is invalid for option "size"');var ge=new Uint8Array(Oe);return Object.setPrototypeOf(ge,y.prototype),ge}function y(Oe,ge,le){if(typeof Oe=="number"){if(typeof ge=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return A(Oe)}return p(Oe,ge,le)}typeof Symbol<"u"&&Symbol.species!=null&&y[Symbol.species]===y&&Object.defineProperty(y,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),y.poolSize=8192;function p(Oe,ge,le){if(typeof Oe=="string")return P(Oe,ge);if(ArrayBuffer.isView(Oe))return x(Oe);if(Oe==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Oe);if(de(Oe,ArrayBuffer)||Oe&&de(Oe.buffer,ArrayBuffer))return O(Oe,ge,le);if(typeof Oe=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var et=Oe.valueOf&&Oe.valueOf();if(et!=null&&et!==Oe)return y.from(et,ge,le);var wt=U(Oe);if(wt)return wt;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof Oe[Symbol.toPrimitive]=="function")return y.from(Oe[Symbol.toPrimitive]("string"),ge,le);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Oe)}y.from=function(Oe,ge,le){return p(Oe,ge,le)},Object.setPrototypeOf(y.prototype,Uint8Array.prototype),Object.setPrototypeOf(y,Uint8Array);function C(Oe){if(typeof Oe!="number")throw new TypeError('"size" argument must be of type number');if(Oe<0)throw new RangeError('The value "'+Oe+'" is invalid for option "size"')}function z(Oe,ge,le){return C(Oe),Oe<=0?m(Oe):ge!==void 0?typeof le=="string"?m(Oe).fill(ge,le):m(Oe).fill(ge):m(Oe)}y.alloc=function(Oe,ge,le){return z(Oe,ge,le)};function A(Oe){return C(Oe),m(Oe<0?0:G(Oe)|0)}y.allocUnsafe=function(Oe){return A(Oe)},y.allocUnsafeSlow=function(Oe){return A(Oe)};function P(Oe,ge){if((typeof ge!="string"||ge==="")&&(ge="utf8"),!y.isEncoding(ge))throw new TypeError("Unknown encoding: "+ge);var le=X(Oe,ge)|0,et=m(le),wt=et.write(Oe,ge);return wt!==le&&(et=et.slice(0,wt)),et}function x(Oe){for(var ge=Oe.length<0?0:G(Oe.length)|0,le=m(ge),et=0;et<ge;et+=1)le[et]=Oe[et]&255;return le}function O(Oe,ge,le){if(ge<0||Oe.byteLength<ge)throw new RangeError('"offset" is outside of buffer bounds');if(Oe.byteLength<ge+(le||0))throw new RangeError('"length" is outside of buffer bounds');var et;return ge===void 0&&le===void 0?et=new Uint8Array(Oe):le===void 0?et=new Uint8Array(Oe,ge):et=new Uint8Array(Oe,ge,le),Object.setPrototypeOf(et,y.prototype),et}function U(Oe){if(y.isBuffer(Oe)){var ge=G(Oe.length)|0,le=m(ge);return le.length===0||Oe.copy(le,0,0,ge),le}if(Oe.length!==void 0)return typeof Oe.length!="number"||ve(Oe.length)?m(0):x(Oe);if(Oe.type==="Buffer"&&Array.isArray(Oe.data))return x(Oe.data)}function G(Oe){if(Oe>=w)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+w.toString(16)+" bytes");return Oe|0}function Z(Oe){return+Oe!=Oe&&(Oe=0),y.alloc(+Oe)}y.isBuffer=function(ge){return ge!=null&&ge._isBuffer===!0&&ge!==y.prototype},y.compare=function(ge,le){if(de(ge,Uint8Array)&&(ge=y.from(ge,ge.offset,ge.byteLength)),de(le,Uint8Array)&&(le=y.from(le,le.offset,le.byteLength)),!y.isBuffer(ge)||!y.isBuffer(le))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(ge===le)return 0;for(var et=ge.length,wt=le.length,Ft=0,Wt=Math.min(et,wt);Ft<Wt;++Ft)if(ge[Ft]!==le[Ft]){et=ge[Ft],wt=le[Ft];break}return et<wt?-1:wt<et?1:0},y.isEncoding=function(ge){switch(String(ge).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},y.concat=function(ge,le){if(!Array.isArray(ge))throw new TypeError('"list" argument must be an Array of Buffers');if(ge.length===0)return y.alloc(0);var et;if(le===void 0)for(le=0,et=0;et<ge.length;++et)le+=ge[et].length;var wt=y.allocUnsafe(le),Ft=0;for(et=0;et<ge.length;++et){var Wt=ge[et];if(de(Wt,Uint8Array)&&(Wt=y.from(Wt)),!y.isBuffer(Wt))throw new TypeError('"list" argument must be an Array of Buffers');Wt.copy(wt,Ft),Ft+=Wt.length}return wt};function X(Oe,ge){if(y.isBuffer(Oe))return Oe.length;if(ArrayBuffer.isView(Oe)||de(Oe,ArrayBuffer))return Oe.byteLength;if(typeof Oe!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof Oe);var le=Oe.length,et=arguments.length>2&&arguments[2]===!0;if(!et&&le===0)return 0;for(var wt=!1;;)switch(ge){case"ascii":case"latin1":case"binary":return le;case"utf8":case"utf-8":return Ge(Oe).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return le*2;case"hex":return le>>>1;case"base64":return it(Oe).length;default:if(wt)return et?-1:Ge(Oe).length;ge=(""+ge).toLowerCase(),wt=!0}}y.byteLength=X;function W(Oe,ge,le){var et=!1;if((ge===void 0||ge<0)&&(ge=0),ge>this.length||((le===void 0||le>this.length)&&(le=this.length),le<=0)||(le>>>=0,ge>>>=0,le<=ge))return"";for(Oe||(Oe="utf8");;)switch(Oe){case"hex":return Be(this,ge,le);case"utf8":case"utf-8":return He(this,ge,le);case"ascii":return Fe(this,ge,le);case"latin1":case"binary":return Ce(this,ge,le);case"base64":return Me(this,ge,le);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ae(this,ge,le);default:if(et)throw new TypeError("Unknown encoding: "+Oe);Oe=(Oe+"").toLowerCase(),et=!0}}y.prototype._isBuffer=!0;function J(Oe,ge,le){var et=Oe[ge];Oe[ge]=Oe[le],Oe[le]=et}y.prototype.swap16=function(){var ge=this.length;if(ge%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var le=0;le<ge;le+=2)J(this,le,le+1);return this},y.prototype.swap32=function(){var ge=this.length;if(ge%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var le=0;le<ge;le+=4)J(this,le,le+3),J(this,le+1,le+2);return this},y.prototype.swap64=function(){var ge=this.length;if(ge%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var le=0;le<ge;le+=8)J(this,le,le+7),J(this,le+1,le+6),J(this,le+2,le+5),J(this,le+3,le+4);return this},y.prototype.toString=function(){var ge=this.length;return ge===0?"":arguments.length===0?He(this,0,ge):W.apply(this,arguments)},y.prototype.toLocaleString=y.prototype.toString,y.prototype.equals=function(ge){if(!y.isBuffer(ge))throw new TypeError("Argument must be a Buffer");return this===ge?!0:y.compare(this,ge)===0},y.prototype.inspect=function(){var ge="",le=b.INSPECT_MAX_BYTES;return ge=this.toString("hex",0,le).replace(/(.{2})/g,"$1 ").trim(),this.length>le&&(ge+=" ... "),"<Buffer "+ge+">"},D&&(y.prototype[D]=y.prototype.inspect),y.prototype.compare=function(ge,le,et,wt,Ft){if(de(ge,Uint8Array)&&(ge=y.from(ge,ge.offset,ge.byteLength)),!y.isBuffer(ge))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof ge);if(le===void 0&&(le=0),et===void 0&&(et=ge?ge.length:0),wt===void 0&&(wt=0),Ft===void 0&&(Ft=this.length),le<0||et>ge.length||wt<0||Ft>this.length)throw new RangeError("out of range index");if(wt>=Ft&&le>=et)return 0;if(wt>=Ft)return-1;if(le>=et)return 1;if(le>>>=0,et>>>=0,wt>>>=0,Ft>>>=0,this===ge)return 0;for(var Wt=Ft-wt,or=et-le,Or=Math.min(Wt,or),xr=this.slice(wt,Ft),Tr=ge.slice(le,et),br=0;br<Or;++br)if(xr[br]!==Tr[br]){Wt=xr[br],or=Tr[br];break}return Wt<or?-1:or<Wt?1:0};function re(Oe,ge,le,et,wt){if(Oe.length===0)return-1;if(typeof le=="string"?(et=le,le=0):le>2147483647?le=2147483647:le<-2147483648&&(le=-2147483648),le=+le,ve(le)&&(le=wt?0:Oe.length-1),le<0&&(le=Oe.length+le),le>=Oe.length){if(wt)return-1;le=Oe.length-1}else if(le<0)if(wt)le=0;else return-1;if(typeof ge=="string"&&(ge=y.from(ge,et)),y.isBuffer(ge))return ge.length===0?-1:te(Oe,ge,le,et,wt);if(typeof ge=="number")return ge=ge&255,typeof Uint8Array.prototype.indexOf=="function"?wt?Uint8Array.prototype.indexOf.call(Oe,ge,le):Uint8Array.prototype.lastIndexOf.call(Oe,ge,le):te(Oe,[ge],le,et,wt);throw new TypeError("val must be string, number or Buffer")}function te(Oe,ge,le,et,wt){var Ft=1,Wt=Oe.length,or=ge.length;if(et!==void 0&&(et=String(et).toLowerCase(),et==="ucs2"||et==="ucs-2"||et==="utf16le"||et==="utf-16le")){if(Oe.length<2||ge.length<2)return-1;Ft=2,Wt/=2,or/=2,le/=2}function Or(Vr,Ir){return Ft===1?Vr[Ir]:Vr.readUInt16BE(Ir*Ft)}var xr;if(wt){var Tr=-1;for(xr=le;xr<Wt;xr++)if(Or(Oe,xr)===Or(ge,Tr===-1?0:xr-Tr)){if(Tr===-1&&(Tr=xr),xr-Tr+1===or)return Tr*Ft}else Tr!==-1&&(xr-=xr-Tr),Tr=-1}else for(le+or>Wt&&(le=Wt-or),xr=le;xr>=0;xr--){for(var br=!0,fr=0;fr<or;fr++)if(Or(Oe,xr+fr)!==Or(ge,fr)){br=!1;break}if(br)return xr}return-1}y.prototype.includes=function(ge,le,et){return this.indexOf(ge,le,et)!==-1},y.prototype.indexOf=function(ge,le,et){return re(this,ge,le,et,!0)},y.prototype.lastIndexOf=function(ge,le,et){return re(this,ge,le,et,!1)};function ye(Oe,ge,le,et){le=Number(le)||0;var wt=Oe.length-le;et?(et=Number(et),et>wt&&(et=wt)):et=wt;var Ft=ge.length;et>Ft/2&&(et=Ft/2);for(var Wt=0;Wt<et;++Wt){var or=parseInt(ge.substr(Wt*2,2),16);if(ve(or))return Wt;Oe[le+Wt]=or}return Wt}function ue(Oe,ge,le,et){return ze(Ge(ge,Oe.length-le),Oe,le,et)}function Se(Oe,ge,le,et){return ze(We(ge),Oe,le,et)}function Le(Oe,ge,le,et){return Se(Oe,ge,le,et)}function Pe(Oe,ge,le,et){return ze(it(ge),Oe,le,et)}function Ee(Oe,ge,le,et){return ze(Je(ge,Oe.length-le),Oe,le,et)}y.prototype.write=function(ge,le,et,wt){if(le===void 0)wt="utf8",et=this.length,le=0;else if(et===void 0&&typeof le=="string")wt=le,et=this.length,le=0;else if(isFinite(le))le=le>>>0,isFinite(et)?(et=et>>>0,wt===void 0&&(wt="utf8")):(wt=et,et=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var Ft=this.length-le;if((et===void 0||et>Ft)&&(et=Ft),ge.length>0&&(et<0||le<0)||le>this.length)throw new RangeError("Attempt to write outside buffer bounds");wt||(wt="utf8");for(var Wt=!1;;)switch(wt){case"hex":return ye(this,ge,le,et);case"utf8":case"utf-8":return ue(this,ge,le,et);case"ascii":return Se(this,ge,le,et);case"latin1":case"binary":return Le(this,ge,le,et);case"base64":return Pe(this,ge,le,et);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ee(this,ge,le,et);default:if(Wt)throw new TypeError("Unknown encoding: "+wt);wt=(""+wt).toLowerCase(),Wt=!0}},y.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Me(Oe,ge,le){return ge===0&&le===Oe.length?t.fromByteArray(Oe):t.fromByteArray(Oe.slice(ge,le))}function He(Oe,ge,le){le=Math.min(Oe.length,le);for(var et=[],wt=ge;wt<le;){var Ft=Oe[wt],Wt=null,or=Ft>239?4:Ft>223?3:Ft>191?2:1;if(wt+or<=le){var Or,xr,Tr,br;switch(or){case 1:Ft<128&&(Wt=Ft);break;case 2:Or=Oe[wt+1],(Or&192)===128&&(br=(Ft&31)<<6|Or&63,br>127&&(Wt=br));break;case 3:Or=Oe[wt+1],xr=Oe[wt+2],(Or&192)===128&&(xr&192)===128&&(br=(Ft&15)<<12|(Or&63)<<6|xr&63,br>2047&&(br<55296||br>57343)&&(Wt=br));break;case 4:Or=Oe[wt+1],xr=Oe[wt+2],Tr=Oe[wt+3],(Or&192)===128&&(xr&192)===128&&(Tr&192)===128&&(br=(Ft&15)<<18|(Or&63)<<12|(xr&63)<<6|Tr&63,br>65535&&br<1114112&&(Wt=br))}}Wt===null?(Wt=65533,or=1):Wt>65535&&(Wt-=65536,et.push(Wt>>>10&1023|55296),Wt=56320|Wt&1023),et.push(Wt),wt+=or}return ht(et)}var nt=4096;function ht(Oe){var ge=Oe.length;if(ge<=nt)return String.fromCharCode.apply(String,Oe);for(var le="",et=0;et<ge;)le+=String.fromCharCode.apply(String,Oe.slice(et,et+=nt));return le}function Fe(Oe,ge,le){var et="";le=Math.min(Oe.length,le);for(var wt=ge;wt<le;++wt)et+=String.fromCharCode(Oe[wt]&127);return et}function Ce(Oe,ge,le){var et="";le=Math.min(Oe.length,le);for(var wt=ge;wt<le;++wt)et+=String.fromCharCode(Oe[wt]);return et}function Be(Oe,ge,le){var et=Oe.length;(!ge||ge<0)&&(ge=0),(!le||le<0||le>et)&&(le=et);for(var wt="",Ft=ge;Ft<le;++Ft)wt+=be[Oe[Ft]];return wt}function Ae(Oe,ge,le){for(var et=Oe.slice(ge,le),wt="",Ft=0;Ft<et.length;Ft+=2)wt+=String.fromCharCode(et[Ft]+et[Ft+1]*256);return wt}y.prototype.slice=function(ge,le){var et=this.length;ge=~~ge,le=le===void 0?et:~~le,ge<0?(ge+=et,ge<0&&(ge=0)):ge>et&&(ge=et),le<0?(le+=et,le<0&&(le=0)):le>et&&(le=et),le<ge&&(le=ge);var wt=this.subarray(ge,le);return Object.setPrototypeOf(wt,y.prototype),wt};function se(Oe,ge,le){if(Oe%1!==0||Oe<0)throw new RangeError("offset is not uint");if(Oe+ge>le)throw new RangeError("Trying to access beyond buffer length")}y.prototype.readUIntLE=function(ge,le,et){ge=ge>>>0,le=le>>>0,et||se(ge,le,this.length);for(var wt=this[ge],Ft=1,Wt=0;++Wt<le&&(Ft*=256);)wt+=this[ge+Wt]*Ft;return wt},y.prototype.readUIntBE=function(ge,le,et){ge=ge>>>0,le=le>>>0,et||se(ge,le,this.length);for(var wt=this[ge+--le],Ft=1;le>0&&(Ft*=256);)wt+=this[ge+--le]*Ft;return wt},y.prototype.readUInt8=function(ge,le){return ge=ge>>>0,le||se(ge,1,this.length),this[ge]},y.prototype.readUInt16LE=function(ge,le){return ge=ge>>>0,le||se(ge,2,this.length),this[ge]|this[ge+1]<<8},y.prototype.readUInt16BE=function(ge,le){return ge=ge>>>0,le||se(ge,2,this.length),this[ge]<<8|this[ge+1]},y.prototype.readUInt32LE=function(ge,le){return ge=ge>>>0,le||se(ge,4,this.length),(this[ge]|this[ge+1]<<8|this[ge+2]<<16)+this[ge+3]*16777216},y.prototype.readUInt32BE=function(ge,le){return ge=ge>>>0,le||se(ge,4,this.length),this[ge]*16777216+(this[ge+1]<<16|this[ge+2]<<8|this[ge+3])},y.prototype.readIntLE=function(ge,le,et){ge=ge>>>0,le=le>>>0,et||se(ge,le,this.length);for(var wt=this[ge],Ft=1,Wt=0;++Wt<le&&(Ft*=256);)wt+=this[ge+Wt]*Ft;return Ft*=128,wt>=Ft&&(wt-=Math.pow(2,8*le)),wt},y.prototype.readIntBE=function(ge,le,et){ge=ge>>>0,le=le>>>0,et||se(ge,le,this.length);for(var wt=le,Ft=1,Wt=this[ge+--wt];wt>0&&(Ft*=256);)Wt+=this[ge+--wt]*Ft;return Ft*=128,Wt>=Ft&&(Wt-=Math.pow(2,8*le)),Wt},y.prototype.readInt8=function(ge,le){return ge=ge>>>0,le||se(ge,1,this.length),this[ge]&128?(255-this[ge]+1)*-1:this[ge]},y.prototype.readInt16LE=function(ge,le){ge=ge>>>0,le||se(ge,2,this.length);var et=this[ge]|this[ge+1]<<8;return et&32768?et|4294901760:et},y.prototype.readInt16BE=function(ge,le){ge=ge>>>0,le||se(ge,2,this.length);var et=this[ge+1]|this[ge]<<8;return et&32768?et|4294901760:et},y.prototype.readInt32LE=function(ge,le){return ge=ge>>>0,le||se(ge,4,this.length),this[ge]|this[ge+1]<<8|this[ge+2]<<16|this[ge+3]<<24},y.prototype.readInt32BE=function(ge,le){return ge=ge>>>0,le||se(ge,4,this.length),this[ge]<<24|this[ge+1]<<16|this[ge+2]<<8|this[ge+3]},y.prototype.readFloatLE=function(ge,le){return ge=ge>>>0,le||se(ge,4,this.length),S.read(this,ge,!0,23,4)},y.prototype.readFloatBE=function(ge,le){return ge=ge>>>0,le||se(ge,4,this.length),S.read(this,ge,!1,23,4)},y.prototype.readDoubleLE=function(ge,le){return ge=ge>>>0,le||se(ge,8,this.length),S.read(this,ge,!0,52,8)},y.prototype.readDoubleBE=function(ge,le){return ge=ge>>>0,le||se(ge,8,this.length),S.read(this,ge,!1,52,8)};function pe(Oe,ge,le,et,wt,Ft){if(!y.isBuffer(Oe))throw new TypeError('"buffer" argument must be a Buffer instance');if(ge>wt||ge<Ft)throw new RangeError('"value" argument is out of bounds');if(le+et>Oe.length)throw new RangeError("Index out of range")}y.prototype.writeUIntLE=function(ge,le,et,wt){if(ge=+ge,le=le>>>0,et=et>>>0,!wt){var Ft=Math.pow(2,8*et)-1;pe(this,ge,le,et,Ft,0)}var Wt=1,or=0;for(this[le]=ge&255;++or<et&&(Wt*=256);)this[le+or]=ge/Wt&255;return le+et},y.prototype.writeUIntBE=function(ge,le,et,wt){if(ge=+ge,le=le>>>0,et=et>>>0,!wt){var Ft=Math.pow(2,8*et)-1;pe(this,ge,le,et,Ft,0)}var Wt=et-1,or=1;for(this[le+Wt]=ge&255;--Wt>=0&&(or*=256);)this[le+Wt]=ge/or&255;return le+et},y.prototype.writeUInt8=function(ge,le,et){return ge=+ge,le=le>>>0,et||pe(this,ge,le,1,255,0),this[le]=ge&255,le+1},y.prototype.writeUInt16LE=function(ge,le,et){return ge=+ge,le=le>>>0,et||pe(this,ge,le,2,65535,0),this[le]=ge&255,this[le+1]=ge>>>8,le+2},y.prototype.writeUInt16BE=function(ge,le,et){return ge=+ge,le=le>>>0,et||pe(this,ge,le,2,65535,0),this[le]=ge>>>8,this[le+1]=ge&255,le+2},y.prototype.writeUInt32LE=function(ge,le,et){return ge=+ge,le=le>>>0,et||pe(this,ge,le,4,4294967295,0),this[le+3]=ge>>>24,this[le+2]=ge>>>16,this[le+1]=ge>>>8,this[le]=ge&255,le+4},y.prototype.writeUInt32BE=function(ge,le,et){return ge=+ge,le=le>>>0,et||pe(this,ge,le,4,4294967295,0),this[le]=ge>>>24,this[le+1]=ge>>>16,this[le+2]=ge>>>8,this[le+3]=ge&255,le+4},y.prototype.writeIntLE=function(ge,le,et,wt){if(ge=+ge,le=le>>>0,!wt){var Ft=Math.pow(2,8*et-1);pe(this,ge,le,et,Ft-1,-Ft)}var Wt=0,or=1,Or=0;for(this[le]=ge&255;++Wt<et&&(or*=256);)ge<0&&Or===0&&this[le+Wt-1]!==0&&(Or=1),this[le+Wt]=(ge/or>>0)-Or&255;return le+et},y.prototype.writeIntBE=function(ge,le,et,wt){if(ge=+ge,le=le>>>0,!wt){var Ft=Math.pow(2,8*et-1);pe(this,ge,le,et,Ft-1,-Ft)}var Wt=et-1,or=1,Or=0;for(this[le+Wt]=ge&255;--Wt>=0&&(or*=256);)ge<0&&Or===0&&this[le+Wt+1]!==0&&(Or=1),this[le+Wt]=(ge/or>>0)-Or&255;return le+et},y.prototype.writeInt8=function(ge,le,et){return ge=+ge,le=le>>>0,et||pe(this,ge,le,1,127,-128),ge<0&&(ge=255+ge+1),this[le]=ge&255,le+1},y.prototype.writeInt16LE=function(ge,le,et){return ge=+ge,le=le>>>0,et||pe(this,ge,le,2,32767,-32768),this[le]=ge&255,this[le+1]=ge>>>8,le+2},y.prototype.writeInt16BE=function(ge,le,et){return ge=+ge,le=le>>>0,et||pe(this,ge,le,2,32767,-32768),this[le]=ge>>>8,this[le+1]=ge&255,le+2},y.prototype.writeInt32LE=function(ge,le,et){return ge=+ge,le=le>>>0,et||pe(this,ge,le,4,2147483647,-2147483648),this[le]=ge&255,this[le+1]=ge>>>8,this[le+2]=ge>>>16,this[le+3]=ge>>>24,le+4},y.prototype.writeInt32BE=function(ge,le,et){return ge=+ge,le=le>>>0,et||pe(this,ge,le,4,2147483647,-2147483648),ge<0&&(ge=4294967295+ge+1),this[le]=ge>>>24,this[le+1]=ge>>>16,this[le+2]=ge>>>8,this[le+3]=ge&255,le+4};function Ke(Oe,ge,le,et,wt,Ft){if(le+et>Oe.length)throw new RangeError("Index out of range");if(le<0)throw new RangeError("Index out of range")}function _e(Oe,ge,le,et,wt){return ge=+ge,le=le>>>0,wt||Ke(Oe,ge,le,4),S.write(Oe,ge,le,et,23,4),le+4}y.prototype.writeFloatLE=function(ge,le,et){return _e(this,ge,le,!0,et)},y.prototype.writeFloatBE=function(ge,le,et){return _e(this,ge,le,!1,et)};function ke(Oe,ge,le,et,wt){return ge=+ge,le=le>>>0,wt||Ke(Oe,ge,le,8),S.write(Oe,ge,le,et,52,8),le+8}y.prototype.writeDoubleLE=function(ge,le,et){return ke(this,ge,le,!0,et)},y.prototype.writeDoubleBE=function(ge,le,et){return ke(this,ge,le,!1,et)},y.prototype.copy=function(ge,le,et,wt){if(!y.isBuffer(ge))throw new TypeError("argument should be a Buffer");if(et||(et=0),!wt&&wt!==0&&(wt=this.length),le>=ge.length&&(le=ge.length),le||(le=0),wt>0&&wt<et&&(wt=et),wt===et||ge.length===0||this.length===0)return 0;if(le<0)throw new RangeError("targetStart out of bounds");if(et<0||et>=this.length)throw new RangeError("Index out of range");if(wt<0)throw new RangeError("sourceEnd out of bounds");wt>this.length&&(wt=this.length),ge.length-le<wt-et&&(wt=ge.length-le+et);var Ft=wt-et;if(this===ge&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(le,et,wt);else if(this===ge&&et<le&&le<wt)for(var Wt=Ft-1;Wt>=0;--Wt)ge[Wt+le]=this[Wt+et];else Uint8Array.prototype.set.call(ge,this.subarray(et,wt),le);return Ft},y.prototype.fill=function(ge,le,et,wt){if(typeof ge=="string"){if(typeof le=="string"?(wt=le,le=0,et=this.length):typeof et=="string"&&(wt=et,et=this.length),wt!==void 0&&typeof wt!="string")throw new TypeError("encoding must be a string");if(typeof wt=="string"&&!y.isEncoding(wt))throw new TypeError("Unknown encoding: "+wt);if(ge.length===1){var Ft=ge.charCodeAt(0);(wt==="utf8"&&Ft<128||wt==="latin1")&&(ge=Ft)}}else typeof ge=="number"?ge=ge&255:typeof ge=="boolean"&&(ge=Number(ge));if(le<0||this.length<le||this.length<et)throw new RangeError("Out of range index");if(et<=le)return this;le=le>>>0,et=et===void 0?this.length:et>>>0,ge||(ge=0);var Wt;if(typeof ge=="number")for(Wt=le;Wt<et;++Wt)this[Wt]=ge;else{var or=y.isBuffer(ge)?ge:y.from(ge,wt),Or=or.length;if(Or===0)throw new TypeError('The value "'+ge+'" is invalid for argument "value"');for(Wt=0;Wt<et-le;++Wt)this[Wt+le]=or[Wt%Or]}return this};var qe=/[^+/0-9A-Za-z-_]/g;function tt(Oe){if(Oe=Oe.split("=")[0],Oe=Oe.trim().replace(qe,""),Oe.length<2)return"";for(;Oe.length%4!==0;)Oe=Oe+"=";return Oe}function Ge(Oe,ge){ge=ge||1/0;for(var le,et=Oe.length,wt=null,Ft=[],Wt=0;Wt<et;++Wt){if(le=Oe.charCodeAt(Wt),le>55295&&le<57344){if(!wt){if(le>56319){(ge-=3)>-1&&Ft.push(239,191,189);continue}else if(Wt+1===et){(ge-=3)>-1&&Ft.push(239,191,189);continue}wt=le;continue}if(le<56320){(ge-=3)>-1&&Ft.push(239,191,189),wt=le;continue}le=(wt-55296<<10|le-56320)+65536}else wt&&(ge-=3)>-1&&Ft.push(239,191,189);if(wt=null,le<128){if((ge-=1)<0)break;Ft.push(le)}else if(le<2048){if((ge-=2)<0)break;Ft.push(le>>6|192,le&63|128)}else if(le<65536){if((ge-=3)<0)break;Ft.push(le>>12|224,le>>6&63|128,le&63|128)}else if(le<1114112){if((ge-=4)<0)break;Ft.push(le>>18|240,le>>12&63|128,le>>6&63|128,le&63|128)}else throw new Error("Invalid code point")}return Ft}function We(Oe){for(var ge=[],le=0;le<Oe.length;++le)ge.push(Oe.charCodeAt(le)&255);return ge}function Je(Oe,ge){for(var le,et,wt,Ft=[],Wt=0;Wt<Oe.length&&!((ge-=2)<0);++Wt)le=Oe.charCodeAt(Wt),et=le>>8,wt=le%256,Ft.push(wt),Ft.push(et);return Ft}function it(Oe){return t.toByteArray(tt(Oe))}function ze(Oe,ge,le,et){for(var wt=0;wt<et&&!(wt+le>=ge.length||wt>=Oe.length);++wt)ge[wt+le]=Oe[wt];return wt}function de(Oe,ge){return Oe instanceof ge||Oe!=null&&Oe.constructor!=null&&Oe.constructor.name!=null&&Oe.constructor.name===ge.name}function ve(Oe){return Oe!==Oe}var be=function(){for(var Oe="0123456789abcdef",ge=new Array(256),le=0;le<16;++le)for(var et=le*16,wt=0;wt<16;++wt)ge[et+wt]=Oe[le]+Oe[wt];return ge}()}).call(this,_("buffer").Buffer)},{"base64-js":29,buffer:48,ieee754:73}],49:[function(_,k,b){var T=_("buffer").Buffer;k.exports=function(t,S){if(T.isBuffer(t)&&T.isBuffer(S)){if(typeof t.equals=="function")return t.equals(S);if(t.length!==S.length)return!1;for(var D=0;D<t.length;D++)if(t[D]!==S[D])return!1;return!0}}},{buffer:48}],50:[function(_,k,b){k.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},{}],51:[function(_,k,b){(function(T){function t(G){return Array.isArray?Array.isArray(G):U(G)==="[object Array]"}b.isArray=t;function S(G){return typeof G=="boolean"}b.isBoolean=S;function D(G){return G===null}b.isNull=D;function w(G){return G==null}b.isNullOrUndefined=w;function E(G){return typeof G=="number"}b.isNumber=E;function m(G){return typeof G=="string"}b.isString=m;function y(G){return typeof G=="symbol"}b.isSymbol=y;function p(G){return G===void 0}b.isUndefined=p;function C(G){return U(G)==="[object RegExp]"}b.isRegExp=C;function z(G){return typeof G=="object"&&G!==null}b.isObject=z;function A(G){return U(G)==="[object Date]"}b.isDate=A;function P(G){return U(G)==="[object Error]"||G instanceof Error}b.isError=P;function x(G){return typeof G=="function"}b.isFunction=x;function O(G){return G===null||typeof G=="boolean"||typeof G=="number"||typeof G=="string"||typeof G=="symbol"||typeof G>"u"}b.isPrimitive=O,b.isBuffer=T.isBuffer;function U(G){return Object.prototype.toString.call(G)}}).call(this,{isBuffer:_("../../is-buffer/index.js")})},{"../../is-buffer/index.js":76}],52:[function(_,k,b){var T=Object.create||re,t=Object.keys||te,S=Function.prototype.bind||ye;function D(){(!this._events||!Object.prototype.hasOwnProperty.call(this,"_events"))&&(this._events=T(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}k.exports=D,D.EventEmitter=D,D.prototype._events=void 0,D.prototype._maxListeners=void 0;var w=10,E;try{var m={};Object.defineProperty&&Object.defineProperty(m,"x",{value:0}),E=m.x===0}catch{E=!1}E?Object.defineProperty(D,"defaultMaxListeners",{enumerable:!0,get:function(){return w},set:function(ue){if(typeof ue!="number"||ue<0||ue!==ue)throw new TypeError('"defaultMaxListeners" must be a positive number');w=ue}}):D.defaultMaxListeners=w,D.prototype.setMaxListeners=function(Se){if(typeof Se!="number"||Se<0||isNaN(Se))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=Se,this};function y(ue){return ue._maxListeners===void 0?D.defaultMaxListeners:ue._maxListeners}D.prototype.getMaxListeners=function(){return y(this)};function p(ue,Se,Le){if(Se)ue.call(Le);else for(var Pe=ue.length,Ee=W(ue,Pe),Me=0;Me<Pe;++Me)Ee[Me].call(Le)}function C(ue,Se,Le,Pe){if(Se)ue.call(Le,Pe);else for(var Ee=ue.length,Me=W(ue,Ee),He=0;He<Ee;++He)Me[He].call(Le,Pe)}function z(ue,Se,Le,Pe,Ee){if(Se)ue.call(Le,Pe,Ee);else for(var Me=ue.length,He=W(ue,Me),nt=0;nt<Me;++nt)He[nt].call(Le,Pe,Ee)}function A(ue,Se,Le,Pe,Ee,Me){if(Se)ue.call(Le,Pe,Ee,Me);else for(var He=ue.length,nt=W(ue,He),ht=0;ht<He;++ht)nt[ht].call(Le,Pe,Ee,Me)}function P(ue,Se,Le,Pe){if(Se)ue.apply(Le,Pe);else for(var Ee=ue.length,Me=W(ue,Ee),He=0;He<Ee;++He)Me[He].apply(Le,Pe)}D.prototype.emit=function(Se){var Le,Pe,Ee,Me,He,nt,ht=Se==="error";if(nt=this._events,nt)ht=ht&&nt.error==null;else if(!ht)return!1;if(ht){if(arguments.length>1&&(Le=arguments[1]),Le instanceof Error)throw Le;var Fe=new Error('Unhandled "error" event. ('+Le+")");throw Fe.context=Le,Fe}if(Pe=nt[Se],!Pe)return!1;var Ce=typeof Pe=="function";switch(Ee=arguments.length,Ee){case 1:p(Pe,Ce,this);break;case 2:C(Pe,Ce,this,arguments[1]);break;case 3:z(Pe,Ce,this,arguments[1],arguments[2]);break;case 4:A(Pe,Ce,this,arguments[1],arguments[2],arguments[3]);break;default:for(Me=new Array(Ee-1),He=1;He<Ee;He++)Me[He-1]=arguments[He];P(Pe,Ce,this,Me)}return!0};function x(ue,Se,Le,Pe){var Ee,Me,He;if(typeof Le!="function")throw new TypeError('"listener" argument must be a function');if(Me=ue._events,Me?(Me.newListener&&(ue.emit("newListener",Se,Le.listener?Le.listener:Le),Me=ue._events),He=Me[Se]):(Me=ue._events=T(null),ue._eventsCount=0),!He)He=Me[Se]=Le,++ue._eventsCount;else if(typeof He=="function"?He=Me[Se]=Pe?[Le,He]:[He,Le]:Pe?He.unshift(Le):He.push(Le),!He.warned&&(Ee=y(ue),Ee&&Ee>0&&He.length>Ee)){He.warned=!0;var nt=new Error("Possible EventEmitter memory leak detected. "+He.length+' "'+String(Se)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');nt.name="MaxListenersExceededWarning",nt.emitter=ue,nt.type=Se,nt.count=He.length,typeof console=="object"&&console.warn&&console.warn("%s: %s",nt.name,nt.message)}return ue}D.prototype.addListener=function(Se,Le){return x(this,Se,Le,!1)},D.prototype.on=D.prototype.addListener,D.prototype.prependListener=function(Se,Le){return x(this,Se,Le,!0)};function O(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var ue=new Array(arguments.length),Se=0;Se<ue.length;++Se)ue[Se]=arguments[Se];this.listener.apply(this.target,ue)}}function U(ue,Se,Le){var Pe={fired:!1,wrapFn:void 0,target:ue,type:Se,listener:Le},Ee=S.call(O,Pe);return Ee.listener=Le,Pe.wrapFn=Ee,Ee}D.prototype.once=function(Se,Le){if(typeof Le!="function")throw new TypeError('"listener" argument must be a function');return this.on(Se,U(this,Se,Le)),this},D.prototype.prependOnceListener=function(Se,Le){if(typeof Le!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(Se,U(this,Se,Le)),this},D.prototype.removeListener=function(Se,Le){var Pe,Ee,Me,He,nt;if(typeof Le!="function")throw new TypeError('"listener" argument must be a function');if(Ee=this._events,!Ee)return this;if(Pe=Ee[Se],!Pe)return this;if(Pe===Le||Pe.listener===Le)--this._eventsCount===0?this._events=T(null):(delete Ee[Se],Ee.removeListener&&this.emit("removeListener",Se,Pe.listener||Le));else if(typeof Pe!="function"){for(Me=-1,He=Pe.length-1;He>=0;He--)if(Pe[He]===Le||Pe[He].listener===Le){nt=Pe[He].listener,Me=He;break}if(Me<0)return this;Me===0?Pe.shift():X(Pe,Me),Pe.length===1&&(Ee[Se]=Pe[0]),Ee.removeListener&&this.emit("removeListener",Se,nt||Le)}return this},D.prototype.removeAllListeners=function(Se){var Le,Pe,Ee;if(Pe=this._events,!Pe)return this;if(!Pe.removeListener)return arguments.length===0?(this._events=T(null),this._eventsCount=0):Pe[Se]&&(--this._eventsCount===0?this._events=T(null):delete Pe[Se]),this;if(arguments.length===0){var Me=t(Pe),He;for(Ee=0;Ee<Me.length;++Ee)He=Me[Ee],He!=="removeListener"&&this.removeAllListeners(He);return this.removeAllListeners("removeListener"),this._events=T(null),this._eventsCount=0,this}if(Le=Pe[Se],typeof Le=="function")this.removeListener(Se,Le);else if(Le)for(Ee=Le.length-1;Ee>=0;Ee--)this.removeListener(Se,Le[Ee]);return this};function G(ue,Se,Le){var Pe=ue._events;if(!Pe)return[];var Ee=Pe[Se];return Ee?typeof Ee=="function"?Le?[Ee.listener||Ee]:[Ee]:Le?J(Ee):W(Ee,Ee.length):[]}D.prototype.listeners=function(Se){return G(this,Se,!0)},D.prototype.rawListeners=function(Se){return G(this,Se,!1)},D.listenerCount=function(ue,Se){return typeof ue.listenerCount=="function"?ue.listenerCount(Se):Z.call(ue,Se)},D.prototype.listenerCount=Z;function Z(ue){var Se=this._events;if(Se){var Le=Se[ue];if(typeof Le=="function")return 1;if(Le)return Le.length}return 0}D.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function X(ue,Se){for(var Le=Se,Pe=Le+1,Ee=ue.length;Pe<Ee;Le+=1,Pe+=1)ue[Le]=ue[Pe];ue.pop()}function W(ue,Se){for(var Le=new Array(Se),Pe=0;Pe<Se;++Pe)Le[Pe]=ue[Pe];return Le}function J(ue){for(var Se=new Array(ue.length),Le=0;Le<Se.length;++Le)Se[Le]=ue[Le].listener||ue[Le];return Se}function re(ue){var Se=function(){};return Se.prototype=ue,new Se}function te(ue){for(var Se in ue)Object.prototype.hasOwnProperty.call(ue,Se);return Se}function ye(ue){var Se=this;return function(){return Se.apply(ue,arguments)}}},{}],53:[function(_,k,b){var T=_("./lib/parser");function t(){return(0,eval)("this")}k.exports={create:function(S,D){if(D=D||t(),S instanceof D.ArrayBuffer){var w=_("./lib/dom-bufferstream");return new T(new w(S,0,S.byteLength,!0,D))}else{var E=_("./lib/bufferstream");return new T(new E(S,0,S.length,!0))}}}},{"./lib/bufferstream":54,"./lib/dom-bufferstream":56,"./lib/parser":60}],54:[function(_,k,b){function T(t,S,D,w){this.buffer=t,this.offset=S||0,D=typeof D=="number"?D:t.length,this.endPosition=this.offset+D,this.setBigEndian(w)}T.prototype={setBigEndian:function(t){this.bigEndian=!!t},nextUInt8:function(){var t=this.buffer.readUInt8(this.offset);return this.offset+=1,t},nextInt8:function(){var t=this.buffer.readInt8(this.offset);return this.offset+=1,t},nextUInt16:function(){var t=this.bigEndian?this.buffer.readUInt16BE(this.offset):this.buffer.readUInt16LE(this.offset);return this.offset+=2,t},nextUInt32:function(){var t=this.bigEndian?this.buffer.readUInt32BE(this.offset):this.buffer.readUInt32LE(this.offset);return this.offset+=4,t},nextInt16:function(){var t=this.bigEndian?this.buffer.readInt16BE(this.offset):this.buffer.readInt16LE(this.offset);return this.offset+=2,t},nextInt32:function(){var t=this.bigEndian?this.buffer.readInt32BE(this.offset):this.buffer.readInt32LE(this.offset);return this.offset+=4,t},nextFloat:function(){var t=this.bigEndian?this.buffer.readFloatBE(this.offset):this.buffer.readFloatLE(this.offset);return this.offset+=4,t},nextDouble:function(){var t=this.bigEndian?this.buffer.readDoubleBE(this.offset):this.buffer.readDoubleLE(this.offset);return this.offset+=8,t},nextBuffer:function(t){var S=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,S},remainingLength:function(){return this.endPosition-this.offset},nextString:function(t){var S=this.buffer.toString("utf8",this.offset,this.offset+t);return this.offset+=t,S},mark:function(){var t=this;return{openWithOffset:function(S){return S=(S||0)+this.offset,new T(t.buffer,S,t.endPosition-S,t.bigEndian)},offset:this.offset}},offsetFrom:function(t){return this.offset-t.offset},skip:function(t){this.offset+=t},branch:function(t,S){return S=typeof S=="number"?S:this.endPosition-(this.offset+t),new T(this.buffer,this.offset+t,S,this.bigEndian)}},k.exports=T},{}],55:[function(_,k,b){function T(y){return parseInt(y,10)}var t=3600,S=60;function D(y,p){y=y.map(T),p=p.map(T);var C=y[0],z=y[1]-1,A=y[2],P=p[0],x=p[1],O=p[2],U=Date.UTC(C,z,A,P,x,O,0),G=U/1e3;return G}function w(y){var p=y.substr(0,10).split("-"),C=y.substr(11,8).split(":"),z=y.substr(19,6),A=z.split(":").map(T),P=A[0]*t+A[1]*S,x=D(p,C);if(x-=P,typeof x=="number"&&!isNaN(x))return x}function E(y){var p=y.split(" "),C=p[0].split(":"),z=p[1].split(":"),A=D(C,z);if(typeof A=="number"&&!isNaN(A))return A}function m(y){var p=y.length===19&&y.charAt(4)===":",C=y.length===25&&y.charAt(10)==="T";if(C)return w(y);if(p)return E(y)}k.exports={parseDateWithSpecFormat:E,parseDateWithTimezoneFormat:w,parseExifDate:m}},{}],56:[function(_,k,b){function T(t,S,D,w,E,m){this.global=E,S=S||0,D=D||t.byteLength-S,this.arrayBuffer=t.slice(S,S+D),this.view=new E.DataView(this.arrayBuffer,0,this.arrayBuffer.byteLength),this.setBigEndian(w),this.offset=0,this.parentOffset=(m||0)+S}T.prototype={setBigEndian:function(t){this.littleEndian=!t},nextUInt8:function(){var t=this.view.getUint8(this.offset);return this.offset+=1,t},nextInt8:function(){var t=this.view.getInt8(this.offset);return this.offset+=1,t},nextUInt16:function(){var t=this.view.getUint16(this.offset,this.littleEndian);return this.offset+=2,t},nextUInt32:function(){var t=this.view.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},nextInt16:function(){var t=this.view.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},nextInt32:function(){var t=this.view.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},nextFloat:function(){var t=this.view.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},nextDouble:function(){var t=this.view.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},nextBuffer:function(t){var S=this.arrayBuffer.slice(this.offset,this.offset+t);return this.offset+=t,S},remainingLength:function(){return this.arrayBuffer.byteLength-this.offset},nextString:function(t){var S=this.arrayBuffer.slice(this.offset,this.offset+t);return S=String.fromCharCode.apply(null,new this.global.Uint8Array(S)),this.offset+=t,S},mark:function(){var t=this;return{openWithOffset:function(S){return S=(S||0)+this.offset,new T(t.arrayBuffer,S,t.arrayBuffer.byteLength-S,!t.littleEndian,t.global,t.parentOffset)},offset:this.offset,getParentOffset:function(){return t.parentOffset}}},offsetFrom:function(t){return this.parentOffset+this.offset-(t.offset+t.getParentOffset())},skip:function(t){this.offset+=t},branch:function(t,S){return S=typeof S=="number"?S:this.arrayBuffer.byteLength-(this.offset+t),new T(this.arrayBuffer,this.offset+t,S,!this.littleEndian,this.global,this.parentOffset)}},k.exports=T},{}],57:[function(_,k,b){k.exports={exif:{1:"InteropIndex",2:"InteropVersion",11:"ProcessingSoftware",254:"SubfileType",255:"OldSubfileType",256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Thresholding",264:"CellWidth",265:"CellLength",266:"FillOrder",269:"DocumentName",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",285:"PageName",286:"XPosition",287:"YPosition",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",292:"T4Options",293:"T6Options",296:"ResolutionUnit",297:"PageNumber",300:"ColorResponseUnit",301:"TransferFunction",305:"Software",306:"ModifyDate",315:"Artist",316:"HostComputer",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",320:"ColorMap",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFD",332:"InkSet",333:"InkNames",334:"NumberofInks",336:"DotRange",337:"TargetPrinter",338:"ExtraSamples",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",435:"T82Options",437:"JPEGTables",512:"JPEGProc",513:"ThumbnailOffset",514:"ThumbnailLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"ApplicationNotes",999:"USPTOMiscellaneous",4096:"RelatedImageFileFormat",4097:"RelatedImageWidth",4098:"RelatedImageHeight",18246:"Rating",18247:"XP_DIP_XML",18248:"StitchInfo",18249:"RatingPercent",32781:"ImageID",32931:"WangTag1",32932:"WangAnnotation",32933:"WangTag3",32934:"WangTag4",32995:"Matteing",32996:"DataType",32997:"ImageDepth",32998:"TileDepth",33405:"Model2",33421:"CFARepeatPatternDim",33422:"CFAPattern2",33423:"BatteryLevel",33424:"KodakIFD",33432:"Copyright",33434:"ExposureTime",33437:"FNumber",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"PixelScale",33589:"AdventScale",33590:"AdventRevision",33628:"UIC1Tag",33629:"UIC2Tag",33630:"UIC3Tag",33631:"UIC4Tag",33723:"IPTC-NAA",33918:"IntergraphPacketData",33919:"IntergraphFlagRegisters",33920:"IntergraphMatrix",33921:"INGRReserved",33922:"ModelTiePoint",34016:"Site",34017:"ColorSequence",34018:"IT8Header",34019:"RasterPadding",34020:"BitsPerRunLength",34021:"BitsPerExtendedRunLength",34022:"ColorTable",34023:"ImageColorIndicator",34024:"BackgroundColorIndicator",34025:"ImageColorValue",34026:"BackgroundColorValue",34027:"PixelIntensityRange",34028:"TransparencyIndicator",34029:"ColorCharacterization",34030:"HCUsage",34031:"TrapIndicator",34032:"CMYKEquivalent",34118:"SEMInfo",34152:"AFCP_IPTC",34232:"PixelMagicJBIGOptions",34264:"ModelTransform",34306:"WB_GRGBLevels",34310:"LeafData",34377:"PhotoshopSettings",34665:"ExifOffset",34675:"ICC_Profile",34687:"TIFF_FXExtensions",34688:"MultiProfiles",34689:"SharedData",34690:"T88Options",34732:"ImageLayer",34735:"GeoTiffDirectory",34736:"GeoTiffDoubleParams",34737:"GeoTiffAsciiParams",34850:"ExposureProgram",34852:"SpectralSensitivity",34853:"GPSInfo",34855:"ISO",34856:"Opto-ElectricConvFactor",34857:"Interlace",34858:"TimeZoneOffset",34859:"SelfTimerMode",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",34908:"FaxRecvParams",34909:"FaxSubAddress",34910:"FaxRecvTime",34954:"LeafSubIFD",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"CreateDate",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureCompensation",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37387:"FlashEnergy",37388:"SpatialFrequencyResponse",37389:"Noise",37390:"FocalPlaneXResolution",37391:"FocalPlaneYResolution",37392:"FocalPlaneResolutionUnit",37393:"ImageNumber",37394:"SecurityClassification",37395:"ImageHistory",37396:"SubjectArea",37397:"ExposureIndex",37398:"TIFF-EPStandardID",37399:"SensingMethod",37434:"CIP3DataFile",37435:"CIP3Sheet",37436:"CIP3Side",37439:"StoNits",37500:"MakerNote",37510:"UserComment",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",37679:"MSDocumentText",37680:"MSPropertySetStorage",37681:"MSDocumentTextPosition",37724:"ImageSourceData",40091:"XPTitle",40092:"XPComment",40093:"XPAuthor",40094:"XPKeywords",40095:"XPSubject",40960:"FlashpixVersion",40961:"ColorSpace",40962:"ExifImageWidth",40963:"ExifImageHeight",40964:"RelatedSoundFile",40965:"InteropOffset",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41485:"Noise",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41489:"ImageNumber",41490:"SecurityClassification",41491:"ImageHistory",41492:"SubjectLocation",41493:"ExposureIndex",41494:"TIFF-EPStandardID",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFormat",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"OwnerName",42033:"SerialNumber",42034:"LensInfo",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42112:"GDALMetadata",42113:"GDALNoData",42240:"Gamma",44992:"ExpandSoftware",44993:"ExpandLens",44994:"ExpandFilm",44995:"ExpandFilterLens",44996:"ExpandScanner",44997:"ExpandFlashLamp",48129:"PixelFormat",48130:"Transformation",48131:"Uncompressed",48132:"ImageType",48256:"ImageWidth",48257:"ImageHeight",48258:"WidthResolution",48259:"HeightResolution",48320:"ImageOffset",48321:"ImageByteCount",48322:"AlphaOffset",48323:"AlphaByteCount",48324:"ImageDataDiscard",48325:"AlphaDataDiscard",50215:"OceScanjobDesc",50216:"OceApplicationSelector",50217:"OceIDNumber",50218:"OceImageLogic",50255:"Annotations",50341:"PrintIM",50560:"USPTOOriginalContentType",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"DNGLensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50739:"ShadowScale",50740:"DNGPrivateData",50741:"MakerNoteSafety",50752:"RawImageSegmentation",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50781:"RawDataUniqueID",50784:"AliasLayerMetadata",50827:"OriginalRawFileName",50828:"OriginalRawFileData",50829:"ActiveArea",50830:"MaskedAreas",50831:"AsShotICCProfile",50832:"AsShotPreProfileMatrix",50833:"CurrentICCProfile",50834:"CurrentPreProfileMatrix",50879:"ColorimetricReference",50898:"PanasonicTitle",50899:"PanasonicTitle2",50931:"CameraCalibrationSig",50932:"ProfileCalibrationSig",50933:"ProfileIFD",50934:"AsShotProfileName",50935:"NoiseReductionApplied",50936:"ProfileName",50937:"ProfileHueSatMapDims",50938:"ProfileHueSatMapData1",50939:"ProfileHueSatMapData2",50940:"ProfileToneCurve",50941:"ProfileEmbedPolicy",50942:"ProfileCopyright",50964:"ForwardMatrix1",50965:"ForwardMatrix2",50966:"PreviewApplicationName",50967:"PreviewApplicationVersion",50968:"PreviewSettingsName",50969:"PreviewSettingsDigest",50970:"PreviewColorSpace",50971:"PreviewDateTime",50972:"RawImageDigest",50973:"OriginalRawFileDigest",50974:"SubTileBlockSize",50975:"RowInterleaveFactor",50981:"ProfileLookTableDims",50982:"ProfileLookTableData",51008:"OpcodeList1",51009:"OpcodeList2",51022:"OpcodeList3",51041:"NoiseProfile",51043:"TimeCodes",51044:"FrameRate",51058:"TStop",51081:"ReelName",51089:"OriginalDefaultFinalSize",51090:"OriginalBestQualitySize",51091:"OriginalDefaultCropSize",51105:"CameraLabel",51107:"ProfileHueSatMapEncoding",51108:"ProfileLookTableEncoding",51109:"BaselineExposureOffset",51110:"DefaultBlackRender",51111:"NewRawImageDigest",51112:"RawToPreviewGain",51125:"DefaultUserCrop",59932:"Padding",59933:"OffsetSchema",65e3:"OwnerName",65001:"SerialNumber",65002:"Lens",65024:"KDC_IFD",65100:"RawFile",65101:"Converter",65102:"WhiteBalance",65105:"Exposure",65106:"Shadows",65107:"Brightness",65108:"Contrast",65109:"Saturation",65110:"Sharpness",65111:"Smoothness",65112:"MoireFilter"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"}}},{}],58:[function(_,k,b){function T(E,m){switch(E){case 1:return m.nextUInt8();case 3:return m.nextUInt16();case 4:return m.nextUInt32();case 5:return[m.nextUInt32(),m.nextUInt32()];case 6:return m.nextInt8();case 8:return m.nextUInt16();case 9:return m.nextUInt32();case 10:return[m.nextInt32(),m.nextInt32()];case 11:return m.nextFloat();case 12:return m.nextDouble();default:throw new Error("Invalid format while decoding: "+E)}}function t(E){switch(E){case 1:case 2:case 6:case 7:return 1;case 3:case 8:return 2;case 4:case 9:case 11:return 4;case 5:case 10:case 12:return 8;default:return 0}}function S(E,m){var y=m.nextUInt16(),p=m.nextUInt16(),C=t(p),z=m.nextUInt32(),A=C*z,P,x;if(A>4&&(m=E.openWithOffset(m.nextUInt32())),p===2){P=m.nextString(z);var O=P.indexOf("\0");O!==-1&&(P=P.substr(0,O))}else if(p===7)P=m.nextBuffer(z);else if(p!==0)for(P=[],x=0;x<z;++x)P.push(T(p,m));return A<4&&m.skip(4-A),[y,P,p]}function D(E,m,y){var p=m.nextUInt16(),C,z;for(z=0;z<p;++z)C=S(E,m),y(C[0],C[1],C[2])}function w(E){var m=E.nextString(6);if(m!=="Exif\0\0")throw new Error("Invalid EXIF header");var y=E.mark(),p=E.nextUInt16();if(p===18761)E.setBigEndian(!1);else if(p===19789)E.setBigEndian(!0);else throw new Error("Invalid TIFF header");if(E.nextUInt16()!==42)throw new Error("Invalid TIFF data");return y}k.exports={IFD0:1,IFD1:2,GPSIFD:3,SubIFD:4,InteropIFD:5,parseTags:function(E,m){var y;try{y=w(E)}catch{return!1}var p,C,z,A=y.openWithOffset(E.nextUInt32()),P=this.IFD0;D(y,A,function(W,J,re){switch(W){case 34853:C=J[0];break;case 34665:p=J[0];break;default:m(P,W,J,re);break}});var x=A.nextUInt32();if(x!==0){var O=y.openWithOffset(x);D(y,O,m.bind(null,this.IFD1))}if(C){var U=y.openWithOffset(C);D(y,U,m.bind(null,this.GPSIFD))}if(p){var G=y.openWithOffset(p),Z=this.InteropIFD;D(y,G,function(W,J,re){W===40965?z=J[0]:m(Z,W,J,re)})}if(z){var X=y.openWithOffset(z);D(y,X,m.bind(null,this.InteropIFD))}return!0}}},{}],59:[function(_,k,b){k.exports={parseSections:function(T,t){var S,D;for(T.setBigEndian(!0);T.remainingLength()>0&&D!==218;){if(T.nextUInt8()!==255)throw new Error("Invalid JPEG section offset");D=T.nextUInt8(),D>=208&&D<=217||D===218?S=0:S=T.nextUInt16()-2,t(D,T.branch(0,S)),T.skip(S)}},getSizeFromSOFSection:function(T){return T.skip(1),{height:T.nextUInt16(),width:T.nextUInt16()}},getSectionName:function(T){var t,S;switch(T){case 216:t="SOI";break;case 196:t="DHT";break;case 219:t="DQT";break;case 221:t="DRI";break;case 218:t="SOS";break;case 254:t="COM";break;case 217:t="EOI";break;default:T>=224&&T<=239?(t="APP",S=T-224):T>=192&&T<=207&&T!==196&&T!==200&&T!==204?(t="SOF",S=T-192):T>=208&&T<=215&&(t="RST",S=T-208);break}var D={name:t};return typeof S=="number"&&(D.index=S),D}}},{}],60:[function(_,k,b){var T=_("./jpeg"),t=_("./exif"),S=_("./simplify");function D(E,m,y,p,C,z,A){this.startMarker=E,this.tags=m,this.imageSize=y,this.thumbnailOffset=p,this.thumbnailLength=C,this.thumbnailType=z,this.app1Offset=A}D.prototype={hasThumbnail:function(E){return!this.thumbnailOffset||!this.thumbnailLength?!1:typeof E!="string"?!0:E.toLowerCase().trim()==="image/jpeg"?this.thumbnailType===6:E.toLowerCase().trim()==="image/tiff"?this.thumbnailType===1:!1},getThumbnailOffset:function(){return this.app1Offset+6+this.thumbnailOffset},getThumbnailLength:function(){return this.thumbnailLength},getThumbnailBuffer:function(){return this._getThumbnailStream().nextBuffer(this.thumbnailLength)},_getThumbnailStream:function(){return this.startMarker.openWithOffset(this.getThumbnailOffset())},getImageSize:function(){return this.imageSize},getThumbnailSize:function(){var E=this._getThumbnailStream(),m;return T.parseSections(E,function(y,p){T.getSectionName(y).name==="SOF"&&(m=T.getSizeFromSOFSection(p))}),m}};function w(E){this.stream=E,this.flags={readBinaryTags:!1,resolveTagNames:!0,simplifyValues:!0,imageSize:!0,hidePointers:!0,returnTags:!0}}w.prototype={enableBinaryFields:function(E){return this.flags.readBinaryTags=!!E,this},enablePointers:function(E){return this.flags.hidePointers=!E,this},enableTagNames:function(E){return this.flags.resolveTagNames=!!E,this},enableImageSize:function(E){return this.flags.imageSize=!!E,this},enableReturnTags:function(E){return this.flags.returnTags=!!E,this},enableSimpleValues:function(E){return this.flags.simplifyValues=!!E,this},parse:function(){var E=this.stream.mark(),m=E.openWithOffset(0),y=this.flags,p,C,z,A,P,x,O,U,G;return y.resolveTagNames&&(O=_("./exif-tags")),y.resolveTagNames?(p={},U=function(Z){return p[Z.name]},G=function(Z,X){p[Z.name]=X}):(p=[],U=function(Z){var X;for(X=0;X<p.length;++X)if(p[X].type===Z.type&&p[X].section===Z.section)return p.value},G=function(Z,X){var W;for(W=0;W<p.length;++W)if(p[W].type===Z.type&&p[W].section===Z.section){p.value=X;return}}),T.parseSections(m,function(Z,X){var W,J=X.offsetFrom(E);Z===225?(W=t.parseTags(X,function(re,te,ye,ue){if(!(!y.readBinaryTags&&ue===7)){if(te===513){if(z=ye[0],y.hidePointers)return}else if(te===514){if(A=ye[0],y.hidePointers)return}else if(te===259&&(P=ye[0],y.hidePointers))return;if(y.returnTags)if(y.simplifyValues&&(ye=S.simplifyValue(ye,ue)),y.resolveTagNames){var Se=re===t.GPSIFD?O.gps:O.exif,Le=Se[te];Le||(Le=O.exif[te]),p.hasOwnProperty(Le)||(p[Le]=ye)}else p.push({section:re,type:te,value:ye})}}),W&&(x=J)):y.imageSize&&T.getSectionName(Z).name==="SOF"&&(C=T.getSizeFromSOFSection(X))}),y.simplifyValues&&(S.castDegreeValues(U,G),S.castDateValues(U,G)),new D(E,p,C,z,A,P,x)}},k.exports=w},{"./exif":58,"./exif-tags":57,"./jpeg":59,"./simplify":61}],61:[function(_,k,b){var T=_("./exif"),t=_("./date"),S=[{section:T.GPSIFD,type:2,name:"GPSLatitude",refType:1,refName:"GPSLatitudeRef",posVal:"N"},{section:T.GPSIFD,type:4,name:"GPSLongitude",refType:3,refName:"GPSLongitudeRef",posVal:"E"}],D=[{section:T.SubIFD,type:306,name:"ModifyDate"},{section:T.SubIFD,type:36867,name:"DateTimeOriginal"},{section:T.SubIFD,type:36868,name:"CreateDate"},{section:T.SubIFD,type:306,name:"ModifyDate"}];k.exports={castDegreeValues:function(w,E){S.forEach(function(m){var y=w(m);if(y){var p=w({section:m.section,type:m.refType,name:m.refName}),C=p===m.posVal?1:-1,z=(y[0]+y[1]/60+y[2]/3600)*C;E(m,z)}})},castDateValues:function(w,E){D.forEach(function(m){var y=w(m);if(y){var p=t.parseExifDate(y);typeof p<"u"&&E(m,p)}})},simplifyValue:function(w,E){return Array.isArray(w)&&(w=w.map(function(m){return E===10||E===5?m[0]/m[1]:m}),w.length===1&&(w=w[0])),w}}},{"./date":55,"./exif":58}],62:[function(_,k,b){var T=_("@babel/runtime/helpers/interopRequireDefault"),t=T(_("@babel/runtime/helpers/toConsumableArray")),S=function(y){return(0,t.default)(y).map(function(p){return p.charCodeAt(0)})},D=S("META-INF/mozilla.rsa"),w=S("[Content_Types].xml"),E=S("_rels/.rels");k.exports=function(m){var y=m instanceof Uint8Array?m:new Uint8Array(m);if(!(y&&y.length>1))return null;var p=function(re,te){te=Object.assign({offset:0},te);for(var ye=0;ye<re.length;ye++)if(te.mask){if(re[ye]!==(te.mask[ye]&y[ye+te.offset]))return!1}else if(re[ye]!==y[ye+te.offset])return!1;return!0},C=function(re,te){return p(S(re),te)};if(p([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(p([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(p([71,73,70]))return{ext:"gif",mime:"image/gif"};if(p([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(p([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((p([73,73,42,0])||p([77,77,0,42]))&&p([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(p([73,73,42,0])||p([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(p([66,77]))return{ext:"bmp",mime:"image/bmp"};if(p([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(p([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(p([80,75,3,4])){if(p([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(p(D,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(C("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(C("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(C("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};var z=function(re){var te=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return re.findIndex(function(ye,ue,Se){return ue>=te&&Se[ue]===80&&Se[ue+1]===75&&Se[ue+2]===3&&Se[ue+3]===4})},A=0,P=!1,x=null;do{var O=A+30;if(P||(P=p(w,{offset:O})||p(E,{offset:O})),x||(C("word/",{offset:O})?x={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:C("ppt/",{offset:O})?x={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:C("xl/",{offset:O})&&(x={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),P&&x)return x;A=z(y,O)}while(A>=0);if(x)return x}if(p([80,75])&&(y[2]===3||y[2]===5||y[2]===7)&&(y[3]===4||y[3]===6||y[3]===8))return{ext:"zip",mime:"application/zip"};if(p([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(p([82,97,114,33,26,7])&&(y[6]===0||y[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(p([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(p([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(p([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(p([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(p([51,103,112,53])||p([0,0,0])&&p([102,116,121,112],{offset:4})&&(p([109,112,52,49],{offset:8})||p([109,112,52,50],{offset:8})||p([105,115,111,109],{offset:8})||p([105,115,111,50],{offset:8})||p([109,109,112,52],{offset:8})||p([77,52,86],{offset:8})||p([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(p([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(p([26,69,223,163])){var U=y.subarray(4,4100),G=U.findIndex(function(J,re,te){return te[re]===66&&te[re+1]===130});if(G!==-1){var Z=G+3,X=function(re){return(0,t.default)(re).every(function(te,ye){return U[Z+ye]===te.charCodeAt(0)})};if(X("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(X("webm"))return{ext:"webm",mime:"video/webm"}}}if(p([0,0,0,20,102,116,121,112,113,116,32,32])||p([102,114,101,101],{offset:4})||p([102,116,121,112,113,116,32,32],{offset:4})||p([109,100,97,116],{offset:4})||p([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(p([82,73,70,70])){if(p([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(p([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(p([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(p([48,38,178,117,142,102,207,17,166,217]))return{ext:"wmv",mime:"video/x-ms-wmv"};if(p([0,0,1,186])||p([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(p([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(var W=0;W<2&&W<y.length-16;W++){if(p([73,68,51],{offset:W})||p([255,226],{offset:W,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(p([255,228],{offset:W,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(p([255,248],{offset:W,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(p([255,240],{offset:W,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(p([102,116,121,112,77,52,65],{offset:4})||p([77,52,65,32]))return{ext:"m4a",mime:"audio/mp4"};if(p([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(p([79,103,103,83]))return p([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:p([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:p([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:p([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:p([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(p([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(p([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(p([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(p([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(p([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(p([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((y[0]===67||y[0]===70)&&p([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(p([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(p([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(p([119,79,70,70])&&(p([0,1,0,0],{offset:4})||p([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(p([119,79,70,50])&&(p([0,1,0,0],{offset:4})||p([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(p([76,80],{offset:34})&&(p([0,0,1],{offset:8})||p([1,0,2],{offset:8})||p([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(p([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(p([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(p([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(p([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(p([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(p([37,33]))return{ext:"ps",mime:"application/postscript"};if(p([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(p([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(p([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(p([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(p([77,83,67,70])||p([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(p([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(p([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(p([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(p([31,160])||p([31,157]))return{ext:"Z",mime:"application/x-compress"};if(p([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(p([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(p([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(p([71],{offset:4})&&(p([71],{offset:192})||p([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(p([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(p([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(p([0,0,0,12,106,80,32,32,13,10,135,10])){if(p([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(p([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(p([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(p([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(p([70,79,82,77,0]))return{ext:"aif",mime:"audio/aiff"};if(C("<?xml "))return{ext:"xml",mime:"application/xml"};if(p([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(p([102,116,121,112],{offset:4})){if(p([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(p([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(p([104,101,105,99],{offset:8})||p([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(p([104,101,118,99],{offset:8})||p([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return p([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:null}},{"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/helpers/toConsumableArray":20}],63:[function(_,k,b){var T=_("is-callable"),t=Object.prototype.toString,S=Object.prototype.hasOwnProperty,D=function(p,C,z){for(var A=0,P=p.length;A<P;A++)S.call(p,A)&&(z==null?C(p[A],A,p):C.call(z,p[A],A,p))},w=function(p,C,z){for(var A=0,P=p.length;A<P;A++)z==null?C(p.charAt(A),A,p):C.call(z,p.charAt(A),A,p)},E=function(p,C,z){for(var A in p)S.call(p,A)&&(z==null?C(p[A],A,p):C.call(z,p[A],A,p))},m=function(p,C,z){if(!T(C))throw new TypeError("iterator must be a function");var A;arguments.length>=3&&(A=z),t.call(p)==="[object Array]"?D(p,C,A):typeof p=="string"?w(p,C,A):E(p,C,A)};k.exports=m},{"is-callable":77}],64:[function(_,k,b){function T(w,E,m,C){var p=0,C=C===void 0?{}:C,z=C.loop===void 0?null:C.loop,A=C.palette===void 0?null:C.palette;if(E<=0||m<=0||E>65535||m>65535)throw new Error("Width/Height invalid.");function P(J){var re=J.length;if(re<2||re>256||re&re-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return re}w[p++]=71,w[p++]=73,w[p++]=70,w[p++]=56,w[p++]=57,w[p++]=97;var x=0,O=0;if(A!==null){for(var U=P(A);U>>=1;)++x;if(U=1<<x,--x,C.background!==void 0){if(O=C.background,O>=U)throw new Error("Background index out of range.");if(O===0)throw new Error("Background index explicitly passed as 0.")}}if(w[p++]=E&255,w[p++]=E>>8&255,w[p++]=m&255,w[p++]=m>>8&255,w[p++]=(A!==null?128:0)|x,w[p++]=O,w[p++]=0,A!==null)for(var G=0,Z=A.length;G<Z;++G){var X=A[G];w[p++]=X>>16&255,w[p++]=X>>8&255,w[p++]=X&255}if(z!==null){if(z<0||z>65535)throw new Error("Loop count invalid.");w[p++]=33,w[p++]=255,w[p++]=11,w[p++]=78,w[p++]=69,w[p++]=84,w[p++]=83,w[p++]=67,w[p++]=65,w[p++]=80,w[p++]=69,w[p++]=50,w[p++]=46,w[p++]=48,w[p++]=3,w[p++]=1,w[p++]=z&255,w[p++]=z>>8&255,w[p++]=0}var W=!1;this.addFrame=function(J,re,te,ye,ue,Se){if(W===!0&&(--p,W=!1),Se=Se===void 0?{}:Se,J<0||re<0||J>65535||re>65535)throw new Error("x/y invalid.");if(te<=0||ye<=0||te>65535||ye>65535)throw new Error("Width/Height invalid.");if(ue.length<te*ye)throw new Error("Not enough pixels for the frame size.");var Le=!0,Pe=Se.palette;if(Pe==null&&(Le=!1,Pe=A),Pe==null)throw new Error("Must supply either a local or global palette.");for(var Ee=P(Pe),Me=0;Ee>>=1;)++Me;Ee=1<<Me;var He=Se.delay===void 0?0:Se.delay,nt=Se.disposal===void 0?0:Se.disposal;if(nt<0||nt>3)throw new Error("Disposal out of range.");var ht=!1,Fe=0;if(Se.transparent!==void 0&&Se.transparent!==null&&(ht=!0,Fe=Se.transparent,Fe<0||Fe>=Ee))throw new Error("Transparent color index.");if((nt!==0||ht||He!==0)&&(w[p++]=33,w[p++]=249,w[p++]=4,w[p++]=nt<<2|(ht===!0?1:0),w[p++]=He&255,w[p++]=He>>8&255,w[p++]=Fe,w[p++]=0),w[p++]=44,w[p++]=J&255,w[p++]=J>>8&255,w[p++]=re&255,w[p++]=re>>8&255,w[p++]=te&255,w[p++]=te>>8&255,w[p++]=ye&255,w[p++]=ye>>8&255,w[p++]=Le===!0?128|Me-1:0,Le===!0)for(var Ce=0,Be=Pe.length;Ce<Be;++Ce){var Ae=Pe[Ce];w[p++]=Ae>>16&255,w[p++]=Ae>>8&255,w[p++]=Ae&255}return p=t(w,p,Me<2?2:Me,ue),p},this.end=function(){return W===!1&&(w[p++]=59,W=!0),p},this.getOutputBuffer=function(){return w},this.setOutputBuffer=function(J){w=J},this.getOutputBufferPosition=function(){return p},this.setOutputBufferPosition=function(J){p=J}}function t(w,E,m,y){w[E++]=m;var p=E++,C=1<<m,z=C-1,A=C+1,P=A+1,x=m+1,O=0,U=0;function G(Se){for(;O>=Se;)w[E++]=U&255,U>>=8,O-=8,E===p+256&&(w[p]=255,p=E++)}function Z(Se){U|=Se<<O,O+=x,G(8)}var X=y[0]&z,W={};Z(C);for(var J=1,re=y.length;J<re;++J){var te=y[J]&z,ye=X<<8|te,ue=W[ye];if(ue===void 0){for(U|=X<<O,O+=x;O>=8;)w[E++]=U&255,U>>=8,O-=8,E===p+256&&(w[p]=255,p=E++);P===4096?(Z(C),P=A+1,x=m+1,W={}):(P>=1<<x&&++x,W[ye]=P++),X=te}else X=ue}return Z(X),Z(A),G(1),p+1===E?w[p]=0:(w[p]=E-p-1,w[E++]=0),E}function S(w){var E=0;if(w[E++]!==71||w[E++]!==73||w[E++]!==70||w[E++]!==56||(w[E++]+1&253)!==56||w[E++]!==97)throw new Error("Invalid GIF 87a/89a header.");var m=w[E++]|w[E++]<<8,y=w[E++]|w[E++]<<8,p=w[E++],C=p>>7,z=p&7,A=1<<z+1;w[E++],w[E++];var P=null,x=null;C&&(P=E,x=A,E+=A*3);var O=!0,U=[],G=0,Z=null,X=0,W=null;for(this.width=m,this.height=y;O&&E<w.length;)switch(w[E++]){case 33:switch(w[E++]){case 255:if(w[E]!==11||w[E+1]==78&&w[E+2]==69&&w[E+3]==84&&w[E+4]==83&&w[E+5]==67&&w[E+6]==65&&w[E+7]==80&&w[E+8]==69&&w[E+9]==50&&w[E+10]==46&&w[E+11]==48&&w[E+12]==3&&w[E+13]==1&&w[E+16]==0)E+=14,W=w[E++]|w[E++]<<8,E++;else for(E+=12;;){var J=w[E++];if(!(J>=0))throw Error("Invalid block size");if(J===0)break;E+=J}break;case 249:if(w[E++]!==4||w[E+4]!==0)throw new Error("Invalid graphics extension block.");var re=w[E++];G=w[E++]|w[E++]<<8,Z=w[E++],re&1||(Z=null),X=re>>2&7,E++;break;case 254:for(;;){var J=w[E++];if(!(J>=0))throw Error("Invalid block size");if(J===0)break;E+=J}break;default:throw new Error("Unknown graphic control label: 0x"+w[E-1].toString(16))}break;case 44:var te=w[E++]|w[E++]<<8,ye=w[E++]|w[E++]<<8,ue=w[E++]|w[E++]<<8,Se=w[E++]|w[E++]<<8,Le=w[E++],Pe=Le>>7,Ee=Le>>6&1,Me=Le&7,He=1<<Me+1,nt=P,ht=x,Fe=!1;if(Pe){var Fe=!0;nt=E,ht=He,E+=He*3}var Ce=E;for(E++;;){var J=w[E++];if(!(J>=0))throw Error("Invalid block size");if(J===0)break;E+=J}U.push({x:te,y:ye,width:ue,height:Se,has_local_palette:Fe,palette_offset:nt,palette_size:ht,data_offset:Ce,data_length:E-Ce,transparent_index:Z,interlaced:!!Ee,delay:G,disposal:X});break;case 59:O=!1;break;default:throw new Error("Unknown gif block: 0x"+w[E-1].toString(16))}this.numFrames=function(){return U.length},this.loopCount=function(){return W},this.frameInfo=function(Be){if(Be<0||Be>=U.length)throw new Error("Frame index out of range.");return U[Be]},this.decodeAndBlitFrameBGRA=function(Be,Ae){var se=this.frameInfo(Be),pe=se.width*se.height,Ke=new Uint8Array(pe);D(w,se.data_offset,Ke,pe);var _e=se.palette_offset,ke=se.transparent_index;ke===null&&(ke=256);var qe=se.width,tt=m-qe,Ge=qe,We=(se.y*m+se.x)*4,Je=((se.y+se.height)*m+se.x)*4,it=We,ze=tt*4;se.interlaced===!0&&(ze+=m*4*7);for(var de=8,ve=0,be=Ke.length;ve<be;++ve){var Oe=Ke[ve];if(Ge===0&&(it+=ze,Ge=qe,it>=Je&&(ze=tt*4+m*4*(de-1),it=We+(qe+tt)*(de<<1),de>>=1)),Oe===ke)it+=4;else{var ge=w[_e+Oe*3],le=w[_e+Oe*3+1],et=w[_e+Oe*3+2];Ae[it++]=et,Ae[it++]=le,Ae[it++]=ge,Ae[it++]=255}--Ge}},this.decodeAndBlitFrameRGBA=function(Be,Ae){var se=this.frameInfo(Be),pe=se.width*se.height,Ke=new Uint8Array(pe);D(w,se.data_offset,Ke,pe);var _e=se.palette_offset,ke=se.transparent_index;ke===null&&(ke=256);var qe=se.width,tt=m-qe,Ge=qe,We=(se.y*m+se.x)*4,Je=((se.y+se.height)*m+se.x)*4,it=We,ze=tt*4;se.interlaced===!0&&(ze+=m*4*7);for(var de=8,ve=0,be=Ke.length;ve<be;++ve){var Oe=Ke[ve];if(Ge===0&&(it+=ze,Ge=qe,it>=Je&&(ze=tt*4+m*4*(de-1),it=We+(qe+tt)*(de<<1),de>>=1)),Oe===ke)it+=4;else{var ge=w[_e+Oe*3],le=w[_e+Oe*3+1],et=w[_e+Oe*3+2];Ae[it++]=ge,Ae[it++]=le,Ae[it++]=et,Ae[it++]=255}--Ge}}}function D(w,E,m,y){for(var p=w[E++],C=1<<p,z=C+1,A=z+1,P=p+1,x=(1<<P)-1,O=0,U=0,G=0,Z=w[E++],X=new Int32Array(4096),W=null;;){for(;O<16&&Z!==0;)U|=w[E++]<<O,O+=8,Z===1?Z=w[E++]:--Z;if(O<P)break;var J=U&x;if(U>>=P,O-=P,J===C){A=z+1,P=p+1,x=(1<<P)-1,W=null;continue}else if(J===z)break;for(var re=J<A?J:W,te=0,ye=re;ye>C;)ye=X[ye]>>8,++te;var ue=ye,Se=G+te+(re!==J?1:0);if(Se>y){console.log("Warning, gif stream longer than expected.");return}m[G++]=ue,G+=te;var Le=G;for(re!==J&&(m[G++]=ue),ye=re;te--;)ye=X[ye],m[--Le]=ye&255,ye>>=8;W!==null&&A<4096&&(X[A++]=W<<8|ue,A>=x+1&&P<12&&(++P,x=x<<1|1)),W=J}return G!==y&&console.log("Warning, gif stream shorter than expected."),m}try{b.GifWriter=T,b.GifReader=S}catch{}},{}],65:[function(_,k,b){(function(T){class t{constructor(...D){if(D.length===0)throw new Error("constructor requires parameters");const w=D[0];if(w!==null&&typeof w=="object")if(w instanceof t){const E=w.bitmap;this.bitmap={width:E.width,height:E.height,data:new T(E.width*E.height*4)},E.data.copy(this.bitmap.data)}else if(w.width&&w.height&&w.data)this.bitmap=w;else throw new Error("unrecognized constructor parameters");else if(typeof w=="number"&&typeof D[1]=="number"){const E=w,m=D[1],y=D[2];this.bitmap={width:E,height:m},T.isBuffer(y)?this.bitmap.data=y:(this.bitmap.data=new T(E*m*4),typeof y=="number"&&this.fillRGBA(y))}else throw new Error("unrecognized constructor parameters")}blit(D,w,E,m,y,p,C){if(m+p>this.bitmap.width)throw new Error("copy exceeds width of source bitmap");if(w+p>D.bitmap.width)throw new Error("copy exceeds width of target bitmap");if(y+C>this.bitmap.height)throw new Error("copy exceeds height of source bitmap");if(E+C>D.bitmap.height)throw new Erro("copy exceeds height of target bitmap");const z=this.bitmap.data,A=D.bitmap.data,P=this.bitmap.width*4,x=D.bitmap.width*4,O=p*4;let U=y*P+m*4,G=E*x+w*4;for(;--C>=0;)z.copy(A,G,U,U+O),U+=P,G+=x;return this}fillRGBA(D){const w=this.bitmap.data,E=this.bitmap.height*4;let m=0;for(;m<E;)w.writeUInt32BE(D,m),m+=4;for(;m<w.length;)w.copy(w,m,0,E),m+=E;return this}getRGBA(D,w){const E=(w*this.bitmap.width+D)*4;return this.bitmap.data.readUInt32BE(E)}getRGBASet(){const D=new Set,w=this.bitmap.data;for(let E=0;E<w.length;E+=4)D.add(w.readUInt32BE(E,!0));return D}greyscale(){const D=this.bitmap.data;return this.scan(0,0,this.bitmap.width,this.bitmap.height,(w,E,m)=>{const y=Math.round(.299*D[m]+.587*D[m+1]+.114*D[m+2]);D[m]=y,D[m+1]=y,D[m+2]=y}),this}reframe(D,w,E,m,y){const p=D<0?0:D,C=w<0?0:w,z=E+p>this.bitmap.width?this.bitmap.width-p:E,A=m+C>this.bitmap.height?this.bitmap.height-C:m,P=D<0?-D:0,x=w<0?-w:0;let O;if(y===void 0){if(p!==D||C!=w||z!==E||A!==m)throw new GifError("fillRGBA required for this reframing");O=new t(E,m)}else O=new t(E,m,y);return this.blit(O,P,x,p,C,z,A),this.bitmap=O.bitmap,this}scale(D){if(D===1)return;if(!Number.isInteger(D)||D<1)throw new Error("the scale must be an integer >= 1");const w=this.bitmap.width,E=this.bitmap.height,m=w*D*4,y=this.bitmap.data,p=new T(E*m*D);let C=0,z,A=0;for(let P=0;P<E;++P){z=A;for(let x=0;x<w;++x){const O=y.readUInt32BE(C,!0);for(let U=0;U<D;++U)p.writeUInt32BE(O,A),A+=4;C+=4}for(let x=1;x<D;++x)p.copy(p,A,z,A),A+=m,z+=m}return this.bitmap={width:w*D,height:E*D,data:p},this}scanAllCoords(D){const w=this.bitmap.width,E=this.bitmap.data.length;let m=0,y=0;for(let p=0;p<E;p+=4)D(m,y,p),++m===w&&(m=0,++y)}scanAllIndexes(D){const w=this.bitmap.data.length;for(let E=0;E<w;E+=4)D(E)}}k.exports=t}).call(this,_("buffer").Buffer)},{buffer:48}],66:[function(_,k,b){class T{constructor(D,w,E){this.width=E.width,this.height=E.height,this.loops=E.loops,this.usesTransparency=E.usesTransparency,this.colorScope=E.colorScope,this.frames=w,this.buffer=D}}T.GlobalColorsPreferred=0,T.GlobalColorsOnly=1,T.LocalColorsOnly=2;class t extends Error{constructor(D){super(D),D instanceof Error&&(this.stack="Gif"+D.stack)}}b.Gif=T,b.GifError=t},{}],67:[function(_,k,b){(function(T,t){const S=_("omggif"),{Gif:D,GifError:w}=_("./gif");let E;T.nextTick(()=>{E=_("./gifutil")});const{GifFrame:m}=_("./gifframe"),y=200,p=100;class C{constructor(J={}){this._transparentRGB=null,typeof J.transparentRGB=="number"&&J.transparentRGB!==0&&(this._transparentRGBA=J.transparentRGB*256),this._testInitialBufferSize=0}decodeGif(J){try{let re;try{re=new S.GifReader(J)}catch(Se){throw new w(Se)}const te=re.numFrames(),ye=[],ue={width:re.width,height:re.height,loops:re.loopCount()};ue.usesTransparency=!1;for(let Se=0;Se<te;++Se){const Le=this._decodeFrame(re,Se,ue.usesTransparency);ye.push(Le.frame),Le.usesTransparency&&(ue.usesTransparency=!0)}return Promise.resolve(new D(J,ye,ue))}catch(re){return Promise.reject(re)}}encodeGif(J,re={}){try{if(J===null||J.length===0)throw new w("there are no frames");const te=E.getMaxDimensions(J);return re=Object.assign({},re),re.width=te.maxWidth,re.height=te.maxHeight,re.loops=re.loops||0,re.colorScope=re.colorScope||D.GlobalColorsPreferred,Promise.resolve(this._encodeGif(J,re))}catch(te){return Promise.reject(te)}}_decodeFrame(J,re,te){let ye,ue;try{if(ye=J.frameInfo(re),ue=new t(J.width*J.height*4),J.decodeAndBlitFrameRGBA(re,ue),ye.width!==J.width||ye.height!==J.height){if(ye.y&&(ue=ue.slice(ye.y*J.width*4)),J.width>ye.width)for(let Pe=0;Pe<ye.height;++Pe)ue.copy(ue,Pe*ye.width*4,(ye.x+Pe*J.width)*4,(ye.x+Pe*J.width)*4+ye.width*4);ue=ue.slice(0,ye.width*ye.height*4)}}catch(Pe){throw new w(Pe)}let Se=!1;if(this._transparentRGBA===null){if(!te)for(let Pe=3;Pe<ue.length;Pe+=4)ue[Pe]===0&&(Se=!0,Pe=ue.length)}else for(let Pe=3;Pe<ue.length;Pe+=4)ue[Pe]===0&&(ue.writeUInt32BE(this._transparentRGBA,Pe-3),Se=!0);return{frame:new m(ye.width,ye.height,ue,{xOffset:ye.x,yOffset:ye.y,disposalMethod:ye.disposal,interlaced:ye.interlaced,delayCentisecs:ye.delay}),usesTransparency:Se}}_encodeGif(J,re){let te;if(re.colorScope===D.LocalColorsOnly)te=E.getColorInfo(J,0);else if(te=E.getColorInfo(J,256),!te.colors){if(re.colorScope===D.GlobalColorsOnly)throw new w("Too many color indexes for global color table");re.colorScope=D.LocalColorsOnly}re.usesTransparency=te.usesTransparency;const ye=te.palettes;return re.colorScope===D.LocalColorsOnly?x(J,re,2e3,ye):P(J,re,2e3,te)}_getSizeEstimateGlobal(J,re){if(this._testInitialBufferSize>0)return this._testInitialBufferSize;let te=y+3*256;const ye=Z(J);return re.forEach(ue=>{te+=U(ue,ye)}),te}_getSizeEstimateLocal(J,re){if(this._testInitialBufferSize>0)return this._testInitialBufferSize;let te=y;for(let ye=0;ye<re.length;++ye){const ue=J[ye],Se=Z(ue);te+=U(re[ye],Se)}return te}}b.GifCodec=C;function z(W,J){const re=W.indexOf(J);return re===-1?null:re}function A(W,J){for(var re=0,te=W.length-1,ye;re<=te;)if(ye=Math.floor((re+te)/2),W[ye]>J)te=ye-1;else if(W[ye]<J)re=ye+1;else return ye;return null}function P(W,J,re,te){const ye={colors:te.colors.slice(),usesTransparency:te.usesTransparency};O(ye);const ue={palette:ye.colors,loop:J.loops};let Se=new t(re),Le;try{Le=new S.GifWriter(Se,J.width,J.height,ue)}catch(Pe){throw new w(Pe)}for(let Pe=0;Pe<W.length;++Pe)Se=X(Le,Pe,W[Pe],te,!1);return new D(Se.slice(0,Le.end()),W,J)}function x(W,J,re,te){const ye={loop:J.loops};let ue=new t(re),Se;try{Se=new S.GifWriter(ue,J.width,J.height,ye)}catch(Le){throw new w(Le)}for(let Le=0;Le<W.length;++Le)ue=X(Se,Le,W[Le],te[Le],!0);return new D(ue.slice(0,Se.end()),W,J)}function O(W){const J=W.colors;W.usesTransparency&&J.push(0);const re=J.length;let te=2;for(;re>te;)te<<=1;J.length=te,J.fill(0,re)}function U(W,J){let re=W.bitmap.width*W.bitmap.height;return re=Math.ceil(re*J/8),re+=Math.ceil(re/255),p+re+3*256}function G(W,J,re){const te=re.colors,ye=te.length<=8?z:A,ue=J.bitmap.data,Se=new t(ue.length/4);let Le=te.length,Pe=0,Ee=0;for(;Pe<ue.length;){if(ue[Pe+3]!==0){const Me=ue.readUInt32BE(Pe,!0)>>8&16777215;Se[Ee]=ye(te,Me)}else Se[Ee]=Le;Pe+=4,++Ee}if(re.usesTransparency){if(Le===256)throw new w(`Frame ${W} already has 256 colorsand so can't use transparency`)}else Le=null;return{buffer:Se,transparentIndex:Le}}function Z(W){let J=W.indexCount,re=0;for(--J;J;)++re,J>>=1;return re>0?re:1}function X(W,J,re,te,ye){if(re.interlaced)throw new w("writing interlaced GIFs is not supported");const ue=G(J,re,te),Se={delay:re.delayCentisecs,disposal:re.disposalMethod,transparent:ue.transparentIndex};ye&&(O(te),Se.palette=te.colors);try{let Le=W.getOutputBuffer(),Pe=W.getOutputBufferPosition(),Ee,Me=!0;for(;Me;)if(Ee=W.addFrame(re.xOffset,re.yOffset,re.bitmap.width,re.bitmap.height,ue.buffer,Se),Me=!1,Ee>=Le.length-1){const He=new t(Le.length*1.5);Le.copy(He),W.setOutputBuffer(He),W.setOutputBufferPosition(Pe),Le=He,Me=!0}return Le}catch(Le){throw new w(Le)}}}).call(this,_("_process"),_("buffer").Buffer)},{"./gif":66,"./gifframe":68,"./gifutil":69,_process:133,buffer:48,omggif:64}],68:[function(_,k,b){const T=_("./bitmapimage"),{GifError:t}=_("./gif");class S extends T{constructor(...w){if(super(...w),w[0]instanceof S){const E=w[0];this.xOffset=E.xOffset,this.yOffset=E.yOffset,this.disposalMethod=E.disposalMethod,this.delayCentisecs=E.delayCentisecs,this.interlaced=E.interlaced}else{const E=w[w.length-1];let m={};typeof E=="object"&&!(E instanceof T)&&(m=E),this.xOffset=m.xOffset||0,this.yOffset=m.yOffset||0,this.disposalMethod=m.disposalMethod!==void 0?m.disposalMethod:S.DisposeToBackgroundColor,this.delayCentisecs=m.delayCentisecs||8,this.interlaced=m.interlaced||!1}}getPalette(){const w=new Set,E=this.bitmap.data;let m=0,y=!1;for(;m<E.length;){if(E[m+3]===0)y=!0;else{const A=E.readUInt32BE(m,!0)>>8&16777215;w.add(A)}m+=4}const p=new Array(w.size),C=w.values();for(m=0;m<p.length;++m)p[m]=C.next().value;p.sort((A,P)=>A-P);let z=p.length;return y&&++z,{colors:p,usesTransparency:y,indexCount:z}}}S.DisposeToAnything=0,S.DisposeNothing=1,S.DisposeToBackgroundColor=2,S.DisposeToPrevious=3,b.GifFrame=S},{"./bitmapimage":65,"./gif":66}],69:[function(_,k,b){(function(T){const t=_("fs"),S=_("image-q"),D=_("./bitmapimage"),{GifFrame:w}=_("./gifframe"),{GifError:E}=_("./gif"),{GifCodec:m}=_("./gifcodec"),y=[".jpg",".jpeg",".png",".bmp"],p=new m;b.cloneFrames=function(P){let x=[];return P.forEach(O=>{x.push(new w(O))}),x},b.getColorInfo=function(P,x){let O=!1;const U=[];for(let J=0;J<P.length;++J){let re=P[J].getPalette();if(re.usesTransparency&&(O=!0),re.indexCount>256)throw new E(`Frame ${J} uses more than 256 color indexes`);U.push(re)}if(x===0)return{usesTransparency:O,palettes:U};const G=new Set;U.forEach(J=>{J.colors.forEach(re=>{G.add(re)})});let Z=G.size;if(O&&++Z,x&&Z>x)return{usesTransparency:O,palettes:U};const X=new Array(G.size),W=G.values();for(let J=0;J<X.length;++J)X[J]=W.next().value;return X.sort((J,re)=>J-re),{colors:X,indexCount:Z,usesTransparency:O,palettes:U}},b.copyAsJimp=function(P,x){return b.shareAsJimp(P,new D(x))},b.getMaxDimensions=function(P){let x=0,O=0;return P.forEach(U=>{const G=U.xOffset+U.bitmap.width;G>x&&(x=G);const Z=U.yOffset+U.bitmap.height;Z>O&&(O=Z)}),{maxWidth:x,maxHeight:O}},b.quantizeDekker=function(P,x,O){x=x||256,C(P,"NeuQuantFloat",x,0,O)},b.quantizeSorokin=function(P,x,O,U){x=x||256,O=O||"min-pop";let G;switch(O){case"min-pop":G=2;break;case"top-pop":G=1;break;default:throw new Error(`Invalid quantizeSorokin histogram '${O}'`)}C(P,"RGBQuant",x,G,U)},b.quantizeWu=function(P,x,O,U){if(x=x||256,O=O||5,O<1||O>8)throw new Error("Invalid quantization quality");C(P,"WuQuant",x,O,U)},b.read=function(P,x){return x=x||p,T.isBuffer(P)?x.decodeGif(P):z(P).then(O=>x.decodeGif(O))},b.shareAsJimp=function(P,x){const O=new P(x.bitmap.width,x.bitmap.height,0);return O.bitmap.data=x.bitmap.data,O},b.write=function(P,x,O,U){U=U||p;const G=P.match(/\.[a-zA-Z]+$/);if(G!==null&&y.includes(G[0].toLowerCase()))throw new Error(`GIF '${P}' has an unexpected suffix`);return U.encodeGif(x,O).then(Z=>A(P,Z.buffer).then(()=>Z))};function C(P,x,O,U,G){const Z=Array.isArray(P)?P:[P],X=["FloydSteinberg","FalseFloydSteinberg","Stucki","Atkinson","Jarvis","Burkes","Sierra","TwoSierra","SierraLite"];if(G){if(X.indexOf(G.ditherAlgorithm)<0)throw new Error(`Invalid ditherAlgorithm '${G.ditherAlgorithm}'`);G.serpentine===void 0&&(G.serpentine=!0),G.minimumColorDistanceToDither===void 0&&(G.minimumColorDistanceToDither=0),G.calculateErrorLikeGIMP===void 0&&(G.calculateErrorLikeGIMP=!1)}const W=new S.distance.Euclidean,J=new S.palette[x](W,O,U);let re;G?re=new S.image.ErrorDiffusionArray(W,S.image.ErrorDiffusionArrayKernel[G.ditherAlgorithm],G.serpentine,G.minimumColorDistanceToDither,G.calculateErrorLikeGIMP):re=new S.image.NearestColor(W);const te=[];Z.forEach(ue=>{const Se=ue.bitmap.data,Le=new ArrayBuffer(Se.length),Pe=new Uint32Array(Le);for(let Me=0,He=0;Me<Se.length;Me+=4,++He)Pe[He]=Se.readUInt32LE(Me,!0);const Ee=S.utils.PointContainer.fromUint32Array(Pe,ue.bitmap.width,ue.bitmap.height);J.sample(Ee),te.push(Ee)});const ye=J.quantize();for(let ue=0;ue<Z.length;++ue){const Se=Z[ue].bitmap.data,Pe=re.quantize(te[ue],ye).toUint32Array();for(let Ee=0,Me=0;Ee<Se.length;Ee+=4,++Me)Se.writeUInt32LE(Pe[Me],Ee)}}function z(P){return new Promise((x,O)=>{t.readFile(P,(U,G)=>U?O(U):x(G))})}function A(P,x){return new Promise((O,U)=>{t.writeFile(P,x,G=>G?U(G):O())})}}).call(this,{isBuffer:_("../../is-buffer/index.js")})},{"../../is-buffer/index.js":76,"./bitmapimage":65,"./gif":66,"./gifcodec":67,"./gifframe":68,fs:47,"image-q":74}],70:[function(_,k,b){const T=_("./bitmapimage"),{Gif:t,GifError:S}=_("./gif"),{GifCodec:D}=_("./gifcodec"),{GifFrame:w}=_("./gifframe"),E=_("./gifutil");k.exports={BitmapImage:T,Gif:t,GifCodec:D,GifFrame:w,GifUtil:E,GifError:S}},{"./bitmapimage":65,"./gif":66,"./gifcodec":67,"./gifframe":68,"./gifutil":69}],71:[function(_,k,b){(function(T){var t;typeof v<"u"?t=v:typeof T<"u"?t=T:typeof self<"u"?t=self:t={},k.exports=t}).call(this,typeof Hr<"u"?Hr:typeof self<"u"?self:typeof v<"u"?v:{})},{}],72:[function(_,k,b){var T=_("http"),t=_("url"),S=k.exports;for(var D in T)T.hasOwnProperty(D)&&(S[D]=T[D]);S.request=function(E,m){return E=w(E),T.request.call(this,E,m)},S.get=function(E,m){return E=w(E),T.get.call(this,E,m)};function w(E){if(typeof E=="string"&&(E=t.parse(E)),E.protocol||(E.protocol="https:"),E.protocol!=="https:")throw new Error('Protocol "'+E.protocol+'" not supported. Expected "https:"');return E}},{http:156,url:180}],73:[function(_,k,b){b.read=function(T,t,S,D,w){var E,m,y=w*8-D-1,p=(1<<y)-1,C=p>>1,z=-7,A=S?w-1:0,P=S?-1:1,x=T[t+A];for(A+=P,E=x&(1<<-z)-1,x>>=-z,z+=y;z>0;E=E*256+T[t+A],A+=P,z-=8);for(m=E&(1<<-z)-1,E>>=-z,z+=D;z>0;m=m*256+T[t+A],A+=P,z-=8);if(E===0)E=1-C;else{if(E===p)return m?NaN:(x?-1:1)*(1/0);m=m+Math.pow(2,D),E=E-C}return(x?-1:1)*m*Math.pow(2,E-D)},b.write=function(T,t,S,D,w,E){var m,y,p,C=E*8-w-1,z=(1<<C)-1,A=z>>1,P=w===23?Math.pow(2,-24)-Math.pow(2,-77):0,x=D?0:E-1,O=D?1:-1,U=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(y=isNaN(t)?1:0,m=z):(m=Math.floor(Math.log(t)/Math.LN2),t*(p=Math.pow(2,-m))<1&&(m--,p*=2),m+A>=1?t+=P/p:t+=P*Math.pow(2,1-A),t*p>=2&&(m++,p/=2),m+A>=z?(y=0,m=z):m+A>=1?(y=(t*p-1)*Math.pow(2,w),m=m+A):(y=t*Math.pow(2,A-1)*Math.pow(2,w),m=0));w>=8;T[S+x]=y&255,x+=O,y/=256,w-=8);for(m=m<<w|y,C+=w;C>0;T[S+x]=m&255,x+=O,m/=256,C-=8);T[S+x-O]|=U*128}},{}],74:[function(_,k,b){(function(t,S){typeof b=="object"&&typeof k=="object"?k.exports=S():typeof b=="object"?b.iq=S():t.iq=S()})(this,function(){return function(T){var t={};function S(D){if(t[D])return t[D].exports;var w=t[D]={exports:{},id:D,loaded:!1};return T[D].call(w.exports,w,w.exports,S),w.loaded=!0,w.exports}return S.m=T,S.c=t,S.p="",S(0)}([function(T,t,S){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * iq.ts - Image Quantization Library
 */var D=S(1);t.constants=D;var w=S(3);t.conversion=w;var E=S(12);t.distance=E;var m=S(20);t.palette=m;var y=S(30);t.image=y;var p=S(35);t.quality=p;var C=S(37);t.utils=C},function(T,t,S){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * constants.ts - part of Image Quantization Library
 */var D=S(2);t.bt709=D},function(T,t){var S;(function(E){E[E.RED=.2126]="RED",E[E.GREEN=.7152]="GREEN",E[E.BLUE=.0722]="BLUE",E[E.WHITE=1]="WHITE"})(S||(S={})),t.Y=S;var D;(function(E){E[E.RED=.64]="RED",E[E.GREEN=.3]="GREEN",E[E.BLUE=.15]="BLUE",E[E.WHITE=.3127]="WHITE"})(D||(D={})),t.x=D;var w;(function(E){E[E.RED=.33]="RED",E[E.GREEN=.6]="GREEN",E[E.BLUE=.06]="BLUE",E[E.WHITE=.329]="WHITE"})(w||(w={})),t.y=w},function(T,t,S){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * iq.ts - Image Quantization Library
 */var D=S(4);t.rgb2xyz=D.rgb2xyz;var w=S(5);t.rgb2hsl=w.rgb2hsl;var E=S(7);t.rgb2lab=E.rgb2lab;var m=S(9);t.lab2xyz=m.lab2xyz;var y=S(10);t.lab2rgb=y.lab2rgb;var p=S(8);t.xyz2lab=p.xyz2lab;var C=S(11);t.xyz2rgb=C.xyz2rgb},function(T,t){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgb2xyz.ts - part of Image Quantization Library
 */function S(w){return w>.04045?Math.pow((w+.055)/1.055,2.4):w/12.92}function D(w,E,m){return w=S(w/255),E=S(E/255),m=S(m/255),{x:w*.4124+E*.3576+m*.1805,y:w*.2126+E*.7152+m*.0722,z:w*.0193+E*.1192+m*.9505}}t.rgb2xyz=D},function(T,t,S){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgb2hsl.ts - part of Image Quantization Library
 */var D=S(6);function w(E,m,y){var p=D.min3(E,m,y),C=D.max3(E,m,y),z=C-p,A=(p+C)/510,P=0;A>0&&A<1&&(P=z/(A<.5?C+p:510-C-p));var x=0;return z>0&&(C===E?x=(m-y)/z:C===m?x=2+(y-E)/z:x=4+(E-m)/z,x*=60,x<0&&(x+=360)),{h:x,s:P,l:A}}t.rgb2hsl=w},function(T,t){function S(C){return C*(Math.PI/180)}t.degrees2radians=S;function D(C,z,A){var P=C;return P<z&&(P=z),P<A&&(P=A),P}t.max3=D;function w(C,z,A){var P=C;return P>z&&(P=z),P>A&&(P=A),P}t.min3=w;function E(C,z,A){return C>A&&(C=A),C<z&&(C=z),C|0}t.intInRange=E;function m(C){return C=Math.round(C),C>255?C=255:C<0&&(C=0),C}t.inRange0to255Rounded=m;function y(C){return C>255?C=255:C<0&&(C=0),C}t.inRange0to255=y;function p(C,z){var A=typeof C[0],P;if(A==="number"||A==="string"){for(var x=Object.create(null),O=0,U=C.length;O<U;O++){var G=C[O];x[G]||x[G]===0||(x[G]=O)}P=C.sort(function(X,W){return z(X,W)||x[X]-x[W]})}else{var Z=C.slice(0);P=C.sort(function(X,W){return z(X,W)||Z.indexOf(X)-Z.indexOf(W)})}return P}t.stableSort=p},function(T,t,S){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgb2lab.ts - part of Image Quantization Library
 */var D=S(4),w=S(8);function E(m,y,p){var C=D.rgb2xyz(m,y,p);return w.xyz2lab(C.x,C.y,C.z)}t.rgb2lab=E},function(T,t){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * xyz2lab.ts - part of Image Quantization Library
 */var S=.95047,D=1,w=1.08883;function E(y){return y>.008856?Math.pow(y,1/3):7.787*y+16/116}function m(y,p,C){if(y=E(y/S),p=E(p/D),C=E(C/w),116*p-16<0)throw new Error("xxx");return{L:Math.max(0,116*p-16),a:500*(y-p),b:200*(p-C)}}t.xyz2lab=m},function(T,t){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * lab2xyz.ts - part of Image Quantization Library
 */var S=.95047,D=1,w=1.08883;function E(y){return y>.206893034?Math.pow(y,3):(y-16/116)/7.787}function m(y,p,C){var z=(y+16)/116,A=p/500+z,P=z-C/200;return{x:S*E(A),y:D*E(z),z:w*E(P)}}t.lab2xyz=m},function(T,t,S){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * lab2rgb.ts - part of Image Quantization Library
 */var D=S(9),w=S(11);function E(m,y,p){var C=D.lab2xyz(m,y,p);return w.xyz2rgb(C.x,C.y,C.z)}t.lab2rgb=E},function(T,t,S){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * xyz2rgb.ts - part of Image Quantization Library
 */var D=S(6);function w(m){return m>.0031308?1.055*Math.pow(m,1/2.4)-.055:12.92*m}function E(m,y,p){var C=w(m*3.2406+y*-1.5372+p*-.4986),z=w(m*-.9689+y*1.8758+p*.0415),A=w(m*.0557+y*-.204+p*1.057);return{r:D.inRange0to255Rounded(C*255),g:D.inRange0to255Rounded(z*255),b:D.inRange0to255Rounded(A*255)}}t.xyz2rgb=E},function(T,t,S){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * iq.ts - Image Quantization Library
 */var D=S(13);t.AbstractDistanceCalculator=D.AbstractDistanceCalculator;var w=S(14);t.CIE94Textiles=w.CIE94Textiles,t.CIE94GraphicArts=w.CIE94GraphicArts;var E=S(15);t.CIEDE2000=E.CIEDE2000;var m=S(16);t.CMETRIC=m.CMETRIC;var y=S(17);t.AbstractEuclidean=y.AbstractEuclidean,t.Euclidean=y.Euclidean,t.EuclideanRgbQuantWOAlpha=y.EuclideanRgbQuantWOAlpha,t.EuclideanRgbQuantWithAlpha=y.EuclideanRgbQuantWithAlpha;var p=S(18);t.AbstractManhattan=p.AbstractManhattan,t.Manhattan=p.Manhattan,t.ManhattanSRGB=p.ManhattanSRGB,t.ManhattanNommyde=p.ManhattanNommyde;var C=S(19);t.PNGQUANT=C.PNGQUANT},function(T,t){var S=function(){function D(){this._setDefaults(),this.setWhitePoint(255,255,255,255)}return D.prototype.setWhitePoint=function(w,E,m,y){this._whitePoint={r:w>0?255/w:0,g:E>0?255/E:0,b:m>0?255/m:0,a:y>0?255/y:0},this._maxDistance=this.calculateRaw(w,E,m,y,0,0,0,0)},D.prototype.calculateNormalized=function(w,E){return this.calculateRaw(w.r,w.g,w.b,w.a,E.r,E.g,E.b,E.a)/this._maxDistance},D.prototype._setDefaults=function(){},D}();t.AbstractDistanceCalculator=S},function(T,t,S){var D=this&&this.__extends||function(z,A){for(var P in A)A.hasOwnProperty(P)&&(z[P]=A[P]);function x(){this.constructor=z}z.prototype=A===null?Object.create(A):(x.prototype=A.prototype,new x)};/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * cie94.ts - part of Image Quantization Library
 */var w=S(13),E=S(7),m=S(6),y=function(z){D(A,z);function A(){z.apply(this,arguments)}return A.prototype.calculateRaw=function(P,x,O,U,G,Z,X,W){var J=E.rgb2lab(m.inRange0to255(P*this._whitePoint.r),m.inRange0to255(x*this._whitePoint.g),m.inRange0to255(O*this._whitePoint.b)),re=E.rgb2lab(m.inRange0to255(G*this._whitePoint.r),m.inRange0to255(Z*this._whitePoint.g),m.inRange0to255(X*this._whitePoint.b)),te=J.L-re.L,ye=J.a-re.a,ue=J.b-re.b,Se=Math.sqrt(J.a*J.a+J.b*J.b),Le=Math.sqrt(re.a*re.a+re.b*re.b),Pe=Se-Le,Ee=ye*ye+ue*ue-Pe*Pe;Ee=Ee<0?0:Math.sqrt(Ee);var Me=(W-U)*this._whitePoint.a*this._kA;return Math.sqrt(Math.pow(te/this._Kl,2)+Math.pow(Pe/(1+this._K1*Se),2)+Math.pow(Ee/(1+this._K2*Se),2)+Math.pow(Me,2))},A}(w.AbstractDistanceCalculator);t.AbstractCIE94=y;var p=function(z){D(A,z);function A(){z.apply(this,arguments)}return A.prototype._setDefaults=function(){this._Kl=2,this._K1=.048,this._K2=.014,this._kA=.25*50/255},A}(y);t.CIE94Textiles=p;var C=function(z){D(A,z);function A(){z.apply(this,arguments)}return A.prototype._setDefaults=function(){this._Kl=1,this._K1=.045,this._K2=.015,this._kA=.25*100/255},A}(y);t.CIE94GraphicArts=C},function(T,t,S){var D=this&&this.__extends||function(p,C){for(var z in C)C.hasOwnProperty(z)&&(p[z]=C[z]);function A(){this.constructor=p}p.prototype=C===null?Object.create(C):(A.prototype=C.prototype,new A)};/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * ciede2000.ts - part of Image Quantization Library
 */var w=S(13),E=S(7),m=S(6),y=function(p){D(C,p);function C(){p.apply(this,arguments)}return C.prototype.calculateRaw=function(z,A,P,x,O,U,G,Z){var X=E.rgb2lab(m.inRange0to255(z*this._whitePoint.r),m.inRange0to255(A*this._whitePoint.g),m.inRange0to255(P*this._whitePoint.b)),W=E.rgb2lab(m.inRange0to255(O*this._whitePoint.r),m.inRange0to255(U*this._whitePoint.g),m.inRange0to255(G*this._whitePoint.b)),J=(Z-x)*this._whitePoint.a*C._kA,re=this.calculateRawInLab(X,W);return Math.sqrt(re+J*J)},C.prototype.calculateRawInLab=function(z,A){var P=z.L,x=z.a,O=z.b,U=A.L,G=A.a,Z=A.b,X=Math.sqrt(x*x+O*O),W=Math.sqrt(G*G+Z*Z),J=Math.pow((X+W)/2,7),re=.5*(1-Math.sqrt(J/(J+C._pow25to7))),te=(1+re)*x,ye=(1+re)*G,ue=Math.sqrt(te*te+O*O),Se=Math.sqrt(ye*ye+Z*Z),Le=ue*Se,Pe=C._calculatehp(O,te),Ee=C._calculatehp(Z,ye),Me=Math.abs(Pe-Ee),He=U-P,nt=Se-ue,ht=C._calculate_dHp(Le,Me,Ee,Pe),Fe=C._calculate_ahp(Le,Me,Pe,Ee),Ce=C._calculateT(Fe),Be=(ue+Se)/2,Ae=Math.pow((P+U)/2-50,2),se=1+.015*Ae/Math.sqrt(20+Ae),pe=1+.045*Be,Ke=1+.015*Ce*Be,_e=C._calculateRT(Fe,Be),ke=He/se,qe=nt/pe,tt=ht/Ke;return Math.pow(ke,2)+Math.pow(qe,2)+Math.pow(tt,2)+_e*qe*tt},C._calculatehp=function(z,A){var P=Math.atan2(z,A);return P>=0?P:P+C._deg360InRad},C._calculateRT=function(z,A){var P=Math.pow(A,7),x=2*Math.sqrt(P/(P+C._pow25to7)),O=C._deg30InRad*Math.exp(-Math.pow((z-C._deg275InRad)/C._deg25InRad,2));return-Math.sin(2*O)*x},C._calculateT=function(z){return 1-.17*Math.cos(z-C._deg30InRad)+.24*Math.cos(z*2)+.32*Math.cos(z*3+C._deg6InRad)-.2*Math.cos(z*4-C._deg63InRad)},C._calculate_ahp=function(z,A,P,x){var O=P+x;return z==0?O:A<=C._deg180InRad?O/2:O<C._deg360InRad?(O+C._deg360InRad)/2:(O-C._deg360InRad)/2},C._calculate_dHp=function(z,A,P,x){var O;return z==0?O=0:A<=C._deg180InRad?O=P-x:P<=x?O=P-x+C._deg360InRad:O=P-x-C._deg360InRad,2*Math.sqrt(z)*Math.sin(O/2)},C._kA=.25*100/255,C._pow25to7=Math.pow(25,7),C._deg360InRad=m.degrees2radians(360),C._deg180InRad=m.degrees2radians(180),C._deg30InRad=m.degrees2radians(30),C._deg6InRad=m.degrees2radians(6),C._deg63InRad=m.degrees2radians(63),C._deg275InRad=m.degrees2radians(275),C._deg25InRad=m.degrees2radians(25),C}(w.AbstractDistanceCalculator);t.CIEDE2000=y},function(T,t,S){var D=this&&this.__extends||function(m,y){for(var p in y)y.hasOwnProperty(p)&&(m[p]=y[p]);function C(){this.constructor=m}m.prototype=y===null?Object.create(y):(C.prototype=y.prototype,new C)};/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * cmetric.ts - part of Image Quantization Library
 */var w=S(13),E=function(m){D(y,m);function y(){m.apply(this,arguments)}return y.prototype.calculateRaw=function(p,C,z,A,P,x,O,U){var G=(p+P)/2*this._whitePoint.r,Z=(p-P)*this._whitePoint.r,X=(C-x)*this._whitePoint.g,W=(z-O)*this._whitePoint.b,J=((512+G)*Z*Z>>8)+4*X*X+((767-G)*W*W>>8),re=(U-A)*this._whitePoint.a;return Math.sqrt(J+re*re)},y}(w.AbstractDistanceCalculator);t.CMETRIC=E},function(T,t,S){var D=this&&this.__extends||function(z,A){for(var P in A)A.hasOwnProperty(P)&&(z[P]=A[P]);function x(){this.constructor=z}z.prototype=A===null?Object.create(A):(x.prototype=A.prototype,new x)};/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * euclidean.ts - part of Image Quantization Library
 */var w=S(13),E=S(2),m=function(z){D(A,z);function A(){z.apply(this,arguments)}return A.prototype.calculateRaw=function(P,x,O,U,G,Z,X,W){var J=G-P,re=Z-x,te=X-O,ye=W-U;return Math.sqrt(this._kR*J*J+this._kG*re*re+this._kB*te*te+this._kA*ye*ye)},A}(w.AbstractDistanceCalculator);t.AbstractEuclidean=m;var y=function(z){D(A,z);function A(){z.apply(this,arguments)}return A.prototype._setDefaults=function(){this._kR=1,this._kG=1,this._kB=1,this._kA=1},A}(m);t.Euclidean=y;var p=function(z){D(A,z);function A(){z.apply(this,arguments)}return A.prototype._setDefaults=function(){this._kR=E.Y.RED,this._kG=E.Y.GREEN,this._kB=E.Y.BLUE,this._kA=1},A}(m);t.EuclideanRgbQuantWithAlpha=p;var C=function(z){D(A,z);function A(){z.apply(this,arguments)}return A.prototype._setDefaults=function(){this._kR=E.Y.RED,this._kG=E.Y.GREEN,this._kB=E.Y.BLUE,this._kA=0},A}(m);t.EuclideanRgbQuantWOAlpha=C},function(T,t,S){var D=this&&this.__extends||function(z,A){for(var P in A)A.hasOwnProperty(P)&&(z[P]=A[P]);function x(){this.constructor=z}z.prototype=A===null?Object.create(A):(x.prototype=A.prototype,new x)};/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * manhattanNeuQuant.ts - part of Image Quantization Library
 */var w=S(13),E=S(2),m=function(z){D(A,z);function A(){z.apply(this,arguments)}return A.prototype.calculateRaw=function(P,x,O,U,G,Z,X,W){var J=G-P,re=Z-x,te=X-O,ye=W-U;return J<0&&(J=0-J),re<0&&(re=0-re),te<0&&(te=0-te),ye<0&&(ye=0-ye),this._kR*J+this._kG*re+this._kB*te+this._kA*ye},A}(w.AbstractDistanceCalculator);t.AbstractManhattan=m;var y=function(z){D(A,z);function A(){z.apply(this,arguments)}return A.prototype._setDefaults=function(){this._kR=1,this._kG=1,this._kB=1,this._kA=1},A}(m);t.Manhattan=y;var p=function(z){D(A,z);function A(){z.apply(this,arguments)}return A.prototype._setDefaults=function(){this._kR=.4984,this._kG=.8625,this._kB=.2979,this._kA=1},A}(m);t.ManhattanNommyde=p;var C=function(z){D(A,z);function A(){z.apply(this,arguments)}return A.prototype._setDefaults=function(){this._kR=E.Y.RED,this._kG=E.Y.GREEN,this._kB=E.Y.BLUE,this._kA=1},A}(m);t.ManhattanSRGB=C},function(T,t,S){var D=this&&this.__extends||function(m,y){for(var p in y)y.hasOwnProperty(p)&&(m[p]=y[p]);function C(){this.constructor=m}m.prototype=y===null?Object.create(y):(C.prototype=y.prototype,new C)};/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * pngQuant.ts - part of Image Quantization Library
 */var w=S(13),E=function(m){D(y,m);function y(){m.apply(this,arguments)}return y.prototype.calculateRaw=function(p,C,z,A,P,x,O,U){var G=(U-A)*this._whitePoint.a;return this._colordifference_ch(p*this._whitePoint.r,P*this._whitePoint.r,G)+this._colordifference_ch(C*this._whitePoint.g,x*this._whitePoint.g,G)+this._colordifference_ch(z*this._whitePoint.b,O*this._whitePoint.b,G)},y.prototype._colordifference_ch=function(p,C,z){var A=p-C,P=A+z;return A*A+P*P},y}(w.AbstractDistanceCalculator);t.PNGQUANT=E},function(T,t,S){var D=S(21);t.NeuQuant=D.NeuQuant;var w=S(25);t.NeuQuantFloat=w.NeuQuantFloat;var E=S(26);t.RGBQuant=E.RGBQuant;var m=S(27);t.ColorHistogram=m.ColorHistogram;var y=S(29);t.WuQuant=y.WuQuant,t.WuColorCube=y.WuColorCube},function(T,t,S){/**
 * @preserve TypeScript port:
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * neuquant.ts - part of Image Quantization Library
 */var D=S(22),w=S(24),E=3,m=function(){function p(C){this.r=this.g=this.b=this.a=C}return p.prototype.toPoint=function(){return w.Point.createByRGBA(this.r>>E,this.g>>E,this.b>>E,this.a>>E)},p.prototype.subtract=function(C,z,A,P){this.r-=C|0,this.g-=z|0,this.b-=A|0,this.a-=P|0},p}(),y=function(){function p(C,z){z===void 0&&(z=256),this._distance=C,this._pointArray=[],this._sampleFactor=1,this._networkSize=z,this._distance.setWhitePoint(255<<E,255<<E,255<<E,255<<E)}return p.prototype.sample=function(C){this._pointArray=this._pointArray.concat(C.getPointArray())},p.prototype.quantize=function(){return this._init(),this._learn(),this._buildPalette()},p.prototype._init=function(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(var C=0;C<this._networkSize;C++)this._network[C]=new m((C<<E+8)/this._networkSize|0),this._freq[C]=p._initialBias/this._networkSize|0,this._bias[C]=0},p.prototype._learn=function(){var C=this._sampleFactor,z=this._pointArray.length;z<p._minpicturebytes&&(C=1);var A=30+(C-1)/3|0,P=z/C|0,x=P/p._nCycles|0,O=p._initAlpha,U=(this._networkSize>>3)*p._radiusBias,G=U>>p._radiusBiasShift;G<=1&&(G=0);for(var Z=0;Z<G;Z++)this._radPower[Z]=O*((G*G-Z*Z)*p._radBias/(G*G))>>>0;var X;z<p._minpicturebytes?X=1:z%p._prime1!=0?X=p._prime1:z%p._prime2!=0?X=p._prime2:z%p._prime3!=0?X=p._prime3:X=p._prime4;for(var Z=0,W=0;Z<P;){var J=this._pointArray[W],re=J.b<<E,te=J.g<<E,ye=J.r<<E,ue=J.a<<E,Se=this._contest(re,te,ye,ue);if(this._alterSingle(O,Se,re,te,ye,ue),G!==0&&this._alterNeighbour(G,Se,re,te,ye,ue),W+=X,W>=z&&(W-=z),Z++,x===0&&(x=1),Z%x===0){O-=O/A|0,U-=U/p._radiusDecrease|0,G=U>>p._radiusBiasShift,G<=1&&(G=0);for(var Le=0;Le<G;Le++)this._radPower[Le]=O*((G*G-Le*Le)*p._radBias/(G*G))>>>0}}},p.prototype._buildPalette=function(){var C=new D.Palette;return this._network.forEach(function(z){C.add(z.toPoint())}),C.sort(),C},p.prototype._alterNeighbour=function(C,z,A,P,x,O){var U=z-C;U<-1&&(U=-1);var G=z+C;G>this._networkSize&&(G=this._networkSize);for(var Z=z+1,X=z-1,W=1;Z<G||X>U;){var J=this._radPower[W++]/p._alphaRadBias;if(Z<G){var re=this._network[Z++];re.subtract(J*(re.r-x),J*(re.g-P),J*(re.b-A),J*(re.a-O))}if(X>U){var re=this._network[X--];re.subtract(J*(re.r-x),J*(re.g-P),J*(re.b-A),J*(re.a-O))}}},p.prototype._alterSingle=function(C,z,A,P,x,O){C/=p._initAlpha;var U=this._network[z];U.subtract(C*(U.r-x),C*(U.g-P),C*(U.b-A),C*(U.a-O))},p.prototype._contest=function(C,z,A,P){for(var x=1020<<E,O=2147483647,U=O,G=-1,Z=G,X=0;X<this._networkSize;X++){var W=this._network[X],J=this._distance.calculateNormalized(W,{r:A,g:z,b:C,a:P})*x|0;J<O&&(O=J,G=X);var re=J-(this._bias[X]>>p._initialBiasShift-E);re<U&&(U=re,Z=X);var te=this._freq[X]>>p._betaShift;this._freq[X]-=te,this._bias[X]+=te<<p._gammaShift}return this._freq[G]+=p._beta,this._bias[G]-=p._betaGamma,Z},p._prime1=499,p._prime2=491,p._prime3=487,p._prime4=503,p._minpicturebytes=p._prime4,p._nCycles=100,p._initialBiasShift=16,p._initialBias=1<<p._initialBiasShift,p._gammaShift=10,p._betaShift=10,p._beta=p._initialBias>>p._betaShift,p._betaGamma=p._initialBias<<p._gammaShift-p._betaShift,p._radiusBiasShift=6,p._radiusBias=1<<p._radiusBiasShift,p._radiusDecrease=30,p._alphaBiasShift=10,p._initAlpha=1<<p._alphaBiasShift,p._radBiasShift=8,p._radBias=1<<p._radBiasShift,p._alphaRadBiasShift=p._alphaBiasShift+p._radBiasShift,p._alphaRadBias=1<<p._alphaRadBiasShift,p}();t.NeuQuant=y},function(T,t,S){var D=S(23),w=S(5),E=10;function m(p,C){for(var z=360,A=z/C,P=A/2,x=1,O=A-P;x<C;x++,O+=A)if(p>=O&&p<O+A)return x;return 0}t.hueGroup=m;var y=function(){function p(){this._pointArray=[],this._i32idx={},this._pointContainer=new D.PointContainer,this._pointContainer.setHeight(1),this._pointArray=this._pointContainer.getPointArray()}return p.prototype.add=function(C){this._pointArray.push(C),this._pointContainer.setWidth(this._pointArray.length)},p.prototype.has=function(C){for(var z=this._pointArray.length-1;z>=0;z--)if(C.uint32===this._pointArray[z].uint32)return!0;return!1},p.prototype.getNearestColor=function(C,z){return this._pointArray[this.getNearestIndex(C,z)|0]},p.prototype.getPointContainer=function(){return this._pointContainer},p.prototype._nearestPointFromCache=function(C){return typeof this._i32idx[C]=="number"?this._i32idx[C]:-1},p.prototype.getNearestIndex=function(C,z){var A=this._nearestPointFromCache(""+z.uint32);if(A>=0)return A;var P=Number.MAX_VALUE;A=0;for(var x=0,O=this._pointArray.length;x<O;x++){var U=this._pointArray[x],G=C.calculateRaw(z.r,z.g,z.b,z.a,U.r,U.g,U.b,U.a);G<P&&(P=G,A=x)}return this._i32idx[z.uint32]=A,A},p.prototype.sort=function(){this._i32idx={},this._pointArray.sort(function(C,z){var A=w.rgb2hsl(C.r,C.g,C.b),P=w.rgb2hsl(z.r,z.g,z.b),x=C.r===C.g&&C.g===C.b?0:1+m(A.h,E),O=z.r===z.g&&z.g===z.b?0:1+m(P.h,E),U=O-x;if(U)return-U;var G=C.getLuminosity(!0),Z=z.getLuminosity(!0);if(Z-G!==0)return Z-G;var X=(P.s*100|0)-(A.s*100|0);return X?-X:0})},p}();t.Palette=y},function(T,t,S){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * pointContainer.ts - part of Image Quantization Library
 */var D=S(24),w=function(){function E(){this._width=0,this._height=0,this._pointArray=[]}return E.prototype.getWidth=function(){return this._width},E.prototype.getHeight=function(){return this._height},E.prototype.setWidth=function(m){this._width=m},E.prototype.setHeight=function(m){this._height=m},E.prototype.getPointArray=function(){return this._pointArray},E.prototype.clone=function(){var m=new E;m._width=this._width,m._height=this._height;for(var y=0,p=this._pointArray.length;y<p;y++)m._pointArray[y]=D.Point.createByUint32(this._pointArray[y].uint32|0);return m},E.prototype.toUint32Array=function(){for(var m=this._pointArray.length,y=new Uint32Array(m),p=0;p<m;p++)y[p]=this._pointArray[p].uint32;return y},E.prototype.toUint8Array=function(){return new Uint8Array(this.toUint32Array().buffer)},E.fromHTMLImageElement=function(m){var y=m.naturalWidth,p=m.naturalHeight,C=document.createElement("canvas");C.width=y,C.height=p;var z=C.getContext("2d");return z.drawImage(m,0,0,y,p,0,0,y,p),E.fromHTMLCanvasElement(C)},E.fromHTMLCanvasElement=function(m){var y=m.width,p=m.height,C=m.getContext("2d"),z=C.getImageData(0,0,y,p);return E.fromImageData(z)},E.fromNodeCanvas=function(m){return E.fromHTMLCanvasElement(m)},E.fromImageData=function(m){var y=m.width,p=m.height;return E.fromCanvasPixelArray(m.data,y,p)},E.fromArray=function(m,y,p){var C=new Uint8Array(m);return E.fromUint8Array(C,y,p)},E.fromCanvasPixelArray=function(m,y,p){return E.fromArray(m,y,p)},E.fromUint8Array=function(m,y,p){return E.fromUint32Array(new Uint32Array(m.buffer),y,p)},E.fromUint32Array=function(m,y,p){var C=new E;C._width=y,C._height=p;for(var z=0,A=m.length;z<A;z++)C._pointArray[z]=D.Point.createByUint32(m[z]|0);return C},E}();t.PointContainer=w},function(T,t,S){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * point.ts - part of Image Quantization Library
 */var D=S(2),w=function(){function E(){this.uint32=-1>>>0,this.r=this.g=this.b=this.a=0,this.rgba=new Array(4),this.rgba[0]=0,this.rgba[1]=0,this.rgba[2]=0,this.rgba[3]=0}return E.createByQuadruplet=function(m){var y=new E;return y.r=m[0]|0,y.g=m[1]|0,y.b=m[2]|0,y.a=m[3]|0,y._loadUINT32(),y._loadQuadruplet(),y},E.createByRGBA=function(m,y,p,C){var z=new E;return z.r=m|0,z.g=y|0,z.b=p|0,z.a=C|0,z._loadUINT32(),z._loadQuadruplet(),z},E.createByUint32=function(m){var y=new E;return y.uint32=m>>>0,y._loadRGBA(),y._loadQuadruplet(),y},E.prototype.from=function(m){this.r=m.r,this.g=m.g,this.b=m.b,this.a=m.a,this.uint32=m.uint32,this.rgba[0]=m.r,this.rgba[1]=m.g,this.rgba[2]=m.b,this.rgba[3]=m.a},E.prototype.getLuminosity=function(m){var y=this.r,p=this.g,C=this.b;return m&&(y=Math.min(255,255-this.a+this.a*y/255),p=Math.min(255,255-this.a+this.a*p/255),C=Math.min(255,255-this.a+this.a*C/255)),y*D.Y.RED+p*D.Y.GREEN+C*D.Y.BLUE},E.prototype._loadUINT32=function(){this.uint32=(this.a<<24|this.b<<16|this.g<<8|this.r)>>>0},E.prototype._loadRGBA=function(){this.r=this.uint32&255,this.g=this.uint32>>>8&255,this.b=this.uint32>>>16&255,this.a=this.uint32>>>24&255},E.prototype._loadQuadruplet=function(){this.rgba[0]=this.r,this.rgba[1]=this.g,this.rgba[2]=this.b,this.rgba[3]=this.a},E}();t.Point=w},function(T,t,S){/**
 * @preserve TypeScript port:
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * neuquant.ts - part of Image Quantization Library
 */var D=S(22),w=S(24),E=3,m=function(){function p(C){this.r=this.g=this.b=this.a=C}return p.prototype.toPoint=function(){return w.Point.createByRGBA(this.r>>E,this.g>>E,this.b>>E,this.a>>E)},p.prototype.subtract=function(C,z,A,P){this.r-=C,this.g-=z,this.b-=A,this.a-=P},p}(),y=function(){function p(C,z){z===void 0&&(z=256),this._distance=C,this._pointArray=[],this._sampleFactor=1,this._networkSize=z,this._distance.setWhitePoint(255<<E,255<<E,255<<E,255<<E)}return p.prototype.sample=function(C){this._pointArray=this._pointArray.concat(C.getPointArray())},p.prototype.quantize=function(){return this._init(),this._learn(),this._buildPalette()},p.prototype._init=function(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(var C=0;C<this._networkSize;C++)this._network[C]=new m((C<<E+8)/this._networkSize),this._freq[C]=p._initialBias/this._networkSize,this._bias[C]=0},p.prototype._learn=function(){var C=this._sampleFactor,z=this._pointArray.length;z<p._minpicturebytes&&(C=1);var A=30+(C-1)/3,P=z/C,x=P/p._nCycles|0,O=p._initAlpha,U=(this._networkSize>>3)*p._radiusBias,G=U>>p._radiusBiasShift;G<=1&&(G=0);for(var Z=0;Z<G;Z++)this._radPower[Z]=O*((G*G-Z*Z)*p._radBias/(G*G));var X;z<p._minpicturebytes?X=1:z%p._prime1!=0?X=p._prime1:z%p._prime2!=0?X=p._prime2:z%p._prime3!=0?X=p._prime3:X=p._prime4;for(var Z=0,W=0;Z<P;){var J=this._pointArray[W],re=J.b<<E,te=J.g<<E,ye=J.r<<E,ue=J.a<<E,Se=this._contest(re,te,ye,ue);if(this._alterSingle(O,Se,re,te,ye,ue),G!=0&&this._alterNeighbour(G,Se,re,te,ye,ue),W+=X,W>=z&&(W-=z),Z++,x==0&&(x=1),Z%x==0){O-=O/A,U-=U/p._radiusDecrease,G=U>>p._radiusBiasShift,G<=1&&(G=0);for(var Le=0;Le<G;Le++)this._radPower[Le]=O*((G*G-Le*Le)*p._radBias/(G*G))}}},p.prototype._buildPalette=function(){var C=new D.Palette;return this._network.forEach(function(z){C.add(z.toPoint())}),C.sort(),C},p.prototype._alterNeighbour=function(C,z,A,P,x,O){var U=z-C;U<-1&&(U=-1);var G=z+C;G>this._networkSize&&(G=this._networkSize);for(var Z=z+1,X=z-1,W=1;Z<G||X>U;){var J=this._radPower[W++]/p._alphaRadBias;if(Z<G){var re=this._network[Z++];re.subtract(J*(re.r-x),J*(re.g-P),J*(re.b-A),J*(re.a-O))}if(X>U){var re=this._network[X--];re.subtract(J*(re.r-x),J*(re.g-P),J*(re.b-A),J*(re.a-O))}}},p.prototype._alterSingle=function(C,z,A,P,x,O){C/=p._initAlpha;var U=this._network[z];U.subtract(C*(U.r-x),C*(U.g-P),C*(U.b-A),C*(U.a-O))},p.prototype._contest=function(C,z,A,P){for(var x=1020<<E,O=2147483647,U=O,G=-1,Z=G,X=0;X<this._networkSize;X++){var W=this._network[X],J=this._distance.calculateNormalized(W,{r:A,g:z,b:C,a:P})*x;J<O&&(O=J,G=X);var re=J-(this._bias[X]>>p._initialBiasShift-E);re<U&&(U=re,Z=X);var te=this._freq[X]>>p._betaShift;this._freq[X]-=te,this._bias[X]+=te<<p._gammaShift}return this._freq[G]+=p._beta,this._bias[G]-=p._betaGamma,Z},p._prime1=499,p._prime2=491,p._prime3=487,p._prime4=503,p._minpicturebytes=p._prime4,p._nCycles=100,p._initialBiasShift=16,p._initialBias=1<<p._initialBiasShift,p._gammaShift=10,p._betaShift=10,p._beta=p._initialBias>>p._betaShift,p._betaGamma=p._initialBias<<p._gammaShift-p._betaShift,p._radiusBiasShift=6,p._radiusBias=1<<p._radiusBiasShift,p._radiusDecrease=30,p._alphaBiasShift=10,p._initAlpha=1<<p._alphaBiasShift,p._radBiasShift=8,p._radBias=1<<p._radBiasShift,p._alphaRadBiasShift=p._alphaBiasShift+p._radBiasShift,p._alphaRadBias=1<<p._alphaRadBiasShift,p}();t.NeuQuantFloat=y},function(T,t,S){/**
 * @preserve TypeScript port:
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgbquant.ts - part of Image Quantization Library
 */var D=S(22),w=S(24),E=S(27),m=S(6),y=function(){function C(z,A,P){this.index=z,this.color=A,this.distance=P}return C}(),p=function(){function C(z,A,P){A===void 0&&(A=256),P===void 0&&(P=2),this._distance=z,this._colors=A,this._histogram=new E.ColorHistogram(P,A),this._initialDistance=.01,this._distanceIncrement=.005}return C.prototype.sample=function(z){this._histogram.sample(z)},C.prototype.quantize=function(){var z=this._histogram.getImportanceSortedColorsIDXI32();if(z.length===0)throw new Error("No colors in image");var A=this._buildPalette(z);return A.sort(),A},C.prototype._buildPalette=function(z){for(var A=new D.Palette,P=A.getPointContainer().getPointArray(),x=new Array(z.length),O=0;O<z.length;O++)P.push(w.Point.createByUint32(z[O])),x[O]=1;for(var U=P.length,G=[],Z=U,X=this._initialDistance;Z>this._colors;){G.length=0;for(var O=0;O<U;O++)if(x[O]!==0){for(var W=P[O],J=O+1;J<U;J++)if(x[J]!==0){var re=P[J],te=this._distance.calculateNormalized(W,re);te<X&&(G.push(new y(J,re,te)),x[J]=0,Z--)}}X+=Z>this._colors*3?this._initialDistance:this._distanceIncrement}if(Z<this._colors){m.stableSort(G,function(Pe,Ee){return Ee.distance-Pe.distance});for(var ye=0;Z<this._colors&&ye<G.length;){var ue=G[ye];x[ue.index]=1,Z++,ye++}}for(var Se=P.length,Le=Se-1;Le>=0;Le--)x[Le]===0&&(Le!==Se-1&&(P[Le]=P[Se-1]),--Se);return P.length=Se,A},C}();t.RGBQuant=p},function(T,t,S){/**
 * @preserve TypeScript port:
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * colorHistogram.ts - part of Image Quantization Library
 */var D=S(28),w=S(6),E=function(){function m(y,p){this._method=y,this._minHueCols=p<<2,this._initColors=p<<2,this._hueStats=new D.HueStatistics(m._hueGroups,this._minHueCols),this._histogram=Object.create(null)}return m.prototype.sample=function(y){switch(this._method){case 1:this._colorStats1D(y);break;case 2:this._colorStats2D(y);break}},m.prototype.getImportanceSortedColorsIDXI32=function(){var y=this,p=w.stableSort(Object.keys(this._histogram),function(U,G){return y._histogram[G]-y._histogram[U]});if(p.length===0)return[];var C;switch(this._method){case 1:var z=Math.min(p.length,this._initColors),A=p[z-1],P=this._histogram[A];C=p.slice(0,z);for(var x=z,O=p.length;x<O&&this._histogram[p[x]]==P;)C.push(p[x++]);this._hueStats.injectIntoArray(C);break;case 2:C=p;break;default:throw new Error("Incorrect method")}return C.map(function(U){return+U})},m.prototype._colorStats1D=function(y){for(var p=this._histogram,C=y.getPointArray(),z=C.length,A=0;A<z;A++){var P=C[A].uint32;this._hueStats.check(P),P in p?p[P]++:p[P]=1}},m.prototype._colorStats2D=function(y){var p=this,C=y.getWidth(),z=y.getHeight(),A=y.getPointArray(),P=m._boxSize[0],x=m._boxSize[1],O=P*x,U=this._makeBoxes(C,z,P,x),G=this._histogram;U.forEach(function(Z){var X=Math.round(Z.w*Z.h/O)*m._boxPixels;X<2&&(X=2);var W={};p._iterateBox(Z,C,function(J){var re=A[J].uint32;p._hueStats.check(re),re in G?G[re]++:re in W?++W[re]>=X&&(G[re]=W[re]):W[re]=1})}),this._hueStats.injectIntoDictionary(G)},m.prototype._iterateBox=function(y,p,C){var z=y,A=z.y*p+z.x,P=(z.y+z.h-1)*p+(z.x+z.w-1),x=p-z.w+1,O=0,U=A;do C.call(this,U),U+=++O%z.w==0?x:1;while(U<=P)},m.prototype._makeBoxes=function(y,p,C,z){for(var A=y%C,P=p%z,x=y-A,O=p-P,U=[],G=0;G<p;G+=z)for(var Z=0;Z<y;Z+=C)U.push({x:Z,y:G,w:Z==x?A:C,h:G==O?P:z});return U},m._boxSize=[64,64],m._boxPixels=2,m._hueGroups=10,m}();t.ColorHistogram=E},function(T,t,S){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * hueStatistics.ts - part of Image Quantization Library
 */var D=S(5),w=S(22),E=function(){function y(){this.num=0,this.cols=[]}return y}(),m=function(){function y(p,C){this._numGroups=p,this._minCols=C,this._stats=[];for(var z=0;z<=p;z++)this._stats[z]=new E;this._groupsFull=0}return y.prototype.check=function(p){this._groupsFull==this._numGroups+1&&(this.check=function(){});var C=p&255,z=p>>>8&255,A=p>>>16&255,P=C==z&&z==A?0:1+w.hueGroup(D.rgb2hsl(C,z,A).h,this._numGroups),x=this._stats[P],O=this._minCols;x.num++,!(x.num>O)&&(x.num==O&&this._groupsFull++,x.num<=O&&this._stats[P].cols.push(p))},y.prototype.injectIntoDictionary=function(p){for(var C=0;C<=this._numGroups;C++)this._stats[C].num<=this._minCols&&this._stats[C].cols.forEach(function(z){p[z]?p[z]++:p[z]=1})},y.prototype.injectIntoArray=function(p){for(var C=0;C<=this._numGroups;C++)this._stats[C].num<=this._minCols&&this._stats[C].cols.forEach(function(z){p.indexOf(z)==-1&&p.push(z)})},y}();t.HueStatistics=m},function(T,t,S){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * wuQuant.ts - part of Image Quantization Library
 */var D=S(22),w=S(24);function E(P){for(var x=[],O=0;O<P;O++)x[O]=0;return x}function m(P,x,O,U){for(var G=new Array(P),Z=0;Z<P;Z++){G[Z]=new Array(x);for(var X=0;X<x;X++){G[Z][X]=new Array(O);for(var W=0;W<O;W++){G[Z][X][W]=new Array(U);for(var J=0;J<U;J++)G[Z][X][W][J]=0}}}return G}function y(P,x,O){for(var U=new Array(P),G=0;G<P;G++){U[G]=new Array(x);for(var Z=0;Z<x;Z++){U[G][Z]=new Array(O);for(var X=0;X<O;X++)U[G][Z][X]=0}}return U}function p(P,x,O,U,G){for(var Z=0;Z<x;Z++){P[Z]=[];for(var X=0;X<O;X++){P[Z][X]=[];for(var W=0;W<U;W++)P[Z][X][W]=G}}}function C(P,x,O){for(var U=0;U<x;U++)P[U]=O}var z=function(){function P(){}return P}();t.WuColorCube=z;var A=function(){function P(x,O,U){O===void 0&&(O=256),U===void 0&&(U=5),this._distance=x,this._setQuality(U),this._initialize(O)}return P.prototype.sample=function(x){for(var O=x.getPointArray(),U=0,G=O.length;U<G;U++)this._addColor(O[U]);this._pixels=this._pixels.concat(O)},P.prototype.quantize=function(){this._preparePalette();for(var x=new D.Palette,O=0;O<this._colors;O++)if(this._sums[O]>0){var U=this._sums[O],G=this._reds[O]/U,Z=this._greens[O]/U,X=this._blues[O]/U,W=this._alphas[O]/U,J=w.Point.createByRGBA(G|0,Z|0,X|0,W|0);x.add(J)}return x.sort(),x},P.prototype._preparePalette=function(){this._calculateMoments();for(var x=0,O=E(this._colors),U=1;U<this._colors;++U){this._cut(this._cubes[x],this._cubes[U])?(O[x]=this._cubes[x].volume>1?this._calculateVariance(this._cubes[x]):0,O[U]=this._cubes[U].volume>1?this._calculateVariance(this._cubes[U]):0):(O[x]=0,U--),x=0;for(var G=O[0],Z=1;Z<=U;++Z)O[Z]>G&&(G=O[Z],x=Z);if(G<=0){this._colors=U+1;break}}for(var X=[],W=[],J=[],re=[],te=0;te<this._colors;++te){var ye=P._volume(this._cubes[te],this._weights);ye>0?(X[te]=P._volume(this._cubes[te],this._momentsRed)/ye|0,W[te]=P._volume(this._cubes[te],this._momentsGreen)/ye|0,J[te]=P._volume(this._cubes[te],this._momentsBlue)/ye|0,re[te]=P._volume(this._cubes[te],this._momentsAlpha)/ye|0):(X[te]=0,W[te]=0,J[te]=0,re[te]=0)}this._reds=E(this._colors+1),this._greens=E(this._colors+1),this._blues=E(this._colors+1),this._alphas=E(this._colors+1),this._sums=E(this._colors+1);for(var Z=0,ue=this._pixels.length;Z<ue;Z++){for(var Se=this._pixels[Z],Le=-1,Pe=Le,Ee=Number.MAX_VALUE,Me=0;Me<this._colors;Me++){var He=X[Me],nt=W[Me],ht=J[Me],Fe=re[Me],Ce=this._distance.calculateRaw(He,nt,ht,Fe,Se.r,Se.g,Se.b,Se.a);Ce<Ee&&(Ee=Ce,Pe=Me)}this._reds[Pe]+=Se.r,this._greens[Pe]+=Se.g,this._blues[Pe]+=Se.b,this._alphas[Pe]+=Se.a,this._sums[Pe]++}},P.prototype._addColor=function(x){var O=8-this._significantBitsPerChannel,U=(x.r>>O)+1,G=(x.g>>O)+1,Z=(x.b>>O)+1,X=(x.a>>O)+1;this._weights[X][U][G][Z]++,this._momentsRed[X][U][G][Z]+=x.r,this._momentsGreen[X][U][G][Z]+=x.g,this._momentsBlue[X][U][G][Z]+=x.b,this._momentsAlpha[X][U][G][Z]+=x.a,this._moments[X][U][G][Z]+=this._table[x.r]+this._table[x.g]+this._table[x.b]+this._table[x.a]},P.prototype._calculateMoments=function(){for(var x=[],O=[],U=[],G=[],Z=[],X=[],W=y(this._sideSize,this._sideSize,this._sideSize),J=y(this._sideSize,this._sideSize,this._sideSize),re=y(this._sideSize,this._sideSize,this._sideSize),te=y(this._sideSize,this._sideSize,this._sideSize),ye=y(this._sideSize,this._sideSize,this._sideSize),ue=y(this._sideSize,this._sideSize,this._sideSize),Se=1;Se<=this._alphaMaxSideIndex;++Se){p(W,this._sideSize,this._sideSize,this._sideSize,0),p(J,this._sideSize,this._sideSize,this._sideSize,0),p(re,this._sideSize,this._sideSize,this._sideSize,0),p(te,this._sideSize,this._sideSize,this._sideSize,0),p(ye,this._sideSize,this._sideSize,this._sideSize,0),p(ue,this._sideSize,this._sideSize,this._sideSize,0);for(var Le=1;Le<=this._maxSideIndex;++Le){C(x,this._sideSize,0),C(O,this._sideSize,0),C(U,this._sideSize,0),C(G,this._sideSize,0),C(Z,this._sideSize,0),C(X,this._sideSize,0);for(var Pe=1;Pe<=this._maxSideIndex;++Pe)for(var Ee=0,Me=0,He=0,nt=0,ht=0,Fe=0,Ce=1;Ce<=this._maxSideIndex;++Ce)Ee+=this._weights[Se][Le][Pe][Ce],Me+=this._momentsRed[Se][Le][Pe][Ce],He+=this._momentsGreen[Se][Le][Pe][Ce],nt+=this._momentsBlue[Se][Le][Pe][Ce],ht+=this._momentsAlpha[Se][Le][Pe][Ce],Fe+=this._moments[Se][Le][Pe][Ce],x[Ce]+=Ee,O[Ce]+=Me,U[Ce]+=He,G[Ce]+=nt,Z[Ce]+=ht,X[Ce]+=Fe,W[Le][Pe][Ce]=W[Le-1][Pe][Ce]+x[Ce],J[Le][Pe][Ce]=J[Le-1][Pe][Ce]+O[Ce],re[Le][Pe][Ce]=re[Le-1][Pe][Ce]+U[Ce],te[Le][Pe][Ce]=te[Le-1][Pe][Ce]+G[Ce],ye[Le][Pe][Ce]=ye[Le-1][Pe][Ce]+Z[Ce],ue[Le][Pe][Ce]=ue[Le-1][Pe][Ce]+X[Ce],this._weights[Se][Le][Pe][Ce]=this._weights[Se-1][Le][Pe][Ce]+W[Le][Pe][Ce],this._momentsRed[Se][Le][Pe][Ce]=this._momentsRed[Se-1][Le][Pe][Ce]+J[Le][Pe][Ce],this._momentsGreen[Se][Le][Pe][Ce]=this._momentsGreen[Se-1][Le][Pe][Ce]+re[Le][Pe][Ce],this._momentsBlue[Se][Le][Pe][Ce]=this._momentsBlue[Se-1][Le][Pe][Ce]+te[Le][Pe][Ce],this._momentsAlpha[Se][Le][Pe][Ce]=this._momentsAlpha[Se-1][Le][Pe][Ce]+ye[Le][Pe][Ce],this._moments[Se][Le][Pe][Ce]=this._moments[Se-1][Le][Pe][Ce]+ue[Le][Pe][Ce]}}},P._volumeFloat=function(x,O){return O[x.alphaMaximum][x.redMaximum][x.greenMaximum][x.blueMaximum]-O[x.alphaMaximum][x.redMaximum][x.greenMinimum][x.blueMaximum]-O[x.alphaMaximum][x.redMinimum][x.greenMaximum][x.blueMaximum]+O[x.alphaMaximum][x.redMinimum][x.greenMinimum][x.blueMaximum]-O[x.alphaMinimum][x.redMaximum][x.greenMaximum][x.blueMaximum]+O[x.alphaMinimum][x.redMaximum][x.greenMinimum][x.blueMaximum]+O[x.alphaMinimum][x.redMinimum][x.greenMaximum][x.blueMaximum]-O[x.alphaMinimum][x.redMinimum][x.greenMinimum][x.blueMaximum]-(O[x.alphaMaximum][x.redMaximum][x.greenMaximum][x.blueMinimum]-O[x.alphaMinimum][x.redMaximum][x.greenMaximum][x.blueMinimum]-O[x.alphaMaximum][x.redMaximum][x.greenMinimum][x.blueMinimum]+O[x.alphaMinimum][x.redMaximum][x.greenMinimum][x.blueMinimum]-O[x.alphaMaximum][x.redMinimum][x.greenMaximum][x.blueMinimum]+O[x.alphaMinimum][x.redMinimum][x.greenMaximum][x.blueMinimum]+O[x.alphaMaximum][x.redMinimum][x.greenMinimum][x.blueMinimum]-O[x.alphaMinimum][x.redMinimum][x.greenMinimum][x.blueMinimum])},P._volume=function(x,O){return P._volumeFloat(x,O)|0},P._top=function(x,O,U,G){var Z;switch(O){case P.alpha:Z=G[U][x.redMaximum][x.greenMaximum][x.blueMaximum]-G[U][x.redMaximum][x.greenMinimum][x.blueMaximum]-G[U][x.redMinimum][x.greenMaximum][x.blueMaximum]+G[U][x.redMinimum][x.greenMinimum][x.blueMaximum]-(G[U][x.redMaximum][x.greenMaximum][x.blueMinimum]-G[U][x.redMaximum][x.greenMinimum][x.blueMinimum]-G[U][x.redMinimum][x.greenMaximum][x.blueMinimum]+G[U][x.redMinimum][x.greenMinimum][x.blueMinimum]);break;case P.red:Z=G[x.alphaMaximum][U][x.greenMaximum][x.blueMaximum]-G[x.alphaMaximum][U][x.greenMinimum][x.blueMaximum]-G[x.alphaMinimum][U][x.greenMaximum][x.blueMaximum]+G[x.alphaMinimum][U][x.greenMinimum][x.blueMaximum]-(G[x.alphaMaximum][U][x.greenMaximum][x.blueMinimum]-G[x.alphaMaximum][U][x.greenMinimum][x.blueMinimum]-G[x.alphaMinimum][U][x.greenMaximum][x.blueMinimum]+G[x.alphaMinimum][U][x.greenMinimum][x.blueMinimum]);break;case P.green:Z=G[x.alphaMaximum][x.redMaximum][U][x.blueMaximum]-G[x.alphaMaximum][x.redMinimum][U][x.blueMaximum]-G[x.alphaMinimum][x.redMaximum][U][x.blueMaximum]+G[x.alphaMinimum][x.redMinimum][U][x.blueMaximum]-(G[x.alphaMaximum][x.redMaximum][U][x.blueMinimum]-G[x.alphaMaximum][x.redMinimum][U][x.blueMinimum]-G[x.alphaMinimum][x.redMaximum][U][x.blueMinimum]+G[x.alphaMinimum][x.redMinimum][U][x.blueMinimum]);break;case P.blue:Z=G[x.alphaMaximum][x.redMaximum][x.greenMaximum][U]-G[x.alphaMaximum][x.redMaximum][x.greenMinimum][U]-G[x.alphaMaximum][x.redMinimum][x.greenMaximum][U]+G[x.alphaMaximum][x.redMinimum][x.greenMinimum][U]-(G[x.alphaMinimum][x.redMaximum][x.greenMaximum][U]-G[x.alphaMinimum][x.redMaximum][x.greenMinimum][U]-G[x.alphaMinimum][x.redMinimum][x.greenMaximum][U]+G[x.alphaMinimum][x.redMinimum][x.greenMinimum][U]);break;default:throw new Error("impossible")}return Z|0},P._bottom=function(x,O,U){switch(O){case P.alpha:return-U[x.alphaMinimum][x.redMaximum][x.greenMaximum][x.blueMaximum]+U[x.alphaMinimum][x.redMaximum][x.greenMinimum][x.blueMaximum]+U[x.alphaMinimum][x.redMinimum][x.greenMaximum][x.blueMaximum]-U[x.alphaMinimum][x.redMinimum][x.greenMinimum][x.blueMaximum]-(-U[x.alphaMinimum][x.redMaximum][x.greenMaximum][x.blueMinimum]+U[x.alphaMinimum][x.redMaximum][x.greenMinimum][x.blueMinimum]+U[x.alphaMinimum][x.redMinimum][x.greenMaximum][x.blueMinimum]-U[x.alphaMinimum][x.redMinimum][x.greenMinimum][x.blueMinimum]);case P.red:return-U[x.alphaMaximum][x.redMinimum][x.greenMaximum][x.blueMaximum]+U[x.alphaMaximum][x.redMinimum][x.greenMinimum][x.blueMaximum]+U[x.alphaMinimum][x.redMinimum][x.greenMaximum][x.blueMaximum]-U[x.alphaMinimum][x.redMinimum][x.greenMinimum][x.blueMaximum]-(-U[x.alphaMaximum][x.redMinimum][x.greenMaximum][x.blueMinimum]+U[x.alphaMaximum][x.redMinimum][x.greenMinimum][x.blueMinimum]+U[x.alphaMinimum][x.redMinimum][x.greenMaximum][x.blueMinimum]-U[x.alphaMinimum][x.redMinimum][x.greenMinimum][x.blueMinimum]);case P.green:return-U[x.alphaMaximum][x.redMaximum][x.greenMinimum][x.blueMaximum]+U[x.alphaMaximum][x.redMinimum][x.greenMinimum][x.blueMaximum]+U[x.alphaMinimum][x.redMaximum][x.greenMinimum][x.blueMaximum]-U[x.alphaMinimum][x.redMinimum][x.greenMinimum][x.blueMaximum]-(-U[x.alphaMaximum][x.redMaximum][x.greenMinimum][x.blueMinimum]+U[x.alphaMaximum][x.redMinimum][x.greenMinimum][x.blueMinimum]+U[x.alphaMinimum][x.redMaximum][x.greenMinimum][x.blueMinimum]-U[x.alphaMinimum][x.redMinimum][x.greenMinimum][x.blueMinimum]);case P.blue:return-U[x.alphaMaximum][x.redMaximum][x.greenMaximum][x.blueMinimum]+U[x.alphaMaximum][x.redMaximum][x.greenMinimum][x.blueMinimum]+U[x.alphaMaximum][x.redMinimum][x.greenMaximum][x.blueMinimum]-U[x.alphaMaximum][x.redMinimum][x.greenMinimum][x.blueMinimum]-(-U[x.alphaMinimum][x.redMaximum][x.greenMaximum][x.blueMinimum]+U[x.alphaMinimum][x.redMaximum][x.greenMinimum][x.blueMinimum]+U[x.alphaMinimum][x.redMinimum][x.greenMaximum][x.blueMinimum]-U[x.alphaMinimum][x.redMinimum][x.greenMinimum][x.blueMinimum]);default:return 0}},P.prototype._calculateVariance=function(x){var O=P._volume(x,this._momentsRed),U=P._volume(x,this._momentsGreen),G=P._volume(x,this._momentsBlue),Z=P._volume(x,this._momentsAlpha),X=P._volumeFloat(x,this._moments),W=P._volume(x,this._weights),J=O*O+U*U+G*G+Z*Z;return X-J/W},P.prototype._maximize=function(x,O,U,G,Z,X,W,J,re){for(var te=P._bottom(x,O,this._momentsRed)|0,ye=P._bottom(x,O,this._momentsGreen)|0,ue=P._bottom(x,O,this._momentsBlue)|0,Se=P._bottom(x,O,this._momentsAlpha)|0,Le=P._bottom(x,O,this._weights)|0,Pe=0,Ee=-1,Me=U;Me<G;++Me){var He=te+P._top(x,O,Me,this._momentsRed),nt=ye+P._top(x,O,Me,this._momentsGreen),ht=ue+P._top(x,O,Me,this._momentsBlue),Fe=Se+P._top(x,O,Me,this._momentsAlpha),Ce=Le+P._top(x,O,Me,this._weights);if(Ce!=0){var Be=He*He+nt*nt+ht*ht+Fe*Fe,Ae=Be/Ce;He=Z-He,nt=X-nt,ht=W-ht,Fe=J-Fe,Ce=re-Ce,Ce!=0&&(Be=He*He+nt*nt+ht*ht+Fe*Fe,Ae+=Be/Ce,Ae>Pe&&(Pe=Ae,Ee=Me))}}return{max:Pe,position:Ee}},P.prototype._cut=function(x,O){var U,G=P._volume(x,this._momentsRed),Z=P._volume(x,this._momentsGreen),X=P._volume(x,this._momentsBlue),W=P._volume(x,this._momentsAlpha),J=P._volume(x,this._weights),re=this._maximize(x,P.red,x.redMinimum+1,x.redMaximum,G,Z,X,W,J),te=this._maximize(x,P.green,x.greenMinimum+1,x.greenMaximum,G,Z,X,W,J),ye=this._maximize(x,P.blue,x.blueMinimum+1,x.blueMaximum,G,Z,X,W,J),ue=this._maximize(x,P.alpha,x.alphaMinimum+1,x.alphaMaximum,G,Z,X,W,J);if(ue.max>=re.max&&ue.max>=te.max&&ue.max>=ye.max){if(U=P.alpha,ue.position<0)return!1}else re.max>=ue.max&&re.max>=te.max&&re.max>=ye.max?U=P.red:te.max>=ue.max&&te.max>=re.max&&te.max>=ye.max?U=P.green:U=P.blue;switch(O.redMaximum=x.redMaximum,O.greenMaximum=x.greenMaximum,O.blueMaximum=x.blueMaximum,O.alphaMaximum=x.alphaMaximum,U){case P.red:O.redMinimum=x.redMaximum=re.position,O.greenMinimum=x.greenMinimum,O.blueMinimum=x.blueMinimum,O.alphaMinimum=x.alphaMinimum;break;case P.green:O.greenMinimum=x.greenMaximum=te.position,O.redMinimum=x.redMinimum,O.blueMinimum=x.blueMinimum,O.alphaMinimum=x.alphaMinimum;break;case P.blue:O.blueMinimum=x.blueMaximum=ye.position,O.redMinimum=x.redMinimum,O.greenMinimum=x.greenMinimum,O.alphaMinimum=x.alphaMinimum;break;case P.alpha:O.alphaMinimum=x.alphaMaximum=ue.position,O.blueMinimum=x.blueMinimum,O.redMinimum=x.redMinimum,O.greenMinimum=x.greenMinimum;break}return x.volume=(x.redMaximum-x.redMinimum)*(x.greenMaximum-x.greenMinimum)*(x.blueMaximum-x.blueMinimum)*(x.alphaMaximum-x.alphaMinimum),O.volume=(O.redMaximum-O.redMinimum)*(O.greenMaximum-O.greenMinimum)*(O.blueMaximum-O.blueMinimum)*(O.alphaMaximum-O.alphaMinimum),!0},P.prototype._initialize=function(x){this._colors=x,this._cubes=[];for(var O=0;O<x;O++)this._cubes[O]=new z;this._cubes[0].redMinimum=0,this._cubes[0].greenMinimum=0,this._cubes[0].blueMinimum=0,this._cubes[0].alphaMinimum=0,this._cubes[0].redMaximum=this._maxSideIndex,this._cubes[0].greenMaximum=this._maxSideIndex,this._cubes[0].blueMaximum=this._maxSideIndex,this._cubes[0].alphaMaximum=this._alphaMaxSideIndex,this._weights=m(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsRed=m(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsGreen=m(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsBlue=m(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsAlpha=m(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._moments=m(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._table=[];for(var U=0;U<256;++U)this._table[U]=U*U;this._pixels=[]},P.prototype._setQuality=function(x){x===void 0&&(x=5),this._significantBitsPerChannel=x,this._maxSideIndex=1<<this._significantBitsPerChannel,this._alphaMaxSideIndex=this._maxSideIndex,this._sideSize=this._maxSideIndex+1,this._alphaSideSize=this._alphaMaxSideIndex+1},P.alpha=3,P.red=2,P.green=1,P.blue=0,P}();t.WuQuant=A},function(T,t,S){var D=S(31);t.NearestColor=D.NearestColor;var w=S(32);t.ErrorDiffusionArray=w.ErrorDiffusionArray,t.ErrorDiffusionArrayKernel=w.ErrorDiffusionArrayKernel;var E=S(33);t.ErrorDiffusionRiemersma=E.ErrorDiffusionRiemersma},function(T,t){var S=function(){function D(w){this._distance=w}return D.prototype.quantize=function(w,E){for(var m=w.getPointArray(),y=w.getWidth(),p=w.getHeight(),C=0;C<p;C++)for(var z=0,A=C*y;z<y;z++,A++){var P=m[A];P.from(E.getNearestColor(this._distance,P))}return w},D}();t.NearestColor=S},function(T,t,S){var D=S(24),w=S(6);(function(y){y[y.FloydSteinberg=0]="FloydSteinberg",y[y.FalseFloydSteinberg=1]="FalseFloydSteinberg",y[y.Stucki=2]="Stucki",y[y.Atkinson=3]="Atkinson",y[y.Jarvis=4]="Jarvis",y[y.Burkes=5]="Burkes",y[y.Sierra=6]="Sierra",y[y.TwoSierra=7]="TwoSierra",y[y.SierraLite=8]="SierraLite"})(t.ErrorDiffusionArrayKernel||(t.ErrorDiffusionArrayKernel={}));var E=t.ErrorDiffusionArrayKernel,m=function(){function y(p,C,z,A,P){z===void 0&&(z=!0),A===void 0&&(A=0),P===void 0&&(P=!1),this._setKernel(C),this._distance=p,this._minColorDistance=A,this._serpentine=z,this._calculateErrorLikeGIMP=P}return y.prototype.quantize=function(p,C){for(var z=p.getPointArray(),A=new D.Point,P=p.getWidth(),x=p.getHeight(),O=[],U=1,G=1,Z=0;Z<this._kernel.length;Z++){var X=this._kernel[Z][2]+1;G<X&&(G=X)}for(var Z=0;Z<G;Z++)this._fillErrorLine(O[Z]=[],P);for(var W=0;W<x;W++){this._serpentine&&(U=U*-1);var J=W*P,re=U==1?0:P-1,te=U==1?P:-1;this._fillErrorLine(O[0],P),O.push(O.shift());for(var ye=O[0],ue=re,Se=J+re;ue!==te;ue+=U,Se+=U){var Le=z[Se],Pe=ye[ue];A.from(Le);var Ee=D.Point.createByRGBA(w.inRange0to255Rounded(Le.r+Pe[0]),w.inRange0to255Rounded(Le.g+Pe[1]),w.inRange0to255Rounded(Le.b+Pe[2]),w.inRange0to255Rounded(Le.a+Pe[3])),Me=C.getNearestColor(this._distance,Ee);if(Le.from(Me),this._minColorDistance){var He=this._distance.calculateNormalized(Le,Me);if(He<this._minColorDistance)continue}var nt=void 0,ht=void 0,Fe=void 0,Ce=void 0;this._calculateErrorLikeGIMP?(nt=Ee.r-Me.r,ht=Ee.g-Me.g,Fe=Ee.b-Me.b,Ce=Ee.a-Me.a):(nt=A.r-Me.r,ht=A.g-Me.g,Fe=A.b-Me.b,Ce=A.a-Me.a);for(var Be=U==1?0:this._kernel.length-1,Ae=U==1?this._kernel.length:-1,Z=Be;Z!==Ae;Z+=U){var se=this._kernel[Z][1]*U,pe=this._kernel[Z][2];if(se+ue>=0&&se+ue<P&&pe+W>=0&&pe+W<x){var Ke=this._kernel[Z][0],_e=O[pe][se+ue];_e[0]=_e[0]+nt*Ke,_e[1]=_e[1]+ht*Ke,_e[2]=_e[2]+Fe*Ke,_e[3]=_e[3]+Ce*Ke}}}}return p},y.prototype._fillErrorLine=function(p,C){p.length>C&&(p.length=C);for(var z=p.length,A=0;A<z;A++){var P=p[A];P[0]=P[1]=P[2]=P[3]=0}for(var A=z;A<C;A++)p[A]=[0,0,0,0]},y.prototype._setKernel=function(p){switch(p){case E.FloydSteinberg:this._kernel=[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]];break;case E.FalseFloydSteinberg:this._kernel=[[3/8,1,0],[3/8,0,1],[2/8,1,1]];break;case E.Stucki:this._kernel=[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]];break;case E.Atkinson:this._kernel=[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]];break;case E.Jarvis:this._kernel=[[7/48,1,0],[5/48,2,0],[3/48,-2,1],[5/48,-1,1],[7/48,0,1],[5/48,1,1],[3/48,2,1],[1/48,-2,2],[3/48,-1,2],[5/48,0,2],[3/48,1,2],[1/48,2,2]];break;case E.Burkes:this._kernel=[[8/32,1,0],[4/32,2,0],[2/32,-2,1],[4/32,-1,1],[8/32,0,1],[4/32,1,1],[2/32,2,1]];break;case E.Sierra:this._kernel=[[5/32,1,0],[3/32,2,0],[2/32,-2,1],[4/32,-1,1],[5/32,0,1],[4/32,1,1],[2/32,2,1],[2/32,-1,2],[3/32,0,2],[2/32,1,2]];break;case E.TwoSierra:this._kernel=[[4/16,1,0],[3/16,2,0],[1/16,-2,1],[2/16,-1,1],[3/16,0,1],[2/16,1,1],[1/16,2,1]];break;case E.SierraLite:this._kernel=[[2/4,1,0],[1/4,-1,1],[1/4,0,1]];break;default:throw new Error("ErrorDiffusionArray: unknown kernel = "+p)}},y}();t.ErrorDiffusionArray=m},function(T,t,S){var D=S(34),w=S(24),E=S(6),m=function(){function y(p,C,z){C===void 0&&(C=16),z===void 0&&(z=1),this._distance=p,this._errorPropagation=z,this._errorQueueSize=C,this._max=this._errorQueueSize,this._createWeights()}return y.prototype.quantize=function(p,C){for(var z=this,A=new D.HilbertCurveBase,P=p.getPointArray(),x=p.getWidth(),O=p.getHeight(),U=[],G=0,Z=0;Z<this._errorQueueSize;Z++)U[Z]={r:0,g:0,b:0,a:0};return A.walk(x,O,function(X,W){for(var J=P[X+W*x],re=J.r,te=J.g,ye=J.b,ue=J.a,Se=0;Se<z._errorQueueSize;Se++){var Le=z._weights[Se],Pe=U[(Se+G)%z._errorQueueSize];re+=Pe.r*Le,te+=Pe.g*Le,ye+=Pe.b*Le,ue+=Pe.a*Le}var Ee=w.Point.createByRGBA(E.inRange0to255Rounded(re),E.inRange0to255Rounded(te),E.inRange0to255Rounded(ye),E.inRange0to255Rounded(ue)),Me=C.getNearestColor(z._distance,Ee);G=(G+1)%z._errorQueueSize;var He=(G+z._errorQueueSize-1)%z._errorQueueSize;U[He].r=J.r-Me.r,U[He].g=J.g-Me.g,U[He].b=J.b-Me.b,U[He].a=J.a-Me.a,J.from(Me)}),p},y.prototype._createWeights=function(){this._weights=[];for(var p=Math.exp(Math.log(this._max)/(this._errorQueueSize-1)),C=0,z=1;C<this._errorQueueSize;C++)this._weights[C]=(z+.5|0)/this._max*this._errorPropagation,z*=p},y}();t.ErrorDiffusionRiemersma=m},function(T,t){var S;(function(w){w[w.NONE=0]="NONE",w[w.UP=1]="UP",w[w.LEFT=2]="LEFT",w[w.RIGHT=3]="RIGHT",w[w.DOWN=4]="DOWN"})(S||(S={}));var D=function(){function w(){}return w.prototype.walk=function(E,m,y){this._x=0,this._y=0,this._d=0,this._width=E,this._height=m,this._callback=y;var p=Math.max(E,m);this._level=Math.log(p)/Math.log(2)+1|0,this._walkHilbert(S.UP),this._visit(S.NONE)},w.prototype._walkHilbert=function(E){if(!(this._level<1)){switch(this._level--,E){case S.LEFT:this._walkHilbert(S.UP),this._visit(S.RIGHT),this._walkHilbert(S.LEFT),this._visit(S.DOWN),this._walkHilbert(S.LEFT),this._visit(S.LEFT),this._walkHilbert(S.DOWN);break;case S.RIGHT:this._walkHilbert(S.DOWN),this._visit(S.LEFT),this._walkHilbert(S.RIGHT),this._visit(S.UP),this._walkHilbert(S.RIGHT),this._visit(S.RIGHT),this._walkHilbert(S.UP);break;case S.UP:this._walkHilbert(S.LEFT),this._visit(S.DOWN),this._walkHilbert(S.UP),this._visit(S.RIGHT),this._walkHilbert(S.UP),this._visit(S.UP),this._walkHilbert(S.RIGHT);break;case S.DOWN:this._walkHilbert(S.RIGHT),this._visit(S.UP),this._walkHilbert(S.DOWN),this._visit(S.LEFT),this._walkHilbert(S.DOWN),this._visit(S.DOWN),this._walkHilbert(S.LEFT);break}this._level++}},w.prototype._visit=function(E){switch(this._x>=0&&this._x<this._width&&this._y>=0&&this._y<this._height&&(this._callback(this._x,this._y,this._d),this._d++),E){case S.LEFT:this._x--;break;case S.RIGHT:this._x++;break;case S.UP:this._y--;break;case S.DOWN:this._y++;break}},w}();t.HilbertCurveBase=D},function(T,t,S){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * iq.ts - Image Quantization Library
 */var D=S(36);t.SSIM=D.SSIM},function(T,t,S){var D=S(2),w=.01,E=.03,m=function(){function y(){}return y.prototype.compare=function(p,C){if(p.getHeight()!==C.getHeight()||p.getWidth()!==C.getWidth())throw new Error("Images have different sizes!");var z=8,A=(1<<z)-1,P=Math.pow(w*A,2),x=Math.pow(E*A,2),O=0,U=0;return this._iterate(p,C,function(G,Z,X,W){for(var J=0,re=0,te=0,ye=0;ye<G.length;ye++)re+=Math.pow(G[ye]-X,2),te+=Math.pow(Z[ye]-W,2),J+=(G[ye]-X)*(Z[ye]-W);var ue=G.length-1;re/=ue,te/=ue,J/=ue;var Se=(2*X*W+P)*(2*J+x),Le=(Math.pow(X,2)+Math.pow(W,2)+P)*(re+te+x),Pe=Se/Le;U+=Pe,O++}),U/O},y.prototype._iterate=function(p,C,z){for(var A=8,P=p.getWidth(),x=p.getHeight(),O=0;O<x;O+=A)for(var U=0;U<P;U+=A){var G=Math.min(A,P-U),Z=Math.min(A,x-O),X=this._calculateLumaValuesForWindow(p,U,O,G,Z),W=this._calculateLumaValuesForWindow(C,U,O,G,Z),J=this._calculateAverageLuma(X),re=this._calculateAverageLuma(W);z(X,W,J,re)}},y.prototype._calculateLumaValuesForWindow=function(p,C,z,A,P){for(var x=p.getPointArray(),O=[],U=0,G=z;G<z+P;G++)for(var Z=G*p.getWidth(),X=C;X<C+A;X++){var W=x[Z+X];O[U]=W.r*D.Y.RED+W.g*D.Y.GREEN+W.b*D.Y.BLUE,U++}return O},y.prototype._calculateAverageLuma=function(p){for(var C=0,z=0;z<p.length;z++)C+=p[z];return C/p.length},y}();t.SSIM=m},function(T,t,S){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * iq.ts - Image Quantization Library
 */var D=S(6);t.arithmetic=D;var w=S(28);t.HueStatistics=w.HueStatistics;var E=S(22);t.Palette=E.Palette;var m=S(24);t.Point=m.Point;var y=S(23);t.PointContainer=y.PointContainer}])})},{}],75:[function(_,k,b){typeof Object.create=="function"?k.exports=function(t,S){S&&(t.super_=S,t.prototype=Object.create(S.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:k.exports=function(t,S){if(S){t.super_=S;var D=function(){};D.prototype=S.prototype,t.prototype=new D,t.prototype.constructor=t}}},{}],76:[function(_,k,b){/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */k.exports=function(S){return S!=null&&(T(S)||t(S)||!!S._isBuffer)};function T(S){return!!S.constructor&&typeof S.constructor.isBuffer=="function"&&S.constructor.isBuffer(S)}function t(S){return typeof S.readFloatLE=="function"&&typeof S.slice=="function"&&T(S.slice(0,0))}},{}],77:[function(_,k,b){var T=Function.prototype.toString,t=/^\s*class\b/,S=function(C){try{var z=T.call(C);return t.test(z)}catch{return!1}},D=function(C){try{return S(C)?!1:(T.call(C),!0)}catch{return!1}},w=Object.prototype.toString,E="[object Function]",m="[object GeneratorFunction]",y=typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol";k.exports=function(C){if(!C||typeof C!="function"&&typeof C!="object")return!1;if(typeof C=="function"&&!C.prototype)return!0;if(y)return D(C);if(S(C))return!1;var z=w.call(C);return z===E||z===m}},{}],78:[function(_,k,b){k.exports=t;var T=Object.prototype.toString;function t(S){var D=T.call(S);return D==="[object Function]"||typeof S=="function"&&D!=="[object RegExp]"||typeof v<"u"&&(S===v.setTimeout||S===v.alert||S===v.confirm||S===v.prompt)}},{}],79:[function(_,k,b){var T={}.toString;k.exports=Array.isArray||function(t){return T.call(t)=="[object Array]"}},{}],80:[function(_,k,b){var T=_("./lib/encoder"),t=_("./lib/decoder");k.exports={encode:T,decode:t}},{"./lib/decoder":81,"./lib/encoder":82}],81:[function(_,k,b){(function(T){var t=function(){var w=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),E=4017,m=799,y=3406,p=2276,C=1567,z=3784,A=5793,P=2896;function x(){}function O(re,te){for(var ye=0,ue=[],Se,Le,Pe=16;Pe>0&&!re[Pe-1];)Pe--;ue.push({children:[],index:0});var Ee=ue[0],Me;for(Se=0;Se<Pe;Se++){for(Le=0;Le<re[Se];Le++){for(Ee=ue.pop(),Ee.children[Ee.index]=te[ye];Ee.index>0;){if(ue.length===0)throw new Error("Could not recreate Huffman Table");Ee=ue.pop()}for(Ee.index++,ue.push(Ee);ue.length<=Se;)ue.push(Me={children:[],index:0}),Ee.children[Ee.index]=Me.children,Ee=Me;ye++}Se+1<Pe&&(ue.push(Me={children:[],index:0}),Ee.children[Ee.index]=Me.children,Ee=Me)}return ue[0].children}function U(re,te,ye,ue,Se,Le,Pe,Ee,Me,He){ye.precision,ye.samplesPerLine,ye.scanLines;var nt=ye.mcusPerLine,ht=ye.progressive;ye.maxH,ye.maxV;var Fe=te,Ce=0,Be=0;function Ae(){if(Be>0)return Be--,Ce>>Be&1;if(Ce=re[te++],Ce==255){var Tr=re[te++];if(Tr)throw new Error("unexpected marker: "+(Ce<<8|Tr).toString(16))}return Be=7,Ce>>>7}function se(Tr){for(var br=Tr,fr;(fr=Ae())!==null;){if(br=br[fr],typeof br=="number")return br;if(typeof br!="object")throw new Error("invalid huffman sequence")}return null}function pe(Tr){for(var br=0;Tr>0;){var fr=Ae();if(fr===null)return;br=br<<1|fr,Tr--}return br}function Ke(Tr){var br=pe(Tr);return br>=1<<Tr-1?br:br+(-1<<Tr)+1}function _e(Tr,br){var fr=se(Tr.huffmanTableDC),Vr=fr===0?0:Ke(fr);br[0]=Tr.pred+=Vr;for(var Ir=1;Ir<64;){var De=se(Tr.huffmanTableAC),St=De&15,Ut=De>>4;if(St===0){if(Ut<15)break;Ir+=16;continue}Ir+=Ut;var ir=w[Ir];br[ir]=Ke(St),Ir++}}function ke(Tr,br){var fr=se(Tr.huffmanTableDC),Vr=fr===0?0:Ke(fr)<<Me;br[0]=Tr.pred+=Vr}function qe(Tr,br){br[0]|=Ae()<<Me}var tt=0;function Ge(Tr,br){if(tt>0){tt--;return}for(var fr=Le,Vr=Pe;fr<=Vr;){var Ir=se(Tr.huffmanTableAC),De=Ir&15,St=Ir>>4;if(De===0){if(St<15){tt=pe(St)+(1<<St)-1;break}fr+=16;continue}fr+=St;var Ut=w[fr];br[Ut]=Ke(De)*(1<<Me),fr++}}var We=0,Je;function it(Tr,br){for(var fr=Le,Vr=Pe,Ir=0;fr<=Vr;){var De=w[fr],St=br[De]<0?-1:1;switch(We){case 0:var Ut=se(Tr.huffmanTableAC),ir=Ut&15,Ir=Ut>>4;if(ir===0)Ir<15?(tt=pe(Ir)+(1<<Ir),We=4):(Ir=16,We=1);else{if(ir!==1)throw new Error("invalid ACn encoding");Je=Ke(ir),We=Ir?2:3}continue;case 1:case 2:br[De]?br[De]+=(Ae()<<Me)*St:(Ir--,Ir===0&&(We=We==2?3:0));break;case 3:br[De]?br[De]+=(Ae()<<Me)*St:(br[De]=Je<<Me,We=0);break;case 4:br[De]&&(br[De]+=(Ae()<<Me)*St);break}fr++}We===4&&(tt--,tt===0&&(We=0))}function ze(Tr,br,fr,Vr,Ir){var De=fr/nt|0,St=fr%nt,Ut=De*Tr.v+Vr,ir=St*Tr.h+Ir;Tr.blocks[Ut]===void 0&&He.tolerantDecoding||br(Tr,Tr.blocks[Ut][ir])}function de(Tr,br,fr){var Vr=fr/Tr.blocksPerLine|0,Ir=fr%Tr.blocksPerLine;Tr.blocks[Vr]===void 0&&He.tolerantDecoding||br(Tr,Tr.blocks[Vr][Ir])}var ve=ue.length,be,Oe,ge,le,et,wt;ht?Le===0?wt=Ee===0?ke:qe:wt=Ee===0?Ge:it:wt=_e;var Ft=0,Wt,or;ve==1?or=ue[0].blocksPerLine*ue[0].blocksPerColumn:or=nt*ye.mcusPerColumn,Se||(Se=or);for(var Or,xr;Ft<or;){for(Oe=0;Oe<ve;Oe++)ue[Oe].pred=0;if(tt=0,ve==1)for(be=ue[0],et=0;et<Se;et++)de(be,wt,Ft),Ft++;else for(et=0;et<Se;et++){for(Oe=0;Oe<ve;Oe++)for(be=ue[Oe],Or=be.h,xr=be.v,ge=0;ge<xr;ge++)for(le=0;le<Or;le++)ze(be,wt,Ft,ge,le);if(Ft++,Ft===or)break}if(Ft===or)do{if(re[te]===255&&re[te+1]!==0)break;te+=1}while(te<re.length-2);if(Be=0,Wt=re[te]<<8|re[te+1],Wt<65280)throw new Error("marker was not found");if(Wt>=65488&&Wt<=65495)te+=2;else break}return te-Fe}function G(re,te){var ye=[],ue=te.blocksPerLine,Se=te.blocksPerColumn,Le=ue<<3,Pe=new Int32Array(64),Ee=new Uint8Array(64);function Me(pe,Ke,_e){var ke=te.quantizationTable,qe,tt,Ge,We,Je,it,ze,de,ve,be=_e,Oe;for(Oe=0;Oe<64;Oe++)be[Oe]=pe[Oe]*ke[Oe];for(Oe=0;Oe<8;++Oe){var ge=8*Oe;if(be[1+ge]==0&&be[2+ge]==0&&be[3+ge]==0&&be[4+ge]==0&&be[5+ge]==0&&be[6+ge]==0&&be[7+ge]==0){ve=A*be[0+ge]+512>>10,be[0+ge]=ve,be[1+ge]=ve,be[2+ge]=ve,be[3+ge]=ve,be[4+ge]=ve,be[5+ge]=ve,be[6+ge]=ve,be[7+ge]=ve;continue}qe=A*be[0+ge]+128>>8,tt=A*be[4+ge]+128>>8,Ge=be[2+ge],We=be[6+ge],Je=P*(be[1+ge]-be[7+ge])+128>>8,de=P*(be[1+ge]+be[7+ge])+128>>8,it=be[3+ge]<<4,ze=be[5+ge]<<4,ve=qe-tt+1>>1,qe=qe+tt+1>>1,tt=ve,ve=Ge*z+We*C+128>>8,Ge=Ge*C-We*z+128>>8,We=ve,ve=Je-ze+1>>1,Je=Je+ze+1>>1,ze=ve,ve=de+it+1>>1,it=de-it+1>>1,de=ve,ve=qe-We+1>>1,qe=qe+We+1>>1,We=ve,ve=tt-Ge+1>>1,tt=tt+Ge+1>>1,Ge=ve,ve=Je*p+de*y+2048>>12,Je=Je*y-de*p+2048>>12,de=ve,ve=it*m+ze*E+2048>>12,it=it*E-ze*m+2048>>12,ze=ve,be[0+ge]=qe+de,be[7+ge]=qe-de,be[1+ge]=tt+ze,be[6+ge]=tt-ze,be[2+ge]=Ge+it,be[5+ge]=Ge-it,be[3+ge]=We+Je,be[4+ge]=We-Je}for(Oe=0;Oe<8;++Oe){var le=Oe;if(be[8+le]==0&&be[16+le]==0&&be[24+le]==0&&be[32+le]==0&&be[40+le]==0&&be[48+le]==0&&be[56+le]==0){ve=A*_e[Oe+0]+8192>>14,be[0+le]=ve,be[8+le]=ve,be[16+le]=ve,be[24+le]=ve,be[32+le]=ve,be[40+le]=ve,be[48+le]=ve,be[56+le]=ve;continue}qe=A*be[0+le]+2048>>12,tt=A*be[32+le]+2048>>12,Ge=be[16+le],We=be[48+le],Je=P*(be[8+le]-be[56+le])+2048>>12,de=P*(be[8+le]+be[56+le])+2048>>12,it=be[24+le],ze=be[40+le],ve=qe-tt+1>>1,qe=qe+tt+1>>1,tt=ve,ve=Ge*z+We*C+2048>>12,Ge=Ge*C-We*z+2048>>12,We=ve,ve=Je-ze+1>>1,Je=Je+ze+1>>1,ze=ve,ve=de+it+1>>1,it=de-it+1>>1,de=ve,ve=qe-We+1>>1,qe=qe+We+1>>1,We=ve,ve=tt-Ge+1>>1,tt=tt+Ge+1>>1,Ge=ve,ve=Je*p+de*y+2048>>12,Je=Je*y-de*p+2048>>12,de=ve,ve=it*m+ze*E+2048>>12,it=it*E-ze*m+2048>>12,ze=ve,be[0+le]=qe+de,be[56+le]=qe-de,be[8+le]=tt+ze,be[48+le]=tt-ze,be[16+le]=Ge+it,be[40+le]=Ge-it,be[24+le]=We+Je,be[32+le]=We-Je}for(Oe=0;Oe<64;++Oe){var et=128+(be[Oe]+8>>4);Ke[Oe]=et<0?0:et>255?255:et}}J(Le*Se*8);for(var He,nt,ht=0;ht<Se;ht++){var Fe=ht<<3;for(He=0;He<8;He++)ye.push(new Uint8Array(Le));for(var Ce=0;Ce<ue;Ce++){Me(te.blocks[ht][Ce],Ee,Pe);var Be=0,Ae=Ce<<3;for(nt=0;nt<8;nt++){var se=ye[Fe+nt];for(He=0;He<8;He++)se[Ae+He]=Ee[Be++]}}}return ye}function Z(re){return re<0?0:re>255?255:re}x.prototype={load:function(te){var ye=new XMLHttpRequest;ye.open("GET",te,!0),ye.responseType="arraybuffer",ye.onload=function(){var ue=new Uint8Array(ye.response||ye.mozResponseArrayBuffer);this.parse(ue),this.onload&&this.onload()}.bind(this),ye.send(null)},parse:function(te){var ye=this.opts.maxResolutionInMP*1e3*1e3,ue=0;te.length;function Se(){var Ir=te[ue]<<8|te[ue+1];return ue+=2,Ir}function Le(){var Ir=Se(),De=te.subarray(ue,ue+Ir-2);return ue+=De.length,De}function Pe(Ir){var De=0,St=0,Ut,ir;for(ir in Ir.components)Ir.components.hasOwnProperty(ir)&&(Ut=Ir.components[ir],De<Ut.h&&(De=Ut.h),St<Ut.v&&(St=Ut.v));var Rt=Math.ceil(Ir.samplesPerLine/8/De),$t=Math.ceil(Ir.scanLines/8/St);for(ir in Ir.components)if(Ir.components.hasOwnProperty(ir)){Ut=Ir.components[ir];var rt=Math.ceil(Math.ceil(Ir.samplesPerLine/8)*Ut.h/De),sr=Math.ceil(Math.ceil(Ir.scanLines/8)*Ut.v/St),Fr=Rt*Ut.h,ee=$t*Ut.v,Qe=ee*Fr,ie=[];J(Qe*256);for(var B=0;B<ee;B++){for(var Q=[],xe=0;xe<Fr;xe++)Q.push(new Int32Array(64));ie.push(Q)}Ut.blocksPerLine=rt,Ut.blocksPerColumn=sr,Ut.blocks=ie}Ir.maxH=De,Ir.maxV=St,Ir.mcusPerLine=Rt,Ir.mcusPerColumn=$t}var Ee=null,Me=null,He,nt,ht=[],Fe=[],Ce=[],Be=[],Ae=Se();if(Ae!=65496)throw new Error("SOI not found");for(Ae=Se();Ae!=65497;){var se,pe;switch(Ae){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var Ke=Le();Ae===65504&&Ke[0]===74&&Ke[1]===70&&Ke[2]===73&&Ke[3]===70&&Ke[4]===0&&(Ee={version:{major:Ke[5],minor:Ke[6]},densityUnits:Ke[7],xDensity:Ke[8]<<8|Ke[9],yDensity:Ke[10]<<8|Ke[11],thumbWidth:Ke[12],thumbHeight:Ke[13],thumbData:Ke.subarray(14,14+3*Ke[12]*Ke[13])}),Ae===65505&&Ke[0]===69&&Ke[1]===120&&Ke[2]===105&&Ke[3]===102&&Ke[4]===0&&(this.exifBuffer=Ke.subarray(5,Ke.length)),Ae===65518&&Ke[0]===65&&Ke[1]===100&&Ke[2]===111&&Ke[3]===98&&Ke[4]===101&&Ke[5]===0&&(Me={version:Ke[6],flags0:Ke[7]<<8|Ke[8],flags1:Ke[9]<<8|Ke[10],transformCode:Ke[11]});break;case 65499:for(var _e=Se(),ke=_e+ue-2;ue<ke;){var qe=te[ue++];J(256);var tt=new Int32Array(64);if(qe>>4)if(qe>>4===1)for(pe=0;pe<64;pe++){var Ge=w[pe];tt[Ge]=Se()}else throw new Error("DQT: invalid table spec");else for(pe=0;pe<64;pe++){var Ge=w[pe];tt[Ge]=te[ue++]}ht[qe&15]=tt}break;case 65472:case 65473:case 65474:Se(),He={},He.extended=Ae===65473,He.progressive=Ae===65474,He.precision=te[ue++],He.scanLines=Se(),He.samplesPerLine=Se(),He.components={},He.componentsOrder=[];var We=He.scanLines*He.samplesPerLine;if(We>ye){var Je=Math.ceil((We-ye)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${Je}MP`)}var it=te[ue++],ze;for(se=0;se<it;se++){ze=te[ue];var de=te[ue+1]>>4,ve=te[ue+1]&15,be=te[ue+2];He.componentsOrder.push(ze),He.components[ze]={h:de,v:ve,quantizationIdx:be},ue+=3}Pe(He),Fe.push(He);break;case 65476:var Oe=Se();for(se=2;se<Oe;){var ge=te[ue++],le=new Uint8Array(16),et=0;for(pe=0;pe<16;pe++,ue++)et+=le[pe]=te[ue];J(16+et);var wt=new Uint8Array(et);for(pe=0;pe<et;pe++,ue++)wt[pe]=te[ue];se+=17+et,(ge>>4?Ce:Be)[ge&15]=O(le,wt)}break;case 65501:Se(),nt=Se();break;case 65498:Se();var Ft=te[ue++],Wt=[],or;for(se=0;se<Ft;se++){or=He.components[te[ue++]];var Or=te[ue++];or.huffmanTableDC=Be[Or>>4],or.huffmanTableAC=Ce[Or&15],Wt.push(or)}var xr=te[ue++],Tr=te[ue++],br=te[ue++],fr=U(te,ue,He,Wt,nt,xr,Tr,br>>4,br&15,this.opts);ue+=fr;break;case 65535:te[ue]!==255&&ue--;break;default:if(te[ue-3]==255&&te[ue-2]>=192&&te[ue-2]<=254){ue-=3;break}throw new Error("unknown JPEG marker "+Ae.toString(16))}Ae=Se()}if(Fe.length!=1)throw new Error("only single frame JPEGs supported");for(var se=0;se<Fe.length;se++){var Vr=Fe[se].components;for(var pe in Vr)Vr[pe].quantizationTable=ht[Vr[pe].quantizationIdx],delete Vr[pe].quantizationIdx}this.width=He.samplesPerLine,this.height=He.scanLines,this.jfif=Ee,this.adobe=Me,this.components=[];for(var se=0;se<He.componentsOrder.length;se++){var or=He.components[He.componentsOrder[se]];this.components.push({lines:G(He,or),scaleX:or.h/He.maxH,scaleY:or.v/He.maxV})}},getData:function(te,ye){var ue=this.width/te,Se=this.height/ye,Le,Pe,Ee,Me,He,nt,ht,Fe,Ce,Be,Ae=0,se,pe,Ke,_e,ke,qe,tt,Ge,We,Je,it,ze=te*ye*this.components.length;J(ze);var de=new Uint8Array(ze);switch(this.components.length){case 1:for(Le=this.components[0],Be=0;Be<ye;Be++)for(He=Le.lines[0|Be*Le.scaleY*Se],Ce=0;Ce<te;Ce++)se=He[0|Ce*Le.scaleX*ue],de[Ae++]=se;break;case 2:for(Le=this.components[0],Pe=this.components[1],Be=0;Be<ye;Be++)for(He=Le.lines[0|Be*Le.scaleY*Se],nt=Pe.lines[0|Be*Pe.scaleY*Se],Ce=0;Ce<te;Ce++)se=He[0|Ce*Le.scaleX*ue],de[Ae++]=se,se=nt[0|Ce*Pe.scaleX*ue],de[Ae++]=se;break;case 3:for(it=!0,this.adobe&&this.adobe.transformCode?it=!0:typeof this.opts.colorTransform<"u"&&(it=!!this.opts.colorTransform),Le=this.components[0],Pe=this.components[1],Ee=this.components[2],Be=0;Be<ye;Be++)for(He=Le.lines[0|Be*Le.scaleY*Se],nt=Pe.lines[0|Be*Pe.scaleY*Se],ht=Ee.lines[0|Be*Ee.scaleY*Se],Ce=0;Ce<te;Ce++)it?(se=He[0|Ce*Le.scaleX*ue],pe=nt[0|Ce*Pe.scaleX*ue],Ke=ht[0|Ce*Ee.scaleX*ue],Ge=Z(se+1.402*(Ke-128)),We=Z(se-.3441363*(pe-128)-.71413636*(Ke-128)),Je=Z(se+1.772*(pe-128))):(Ge=He[0|Ce*Le.scaleX*ue],We=nt[0|Ce*Pe.scaleX*ue],Je=ht[0|Ce*Ee.scaleX*ue]),de[Ae++]=Ge,de[Ae++]=We,de[Ae++]=Je;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(it=!1,this.adobe&&this.adobe.transformCode?it=!0:typeof this.opts.colorTransform<"u"&&(it=!!this.opts.colorTransform),Le=this.components[0],Pe=this.components[1],Ee=this.components[2],Me=this.components[3],Be=0;Be<ye;Be++)for(He=Le.lines[0|Be*Le.scaleY*Se],nt=Pe.lines[0|Be*Pe.scaleY*Se],ht=Ee.lines[0|Be*Ee.scaleY*Se],Fe=Me.lines[0|Be*Me.scaleY*Se],Ce=0;Ce<te;Ce++)it?(se=He[0|Ce*Le.scaleX*ue],pe=nt[0|Ce*Pe.scaleX*ue],Ke=ht[0|Ce*Ee.scaleX*ue],_e=Fe[0|Ce*Me.scaleX*ue],ke=255-Z(se+1.402*(Ke-128)),qe=255-Z(se-.3441363*(pe-128)-.71413636*(Ke-128)),tt=255-Z(se+1.772*(pe-128))):(ke=He[0|Ce*Le.scaleX*ue],qe=nt[0|Ce*Pe.scaleX*ue],tt=ht[0|Ce*Ee.scaleX*ue],_e=Fe[0|Ce*Me.scaleX*ue]),de[Ae++]=255-ke,de[Ae++]=255-qe,de[Ae++]=255-tt,de[Ae++]=255-_e;break;default:throw new Error("Unsupported color mode")}return de},copyToImageData:function(te,ye){var ue=te.width,Se=te.height,Le=te.data,Pe=this.getData(ue,Se),Ee=0,Me=0,He,nt,ht,Fe,Ce,Be,Ae,se,pe;switch(this.components.length){case 1:for(nt=0;nt<Se;nt++)for(He=0;He<ue;He++)ht=Pe[Ee++],Le[Me++]=ht,Le[Me++]=ht,Le[Me++]=ht,ye&&(Le[Me++]=255);break;case 3:for(nt=0;nt<Se;nt++)for(He=0;He<ue;He++)Ae=Pe[Ee++],se=Pe[Ee++],pe=Pe[Ee++],Le[Me++]=Ae,Le[Me++]=se,Le[Me++]=pe,ye&&(Le[Me++]=255);break;case 4:for(nt=0;nt<Se;nt++)for(He=0;He<ue;He++)Ce=Pe[Ee++],Be=Pe[Ee++],ht=Pe[Ee++],Fe=Pe[Ee++],Ae=255-Z(Ce*(1-Fe/255)+Fe),se=255-Z(Be*(1-Fe/255)+Fe),pe=255-Z(ht*(1-Fe/255)+Fe),Le[Me++]=Ae,Le[Me++]=se,Le[Me++]=pe,ye&&(Le[Me++]=255);break;default:throw new Error("Unsupported color mode")}}};var X=0,W=0;function J(re=0){var te=X+re;if(te>W){var ye=Math.ceil((te-W)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${ye}MB`)}X=te}return x.resetMaxMemoryUsage=function(re){X=0,W=re},x.getBytesAllocated=function(){return X},x.requestMemoryAllocation=J,x}();typeof k<"u"?k.exports=S:typeof v<"u"&&(v["jpeg-js"]=v["jpeg-js"]||{},v["jpeg-js"].decode=S);function S(D,w={}){var E={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},m={...E,...w},y=new Uint8Array(D),p=new t;p.opts=m,t.resetMaxMemoryUsage(m.maxMemoryUsageInMB*1024*1024),p.parse(y);var C=m.formatAsRGBA?4:3,z=p.width*p.height*C;try{t.requestMemoryAllocation(z);var A={width:p.width,height:p.height,exifBuffer:p.exifBuffer,data:m.useTArray?new Uint8Array(z):new T(z)}}catch(P){throw P instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+z):P}return p.copyToImageData(A,m.formatAsRGBA),A}}).call(this,_("buffer").Buffer)},{buffer:48}],82:[function(_,k,b){(function(T){function t(D){var w=Math.floor,E=new Array(64),m=new Array(64),y=new Array(64),p=new Array(64),C,z,A,P,x=new Array(65535),O=new Array(65535),U=new Array(64),G=new Array(64),Z=[],X=0,W=7,J=new Array(64),re=new Array(64),te=new Array(64),ye=new Array(256),ue=new Array(2048),Se,Le=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],Pe=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],Ee=[0,1,2,3,4,5,6,7,8,9,10,11],Me=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],He=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],nt=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],ht=[0,1,2,3,4,5,6,7,8,9,10,11],Fe=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Ce=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Be(le){for(var et=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],wt=0;wt<64;wt++){var Ft=w((et[wt]*le+50)/100);Ft<1?Ft=1:Ft>255&&(Ft=255),E[Le[wt]]=Ft}for(var Wt=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],or=0;or<64;or++){var Or=w((Wt[or]*le+50)/100);Or<1?Or=1:Or>255&&(Or=255),m[Le[or]]=Or}for(var xr=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Tr=0,br=0;br<8;br++)for(var fr=0;fr<8;fr++)y[Tr]=1/(E[Le[Tr]]*xr[br]*xr[fr]*8),p[Tr]=1/(m[Le[Tr]]*xr[br]*xr[fr]*8),Tr++}function Ae(le,et){for(var wt=0,Ft=0,Wt=new Array,or=1;or<=16;or++){for(var Or=1;Or<=le[or];Or++)Wt[et[Ft]]=[],Wt[et[Ft]][0]=wt,Wt[et[Ft]][1]=or,Ft++,wt++;wt*=2}return Wt}function se(){C=Ae(Pe,Ee),z=Ae(nt,ht),A=Ae(Me,He),P=Ae(Fe,Ce)}function pe(){for(var le=1,et=2,wt=1;wt<=15;wt++){for(var Ft=le;Ft<et;Ft++)O[32767+Ft]=wt,x[32767+Ft]=[],x[32767+Ft][1]=wt,x[32767+Ft][0]=Ft;for(var Wt=-(et-1);Wt<=-le;Wt++)O[32767+Wt]=wt,x[32767+Wt]=[],x[32767+Wt][1]=wt,x[32767+Wt][0]=et-1+Wt;le<<=1,et<<=1}}function Ke(){for(var le=0;le<256;le++)ue[le]=19595*le,ue[le+256>>0]=38470*le,ue[le+512>>0]=7471*le+32768,ue[le+768>>0]=-11059*le,ue[le+1024>>0]=-21709*le,ue[le+1280>>0]=32768*le+8421375,ue[le+1536>>0]=-27439*le,ue[le+1792>>0]=-5329*le}function _e(le){for(var et=le[0],wt=le[1]-1;wt>=0;)et&1<<wt&&(X|=1<<W),wt--,W--,W<0&&(X==255?(ke(255),ke(0)):ke(X),W=7,X=0)}function ke(le){Z.push(le)}function qe(le){ke(le>>8&255),ke(le&255)}function tt(le,et){var wt,Ft,Wt,or,Or,xr,Tr,br,fr=0,Vr,Ir=8,De=64;for(Vr=0;Vr<Ir;++Vr){wt=le[fr],Ft=le[fr+1],Wt=le[fr+2],or=le[fr+3],Or=le[fr+4],xr=le[fr+5],Tr=le[fr+6],br=le[fr+7];var St=wt+br,Ut=wt-br,ir=Ft+Tr,Rt=Ft-Tr,$t=Wt+xr,rt=Wt-xr,sr=or+Or,Fr=or-Or,ee=St+sr,Qe=St-sr,ie=ir+$t,B=ir-$t;le[fr]=ee+ie,le[fr+4]=ee-ie;var Q=(B+Qe)*.707106781;le[fr+2]=Qe+Q,le[fr+6]=Qe-Q,ee=Fr+rt,ie=rt+Rt,B=Rt+Ut;var xe=(ee-B)*.382683433,Ne=.5411961*ee+xe,Ze=1.306562965*B+xe,ot=ie*.707106781,mt=Ut+ot,Nt=Ut-ot;le[fr+5]=Nt+Ne,le[fr+3]=Nt-Ne,le[fr+1]=mt+Ze,le[fr+7]=mt-Ze,fr+=8}for(fr=0,Vr=0;Vr<Ir;++Vr){wt=le[fr],Ft=le[fr+8],Wt=le[fr+16],or=le[fr+24],Or=le[fr+32],xr=le[fr+40],Tr=le[fr+48],br=le[fr+56];var Bt=wt+br,Lt=wt-br,Yt=Ft+Tr,cr=Ft-Tr,gr=Wt+xr,Pr=Wt-xr,Jr=or+Or,Br=or-Or,Ur=Bt+Jr,oi=Bt-Jr,si=Yt+gr,Kr=Yt-gr;le[fr]=Ur+si,le[fr+32]=Ur-si;var Wr=(Kr+oi)*.707106781;le[fr+16]=oi+Wr,le[fr+48]=oi-Wr,Ur=Br+Pr,si=Pr+cr,Kr=cr+Lt;var Pi=(Ur-Kr)*.382683433,Ki=.5411961*Ur+Pi,xn=1.306562965*Kr+Pi,en=si*.707106781,ut=Lt+en,_t=Lt-en;le[fr+40]=_t+Ki,le[fr+24]=_t-Ki,le[fr+8]=ut+xn,le[fr+56]=ut-xn,fr++}var Vt;for(Vr=0;Vr<De;++Vr)Vt=le[Vr]*et[Vr],U[Vr]=Vt>0?Vt+.5|0:Vt-.5|0;return U}function Ge(){qe(65504),qe(16),ke(74),ke(70),ke(73),ke(70),ke(0),ke(1),ke(1),ke(0),qe(1),qe(1),ke(0),ke(0)}function We(le){if(le){qe(65505),le[0]===69&&le[1]===120&&le[2]===105&&le[3]===102?qe(le.length+2):(qe(le.length+5+2),ke(69),ke(120),ke(105),ke(102),ke(0));for(var et=0;et<le.length;et++)ke(le[et])}}function Je(le,et){qe(65472),qe(17),ke(8),qe(et),qe(le),ke(3),ke(1),ke(17),ke(0),ke(2),ke(17),ke(1),ke(3),ke(17),ke(1)}function it(){qe(65499),qe(132),ke(0);for(var le=0;le<64;le++)ke(E[le]);ke(1);for(var et=0;et<64;et++)ke(m[et])}function ze(){qe(65476),qe(418),ke(0);for(var le=0;le<16;le++)ke(Pe[le+1]);for(var et=0;et<=11;et++)ke(Ee[et]);ke(16);for(var wt=0;wt<16;wt++)ke(Me[wt+1]);for(var Ft=0;Ft<=161;Ft++)ke(He[Ft]);ke(1);for(var Wt=0;Wt<16;Wt++)ke(nt[Wt+1]);for(var or=0;or<=11;or++)ke(ht[or]);ke(17);for(var Or=0;Or<16;Or++)ke(Fe[Or+1]);for(var xr=0;xr<=161;xr++)ke(Ce[xr])}function de(){qe(65498),qe(12),ke(3),ke(1),ke(0),ke(2),ke(17),ke(3),ke(17),ke(0),ke(63),ke(0)}function ve(le,et,wt,Ft,Wt){for(var or=Wt[0],Or=Wt[240],xr,Tr=16,br=63,fr=64,Vr=tt(le,et),Ir=0;Ir<fr;++Ir)G[Le[Ir]]=Vr[Ir];var De=G[0]-wt;wt=G[0],De==0?_e(Ft[0]):(xr=32767+De,_e(Ft[O[xr]]),_e(x[xr]));for(var St=63;St>0&&G[St]==0;St--);if(St==0)return _e(or),wt;for(var Ut=1,ir;Ut<=St;){for(var Rt=Ut;G[Ut]==0&&Ut<=St;++Ut);var $t=Ut-Rt;if($t>=Tr){ir=$t>>4;for(var rt=1;rt<=ir;++rt)_e(Or);$t=$t&15}xr=32767+G[Ut],_e(Wt[($t<<4)+O[xr]]),_e(x[xr]),Ut++}return St!=br&&_e(or),wt}function be(){for(var le=String.fromCharCode,et=0;et<256;et++)ye[et]=le(et)}this.encode=function(le,et){new Date().getTime(),et&&Oe(et),Z=new Array,X=0,W=7,qe(65496),Ge(),We(le.exifBuffer),it(),Je(le.width,le.height),ze(),de();var wt=0,Ft=0,Wt=0;X=0,W=7,this.encode.displayName="_encode_";for(var or=le.data,Or=le.width,xr=le.height,Tr=Or*4,br,fr=0,Vr,Ir,De,St,Ut,ir,Rt,$t;fr<xr;){for(br=0;br<Tr;){for(St=Tr*fr+br,Ut=St,ir=-1,Rt=0,$t=0;$t<64;$t++)Rt=$t>>3,ir=($t&7)*4,Ut=St+Rt*Tr+ir,fr+Rt>=xr&&(Ut-=Tr*(fr+1+Rt-xr)),br+ir>=Tr&&(Ut-=br+ir-Tr+4),Vr=or[Ut++],Ir=or[Ut++],De=or[Ut++],J[$t]=(ue[Vr]+ue[Ir+256>>0]+ue[De+512>>0]>>16)-128,re[$t]=(ue[Vr+768>>0]+ue[Ir+1024>>0]+ue[De+1280>>0]>>16)-128,te[$t]=(ue[Vr+1280>>0]+ue[Ir+1536>>0]+ue[De+1792>>0]>>16)-128;wt=ve(J,y,wt,C,A),Ft=ve(re,p,Ft,z,P),Wt=ve(te,p,Wt,z,P),br+=32}fr+=8}if(W>=0){var rt=[];rt[1]=W+1,rt[0]=(1<<W+1)-1,_e(rt)}return qe(65497),typeof k>"u"?new Uint8Array(Z):new T(Z)};function Oe(le){if(le<=0&&(le=1),le>100&&(le=100),Se!=le){var et=0;le<50?et=Math.floor(5e3/le):et=Math.floor(200-le*2),Be(et),Se=le}}function ge(){var le=new Date().getTime();D||(D=50),be(),se(),pe(),Ke(),Oe(D),new Date().getTime()-le}ge()}typeof k<"u"?k.exports=S:typeof v<"u"&&(v["jpeg-js"]=v["jpeg-js"]||{},v["jpeg-js"].encode=S);function S(D,w){typeof w>"u"&&(w=50);var E=new t(w),m=E.encode(D,w);return{data:m,width:D.width,height:D.height}}}).call(this,_("buffer").Buffer)},{buffer:48}],83:[function(_,k,b){(function(T){var t=_("path"),S=_("fs"),D=parseInt("0777",8);k.exports=w.mkdirp=w.mkdirP=w;function w(E,m,y,p){typeof m=="function"?(y=m,m={}):(!m||typeof m!="object")&&(m={mode:m});var C=m.mode,z=m.fs||S;C===void 0&&(C=D&~T.umask()),p||(p=null);var A=y||function(){};E=t.resolve(E),z.mkdir(E,C,function(P){if(!P)return p=p||E,A(null,p);switch(P.code){case"ENOENT":w(t.dirname(E),m,function(x,O){x?A(x,O):w(E,m,A,O)});break;default:z.stat(E,function(x,O){x||!O.isDirectory()?A(P,p):A(null,p)});break}})}w.sync=function E(m,y,p){(!y||typeof y!="object")&&(y={mode:y});var C=y.mode,z=y.fs||S;C===void 0&&(C=D&~T.umask()),p||(p=null),m=t.resolve(m);try{z.mkdirSync(m,C),p=p||m}catch(P){switch(P.code){case"ENOENT":p=E(t.dirname(m),y,p),E(m,y,p);break;default:var A;try{A=z.statSync(m)}catch{throw P}if(!A.isDirectory())throw P;break}}return p}}).call(this,_("_process"))},{_process:133,fs:47,path:107}],84:[function(_,k,b){var T=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;function D(E){if(E==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(E)}function w(){try{if(!Object.assign)return!1;var E=new String("abc");if(E[5]="de",Object.getOwnPropertyNames(E)[0]==="5")return!1;for(var m={},y=0;y<10;y++)m["_"+String.fromCharCode(y)]=y;var p=Object.getOwnPropertyNames(m).map(function(z){return m[z]});if(p.join("")!=="0123456789")return!1;var C={};return"abcdefghijklmnopqrst".split("").forEach(function(z){C[z]=z}),Object.keys(Object.assign({},C)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}k.exports=w()?Object.assign:function(E,m){for(var y,p=D(E),C,z=1;z<arguments.length;z++){y=Object(arguments[z]);for(var A in y)t.call(y,A)&&(p[A]=y[A]);if(T){C=T(y);for(var P=0;P<C.length;P++)S.call(y,C[P])&&(p[C[P]]=y[C[P]])}}return p}},{}],85:[function(_,k,b){arguments[4][64][0].apply(b,arguments)},{dup:64}],86:[function(_,k,b){var T=_("./lib/utils/common").assign,t=_("./lib/deflate"),S=_("./lib/inflate"),D=_("./lib/zlib/constants"),w={};T(w,t,S,D),k.exports=w},{"./lib/deflate":87,"./lib/inflate":88,"./lib/utils/common":89,"./lib/zlib/constants":92}],87:[function(_,k,b){var T=_("./zlib/deflate"),t=_("./utils/common"),S=_("./utils/strings"),D=_("./zlib/messages"),w=_("./zlib/zstream"),E=Object.prototype.toString,m=0,y=4,p=0,C=1,z=2,A=-1,P=0,x=8;function O(X){if(!(this instanceof O))return new O(X);this.options=t.assign({level:A,method:x,chunkSize:16384,windowBits:15,memLevel:8,strategy:P,to:""},X||{});var W=this.options;W.raw&&W.windowBits>0?W.windowBits=-W.windowBits:W.gzip&&W.windowBits>0&&W.windowBits<16&&(W.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new w,this.strm.avail_out=0;var J=T.deflateInit2(this.strm,W.level,W.method,W.windowBits,W.memLevel,W.strategy);if(J!==p)throw new Error(D[J]);if(W.header&&T.deflateSetHeader(this.strm,W.header),W.dictionary){var re;if(typeof W.dictionary=="string"?re=S.string2buf(W.dictionary):E.call(W.dictionary)==="[object ArrayBuffer]"?re=new Uint8Array(W.dictionary):re=W.dictionary,J=T.deflateSetDictionary(this.strm,re),J!==p)throw new Error(D[J]);this._dict_set=!0}}O.prototype.push=function(X,W){var J=this.strm,re=this.options.chunkSize,te,ye;if(this.ended)return!1;ye=W===~~W?W:W===!0?y:m,typeof X=="string"?J.input=S.string2buf(X):E.call(X)==="[object ArrayBuffer]"?J.input=new Uint8Array(X):J.input=X,J.next_in=0,J.avail_in=J.input.length;do{if(J.avail_out===0&&(J.output=new t.Buf8(re),J.next_out=0,J.avail_out=re),te=T.deflate(J,ye),te!==C&&te!==p)return this.onEnd(te),this.ended=!0,!1;(J.avail_out===0||J.avail_in===0&&(ye===y||ye===z))&&(this.options.to==="string"?this.onData(S.buf2binstring(t.shrinkBuf(J.output,J.next_out))):this.onData(t.shrinkBuf(J.output,J.next_out)))}while((J.avail_in>0||J.avail_out===0)&&te!==C);return ye===y?(te=T.deflateEnd(this.strm),this.onEnd(te),this.ended=!0,te===p):(ye===z&&(this.onEnd(p),J.avail_out=0),!0)},O.prototype.onData=function(X){this.chunks.push(X)},O.prototype.onEnd=function(X){X===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=X,this.msg=this.strm.msg};function U(X,W){var J=new O(W);if(J.push(X,!0),J.err)throw J.msg||D[J.err];return J.result}function G(X,W){return W=W||{},W.raw=!0,U(X,W)}function Z(X,W){return W=W||{},W.gzip=!0,U(X,W)}b.Deflate=O,b.deflate=U,b.deflateRaw=G,b.gzip=Z},{"./utils/common":89,"./utils/strings":90,"./zlib/deflate":94,"./zlib/messages":99,"./zlib/zstream":101}],88:[function(_,k,b){var T=_("./zlib/inflate"),t=_("./utils/common"),S=_("./utils/strings"),D=_("./zlib/constants"),w=_("./zlib/messages"),E=_("./zlib/zstream"),m=_("./zlib/gzheader"),y=Object.prototype.toString;function p(A){if(!(this instanceof p))return new p(A);this.options=t.assign({chunkSize:16384,windowBits:0,to:""},A||{});var P=this.options;P.raw&&P.windowBits>=0&&P.windowBits<16&&(P.windowBits=-P.windowBits,P.windowBits===0&&(P.windowBits=-15)),P.windowBits>=0&&P.windowBits<16&&!(A&&A.windowBits)&&(P.windowBits+=32),P.windowBits>15&&P.windowBits<48&&(P.windowBits&15||(P.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new E,this.strm.avail_out=0;var x=T.inflateInit2(this.strm,P.windowBits);if(x!==D.Z_OK)throw new Error(w[x]);this.header=new m,T.inflateGetHeader(this.strm,this.header)}p.prototype.push=function(A,P){var x=this.strm,O=this.options.chunkSize,U=this.options.dictionary,G,Z,X,W,J,re,te=!1;if(this.ended)return!1;Z=P===~~P?P:P===!0?D.Z_FINISH:D.Z_NO_FLUSH,typeof A=="string"?x.input=S.binstring2buf(A):y.call(A)==="[object ArrayBuffer]"?x.input=new Uint8Array(A):x.input=A,x.next_in=0,x.avail_in=x.input.length;do{if(x.avail_out===0&&(x.output=new t.Buf8(O),x.next_out=0,x.avail_out=O),G=T.inflate(x,D.Z_NO_FLUSH),G===D.Z_NEED_DICT&&U&&(typeof U=="string"?re=S.string2buf(U):y.call(U)==="[object ArrayBuffer]"?re=new Uint8Array(U):re=U,G=T.inflateSetDictionary(this.strm,re)),G===D.Z_BUF_ERROR&&te===!0&&(G=D.Z_OK,te=!1),G!==D.Z_STREAM_END&&G!==D.Z_OK)return this.onEnd(G),this.ended=!0,!1;x.next_out&&(x.avail_out===0||G===D.Z_STREAM_END||x.avail_in===0&&(Z===D.Z_FINISH||Z===D.Z_SYNC_FLUSH))&&(this.options.to==="string"?(X=S.utf8border(x.output,x.next_out),W=x.next_out-X,J=S.buf2string(x.output,X),x.next_out=W,x.avail_out=O-W,W&&t.arraySet(x.output,x.output,X,W,0),this.onData(J)):this.onData(t.shrinkBuf(x.output,x.next_out))),x.avail_in===0&&x.avail_out===0&&(te=!0)}while((x.avail_in>0||x.avail_out===0)&&G!==D.Z_STREAM_END);return G===D.Z_STREAM_END&&(Z=D.Z_FINISH),Z===D.Z_FINISH?(G=T.inflateEnd(this.strm),this.onEnd(G),this.ended=!0,G===D.Z_OK):(Z===D.Z_SYNC_FLUSH&&(this.onEnd(D.Z_OK),x.avail_out=0),!0)},p.prototype.onData=function(A){this.chunks.push(A)},p.prototype.onEnd=function(A){A===D.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=A,this.msg=this.strm.msg};function C(A,P){var x=new p(P);if(x.push(A,!0),x.err)throw x.msg||w[x.err];return x.result}function z(A,P){return P=P||{},P.raw=!0,C(A,P)}b.Inflate=p,b.inflate=C,b.inflateRaw=z,b.ungzip=C},{"./utils/common":89,"./utils/strings":90,"./zlib/constants":92,"./zlib/gzheader":95,"./zlib/inflate":97,"./zlib/messages":99,"./zlib/zstream":101}],89:[function(_,k,b){arguments[4][36][0].apply(b,arguments)},{dup:36}],90:[function(_,k,b){var T=_("./common"),t=!0,S=!0;try{String.fromCharCode.apply(null,[0])}catch{t=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{S=!1}for(var D=new T.Buf8(256),w=0;w<256;w++)D[w]=w>=252?6:w>=248?5:w>=240?4:w>=224?3:w>=192?2:1;D[254]=D[254]=1,b.string2buf=function(m){var y,p,C,z,A,P=m.length,x=0;for(z=0;z<P;z++)p=m.charCodeAt(z),(p&64512)===55296&&z+1<P&&(C=m.charCodeAt(z+1),(C&64512)===56320&&(p=65536+(p-55296<<10)+(C-56320),z++)),x+=p<128?1:p<2048?2:p<65536?3:4;for(y=new T.Buf8(x),A=0,z=0;A<x;z++)p=m.charCodeAt(z),(p&64512)===55296&&z+1<P&&(C=m.charCodeAt(z+1),(C&64512)===56320&&(p=65536+(p-55296<<10)+(C-56320),z++)),p<128?y[A++]=p:p<2048?(y[A++]=192|p>>>6,y[A++]=128|p&63):p<65536?(y[A++]=224|p>>>12,y[A++]=128|p>>>6&63,y[A++]=128|p&63):(y[A++]=240|p>>>18,y[A++]=128|p>>>12&63,y[A++]=128|p>>>6&63,y[A++]=128|p&63);return y};function E(m,y){if(y<65537&&(m.subarray&&S||!m.subarray&&t))return String.fromCharCode.apply(null,T.shrinkBuf(m,y));for(var p="",C=0;C<y;C++)p+=String.fromCharCode(m[C]);return p}b.buf2binstring=function(m){return E(m,m.length)},b.binstring2buf=function(m){for(var y=new T.Buf8(m.length),p=0,C=y.length;p<C;p++)y[p]=m.charCodeAt(p);return y},b.buf2string=function(m,y){var p,C,z,A,P=y||m.length,x=new Array(P*2);for(C=0,p=0;p<P;){if(z=m[p++],z<128){x[C++]=z;continue}if(A=D[z],A>4){x[C++]=65533,p+=A-1;continue}for(z&=A===2?31:A===3?15:7;A>1&&p<P;)z=z<<6|m[p++]&63,A--;if(A>1){x[C++]=65533;continue}z<65536?x[C++]=z:(z-=65536,x[C++]=55296|z>>10&1023,x[C++]=56320|z&1023)}return E(x,C)},b.utf8border=function(m,y){var p;for(y=y||m.length,y>m.length&&(y=m.length),p=y-1;p>=0&&(m[p]&192)===128;)p--;return p<0||p===0?y:p+D[m[p]]>y?p:y}},{"./common":89}],91:[function(_,k,b){arguments[4][37][0].apply(b,arguments)},{dup:37}],92:[function(_,k,b){arguments[4][38][0].apply(b,arguments)},{dup:38}],93:[function(_,k,b){arguments[4][39][0].apply(b,arguments)},{dup:39}],94:[function(_,k,b){var T=_("../utils/common"),t=_("./trees"),S=_("./adler32"),D=_("./crc32"),w=_("./messages"),E=0,m=1,y=3,p=4,C=5,z=0,A=1,P=-2,x=-3,O=-5,U=-1,G=1,Z=2,X=3,W=4,J=0,re=2,te=8,ye=9,ue=15,Se=8,Le=29,Pe=256,Ee=Pe+1+Le,Me=30,He=19,nt=2*Ee+1,ht=15,Fe=3,Ce=258,Be=Ce+Fe+1,Ae=32,se=42,pe=69,Ke=73,_e=91,ke=103,qe=113,tt=666,Ge=1,We=2,Je=3,it=4,ze=3;function de(ee,Qe){return ee.msg=w[Qe],Qe}function ve(ee){return(ee<<1)-(ee>4?9:0)}function be(ee){for(var Qe=ee.length;--Qe>=0;)ee[Qe]=0}function Oe(ee){var Qe=ee.state,ie=Qe.pending;ie>ee.avail_out&&(ie=ee.avail_out),ie!==0&&(T.arraySet(ee.output,Qe.pending_buf,Qe.pending_out,ie,ee.next_out),ee.next_out+=ie,Qe.pending_out+=ie,ee.total_out+=ie,ee.avail_out-=ie,Qe.pending-=ie,Qe.pending===0&&(Qe.pending_out=0))}function ge(ee,Qe){t._tr_flush_block(ee,ee.block_start>=0?ee.block_start:-1,ee.strstart-ee.block_start,Qe),ee.block_start=ee.strstart,Oe(ee.strm)}function le(ee,Qe){ee.pending_buf[ee.pending++]=Qe}function et(ee,Qe){ee.pending_buf[ee.pending++]=Qe>>>8&255,ee.pending_buf[ee.pending++]=Qe&255}function wt(ee,Qe,ie,B){var Q=ee.avail_in;return Q>B&&(Q=B),Q===0?0:(ee.avail_in-=Q,T.arraySet(Qe,ee.input,ee.next_in,Q,ie),ee.state.wrap===1?ee.adler=S(ee.adler,Qe,Q,ie):ee.state.wrap===2&&(ee.adler=D(ee.adler,Qe,Q,ie)),ee.next_in+=Q,ee.total_in+=Q,Q)}function Ft(ee,Qe){var ie=ee.max_chain_length,B=ee.strstart,Q,xe,Ne=ee.prev_length,Ze=ee.nice_match,ot=ee.strstart>ee.w_size-Be?ee.strstart-(ee.w_size-Be):0,mt=ee.window,Nt=ee.w_mask,Bt=ee.prev,Lt=ee.strstart+Ce,Yt=mt[B+Ne-1],cr=mt[B+Ne];ee.prev_length>=ee.good_match&&(ie>>=2),Ze>ee.lookahead&&(Ze=ee.lookahead);do if(Q=Qe,!(mt[Q+Ne]!==cr||mt[Q+Ne-1]!==Yt||mt[Q]!==mt[B]||mt[++Q]!==mt[B+1])){B+=2,Q++;do;while(mt[++B]===mt[++Q]&&mt[++B]===mt[++Q]&&mt[++B]===mt[++Q]&&mt[++B]===mt[++Q]&&mt[++B]===mt[++Q]&&mt[++B]===mt[++Q]&&mt[++B]===mt[++Q]&&mt[++B]===mt[++Q]&&B<Lt);if(xe=Ce-(Lt-B),B=Lt-Ce,xe>Ne){if(ee.match_start=Qe,Ne=xe,xe>=Ze)break;Yt=mt[B+Ne-1],cr=mt[B+Ne]}}while((Qe=Bt[Qe&Nt])>ot&&--ie!==0);return Ne<=ee.lookahead?Ne:ee.lookahead}function Wt(ee){var Qe=ee.w_size,ie,B,Q,xe,Ne;do{if(xe=ee.window_size-ee.lookahead-ee.strstart,ee.strstart>=Qe+(Qe-Be)){T.arraySet(ee.window,ee.window,Qe,Qe,0),ee.match_start-=Qe,ee.strstart-=Qe,ee.block_start-=Qe,B=ee.hash_size,ie=B;do Q=ee.head[--ie],ee.head[ie]=Q>=Qe?Q-Qe:0;while(--B);B=Qe,ie=B;do Q=ee.prev[--ie],ee.prev[ie]=Q>=Qe?Q-Qe:0;while(--B);xe+=Qe}if(ee.strm.avail_in===0)break;if(B=wt(ee.strm,ee.window,ee.strstart+ee.lookahead,xe),ee.lookahead+=B,ee.lookahead+ee.insert>=Fe)for(Ne=ee.strstart-ee.insert,ee.ins_h=ee.window[Ne],ee.ins_h=(ee.ins_h<<ee.hash_shift^ee.window[Ne+1])&ee.hash_mask;ee.insert&&(ee.ins_h=(ee.ins_h<<ee.hash_shift^ee.window[Ne+Fe-1])&ee.hash_mask,ee.prev[Ne&ee.w_mask]=ee.head[ee.ins_h],ee.head[ee.ins_h]=Ne,Ne++,ee.insert--,!(ee.lookahead+ee.insert<Fe)););}while(ee.lookahead<Be&&ee.strm.avail_in!==0)}function or(ee,Qe){var ie=65535;for(ie>ee.pending_buf_size-5&&(ie=ee.pending_buf_size-5);;){if(ee.lookahead<=1){if(Wt(ee),ee.lookahead===0&&Qe===E)return Ge;if(ee.lookahead===0)break}ee.strstart+=ee.lookahead,ee.lookahead=0;var B=ee.block_start+ie;if((ee.strstart===0||ee.strstart>=B)&&(ee.lookahead=ee.strstart-B,ee.strstart=B,ge(ee,!1),ee.strm.avail_out===0)||ee.strstart-ee.block_start>=ee.w_size-Be&&(ge(ee,!1),ee.strm.avail_out===0))return Ge}return ee.insert=0,Qe===p?(ge(ee,!0),ee.strm.avail_out===0?Je:it):(ee.strstart>ee.block_start&&(ge(ee,!1),ee.strm.avail_out===0),Ge)}function Or(ee,Qe){for(var ie,B;;){if(ee.lookahead<Be){if(Wt(ee),ee.lookahead<Be&&Qe===E)return Ge;if(ee.lookahead===0)break}if(ie=0,ee.lookahead>=Fe&&(ee.ins_h=(ee.ins_h<<ee.hash_shift^ee.window[ee.strstart+Fe-1])&ee.hash_mask,ie=ee.prev[ee.strstart&ee.w_mask]=ee.head[ee.ins_h],ee.head[ee.ins_h]=ee.strstart),ie!==0&&ee.strstart-ie<=ee.w_size-Be&&(ee.match_length=Ft(ee,ie)),ee.match_length>=Fe)if(B=t._tr_tally(ee,ee.strstart-ee.match_start,ee.match_length-Fe),ee.lookahead-=ee.match_length,ee.match_length<=ee.max_lazy_match&&ee.lookahead>=Fe){ee.match_length--;do ee.strstart++,ee.ins_h=(ee.ins_h<<ee.hash_shift^ee.window[ee.strstart+Fe-1])&ee.hash_mask,ie=ee.prev[ee.strstart&ee.w_mask]=ee.head[ee.ins_h],ee.head[ee.ins_h]=ee.strstart;while(--ee.match_length!==0);ee.strstart++}else ee.strstart+=ee.match_length,ee.match_length=0,ee.ins_h=ee.window[ee.strstart],ee.ins_h=(ee.ins_h<<ee.hash_shift^ee.window[ee.strstart+1])&ee.hash_mask;else B=t._tr_tally(ee,0,ee.window[ee.strstart]),ee.lookahead--,ee.strstart++;if(B&&(ge(ee,!1),ee.strm.avail_out===0))return Ge}return ee.insert=ee.strstart<Fe-1?ee.strstart:Fe-1,Qe===p?(ge(ee,!0),ee.strm.avail_out===0?Je:it):ee.last_lit&&(ge(ee,!1),ee.strm.avail_out===0)?Ge:We}function xr(ee,Qe){for(var ie,B,Q;;){if(ee.lookahead<Be){if(Wt(ee),ee.lookahead<Be&&Qe===E)return Ge;if(ee.lookahead===0)break}if(ie=0,ee.lookahead>=Fe&&(ee.ins_h=(ee.ins_h<<ee.hash_shift^ee.window[ee.strstart+Fe-1])&ee.hash_mask,ie=ee.prev[ee.strstart&ee.w_mask]=ee.head[ee.ins_h],ee.head[ee.ins_h]=ee.strstart),ee.prev_length=ee.match_length,ee.prev_match=ee.match_start,ee.match_length=Fe-1,ie!==0&&ee.prev_length<ee.max_lazy_match&&ee.strstart-ie<=ee.w_size-Be&&(ee.match_length=Ft(ee,ie),ee.match_length<=5&&(ee.strategy===G||ee.match_length===Fe&&ee.strstart-ee.match_start>4096)&&(ee.match_length=Fe-1)),ee.prev_length>=Fe&&ee.match_length<=ee.prev_length){Q=ee.strstart+ee.lookahead-Fe,B=t._tr_tally(ee,ee.strstart-1-ee.prev_match,ee.prev_length-Fe),ee.lookahead-=ee.prev_length-1,ee.prev_length-=2;do++ee.strstart<=Q&&(ee.ins_h=(ee.ins_h<<ee.hash_shift^ee.window[ee.strstart+Fe-1])&ee.hash_mask,ie=ee.prev[ee.strstart&ee.w_mask]=ee.head[ee.ins_h],ee.head[ee.ins_h]=ee.strstart);while(--ee.prev_length!==0);if(ee.match_available=0,ee.match_length=Fe-1,ee.strstart++,B&&(ge(ee,!1),ee.strm.avail_out===0))return Ge}else if(ee.match_available){if(B=t._tr_tally(ee,0,ee.window[ee.strstart-1]),B&&ge(ee,!1),ee.strstart++,ee.lookahead--,ee.strm.avail_out===0)return Ge}else ee.match_available=1,ee.strstart++,ee.lookahead--}return ee.match_available&&(B=t._tr_tally(ee,0,ee.window[ee.strstart-1]),ee.match_available=0),ee.insert=ee.strstart<Fe-1?ee.strstart:Fe-1,Qe===p?(ge(ee,!0),ee.strm.avail_out===0?Je:it):ee.last_lit&&(ge(ee,!1),ee.strm.avail_out===0)?Ge:We}function Tr(ee,Qe){for(var ie,B,Q,xe,Ne=ee.window;;){if(ee.lookahead<=Ce){if(Wt(ee),ee.lookahead<=Ce&&Qe===E)return Ge;if(ee.lookahead===0)break}if(ee.match_length=0,ee.lookahead>=Fe&&ee.strstart>0&&(Q=ee.strstart-1,B=Ne[Q],B===Ne[++Q]&&B===Ne[++Q]&&B===Ne[++Q])){xe=ee.strstart+Ce;do;while(B===Ne[++Q]&&B===Ne[++Q]&&B===Ne[++Q]&&B===Ne[++Q]&&B===Ne[++Q]&&B===Ne[++Q]&&B===Ne[++Q]&&B===Ne[++Q]&&Q<xe);ee.match_length=Ce-(xe-Q),ee.match_length>ee.lookahead&&(ee.match_length=ee.lookahead)}if(ee.match_length>=Fe?(ie=t._tr_tally(ee,1,ee.match_length-Fe),ee.lookahead-=ee.match_length,ee.strstart+=ee.match_length,ee.match_length=0):(ie=t._tr_tally(ee,0,ee.window[ee.strstart]),ee.lookahead--,ee.strstart++),ie&&(ge(ee,!1),ee.strm.avail_out===0))return Ge}return ee.insert=0,Qe===p?(ge(ee,!0),ee.strm.avail_out===0?Je:it):ee.last_lit&&(ge(ee,!1),ee.strm.avail_out===0)?Ge:We}function br(ee,Qe){for(var ie;;){if(ee.lookahead===0&&(Wt(ee),ee.lookahead===0)){if(Qe===E)return Ge;break}if(ee.match_length=0,ie=t._tr_tally(ee,0,ee.window[ee.strstart]),ee.lookahead--,ee.strstart++,ie&&(ge(ee,!1),ee.strm.avail_out===0))return Ge}return ee.insert=0,Qe===p?(ge(ee,!0),ee.strm.avail_out===0?Je:it):ee.last_lit&&(ge(ee,!1),ee.strm.avail_out===0)?Ge:We}function fr(ee,Qe,ie,B,Q){this.good_length=ee,this.max_lazy=Qe,this.nice_length=ie,this.max_chain=B,this.func=Q}var Vr;Vr=[new fr(0,0,0,0,or),new fr(4,4,8,4,Or),new fr(4,5,16,8,Or),new fr(4,6,32,32,Or),new fr(4,4,16,16,xr),new fr(8,16,32,32,xr),new fr(8,16,128,128,xr),new fr(8,32,128,256,xr),new fr(32,128,258,1024,xr),new fr(32,258,258,4096,xr)];function Ir(ee){ee.window_size=2*ee.w_size,be(ee.head),ee.max_lazy_match=Vr[ee.level].max_lazy,ee.good_match=Vr[ee.level].good_length,ee.nice_match=Vr[ee.level].nice_length,ee.max_chain_length=Vr[ee.level].max_chain,ee.strstart=0,ee.block_start=0,ee.lookahead=0,ee.insert=0,ee.match_length=ee.prev_length=Fe-1,ee.match_available=0,ee.ins_h=0}function De(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=te,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new T.Buf16(nt*2),this.dyn_dtree=new T.Buf16((2*Me+1)*2),this.bl_tree=new T.Buf16((2*He+1)*2),be(this.dyn_ltree),be(this.dyn_dtree),be(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new T.Buf16(ht+1),this.heap=new T.Buf16(2*Ee+1),be(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new T.Buf16(2*Ee+1),be(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function St(ee){var Qe;return!ee||!ee.state?de(ee,P):(ee.total_in=ee.total_out=0,ee.data_type=re,Qe=ee.state,Qe.pending=0,Qe.pending_out=0,Qe.wrap<0&&(Qe.wrap=-Qe.wrap),Qe.status=Qe.wrap?se:qe,ee.adler=Qe.wrap===2?0:1,Qe.last_flush=E,t._tr_init(Qe),z)}function Ut(ee){var Qe=St(ee);return Qe===z&&Ir(ee.state),Qe}function ir(ee,Qe){return!ee||!ee.state||ee.state.wrap!==2?P:(ee.state.gzhead=Qe,z)}function Rt(ee,Qe,ie,B,Q,xe){if(!ee)return P;var Ne=1;if(Qe===U&&(Qe=6),B<0?(Ne=0,B=-B):B>15&&(Ne=2,B-=16),Q<1||Q>ye||ie!==te||B<8||B>15||Qe<0||Qe>9||xe<0||xe>W)return de(ee,P);B===8&&(B=9);var Ze=new De;return ee.state=Ze,Ze.strm=ee,Ze.wrap=Ne,Ze.gzhead=null,Ze.w_bits=B,Ze.w_size=1<<Ze.w_bits,Ze.w_mask=Ze.w_size-1,Ze.hash_bits=Q+7,Ze.hash_size=1<<Ze.hash_bits,Ze.hash_mask=Ze.hash_size-1,Ze.hash_shift=~~((Ze.hash_bits+Fe-1)/Fe),Ze.window=new T.Buf8(Ze.w_size*2),Ze.head=new T.Buf16(Ze.hash_size),Ze.prev=new T.Buf16(Ze.w_size),Ze.lit_bufsize=1<<Q+6,Ze.pending_buf_size=Ze.lit_bufsize*4,Ze.pending_buf=new T.Buf8(Ze.pending_buf_size),Ze.d_buf=1*Ze.lit_bufsize,Ze.l_buf=3*Ze.lit_bufsize,Ze.level=Qe,Ze.strategy=xe,Ze.method=ie,Ut(ee)}function $t(ee,Qe){return Rt(ee,Qe,te,ue,Se,J)}function rt(ee,Qe){var ie,B,Q,xe;if(!ee||!ee.state||Qe>C||Qe<0)return ee?de(ee,P):P;if(B=ee.state,!ee.output||!ee.input&&ee.avail_in!==0||B.status===tt&&Qe!==p)return de(ee,ee.avail_out===0?O:P);if(B.strm=ee,ie=B.last_flush,B.last_flush=Qe,B.status===se)if(B.wrap===2)ee.adler=0,le(B,31),le(B,139),le(B,8),B.gzhead?(le(B,(B.gzhead.text?1:0)+(B.gzhead.hcrc?2:0)+(B.gzhead.extra?4:0)+(B.gzhead.name?8:0)+(B.gzhead.comment?16:0)),le(B,B.gzhead.time&255),le(B,B.gzhead.time>>8&255),le(B,B.gzhead.time>>16&255),le(B,B.gzhead.time>>24&255),le(B,B.level===9?2:B.strategy>=Z||B.level<2?4:0),le(B,B.gzhead.os&255),B.gzhead.extra&&B.gzhead.extra.length&&(le(B,B.gzhead.extra.length&255),le(B,B.gzhead.extra.length>>8&255)),B.gzhead.hcrc&&(ee.adler=D(ee.adler,B.pending_buf,B.pending,0)),B.gzindex=0,B.status=pe):(le(B,0),le(B,0),le(B,0),le(B,0),le(B,0),le(B,B.level===9?2:B.strategy>=Z||B.level<2?4:0),le(B,ze),B.status=qe);else{var Ne=te+(B.w_bits-8<<4)<<8,Ze=-1;B.strategy>=Z||B.level<2?Ze=0:B.level<6?Ze=1:B.level===6?Ze=2:Ze=3,Ne|=Ze<<6,B.strstart!==0&&(Ne|=Ae),Ne+=31-Ne%31,B.status=qe,et(B,Ne),B.strstart!==0&&(et(B,ee.adler>>>16),et(B,ee.adler&65535)),ee.adler=1}if(B.status===pe)if(B.gzhead.extra){for(Q=B.pending;B.gzindex<(B.gzhead.extra.length&65535)&&!(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>Q&&(ee.adler=D(ee.adler,B.pending_buf,B.pending-Q,Q)),Oe(ee),Q=B.pending,B.pending===B.pending_buf_size));)le(B,B.gzhead.extra[B.gzindex]&255),B.gzindex++;B.gzhead.hcrc&&B.pending>Q&&(ee.adler=D(ee.adler,B.pending_buf,B.pending-Q,Q)),B.gzindex===B.gzhead.extra.length&&(B.gzindex=0,B.status=Ke)}else B.status=Ke;if(B.status===Ke)if(B.gzhead.name){Q=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>Q&&(ee.adler=D(ee.adler,B.pending_buf,B.pending-Q,Q)),Oe(ee),Q=B.pending,B.pending===B.pending_buf_size)){xe=1;break}B.gzindex<B.gzhead.name.length?xe=B.gzhead.name.charCodeAt(B.gzindex++)&255:xe=0,le(B,xe)}while(xe!==0);B.gzhead.hcrc&&B.pending>Q&&(ee.adler=D(ee.adler,B.pending_buf,B.pending-Q,Q)),xe===0&&(B.gzindex=0,B.status=_e)}else B.status=_e;if(B.status===_e)if(B.gzhead.comment){Q=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>Q&&(ee.adler=D(ee.adler,B.pending_buf,B.pending-Q,Q)),Oe(ee),Q=B.pending,B.pending===B.pending_buf_size)){xe=1;break}B.gzindex<B.gzhead.comment.length?xe=B.gzhead.comment.charCodeAt(B.gzindex++)&255:xe=0,le(B,xe)}while(xe!==0);B.gzhead.hcrc&&B.pending>Q&&(ee.adler=D(ee.adler,B.pending_buf,B.pending-Q,Q)),xe===0&&(B.status=ke)}else B.status=ke;if(B.status===ke&&(B.gzhead.hcrc?(B.pending+2>B.pending_buf_size&&Oe(ee),B.pending+2<=B.pending_buf_size&&(le(B,ee.adler&255),le(B,ee.adler>>8&255),ee.adler=0,B.status=qe)):B.status=qe),B.pending!==0){if(Oe(ee),ee.avail_out===0)return B.last_flush=-1,z}else if(ee.avail_in===0&&ve(Qe)<=ve(ie)&&Qe!==p)return de(ee,O);if(B.status===tt&&ee.avail_in!==0)return de(ee,O);if(ee.avail_in!==0||B.lookahead!==0||Qe!==E&&B.status!==tt){var ot=B.strategy===Z?br(B,Qe):B.strategy===X?Tr(B,Qe):Vr[B.level].func(B,Qe);if((ot===Je||ot===it)&&(B.status=tt),ot===Ge||ot===Je)return ee.avail_out===0&&(B.last_flush=-1),z;if(ot===We&&(Qe===m?t._tr_align(B):Qe!==C&&(t._tr_stored_block(B,0,0,!1),Qe===y&&(be(B.head),B.lookahead===0&&(B.strstart=0,B.block_start=0,B.insert=0))),Oe(ee),ee.avail_out===0))return B.last_flush=-1,z}return Qe!==p?z:B.wrap<=0?A:(B.wrap===2?(le(B,ee.adler&255),le(B,ee.adler>>8&255),le(B,ee.adler>>16&255),le(B,ee.adler>>24&255),le(B,ee.total_in&255),le(B,ee.total_in>>8&255),le(B,ee.total_in>>16&255),le(B,ee.total_in>>24&255)):(et(B,ee.adler>>>16),et(B,ee.adler&65535)),Oe(ee),B.wrap>0&&(B.wrap=-B.wrap),B.pending!==0?z:A)}function sr(ee){var Qe;return!ee||!ee.state?P:(Qe=ee.state.status,Qe!==se&&Qe!==pe&&Qe!==Ke&&Qe!==_e&&Qe!==ke&&Qe!==qe&&Qe!==tt?de(ee,P):(ee.state=null,Qe===qe?de(ee,x):z))}function Fr(ee,Qe){var ie=Qe.length,B,Q,xe,Ne,Ze,ot,mt,Nt;if(!ee||!ee.state||(B=ee.state,Ne=B.wrap,Ne===2||Ne===1&&B.status!==se||B.lookahead))return P;for(Ne===1&&(ee.adler=S(ee.adler,Qe,ie,0)),B.wrap=0,ie>=B.w_size&&(Ne===0&&(be(B.head),B.strstart=0,B.block_start=0,B.insert=0),Nt=new T.Buf8(B.w_size),T.arraySet(Nt,Qe,ie-B.w_size,B.w_size,0),Qe=Nt,ie=B.w_size),Ze=ee.avail_in,ot=ee.next_in,mt=ee.input,ee.avail_in=ie,ee.next_in=0,ee.input=Qe,Wt(B);B.lookahead>=Fe;){Q=B.strstart,xe=B.lookahead-(Fe-1);do B.ins_h=(B.ins_h<<B.hash_shift^B.window[Q+Fe-1])&B.hash_mask,B.prev[Q&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=Q,Q++;while(--xe);B.strstart=Q,B.lookahead=Fe-1,Wt(B)}return B.strstart+=B.lookahead,B.block_start=B.strstart,B.insert=B.lookahead,B.lookahead=0,B.match_length=B.prev_length=Fe-1,B.match_available=0,ee.next_in=ot,ee.input=mt,ee.avail_in=Ze,B.wrap=Ne,z}b.deflateInit=$t,b.deflateInit2=Rt,b.deflateReset=Ut,b.deflateResetKeep=St,b.deflateSetHeader=ir,b.deflate=rt,b.deflateEnd=sr,b.deflateSetDictionary=Fr,b.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":89,"./adler32":91,"./crc32":93,"./messages":99,"./trees":100}],95:[function(_,k,b){function T(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}k.exports=T},{}],96:[function(_,k,b){arguments[4][41][0].apply(b,arguments)},{dup:41}],97:[function(_,k,b){arguments[4][42][0].apply(b,arguments)},{"../utils/common":89,"./adler32":91,"./crc32":93,"./inffast":96,"./inftrees":98,dup:42}],98:[function(_,k,b){arguments[4][43][0].apply(b,arguments)},{"../utils/common":89,dup:43}],99:[function(_,k,b){arguments[4][44][0].apply(b,arguments)},{dup:44}],100:[function(_,k,b){var T=_("../utils/common"),t=4,S=0,D=1,w=2;function E(De){for(var St=De.length;--St>=0;)De[St]=0}var m=0,y=1,p=2,C=3,z=258,A=29,P=256,x=P+1+A,O=30,U=19,G=2*x+1,Z=15,X=16,W=7,J=256,re=16,te=17,ye=18,ue=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Se=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Le=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Pe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Ee=512,Me=new Array((x+2)*2);E(Me);var He=new Array(O*2);E(He);var nt=new Array(Ee);E(nt);var ht=new Array(z-C+1);E(ht);var Fe=new Array(A);E(Fe);var Ce=new Array(O);E(Ce);function Be(De,St,Ut,ir,Rt){this.static_tree=De,this.extra_bits=St,this.extra_base=Ut,this.elems=ir,this.max_length=Rt,this.has_stree=De&&De.length}var Ae,se,pe;function Ke(De,St){this.dyn_tree=De,this.max_code=0,this.stat_desc=St}function _e(De){return De<256?nt[De]:nt[256+(De>>>7)]}function ke(De,St){De.pending_buf[De.pending++]=St&255,De.pending_buf[De.pending++]=St>>>8&255}function qe(De,St,Ut){De.bi_valid>X-Ut?(De.bi_buf|=St<<De.bi_valid&65535,ke(De,De.bi_buf),De.bi_buf=St>>X-De.bi_valid,De.bi_valid+=Ut-X):(De.bi_buf|=St<<De.bi_valid&65535,De.bi_valid+=Ut)}function tt(De,St,Ut){qe(De,Ut[St*2],Ut[St*2+1])}function Ge(De,St){var Ut=0;do Ut|=De&1,De>>>=1,Ut<<=1;while(--St>0);return Ut>>>1}function We(De){De.bi_valid===16?(ke(De,De.bi_buf),De.bi_buf=0,De.bi_valid=0):De.bi_valid>=8&&(De.pending_buf[De.pending++]=De.bi_buf&255,De.bi_buf>>=8,De.bi_valid-=8)}function Je(De,St){var Ut=St.dyn_tree,ir=St.max_code,Rt=St.stat_desc.static_tree,$t=St.stat_desc.has_stree,rt=St.stat_desc.extra_bits,sr=St.stat_desc.extra_base,Fr=St.stat_desc.max_length,ee,Qe,ie,B,Q,xe,Ne=0;for(B=0;B<=Z;B++)De.bl_count[B]=0;for(Ut[De.heap[De.heap_max]*2+1]=0,ee=De.heap_max+1;ee<G;ee++)Qe=De.heap[ee],B=Ut[Ut[Qe*2+1]*2+1]+1,B>Fr&&(B=Fr,Ne++),Ut[Qe*2+1]=B,!(Qe>ir)&&(De.bl_count[B]++,Q=0,Qe>=sr&&(Q=rt[Qe-sr]),xe=Ut[Qe*2],De.opt_len+=xe*(B+Q),$t&&(De.static_len+=xe*(Rt[Qe*2+1]+Q)));if(Ne!==0){do{for(B=Fr-1;De.bl_count[B]===0;)B--;De.bl_count[B]--,De.bl_count[B+1]+=2,De.bl_count[Fr]--,Ne-=2}while(Ne>0);for(B=Fr;B!==0;B--)for(Qe=De.bl_count[B];Qe!==0;)ie=De.heap[--ee],!(ie>ir)&&(Ut[ie*2+1]!==B&&(De.opt_len+=(B-Ut[ie*2+1])*Ut[ie*2],Ut[ie*2+1]=B),Qe--)}}function it(De,St,Ut){var ir=new Array(Z+1),Rt=0,$t,rt;for($t=1;$t<=Z;$t++)ir[$t]=Rt=Rt+Ut[$t-1]<<1;for(rt=0;rt<=St;rt++){var sr=De[rt*2+1];sr!==0&&(De[rt*2]=Ge(ir[sr]++,sr))}}function ze(){var De,St,Ut,ir,Rt,$t=new Array(Z+1);for(Ut=0,ir=0;ir<A-1;ir++)for(Fe[ir]=Ut,De=0;De<1<<ue[ir];De++)ht[Ut++]=ir;for(ht[Ut-1]=ir,Rt=0,ir=0;ir<16;ir++)for(Ce[ir]=Rt,De=0;De<1<<Se[ir];De++)nt[Rt++]=ir;for(Rt>>=7;ir<O;ir++)for(Ce[ir]=Rt<<7,De=0;De<1<<Se[ir]-7;De++)nt[256+Rt++]=ir;for(St=0;St<=Z;St++)$t[St]=0;for(De=0;De<=143;)Me[De*2+1]=8,De++,$t[8]++;for(;De<=255;)Me[De*2+1]=9,De++,$t[9]++;for(;De<=279;)Me[De*2+1]=7,De++,$t[7]++;for(;De<=287;)Me[De*2+1]=8,De++,$t[8]++;for(it(Me,x+1,$t),De=0;De<O;De++)He[De*2+1]=5,He[De*2]=Ge(De,5);Ae=new Be(Me,ue,P+1,x,Z),se=new Be(He,Se,0,O,Z),pe=new Be(new Array(0),Le,0,U,W)}function de(De){var St;for(St=0;St<x;St++)De.dyn_ltree[St*2]=0;for(St=0;St<O;St++)De.dyn_dtree[St*2]=0;for(St=0;St<U;St++)De.bl_tree[St*2]=0;De.dyn_ltree[J*2]=1,De.opt_len=De.static_len=0,De.last_lit=De.matches=0}function ve(De){De.bi_valid>8?ke(De,De.bi_buf):De.bi_valid>0&&(De.pending_buf[De.pending++]=De.bi_buf),De.bi_buf=0,De.bi_valid=0}function be(De,St,Ut,ir){ve(De),ke(De,Ut),ke(De,~Ut),T.arraySet(De.pending_buf,De.window,St,Ut,De.pending),De.pending+=Ut}function Oe(De,St,Ut,ir){var Rt=St*2,$t=Ut*2;return De[Rt]<De[$t]||De[Rt]===De[$t]&&ir[St]<=ir[Ut]}function ge(De,St,Ut){for(var ir=De.heap[Ut],Rt=Ut<<1;Rt<=De.heap_len&&(Rt<De.heap_len&&Oe(St,De.heap[Rt+1],De.heap[Rt],De.depth)&&Rt++,!Oe(St,ir,De.heap[Rt],De.depth));)De.heap[Ut]=De.heap[Rt],Ut=Rt,Rt<<=1;De.heap[Ut]=ir}function le(De,St,Ut){var ir,Rt,$t=0,rt,sr;if(De.last_lit!==0)do ir=De.pending_buf[De.d_buf+$t*2]<<8|De.pending_buf[De.d_buf+$t*2+1],Rt=De.pending_buf[De.l_buf+$t],$t++,ir===0?tt(De,Rt,St):(rt=ht[Rt],tt(De,rt+P+1,St),sr=ue[rt],sr!==0&&(Rt-=Fe[rt],qe(De,Rt,sr)),ir--,rt=_e(ir),tt(De,rt,Ut),sr=Se[rt],sr!==0&&(ir-=Ce[rt],qe(De,ir,sr)));while($t<De.last_lit);tt(De,J,St)}function et(De,St){var Ut=St.dyn_tree,ir=St.stat_desc.static_tree,Rt=St.stat_desc.has_stree,$t=St.stat_desc.elems,rt,sr,Fr=-1,ee;for(De.heap_len=0,De.heap_max=G,rt=0;rt<$t;rt++)Ut[rt*2]!==0?(De.heap[++De.heap_len]=Fr=rt,De.depth[rt]=0):Ut[rt*2+1]=0;for(;De.heap_len<2;)ee=De.heap[++De.heap_len]=Fr<2?++Fr:0,Ut[ee*2]=1,De.depth[ee]=0,De.opt_len--,Rt&&(De.static_len-=ir[ee*2+1]);for(St.max_code=Fr,rt=De.heap_len>>1;rt>=1;rt--)ge(De,Ut,rt);ee=$t;do rt=De.heap[1],De.heap[1]=De.heap[De.heap_len--],ge(De,Ut,1),sr=De.heap[1],De.heap[--De.heap_max]=rt,De.heap[--De.heap_max]=sr,Ut[ee*2]=Ut[rt*2]+Ut[sr*2],De.depth[ee]=(De.depth[rt]>=De.depth[sr]?De.depth[rt]:De.depth[sr])+1,Ut[rt*2+1]=Ut[sr*2+1]=ee,De.heap[1]=ee++,ge(De,Ut,1);while(De.heap_len>=2);De.heap[--De.heap_max]=De.heap[1],Je(De,St),it(Ut,Fr,De.bl_count)}function wt(De,St,Ut){var ir,Rt=-1,$t,rt=St[0*2+1],sr=0,Fr=7,ee=4;for(rt===0&&(Fr=138,ee=3),St[(Ut+1)*2+1]=65535,ir=0;ir<=Ut;ir++)$t=rt,rt=St[(ir+1)*2+1],!(++sr<Fr&&$t===rt)&&(sr<ee?De.bl_tree[$t*2]+=sr:$t!==0?($t!==Rt&&De.bl_tree[$t*2]++,De.bl_tree[re*2]++):sr<=10?De.bl_tree[te*2]++:De.bl_tree[ye*2]++,sr=0,Rt=$t,rt===0?(Fr=138,ee=3):$t===rt?(Fr=6,ee=3):(Fr=7,ee=4))}function Ft(De,St,Ut){var ir,Rt=-1,$t,rt=St[0*2+1],sr=0,Fr=7,ee=4;for(rt===0&&(Fr=138,ee=3),ir=0;ir<=Ut;ir++)if($t=rt,rt=St[(ir+1)*2+1],!(++sr<Fr&&$t===rt)){if(sr<ee)do tt(De,$t,De.bl_tree);while(--sr!==0);else $t!==0?($t!==Rt&&(tt(De,$t,De.bl_tree),sr--),tt(De,re,De.bl_tree),qe(De,sr-3,2)):sr<=10?(tt(De,te,De.bl_tree),qe(De,sr-3,3)):(tt(De,ye,De.bl_tree),qe(De,sr-11,7));sr=0,Rt=$t,rt===0?(Fr=138,ee=3):$t===rt?(Fr=6,ee=3):(Fr=7,ee=4)}}function Wt(De){var St;for(wt(De,De.dyn_ltree,De.l_desc.max_code),wt(De,De.dyn_dtree,De.d_desc.max_code),et(De,De.bl_desc),St=U-1;St>=3&&De.bl_tree[Pe[St]*2+1]===0;St--);return De.opt_len+=3*(St+1)+5+5+4,St}function or(De,St,Ut,ir){var Rt;for(qe(De,St-257,5),qe(De,Ut-1,5),qe(De,ir-4,4),Rt=0;Rt<ir;Rt++)qe(De,De.bl_tree[Pe[Rt]*2+1],3);Ft(De,De.dyn_ltree,St-1),Ft(De,De.dyn_dtree,Ut-1)}function Or(De){var St=4093624447,Ut;for(Ut=0;Ut<=31;Ut++,St>>>=1)if(St&1&&De.dyn_ltree[Ut*2]!==0)return S;if(De.dyn_ltree[9*2]!==0||De.dyn_ltree[10*2]!==0||De.dyn_ltree[13*2]!==0)return D;for(Ut=32;Ut<P;Ut++)if(De.dyn_ltree[Ut*2]!==0)return D;return S}var xr=!1;function Tr(De){xr||(ze(),xr=!0),De.l_desc=new Ke(De.dyn_ltree,Ae),De.d_desc=new Ke(De.dyn_dtree,se),De.bl_desc=new Ke(De.bl_tree,pe),De.bi_buf=0,De.bi_valid=0,de(De)}function br(De,St,Ut,ir){qe(De,(m<<1)+(ir?1:0),3),be(De,St,Ut)}function fr(De){qe(De,y<<1,3),tt(De,J,Me),We(De)}function Vr(De,St,Ut,ir){var Rt,$t,rt=0;De.level>0?(De.strm.data_type===w&&(De.strm.data_type=Or(De)),et(De,De.l_desc),et(De,De.d_desc),rt=Wt(De),Rt=De.opt_len+3+7>>>3,$t=De.static_len+3+7>>>3,$t<=Rt&&(Rt=$t)):Rt=$t=Ut+5,Ut+4<=Rt&&St!==-1?br(De,St,Ut,ir):De.strategy===t||$t===Rt?(qe(De,(y<<1)+(ir?1:0),3),le(De,Me,He)):(qe(De,(p<<1)+(ir?1:0),3),or(De,De.l_desc.max_code+1,De.d_desc.max_code+1,rt+1),le(De,De.dyn_ltree,De.dyn_dtree)),de(De),ir&&ve(De)}function Ir(De,St,Ut){return De.pending_buf[De.d_buf+De.last_lit*2]=St>>>8&255,De.pending_buf[De.d_buf+De.last_lit*2+1]=St&255,De.pending_buf[De.l_buf+De.last_lit]=Ut&255,De.last_lit++,St===0?De.dyn_ltree[Ut*2]++:(De.matches++,St--,De.dyn_ltree[(ht[Ut]+P+1)*2]++,De.dyn_dtree[_e(St)*2]++),De.last_lit===De.lit_bufsize-1}b._tr_init=Tr,b._tr_stored_block=br,b._tr_flush_block=Vr,b._tr_tally=Ir,b._tr_align=fr},{"../utils/common":89}],101:[function(_,k,b){arguments[4][46][0].apply(b,arguments)},{dup:46}],102:[function(_,k,b){k.exports=function(w){if(!w)throw new Error("no data provided");w=w.toString().trim();var E={pages:[],chars:[],kernings:[]},m=w.split(/\r\n?|\n/g);if(m.length===0)throw new Error("no data in BMFont file");for(var y=0;y<m.length;y++){var p=T(m[y],y);if(p)if(p.key==="page"){if(typeof p.data.id!="number")throw new Error("malformed file at line "+y+" -- needs page id=N");if(typeof p.data.file!="string")throw new Error("malformed file at line "+y+' -- needs page file="path"');E.pages[p.data.id]=p.data.file}else p.key==="chars"||p.key==="kernings"||(p.key==="char"?E.chars.push(p.data):p.key==="kerning"?E.kernings.push(p.data):E[p.key]=p.data)}return E};function T(D,w){if(D=D.replace(/\t+/g," ").trim(),!D)return null;var E=D.indexOf(" ");if(E===-1)throw new Error("no named row at line "+w);var m=D.substring(0,E);D=D.substring(E+1),D=D.replace(/letter=[\'\"]\S+[\'\"]/gi,""),D=D.split("="),D=D.map(function(A){return A.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)});for(var y=[],p=0;p<D.length;p++){var C=D[p];p===0?y.push({key:C[0],data:""}):p===D.length-1?y[y.length-1].data=t(C[0]):(y[y.length-1].data=t(C[0]),y.push({key:C[1],data:""}))}var z={key:m,data:{}};return y.forEach(function(A){z.data[A.key]=A.data}),z}function t(D){return!D||D.length===0?"":D.indexOf('"')===0||D.indexOf("'")===0?D.substring(1,D.length-1):D.indexOf(",")!==-1?S(D):parseInt(D,10)}function S(D){return D.split(",").map(function(w){return parseInt(w,10)})}},{}],103:[function(_,k,b){var T=[66,77,70];k.exports=function(z){if(z.length<6)throw new Error("invalid buffer length for BMFont");var A=T.every(function(G,Z){return z.readUInt8(Z)===G});if(!A)throw new Error("BMFont missing BMF byte header");var P=3,x=z.readUInt8(P++);if(x>3)throw new Error("Only supports BMFont Binary v3 (BMFont App v1.10)");for(var O={kernings:[],chars:[]},U=0;U<5;U++)P+=t(O,z,P);return O};function t(C,z,A){if(A>z.length-1)return 0;var P=z.readUInt8(A++),x=z.readInt32LE(A);switch(A+=4,P){case 1:C.info=S(z,A);break;case 2:C.common=D(z,A);break;case 3:C.pages=w(z,A,x);break;case 4:C.chars=E(z,A,x);break;case 5:C.kernings=m(z,A,x);break}return 5+x}function S(C,z){var A={};A.size=C.readInt16LE(z);var P=C.readUInt8(z+2);return A.smooth=P>>7&1,A.unicode=P>>6&1,A.italic=P>>5&1,A.bold=P>>4&1,P>>3&1&&(A.fixedHeight=1),A.charset=C.readUInt8(z+3)||"",A.stretchH=C.readUInt16LE(z+4),A.aa=C.readUInt8(z+6),A.padding=[C.readInt8(z+7),C.readInt8(z+8),C.readInt8(z+9),C.readInt8(z+10)],A.spacing=[C.readInt8(z+11),C.readInt8(z+12)],A.outline=C.readUInt8(z+13),A.face=p(C,z+14),A}function D(C,z){var A={};return A.lineHeight=C.readUInt16LE(z),A.base=C.readUInt16LE(z+2),A.scaleW=C.readUInt16LE(z+4),A.scaleH=C.readUInt16LE(z+6),A.pages=C.readUInt16LE(z+8),C.readUInt8(z+10),A.packed=0,A.alphaChnl=C.readUInt8(z+11),A.redChnl=C.readUInt8(z+12),A.greenChnl=C.readUInt8(z+13),A.blueChnl=C.readUInt8(z+14),A}function w(C,z,A){for(var P=[],x=y(C,z),O=x.length+1,U=A/O,G=0;G<U;G++)P[G]=C.slice(z,z+x.length).toString("utf8"),z+=O;return P}function E(C,z,A){for(var P=[],x=A/20,O=0;O<x;O++){var U={},G=O*20;U.id=C.readUInt32LE(z+0+G),U.x=C.readUInt16LE(z+4+G),U.y=C.readUInt16LE(z+6+G),U.width=C.readUInt16LE(z+8+G),U.height=C.readUInt16LE(z+10+G),U.xoffset=C.readInt16LE(z+12+G),U.yoffset=C.readInt16LE(z+14+G),U.xadvance=C.readInt16LE(z+16+G),U.page=C.readUInt8(z+18+G),U.chnl=C.readUInt8(z+19+G),P[O]=U}return P}function m(C,z,A){for(var P=[],x=A/10,O=0;O<x;O++){var U={},G=O*10;U.first=C.readUInt32LE(z+0+G),U.second=C.readUInt32LE(z+4+G),U.amount=C.readInt16LE(z+8+G),P[O]=U}return P}function y(C,z){for(var A=z;A<C.length&&C[A]!==0;A++);return C.slice(z,A)}function p(C,z){return y(C,z).toString("utf8")}},{}],104:[function(_,k,b){var T=_("./parse-attribs"),t=_("xml-parse-from-string"),S={scaleh:"scaleH",scalew:"scaleW",stretchh:"stretchH",lineheight:"lineHeight",alphachnl:"alphaChnl",redchnl:"redChnl",greenchnl:"greenChnl",bluechnl:"blueChnl"};k.exports=function(y){y=y.toString();var p=t(y),C={pages:[],chars:[],kernings:[]};["info","common"].forEach(function(G){var Z=p.getElementsByTagName(G)[0];Z&&(C[G]=T(D(Z)))});var z=p.getElementsByTagName("pages")[0];if(!z)throw new Error("malformed file -- no <pages> element");for(var A=z.getElementsByTagName("page"),P=0;P<A.length;P++){var x=A[P],O=parseInt(x.getAttribute("id"),10),U=x.getAttribute("file");if(isNaN(O))throw new Error('malformed file -- page "id" attribute is NaN');if(!U)throw new Error('malformed file -- needs page "file" attribute');C.pages[parseInt(O,10)]=U}return["chars","kernings"].forEach(function(G){var Z=p.getElementsByTagName(G)[0];if(Z)for(var X=G.substring(0,G.length-1),W=Z.getElementsByTagName(X),J=0;J<W.length;J++){var re=W[J];C[G].push(T(D(re)))}}),C};function D(m){var y=w(m);return y.reduce(function(p,C){var z=E(C.nodeName);return p[z]=C.nodeValue,p},{})}function w(m){for(var y=[],p=0;p<m.attributes.length;p++)y.push(m.attributes[p]);return y}function E(m){return S[m.toLowerCase()]||m}},{"./parse-attribs":105,"xml-parse-from-string":188}],105:[function(_,k,b){var T="chasrset";k.exports=function(D){T in D&&(D.charset=D[T],delete D[T]);for(var w in D)w==="face"||w==="charset"||(w==="padding"||w==="spacing"?D[w]=t(D[w]):D[w]=parseInt(D[w],10));return D};function t(S){return S.split(",").map(function(D){return parseInt(D,10)})}},{}],106:[function(_,k,b){var T=_("trim"),t=_("for-each"),S=function(D){return Object.prototype.toString.call(D)==="[object Array]"};k.exports=function(D){if(!D)return{};var w={};return t(T(D).split(`
`),function(E){var m=E.indexOf(":"),y=T(E.slice(0,m)).toLowerCase(),p=T(E.slice(m+1));typeof w[y]>"u"?w[y]=p:S(w[y])?w[y].push(p):w[y]=[w[y],p]}),w}},{"for-each":63,trim:179}],107:[function(_,k,b){(function(T){function t(E,m){for(var y=0,p=E.length-1;p>=0;p--){var C=E[p];C==="."?E.splice(p,1):C===".."?(E.splice(p,1),y++):y&&(E.splice(p,1),y--)}if(m)for(;y--;y)E.unshift("..");return E}b.resolve=function(){for(var E="",m=!1,y=arguments.length-1;y>=-1&&!m;y--){var p=y>=0?arguments[y]:T.cwd();if(typeof p!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!p)continue;E=p+"/"+E,m=p.charAt(0)==="/"}return E=t(D(E.split("/"),function(C){return!!C}),!m).join("/"),(m?"/":"")+E||"."},b.normalize=function(E){var m=b.isAbsolute(E),y=w(E,-1)==="/";return E=t(D(E.split("/"),function(p){return!!p}),!m).join("/"),!E&&!m&&(E="."),E&&y&&(E+="/"),(m?"/":"")+E},b.isAbsolute=function(E){return E.charAt(0)==="/"},b.join=function(){var E=Array.prototype.slice.call(arguments,0);return b.normalize(D(E,function(m,y){if(typeof m!="string")throw new TypeError("Arguments to path.join must be strings");return m}).join("/"))},b.relative=function(E,m){E=b.resolve(E).substr(1),m=b.resolve(m).substr(1);function y(O){for(var U=0;U<O.length&&O[U]==="";U++);for(var G=O.length-1;G>=0&&O[G]==="";G--);return U>G?[]:O.slice(U,G-U+1)}for(var p=y(E.split("/")),C=y(m.split("/")),z=Math.min(p.length,C.length),A=z,P=0;P<z;P++)if(p[P]!==C[P]){A=P;break}for(var x=[],P=A;P<p.length;P++)x.push("..");return x=x.concat(C.slice(A)),x.join("/")},b.sep="/",b.delimiter=":",b.dirname=function(E){if(typeof E!="string"&&(E=E+""),E.length===0)return".";for(var m=E.charCodeAt(0),y=m===47,p=-1,C=!0,z=E.length-1;z>=1;--z)if(m=E.charCodeAt(z),m===47){if(!C){p=z;break}}else C=!1;return p===-1?y?"/":".":y&&p===1?"/":E.slice(0,p)};function S(E){typeof E!="string"&&(E=E+"");var m=0,y=-1,p=!0,C;for(C=E.length-1;C>=0;--C)if(E.charCodeAt(C)===47){if(!p){m=C+1;break}}else y===-1&&(p=!1,y=C+1);return y===-1?"":E.slice(m,y)}b.basename=function(E,m){var y=S(E);return m&&y.substr(-1*m.length)===m&&(y=y.substr(0,y.length-m.length)),y},b.extname=function(E){typeof E!="string"&&(E=E+"");for(var m=-1,y=0,p=-1,C=!0,z=0,A=E.length-1;A>=0;--A){var P=E.charCodeAt(A);if(P===47){if(!C){y=A+1;break}continue}p===-1&&(C=!1,p=A+1),P===46?m===-1?m=A:z!==1&&(z=1):m!==-1&&(z=-1)}return m===-1||p===-1||z===0||z===1&&m===p-1&&m===y+1?"":E.slice(m,p)};function D(E,m){if(E.filter)return E.filter(m);for(var y=[],p=0;p<E.length;p++)m(E[p],p,E)&&y.push(E[p]);return y}var w="ab".substr(-1)==="b"?function(E,m,y){return E.substr(m,y)}:function(E,m,y){return m<0&&(m=E.length+m),E.substr(m,y)}}).call(this,_("_process"))},{_process:133}],108:[function(_,k,b){(function(T){var t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},S=_("http"),D=_("https"),w=_("url"),E=_("querystring"),m=_("zlib"),y=_("util"),p=function(z,A){if(typeof z!="string"&&!z.hasOwnProperty("url"))throw new Error("Missing url option from options for request method.");var P=(typeof z>"u"?"undefined":t(z))==="object"?w.parse(z.url):w.parse(z),x={hostname:P.hostname,port:P.port||(P.protocol.toLowerCase()==="http:"?80:443),path:P.path,method:"GET",headers:{},auth:P.auth||null,parse:"none",stream:!1};if((typeof z>"u"?"undefined":t(z))==="object"&&(x=Object.assign(x,z)),x.port=Number(x.port),x.hasOwnProperty("timeout")&&delete x.timeout,x.compressed===!0&&(x.headers["accept-encoding"]="gzip, deflate"),z.hasOwnProperty("form")){if(t(z.form)!=="object")throw new Error("phin 'form' option must be of type Object if present.");var O=E.stringify(z.form);x.headers["Content-Type"]="application/x-www-form-urlencoded",x.headers["Content-Length"]=T.byteLength(O),z.data=O}var U=void 0,G=function(J){var re=J;x.compressed===!0&&(J.headers["content-encoding"]==="gzip"?re=J.pipe(m.createGunzip()):J.headers["content-encoding"]==="deflate"&&(re=J.pipe(m.createInflate()))),x.stream===!0?(J.stream=re,A(null,J)):(J.body=new T([]),re.on("data",function(te){J.body=T.concat([J.body,te])}),re.on("end",function(){if(A){if(x.parse==="json")try{J.body=JSON.parse(J.body.toString())}catch{A("Invalid JSON received.",J);return}A(null,J)}}))};switch(P.protocol.toLowerCase()){case"http:":U=S.request(x,G);break;case"https:":U=D.request(x,G);break;default:A&&A(new Error("Invalid / unknown URL protocol. Expected HTTP or HTTPS."),null);return}if(typeof z.timeout=="number"&&U.setTimeout(z.timeout,function(){U.abort(),A(new Error("Timeout has been reached."),null),A=null}),U.on("error",function(W){A&&A(W,null)}),z.hasOwnProperty("data")){var Z=z.data;if(!(z.data instanceof T)&&t(z.data)==="object"){var X=x.headers["content-type"]||x.headers["Content-Type"];if(X==="application/x-www-form-urlencoded")Z=E.stringify(z.data);else try{Z=JSON.stringify(z.data)}catch{A(new Error("Couldn't stringify object. (Likely due to a circular reference.)"),null)}}U.write(Z)}U.end()};p.promisified=function(C,z){return new Promise(function(A,P){p(C,function(x,O){x?P(x):A(O)})})},y.promisify&&(p[y.promisify.custom]=p.promisified),k.exports=p}).call(this,_("buffer").Buffer)},{buffer:48,http:156,https:72,querystring:137,url:180,util:186,zlib:35}],109:[function(_,k,b){k.exports=T;function T(C,z,A,P,x,O){O||(O={});for(var U=O.threshold===void 0?.1:O.threshold,G=35215*U*U,Z=0,X=0;X<x;X++)for(var W=0;W<P;W++){var J=(X*P+W)*4,re=S(C,z,J,J);if(re>G)!O.includeAA&&(t(C,W,X,P,x,z)||t(z,W,X,P,x,C))?A&&y(A,J,255,255,0):(A&&y(A,J,255,0,0),Z++);else if(A){var te=m(p(C,J),.1);y(A,J,te,te,te)}}return Z}function t(C,z,A,P,x,O){for(var U=Math.max(z-1,0),G=Math.max(A-1,0),Z=Math.min(z+1,P-1),X=Math.min(A+1,x-1),W=(A*P+z)*4,J=0,re=0,te=0,ye=0,ue=0,Se,Le,Pe,Ee,Me=U;Me<=Z;Me++)for(var He=G;He<=X;He++)if(!(Me===z&&He===A)){var nt=S(C,C,W,(He*P+Me)*4,!0);if(nt===0?J++:nt<0?te++:nt>0&&re++,J>2)return!1;O&&(nt<ye&&(ye=nt,Se=Me,Le=He),nt>ue&&(ue=nt,Pe=Me,Ee=He))}return O?te===0||re===0?!1:!t(C,Se,Le,P,x)&&!t(O,Se,Le,P,x)||!t(C,Pe,Ee,P,x)&&!t(O,Pe,Ee,P,x):!0}function S(C,z,A,P,x){var O=C[A+3]/255,U=z[P+3]/255,G=m(C[A+0],O),Z=m(C[A+1],O),X=m(C[A+2],O),W=m(z[P+0],U),J=m(z[P+1],U),re=m(z[P+2],U),te=D(G,Z,X)-D(W,J,re);if(x)return te;var ye=w(G,Z,X)-w(W,J,re),ue=E(G,Z,X)-E(W,J,re);return .5053*te*te+.299*ye*ye+.1957*ue*ue}function D(C,z,A){return C*.29889531+z*.58662247+A*.11448223}function w(C,z,A){return C*.59597799-z*.2741761-A*.32180189}function E(C,z,A){return C*.21147017-z*.52261711+A*.31114694}function m(C,z){return 255+(C-255)*z}function y(C,z,A,P,x){C[z+0]=A,C[z+1]=P,C[z+2]=x,C[z+3]=255}function p(C,z){var A=C[z+3]/255,P=m(C[z+0],A),x=m(C[z+1],A),O=m(C[z+2],A);return D(P,x,O)}},{}],110:[function(_,k,b){(function(T){var t=_("./interlace"),S={1:{0:0,1:0,2:0,3:255},2:{0:0,1:0,2:0,3:1},3:{0:0,1:1,2:2,3:255},4:{0:0,1:1,2:2,3:3}};function D(m,y){var p=[],C=0;function z(){if(C===m.length)throw new Error("Ran out of data");var A=m[C];C++;var P,x,O,U,G,Z,X,W;switch(y){default:throw new Error("unrecognised depth");case 16:X=m[C],C++,p.push((A<<8)+X);break;case 4:X=A&15,W=A>>4,p.push(W,X);break;case 2:G=A&3,Z=A>>2&3,X=A>>4&3,W=A>>6&3,p.push(W,X,Z,G);break;case 1:P=A&1,x=A>>1&1,O=A>>2&1,U=A>>3&1,G=A>>4&1,Z=A>>5&1,X=A>>6&1,W=A>>7&1,p.push(W,X,Z,G,U,O,x,P);break}}return{get:function(A){for(;p.length<A;)z();var P=p.slice(0,A);return p=p.slice(A),P},resetAfterLine:function(){p.length=0},end:function(){if(C!==m.length)throw new Error("extra data found")}}}function w(m,y,p,C,z,A){for(var P=m.width,x=m.height,O=m.index,U=0;U<x;U++)for(var G=0;G<P;G++){for(var Z=p(G,U,O),X=0;X<4;X++){var W=S[C][X];if(W===255)y[Z+X]=255;else{var J=W+A;if(J===z.length)throw new Error("Ran out of data");y[Z+X]=z[J]}}A+=C}return A}function E(m,y,p,C,z,A){for(var P=m.width,x=m.height,O=m.index,U=0;U<x;U++){for(var G=0;G<P;G++)for(var Z=z.get(C),X=p(G,U,O),W=0;W<4;W++){var J=S[C][W];y[X+W]=J!==255?Z[J]:A}z.resetAfterLine()}}b.dataToBitMap=function(m,y){var p=y.width,C=y.height,z=y.depth,A=y.bpp,P=y.interlace;if(z!==8)var x=D(m,z);var O;z<=8?O=new T(p*C*4):O=new Uint16Array(p*C*4);var U=Math.pow(2,z)-1,G=0,Z,X;if(P)Z=t.getImagePasses(p,C),X=t.getInterlaceIterator(p,C);else{var W=0;X=function(){var re=W;return W+=4,re},Z=[{width:p,height:C}]}for(var J=0;J<Z.length;J++)z===8?G=w(Z[J],O,X,A,m,G):E(Z[J],O,X,A,x,U);if(z===8){if(G!==m.length)throw new Error("extra data found")}else x.end();return O}}).call(this,_("buffer").Buffer)},{"./interlace":120,buffer:48}],111:[function(_,k,b){(function(T){var t=_("./constants");k.exports=function(S,D,w,E){var m=[t.COLORTYPE_COLOR_ALPHA,t.COLORTYPE_ALPHA].indexOf(E.colorType)!==-1;if(E.colorType===E.inputColorType){var y=function(){var re=new ArrayBuffer(2);return new DataView(re).setInt16(0,256,!0),new Int16Array(re)[0]!==256}();if(E.bitDepth===8||E.bitDepth===16&&y)return S}var p=E.bitDepth!==16?S:new Uint16Array(S.buffer),C=255,z=t.COLORTYPE_TO_BPP_MAP[E.inputColorType];z==4&&!E.inputHasAlpha&&(z=3);var A=t.COLORTYPE_TO_BPP_MAP[E.colorType];E.bitDepth===16&&(C=65535,A*=2);var P=new T(D*w*A),x=0,O=0,U=E.bgColor||{};U.red===void 0&&(U.red=C),U.green===void 0&&(U.green=C),U.blue===void 0&&(U.blue=C);function G(re,te){var ye,ue,Se,Le=C;switch(E.inputColorType){case t.COLORTYPE_COLOR_ALPHA:Le=re[te+3],ye=re[te],ue=re[te+1],Se=re[te+2];break;case t.COLORTYPE_COLOR:ye=re[te],ue=re[te+1],Se=re[te+2];break;case t.COLORTYPE_ALPHA:Le=re[te+1],ye=re[te],ue=ye,Se=ye;break;case t.COLORTYPE_GRAYSCALE:ye=re[te],ue=ye,Se=ye;break;default:throw new Error("input color type:"+E.inputColorType+" is not supported at present")}return E.inputHasAlpha&&(m||(Le/=C,ye=Math.min(Math.max(Math.round((1-Le)*U.red+Le*ye),0),C),ue=Math.min(Math.max(Math.round((1-Le)*U.green+Le*ue),0),C),Se=Math.min(Math.max(Math.round((1-Le)*U.blue+Le*Se),0),C))),{red:ye,green:ue,blue:Se,alpha:Le}}for(var Z=0;Z<w;Z++)for(var X=0;X<D;X++){var W=G(p,x);switch(E.colorType){case t.COLORTYPE_COLOR_ALPHA:case t.COLORTYPE_COLOR:E.bitDepth===8?(P[O]=W.red,P[O+1]=W.green,P[O+2]=W.blue,m&&(P[O+3]=W.alpha)):(P.writeUInt16BE(W.red,O),P.writeUInt16BE(W.green,O+2),P.writeUInt16BE(W.blue,O+4),m&&P.writeUInt16BE(W.alpha,O+6));break;case t.COLORTYPE_ALPHA:case t.COLORTYPE_GRAYSCALE:var J=(W.red+W.green+W.blue)/3;E.bitDepth===8?(P[O]=J,m&&(P[O+1]=W.alpha)):(P.writeUInt16BE(J,O),m&&P.writeUInt16BE(W.alpha,O+2));break}x+=z,O+=A}return P}}).call(this,_("buffer").Buffer)},{"./constants":113,buffer:48}],112:[function(_,k,b){(function(T,t){var S=_("util"),D=_("stream"),w=k.exports=function(){D.call(this),this._buffers=[],this._buffered=0,this._reads=[],this._paused=!1,this._encoding="utf8",this.writable=!0};S.inherits(w,D),w.prototype.read=function(E,m){this._reads.push({length:Math.abs(E),allowLess:E<0,func:m}),T.nextTick(function(){this._process(),this._paused&&this._reads.length>0&&(this._paused=!1,this.emit("drain"))}.bind(this))},w.prototype.write=function(E,m){if(!this.writable)return this.emit("error",new Error("Stream not writable")),!1;var y;return t.isBuffer(E)?y=E:y=new t(E,m||this._encoding),this._buffers.push(y),this._buffered+=y.length,this._process(),this._reads&&this._reads.length===0&&(this._paused=!0),this.writable&&!this._paused},w.prototype.end=function(E,m){E&&this.write(E,m),this.writable=!1,this._buffers&&(this._buffers.length===0?this._end():(this._buffers.push(null),this._process()))},w.prototype.destroySoon=w.prototype.end,w.prototype._end=function(){this._reads.length>0&&this.emit("error",new Error("There are some read requests waiting on finished stream")),this.destroy()},w.prototype.destroy=function(){this._buffers&&(this.writable=!1,this._reads=null,this._buffers=null,this.emit("close"))},w.prototype._processReadAllowingLess=function(E){this._reads.shift();var m=this._buffers[0];m.length>E.length?(this._buffered-=E.length,this._buffers[0]=m.slice(E.length),E.func.call(this,m.slice(0,E.length))):(this._buffered-=m.length,this._buffers.shift(),E.func.call(this,m))},w.prototype._processRead=function(E){this._reads.shift();for(var m=0,y=0,p=new t(E.length);m<E.length;){var C=this._buffers[y++],z=Math.min(C.length,E.length-m);C.copy(p,m,0,z),m+=z,z!==C.length&&(this._buffers[--y]=C.slice(z))}y>0&&this._buffers.splice(0,y),this._buffered-=E.length,E.func.call(this,p)},w.prototype._process=function(){try{for(;this._buffered>0&&this._reads&&this._reads.length>0;){var E=this._reads[0];if(E.allowLess)this._processReadAllowingLess(E);else if(this._buffered>=E.length)this._processRead(E);else break}this._buffers&&this._buffers.length>0&&this._buffers[0]===null&&this._end()}catch(m){this.emit("error",m)}}}).call(this,_("_process"),_("buffer").Buffer)},{_process:133,buffer:48,stream:155,util:186}],113:[function(_,k,b){k.exports={PNG_SIGNATURE:[137,80,78,71,13,10,26,10],TYPE_IHDR:1229472850,TYPE_IEND:1229278788,TYPE_IDAT:1229209940,TYPE_PLTE:1347179589,TYPE_tRNS:1951551059,TYPE_gAMA:1732332865,COLORTYPE_GRAYSCALE:0,COLORTYPE_PALETTE:1,COLORTYPE_COLOR:2,COLORTYPE_ALPHA:4,COLORTYPE_PALETTE_COLOR:3,COLORTYPE_COLOR_ALPHA:6,COLORTYPE_TO_BPP_MAP:{0:1,2:3,3:1,4:2,6:4},GAMMA_DIVISION:1e5}},{}],114:[function(_,k,b){var T=[];(function(){for(var S=0;S<256;S++){for(var D=S,w=0;w<8;w++)D&1?D=3988292384^D>>>1:D=D>>>1;T[S]=D}})();var t=k.exports=function(){this._crc=-1};t.prototype.write=function(S){for(var D=0;D<S.length;D++)this._crc=T[(this._crc^S[D])&255]^this._crc>>>8;return!0},t.prototype.crc32=function(){return this._crc^-1},t.crc32=function(S){for(var D=-1,w=0;w<S.length;w++)D=T[(D^S[w])&255]^D>>>8;return D^-1}},{}],115:[function(_,k,b){(function(T){var t=_("./paeth-predictor");function S(O,U,G,Z,X){for(var W=0;W<G;W++)Z[X+W]=O[U+W]}function D(O,U,G){for(var Z=0,X=U+G,W=U;W<X;W++)Z+=Math.abs(O[W]);return Z}function w(O,U,G,Z,X,W){for(var J=0;J<G;J++){var re=J>=W?O[U+J-W]:0,te=O[U+J]-re;Z[X+J]=te}}function E(O,U,G,Z){for(var X=0,W=0;W<G;W++){var J=W>=Z?O[U+W-Z]:0,re=O[U+W]-J;X+=Math.abs(re)}return X}function m(O,U,G,Z,X){for(var W=0;W<G;W++){var J=U>0?O[U+W-G]:0,re=O[U+W]-J;Z[X+W]=re}}function y(O,U,G){for(var Z=0,X=U+G,W=U;W<X;W++){var J=U>0?O[W-G]:0,re=O[W]-J;Z+=Math.abs(re)}return Z}function p(O,U,G,Z,X,W){for(var J=0;J<G;J++){var re=J>=W?O[U+J-W]:0,te=U>0?O[U+J-G]:0,ye=O[U+J]-(re+te>>1);Z[X+J]=ye}}function C(O,U,G,Z){for(var X=0,W=0;W<G;W++){var J=W>=Z?O[U+W-Z]:0,re=U>0?O[U+W-G]:0,te=O[U+W]-(J+re>>1);X+=Math.abs(te)}return X}function z(O,U,G,Z,X,W){for(var J=0;J<G;J++){var re=J>=W?O[U+J-W]:0,te=U>0?O[U+J-G]:0,ye=U>0&&J>=W?O[U+J-(G+W)]:0,ue=O[U+J]-t(re,te,ye);Z[X+J]=ue}}function A(O,U,G,Z){for(var X=0,W=0;W<G;W++){var J=W>=Z?O[U+W-Z]:0,re=U>0?O[U+W-G]:0,te=U>0&&W>=Z?O[U+W-(G+Z)]:0,ye=O[U+W]-t(J,re,te);X+=Math.abs(ye)}return X}var P={0:S,1:w,2:m,3:p,4:z},x={0:D,1:E,2:y,3:C,4:A};k.exports=function(O,U,G,Z,X){var W;if(!("filterType"in Z)||Z.filterType===-1)W=[0,1,2,3,4];else if(typeof Z.filterType=="number")W=[Z.filterType];else throw new Error("unrecognised filter types");Z.bitDepth===16&&(X*=2);for(var J=U*X,re=0,te=0,ye=new T((J+1)*G),ue=W[0],Se=0;Se<G;Se++){if(W.length>1)for(var Le=1/0,Pe=0;Pe<W.length;Pe++){var Ee=x[W[Pe]](O,te,J,X);Ee<Le&&(ue=W[Pe],Le=Ee)}ye[re]=ue,re++,P[ue](O,te,J,ye,re,X),re+=J,te+=J}return ye}}).call(this,_("buffer").Buffer)},{"./paeth-predictor":124,buffer:48}],116:[function(_,k,b){(function(T){var t=_("util"),S=_("./chunkstream"),D=_("./filter-parse"),w=k.exports=function(E){S.call(this);var m=[],y=this;this._filter=new D(E,{read:this.read.bind(this),write:function(p){m.push(p)},complete:function(){y.emit("complete",T.concat(m))}}),this._filter.start()};t.inherits(w,S)}).call(this,_("buffer").Buffer)},{"./chunkstream":112,"./filter-parse":118,buffer:48,util:186}],117:[function(_,k,b){(function(T){var t=_("./sync-reader"),S=_("./filter-parse");b.process=function(D,w){var E=[],m=new t(D),y=new S(w,{read:m.read.bind(m),write:function(p){E.push(p)},complete:function(){}});return y.start(),m.process(),T.concat(E)}}).call(this,_("buffer").Buffer)},{"./filter-parse":118,"./sync-reader":131,buffer:48}],118:[function(_,k,b){(function(T){var t=_("./interlace"),S=_("./paeth-predictor");function D(E,m,y){var p=E*m;return y!==8&&(p=Math.ceil(p/(8/y))),p}var w=k.exports=function(E,m){var y=E.width,p=E.height,C=E.interlace,z=E.bpp,A=E.depth;if(this.read=m.read,this.write=m.write,this.complete=m.complete,this._imageIndex=0,this._images=[],C)for(var P=t.getImagePasses(y,p),x=0;x<P.length;x++)this._images.push({byteWidth:D(P[x].width,z,A),height:P[x].height,lineIndex:0});else this._images.push({byteWidth:D(y,z,A),height:p,lineIndex:0});A===8?this._xComparison=z:A===16?this._xComparison=z*2:this._xComparison=1};w.prototype.start=function(){this.read(this._images[this._imageIndex].byteWidth+1,this._reverseFilterLine.bind(this))},w.prototype._unFilterType1=function(E,m,y){for(var p=this._xComparison,C=p-1,z=0;z<y;z++){var A=E[1+z],P=z>C?m[z-p]:0;m[z]=A+P}},w.prototype._unFilterType2=function(E,m,y){for(var p=this._lastLine,C=0;C<y;C++){var z=E[1+C],A=p?p[C]:0;m[C]=z+A}},w.prototype._unFilterType3=function(E,m,y){for(var p=this._xComparison,C=p-1,z=this._lastLine,A=0;A<y;A++){var P=E[1+A],x=z?z[A]:0,O=A>C?m[A-p]:0,U=Math.floor((O+x)/2);m[A]=P+U}},w.prototype._unFilterType4=function(E,m,y){for(var p=this._xComparison,C=p-1,z=this._lastLine,A=0;A<y;A++){var P=E[1+A],x=z?z[A]:0,O=A>C?m[A-p]:0,U=A>C&&z?z[A-p]:0,G=S(O,x,U);m[A]=P+G}},w.prototype._reverseFilterLine=function(E){var m=E[0],y,p=this._images[this._imageIndex],C=p.byteWidth;if(m===0)y=E.slice(1,C+1);else switch(y=new T(C),m){case 1:this._unFilterType1(E,y,C);break;case 2:this._unFilterType2(E,y,C);break;case 3:this._unFilterType3(E,y,C);break;case 4:this._unFilterType4(E,y,C);break;default:throw new Error("Unrecognised filter type - "+m)}this.write(y),p.lineIndex++,p.lineIndex>=p.height?(this._lastLine=null,this._imageIndex++,p=this._images[this._imageIndex]):this._lastLine=y,p?this.read(p.byteWidth+1,this._reverseFilterLine.bind(this)):(this._lastLine=null,this.complete())}}).call(this,_("buffer").Buffer)},{"./interlace":120,"./paeth-predictor":124,buffer:48}],119:[function(_,k,b){(function(T){function t(w,E,m,y,p){for(var C=0,z=0;z<y;z++)for(var A=0;A<m;A++){var P=p[w[C]];if(!P)throw new Error("index "+w[C]+" not in palette");for(var x=0;x<4;x++)E[C+x]=P[x];C+=4}}function S(w,E,m,y,p){for(var C=0,z=0;z<y;z++)for(var A=0;A<m;A++){var P=!1;if(p.length===1?p[0]===w[C]&&(P=!0):p[0]===w[C]&&p[1]===w[C+1]&&p[2]===w[C+2]&&(P=!0),P)for(var x=0;x<4;x++)E[C+x]=0;C+=4}}function D(w,E,m,y,p){for(var C=255,z=Math.pow(2,p)-1,A=0,P=0;P<y;P++)for(var x=0;x<m;x++){for(var O=0;O<4;O++)E[A+O]=Math.floor(w[A+O]*C/z+.5);A+=4}}k.exports=function(w,E){var m=E.depth,y=E.width,p=E.height,C=E.colorType,z=E.transColor,A=E.palette,P=w;return C===3?t(w,P,y,p,A):(z&&S(w,P,y,p,z),m!==8&&(m===16&&(P=new T(y*p*4)),D(w,P,y,p,m))),P}}).call(this,_("buffer").Buffer)},{buffer:48}],120:[function(_,k,b){var T=[{x:[0],y:[0]},{x:[4],y:[0]},{x:[0,4],y:[4]},{x:[2,6],y:[0,4]},{x:[0,2,4,6],y:[2,6]},{x:[1,3,5,7],y:[0,2,4,6]},{x:[0,1,2,3,4,5,6,7],y:[1,3,5,7]}];b.getImagePasses=function(t,S){for(var D=[],w=t%8,E=S%8,m=(t-w)/8,y=(S-E)/8,p=0;p<T.length;p++){for(var C=T[p],z=m*C.x.length,A=y*C.y.length,P=0;P<C.x.length&&C.x[P]<w;P++)z++;for(P=0;P<C.y.length&&C.y[P]<E;P++)A++;z>0&&A>0&&D.push({width:z,height:A,index:p})}return D},b.getInterlaceIterator=function(t){return function(S,D,w){var E=S%T[w].x.length,m=(S-E)/T[w].x.length*8+T[w].x[E],y=D%T[w].y.length,p=(D-y)/T[w].y.length*8+T[w].y[y];return m*4+p*t*4}}},{}],121:[function(_,k,b){(function(T){var t=_("util"),S=_("stream"),D=_("./constants"),w=_("./packer"),E=k.exports=function(m){S.call(this);var y=m||{};this._packer=new w(y),this._deflate=this._packer.createDeflate(),this.readable=!0};t.inherits(E,S),E.prototype.pack=function(m,y,p,C){this.emit("data",new T(D.PNG_SIGNATURE)),this.emit("data",this._packer.packIHDR(y,p)),C&&this.emit("data",this._packer.packGAMA(C));var z=this._packer.filterData(m,y,p);this._deflate.on("error",this.emit.bind(this,"error")),this._deflate.on("data",function(A){this.emit("data",this._packer.packIDAT(A))}.bind(this)),this._deflate.on("end",function(){this.emit("data",this._packer.packIEND()),this.emit("end")}.bind(this)),this._deflate.end(z)}}).call(this,_("buffer").Buffer)},{"./constants":113,"./packer":123,buffer:48,stream:155,util:186}],122:[function(_,k,b){(function(T){var t=!0,S=_("zlib");S.deflateSync||(t=!1);var D=_("./constants"),w=_("./packer");k.exports=function(E,m){if(!t)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");var y=m||{},p=new w(y),C=[];C.push(new T(D.PNG_SIGNATURE)),C.push(p.packIHDR(E.width,E.height)),E.gamma&&C.push(p.packGAMA(E.gamma));var z=p.filterData(E.data,E.width,E.height),A=S.deflateSync(z,p.getDeflateOptions());if(z=null,!A||!A.length)throw new Error("bad png - invalid compressed data response");return C.push(p.packIDAT(A)),C.push(p.packIEND()),T.concat(C)}}).call(this,_("buffer").Buffer)},{"./constants":113,"./packer":123,buffer:48,zlib:35}],123:[function(_,k,b){(function(T){var t=_("./constants"),S=_("./crc"),D=_("./bitpacker"),w=_("./filter-pack"),E=_("zlib"),m=k.exports=function(y){if(this._options=y,y.deflateChunkSize=y.deflateChunkSize||32*1024,y.deflateLevel=y.deflateLevel!=null?y.deflateLevel:9,y.deflateStrategy=y.deflateStrategy!=null?y.deflateStrategy:3,y.inputHasAlpha=y.inputHasAlpha!=null?y.inputHasAlpha:!0,y.deflateFactory=y.deflateFactory||E.createDeflate,y.bitDepth=y.bitDepth||8,y.colorType=typeof y.colorType=="number"?y.colorType:t.COLORTYPE_COLOR_ALPHA,y.inputColorType=typeof y.inputColorType=="number"?y.inputColorType:t.COLORTYPE_COLOR_ALPHA,[t.COLORTYPE_GRAYSCALE,t.COLORTYPE_COLOR,t.COLORTYPE_COLOR_ALPHA,t.COLORTYPE_ALPHA].indexOf(y.colorType)===-1)throw new Error("option color type:"+y.colorType+" is not supported at present");if([t.COLORTYPE_GRAYSCALE,t.COLORTYPE_COLOR,t.COLORTYPE_COLOR_ALPHA,t.COLORTYPE_ALPHA].indexOf(y.inputColorType)===-1)throw new Error("option input color type:"+y.inputColorType+" is not supported at present");if(y.bitDepth!==8&&y.bitDepth!==16)throw new Error("option bit depth:"+y.bitDepth+" is not supported at present")};m.prototype.getDeflateOptions=function(){return{chunkSize:this._options.deflateChunkSize,level:this._options.deflateLevel,strategy:this._options.deflateStrategy}},m.prototype.createDeflate=function(){return this._options.deflateFactory(this.getDeflateOptions())},m.prototype.filterData=function(y,p,C){var z=D(y,p,C,this._options),A=t.COLORTYPE_TO_BPP_MAP[this._options.colorType],P=w(z,p,C,this._options,A);return P},m.prototype._packChunk=function(y,p){var C=p?p.length:0,z=new T(C+12);return z.writeUInt32BE(C,0),z.writeUInt32BE(y,4),p&&p.copy(z,8),z.writeInt32BE(S.crc32(z.slice(4,z.length-4)),z.length-4),z},m.prototype.packGAMA=function(y){var p=new T(4);return p.writeUInt32BE(Math.floor(y*t.GAMMA_DIVISION),0),this._packChunk(t.TYPE_gAMA,p)},m.prototype.packIHDR=function(y,p){var C=new T(13);return C.writeUInt32BE(y,0),C.writeUInt32BE(p,4),C[8]=this._options.bitDepth,C[9]=this._options.colorType,C[10]=0,C[11]=0,C[12]=0,this._packChunk(t.TYPE_IHDR,C)},m.prototype.packIDAT=function(y){return this._packChunk(t.TYPE_IDAT,y)},m.prototype.packIEND=function(){return this._packChunk(t.TYPE_IEND,null)}}).call(this,_("buffer").Buffer)},{"./bitpacker":111,"./constants":113,"./crc":114,"./filter-pack":115,buffer:48,zlib:35}],124:[function(_,k,b){k.exports=function(t,S,D){var w=t+S-D,E=Math.abs(w-t),m=Math.abs(w-S),y=Math.abs(w-D);return E<=m&&E<=y?t:m<=y?S:D}},{}],125:[function(_,k,b){var T=_("util"),t=_("zlib"),S=_("./chunkstream"),D=_("./filter-parse-async"),w=_("./parser"),E=_("./bitmapper"),m=_("./format-normaliser"),y=k.exports=function(p){S.call(this),this._parser=new w(p,{read:this.read.bind(this),error:this._handleError.bind(this),metadata:this._handleMetaData.bind(this),gamma:this.emit.bind(this,"gamma"),palette:this._handlePalette.bind(this),transColor:this._handleTransColor.bind(this),finished:this._finished.bind(this),inflateData:this._inflateData.bind(this)}),this._options=p,this.writable=!0,this._parser.start()};T.inherits(y,S),y.prototype._handleError=function(p){this.emit("error",p),this.writable=!1,this.destroy(),this._inflate&&this._inflate.destroy&&this._inflate.destroy(),this._filter&&(this._filter.destroy(),this._filter.on("error",function(){})),this.errord=!0},y.prototype._inflateData=function(p){if(!this._inflate)if(this._bitmapInfo.interlace)this._inflate=t.createInflate(),this._inflate.on("error",this.emit.bind(this,"error")),this._filter.on("complete",this._complete.bind(this)),this._inflate.pipe(this._filter);else{var C=(this._bitmapInfo.width*this._bitmapInfo.bpp*this._bitmapInfo.depth+7>>3)+1,z=C*this._bitmapInfo.height,A=Math.max(z,t.Z_MIN_CHUNK);this._inflate=t.createInflate({chunkSize:A});var P=z,x=this.emit.bind(this,"error");this._inflate.on("error",function(U){P&&x(U)}),this._filter.on("complete",this._complete.bind(this));var O=this._filter.write.bind(this._filter);this._inflate.on("data",function(U){P&&(U.length>P&&(U=U.slice(0,P)),P-=U.length,O(U))}),this._inflate.on("end",this._filter.end.bind(this._filter))}this._inflate.write(p)},y.prototype._handleMetaData=function(p){this.emit("metadata",p),this._bitmapInfo=Object.create(p),this._filter=new D(this._bitmapInfo)},y.prototype._handleTransColor=function(p){this._bitmapInfo.transColor=p},y.prototype._handlePalette=function(p){this._bitmapInfo.palette=p},y.prototype._finished=function(){this.errord||(this._inflate?this._inflate.end():this.emit("error","No Inflate block"),this.destroySoon())},y.prototype._complete=function(p){if(!this.errord){try{var C=E.dataToBitMap(p,this._bitmapInfo),z=m(C,this._bitmapInfo);C=null}catch(A){this._handleError(A);return}this.emit("parsed",z)}}},{"./bitmapper":110,"./chunkstream":112,"./filter-parse-async":116,"./format-normaliser":119,"./parser":127,util:186,zlib:35}],126:[function(_,k,b){(function(T){var t=!0,S=_("zlib"),D=_("./sync-inflate");S.deflateSync||(t=!1);var w=_("./sync-reader"),E=_("./filter-parse-sync"),m=_("./parser"),y=_("./bitmapper"),p=_("./format-normaliser");k.exports=function(C,z){if(!t)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");var A;function P(He){A=He}var x;function O(He){x=He}function U(He){x.transColor=He}function G(He){x.palette=He}var Z;function X(He){Z=He}var W=[];function J(He){W.push(He)}var re=new w(C),te=new m(z,{read:re.read.bind(re),error:P,metadata:O,gamma:X,palette:G,transColor:U,inflateData:J});if(te.start(),re.process(),A)throw A;var ye=T.concat(W);W.length=0;var ue;if(x.interlace)ue=S.inflateSync(ye);else{var Se=(x.width*x.bpp*x.depth+7>>3)+1,Le=Se*x.height;ue=D(ye,{chunkSize:Le,maxLength:Le})}if(ye=null,!ue||!ue.length)throw new Error("bad png - invalid inflate data response");var Pe=E.process(ue,x);ye=null;var Ee=y.dataToBitMap(Pe,x);Pe=null;var Me=p(Ee,x);return x.data=Me,x.gamma=Z||0,x}}).call(this,_("buffer").Buffer)},{"./bitmapper":110,"./filter-parse-sync":117,"./format-normaliser":119,"./parser":127,"./sync-inflate":130,"./sync-reader":131,buffer:48,zlib:35}],127:[function(_,k,b){(function(T){var t=_("./constants"),S=_("./crc"),D=k.exports=function(w,E){this._options=w,w.checkCRC=w.checkCRC!==!1,this._hasIHDR=!1,this._hasIEND=!1,this._palette=[],this._colorType=0,this._chunks={},this._chunks[t.TYPE_IHDR]=this._handleIHDR.bind(this),this._chunks[t.TYPE_IEND]=this._handleIEND.bind(this),this._chunks[t.TYPE_IDAT]=this._handleIDAT.bind(this),this._chunks[t.TYPE_PLTE]=this._handlePLTE.bind(this),this._chunks[t.TYPE_tRNS]=this._handleTRNS.bind(this),this._chunks[t.TYPE_gAMA]=this._handleGAMA.bind(this),this.read=E.read,this.error=E.error,this.metadata=E.metadata,this.gamma=E.gamma,this.transColor=E.transColor,this.palette=E.palette,this.parsed=E.parsed,this.inflateData=E.inflateData,this.finished=E.finished};D.prototype.start=function(){this.read(t.PNG_SIGNATURE.length,this._parseSignature.bind(this))},D.prototype._parseSignature=function(w){for(var E=t.PNG_SIGNATURE,m=0;m<E.length;m++)if(w[m]!==E[m]){this.error(new Error("Invalid file signature"));return}this.read(8,this._parseChunkBegin.bind(this))},D.prototype._parseChunkBegin=function(w){for(var E=w.readUInt32BE(0),m=w.readUInt32BE(4),y="",p=4;p<8;p++)y+=String.fromCharCode(w[p]);var C=!!(w[4]&32);if(!this._hasIHDR&&m!==t.TYPE_IHDR){this.error(new Error("Expected IHDR on beggining"));return}if(this._crc=new S,this._crc.write(new T(y)),this._chunks[m])return this._chunks[m](E);if(!C){this.error(new Error("Unsupported critical chunk type "+y));return}this.read(E+4,this._skipChunk.bind(this))},D.prototype._skipChunk=function(){this.read(8,this._parseChunkBegin.bind(this))},D.prototype._handleChunkEnd=function(){this.read(4,this._parseChunkEnd.bind(this))},D.prototype._parseChunkEnd=function(w){var E=w.readInt32BE(0),m=this._crc.crc32();if(this._options.checkCRC&&m!==E){this.error(new Error("Crc error - "+E+" - "+m));return}this._hasIEND||this.read(8,this._parseChunkBegin.bind(this))},D.prototype._handleIHDR=function(w){this.read(w,this._parseIHDR.bind(this))},D.prototype._parseIHDR=function(w){this._crc.write(w);var E=w.readUInt32BE(0),m=w.readUInt32BE(4),y=w[8],p=w[9],C=w[10],z=w[11],A=w[12];if(y!==8&&y!==4&&y!==2&&y!==1&&y!==16){this.error(new Error("Unsupported bit depth "+y));return}if(!(p in t.COLORTYPE_TO_BPP_MAP)){this.error(new Error("Unsupported color type"));return}if(C!==0){this.error(new Error("Unsupported compression method"));return}if(z!==0){this.error(new Error("Unsupported filter method"));return}if(A!==0&&A!==1){this.error(new Error("Unsupported interlace method"));return}this._colorType=p;var P=t.COLORTYPE_TO_BPP_MAP[this._colorType];this._hasIHDR=!0,this.metadata({width:E,height:m,depth:y,interlace:!!A,palette:!!(p&t.COLORTYPE_PALETTE),color:!!(p&t.COLORTYPE_COLOR),alpha:!!(p&t.COLORTYPE_ALPHA),bpp:P,colorType:p}),this._handleChunkEnd()},D.prototype._handlePLTE=function(w){this.read(w,this._parsePLTE.bind(this))},D.prototype._parsePLTE=function(w){this._crc.write(w);for(var E=Math.floor(w.length/3),m=0;m<E;m++)this._palette.push([w[m*3],w[m*3+1],w[m*3+2],255]);this.palette(this._palette),this._handleChunkEnd()},D.prototype._handleTRNS=function(w){this.read(w,this._parseTRNS.bind(this))},D.prototype._parseTRNS=function(w){if(this._crc.write(w),this._colorType===t.COLORTYPE_PALETTE_COLOR){if(this._palette.length===0){this.error(new Error("Transparency chunk must be after palette"));return}if(w.length>this._palette.length){this.error(new Error("More transparent colors than palette size"));return}for(var E=0;E<w.length;E++)this._palette[E][3]=w[E];this.palette(this._palette)}this._colorType===t.COLORTYPE_GRAYSCALE&&this.transColor([w.readUInt16BE(0)]),this._colorType===t.COLORTYPE_COLOR&&this.transColor([w.readUInt16BE(0),w.readUInt16BE(2),w.readUInt16BE(4)]),this._handleChunkEnd()},D.prototype._handleGAMA=function(w){this.read(w,this._parseGAMA.bind(this))},D.prototype._parseGAMA=function(w){this._crc.write(w),this.gamma(w.readUInt32BE(0)/t.GAMMA_DIVISION),this._handleChunkEnd()},D.prototype._handleIDAT=function(w){this.read(-w,this._parseIDAT.bind(this,w))},D.prototype._parseIDAT=function(w,E){if(this._crc.write(E),this._colorType===t.COLORTYPE_PALETTE_COLOR&&this._palette.length===0)throw new Error("Expected palette not found");this.inflateData(E);var m=w-E.length;m>0?this._handleIDAT(m):this._handleChunkEnd()},D.prototype._handleIEND=function(w){this.read(w,this._parseIEND.bind(this))},D.prototype._parseIEND=function(w){this._crc.write(w),this._hasIEND=!0,this._handleChunkEnd(),this.finished&&this.finished()}}).call(this,_("buffer").Buffer)},{"./constants":113,"./crc":114,buffer:48}],128:[function(_,k,b){var T=_("./parser-sync"),t=_("./packer-sync");b.read=function(S,D){return T(S,D||{})},b.write=function(S,D){return t(S,D)}},{"./packer-sync":122,"./parser-sync":126}],129:[function(_,k,b){(function(T,t){var S=_("util"),D=_("stream"),w=_("./parser-async"),E=_("./packer-async"),m=_("./png-sync"),y=b.PNG=function(p){D.call(this),p=p||{},this.width=p.width|0,this.height=p.height|0,this.data=this.width>0&&this.height>0?new t(4*this.width*this.height):null,p.fill&&this.data&&this.data.fill(0),this.gamma=0,this.readable=this.writable=!0,this._parser=new w(p),this._parser.on("error",this.emit.bind(this,"error")),this._parser.on("close",this._handleClose.bind(this)),this._parser.on("metadata",this._metadata.bind(this)),this._parser.on("gamma",this._gamma.bind(this)),this._parser.on("parsed",function(C){this.data=C,this.emit("parsed",C)}.bind(this)),this._packer=new E(p),this._packer.on("data",this.emit.bind(this,"data")),this._packer.on("end",this.emit.bind(this,"end")),this._parser.on("close",this._handleClose.bind(this)),this._packer.on("error",this.emit.bind(this,"error"))};S.inherits(y,D),y.sync=m,y.prototype.pack=function(){return!this.data||!this.data.length?(this.emit("error","No data provided"),this):(T.nextTick(function(){this._packer.pack(this.data,this.width,this.height,this.gamma)}.bind(this)),this)},y.prototype.parse=function(p,C){if(C){var z,A;z=function(P){this.removeListener("error",A),this.data=P,C(null,this)}.bind(this),A=function(P){this.removeListener("parsed",z),C(P,null)}.bind(this),this.once("parsed",z),this.once("error",A)}return this.end(p),this},y.prototype.write=function(p){return this._parser.write(p),!0},y.prototype.end=function(p){this._parser.end(p)},y.prototype._metadata=function(p){this.width=p.width,this.height=p.height,this.emit("metadata",p)},y.prototype._gamma=function(p){this.gamma=p},y.prototype._handleClose=function(){!this._parser.writable&&!this._packer.readable&&this.emit("close")},y.bitblt=function(p,C,z,A,P,x,O,U){if(z|=0,A|=0,P|=0,x|=0,O|=0,U|=0,z>p.width||A>p.height||z+P>p.width||A+x>p.height)throw new Error("bitblt reading outside image");if(O>C.width||U>C.height||O+P>C.width||U+x>C.height)throw new Error("bitblt writing outside image");for(var G=0;G<x;G++)p.data.copy(C.data,(U+G)*C.width+O<<2,(A+G)*p.width+z<<2,(A+G)*p.width+z+P<<2)},y.prototype.bitblt=function(p,C,z,A,P,x,O){return y.bitblt(this,p,C,z,A,P,x,O),this},y.adjustGamma=function(p){if(p.gamma){for(var C=0;C<p.height;C++)for(var z=0;z<p.width;z++)for(var A=p.width*C+z<<2,P=0;P<3;P++){var x=p.data[A+P]/255;x=Math.pow(x,1/2.2/p.gamma),p.data[A+P]=Math.round(x*255)}p.gamma=0}},y.prototype.adjustGamma=function(){y.adjustGamma(this)}}).call(this,_("_process"),_("buffer").Buffer)},{"./packer-async":121,"./parser-async":125,"./png-sync":128,_process:133,buffer:48,stream:155,util:186}],130:[function(_,k,b){(function(T,t){var S=_("assert").ok,D=_("zlib"),w=_("util"),E=_("buffer").kMaxLength;function m(A){if(!(this instanceof m))return new m(A);A&&A.chunkSize<D.Z_MIN_CHUNK&&(A.chunkSize=D.Z_MIN_CHUNK),D.Inflate.call(this,A),this._offset=this._offset===void 0?this._outOffset:this._offset,this._buffer=this._buffer||this._outBuffer,A&&A.maxLength!=null&&(this._maxLength=A.maxLength)}function y(A){return new m(A)}function p(A,P){A._handle&&(A._handle.close(),A._handle=null)}m.prototype._processChunk=function(A,P,x){if(typeof x=="function")return D.Inflate._processChunk.call(this,A,P,x);var O=this,U=A&&A.length,G=this._chunkSize-this._offset,Z=this._maxLength,X=0,W=[],J=0,re;this.on("error",function(Se){re=Se});function te(Se,Le){if(!O._hadError){var Pe=G-Le;if(S(Pe>=0,"have should not go down"),Pe>0){var Ee=O._buffer.slice(O._offset,O._offset+Pe);if(O._offset+=Pe,Ee.length>Z&&(Ee=Ee.slice(0,Z)),W.push(Ee),J+=Ee.length,Z-=Ee.length,Z===0)return!1}return(Le===0||O._offset>=O._chunkSize)&&(G=O._chunkSize,O._offset=0,O._buffer=t.allocUnsafe(O._chunkSize)),Le===0?(X+=U-Se,U=Se,!0):!1}}S(this._handle,"zlib binding closed");do{var ye=this._handle.writeSync(P,A,X,U,this._buffer,this._offset,G);ye=ye||this._writeState}while(!this._hadError&&te(ye[0],ye[1]));if(this._hadError)throw re;if(J>=E)throw p(this),new RangeError("Cannot create final Buffer. It would be larger than 0x"+E.toString(16)+" bytes");var ue=t.concat(W,J);return p(this),ue},w.inherits(m,D.Inflate);function C(A,P){if(typeof P=="string"&&(P=t.from(P)),!(P instanceof t))throw new TypeError("Not a string or buffer");var x=A._finishFlushFlag;return x==null&&(x=D.Z_FINISH),A._processChunk(P,x)}function z(A,P){return C(new m(P),A)}k.exports=b=z,b.Inflate=m,b.createInflate=y,b.inflateSync=z}).call(this,_("_process"),_("buffer").Buffer)},{_process:133,assert:25,buffer:48,util:186,zlib:35}],131:[function(_,k,b){var T=k.exports=function(t){this._buffer=t,this._reads=[]};T.prototype.read=function(t,S){this._reads.push({length:Math.abs(t),allowLess:t<0,func:S})},T.prototype.process=function(){for(;this._reads.length>0&&this._buffer.length;){var t=this._reads[0];if(this._buffer.length&&(this._buffer.length>=t.length||t.allowLess)){this._reads.shift();var S=this._buffer;this._buffer=S.slice(t.length),t.func.call(this,S.slice(0,t.length))}else break}if(this._reads.length>0)return new Error("There are some read requests waitng on finished stream");if(this._buffer.length>0)return new Error("unrecognised content at end of stream")}},{}],132:[function(_,k,b){(function(T){typeof T>"u"||!T.version||T.version.indexOf("v0.")===0||T.version.indexOf("v1.")===0&&T.version.indexOf("v1.8.")!==0?k.exports={nextTick:t}:k.exports=T;function t(S,D,w,E){if(typeof S!="function")throw new TypeError('"callback" argument must be a function');var m=arguments.length,y,p;switch(m){case 0:case 1:return T.nextTick(S);case 2:return T.nextTick(function(){S.call(null,D)});case 3:return T.nextTick(function(){S.call(null,D,w)});case 4:return T.nextTick(function(){S.call(null,D,w,E)});default:for(y=new Array(m-1),p=0;p<y.length;)y[p++]=arguments[p];return T.nextTick(function(){S.apply(null,y)})}}}).call(this,_("_process"))},{_process:133}],133:[function(_,k,b){var T=k.exports={},t,S;function D(){throw new Error("setTimeout has not been defined")}function w(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?t=setTimeout:t=D}catch{t=D}try{typeof clearTimeout=="function"?S=clearTimeout:S=w}catch{S=w}})();function E(U){if(t===setTimeout)return setTimeout(U,0);if((t===D||!t)&&setTimeout)return t=setTimeout,setTimeout(U,0);try{return t(U,0)}catch{try{return t.call(null,U,0)}catch{return t.call(this,U,0)}}}function m(U){if(S===clearTimeout)return clearTimeout(U);if((S===w||!S)&&clearTimeout)return S=clearTimeout,clearTimeout(U);try{return S(U)}catch{try{return S.call(null,U)}catch{return S.call(this,U)}}}var y=[],p=!1,C,z=-1;function A(){!p||!C||(p=!1,C.length?y=C.concat(y):z=-1,y.length&&P())}function P(){if(!p){var U=E(A);p=!0;for(var G=y.length;G;){for(C=y,y=[];++z<G;)C&&C[z].run();z=-1,G=y.length}C=null,p=!1,m(U)}}T.nextTick=function(U){var G=new Array(arguments.length-1);if(arguments.length>1)for(var Z=1;Z<arguments.length;Z++)G[Z-1]=arguments[Z];y.push(new x(U,G)),y.length===1&&!p&&E(P)};function x(U,G){this.fun=U,this.array=G}x.prototype.run=function(){this.fun.apply(null,this.array)},T.title="browser",T.browser=!0,T.env={},T.argv=[],T.version="",T.versions={};function O(){}T.on=O,T.addListener=O,T.once=O,T.off=O,T.removeListener=O,T.removeAllListeners=O,T.emit=O,T.prependListener=O,T.prependOnceListener=O,T.listeners=function(U){return[]},T.binding=function(U){throw new Error("process.binding is not supported")},T.cwd=function(){return"/"},T.chdir=function(U){throw new Error("process.chdir is not supported")},T.umask=function(){return 0}},{}],134:[function(_,k,b){(function(T){(function(t){var S=typeof b=="object"&&b&&!b.nodeType&&b,D=typeof k=="object"&&k&&!k.nodeType&&k,w=typeof T=="object"&&T;(w.global===w||w.window===w||w.self===w)&&(t=w);var E,m=2147483647,y=36,p=1,C=26,z=38,A=700,P=72,x=128,O="-",U=/^xn--/,G=/[^\x20-\x7E]/,Z=/[\x2E\u3002\uFF0E\uFF61]/g,X={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},W=y-p,J=Math.floor,re=String.fromCharCode,te;function ye(Be){throw new RangeError(X[Be])}function ue(Be,Ae){for(var se=Be.length,pe=[];se--;)pe[se]=Ae(Be[se]);return pe}function Se(Be,Ae){var se=Be.split("@"),pe="";se.length>1&&(pe=se[0]+"@",Be=se[1]),Be=Be.replace(Z,".");var Ke=Be.split("."),_e=ue(Ke,Ae).join(".");return pe+_e}function Le(Be){for(var Ae=[],se=0,pe=Be.length,Ke,_e;se<pe;)Ke=Be.charCodeAt(se++),Ke>=55296&&Ke<=56319&&se<pe?(_e=Be.charCodeAt(se++),(_e&64512)==56320?Ae.push(((Ke&1023)<<10)+(_e&1023)+65536):(Ae.push(Ke),se--)):Ae.push(Ke);return Ae}function Pe(Be){return ue(Be,function(Ae){var se="";return Ae>65535&&(Ae-=65536,se+=re(Ae>>>10&1023|55296),Ae=56320|Ae&1023),se+=re(Ae),se}).join("")}function Ee(Be){return Be-48<10?Be-22:Be-65<26?Be-65:Be-97<26?Be-97:y}function Me(Be,Ae){return Be+22+75*(Be<26)-((Ae!=0)<<5)}function He(Be,Ae,se){var pe=0;for(Be=se?J(Be/A):Be>>1,Be+=J(Be/Ae);Be>W*C>>1;pe+=y)Be=J(Be/W);return J(pe+(W+1)*Be/(Be+z))}function nt(Be){var Ae=[],se=Be.length,pe,Ke=0,_e=x,ke=P,qe,tt,Ge,We,Je,it,ze,de,ve;for(qe=Be.lastIndexOf(O),qe<0&&(qe=0),tt=0;tt<qe;++tt)Be.charCodeAt(tt)>=128&&ye("not-basic"),Ae.push(Be.charCodeAt(tt));for(Ge=qe>0?qe+1:0;Ge<se;){for(We=Ke,Je=1,it=y;Ge>=se&&ye("invalid-input"),ze=Ee(Be.charCodeAt(Ge++)),(ze>=y||ze>J((m-Ke)/Je))&&ye("overflow"),Ke+=ze*Je,de=it<=ke?p:it>=ke+C?C:it-ke,!(ze<de);it+=y)ve=y-de,Je>J(m/ve)&&ye("overflow"),Je*=ve;pe=Ae.length+1,ke=He(Ke-We,pe,We==0),J(Ke/pe)>m-_e&&ye("overflow"),_e+=J(Ke/pe),Ke%=pe,Ae.splice(Ke++,0,_e)}return Pe(Ae)}function ht(Be){var Ae,se,pe,Ke,_e,ke,qe,tt,Ge,We,Je,it=[],ze,de,ve,be;for(Be=Le(Be),ze=Be.length,Ae=x,se=0,_e=P,ke=0;ke<ze;++ke)Je=Be[ke],Je<128&&it.push(re(Je));for(pe=Ke=it.length,Ke&&it.push(O);pe<ze;){for(qe=m,ke=0;ke<ze;++ke)Je=Be[ke],Je>=Ae&&Je<qe&&(qe=Je);for(de=pe+1,qe-Ae>J((m-se)/de)&&ye("overflow"),se+=(qe-Ae)*de,Ae=qe,ke=0;ke<ze;++ke)if(Je=Be[ke],Je<Ae&&++se>m&&ye("overflow"),Je==Ae){for(tt=se,Ge=y;We=Ge<=_e?p:Ge>=_e+C?C:Ge-_e,!(tt<We);Ge+=y)be=tt-We,ve=y-We,it.push(re(Me(We+be%ve,0))),tt=J(be/ve);it.push(re(Me(tt,0))),_e=He(se,de,pe==Ke),se=0,++pe}++se,++Ae}return it.join("")}function Fe(Be){return Se(Be,function(Ae){return U.test(Ae)?nt(Ae.slice(4).toLowerCase()):Ae})}function Ce(Be){return Se(Be,function(Ae){return G.test(Ae)?"xn--"+ht(Ae):Ae})}if(E={version:"1.4.1",ucs2:{decode:Le,encode:Pe},decode:nt,encode:ht,toASCII:Ce,toUnicode:Fe},S&&D)if(k.exports==S)D.exports=E;else for(te in E)E.hasOwnProperty(te)&&(S[te]=E[te]);else t.punycode=E})(this)}).call(this,typeof Hr<"u"?Hr:typeof self<"u"?self:typeof v<"u"?v:{})},{}],135:[function(_,k,b){function T(S,D){return Object.prototype.hasOwnProperty.call(S,D)}k.exports=function(S,D,w,E){D=D||"&",w=w||"=";var m={};if(typeof S!="string"||S.length===0)return m;var y=/\+/g;S=S.split(D);var p=1e3;E&&typeof E.maxKeys=="number"&&(p=E.maxKeys);var C=S.length;p>0&&C>p&&(C=p);for(var z=0;z<C;++z){var A=S[z].replace(y,"%20"),P=A.indexOf(w),x,O,U,G;P>=0?(x=A.substr(0,P),O=A.substr(P+1)):(x=A,O=""),U=decodeURIComponent(x),G=decodeURIComponent(O),T(m,U)?t(m[U])?m[U].push(G):m[U]=[m[U],G]:m[U]=G}return m};var t=Array.isArray||function(S){return Object.prototype.toString.call(S)==="[object Array]"}},{}],136:[function(_,k,b){var T=function(w){switch(typeof w){case"string":return w;case"boolean":return w?"true":"false";case"number":return isFinite(w)?w:"";default:return""}};k.exports=function(w,E,m,y){return E=E||"&",m=m||"=",w===null&&(w=void 0),typeof w=="object"?S(D(w),function(p){var C=encodeURIComponent(T(p))+m;return t(w[p])?S(w[p],function(z){return C+encodeURIComponent(T(z))}).join(E):C+encodeURIComponent(T(w[p]))}).join(E):y?encodeURIComponent(T(y))+m+encodeURIComponent(T(w)):""};var t=Array.isArray||function(w){return Object.prototype.toString.call(w)==="[object Array]"};function S(w,E){if(w.map)return w.map(E);for(var m=[],y=0;y<w.length;y++)m.push(E(w[y],y));return m}var D=Object.keys||function(w){var E=[];for(var m in w)Object.prototype.hasOwnProperty.call(w,m)&&E.push(m);return E}},{}],137:[function(_,k,b){b.decode=b.parse=_("./decode"),b.encode=b.stringify=_("./encode")},{"./decode":135,"./encode":136}],138:[function(_,k,b){k.exports=_("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":139}],139:[function(_,k,b){var T=_("process-nextick-args"),t=Object.keys||function(A){var P=[];for(var x in A)P.push(x);return P};k.exports=p;var S=_("core-util-is");S.inherits=_("inherits");var D=_("./_stream_readable"),w=_("./_stream_writable");S.inherits(p,D);for(var E=t(w.prototype),m=0;m<E.length;m++){var y=E[m];p.prototype[y]||(p.prototype[y]=w.prototype[y])}function p(A){if(!(this instanceof p))return new p(A);D.call(this,A),w.call(this,A),A&&A.readable===!1&&(this.readable=!1),A&&A.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,A&&A.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",C)}Object.defineProperty(p.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function C(){this.allowHalfOpen||this._writableState.ended||T.nextTick(z,this)}function z(A){A.end()}Object.defineProperty(p.prototype,"destroyed",{get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(A){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=A,this._writableState.destroyed=A)}}),p.prototype._destroy=function(A,P){this.push(null),this.end(),T.nextTick(P,A)}},{"./_stream_readable":141,"./_stream_writable":143,"core-util-is":51,inherits:75,"process-nextick-args":132}],140:[function(_,k,b){k.exports=S;var T=_("./_stream_transform"),t=_("core-util-is");t.inherits=_("inherits"),t.inherits(S,T);function S(D){if(!(this instanceof S))return new S(D);T.call(this,D)}S.prototype._transform=function(D,w,E){E(null,D)}},{"./_stream_transform":142,"core-util-is":51,inherits:75}],141:[function(_,k,b){(function(T,t){var S=_("process-nextick-args");k.exports=J;var D=_("isarray"),w;J.ReadableState=W,_("events").EventEmitter;var E=function(We,Je){return We.listeners(Je).length},m=_("./internal/streams/stream"),y=_("safe-buffer").Buffer,p=t.Uint8Array||function(){};function C(We){return y.from(We)}function z(We){return y.isBuffer(We)||We instanceof p}var A=_("core-util-is");A.inherits=_("inherits");var P=_("util"),x=void 0;P&&P.debuglog?x=P.debuglog("stream"):x=function(){};var O=_("./internal/streams/BufferList"),U=_("./internal/streams/destroy"),G;A.inherits(J,m);var Z=["error","close","destroy","pause","resume"];function X(We,Je,it){if(typeof We.prependListener=="function")return We.prependListener(Je,it);!We._events||!We._events[Je]?We.on(Je,it):D(We._events[Je])?We._events[Je].unshift(it):We._events[Je]=[it,We._events[Je]]}function W(We,Je){w=w||_("./_stream_duplex"),We=We||{};var it=Je instanceof w;this.objectMode=!!We.objectMode,it&&(this.objectMode=this.objectMode||!!We.readableObjectMode);var ze=We.highWaterMark,de=We.readableHighWaterMark,ve=this.objectMode?16:16*1024;ze||ze===0?this.highWaterMark=ze:it&&(de||de===0)?this.highWaterMark=de:this.highWaterMark=ve,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new O,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=We.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,We.encoding&&(G||(G=_("string_decoder/").StringDecoder),this.decoder=new G(We.encoding),this.encoding=We.encoding)}function J(We){if(w=w||_("./_stream_duplex"),!(this instanceof J))return new J(We);this._readableState=new W(We,this),this.readable=!0,We&&(typeof We.read=="function"&&(this._read=We.read),typeof We.destroy=="function"&&(this._destroy=We.destroy)),m.call(this)}Object.defineProperty(J.prototype,"destroyed",{get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(We){this._readableState&&(this._readableState.destroyed=We)}}),J.prototype.destroy=U.destroy,J.prototype._undestroy=U.undestroy,J.prototype._destroy=function(We,Je){this.push(null),Je(We)},J.prototype.push=function(We,Je){var it=this._readableState,ze;return it.objectMode?ze=!0:typeof We=="string"&&(Je=Je||it.defaultEncoding,Je!==it.encoding&&(We=y.from(We,Je),Je=""),ze=!0),re(this,We,Je,!1,ze)},J.prototype.unshift=function(We){return re(this,We,null,!0,!1)};function re(We,Je,it,ze,de){var ve=We._readableState;if(Je===null)ve.reading=!1,Ee(We,ve);else{var be;de||(be=ye(ve,Je)),be?We.emit("error",be):ve.objectMode||Je&&Je.length>0?(typeof Je!="string"&&!ve.objectMode&&Object.getPrototypeOf(Je)!==y.prototype&&(Je=C(Je)),ze?ve.endEmitted?We.emit("error",new Error("stream.unshift() after end event")):te(We,ve,Je,!0):ve.ended?We.emit("error",new Error("stream.push() after EOF")):(ve.reading=!1,ve.decoder&&!it?(Je=ve.decoder.write(Je),ve.objectMode||Je.length!==0?te(We,ve,Je,!1):nt(We,ve)):te(We,ve,Je,!1))):ze||(ve.reading=!1)}return ue(ve)}function te(We,Je,it,ze){Je.flowing&&Je.length===0&&!Je.sync?(We.emit("data",it),We.read(0)):(Je.length+=Je.objectMode?1:it.length,ze?Je.buffer.unshift(it):Je.buffer.push(it),Je.needReadable&&Me(We)),nt(We,Je)}function ye(We,Je){var it;return!z(Je)&&typeof Je!="string"&&Je!==void 0&&!We.objectMode&&(it=new TypeError("Invalid non-string/buffer chunk")),it}function ue(We){return!We.ended&&(We.needReadable||We.length<We.highWaterMark||We.length===0)}J.prototype.isPaused=function(){return this._readableState.flowing===!1},J.prototype.setEncoding=function(We){return G||(G=_("string_decoder/").StringDecoder),this._readableState.decoder=new G(We),this._readableState.encoding=We,this};var Se=8388608;function Le(We){return We>=Se?We=Se:(We--,We|=We>>>1,We|=We>>>2,We|=We>>>4,We|=We>>>8,We|=We>>>16,We++),We}function Pe(We,Je){return We<=0||Je.length===0&&Je.ended?0:Je.objectMode?1:We!==We?Je.flowing&&Je.length?Je.buffer.head.data.length:Je.length:(We>Je.highWaterMark&&(Je.highWaterMark=Le(We)),We<=Je.length?We:Je.ended?Je.length:(Je.needReadable=!0,0))}J.prototype.read=function(We){x("read",We),We=parseInt(We,10);var Je=this._readableState,it=We;if(We!==0&&(Je.emittedReadable=!1),We===0&&Je.needReadable&&(Je.length>=Je.highWaterMark||Je.ended))return x("read: emitReadable",Je.length,Je.ended),Je.length===0&&Je.ended?qe(this):Me(this),null;if(We=Pe(We,Je),We===0&&Je.ended)return Je.length===0&&qe(this),null;var ze=Je.needReadable;x("need readable",ze),(Je.length===0||Je.length-We<Je.highWaterMark)&&(ze=!0,x("length less than watermark",ze)),Je.ended||Je.reading?(ze=!1,x("reading or ended",ze)):ze&&(x("do read"),Je.reading=!0,Je.sync=!0,Je.length===0&&(Je.needReadable=!0),this._read(Je.highWaterMark),Je.sync=!1,Je.reading||(We=Pe(it,Je)));var de;return We>0?de=pe(We,Je):de=null,de===null?(Je.needReadable=!0,We=0):Je.length-=We,Je.length===0&&(Je.ended||(Je.needReadable=!0),it!==We&&Je.ended&&qe(this)),de!==null&&this.emit("data",de),de};function Ee(We,Je){if(!Je.ended){if(Je.decoder){var it=Je.decoder.end();it&&it.length&&(Je.buffer.push(it),Je.length+=Je.objectMode?1:it.length)}Je.ended=!0,Me(We)}}function Me(We){var Je=We._readableState;Je.needReadable=!1,Je.emittedReadable||(x("emitReadable",Je.flowing),Je.emittedReadable=!0,Je.sync?S.nextTick(He,We):He(We))}function He(We){x("emit readable"),We.emit("readable"),se(We)}function nt(We,Je){Je.readingMore||(Je.readingMore=!0,S.nextTick(ht,We,Je))}function ht(We,Je){for(var it=Je.length;!Je.reading&&!Je.flowing&&!Je.ended&&Je.length<Je.highWaterMark&&(x("maybeReadMore read 0"),We.read(0),it!==Je.length);)it=Je.length;Je.readingMore=!1}J.prototype._read=function(We){this.emit("error",new Error("_read() is not implemented"))},J.prototype.pipe=function(We,Je){var it=this,ze=this._readableState;switch(ze.pipesCount){case 0:ze.pipes=We;break;case 1:ze.pipes=[ze.pipes,We];break;default:ze.pipes.push(We);break}ze.pipesCount+=1,x("pipe count=%d opts=%j",ze.pipesCount,Je);var de=(!Je||Je.end!==!1)&&We!==T.stdout&&We!==T.stderr,ve=de?Oe:xr;ze.endEmitted?S.nextTick(ve):it.once("end",ve),We.on("unpipe",be);function be(Tr,br){x("onunpipe"),Tr===it&&br&&br.hasUnpiped===!1&&(br.hasUnpiped=!0,et())}function Oe(){x("onend"),We.end()}var ge=Fe(it);We.on("drain",ge);var le=!1;function et(){x("cleanup"),We.removeListener("close",or),We.removeListener("finish",Or),We.removeListener("drain",ge),We.removeListener("error",Wt),We.removeListener("unpipe",be),it.removeListener("end",Oe),it.removeListener("end",xr),it.removeListener("data",Ft),le=!0,ze.awaitDrain&&(!We._writableState||We._writableState.needDrain)&&ge()}var wt=!1;it.on("data",Ft);function Ft(Tr){x("ondata"),wt=!1;var br=We.write(Tr);br===!1&&!wt&&((ze.pipesCount===1&&ze.pipes===We||ze.pipesCount>1&&Ge(ze.pipes,We)!==-1)&&!le&&(x("false write response, pause",it._readableState.awaitDrain),it._readableState.awaitDrain++,wt=!0),it.pause())}function Wt(Tr){x("onerror",Tr),xr(),We.removeListener("error",Wt),E(We,"error")===0&&We.emit("error",Tr)}X(We,"error",Wt);function or(){We.removeListener("finish",Or),xr()}We.once("close",or);function Or(){x("onfinish"),We.removeListener("close",or),xr()}We.once("finish",Or);function xr(){x("unpipe"),it.unpipe(We)}return We.emit("pipe",it),ze.flowing||(x("pipe resume"),it.resume()),We};function Fe(We){return function(){var Je=We._readableState;x("pipeOnDrain",Je.awaitDrain),Je.awaitDrain&&Je.awaitDrain--,Je.awaitDrain===0&&E(We,"data")&&(Je.flowing=!0,se(We))}}J.prototype.unpipe=function(We){var Je=this._readableState,it={hasUnpiped:!1};if(Je.pipesCount===0)return this;if(Je.pipesCount===1)return We&&We!==Je.pipes?this:(We||(We=Je.pipes),Je.pipes=null,Je.pipesCount=0,Je.flowing=!1,We&&We.emit("unpipe",this,it),this);if(!We){var ze=Je.pipes,de=Je.pipesCount;Je.pipes=null,Je.pipesCount=0,Je.flowing=!1;for(var ve=0;ve<de;ve++)ze[ve].emit("unpipe",this,it);return this}var be=Ge(Je.pipes,We);return be===-1?this:(Je.pipes.splice(be,1),Je.pipesCount-=1,Je.pipesCount===1&&(Je.pipes=Je.pipes[0]),We.emit("unpipe",this,it),this)},J.prototype.on=function(We,Je){var it=m.prototype.on.call(this,We,Je);if(We==="data")this._readableState.flowing!==!1&&this.resume();else if(We==="readable"){var ze=this._readableState;!ze.endEmitted&&!ze.readableListening&&(ze.readableListening=ze.needReadable=!0,ze.emittedReadable=!1,ze.reading?ze.length&&Me(this):S.nextTick(Ce,this))}return it},J.prototype.addListener=J.prototype.on;function Ce(We){x("readable nexttick read 0"),We.read(0)}J.prototype.resume=function(){var We=this._readableState;return We.flowing||(x("resume"),We.flowing=!0,Be(this,We)),this};function Be(We,Je){Je.resumeScheduled||(Je.resumeScheduled=!0,S.nextTick(Ae,We,Je))}function Ae(We,Je){Je.reading||(x("resume read 0"),We.read(0)),Je.resumeScheduled=!1,Je.awaitDrain=0,We.emit("resume"),se(We),Je.flowing&&!Je.reading&&We.read(0)}J.prototype.pause=function(){return x("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(x("pause"),this._readableState.flowing=!1,this.emit("pause")),this};function se(We){var Je=We._readableState;for(x("flow",Je.flowing);Je.flowing&&We.read()!==null;);}J.prototype.wrap=function(We){var Je=this,it=this._readableState,ze=!1;We.on("end",function(){if(x("wrapped end"),it.decoder&&!it.ended){var be=it.decoder.end();be&&be.length&&Je.push(be)}Je.push(null)}),We.on("data",function(be){if(x("wrapped data"),it.decoder&&(be=it.decoder.write(be)),!(it.objectMode&&be==null)&&!(!it.objectMode&&(!be||!be.length))){var Oe=Je.push(be);Oe||(ze=!0,We.pause())}});for(var de in We)this[de]===void 0&&typeof We[de]=="function"&&(this[de]=function(be){return function(){return We[be].apply(We,arguments)}}(de));for(var ve=0;ve<Z.length;ve++)We.on(Z[ve],this.emit.bind(this,Z[ve]));return this._read=function(be){x("wrapped _read",be),ze&&(ze=!1,We.resume())},this},Object.defineProperty(J.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),J._fromList=pe;function pe(We,Je){if(Je.length===0)return null;var it;return Je.objectMode?it=Je.buffer.shift():!We||We>=Je.length?(Je.decoder?it=Je.buffer.join(""):Je.buffer.length===1?it=Je.buffer.head.data:it=Je.buffer.concat(Je.length),Je.buffer.clear()):it=Ke(We,Je.buffer,Je.decoder),it}function Ke(We,Je,it){var ze;return We<Je.head.data.length?(ze=Je.head.data.slice(0,We),Je.head.data=Je.head.data.slice(We)):We===Je.head.data.length?ze=Je.shift():ze=it?_e(We,Je):ke(We,Je),ze}function _e(We,Je){var it=Je.head,ze=1,de=it.data;for(We-=de.length;it=it.next;){var ve=it.data,be=We>ve.length?ve.length:We;if(be===ve.length?de+=ve:de+=ve.slice(0,We),We-=be,We===0){be===ve.length?(++ze,it.next?Je.head=it.next:Je.head=Je.tail=null):(Je.head=it,it.data=ve.slice(be));break}++ze}return Je.length-=ze,de}function ke(We,Je){var it=y.allocUnsafe(We),ze=Je.head,de=1;for(ze.data.copy(it),We-=ze.data.length;ze=ze.next;){var ve=ze.data,be=We>ve.length?ve.length:We;if(ve.copy(it,it.length-We,0,be),We-=be,We===0){be===ve.length?(++de,ze.next?Je.head=ze.next:Je.head=Je.tail=null):(Je.head=ze,ze.data=ve.slice(be));break}++de}return Je.length-=de,it}function qe(We){var Je=We._readableState;if(Je.length>0)throw new Error('"endReadable()" called on non-empty stream');Je.endEmitted||(Je.ended=!0,S.nextTick(tt,Je,We))}function tt(We,Je){!We.endEmitted&&We.length===0&&(We.endEmitted=!0,Je.readable=!1,Je.emit("end"))}function Ge(We,Je){for(var it=0,ze=We.length;it<ze;it++)if(We[it]===Je)return it;return-1}}).call(this,_("_process"),typeof Hr<"u"?Hr:typeof self<"u"?self:typeof v<"u"?v:{})},{"./_stream_duplex":139,"./internal/streams/BufferList":144,"./internal/streams/destroy":145,"./internal/streams/stream":146,_process:133,"core-util-is":51,events:52,inherits:75,isarray:79,"process-nextick-args":132,"safe-buffer":147,"string_decoder/":148,util:33}],142:[function(_,k,b){k.exports=D;var T=_("./_stream_duplex"),t=_("core-util-is");t.inherits=_("inherits"),t.inherits(D,T);function S(m,y){var p=this._transformState;p.transforming=!1;var C=p.writecb;if(!C)return this.emit("error",new Error("write callback called multiple times"));p.writechunk=null,p.writecb=null,y!=null&&this.push(y),C(m);var z=this._readableState;z.reading=!1,(z.needReadable||z.length<z.highWaterMark)&&this._read(z.highWaterMark)}function D(m){if(!(this instanceof D))return new D(m);T.call(this,m),this._transformState={afterTransform:S.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,m&&(typeof m.transform=="function"&&(this._transform=m.transform),typeof m.flush=="function"&&(this._flush=m.flush)),this.on("prefinish",w)}function w(){var m=this;typeof this._flush=="function"?this._flush(function(y,p){E(m,y,p)}):E(this,null,null)}D.prototype.push=function(m,y){return this._transformState.needTransform=!1,T.prototype.push.call(this,m,y)},D.prototype._transform=function(m,y,p){throw new Error("_transform() is not implemented")},D.prototype._write=function(m,y,p){var C=this._transformState;if(C.writecb=p,C.writechunk=m,C.writeencoding=y,!C.transforming){var z=this._readableState;(C.needTransform||z.needReadable||z.length<z.highWaterMark)&&this._read(z.highWaterMark)}},D.prototype._read=function(m){var y=this._transformState;y.writechunk!==null&&y.writecb&&!y.transforming?(y.transforming=!0,this._transform(y.writechunk,y.writeencoding,y.afterTransform)):y.needTransform=!0},D.prototype._destroy=function(m,y){var p=this;T.prototype._destroy.call(this,m,function(C){y(C),p.emit("close")})};function E(m,y,p){if(y)return m.emit("error",y);if(p!=null&&m.push(p),m._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(m._transformState.transforming)throw new Error("Calling transform done when still transforming");return m.push(null)}},{"./_stream_duplex":139,"core-util-is":51,inherits:75}],143:[function(_,k,b){(function(T,t,S){var D=_("process-nextick-args");k.exports=X;function w(Ae){var se=this;this.next=null,this.entry=null,this.finish=function(){Be(se,Ae)}}var E=!T.browser&&["v0.10","v0.9."].indexOf(T.version.slice(0,5))>-1?S:D.nextTick,m;X.WritableState=G;var y=_("core-util-is");y.inherits=_("inherits");var p={deprecate:_("util-deprecate")},C=_("./internal/streams/stream"),z=_("safe-buffer").Buffer,A=t.Uint8Array||function(){};function P(Ae){return z.from(Ae)}function x(Ae){return z.isBuffer(Ae)||Ae instanceof A}var O=_("./internal/streams/destroy");y.inherits(X,C);function U(){}function G(Ae,se){m=m||_("./_stream_duplex"),Ae=Ae||{};var pe=se instanceof m;this.objectMode=!!Ae.objectMode,pe&&(this.objectMode=this.objectMode||!!Ae.writableObjectMode);var Ke=Ae.highWaterMark,_e=Ae.writableHighWaterMark,ke=this.objectMode?16:16*1024;Ke||Ke===0?this.highWaterMark=Ke:pe&&(_e||_e===0)?this.highWaterMark=_e:this.highWaterMark=ke,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var qe=Ae.decodeStrings===!1;this.decodeStrings=!qe,this.defaultEncoding=Ae.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(tt){Le(se,tt)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new w(this)}G.prototype.getBuffer=function(){for(var se=this.bufferedRequest,pe=[];se;)pe.push(se),se=se.next;return pe},function(){try{Object.defineProperty(G.prototype,"buffer",{get:p.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var Z;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(Z=Function.prototype[Symbol.hasInstance],Object.defineProperty(X,Symbol.hasInstance,{value:function(Ae){return Z.call(this,Ae)?!0:this!==X?!1:Ae&&Ae._writableState instanceof G}})):Z=function(Ae){return Ae instanceof this};function X(Ae){if(m=m||_("./_stream_duplex"),!Z.call(X,this)&&!(this instanceof m))return new X(Ae);this._writableState=new G(Ae,this),this.writable=!0,Ae&&(typeof Ae.write=="function"&&(this._write=Ae.write),typeof Ae.writev=="function"&&(this._writev=Ae.writev),typeof Ae.destroy=="function"&&(this._destroy=Ae.destroy),typeof Ae.final=="function"&&(this._final=Ae.final)),C.call(this)}X.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function W(Ae,se){var pe=new Error("write after end");Ae.emit("error",pe),D.nextTick(se,pe)}function J(Ae,se,pe,Ke){var _e=!0,ke=!1;return pe===null?ke=new TypeError("May not write null values to stream"):typeof pe!="string"&&pe!==void 0&&!se.objectMode&&(ke=new TypeError("Invalid non-string/buffer chunk")),ke&&(Ae.emit("error",ke),D.nextTick(Ke,ke),_e=!1),_e}X.prototype.write=function(Ae,se,pe){var Ke=this._writableState,_e=!1,ke=!Ke.objectMode&&x(Ae);return ke&&!z.isBuffer(Ae)&&(Ae=P(Ae)),typeof se=="function"&&(pe=se,se=null),ke?se="buffer":se||(se=Ke.defaultEncoding),typeof pe!="function"&&(pe=U),Ke.ended?W(this,pe):(ke||J(this,Ke,Ae,pe))&&(Ke.pendingcb++,_e=te(this,Ke,ke,Ae,se,pe)),_e},X.prototype.cork=function(){var Ae=this._writableState;Ae.corked++},X.prototype.uncork=function(){var Ae=this._writableState;Ae.corked&&(Ae.corked--,!Ae.writing&&!Ae.corked&&!Ae.finished&&!Ae.bufferProcessing&&Ae.bufferedRequest&&Me(this,Ae))},X.prototype.setDefaultEncoding=function(se){if(typeof se=="string"&&(se=se.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((se+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+se);return this._writableState.defaultEncoding=se,this};function re(Ae,se,pe){return!Ae.objectMode&&Ae.decodeStrings!==!1&&typeof se=="string"&&(se=z.from(se,pe)),se}Object.defineProperty(X.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function te(Ae,se,pe,Ke,_e,ke){if(!pe){var qe=re(se,Ke,_e);Ke!==qe&&(pe=!0,_e="buffer",Ke=qe)}var tt=se.objectMode?1:Ke.length;se.length+=tt;var Ge=se.length<se.highWaterMark;if(Ge||(se.needDrain=!0),se.writing||se.corked){var We=se.lastBufferedRequest;se.lastBufferedRequest={chunk:Ke,encoding:_e,isBuf:pe,callback:ke,next:null},We?We.next=se.lastBufferedRequest:se.bufferedRequest=se.lastBufferedRequest,se.bufferedRequestCount+=1}else ye(Ae,se,!1,tt,Ke,_e,ke);return Ge}function ye(Ae,se,pe,Ke,_e,ke,qe){se.writelen=Ke,se.writecb=qe,se.writing=!0,se.sync=!0,pe?Ae._writev(_e,se.onwrite):Ae._write(_e,ke,se.onwrite),se.sync=!1}function ue(Ae,se,pe,Ke,_e){--se.pendingcb,pe?(D.nextTick(_e,Ke),D.nextTick(Fe,Ae,se),Ae._writableState.errorEmitted=!0,Ae.emit("error",Ke)):(_e(Ke),Ae._writableState.errorEmitted=!0,Ae.emit("error",Ke),Fe(Ae,se))}function Se(Ae){Ae.writing=!1,Ae.writecb=null,Ae.length-=Ae.writelen,Ae.writelen=0}function Le(Ae,se){var pe=Ae._writableState,Ke=pe.sync,_e=pe.writecb;if(Se(pe),se)ue(Ae,pe,Ke,se,_e);else{var ke=He(pe);!ke&&!pe.corked&&!pe.bufferProcessing&&pe.bufferedRequest&&Me(Ae,pe),Ke?E(Pe,Ae,pe,ke,_e):Pe(Ae,pe,ke,_e)}}function Pe(Ae,se,pe,Ke){pe||Ee(Ae,se),se.pendingcb--,Ke(),Fe(Ae,se)}function Ee(Ae,se){se.length===0&&se.needDrain&&(se.needDrain=!1,Ae.emit("drain"))}function Me(Ae,se){se.bufferProcessing=!0;var pe=se.bufferedRequest;if(Ae._writev&&pe&&pe.next){var Ke=se.bufferedRequestCount,_e=new Array(Ke),ke=se.corkedRequestsFree;ke.entry=pe;for(var qe=0,tt=!0;pe;)_e[qe]=pe,pe.isBuf||(tt=!1),pe=pe.next,qe+=1;_e.allBuffers=tt,ye(Ae,se,!0,se.length,_e,"",ke.finish),se.pendingcb++,se.lastBufferedRequest=null,ke.next?(se.corkedRequestsFree=ke.next,ke.next=null):se.corkedRequestsFree=new w(se),se.bufferedRequestCount=0}else{for(;pe;){var Ge=pe.chunk,We=pe.encoding,Je=pe.callback,it=se.objectMode?1:Ge.length;if(ye(Ae,se,!1,it,Ge,We,Je),pe=pe.next,se.bufferedRequestCount--,se.writing)break}pe===null&&(se.lastBufferedRequest=null)}se.bufferedRequest=pe,se.bufferProcessing=!1}X.prototype._write=function(Ae,se,pe){pe(new Error("_write() is not implemented"))},X.prototype._writev=null,X.prototype.end=function(Ae,se,pe){var Ke=this._writableState;typeof Ae=="function"?(pe=Ae,Ae=null,se=null):typeof se=="function"&&(pe=se,se=null),Ae!=null&&this.write(Ae,se),Ke.corked&&(Ke.corked=1,this.uncork()),!Ke.ending&&!Ke.finished&&Ce(this,Ke,pe)};function He(Ae){return Ae.ending&&Ae.length===0&&Ae.bufferedRequest===null&&!Ae.finished&&!Ae.writing}function nt(Ae,se){Ae._final(function(pe){se.pendingcb--,pe&&Ae.emit("error",pe),se.prefinished=!0,Ae.emit("prefinish"),Fe(Ae,se)})}function ht(Ae,se){!se.prefinished&&!se.finalCalled&&(typeof Ae._final=="function"?(se.pendingcb++,se.finalCalled=!0,D.nextTick(nt,Ae,se)):(se.prefinished=!0,Ae.emit("prefinish")))}function Fe(Ae,se){var pe=He(se);return pe&&(ht(Ae,se),se.pendingcb===0&&(se.finished=!0,Ae.emit("finish"))),pe}function Ce(Ae,se,pe){se.ending=!0,Fe(Ae,se),pe&&(se.finished?D.nextTick(pe):Ae.once("finish",pe)),se.ended=!0,Ae.writable=!1}function Be(Ae,se,pe){var Ke=Ae.entry;for(Ae.entry=null;Ke;){var _e=Ke.callback;se.pendingcb--,_e(pe),Ke=Ke.next}se.corkedRequestsFree?se.corkedRequestsFree.next=Ae:se.corkedRequestsFree=Ae}Object.defineProperty(X.prototype,"destroyed",{get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(Ae){this._writableState&&(this._writableState.destroyed=Ae)}}),X.prototype.destroy=O.destroy,X.prototype._undestroy=O.undestroy,X.prototype._destroy=function(Ae,se){this.end(),se(Ae)}}).call(this,_("_process"),typeof Hr<"u"?Hr:typeof self<"u"?self:typeof v<"u"?v:{},_("timers").setImmediate)},{"./_stream_duplex":139,"./internal/streams/destroy":145,"./internal/streams/stream":146,_process:133,"core-util-is":51,inherits:75,"process-nextick-args":132,"safe-buffer":147,timers:176,"util-deprecate":183}],144:[function(_,k,b){function T(w,E){if(!(w instanceof E))throw new TypeError("Cannot call a class as a function")}var t=_("safe-buffer").Buffer,S=_("util");function D(w,E,m){w.copy(E,m)}k.exports=function(){function w(){T(this,w),this.head=null,this.tail=null,this.length=0}return w.prototype.push=function(m){var y={data:m,next:null};this.length>0?this.tail.next=y:this.head=y,this.tail=y,++this.length},w.prototype.unshift=function(m){var y={data:m,next:this.head};this.length===0&&(this.tail=y),this.head=y,++this.length},w.prototype.shift=function(){if(this.length!==0){var m=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,m}},w.prototype.clear=function(){this.head=this.tail=null,this.length=0},w.prototype.join=function(m){if(this.length===0)return"";for(var y=this.head,p=""+y.data;y=y.next;)p+=m+y.data;return p},w.prototype.concat=function(m){if(this.length===0)return t.alloc(0);if(this.length===1)return this.head.data;for(var y=t.allocUnsafe(m>>>0),p=this.head,C=0;p;)D(p.data,y,C),C+=p.data.length,p=p.next;return y},w}(),S&&S.inspect&&S.inspect.custom&&(k.exports.prototype[S.inspect.custom]=function(){var w=S.inspect({length:this.length});return this.constructor.name+" "+w})},{"safe-buffer":147,util:33}],145:[function(_,k,b){var T=_("process-nextick-args");function t(w,E){var m=this,y=this._readableState&&this._readableState.destroyed,p=this._writableState&&this._writableState.destroyed;return y||p?(E?E(w):w&&(!this._writableState||!this._writableState.errorEmitted)&&T.nextTick(D,this,w),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(w||null,function(C){!E&&C?(T.nextTick(D,m,C),m._writableState&&(m._writableState.errorEmitted=!0)):E&&E(C)}),this)}function S(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function D(w,E){w.emit("error",E)}k.exports={destroy:t,undestroy:S}},{"process-nextick-args":132}],146:[function(_,k,b){k.exports=_("events").EventEmitter},{events:52}],147:[function(_,k,b){var T=_("buffer"),t=T.Buffer;function S(w,E){for(var m in w)E[m]=w[m]}t.from&&t.alloc&&t.allocUnsafe&&t.allocUnsafeSlow?k.exports=T:(S(T,b),b.Buffer=D);function D(w,E,m){return t(w,E,m)}S(t,D),D.from=function(w,E,m){if(typeof w=="number")throw new TypeError("Argument must not be a number");return t(w,E,m)},D.alloc=function(w,E,m){if(typeof w!="number")throw new TypeError("Argument must be a number");var y=t(w);return E!==void 0?typeof m=="string"?y.fill(E,m):y.fill(E):y.fill(0),y},D.allocUnsafe=function(w){if(typeof w!="number")throw new TypeError("Argument must be a number");return t(w)},D.allocUnsafeSlow=function(w){if(typeof w!="number")throw new TypeError("Argument must be a number");return T.SlowBuffer(w)}},{buffer:48}],148:[function(_,k,b){var T=_("safe-buffer").Buffer,t=T.isEncoding||function(Z){switch(Z=""+Z,Z&&Z.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function S(Z){if(!Z)return"utf8";for(var X;;)switch(Z){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return Z;default:if(X)return;Z=(""+Z).toLowerCase(),X=!0}}function D(Z){var X=S(Z);if(typeof X!="string"&&(T.isEncoding===t||!t(Z)))throw new Error("Unknown encoding: "+Z);return X||Z}b.StringDecoder=w;function w(Z){this.encoding=D(Z);var X;switch(this.encoding){case"utf16le":this.text=A,this.end=P,X=4;break;case"utf8":this.fillLast=p,X=4;break;case"base64":this.text=x,this.end=O,X=3;break;default:this.write=U,this.end=G;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=T.allocUnsafe(X)}w.prototype.write=function(Z){if(Z.length===0)return"";var X,W;if(this.lastNeed){if(X=this.fillLast(Z),X===void 0)return"";W=this.lastNeed,this.lastNeed=0}else W=0;return W<Z.length?X?X+this.text(Z,W):this.text(Z,W):X||""},w.prototype.end=z,w.prototype.text=C,w.prototype.fillLast=function(Z){if(this.lastNeed<=Z.length)return Z.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);Z.copy(this.lastChar,this.lastTotal-this.lastNeed,0,Z.length),this.lastNeed-=Z.length};function E(Z){return Z<=127?0:Z>>5===6?2:Z>>4===14?3:Z>>3===30?4:Z>>6===2?-1:-2}function m(Z,X,W){var J=X.length-1;if(J<W)return 0;var re=E(X[J]);return re>=0?(re>0&&(Z.lastNeed=re-1),re):--J<W||re===-2?0:(re=E(X[J]),re>=0?(re>0&&(Z.lastNeed=re-2),re):--J<W||re===-2?0:(re=E(X[J]),re>=0?(re>0&&(re===2?re=0:Z.lastNeed=re-3),re):0))}function y(Z,X,W){if((X[0]&192)!==128)return Z.lastNeed=0,"�";if(Z.lastNeed>1&&X.length>1){if((X[1]&192)!==128)return Z.lastNeed=1,"�";if(Z.lastNeed>2&&X.length>2&&(X[2]&192)!==128)return Z.lastNeed=2,"�"}}function p(Z){var X=this.lastTotal-this.lastNeed,W=y(this,Z);if(W!==void 0)return W;if(this.lastNeed<=Z.length)return Z.copy(this.lastChar,X,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);Z.copy(this.lastChar,X,0,Z.length),this.lastNeed-=Z.length}function C(Z,X){var W=m(this,Z,X);if(!this.lastNeed)return Z.toString("utf8",X);this.lastTotal=W;var J=Z.length-(W-this.lastNeed);return Z.copy(this.lastChar,0,J),Z.toString("utf8",X,J)}function z(Z){var X=Z&&Z.length?this.write(Z):"";return this.lastNeed?X+"�":X}function A(Z,X){if((Z.length-X)%2===0){var W=Z.toString("utf16le",X);if(W){var J=W.charCodeAt(W.length-1);if(J>=55296&&J<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=Z[Z.length-2],this.lastChar[1]=Z[Z.length-1],W.slice(0,-1)}return W}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=Z[Z.length-1],Z.toString("utf16le",X,Z.length-1)}function P(Z){var X=Z&&Z.length?this.write(Z):"";if(this.lastNeed){var W=this.lastTotal-this.lastNeed;return X+this.lastChar.toString("utf16le",0,W)}return X}function x(Z,X){var W=(Z.length-X)%3;return W===0?Z.toString("base64",X):(this.lastNeed=3-W,this.lastTotal=3,W===1?this.lastChar[0]=Z[Z.length-1]:(this.lastChar[0]=Z[Z.length-2],this.lastChar[1]=Z[Z.length-1]),Z.toString("base64",X,Z.length-W))}function O(Z){var X=Z&&Z.length?this.write(Z):"";return this.lastNeed?X+this.lastChar.toString("base64",0,3-this.lastNeed):X}function U(Z){return Z.toString(this.encoding)}function G(Z){return Z&&Z.length?this.write(Z):""}},{"safe-buffer":147}],149:[function(_,k,b){k.exports=_("./readable").PassThrough},{"./readable":150}],150:[function(_,k,b){b=k.exports=_("./lib/_stream_readable.js"),b.Stream=b,b.Readable=b,b.Writable=_("./lib/_stream_writable.js"),b.Duplex=_("./lib/_stream_duplex.js"),b.Transform=_("./lib/_stream_transform.js"),b.PassThrough=_("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":139,"./lib/_stream_passthrough.js":140,"./lib/_stream_readable.js":141,"./lib/_stream_transform.js":142,"./lib/_stream_writable.js":143}],151:[function(_,k,b){k.exports=_("./readable").Transform},{"./readable":150}],152:[function(_,k,b){k.exports=_("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":143}],153:[function(_,k,b){var T=function(t){var S=Object.prototype,D=S.hasOwnProperty,w,E=typeof Symbol=="function"?Symbol:{},m=E.iterator||"@@iterator",y=E.asyncIterator||"@@asyncIterator",p=E.toStringTag||"@@toStringTag";function C(ht,Fe,Ce,Be){var Ae=Fe&&Fe.prototype instanceof G?Fe:G,se=Object.create(Ae.prototype),pe=new Me(Be||[]);return se._invoke=Se(ht,Ce,pe),se}t.wrap=C;function z(ht,Fe,Ce){try{return{type:"normal",arg:ht.call(Fe,Ce)}}catch(Be){return{type:"throw",arg:Be}}}var A="suspendedStart",P="suspendedYield",x="executing",O="completed",U={};function G(){}function Z(){}function X(){}var W={};W[m]=function(){return this};var J=Object.getPrototypeOf,re=J&&J(J(He([])));re&&re!==S&&D.call(re,m)&&(W=re);var te=X.prototype=G.prototype=Object.create(W);Z.prototype=te.constructor=X,X.constructor=Z,X[p]=Z.displayName="GeneratorFunction";function ye(ht){["next","throw","return"].forEach(function(Fe){ht[Fe]=function(Ce){return this._invoke(Fe,Ce)}})}t.isGeneratorFunction=function(ht){var Fe=typeof ht=="function"&&ht.constructor;return Fe?Fe===Z||(Fe.displayName||Fe.name)==="GeneratorFunction":!1},t.mark=function(ht){return Object.setPrototypeOf?Object.setPrototypeOf(ht,X):(ht.__proto__=X,p in ht||(ht[p]="GeneratorFunction")),ht.prototype=Object.create(te),ht},t.awrap=function(ht){return{__await:ht}};function ue(ht){function Fe(Ae,se,pe,Ke){var _e=z(ht[Ae],ht,se);if(_e.type==="throw")Ke(_e.arg);else{var ke=_e.arg,qe=ke.value;return qe&&typeof qe=="object"&&D.call(qe,"__await")?Promise.resolve(qe.__await).then(function(tt){Fe("next",tt,pe,Ke)},function(tt){Fe("throw",tt,pe,Ke)}):Promise.resolve(qe).then(function(tt){ke.value=tt,pe(ke)},function(tt){return Fe("throw",tt,pe,Ke)})}}var Ce;function Be(Ae,se){function pe(){return new Promise(function(Ke,_e){Fe(Ae,se,Ke,_e)})}return Ce=Ce?Ce.then(pe,pe):pe()}this._invoke=Be}ye(ue.prototype),ue.prototype[y]=function(){return this},t.AsyncIterator=ue,t.async=function(ht,Fe,Ce,Be){var Ae=new ue(C(ht,Fe,Ce,Be));return t.isGeneratorFunction(Fe)?Ae:Ae.next().then(function(se){return se.done?se.value:Ae.next()})};function Se(ht,Fe,Ce){var Be=A;return function(se,pe){if(Be===x)throw new Error("Generator is already running");if(Be===O){if(se==="throw")throw pe;return nt()}for(Ce.method=se,Ce.arg=pe;;){var Ke=Ce.delegate;if(Ke){var _e=Le(Ke,Ce);if(_e){if(_e===U)continue;return _e}}if(Ce.method==="next")Ce.sent=Ce._sent=Ce.arg;else if(Ce.method==="throw"){if(Be===A)throw Be=O,Ce.arg;Ce.dispatchException(Ce.arg)}else Ce.method==="return"&&Ce.abrupt("return",Ce.arg);Be=x;var ke=z(ht,Fe,Ce);if(ke.type==="normal"){if(Be=Ce.done?O:P,ke.arg===U)continue;return{value:ke.arg,done:Ce.done}}else ke.type==="throw"&&(Be=O,Ce.method="throw",Ce.arg=ke.arg)}}}function Le(ht,Fe){var Ce=ht.iterator[Fe.method];if(Ce===w){if(Fe.delegate=null,Fe.method==="throw"){if(ht.iterator.return&&(Fe.method="return",Fe.arg=w,Le(ht,Fe),Fe.method==="throw"))return U;Fe.method="throw",Fe.arg=new TypeError("The iterator does not provide a 'throw' method")}return U}var Be=z(Ce,ht.iterator,Fe.arg);if(Be.type==="throw")return Fe.method="throw",Fe.arg=Be.arg,Fe.delegate=null,U;var Ae=Be.arg;if(!Ae)return Fe.method="throw",Fe.arg=new TypeError("iterator result is not an object"),Fe.delegate=null,U;if(Ae.done)Fe[ht.resultName]=Ae.value,Fe.next=ht.nextLoc,Fe.method!=="return"&&(Fe.method="next",Fe.arg=w);else return Ae;return Fe.delegate=null,U}ye(te),te[p]="Generator",te[m]=function(){return this},te.toString=function(){return"[object Generator]"};function Pe(ht){var Fe={tryLoc:ht[0]};1 in ht&&(Fe.catchLoc=ht[1]),2 in ht&&(Fe.finallyLoc=ht[2],Fe.afterLoc=ht[3]),this.tryEntries.push(Fe)}function Ee(ht){var Fe=ht.completion||{};Fe.type="normal",delete Fe.arg,ht.completion=Fe}function Me(ht){this.tryEntries=[{tryLoc:"root"}],ht.forEach(Pe,this),this.reset(!0)}t.keys=function(ht){var Fe=[];for(var Ce in ht)Fe.push(Ce);return Fe.reverse(),function Be(){for(;Fe.length;){var Ae=Fe.pop();if(Ae in ht)return Be.value=Ae,Be.done=!1,Be}return Be.done=!0,Be}};function He(ht){if(ht){var Fe=ht[m];if(Fe)return Fe.call(ht);if(typeof ht.next=="function")return ht;if(!isNaN(ht.length)){var Ce=-1,Be=function Ae(){for(;++Ce<ht.length;)if(D.call(ht,Ce))return Ae.value=ht[Ce],Ae.done=!1,Ae;return Ae.value=w,Ae.done=!0,Ae};return Be.next=Be}}return{next:nt}}t.values=He;function nt(){return{value:w,done:!0}}return Me.prototype={constructor:Me,reset:function(ht){if(this.prev=0,this.next=0,this.sent=this._sent=w,this.done=!1,this.delegate=null,this.method="next",this.arg=w,this.tryEntries.forEach(Ee),!ht)for(var Fe in this)Fe.charAt(0)==="t"&&D.call(this,Fe)&&!isNaN(+Fe.slice(1))&&(this[Fe]=w)},stop:function(){this.done=!0;var ht=this.tryEntries[0],Fe=ht.completion;if(Fe.type==="throw")throw Fe.arg;return this.rval},dispatchException:function(ht){if(this.done)throw ht;var Fe=this;function Ce(_e,ke){return se.type="throw",se.arg=ht,Fe.next=_e,ke&&(Fe.method="next",Fe.arg=w),!!ke}for(var Be=this.tryEntries.length-1;Be>=0;--Be){var Ae=this.tryEntries[Be],se=Ae.completion;if(Ae.tryLoc==="root")return Ce("end");if(Ae.tryLoc<=this.prev){var pe=D.call(Ae,"catchLoc"),Ke=D.call(Ae,"finallyLoc");if(pe&&Ke){if(this.prev<Ae.catchLoc)return Ce(Ae.catchLoc,!0);if(this.prev<Ae.finallyLoc)return Ce(Ae.finallyLoc)}else if(pe){if(this.prev<Ae.catchLoc)return Ce(Ae.catchLoc,!0)}else if(Ke){if(this.prev<Ae.finallyLoc)return Ce(Ae.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(ht,Fe){for(var Ce=this.tryEntries.length-1;Ce>=0;--Ce){var Be=this.tryEntries[Ce];if(Be.tryLoc<=this.prev&&D.call(Be,"finallyLoc")&&this.prev<Be.finallyLoc){var Ae=Be;break}}Ae&&(ht==="break"||ht==="continue")&&Ae.tryLoc<=Fe&&Fe<=Ae.finallyLoc&&(Ae=null);var se=Ae?Ae.completion:{};return se.type=ht,se.arg=Fe,Ae?(this.method="next",this.next=Ae.finallyLoc,U):this.complete(se)},complete:function(ht,Fe){if(ht.type==="throw")throw ht.arg;return ht.type==="break"||ht.type==="continue"?this.next=ht.arg:ht.type==="return"?(this.rval=this.arg=ht.arg,this.method="return",this.next="end"):ht.type==="normal"&&Fe&&(this.next=Fe),U},finish:function(ht){for(var Fe=this.tryEntries.length-1;Fe>=0;--Fe){var Ce=this.tryEntries[Fe];if(Ce.finallyLoc===ht)return this.complete(Ce.completion,Ce.afterLoc),Ee(Ce),U}},catch:function(ht){for(var Fe=this.tryEntries.length-1;Fe>=0;--Fe){var Ce=this.tryEntries[Fe];if(Ce.tryLoc===ht){var Be=Ce.completion;if(Be.type==="throw"){var Ae=Be.arg;Ee(Ce)}return Ae}}throw new Error("illegal catch attempt")},delegateYield:function(ht,Fe,Ce){return this.delegate={iterator:He(ht),resultName:Fe,nextLoc:Ce},this.method==="next"&&(this.arg=w),U}},t}(typeof k=="object"?k.exports:{});try{regeneratorRuntime=T}catch{Function("r","regeneratorRuntime = r")(T)}},{}],154:[function(_,k,b){var T=_("buffer"),t=T.Buffer;function S(w,E){for(var m in w)E[m]=w[m]}t.from&&t.alloc&&t.allocUnsafe&&t.allocUnsafeSlow?k.exports=T:(S(T,b),b.Buffer=D);function D(w,E,m){return t(w,E,m)}D.prototype=Object.create(t.prototype),S(t,D),D.from=function(w,E,m){if(typeof w=="number")throw new TypeError("Argument must not be a number");return t(w,E,m)},D.alloc=function(w,E,m){if(typeof w!="number")throw new TypeError("Argument must be a number");var y=t(w);return E!==void 0?typeof m=="string"?y.fill(E,m):y.fill(E):y.fill(0),y},D.allocUnsafe=function(w){if(typeof w!="number")throw new TypeError("Argument must be a number");return t(w)},D.allocUnsafeSlow=function(w){if(typeof w!="number")throw new TypeError("Argument must be a number");return T.SlowBuffer(w)}},{buffer:48}],155:[function(_,k,b){k.exports=S;var T=_("events").EventEmitter,t=_("inherits");t(S,T),S.Readable=_("readable-stream/readable.js"),S.Writable=_("readable-stream/writable.js"),S.Duplex=_("readable-stream/duplex.js"),S.Transform=_("readable-stream/transform.js"),S.PassThrough=_("readable-stream/passthrough.js"),S.Stream=S;function S(){T.call(this)}S.prototype.pipe=function(D,w){var E=this;function m(x){D.writable&&D.write(x)===!1&&E.pause&&E.pause()}E.on("data",m);function y(){E.readable&&E.resume&&E.resume()}D.on("drain",y),!D._isStdio&&(!w||w.end!==!1)&&(E.on("end",C),E.on("close",z));var p=!1;function C(){p||(p=!0,D.end())}function z(){p||(p=!0,typeof D.destroy=="function"&&D.destroy())}function A(x){if(P(),T.listenerCount(this,"error")===0)throw x}E.on("error",A),D.on("error",A);function P(){E.removeListener("data",m),D.removeListener("drain",y),E.removeListener("end",C),E.removeListener("close",z),E.removeListener("error",A),D.removeListener("error",A),E.removeListener("end",P),E.removeListener("close",P),D.removeListener("close",P)}return E.on("end",P),E.on("close",P),D.on("close",P),D.emit("pipe",E),D}},{events:52,inherits:75,"readable-stream/duplex.js":138,"readable-stream/passthrough.js":149,"readable-stream/readable.js":150,"readable-stream/transform.js":151,"readable-stream/writable.js":152}],156:[function(_,k,b){(function(T){var t=_("./lib/request"),S=_("./lib/response"),D=_("xtend"),w=_("builtin-status-codes"),E=_("url"),m=b;m.request=function(y,p){typeof y=="string"?y=E.parse(y):y=D(y);var C=T.location.protocol.search(/^https?:$/)===-1?"http:":"",z=y.protocol||C,A=y.hostname||y.host,P=y.port,x=y.path||"/";A&&A.indexOf(":")!==-1&&(A="["+A+"]"),y.url=(A?z+"//"+A:"")+(P?":"+P:"")+x,y.method=(y.method||"GET").toUpperCase(),y.headers=y.headers||{};var O=new t(y);return p&&O.on("response",p),O},m.get=function(p,C){var z=m.request(p,C);return z.end(),z},m.ClientRequest=t,m.IncomingMessage=S.IncomingMessage,m.Agent=function(){},m.Agent.defaultMaxSockets=4,m.globalAgent=new m.Agent,m.STATUS_CODES=w,m.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]}).call(this,typeof Hr<"u"?Hr:typeof self<"u"?self:typeof v<"u"?v:{})},{"./lib/request":158,"./lib/response":159,"builtin-status-codes":50,url:180,xtend:189}],157:[function(_,k,b){(function(T){b.fetch=w(T.fetch)&&w(T.ReadableStream),b.writableStream=w(T.WritableStream),b.abortController=w(T.AbortController);var t;function S(){if(t!==void 0)return t;if(T.XMLHttpRequest){t=new T.XMLHttpRequest;try{t.open("GET",T.XDomainRequest?"/":"https://example.com")}catch{t=null}}else t=null;return t}function D(E){var m=S();if(!m)return!1;try{return m.responseType=E,m.responseType===E}catch{}return!1}b.arraybuffer=b.fetch||D("arraybuffer"),b.msstream=!b.fetch&&D("ms-stream"),b.mozchunkedarraybuffer=!b.fetch&&D("moz-chunked-arraybuffer"),b.overrideMimeType=b.fetch||(S()?w(S().overrideMimeType):!1);function w(E){return typeof E=="function"}t=null}).call(this,typeof Hr<"u"?Hr:typeof self<"u"?self:typeof v<"u"?v:{})},{}],158:[function(_,k,b){(function(T,t,S){var D=_("./capability"),w=_("inherits"),E=_("./response"),m=_("readable-stream"),y=E.IncomingMessage,p=E.readyStates;function C(x,O){return D.fetch&&O?"fetch":D.mozchunkedarraybuffer?"moz-chunked-arraybuffer":D.msstream?"ms-stream":D.arraybuffer&&x?"arraybuffer":"text"}var z=k.exports=function(x){var O=this;m.Writable.call(O),O._opts=x,O._body=[],O._headers={},x.auth&&O.setHeader("Authorization","Basic "+S.from(x.auth).toString("base64")),Object.keys(x.headers).forEach(function(Z){O.setHeader(Z,x.headers[Z])});var U,G=!0;if(x.mode==="disable-fetch"||"requestTimeout"in x&&!D.abortController)G=!1,U=!0;else if(x.mode==="prefer-streaming")U=!1;else if(x.mode==="allow-wrong-content-type")U=!D.overrideMimeType;else if(!x.mode||x.mode==="default"||x.mode==="prefer-fast")U=!0;else throw new Error("Invalid value for opts.mode");O._mode=C(U,G),O._fetchTimer=null,O.on("finish",function(){O._onFinish()})};w(z,m.Writable),z.prototype.setHeader=function(x,O){var U=this,G=x.toLowerCase();P.indexOf(G)===-1&&(U._headers[G]={name:x,value:O})},z.prototype.getHeader=function(x){var O=this._headers[x.toLowerCase()];return O?O.value:null},z.prototype.removeHeader=function(x){var O=this;delete O._headers[x.toLowerCase()]},z.prototype._onFinish=function(){var x=this;if(!x._destroyed){var O=x._opts,U=x._headers,G=null;O.method!=="GET"&&O.method!=="HEAD"&&(G=new Blob(x._body,{type:(U["content-type"]||{}).value||""}));var Z=[];if(Object.keys(U).forEach(function(re){var te=U[re].name,ye=U[re].value;Array.isArray(ye)?ye.forEach(function(ue){Z.push([te,ue])}):Z.push([te,ye])}),x._mode==="fetch"){var X=null;if(D.abortController){var W=new AbortController;X=W.signal,x._fetchAbortController=W,"requestTimeout"in O&&O.requestTimeout!==0&&(x._fetchTimer=t.setTimeout(function(){x.emit("requestTimeout"),x._fetchAbortController&&x._fetchAbortController.abort()},O.requestTimeout))}t.fetch(x._opts.url,{method:x._opts.method,headers:Z,body:G||void 0,mode:"cors",credentials:O.withCredentials?"include":"same-origin",signal:X}).then(function(re){x._fetchResponse=re,x._connect()},function(re){t.clearTimeout(x._fetchTimer),x._destroyed||x.emit("error",re)})}else{var J=x._xhr=new t.XMLHttpRequest;try{J.open(x._opts.method,x._opts.url,!0)}catch(re){T.nextTick(function(){x.emit("error",re)});return}"responseType"in J&&(J.responseType=x._mode),"withCredentials"in J&&(J.withCredentials=!!O.withCredentials),x._mode==="text"&&"overrideMimeType"in J&&J.overrideMimeType("text/plain; charset=x-user-defined"),"requestTimeout"in O&&(J.timeout=O.requestTimeout,J.ontimeout=function(){x.emit("requestTimeout")}),Z.forEach(function(re){J.setRequestHeader(re[0],re[1])}),x._response=null,J.onreadystatechange=function(){switch(J.readyState){case p.LOADING:case p.DONE:x._onXHRProgress();break}},x._mode==="moz-chunked-arraybuffer"&&(J.onprogress=function(){x._onXHRProgress()}),J.onerror=function(){x._destroyed||x.emit("error",new Error("XHR error"))};try{J.send(G)}catch(re){T.nextTick(function(){x.emit("error",re)});return}}}};function A(x){try{var O=x.status;return O!==null&&O!==0}catch{return!1}}z.prototype._onXHRProgress=function(){var x=this;!A(x._xhr)||x._destroyed||(x._response||x._connect(),x._response._onXHRProgress())},z.prototype._connect=function(){var x=this;x._destroyed||(x._response=new y(x._xhr,x._fetchResponse,x._mode,x._fetchTimer),x._response.on("error",function(O){x.emit("error",O)}),x.emit("response",x._response))},z.prototype._write=function(x,O,U){var G=this;G._body.push(x),U()},z.prototype.abort=z.prototype.destroy=function(){var x=this;x._destroyed=!0,t.clearTimeout(x._fetchTimer),x._response&&(x._response._destroyed=!0),x._xhr?x._xhr.abort():x._fetchAbortController&&x._fetchAbortController.abort()},z.prototype.end=function(x,O,U){var G=this;typeof x=="function"&&(U=x,x=void 0),m.Writable.prototype.end.call(G,x,O,U)},z.prototype.flushHeaders=function(){},z.prototype.setTimeout=function(){},z.prototype.setNoDelay=function(){},z.prototype.setSocketKeepAlive=function(){};var P=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"]}).call(this,_("_process"),typeof Hr<"u"?Hr:typeof self<"u"?self:typeof v<"u"?v:{},_("buffer").Buffer)},{"./capability":157,"./response":159,_process:133,buffer:48,inherits:75,"readable-stream":174}],159:[function(_,k,b){(function(T,t,S){var D=_("./capability"),w=_("inherits"),E=_("readable-stream"),m=b.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},y=b.IncomingMessage=function(p,C,z,A){var P=this;if(E.Readable.call(P),P._mode=z,P.headers={},P.rawHeaders=[],P.trailers={},P.rawTrailers=[],P.on("end",function(){T.nextTick(function(){P.emit("close")})}),z==="fetch"){let X=function(){O.read().then(function(W){if(!P._destroyed){if(W.done){t.clearTimeout(A),P.push(null);return}P.push(S.from(W.value)),X()}}).catch(function(W){t.clearTimeout(A),P._destroyed||P.emit("error",W)})};if(P._fetchResponse=C,P.url=C.url,P.statusCode=C.status,P.statusMessage=C.statusText,C.headers.forEach(function(W,J){P.headers[J.toLowerCase()]=W,P.rawHeaders.push(J,W)}),D.writableStream){var x=new WritableStream({write:function(W){return new Promise(function(J,re){P._destroyed?re():P.push(S.from(W))?J():P._resumeFetch=J})},close:function(){t.clearTimeout(A),P._destroyed||P.push(null)},abort:function(W){P._destroyed||P.emit("error",W)}});try{C.body.pipeTo(x).catch(function(W){t.clearTimeout(A),P._destroyed||P.emit("error",W)});return}catch{}}var O=C.body.getReader();X()}else{P._xhr=p,P._pos=0,P.url=p.responseURL,P.statusCode=p.status,P.statusMessage=p.statusText;var U=p.getAllResponseHeaders().split(/\r?\n/);if(U.forEach(function(X){var W=X.match(/^([^:]+):\s*(.*)/);if(W){var J=W[1].toLowerCase();J==="set-cookie"?(P.headers[J]===void 0&&(P.headers[J]=[]),P.headers[J].push(W[2])):P.headers[J]!==void 0?P.headers[J]+=", "+W[2]:P.headers[J]=W[2],P.rawHeaders.push(W[1],W[2])}}),P._charset="x-user-defined",!D.overrideMimeType){var G=P.rawHeaders["mime-type"];if(G){var Z=G.match(/;\s*charset=([^;])(;|$)/);Z&&(P._charset=Z[1].toLowerCase())}P._charset||(P._charset="utf-8")}}};w(y,E.Readable),y.prototype._read=function(){var p=this,C=p._resumeFetch;C&&(p._resumeFetch=null,C())},y.prototype._onXHRProgress=function(){var p=this,C=p._xhr,z=null;switch(p._mode){case"text":if(z=C.responseText,z.length>p._pos){var A=z.substr(p._pos);if(p._charset==="x-user-defined"){for(var P=S.alloc(A.length),x=0;x<A.length;x++)P[x]=A.charCodeAt(x)&255;p.push(P)}else p.push(A,p._charset);p._pos=z.length}break;case"arraybuffer":if(C.readyState!==m.DONE||!C.response)break;z=C.response,p.push(S.from(new Uint8Array(z)));break;case"moz-chunked-arraybuffer":if(z=C.response,C.readyState!==m.LOADING||!z)break;p.push(S.from(new Uint8Array(z)));break;case"ms-stream":if(z=C.response,C.readyState!==m.LOADING)break;var O=new t.MSStreamReader;O.onprogress=function(){O.result.byteLength>p._pos&&(p.push(S.from(new Uint8Array(O.result.slice(p._pos)))),p._pos=O.result.byteLength)},O.onload=function(){p.push(null)},O.readAsArrayBuffer(z);break}p._xhr.readyState===m.DONE&&p._mode!=="ms-stream"&&p.push(null)}}).call(this,_("_process"),typeof Hr<"u"?Hr:typeof self<"u"?self:typeof v<"u"?v:{},_("buffer").Buffer)},{"./capability":157,_process:133,buffer:48,inherits:75,"readable-stream":174}],160:[function(_,k,b){function T(y,p){y.prototype=Object.create(p.prototype),y.prototype.constructor=y,y.__proto__=p}var t={};function S(y,p,C){C||(C=Error);function z(P,x,O){return typeof p=="string"?p:p(P,x,O)}var A=function(P){T(x,P);function x(O,U,G){return P.call(this,z(O,U,G))||this}return x}(C);A.prototype.name=C.name,A.prototype.code=y,t[y]=A}function D(y,p){if(Array.isArray(y)){var C=y.length;return y=y.map(function(z){return String(z)}),C>2?"one of ".concat(p," ").concat(y.slice(0,C-1).join(", "),", or ")+y[C-1]:C===2?"one of ".concat(p," ").concat(y[0]," or ").concat(y[1]):"of ".concat(p," ").concat(y[0])}else return"of ".concat(p," ").concat(String(y))}function w(y,p,C){return y.substr(0,p.length)===p}function E(y,p,C){return(C===void 0||C>y.length)&&(C=y.length),y.substring(C-p.length,C)===p}function m(y,p,C){return typeof C!="number"&&(C=0),C+p.length>y.length?!1:y.indexOf(p,C)!==-1}S("ERR_INVALID_OPT_VALUE",function(y,p){return'The value "'+p+'" is invalid for option "'+y+'"'},TypeError),S("ERR_INVALID_ARG_TYPE",function(y,p,C){var z;typeof p=="string"&&w(p,"not ")?(z="must not be",p=p.replace(/^not /,"")):z="must be";var A;if(E(y," argument"))A="The ".concat(y," ").concat(z," ").concat(D(p,"type"));else{var P=m(y,".")?"property":"argument";A='The "'.concat(y,'" ').concat(P," ").concat(z," ").concat(D(p,"type"))}return A+=". Received type ".concat(typeof C),A},TypeError),S("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),S("ERR_METHOD_NOT_IMPLEMENTED",function(y){return"The "+y+" method is not implemented"}),S("ERR_STREAM_PREMATURE_CLOSE","Premature close"),S("ERR_STREAM_DESTROYED",function(y){return"Cannot call "+y+" after a stream was destroyed"}),S("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),S("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),S("ERR_STREAM_WRITE_AFTER_END","write after end"),S("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),S("ERR_UNKNOWN_ENCODING",function(y){return"Unknown encoding: "+y},TypeError),S("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),k.exports.codes=t},{}],161:[function(_,k,b){(function(T){var t=new Set;function S(w){if(!t.has(w)){var E=w+" is an experimental feature. This feature could change at any time";t.add(w),T.emitWarning(E,"ExperimentalWarning")}}function D(){}k.exports.emitExperimentalWarning=T.emitWarning?S:D}).call(this,_("_process"))},{_process:133}],162:[function(_,k,b){(function(T){var t=Object.keys||function(z){var A=[];for(var P in z)A.push(P);return A};k.exports=y;var S=_("./_stream_readable"),D=_("./_stream_writable");_("inherits")(y,S);for(var w=t(D.prototype),E=0;E<w.length;E++){var m=w[E];y.prototype[m]||(y.prototype[m]=D.prototype[m])}function y(z){if(!(this instanceof y))return new y(z);S.call(this,z),D.call(this,z),this.allowHalfOpen=!0,z&&(z.readable===!1&&(this.readable=!1),z.writable===!1&&(this.writable=!1),z.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",p)))}Object.defineProperty(y.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(y.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(y.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function p(){this._writableState.ended||T.nextTick(C,this)}function C(z){z.end()}Object.defineProperty(y.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(A){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=A,this._writableState.destroyed=A)}})}).call(this,_("_process"))},{"./_stream_readable":164,"./_stream_writable":166,_process:133,inherits:75}],163:[function(_,k,b){k.exports=t;var T=_("./_stream_transform");_("inherits")(t,T);function t(S){if(!(this instanceof t))return new t(S);T.call(this,S)}t.prototype._transform=function(S,D,w){w(null,S)}},{"./_stream_transform":165,inherits:75}],164:[function(_,k,b){(function(T,t){k.exports=Pe;var S;Pe.ReadableState=Le,_("events").EventEmitter;var D=function(ve,be){return ve.listeners(be).length},w=_("./internal/streams/stream"),E=_("buffer").Buffer,m=t.Uint8Array||function(){};function y(de){return E.from(de)}function p(de){return E.isBuffer(de)||de instanceof m}var C=_("util"),z;C&&C.debuglog?z=C.debuglog("stream"):z=function(){};var A=_("./internal/streams/buffer_list"),P=_("./internal/streams/destroy"),x=_("./internal/streams/state"),O=x.getHighWaterMark,U=_("../errors").codes,G=U.ERR_INVALID_ARG_TYPE,Z=U.ERR_STREAM_PUSH_AFTER_EOF,X=U.ERR_METHOD_NOT_IMPLEMENTED,W=U.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,J=_("../experimentalWarning"),re=J.emitExperimentalWarning,te,ye;_("inherits")(Pe,w);var ue=["error","close","destroy","pause","resume"];function Se(de,ve,be){if(typeof de.prependListener=="function")return de.prependListener(ve,be);!de._events||!de._events[ve]?de.on(ve,be):Array.isArray(de._events[ve])?de._events[ve].unshift(be):de._events[ve]=[be,de._events[ve]]}function Le(de,ve,be){S=S||_("./_stream_duplex"),de=de||{},typeof be!="boolean"&&(be=ve instanceof S),this.objectMode=!!de.objectMode,be&&(this.objectMode=this.objectMode||!!de.readableObjectMode),this.highWaterMark=O(this,de,"readableHighWaterMark",be),this.buffer=new A,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=de.emitClose!==!1,this.destroyed=!1,this.defaultEncoding=de.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,de.encoding&&(te||(te=_("string_decoder/").StringDecoder),this.decoder=new te(de.encoding),this.encoding=de.encoding)}function Pe(de){if(S=S||_("./_stream_duplex"),!(this instanceof Pe))return new Pe(de);var ve=this instanceof S;this._readableState=new Le(de,this,ve),this.readable=!0,de&&(typeof de.read=="function"&&(this._read=de.read),typeof de.destroy=="function"&&(this._destroy=de.destroy)),w.call(this)}Object.defineProperty(Pe.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(ve){this._readableState&&(this._readableState.destroyed=ve)}}),Pe.prototype.destroy=P.destroy,Pe.prototype._undestroy=P.undestroy,Pe.prototype._destroy=function(de,ve){ve(de)},Pe.prototype.push=function(de,ve){var be=this._readableState,Oe;return be.objectMode?Oe=!0:typeof de=="string"&&(ve=ve||be.defaultEncoding,ve!==be.encoding&&(de=E.from(de,ve),ve=""),Oe=!0),Ee(this,de,ve,!1,Oe)},Pe.prototype.unshift=function(de){return Ee(this,de,null,!0,!1)};function Ee(de,ve,be,Oe,ge){z("readableAddChunk",ve);var le=de._readableState;if(ve===null)le.reading=!1,Ce(de,le);else{var et;if(ge||(et=He(le,ve)),et)de.emit("error",et);else if(le.objectMode||ve&&ve.length>0)if(typeof ve!="string"&&!le.objectMode&&Object.getPrototypeOf(ve)!==E.prototype&&(ve=y(ve)),Oe)le.endEmitted?de.emit("error",new W):Me(de,le,ve,!0);else if(le.ended)de.emit("error",new Z);else{if(le.destroyed)return!1;le.reading=!1,le.decoder&&!be?(ve=le.decoder.write(ve),le.objectMode||ve.length!==0?Me(de,le,ve,!1):se(de,le)):Me(de,le,ve,!1)}else Oe||(le.reading=!1,se(de,le))}return!le.ended&&(le.length<le.highWaterMark||le.length===0)}function Me(de,ve,be,Oe){ve.flowing&&ve.length===0&&!ve.sync?(ve.awaitDrain=0,de.emit("data",be)):(ve.length+=ve.objectMode?1:be.length,Oe?ve.buffer.unshift(be):ve.buffer.push(be),ve.needReadable&&Be(de)),se(de,ve)}function He(de,ve){var be;return!p(ve)&&typeof ve!="string"&&ve!==void 0&&!de.objectMode&&(be=new G("chunk",["string","Buffer","Uint8Array"],ve)),be}Pe.prototype.isPaused=function(){return this._readableState.flowing===!1},Pe.prototype.setEncoding=function(de){return te||(te=_("string_decoder/").StringDecoder),this._readableState.decoder=new te(de),this._readableState.encoding=this._readableState.decoder.encoding,this};var nt=8388608;function ht(de){return de>=nt?de=nt:(de--,de|=de>>>1,de|=de>>>2,de|=de>>>4,de|=de>>>8,de|=de>>>16,de++),de}function Fe(de,ve){return de<=0||ve.length===0&&ve.ended?0:ve.objectMode?1:de!==de?ve.flowing&&ve.length?ve.buffer.head.data.length:ve.length:(de>ve.highWaterMark&&(ve.highWaterMark=ht(de)),de<=ve.length?de:ve.ended?ve.length:(ve.needReadable=!0,0))}Pe.prototype.read=function(de){z("read",de),de=parseInt(de,10);var ve=this._readableState,be=de;if(de!==0&&(ve.emittedReadable=!1),de===0&&ve.needReadable&&((ve.highWaterMark!==0?ve.length>=ve.highWaterMark:ve.length>0)||ve.ended))return z("read: emitReadable",ve.length,ve.ended),ve.length===0&&ve.ended?Je(this):Be(this),null;if(de=Fe(de,ve),de===0&&ve.ended)return ve.length===0&&Je(this),null;var Oe=ve.needReadable;z("need readable",Oe),(ve.length===0||ve.length-de<ve.highWaterMark)&&(Oe=!0,z("length less than watermark",Oe)),ve.ended||ve.reading?(Oe=!1,z("reading or ended",Oe)):Oe&&(z("do read"),ve.reading=!0,ve.sync=!0,ve.length===0&&(ve.needReadable=!0),this._read(ve.highWaterMark),ve.sync=!1,ve.reading||(de=Fe(be,ve)));var ge;return de>0?ge=We(de,ve):ge=null,ge===null?(ve.needReadable=!0,de=0):(ve.length-=de,ve.awaitDrain=0),ve.length===0&&(ve.ended||(ve.needReadable=!0),be!==de&&ve.ended&&Je(this)),ge!==null&&this.emit("data",ge),ge};function Ce(de,ve){if(!ve.ended){if(ve.decoder){var be=ve.decoder.end();be&&be.length&&(ve.buffer.push(be),ve.length+=ve.objectMode?1:be.length)}ve.ended=!0,ve.sync?Be(de):(ve.needReadable=!1,ve.emittedReadable||(ve.emittedReadable=!0,Ae(de)))}}function Be(de){var ve=de._readableState;ve.needReadable=!1,ve.emittedReadable||(z("emitReadable",ve.flowing),ve.emittedReadable=!0,T.nextTick(Ae,de))}function Ae(de){var ve=de._readableState;z("emitReadable_",ve.destroyed,ve.length,ve.ended),!ve.destroyed&&(ve.length||ve.ended)&&de.emit("readable"),ve.needReadable=!ve.flowing&&!ve.ended&&ve.length<=ve.highWaterMark,Ge(de)}function se(de,ve){ve.readingMore||(ve.readingMore=!0,T.nextTick(pe,de,ve))}function pe(de,ve){for(;!ve.reading&&!ve.ended&&(ve.length<ve.highWaterMark||ve.flowing&&ve.length===0);){var be=ve.length;if(z("maybeReadMore read 0"),de.read(0),be===ve.length)break}ve.readingMore=!1}Pe.prototype._read=function(de){this.emit("error",new X("_read()"))},Pe.prototype.pipe=function(de,ve){var be=this,Oe=this._readableState;switch(Oe.pipesCount){case 0:Oe.pipes=de;break;case 1:Oe.pipes=[Oe.pipes,de];break;default:Oe.pipes.push(de);break}Oe.pipesCount+=1,z("pipe count=%d opts=%j",Oe.pipesCount,ve);var ge=(!ve||ve.end!==!1)&&de!==T.stdout&&de!==T.stderr,le=ge?wt:fr;Oe.endEmitted?T.nextTick(le):be.once("end",le),de.on("unpipe",et);function et(Vr,Ir){z("onunpipe"),Vr===be&&Ir&&Ir.hasUnpiped===!1&&(Ir.hasUnpiped=!0,or())}function wt(){z("onend"),de.end()}var Ft=Ke(be);de.on("drain",Ft);var Wt=!1;function or(){z("cleanup"),de.removeListener("close",Tr),de.removeListener("finish",br),de.removeListener("drain",Ft),de.removeListener("error",xr),de.removeListener("unpipe",et),be.removeListener("end",wt),be.removeListener("end",fr),be.removeListener("data",Or),Wt=!0,Oe.awaitDrain&&(!de._writableState||de._writableState.needDrain)&&Ft()}be.on("data",Or);function Or(Vr){z("ondata");var Ir=de.write(Vr);z("dest.write",Ir),Ir===!1&&((Oe.pipesCount===1&&Oe.pipes===de||Oe.pipesCount>1&&ze(Oe.pipes,de)!==-1)&&!Wt&&(z("false write response, pause",Oe.awaitDrain),Oe.awaitDrain++),be.pause())}function xr(Vr){z("onerror",Vr),fr(),de.removeListener("error",xr),D(de,"error")===0&&de.emit("error",Vr)}Se(de,"error",xr);function Tr(){de.removeListener("finish",br),fr()}de.once("close",Tr);function br(){z("onfinish"),de.removeListener("close",Tr),fr()}de.once("finish",br);function fr(){z("unpipe"),be.unpipe(de)}return de.emit("pipe",be),Oe.flowing||(z("pipe resume"),be.resume()),de};function Ke(de){return function(){var be=de._readableState;z("pipeOnDrain",be.awaitDrain),be.awaitDrain&&be.awaitDrain--,be.awaitDrain===0&&D(de,"data")&&(be.flowing=!0,Ge(de))}}Pe.prototype.unpipe=function(de){var ve=this._readableState,be={hasUnpiped:!1};if(ve.pipesCount===0)return this;if(ve.pipesCount===1)return de&&de!==ve.pipes?this:(de||(de=ve.pipes),ve.pipes=null,ve.pipesCount=0,ve.flowing=!1,de&&de.emit("unpipe",this,be),this);if(!de){var Oe=ve.pipes,ge=ve.pipesCount;ve.pipes=null,ve.pipesCount=0,ve.flowing=!1;for(var le=0;le<ge;le++)Oe[le].emit("unpipe",this,{hasUnpiped:!1});return this}var et=ze(ve.pipes,de);return et===-1?this:(ve.pipes.splice(et,1),ve.pipesCount-=1,ve.pipesCount===1&&(ve.pipes=ve.pipes[0]),de.emit("unpipe",this,be),this)},Pe.prototype.on=function(de,ve){var be=w.prototype.on.call(this,de,ve),Oe=this._readableState;return de==="data"?(Oe.readableListening=this.listenerCount("readable")>0,Oe.flowing!==!1&&this.resume()):de==="readable"&&!Oe.endEmitted&&!Oe.readableListening&&(Oe.readableListening=Oe.needReadable=!0,Oe.flowing=!1,Oe.emittedReadable=!1,z("on readable",Oe.length,Oe.reading),Oe.length?Be(this):Oe.reading||T.nextTick(ke,this)),be},Pe.prototype.addListener=Pe.prototype.on,Pe.prototype.removeListener=function(de,ve){var be=w.prototype.removeListener.call(this,de,ve);return de==="readable"&&T.nextTick(_e,this),be},Pe.prototype.removeAllListeners=function(de){var ve=w.prototype.removeAllListeners.apply(this,arguments);return(de==="readable"||de===void 0)&&T.nextTick(_e,this),ve};function _e(de){var ve=de._readableState;ve.readableListening=de.listenerCount("readable")>0,ve.resumeScheduled&&!ve.paused?ve.flowing=!0:de.listenerCount("data")>0&&de.resume()}function ke(de){z("readable nexttick read 0"),de.read(0)}Pe.prototype.resume=function(){var de=this._readableState;return de.flowing||(z("resume"),de.flowing=!de.readableListening,qe(this,de)),de.paused=!1,this};function qe(de,ve){ve.resumeScheduled||(ve.resumeScheduled=!0,T.nextTick(tt,de,ve))}function tt(de,ve){z("resume",ve.reading),ve.reading||de.read(0),ve.resumeScheduled=!1,de.emit("resume"),Ge(de),ve.flowing&&!ve.reading&&de.read(0)}Pe.prototype.pause=function(){return z("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(z("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function Ge(de){var ve=de._readableState;for(z("flow",ve.flowing);ve.flowing&&de.read()!==null;);}Pe.prototype.wrap=function(de){var ve=this,be=this._readableState,Oe=!1;de.on("end",function(){if(z("wrapped end"),be.decoder&&!be.ended){var et=be.decoder.end();et&&et.length&&ve.push(et)}ve.push(null)}),de.on("data",function(et){if(z("wrapped data"),be.decoder&&(et=be.decoder.write(et)),!(be.objectMode&&et==null)&&!(!be.objectMode&&(!et||!et.length))){var wt=ve.push(et);wt||(Oe=!0,de.pause())}});for(var ge in de)this[ge]===void 0&&typeof de[ge]=="function"&&(this[ge]=function(wt){return function(){return de[wt].apply(de,arguments)}}(ge));for(var le=0;le<ue.length;le++)de.on(ue[le],this.emit.bind(this,ue[le]));return this._read=function(et){z("wrapped _read",et),Oe&&(Oe=!1,de.resume())},this},typeof Symbol=="function"&&(Pe.prototype[Symbol.asyncIterator]=function(){return re("Readable[Symbol.asyncIterator]"),ye===void 0&&(ye=_("./internal/streams/async_iterator")),ye(this)}),Object.defineProperty(Pe.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(Pe.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(Pe.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(ve){this._readableState&&(this._readableState.flowing=ve)}}),Pe._fromList=We,Object.defineProperty(Pe.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function We(de,ve){if(ve.length===0)return null;var be;return ve.objectMode?be=ve.buffer.shift():!de||de>=ve.length?(ve.decoder?be=ve.buffer.join(""):ve.buffer.length===1?be=ve.buffer.first():be=ve.buffer.concat(ve.length),ve.buffer.clear()):be=ve.buffer.consume(de,ve.decoder),be}function Je(de){var ve=de._readableState;z("endReadable",ve.endEmitted),ve.endEmitted||(ve.ended=!0,T.nextTick(it,ve,de))}function it(de,ve){z("endReadableNT",de.endEmitted,de.length),!de.endEmitted&&de.length===0&&(de.endEmitted=!0,ve.readable=!1,ve.emit("end"))}function ze(de,ve){for(var be=0,Oe=de.length;be<Oe;be++)if(de[be]===ve)return be;return-1}}).call(this,_("_process"),typeof Hr<"u"?Hr:typeof self<"u"?self:typeof v<"u"?v:{})},{"../errors":160,"../experimentalWarning":161,"./_stream_duplex":162,"./internal/streams/async_iterator":167,"./internal/streams/buffer_list":168,"./internal/streams/destroy":169,"./internal/streams/state":172,"./internal/streams/stream":173,_process:133,buffer:48,events:52,inherits:75,"string_decoder/":175,util:33}],165:[function(_,k,b){k.exports=y;var T=_("../errors").codes,t=T.ERR_METHOD_NOT_IMPLEMENTED,S=T.ERR_MULTIPLE_CALLBACK,D=T.ERR_TRANSFORM_ALREADY_TRANSFORMING,w=T.ERR_TRANSFORM_WITH_LENGTH_0,E=_("./_stream_duplex");_("inherits")(y,E);function m(z,A){var P=this._transformState;P.transforming=!1;var x=P.writecb;if(x===null)return this.emit("error",new S);P.writechunk=null,P.writecb=null,A!=null&&this.push(A),x(z);var O=this._readableState;O.reading=!1,(O.needReadable||O.length<O.highWaterMark)&&this._read(O.highWaterMark)}function y(z){if(!(this instanceof y))return new y(z);E.call(this,z),this._transformState={afterTransform:m.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,z&&(typeof z.transform=="function"&&(this._transform=z.transform),typeof z.flush=="function"&&(this._flush=z.flush)),this.on("prefinish",p)}function p(){var z=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(A,P){C(z,A,P)}):C(this,null,null)}y.prototype.push=function(z,A){return this._transformState.needTransform=!1,E.prototype.push.call(this,z,A)},y.prototype._transform=function(z,A,P){P(new t("_transform()"))},y.prototype._write=function(z,A,P){var x=this._transformState;if(x.writecb=P,x.writechunk=z,x.writeencoding=A,!x.transforming){var O=this._readableState;(x.needTransform||O.needReadable||O.length<O.highWaterMark)&&this._read(O.highWaterMark)}},y.prototype._read=function(z){var A=this._transformState;A.writechunk!==null&&!A.transforming?(A.transforming=!0,this._transform(A.writechunk,A.writeencoding,A.afterTransform)):A.needTransform=!0},y.prototype._destroy=function(z,A){E.prototype._destroy.call(this,z,function(P){A(P)})};function C(z,A,P){if(A)return z.emit("error",A);if(P!=null&&z.push(P),z._writableState.length)throw new w;if(z._transformState.transforming)throw new D;return z.push(null)}},{"../errors":160,"./_stream_duplex":162,inherits:75}],166:[function(_,k,b){(function(T,t){k.exports=Se;function S(tt){var Ge=this;this.next=null,this.entry=null,this.finish=function(){qe(Ge,tt)}}var D;Se.WritableState=ye;var w={deprecate:_("util-deprecate")},E=_("./internal/streams/stream"),m=_("buffer").Buffer,y=t.Uint8Array||function(){};function p(tt){return m.from(tt)}function C(tt){return m.isBuffer(tt)||tt instanceof y}var z=_("./internal/streams/destroy"),A=_("./internal/streams/state"),P=A.getHighWaterMark,x=_("../errors").codes,O=x.ERR_INVALID_ARG_TYPE,U=x.ERR_METHOD_NOT_IMPLEMENTED,G=x.ERR_MULTIPLE_CALLBACK,Z=x.ERR_STREAM_CANNOT_PIPE,X=x.ERR_STREAM_DESTROYED,W=x.ERR_STREAM_NULL_VALUES,J=x.ERR_STREAM_WRITE_AFTER_END,re=x.ERR_UNKNOWN_ENCODING;_("inherits")(Se,E);function te(){}function ye(tt,Ge,We){D=D||_("./_stream_duplex"),tt=tt||{},typeof We!="boolean"&&(We=Ge instanceof D),this.objectMode=!!tt.objectMode,We&&(this.objectMode=this.objectMode||!!tt.writableObjectMode),this.highWaterMark=P(this,tt,"writableHighWaterMark",We),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var Je=tt.decodeStrings===!1;this.decodeStrings=!Je,this.defaultEncoding=tt.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(it){Fe(Ge,it)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=tt.emitClose!==!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new S(this)}ye.prototype.getBuffer=function(){for(var Ge=this.bufferedRequest,We=[];Ge;)We.push(Ge),Ge=Ge.next;return We},function(){try{Object.defineProperty(ye.prototype,"buffer",{get:w.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var ue;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(ue=Function.prototype[Symbol.hasInstance],Object.defineProperty(Se,Symbol.hasInstance,{value:function(Ge){return ue.call(this,Ge)?!0:this!==Se?!1:Ge&&Ge._writableState instanceof ye}})):ue=function(Ge){return Ge instanceof this};function Se(tt){D=D||_("./_stream_duplex");var Ge=this instanceof D;if(!Ge&&!ue.call(Se,this))return new Se(tt);this._writableState=new ye(tt,this,Ge),this.writable=!0,tt&&(typeof tt.write=="function"&&(this._write=tt.write),typeof tt.writev=="function"&&(this._writev=tt.writev),typeof tt.destroy=="function"&&(this._destroy=tt.destroy),typeof tt.final=="function"&&(this._final=tt.final)),E.call(this)}Se.prototype.pipe=function(){this.emit("error",new Z)};function Le(tt,Ge){var We=new J;tt.emit("error",We),T.nextTick(Ge,We)}function Pe(tt,Ge,We,Je){var it;return We===null?it=new W:typeof We!="string"&&!Ge.objectMode&&(it=new O("chunk",["string","Buffer"],We)),it?(tt.emit("error",it),T.nextTick(Je,it),!1):!0}Se.prototype.write=function(tt,Ge,We){var Je=this._writableState,it=!1,ze=!Je.objectMode&&C(tt);return ze&&!m.isBuffer(tt)&&(tt=p(tt)),typeof Ge=="function"&&(We=Ge,Ge=null),ze?Ge="buffer":Ge||(Ge=Je.defaultEncoding),typeof We!="function"&&(We=te),Je.ending?Le(this,We):(ze||Pe(this,Je,tt,We))&&(Je.pendingcb++,it=Me(this,Je,ze,tt,Ge,We)),it},Se.prototype.cork=function(){this._writableState.corked++},Se.prototype.uncork=function(){var tt=this._writableState;tt.corked&&(tt.corked--,!tt.writing&&!tt.corked&&!tt.bufferProcessing&&tt.bufferedRequest&&Ae(this,tt))},Se.prototype.setDefaultEncoding=function(Ge){if(typeof Ge=="string"&&(Ge=Ge.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((Ge+"").toLowerCase())>-1))throw new re(Ge);return this._writableState.defaultEncoding=Ge,this},Object.defineProperty(Se.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function Ee(tt,Ge,We){return!tt.objectMode&&tt.decodeStrings!==!1&&typeof Ge=="string"&&(Ge=m.from(Ge,We)),Ge}Object.defineProperty(Se.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function Me(tt,Ge,We,Je,it,ze){if(!We){var de=Ee(Ge,Je,it);Je!==de&&(We=!0,it="buffer",Je=de)}var ve=Ge.objectMode?1:Je.length;Ge.length+=ve;var be=Ge.length<Ge.highWaterMark;if(be||(Ge.needDrain=!0),Ge.writing||Ge.corked){var Oe=Ge.lastBufferedRequest;Ge.lastBufferedRequest={chunk:Je,encoding:it,isBuf:We,callback:ze,next:null},Oe?Oe.next=Ge.lastBufferedRequest:Ge.bufferedRequest=Ge.lastBufferedRequest,Ge.bufferedRequestCount+=1}else He(tt,Ge,!1,ve,Je,it,ze);return be}function He(tt,Ge,We,Je,it,ze,de){Ge.writelen=Je,Ge.writecb=de,Ge.writing=!0,Ge.sync=!0,Ge.destroyed?Ge.onwrite(new X("write")):We?tt._writev(it,Ge.onwrite):tt._write(it,ze,Ge.onwrite),Ge.sync=!1}function nt(tt,Ge,We,Je,it){--Ge.pendingcb,We?(T.nextTick(it,Je),T.nextTick(_e,tt,Ge),tt._writableState.errorEmitted=!0,tt.emit("error",Je)):(it(Je),tt._writableState.errorEmitted=!0,tt.emit("error",Je),_e(tt,Ge))}function ht(tt){tt.writing=!1,tt.writecb=null,tt.length-=tt.writelen,tt.writelen=0}function Fe(tt,Ge){var We=tt._writableState,Je=We.sync,it=We.writecb;if(typeof it!="function")throw new G;if(ht(We),Ge)nt(tt,We,Je,Ge,it);else{var ze=se(We)||tt.destroyed;!ze&&!We.corked&&!We.bufferProcessing&&We.bufferedRequest&&Ae(tt,We),Je?T.nextTick(Ce,tt,We,ze,it):Ce(tt,We,ze,it)}}function Ce(tt,Ge,We,Je){We||Be(tt,Ge),Ge.pendingcb--,Je(),_e(tt,Ge)}function Be(tt,Ge){Ge.length===0&&Ge.needDrain&&(Ge.needDrain=!1,tt.emit("drain"))}function Ae(tt,Ge){Ge.bufferProcessing=!0;var We=Ge.bufferedRequest;if(tt._writev&&We&&We.next){var Je=Ge.bufferedRequestCount,it=new Array(Je),ze=Ge.corkedRequestsFree;ze.entry=We;for(var de=0,ve=!0;We;)it[de]=We,We.isBuf||(ve=!1),We=We.next,de+=1;it.allBuffers=ve,He(tt,Ge,!0,Ge.length,it,"",ze.finish),Ge.pendingcb++,Ge.lastBufferedRequest=null,ze.next?(Ge.corkedRequestsFree=ze.next,ze.next=null):Ge.corkedRequestsFree=new S(Ge),Ge.bufferedRequestCount=0}else{for(;We;){var be=We.chunk,Oe=We.encoding,ge=We.callback,le=Ge.objectMode?1:be.length;if(He(tt,Ge,!1,le,be,Oe,ge),We=We.next,Ge.bufferedRequestCount--,Ge.writing)break}We===null&&(Ge.lastBufferedRequest=null)}Ge.bufferedRequest=We,Ge.bufferProcessing=!1}Se.prototype._write=function(tt,Ge,We){We(new U("_write()"))},Se.prototype._writev=null,Se.prototype.end=function(tt,Ge,We){var Je=this._writableState;return typeof tt=="function"?(We=tt,tt=null,Ge=null):typeof Ge=="function"&&(We=Ge,Ge=null),tt!=null&&this.write(tt,Ge),Je.corked&&(Je.corked=1,this.uncork()),Je.ending||ke(this,Je,We),this},Object.defineProperty(Se.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function se(tt){return tt.ending&&tt.length===0&&tt.bufferedRequest===null&&!tt.finished&&!tt.writing}function pe(tt,Ge){tt._final(function(We){Ge.pendingcb--,We&&tt.emit("error",We),Ge.prefinished=!0,tt.emit("prefinish"),_e(tt,Ge)})}function Ke(tt,Ge){!Ge.prefinished&&!Ge.finalCalled&&(typeof tt._final=="function"&&!Ge.destroyed?(Ge.pendingcb++,Ge.finalCalled=!0,T.nextTick(pe,tt,Ge)):(Ge.prefinished=!0,tt.emit("prefinish")))}function _e(tt,Ge){var We=se(Ge);return We&&(Ke(tt,Ge),Ge.pendingcb===0&&(Ge.finished=!0,tt.emit("finish"))),We}function ke(tt,Ge,We){Ge.ending=!0,_e(tt,Ge),We&&(Ge.finished?T.nextTick(We):tt.once("finish",We)),Ge.ended=!0,tt.writable=!1}function qe(tt,Ge,We){var Je=tt.entry;for(tt.entry=null;Je;){var it=Je.callback;Ge.pendingcb--,it(We),Je=Je.next}Ge.corkedRequestsFree.next=tt}Object.defineProperty(Se.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(Ge){this._writableState&&(this._writableState.destroyed=Ge)}}),Se.prototype.destroy=z.destroy,Se.prototype._undestroy=z.undestroy,Se.prototype._destroy=function(tt,Ge){Ge(tt)}}).call(this,_("_process"),typeof Hr<"u"?Hr:typeof self<"u"?self:typeof v<"u"?v:{})},{"../errors":160,"./_stream_duplex":162,"./internal/streams/destroy":169,"./internal/streams/state":172,"./internal/streams/stream":173,_process:133,buffer:48,inherits:75,"util-deprecate":183}],167:[function(_,k,b){(function(T){var t;function S(X,W,J){return W in X?Object.defineProperty(X,W,{value:J,enumerable:!0,configurable:!0,writable:!0}):X[W]=J,X}var D=_("./end-of-stream"),w=Symbol("lastResolve"),E=Symbol("lastReject"),m=Symbol("error"),y=Symbol("ended"),p=Symbol("lastPromise"),C=Symbol("handlePromise"),z=Symbol("stream");function A(X,W){return{value:X,done:W}}function P(X){var W=X[w];if(W!==null){var J=X[z].read();J!==null&&(X[p]=null,X[w]=null,X[E]=null,W(A(J,!1)))}}function x(X){T.nextTick(P,X)}function O(X,W){return function(J,re){X.then(function(){if(W[y]){J(A(void 0,!0));return}W[C](J,re)},re)}}var U=Object.getPrototypeOf(function(){}),G=Object.setPrototypeOf((t={get stream(){return this[z]},next:function(){var W=this,J=this[m];if(J!==null)return Promise.reject(J);if(this[y])return Promise.resolve(A(void 0,!0));if(this[z].destroyed)return new Promise(function(ue,Se){T.nextTick(function(){W[m]?Se(W[m]):ue(A(void 0,!0))})});var re=this[p],te;if(re)te=new Promise(O(re,this));else{var ye=this[z].read();if(ye!==null)return Promise.resolve(A(ye,!1));te=new Promise(this[C])}return this[p]=te,te}},S(t,Symbol.asyncIterator,function(){return this}),S(t,"return",function(){var W=this;return new Promise(function(J,re){W[z].destroy(null,function(te){if(te){re(te);return}J(A(void 0,!0))})})}),t),U),Z=function(W){var J,re=Object.create(G,(J={},S(J,z,{value:W,writable:!0}),S(J,w,{value:null,writable:!0}),S(J,E,{value:null,writable:!0}),S(J,m,{value:null,writable:!0}),S(J,y,{value:W._readableState.endEmitted,writable:!0}),S(J,C,{value:function(ye,ue){var Se=re[z].read();Se?(re[p]=null,re[w]=null,re[E]=null,ye(A(Se,!1))):(re[w]=ye,re[E]=ue)},writable:!0}),J));return re[p]=null,D(W,function(te){if(te&&te.code!=="ERR_STREAM_PREMATURE_CLOSE"){var ye=re[E];ye!==null&&(re[p]=null,re[w]=null,re[E]=null,ye(te)),re[m]=te;return}var ue=re[w];ue!==null&&(re[p]=null,re[w]=null,re[E]=null,ue(A(void 0,!0))),re[y]=!0}),W.on("readable",x.bind(null,re)),re};k.exports=Z}).call(this,_("_process"))},{"./end-of-stream":170,_process:133}],168:[function(_,k,b){function T(p){for(var C=1;C<arguments.length;C++){var z=arguments[C]!=null?arguments[C]:{},A=Object.keys(z);typeof Object.getOwnPropertySymbols=="function"&&(A=A.concat(Object.getOwnPropertySymbols(z).filter(function(P){return Object.getOwnPropertyDescriptor(z,P).enumerable}))),A.forEach(function(P){t(p,P,z[P])})}return p}function t(p,C,z){return C in p?Object.defineProperty(p,C,{value:z,enumerable:!0,configurable:!0,writable:!0}):p[C]=z,p}var S=_("buffer"),D=S.Buffer,w=_("util"),E=w.inspect,m=E&&E.custom||"inspect";function y(p,C,z){D.prototype.copy.call(p,C,z)}k.exports=function(){function p(){this.head=null,this.tail=null,this.length=0}var C=p.prototype;return C.push=function(A){var P={data:A,next:null};this.length>0?this.tail.next=P:this.head=P,this.tail=P,++this.length},C.unshift=function(A){var P={data:A,next:this.head};this.length===0&&(this.tail=P),this.head=P,++this.length},C.shift=function(){if(this.length!==0){var A=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,A}},C.clear=function(){this.head=this.tail=null,this.length=0},C.join=function(A){if(this.length===0)return"";for(var P=this.head,x=""+P.data;P=P.next;)x+=A+P.data;return x},C.concat=function(A){if(this.length===0)return D.alloc(0);for(var P=D.allocUnsafe(A>>>0),x=this.head,O=0;x;)y(x.data,P,O),O+=x.data.length,x=x.next;return P},C.consume=function(A,P){var x;return A<this.head.data.length?(x=this.head.data.slice(0,A),this.head.data=this.head.data.slice(A)):A===this.head.data.length?x=this.shift():x=P?this._getString(A):this._getBuffer(A),x},C.first=function(){return this.head.data},C._getString=function(A){var P=this.head,x=1,O=P.data;for(A-=O.length;P=P.next;){var U=P.data,G=A>U.length?U.length:A;if(G===U.length?O+=U:O+=U.slice(0,A),A-=G,A===0){G===U.length?(++x,P.next?this.head=P.next:this.head=this.tail=null):(this.head=P,P.data=U.slice(G));break}++x}return this.length-=x,O},C._getBuffer=function(A){var P=D.allocUnsafe(A),x=this.head,O=1;for(x.data.copy(P),A-=x.data.length;x=x.next;){var U=x.data,G=A>U.length?U.length:A;if(U.copy(P,P.length-A,0,G),A-=G,A===0){G===U.length?(++O,x.next?this.head=x.next:this.head=this.tail=null):(this.head=x,x.data=U.slice(G));break}++O}return this.length-=O,P},C[m]=function(z,A){return E(this,T({},A,{depth:0,customInspect:!1}))},p}()},{buffer:48,util:33}],169:[function(_,k,b){(function(T){function t(m,y){var p=this,C=this._readableState&&this._readableState.destroyed,z=this._writableState&&this._writableState.destroyed;return C||z?(y?y(m):m&&(!this._writableState||!this._writableState.errorEmitted)&&T.nextTick(E,this,m),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(m||null,function(A){!y&&A?(T.nextTick(S,p,A),p._writableState&&(p._writableState.errorEmitted=!0)):y?(T.nextTick(D,p),y(A)):T.nextTick(D,p)}),this)}function S(m,y){E(m,y),D(m)}function D(m){m._writableState&&!m._writableState.emitClose||m._readableState&&!m._readableState.emitClose||m.emit("close")}function w(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function E(m,y){m.emit("error",y)}k.exports={destroy:t,undestroy:w}}).call(this,_("_process"))},{_process:133}],170:[function(_,k,b){var T=_("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function t(E){var m=!1;return function(){if(!m){m=!0;for(var y=arguments.length,p=new Array(y),C=0;C<y;C++)p[C]=arguments[C];E.apply(this,p)}}}function S(){}function D(E){return E.setHeader&&typeof E.abort=="function"}function w(E,m,y){if(typeof m=="function")return w(E,null,m);m||(m={}),y=t(y||S);var p=m.readable||m.readable!==!1&&E.readable,C=m.writable||m.writable!==!1&&E.writable,z=function(){E.writable||P()},A=E._writableState&&E._writableState.finished,P=function(){C=!1,A=!0,p||y.call(E)},x=E._readableState&&E._readableState.endEmitted,O=function(){p=!1,x=!0,C||y.call(E)},U=function(W){y.call(E,W)},G=function(){var W;if(p&&!x)return(!E._readableState||!E._readableState.ended)&&(W=new T),y.call(E,W);if(C&&!A)return(!E._writableState||!E._writableState.ended)&&(W=new T),y.call(E,W)},Z=function(){E.req.on("finish",P)};return D(E)?(E.on("complete",P),E.on("abort",G),E.req?Z():E.on("request",Z)):C&&!E._writableState&&(E.on("end",z),E.on("close",z)),E.on("end",O),E.on("finish",P),m.error!==!1&&E.on("error",U),E.on("close",G),function(){E.removeListener("complete",P),E.removeListener("abort",G),E.removeListener("request",Z),E.req&&E.req.removeListener("finish",P),E.removeListener("end",z),E.removeListener("close",z),E.removeListener("finish",P),E.removeListener("end",O),E.removeListener("error",U),E.removeListener("close",G)}}k.exports=w},{"../../../errors":160}],171:[function(_,k,b){var T;function t(P){var x=!1;return function(){x||(x=!0,P.apply(void 0,arguments))}}var S=_("../../../errors").codes,D=S.ERR_MISSING_ARGS,w=S.ERR_STREAM_DESTROYED;function E(P){if(P)throw P}function m(P){return P.setHeader&&typeof P.abort=="function"}function y(P,x,O,U){U=t(U);var G=!1;P.on("close",function(){G=!0}),T===void 0&&(T=_("./end-of-stream")),T(P,{readable:x,writable:O},function(X){if(X)return U(X);G=!0,U()});var Z=!1;return function(X){if(!G&&!Z){if(Z=!0,m(P))return P.abort();if(typeof P.destroy=="function")return P.destroy();U(X||new w("pipe"))}}}function p(P){P()}function C(P,x){return P.pipe(x)}function z(P){return!P.length||typeof P[P.length-1]!="function"?E:P.pop()}function A(){for(var P=arguments.length,x=new Array(P),O=0;O<P;O++)x[O]=arguments[O];var U=z(x);if(Array.isArray(x[0])&&(x=x[0]),x.length<2)throw new D("streams");var G,Z=x.map(function(X,W){var J=W<x.length-1,re=W>0;return y(X,J,re,function(te){G||(G=te),te&&Z.forEach(p),!J&&(Z.forEach(p),U(G))})});return x.reduce(C)}k.exports=A},{"../../../errors":160,"./end-of-stream":170}],172:[function(_,k,b){var T=_("../../../errors").codes.ERR_INVALID_OPT_VALUE;function t(D,w,E){return D.highWaterMark!=null?D.highWaterMark:w?D[E]:null}function S(D,w,E,m){var y=t(w,m,E);if(y!=null){if(!(isFinite(y)&&Math.floor(y)===y)||y<0){var p=m?E:"highWaterMark";throw new T(p,y)}return Math.floor(y)}return D.objectMode?16:16*1024}k.exports={getHighWaterMark:S}},{"../../../errors":160}],173:[function(_,k,b){arguments[4][146][0].apply(b,arguments)},{dup:146,events:52}],174:[function(_,k,b){b=k.exports=_("./lib/_stream_readable.js"),b.Stream=b,b.Readable=b,b.Writable=_("./lib/_stream_writable.js"),b.Duplex=_("./lib/_stream_duplex.js"),b.Transform=_("./lib/_stream_transform.js"),b.PassThrough=_("./lib/_stream_passthrough.js"),b.finished=_("./lib/internal/streams/end-of-stream.js"),b.pipeline=_("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":162,"./lib/_stream_passthrough.js":163,"./lib/_stream_readable.js":164,"./lib/_stream_transform.js":165,"./lib/_stream_writable.js":166,"./lib/internal/streams/end-of-stream.js":170,"./lib/internal/streams/pipeline.js":171}],175:[function(_,k,b){arguments[4][148][0].apply(b,arguments)},{dup:148,"safe-buffer":154}],176:[function(_,k,b){(function(T,t){var S=_("process/browser.js").nextTick,D=Function.prototype.apply,w=Array.prototype.slice,E={},m=0;b.setTimeout=function(){return new y(D.call(setTimeout,v,arguments),clearTimeout)},b.setInterval=function(){return new y(D.call(setInterval,v,arguments),clearInterval)},b.clearTimeout=b.clearInterval=function(p){p.close()};function y(p,C){this._id=p,this._clearFn=C}y.prototype.unref=y.prototype.ref=function(){},y.prototype.close=function(){this._clearFn.call(v,this._id)},b.enroll=function(p,C){clearTimeout(p._idleTimeoutId),p._idleTimeout=C},b.unenroll=function(p){clearTimeout(p._idleTimeoutId),p._idleTimeout=-1},b._unrefActive=b.active=function(p){clearTimeout(p._idleTimeoutId);var C=p._idleTimeout;C>=0&&(p._idleTimeoutId=setTimeout(function(){p._onTimeout&&p._onTimeout()},C))},b.setImmediate=typeof T=="function"?T:function(p){var C=m++,z=arguments.length<2?!1:w.call(arguments,1);return E[C]=!0,S(function(){E[C]&&(z?p.apply(null,z):p.call(null),b.clearImmediate(C))}),C},b.clearImmediate=typeof t=="function"?t:function(p){delete E[p]}}).call(this,_("timers").setImmediate,_("timers").clearImmediate)},{"process/browser.js":133,timers:176}],177:[function(_,k,b){(function(T){Object.defineProperty(b,"__esModule",{value:!0});var t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Ee){return typeof Ee}:function(Ee){return Ee&&typeof Symbol=="function"&&Ee.constructor===Symbol&&Ee!==Symbol.prototype?"symbol":typeof Ee};b.clone=m,b.addLast=C,b.addFirst=z,b.removeLast=A,b.removeFirst=P,b.insert=x,b.removeAt=O,b.replaceAt=U,b.getIn=G,b.set=Z,b.setIn=W,b.update=J,b.updateIn=re,b.merge=te,b.mergeDeep=ye,b.mergeIn=ue,b.omit=Se,b.addDefaults=Le;/*!
 * Timm
 *
 * Immutability helpers with fast reads and acceptable writes.
 *
 * @copyright Guillermo Grau Panea 2016
 * @license MIT
 */var S="INVALID_ARGS";function D(Ee){throw new Error(Ee)}function w(Ee){var Me=Object.keys(Ee);return Object.getOwnPropertySymbols?Me.concat(Object.getOwnPropertySymbols(Ee)):Me}var E={}.hasOwnProperty;function m(Ee){if(Array.isArray(Ee))return Ee.slice();for(var Me=w(Ee),He={},nt=0;nt<Me.length;nt++){var ht=Me[nt];He[ht]=Ee[ht]}return He}function y(Ee,Me,He){var nt=He;nt==null&&D(T.env.NODE_ENV!=="production"?"At least one object should be provided to merge()":S);for(var ht=!1,Fe=arguments.length,Ce=Array(Fe>3?Fe-3:0),Be=3;Be<Fe;Be++)Ce[Be-3]=arguments[Be];for(var Ae=0;Ae<Ce.length;Ae++){var se=Ce[Ae];if(se!=null){var pe=w(se);if(pe.length)for(var Ke=0;Ke<=pe.length;Ke++){var _e=pe[Ke];if(!(Ee&&nt[_e]!==void 0)){var ke=se[_e];Me&&p(nt[_e])&&p(ke)&&(ke=y(Ee,Me,nt[_e],ke)),!(ke===void 0||ke===nt[_e])&&(ht||(ht=!0,nt=m(nt)),nt[_e]=ke)}}}}return nt}function p(Ee){var Me=typeof Ee>"u"?"undefined":t(Ee);return Ee!=null&&Me==="object"}function C(Ee,Me){return Array.isArray(Me)?Ee.concat(Me):Ee.concat([Me])}function z(Ee,Me){return Array.isArray(Me)?Me.concat(Ee):[Me].concat(Ee)}function A(Ee){return Ee.length?Ee.slice(0,Ee.length-1):Ee}function P(Ee){return Ee.length?Ee.slice(1):Ee}function x(Ee,Me,He){return Ee.slice(0,Me).concat(Array.isArray(He)?He:[He]).concat(Ee.slice(Me))}function O(Ee,Me){return Me>=Ee.length||Me<0?Ee:Ee.slice(0,Me).concat(Ee.slice(Me+1))}function U(Ee,Me,He){if(Ee[Me]===He)return Ee;for(var nt=Ee.length,ht=Array(nt),Fe=0;Fe<nt;Fe++)ht[Fe]=Ee[Fe];return ht[Me]=He,ht}function G(Ee,Me){if(!Array.isArray(Me)&&D(T.env.NODE_ENV!=="production"?"A path array should be provided when calling getIn()":S),Ee!=null){for(var He=Ee,nt=0;nt<Me.length;nt++){var ht=Me[nt];if(He=He?.[ht],He===void 0)return He}return He}}function Z(Ee,Me,He){var nt=typeof Me=="number"?[]:{},ht=Ee??nt;if(ht[Me]===He)return ht;var Fe=m(ht);return Fe[Me]=He,Fe}function X(Ee,Me,He,nt){var ht=void 0,Fe=Me[nt];if(nt===Me.length-1)ht=He;else{var Ce=p(Ee)&&p(Ee[Fe])?Ee[Fe]:typeof Me[nt+1]=="number"?[]:{};ht=X(Ce,Me,He,nt+1)}return Z(Ee,Fe,ht)}function W(Ee,Me,He){return Me.length?X(Ee,Me,He,0):He}function J(Ee,Me,He){var nt=Ee?.[Me],ht=He(nt);return Z(Ee,Me,ht)}function re(Ee,Me,He){var nt=G(Ee,Me),ht=He(nt);return W(Ee,Me,ht)}function te(Ee,Me,He,nt,ht,Fe){for(var Ce=arguments.length,Be=Array(Ce>6?Ce-6:0),Ae=6;Ae<Ce;Ae++)Be[Ae-6]=arguments[Ae];return Be.length?y.call.apply(y,[null,!1,!1,Ee,Me,He,nt,ht,Fe].concat(Be)):y(!1,!1,Ee,Me,He,nt,ht,Fe)}function ye(Ee,Me,He,nt,ht,Fe){for(var Ce=arguments.length,Be=Array(Ce>6?Ce-6:0),Ae=6;Ae<Ce;Ae++)Be[Ae-6]=arguments[Ae];return Be.length?y.call.apply(y,[null,!1,!0,Ee,Me,He,nt,ht,Fe].concat(Be)):y(!1,!0,Ee,Me,He,nt,ht,Fe)}function ue(Ee,Me,He,nt,ht,Fe,Ce){var Be=G(Ee,Me);Be==null&&(Be={});for(var Ae=void 0,se=arguments.length,pe=Array(se>7?se-7:0),Ke=7;Ke<se;Ke++)pe[Ke-7]=arguments[Ke];return pe.length?Ae=y.call.apply(y,[null,!1,!1,Be,He,nt,ht,Fe,Ce].concat(pe)):Ae=y(!1,!1,Be,He,nt,ht,Fe,Ce),W(Ee,Me,Ae)}function Se(Ee,Me){for(var He=Array.isArray(Me)?Me:[Me],nt=!1,ht=0;ht<He.length;ht++)if(E.call(Ee,He[ht])){nt=!0;break}if(!nt)return Ee;for(var Fe={},Ce=w(Ee),Be=0;Be<Ce.length;Be++){var Ae=Ce[Be];He.indexOf(Ae)>=0||(Fe[Ae]=Ee[Ae])}return Fe}function Le(Ee,Me,He,nt,ht,Fe){for(var Ce=arguments.length,Be=Array(Ce>6?Ce-6:0),Ae=6;Ae<Ce;Ae++)Be[Ae-6]=arguments[Ae];return Be.length?y.call.apply(y,[null,!0,!1,Ee,Me,He,nt,ht,Fe].concat(Be)):y(!0,!1,Ee,Me,He,nt,ht,Fe)}var Pe={clone:m,addLast:C,addFirst:z,removeLast:A,removeFirst:P,insert:x,removeAt:O,replaceAt:U,getIn:G,set:Z,setIn:W,update:J,updateIn:re,merge:te,mergeDeep:ye,mergeIn:ue,omit:Se,addDefaults:Le};b.default=Pe}).call(this,_("_process"))},{_process:133}],178:[function(_,k,b){(function(T){var t=/^\s+/,S=/\s+$/,D=0,w=T.round,E=T.min,m=T.max,y=T.random;function p(ze,de){if(ze=ze||"",de=de||{},ze instanceof p)return ze;if(!(this instanceof p))return new p(ze,de);var ve=C(ze);this._originalInput=ze,this._r=ve.r,this._g=ve.g,this._b=ve.b,this._a=ve.a,this._roundA=w(100*this._a)/100,this._format=de.format||ve.format,this._gradientType=de.gradientType,this._r<1&&(this._r=w(this._r)),this._g<1&&(this._g=w(this._g)),this._b<1&&(this._b=w(this._b)),this._ok=ve.ok,this._tc_id=D++}p.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var ze=this.toRgb();return(ze.r*299+ze.g*587+ze.b*114)/1e3},getLuminance:function(){var ze=this.toRgb(),de,ve,be,Oe,ge,le;return de=ze.r/255,ve=ze.g/255,be=ze.b/255,de<=.03928?Oe=de/12.92:Oe=T.pow((de+.055)/1.055,2.4),ve<=.03928?ge=ve/12.92:ge=T.pow((ve+.055)/1.055,2.4),be<=.03928?le=be/12.92:le=T.pow((be+.055)/1.055,2.4),.2126*Oe+.7152*ge+.0722*le},setAlpha:function(ze){return this._a=Ce(ze),this._roundA=w(100*this._a)/100,this},toHsv:function(){var ze=x(this._r,this._g,this._b);return{h:ze.h*360,s:ze.s,v:ze.v,a:this._a}},toHsvString:function(){var ze=x(this._r,this._g,this._b),de=w(ze.h*360),ve=w(ze.s*100),be=w(ze.v*100);return this._a==1?"hsv("+de+", "+ve+"%, "+be+"%)":"hsva("+de+", "+ve+"%, "+be+"%, "+this._roundA+")"},toHsl:function(){var ze=A(this._r,this._g,this._b);return{h:ze.h*360,s:ze.s,l:ze.l,a:this._a}},toHslString:function(){var ze=A(this._r,this._g,this._b),de=w(ze.h*360),ve=w(ze.s*100),be=w(ze.l*100);return this._a==1?"hsl("+de+", "+ve+"%, "+be+"%)":"hsla("+de+", "+ve+"%, "+be+"%, "+this._roundA+")"},toHex:function(ze){return U(this._r,this._g,this._b,ze)},toHexString:function(ze){return"#"+this.toHex(ze)},toHex8:function(ze){return G(this._r,this._g,this._b,this._a,ze)},toHex8String:function(ze){return"#"+this.toHex8(ze)},toRgb:function(){return{r:w(this._r),g:w(this._g),b:w(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+w(this._r)+", "+w(this._g)+", "+w(this._b)+")":"rgba("+w(this._r)+", "+w(this._g)+", "+w(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:w(Be(this._r,255)*100)+"%",g:w(Be(this._g,255)*100)+"%",b:w(Be(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+w(Be(this._r,255)*100)+"%, "+w(Be(this._g,255)*100)+"%, "+w(Be(this._b,255)*100)+"%)":"rgba("+w(Be(this._r,255)*100)+"%, "+w(Be(this._g,255)*100)+"%, "+w(Be(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:ht[U(this._r,this._g,this._b,!0)]||!1},toFilter:function(ze){var de="#"+Z(this._r,this._g,this._b,this._a),ve=de,be=this._gradientType?"GradientType = 1, ":"";if(ze){var Oe=p(ze);ve="#"+Z(Oe._r,Oe._g,Oe._b,Oe._a)}return"progid:DXImageTransform.Microsoft.gradient("+be+"startColorstr="+de+",endColorstr="+ve+")"},toString:function(ze){var de=!!ze;ze=ze||this._format;var ve=!1,be=this._a<1&&this._a>=0,Oe=!de&&be&&(ze==="hex"||ze==="hex6"||ze==="hex3"||ze==="hex4"||ze==="hex8"||ze==="name");return Oe?ze==="name"&&this._a===0?this.toName():this.toRgbString():(ze==="rgb"&&(ve=this.toRgbString()),ze==="prgb"&&(ve=this.toPercentageRgbString()),(ze==="hex"||ze==="hex6")&&(ve=this.toHexString()),ze==="hex3"&&(ve=this.toHexString(!0)),ze==="hex4"&&(ve=this.toHex8String(!0)),ze==="hex8"&&(ve=this.toHex8String()),ze==="name"&&(ve=this.toName()),ze==="hsl"&&(ve=this.toHslString()),ze==="hsv"&&(ve=this.toHsvString()),ve||this.toHexString())},clone:function(){return p(this.toString())},_applyModification:function(ze,de){var ve=ze.apply(null,[this].concat([].slice.call(de)));return this._r=ve._r,this._g=ve._g,this._b=ve._b,this.setAlpha(ve._a),this},lighten:function(){return this._applyModification(re,arguments)},brighten:function(){return this._applyModification(te,arguments)},darken:function(){return this._applyModification(ye,arguments)},desaturate:function(){return this._applyModification(X,arguments)},saturate:function(){return this._applyModification(W,arguments)},greyscale:function(){return this._applyModification(J,arguments)},spin:function(){return this._applyModification(ue,arguments)},_applyCombination:function(ze,de){return ze.apply(null,[this].concat([].slice.call(de)))},analogous:function(){return this._applyCombination(Me,arguments)},complement:function(){return this._applyCombination(Se,arguments)},monochromatic:function(){return this._applyCombination(He,arguments)},splitcomplement:function(){return this._applyCombination(Ee,arguments)},triad:function(){return this._applyCombination(Le,arguments)},tetrad:function(){return this._applyCombination(Pe,arguments)}},p.fromRatio=function(ze,de){if(typeof ze=="object"){var ve={};for(var be in ze)ze.hasOwnProperty(be)&&(be==="a"?ve[be]=ze[be]:ve[be]=ke(ze[be]));ze=ve}return p(ze,de)};function C(ze){var de={r:0,g:0,b:0},ve=1,be=null,Oe=null,ge=null,le=!1,et=!1;return typeof ze=="string"&&(ze=Je(ze)),typeof ze=="object"&&(We(ze.r)&&We(ze.g)&&We(ze.b)?(de=z(ze.r,ze.g,ze.b),le=!0,et=String(ze.r).substr(-1)==="%"?"prgb":"rgb"):We(ze.h)&&We(ze.s)&&We(ze.v)?(be=ke(ze.s),Oe=ke(ze.v),de=O(ze.h,be,Oe),le=!0,et="hsv"):We(ze.h)&&We(ze.s)&&We(ze.l)&&(be=ke(ze.s),ge=ke(ze.l),de=P(ze.h,be,ge),le=!0,et="hsl"),ze.hasOwnProperty("a")&&(ve=ze.a)),ve=Ce(ve),{ok:le,format:ze.format||et,r:E(255,m(de.r,0)),g:E(255,m(de.g,0)),b:E(255,m(de.b,0)),a:ve}}function z(ze,de,ve){return{r:Be(ze,255)*255,g:Be(de,255)*255,b:Be(ve,255)*255}}function A(ze,de,ve){ze=Be(ze,255),de=Be(de,255),ve=Be(ve,255);var be=m(ze,de,ve),Oe=E(ze,de,ve),ge,le,et=(be+Oe)/2;if(be==Oe)ge=le=0;else{var wt=be-Oe;switch(le=et>.5?wt/(2-be-Oe):wt/(be+Oe),be){case ze:ge=(de-ve)/wt+(de<ve?6:0);break;case de:ge=(ve-ze)/wt+2;break;case ve:ge=(ze-de)/wt+4;break}ge/=6}return{h:ge,s:le,l:et}}function P(ze,de,ve){var be,Oe,ge;ze=Be(ze,360),de=Be(de,100),ve=Be(ve,100);function le(Ft,Wt,or){return or<0&&(or+=1),or>1&&(or-=1),or<1/6?Ft+(Wt-Ft)*6*or:or<1/2?Wt:or<2/3?Ft+(Wt-Ft)*(2/3-or)*6:Ft}if(de===0)be=Oe=ge=ve;else{var et=ve<.5?ve*(1+de):ve+de-ve*de,wt=2*ve-et;be=le(wt,et,ze+1/3),Oe=le(wt,et,ze),ge=le(wt,et,ze-1/3)}return{r:be*255,g:Oe*255,b:ge*255}}function x(ze,de,ve){ze=Be(ze,255),de=Be(de,255),ve=Be(ve,255);var be=m(ze,de,ve),Oe=E(ze,de,ve),ge,le,et=be,wt=be-Oe;if(le=be===0?0:wt/be,be==Oe)ge=0;else{switch(be){case ze:ge=(de-ve)/wt+(de<ve?6:0);break;case de:ge=(ve-ze)/wt+2;break;case ve:ge=(ze-de)/wt+4;break}ge/=6}return{h:ge,s:le,v:et}}function O(ze,de,ve){ze=Be(ze,360)*6,de=Be(de,100),ve=Be(ve,100);var be=T.floor(ze),Oe=ze-be,ge=ve*(1-de),le=ve*(1-Oe*de),et=ve*(1-(1-Oe)*de),wt=be%6,Ft=[ve,le,ge,ge,et,ve][wt],Wt=[et,ve,ve,le,ge,ge][wt],or=[ge,ge,et,ve,ve,le][wt];return{r:Ft*255,g:Wt*255,b:or*255}}function U(ze,de,ve,be){var Oe=[_e(w(ze).toString(16)),_e(w(de).toString(16)),_e(w(ve).toString(16))];return be&&Oe[0].charAt(0)==Oe[0].charAt(1)&&Oe[1].charAt(0)==Oe[1].charAt(1)&&Oe[2].charAt(0)==Oe[2].charAt(1)?Oe[0].charAt(0)+Oe[1].charAt(0)+Oe[2].charAt(0):Oe.join("")}function G(ze,de,ve,be,Oe){var ge=[_e(w(ze).toString(16)),_e(w(de).toString(16)),_e(w(ve).toString(16)),_e(qe(be))];return Oe&&ge[0].charAt(0)==ge[0].charAt(1)&&ge[1].charAt(0)==ge[1].charAt(1)&&ge[2].charAt(0)==ge[2].charAt(1)&&ge[3].charAt(0)==ge[3].charAt(1)?ge[0].charAt(0)+ge[1].charAt(0)+ge[2].charAt(0)+ge[3].charAt(0):ge.join("")}function Z(ze,de,ve,be){var Oe=[_e(qe(be)),_e(w(ze).toString(16)),_e(w(de).toString(16)),_e(w(ve).toString(16))];return Oe.join("")}p.equals=function(ze,de){return!ze||!de?!1:p(ze).toRgbString()==p(de).toRgbString()},p.random=function(){return p.fromRatio({r:y(),g:y(),b:y()})};function X(ze,de){de=de===0?0:de||10;var ve=p(ze).toHsl();return ve.s-=de/100,ve.s=Ae(ve.s),p(ve)}function W(ze,de){de=de===0?0:de||10;var ve=p(ze).toHsl();return ve.s+=de/100,ve.s=Ae(ve.s),p(ve)}function J(ze){return p(ze).desaturate(100)}function re(ze,de){de=de===0?0:de||10;var ve=p(ze).toHsl();return ve.l+=de/100,ve.l=Ae(ve.l),p(ve)}function te(ze,de){de=de===0?0:de||10;var ve=p(ze).toRgb();return ve.r=m(0,E(255,ve.r-w(255*-(de/100)))),ve.g=m(0,E(255,ve.g-w(255*-(de/100)))),ve.b=m(0,E(255,ve.b-w(255*-(de/100)))),p(ve)}function ye(ze,de){de=de===0?0:de||10;var ve=p(ze).toHsl();return ve.l-=de/100,ve.l=Ae(ve.l),p(ve)}function ue(ze,de){var ve=p(ze).toHsl(),be=(ve.h+de)%360;return ve.h=be<0?360+be:be,p(ve)}function Se(ze){var de=p(ze).toHsl();return de.h=(de.h+180)%360,p(de)}function Le(ze){var de=p(ze).toHsl(),ve=de.h;return[p(ze),p({h:(ve+120)%360,s:de.s,l:de.l}),p({h:(ve+240)%360,s:de.s,l:de.l})]}function Pe(ze){var de=p(ze).toHsl(),ve=de.h;return[p(ze),p({h:(ve+90)%360,s:de.s,l:de.l}),p({h:(ve+180)%360,s:de.s,l:de.l}),p({h:(ve+270)%360,s:de.s,l:de.l})]}function Ee(ze){var de=p(ze).toHsl(),ve=de.h;return[p(ze),p({h:(ve+72)%360,s:de.s,l:de.l}),p({h:(ve+216)%360,s:de.s,l:de.l})]}function Me(ze,de,ve){de=de||6,ve=ve||30;var be=p(ze).toHsl(),Oe=360/ve,ge=[p(ze)];for(be.h=(be.h-(Oe*de>>1)+720)%360;--de;)be.h=(be.h+Oe)%360,ge.push(p(be));return ge}function He(ze,de){de=de||6;for(var ve=p(ze).toHsv(),be=ve.h,Oe=ve.s,ge=ve.v,le=[],et=1/de;de--;)le.push(p({h:be,s:Oe,v:ge})),ge=(ge+et)%1;return le}p.mix=function(ze,de,ve){ve=ve===0?0:ve||50;var be=p(ze).toRgb(),Oe=p(de).toRgb(),ge=ve/100,le={r:(Oe.r-be.r)*ge+be.r,g:(Oe.g-be.g)*ge+be.g,b:(Oe.b-be.b)*ge+be.b,a:(Oe.a-be.a)*ge+be.a};return p(le)},p.readability=function(ze,de){var ve=p(ze),be=p(de);return(T.max(ve.getLuminance(),be.getLuminance())+.05)/(T.min(ve.getLuminance(),be.getLuminance())+.05)},p.isReadable=function(ze,de,ve){var be=p.readability(ze,de),Oe,ge;switch(ge=!1,Oe=it(ve),Oe.level+Oe.size){case"AAsmall":case"AAAlarge":ge=be>=4.5;break;case"AAlarge":ge=be>=3;break;case"AAAsmall":ge=be>=7;break}return ge},p.mostReadable=function(ze,de,ve){var be=null,Oe=0,ge,le,et,wt;ve=ve||{},le=ve.includeFallbackColors,et=ve.level,wt=ve.size;for(var Ft=0;Ft<de.length;Ft++)ge=p.readability(ze,de[Ft]),ge>Oe&&(Oe=ge,be=p(de[Ft]));return p.isReadable(ze,be,{level:et,size:wt})||!le?be:(ve.includeFallbackColors=!1,p.mostReadable(ze,["#fff","#000"],ve))};var nt=p.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},ht=p.hexNames=Fe(nt);function Fe(ze){var de={};for(var ve in ze)ze.hasOwnProperty(ve)&&(de[ze[ve]]=ve);return de}function Ce(ze){return ze=parseFloat(ze),(isNaN(ze)||ze<0||ze>1)&&(ze=1),ze}function Be(ze,de){pe(ze)&&(ze="100%");var ve=Ke(ze);return ze=E(de,m(0,parseFloat(ze))),ve&&(ze=parseInt(ze*de,10)/100),T.abs(ze-de)<1e-6?1:ze%de/parseFloat(de)}function Ae(ze){return E(1,m(0,ze))}function se(ze){return parseInt(ze,16)}function pe(ze){return typeof ze=="string"&&ze.indexOf(".")!=-1&&parseFloat(ze)===1}function Ke(ze){return typeof ze=="string"&&ze.indexOf("%")!=-1}function _e(ze){return ze.length==1?"0"+ze:""+ze}function ke(ze){return ze<=1&&(ze=ze*100+"%"),ze}function qe(ze){return T.round(parseFloat(ze)*255).toString(16)}function tt(ze){return se(ze)/255}var Ge=function(){var ze="[-\\+]?\\d+%?",de="[-\\+]?\\d*\\.\\d+%?",ve="(?:"+de+")|(?:"+ze+")",be="[\\s|\\(]+("+ve+")[,|\\s]+("+ve+")[,|\\s]+("+ve+")\\s*\\)?",Oe="[\\s|\\(]+("+ve+")[,|\\s]+("+ve+")[,|\\s]+("+ve+")[,|\\s]+("+ve+")\\s*\\)?";return{CSS_UNIT:new RegExp(ve),rgb:new RegExp("rgb"+be),rgba:new RegExp("rgba"+Oe),hsl:new RegExp("hsl"+be),hsla:new RegExp("hsla"+Oe),hsv:new RegExp("hsv"+be),hsva:new RegExp("hsva"+Oe),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function We(ze){return!!Ge.CSS_UNIT.exec(ze)}function Je(ze){ze=ze.replace(t,"").replace(S,"").toLowerCase();var de=!1;if(nt[ze])ze=nt[ze],de=!0;else if(ze=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var ve;return(ve=Ge.rgb.exec(ze))?{r:ve[1],g:ve[2],b:ve[3]}:(ve=Ge.rgba.exec(ze))?{r:ve[1],g:ve[2],b:ve[3],a:ve[4]}:(ve=Ge.hsl.exec(ze))?{h:ve[1],s:ve[2],l:ve[3]}:(ve=Ge.hsla.exec(ze))?{h:ve[1],s:ve[2],l:ve[3],a:ve[4]}:(ve=Ge.hsv.exec(ze))?{h:ve[1],s:ve[2],v:ve[3]}:(ve=Ge.hsva.exec(ze))?{h:ve[1],s:ve[2],v:ve[3],a:ve[4]}:(ve=Ge.hex8.exec(ze))?{r:se(ve[1]),g:se(ve[2]),b:se(ve[3]),a:tt(ve[4]),format:de?"name":"hex8"}:(ve=Ge.hex6.exec(ze))?{r:se(ve[1]),g:se(ve[2]),b:se(ve[3]),format:de?"name":"hex"}:(ve=Ge.hex4.exec(ze))?{r:se(ve[1]+""+ve[1]),g:se(ve[2]+""+ve[2]),b:se(ve[3]+""+ve[3]),a:tt(ve[4]+""+ve[4]),format:de?"name":"hex8"}:(ve=Ge.hex3.exec(ze))?{r:se(ve[1]+""+ve[1]),g:se(ve[2]+""+ve[2]),b:se(ve[3]+""+ve[3]),format:de?"name":"hex"}:!1}function it(ze){var de,ve;return ze=ze||{level:"AA",size:"small"},de=(ze.level||"AA").toUpperCase(),ve=(ze.size||"small").toLowerCase(),de!=="AA"&&de!=="AAA"&&(de="AA"),ve!=="small"&&ve!=="large"&&(ve="small"),{level:de,size:ve}}typeof k<"u"&&k.exports?k.exports=p:v.tinycolor=p})(Math)},{}],179:[function(_,k,b){b=k.exports=T;function T(t){return t.replace(/^\s*|\s*$/g,"")}b.left=function(t){return t.replace(/^\s*/,"")},b.right=function(t){return t.replace(/\s*$/,"")}},{}],180:[function(_,k,b){var T=_("punycode"),t=_("./util");b.parse=X,b.resolve=J,b.resolveObject=re,b.format=W,b.Url=S;function S(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var D=/^([a-z0-9.+-]+:)/i,w=/:[0-9]*$/,E=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,m=["<",">",'"',"`"," ","\r",`
`,"	"],y=["{","}","|","\\","^","`"].concat(m),p=["'"].concat(y),C=["%","/","?",";","#"].concat(p),z=["/","?","#"],A=255,P=/^[+a-z0-9A-Z_-]{0,63}$/,x=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,O={javascript:!0,"javascript:":!0},U={javascript:!0,"javascript:":!0},G={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Z=_("querystring");function X(te,ye,ue){if(te&&t.isObject(te)&&te instanceof S)return te;var Se=new S;return Se.parse(te,ye,ue),Se}S.prototype.parse=function(te,ye,ue){if(!t.isString(te))throw new TypeError("Parameter 'url' must be a string, not "+typeof te);var Se=te.indexOf("?"),Le=Se!==-1&&Se<te.indexOf("#")?"?":"#",Pe=te.split(Le),Ee=/\\/g;Pe[0]=Pe[0].replace(Ee,"/"),te=Pe.join(Le);var Me=te;if(Me=Me.trim(),!ue&&te.split("#").length===1){var He=E.exec(Me);if(He)return this.path=Me,this.href=Me,this.pathname=He[1],He[2]?(this.search=He[2],ye?this.query=Z.parse(this.search.substr(1)):this.query=this.search.substr(1)):ye&&(this.search="",this.query={}),this}var nt=D.exec(Me);if(nt){nt=nt[0];var ht=nt.toLowerCase();this.protocol=ht,Me=Me.substr(nt.length)}if(ue||nt||Me.match(/^\/\/[^@\/]+@[^@\/]+/)){var Fe=Me.substr(0,2)==="//";Fe&&!(nt&&U[nt])&&(Me=Me.substr(2),this.slashes=!0)}if(!U[nt]&&(Fe||nt&&!G[nt])){for(var Ce=-1,Be=0;Be<z.length;Be++){var Ae=Me.indexOf(z[Be]);Ae!==-1&&(Ce===-1||Ae<Ce)&&(Ce=Ae)}var se,pe;Ce===-1?pe=Me.lastIndexOf("@"):pe=Me.lastIndexOf("@",Ce),pe!==-1&&(se=Me.slice(0,pe),Me=Me.slice(pe+1),this.auth=decodeURIComponent(se)),Ce=-1;for(var Be=0;Be<C.length;Be++){var Ae=Me.indexOf(C[Be]);Ae!==-1&&(Ce===-1||Ae<Ce)&&(Ce=Ae)}Ce===-1&&(Ce=Me.length),this.host=Me.slice(0,Ce),Me=Me.slice(Ce),this.parseHost(),this.hostname=this.hostname||"";var Ke=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!Ke)for(var _e=this.hostname.split(/\./),Be=0,ke=_e.length;Be<ke;Be++){var qe=_e[Be];if(qe&&!qe.match(P)){for(var tt="",Ge=0,We=qe.length;Ge<We;Ge++)qe.charCodeAt(Ge)>127?tt+="x":tt+=qe[Ge];if(!tt.match(P)){var Je=_e.slice(0,Be),it=_e.slice(Be+1),ze=qe.match(x);ze&&(Je.push(ze[1]),it.unshift(ze[2])),it.length&&(Me="/"+it.join(".")+Me),this.hostname=Je.join(".");break}}}this.hostname.length>A?this.hostname="":this.hostname=this.hostname.toLowerCase(),Ke||(this.hostname=T.toASCII(this.hostname));var de=this.port?":"+this.port:"",ve=this.hostname||"";this.host=ve+de,this.href+=this.host,Ke&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),Me[0]!=="/"&&(Me="/"+Me))}if(!O[ht])for(var Be=0,ke=p.length;Be<ke;Be++){var be=p[Be];if(Me.indexOf(be)!==-1){var Oe=encodeURIComponent(be);Oe===be&&(Oe=escape(be)),Me=Me.split(be).join(Oe)}}var ge=Me.indexOf("#");ge!==-1&&(this.hash=Me.substr(ge),Me=Me.slice(0,ge));var le=Me.indexOf("?");if(le!==-1?(this.search=Me.substr(le),this.query=Me.substr(le+1),ye&&(this.query=Z.parse(this.query)),Me=Me.slice(0,le)):ye&&(this.search="",this.query={}),Me&&(this.pathname=Me),G[ht]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var de=this.pathname||"",et=this.search||"";this.path=de+et}return this.href=this.format(),this};function W(te){return t.isString(te)&&(te=X(te)),te instanceof S?te.format():S.prototype.format.call(te)}S.prototype.format=function(){var te=this.auth||"";te&&(te=encodeURIComponent(te),te=te.replace(/%3A/i,":"),te+="@");var ye=this.protocol||"",ue=this.pathname||"",Se=this.hash||"",Le=!1,Pe="";this.host?Le=te+this.host:this.hostname&&(Le=te+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(Le+=":"+this.port)),this.query&&t.isObject(this.query)&&Object.keys(this.query).length&&(Pe=Z.stringify(this.query));var Ee=this.search||Pe&&"?"+Pe||"";return ye&&ye.substr(-1)!==":"&&(ye+=":"),this.slashes||(!ye||G[ye])&&Le!==!1?(Le="//"+(Le||""),ue&&ue.charAt(0)!=="/"&&(ue="/"+ue)):Le||(Le=""),Se&&Se.charAt(0)!=="#"&&(Se="#"+Se),Ee&&Ee.charAt(0)!=="?"&&(Ee="?"+Ee),ue=ue.replace(/[?#]/g,function(Me){return encodeURIComponent(Me)}),Ee=Ee.replace("#","%23"),ye+Le+ue+Ee+Se};function J(te,ye){return X(te,!1,!0).resolve(ye)}S.prototype.resolve=function(te){return this.resolveObject(X(te,!1,!0)).format()};function re(te,ye){return te?X(te,!1,!0).resolveObject(ye):ye}S.prototype.resolveObject=function(te){if(t.isString(te)){var ye=new S;ye.parse(te,!1,!0),te=ye}for(var ue=new S,Se=Object.keys(this),Le=0;Le<Se.length;Le++){var Pe=Se[Le];ue[Pe]=this[Pe]}if(ue.hash=te.hash,te.href==="")return ue.href=ue.format(),ue;if(te.slashes&&!te.protocol){for(var Ee=Object.keys(te),Me=0;Me<Ee.length;Me++){var He=Ee[Me];He!=="protocol"&&(ue[He]=te[He])}return G[ue.protocol]&&ue.hostname&&!ue.pathname&&(ue.path=ue.pathname="/"),ue.href=ue.format(),ue}if(te.protocol&&te.protocol!==ue.protocol){if(!G[te.protocol]){for(var nt=Object.keys(te),ht=0;ht<nt.length;ht++){var Fe=nt[ht];ue[Fe]=te[Fe]}return ue.href=ue.format(),ue}if(ue.protocol=te.protocol,!te.host&&!U[te.protocol]){for(var ke=(te.pathname||"").split("/");ke.length&&!(te.host=ke.shift()););te.host||(te.host=""),te.hostname||(te.hostname=""),ke[0]!==""&&ke.unshift(""),ke.length<2&&ke.unshift(""),ue.pathname=ke.join("/")}else ue.pathname=te.pathname;if(ue.search=te.search,ue.query=te.query,ue.host=te.host||"",ue.auth=te.auth,ue.hostname=te.hostname||te.host,ue.port=te.port,ue.pathname||ue.search){var Ce=ue.pathname||"",Be=ue.search||"";ue.path=Ce+Be}return ue.slashes=ue.slashes||te.slashes,ue.href=ue.format(),ue}var Ae=ue.pathname&&ue.pathname.charAt(0)==="/",se=te.host||te.pathname&&te.pathname.charAt(0)==="/",pe=se||Ae||ue.host&&te.pathname,Ke=pe,_e=ue.pathname&&ue.pathname.split("/")||[],ke=te.pathname&&te.pathname.split("/")||[],qe=ue.protocol&&!G[ue.protocol];if(qe&&(ue.hostname="",ue.port=null,ue.host&&(_e[0]===""?_e[0]=ue.host:_e.unshift(ue.host)),ue.host="",te.protocol&&(te.hostname=null,te.port=null,te.host&&(ke[0]===""?ke[0]=te.host:ke.unshift(te.host)),te.host=null),pe=pe&&(ke[0]===""||_e[0]==="")),se)ue.host=te.host||te.host===""?te.host:ue.host,ue.hostname=te.hostname||te.hostname===""?te.hostname:ue.hostname,ue.search=te.search,ue.query=te.query,_e=ke;else if(ke.length)_e||(_e=[]),_e.pop(),_e=_e.concat(ke),ue.search=te.search,ue.query=te.query;else if(!t.isNullOrUndefined(te.search)){if(qe){ue.hostname=ue.host=_e.shift();var tt=ue.host&&ue.host.indexOf("@")>0?ue.host.split("@"):!1;tt&&(ue.auth=tt.shift(),ue.host=ue.hostname=tt.shift())}return ue.search=te.search,ue.query=te.query,(!t.isNull(ue.pathname)||!t.isNull(ue.search))&&(ue.path=(ue.pathname?ue.pathname:"")+(ue.search?ue.search:"")),ue.href=ue.format(),ue}if(!_e.length)return ue.pathname=null,ue.search?ue.path="/"+ue.search:ue.path=null,ue.href=ue.format(),ue;for(var Ge=_e.slice(-1)[0],We=(ue.host||te.host||_e.length>1)&&(Ge==="."||Ge==="..")||Ge==="",Je=0,it=_e.length;it>=0;it--)Ge=_e[it],Ge==="."?_e.splice(it,1):Ge===".."?(_e.splice(it,1),Je++):Je&&(_e.splice(it,1),Je--);if(!pe&&!Ke)for(;Je--;Je)_e.unshift("..");pe&&_e[0]!==""&&(!_e[0]||_e[0].charAt(0)!=="/")&&_e.unshift(""),We&&_e.join("/").substr(-1)!=="/"&&_e.push("");var ze=_e[0]===""||_e[0]&&_e[0].charAt(0)==="/";if(qe){ue.hostname=ue.host=ze?"":_e.length?_e.shift():"";var tt=ue.host&&ue.host.indexOf("@")>0?ue.host.split("@"):!1;tt&&(ue.auth=tt.shift(),ue.host=ue.hostname=tt.shift())}return pe=pe||ue.host&&_e.length,pe&&!ze&&_e.unshift(""),_e.length?ue.pathname=_e.join("/"):(ue.pathname=null,ue.path=null),(!t.isNull(ue.pathname)||!t.isNull(ue.search))&&(ue.path=(ue.pathname?ue.pathname:"")+(ue.search?ue.search:"")),ue.auth=te.auth||ue.auth,ue.slashes=ue.slashes||te.slashes,ue.href=ue.format(),ue},S.prototype.parseHost=function(){var te=this.host,ye=w.exec(te);ye&&(ye=ye[0],ye!==":"&&(this.port=ye.substr(1)),te=te.substr(0,te.length-ye.length)),te&&(this.hostname=te)}},{"./util":181,punycode:134,querystring:137}],181:[function(_,k,b){k.exports={isString:function(T){return typeof T=="string"},isObject:function(T){return typeof T=="object"&&T!==null},isNull:function(T){return T===null},isNullOrUndefined:function(T){return T==null}}},{}],182:[function(_,k,b){(function(T){(function(){var t={};typeof k=="object"?k.exports=t:self.UTIF=t;var S;typeof _=="function"?S=_("pako"):S=self.pako;function D(){(typeof T>"u"||T.env.NODE_ENV=="development")&&console.log.apply(console,arguments)}(function(w,E){(function(){var m=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},y=function(){function C(z){this.message="JPEG error: "+z}return C.prototype=Error(),C.prototype.name="JpegError",C.constructor=C}(),p=function(){function C(z,A){this.message=z,this.g=A}return C.prototype=Error(),C.prototype.name="DNLMarkerError",C.constructor=C}();(function(){function C(){this.M=null,this.B=-1}function z(U,G){for(var Z=0,X=[],W,J,re=16;0<re&&!U[re-1];)re--;X.push({children:[],index:0});var te=X[0],ye;for(W=0;W<re;W++){for(J=0;J<U[W];J++){for(te=X.pop(),te.children[te.index]=G[Z];0<te.index;)te=X.pop();for(te.index++,X.push(te);X.length<=W;)X.push(ye={children:[],index:0}),te.children[te.index]=ye.children,te=ye;Z++}W+1<re&&(X.push(ye={children:[],index:0}),te.children[te.index]=ye.children,te=ye)}return X[0].children}function A(U,G,Z,X,W,J,re,te,ye){function ue(){if(0<se)return se--,Ae>>se&1;if(Ae=U[G++],Ae===255){var ge=U[G++];if(ge){if(ge===220&&Fe){G+=2;var le=U[G++]<<8|U[G++];if(0<le&&le!==Z.g)throw new p("Found DNL marker (0xFFDC) while parsing scan data",le)}throw new y("unexpected marker "+(Ae<<8|ge).toString(16))}}return se=7,Ae>>>7}function Se(ge){for(;;){if(ge=ge[ue()],typeof ge=="number")return ge;if((typeof ge>"u"?"undefined":m(ge))!=="object")throw new y("invalid huffman sequence")}}function Le(ge){for(var le=0;0<ge;)le=le<<1|ue(),ge--;return le}function Pe(ge){if(ge===1)return ue()===1?1:-1;var le=Le(ge);return le>=1<<ge-1?le:le+(-1<<ge)+1}function Ee(ge,le){var et=Se(ge.D);for(et=et===0?0:Pe(et),ge.a[le]=ge.m+=et,et=1;64>et;){var wt=Se(ge.o),Ft=wt&15;if(wt>>=4,Ft===0){if(15>wt)break;et+=16}else et+=wt,ge.a[le+O[et]]=Pe(Ft),et++}}function Me(ge,le){var et=Se(ge.D);et=et===0?0:Pe(et)<<ye,ge.a[le]=ge.m+=et}function He(ge,le){ge.a[le]|=ue()<<ye}function nt(ge,le){if(0<pe)pe--;else for(var et=J;et<=re;){var wt=Se(ge.o),Ft=wt&15;if(wt>>=4,Ft===0){if(15>wt){pe=Le(wt)+(1<<wt)-1;break}et+=16}else et+=wt,ge.a[le+O[et]]=Pe(Ft)*(1<<ye),et++}}function ht(ge,le){for(var et=J,wt=0,Ft;et<=re;){Ft=le+O[et];var Wt=0>ge.a[Ft]?-1:1;switch(Ke){case 0:if(wt=Se(ge.o),Ft=wt&15,wt>>=4,Ft===0)15>wt?(pe=Le(wt)+(1<<wt),Ke=4):(wt=16,Ke=1);else{if(Ft!==1)throw new y("invalid ACn encoding");_e=Pe(Ft),Ke=wt?2:3}continue;case 1:case 2:ge.a[Ft]?ge.a[Ft]+=Wt*(ue()<<ye):(wt--,wt===0&&(Ke=Ke===2?3:0));break;case 3:ge.a[Ft]?ge.a[Ft]+=Wt*(ue()<<ye):(ge.a[Ft]=_e<<ye,Ke=0);break;case 4:ge.a[Ft]&&(ge.a[Ft]+=Wt*(ue()<<ye))}et++}Ke===4&&(pe--,pe===0&&(Ke=0))}for(var Fe=9<arguments.length&&arguments[9]!==void 0?arguments[9]:!1,Ce=Z.P,Be=G,Ae=0,se=0,pe=0,Ke=0,_e,ke=X.length,qe,tt,Ge,We,Je=Z.S?J===0?te===0?Me:He:te===0?nt:ht:Ee,it=0,ze=ke===1?X[0].c*X[0].l:Ce*Z.O,de,ve;it<ze;){var be=W?Math.min(ze-it,W):ze;for(qe=0;qe<ke;qe++)X[qe].m=0;if(pe=0,ke===1){var Oe=X[0];for(We=0;We<be;We++)Je(Oe,64*((Oe.c+1)*(it/Oe.c|0)+it%Oe.c)),it++}else for(We=0;We<be;We++){for(qe=0;qe<ke;qe++)for(Oe=X[qe],de=Oe.h,ve=Oe.j,tt=0;tt<ve;tt++)for(Ge=0;Ge<de;Ge++)Je(Oe,64*((Oe.c+1)*((it/Ce|0)*Oe.j+tt)+(it%Ce*Oe.h+Ge)));it++}if(se=0,(Oe=x(U,G))&&Oe.f&&((0,_util.warn)("decodeScan - unexpected MCU data, current marker is: "+Oe.f),G=Oe.offset),Oe=Oe&&Oe.F,!Oe||65280>=Oe)throw new y("marker was not found");if(65488<=Oe&&65495>=Oe)G+=2;else break}return(Oe=x(U,G))&&Oe.f&&((0,_util.warn)("decodeScan - unexpected Scan data, current marker is: "+Oe.f),G=Oe.offset),G-Be}function P(U,G){for(var Z=G.c,X=G.l,W=new Int16Array(64),J=0;J<X;J++)for(var re=0;re<Z;re++){var te=64*((G.c+1)*J+re),ye=W,ue=G.G,Se=G.a;if(!ue)throw new y("missing required Quantization Table.");for(var Le=0;64>Le;Le+=8){var Pe=Se[te+Le],Ee=Se[te+Le+1],Me=Se[te+Le+2],He=Se[te+Le+3],nt=Se[te+Le+4],ht=Se[te+Le+5],Fe=Se[te+Le+6],Ce=Se[te+Le+7];if(Pe*=ue[Le],!(Ee|Me|He|nt|ht|Fe|Ce))Pe=5793*Pe+512>>10,ye[Le]=Pe,ye[Le+1]=Pe,ye[Le+2]=Pe,ye[Le+3]=Pe,ye[Le+4]=Pe,ye[Le+5]=Pe,ye[Le+6]=Pe,ye[Le+7]=Pe;else{Ee*=ue[Le+1],Me*=ue[Le+2],He*=ue[Le+3],nt*=ue[Le+4],ht*=ue[Le+5],Fe*=ue[Le+6],Ce*=ue[Le+7];var Be=5793*Pe+128>>8,Ae=5793*nt+128>>8,se=Me,pe=Fe;nt=2896*(Ee-Ce)+128>>8,Ce=2896*(Ee+Ce)+128>>8,He<<=4,ht<<=4,Be=Be+Ae+1>>1,Ae=Be-Ae,Pe=3784*se+1567*pe+128>>8,se=1567*se-3784*pe+128>>8,pe=Pe,nt=nt+ht+1>>1,ht=nt-ht,Ce=Ce+He+1>>1,He=Ce-He,Be=Be+pe+1>>1,pe=Be-pe,Ae=Ae+se+1>>1,se=Ae-se,Pe=2276*nt+3406*Ce+2048>>12,nt=3406*nt-2276*Ce+2048>>12,Ce=Pe,Pe=799*He+4017*ht+2048>>12,He=4017*He-799*ht+2048>>12,ht=Pe,ye[Le]=Be+Ce,ye[Le+7]=Be-Ce,ye[Le+1]=Ae+ht,ye[Le+6]=Ae-ht,ye[Le+2]=se+He,ye[Le+5]=se-He,ye[Le+3]=pe+nt,ye[Le+4]=pe-nt}}for(ue=0;8>ue;++ue)Pe=ye[ue],Ee=ye[ue+8],Me=ye[ue+16],He=ye[ue+24],nt=ye[ue+32],ht=ye[ue+40],Fe=ye[ue+48],Ce=ye[ue+56],Ee|Me|He|nt|ht|Fe|Ce?(Be=5793*Pe+2048>>12,Ae=5793*nt+2048>>12,se=Me,pe=Fe,nt=2896*(Ee-Ce)+2048>>12,Ce=2896*(Ee+Ce)+2048>>12,Be=(Be+Ae+1>>1)+4112,Ae=Be-Ae,Pe=3784*se+1567*pe+2048>>12,se=1567*se-3784*pe+2048>>12,pe=Pe,nt=nt+ht+1>>1,ht=nt-ht,Ce=Ce+He+1>>1,He=Ce-He,Be=Be+pe+1>>1,pe=Be-pe,Ae=Ae+se+1>>1,se=Ae-se,Pe=2276*nt+3406*Ce+2048>>12,nt=3406*nt-2276*Ce+2048>>12,Ce=Pe,Pe=799*He+4017*ht+2048>>12,He=4017*He-799*ht+2048>>12,ht=Pe,Pe=Be+Ce,Ce=Be-Ce,Ee=Ae+ht,Fe=Ae-ht,Me=se+He,ht=se-He,He=pe+nt,nt=pe-nt,Pe=16>Pe?0:4080<=Pe?255:Pe>>4,Ee=16>Ee?0:4080<=Ee?255:Ee>>4,Me=16>Me?0:4080<=Me?255:Me>>4,He=16>He?0:4080<=He?255:He>>4,nt=16>nt?0:4080<=nt?255:nt>>4,ht=16>ht?0:4080<=ht?255:ht>>4,Fe=16>Fe?0:4080<=Fe?255:Fe>>4,Ce=16>Ce?0:4080<=Ce?255:Ce>>4,Se[te+ue]=Pe,Se[te+ue+8]=Ee,Se[te+ue+16]=Me,Se[te+ue+24]=He,Se[te+ue+32]=nt,Se[te+ue+40]=ht,Se[te+ue+48]=Fe,Se[te+ue+56]=Ce):(Pe=5793*Pe+8192>>14,Pe=-2040>Pe?0:2024<=Pe?255:Pe+2056>>4,Se[te+ue]=Pe,Se[te+ue+8]=Pe,Se[te+ue+16]=Pe,Se[te+ue+24]=Pe,Se[te+ue+32]=Pe,Se[te+ue+40]=Pe,Se[te+ue+48]=Pe,Se[te+ue+56]=Pe)}return G.a}function x(U,G){var Z=2<arguments.length&&arguments[2]!==void 0?arguments[2]:G,X=U.length-1;if(Z=Z<G?Z:G,G>=X)return null;var W=U[G]<<8|U[G+1];if(65472<=W&&65534>=W)return{f:null,F:W,offset:G};for(var J=U[Z]<<8|U[Z+1];!(65472<=J&&65534>=J);){if(++Z>=X)return null;J=U[Z]<<8|U[Z+1]}return{f:W.toString(16),F:J,offset:Z}}var O=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);C.prototype={parse:function(U){function G(){var se=U[re]<<8|U[re+1];return re+=2,se}function Z(){var se=G();se=re+se-2;var pe=x(U,se,re);return pe&&pe.f&&((0,_util.warn)("readDataBlock - incorrect length, current marker is: "+pe.f),se=pe.offset),se=U.subarray(re,se),re+=se.length,se}function X(se){for(var pe=Math.ceil(se.v/8/se.s),Ke=Math.ceil(se.g/8/se.u),_e=0;_e<se.b.length;_e++){Be=se.b[_e];var ke=Math.ceil(Math.ceil(se.v/8)*Be.h/se.s),qe=Math.ceil(Math.ceil(se.g/8)*Be.j/se.u);Be.a=new Int16Array(64*Ke*Be.j*(pe*Be.h+1)),Be.c=ke,Be.l=qe}se.P=pe,se.O=Ke}var W=(1<arguments.length&&arguments[1]!==void 0?arguments[1]:{}).N,J=W===void 0?null:W,re=0,te=null,ye=0;W=[];var ue=[],Se=[],Le=G();if(Le!==65496)throw new y("SOI not found");for(Le=G();Le!==65497;){switch(Le){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var Pe=Z();Le===65518&&Pe[0]===65&&Pe[1]===100&&Pe[2]===111&&Pe[3]===98&&Pe[4]===101&&(te={version:Pe[5]<<8|Pe[6],Y:Pe[7]<<8|Pe[8],Z:Pe[9]<<8|Pe[10],W:Pe[11]});break;case 65499:Le=G()+re-2;for(var Ee;re<Le;){var Me=U[re++],He=new Uint16Array(64);if(Me>>4)if(Me>>4===1)for(Pe=0;64>Pe;Pe++)Ee=O[Pe],He[Ee]=G();else throw new y("DQT - invalid table spec");else for(Pe=0;64>Pe;Pe++)Ee=O[Pe],He[Ee]=U[re++];W[Me&15]=He}break;case 65472:case 65473:case 65474:if(nt)throw new y("Only single frame JPEGs supported");G();var nt={};for(nt.X=Le===65473,nt.S=Le===65474,nt.precision=U[re++],Le=G(),nt.g=J||Le,nt.v=G(),nt.b=[],nt.C={},Pe=U[re++],Le=He=Me=0;Le<Pe;Le++){Ee=U[re];var ht=U[re+1]>>4,Fe=U[re+1]&15;Me<ht&&(Me=ht),He<Fe&&(He=Fe),ht=nt.b.push({h:ht,j:Fe,T:U[re+2],G:null}),nt.C[Ee]=ht-1,re+=3}nt.s=Me,nt.u=He,X(nt);break;case 65476:for(Ee=G(),Le=2;Le<Ee;){for(Me=U[re++],He=new Uint8Array(16),Pe=ht=0;16>Pe;Pe++,re++)ht+=He[Pe]=U[re];for(Fe=new Uint8Array(ht),Pe=0;Pe<ht;Pe++,re++)Fe[Pe]=U[re];Le+=17+ht,(Me>>4?ue:Se)[Me&15]=z(He,Fe)}break;case 65501:G();var Ce=G();break;case 65498:for(Pe=++ye===1&&!J,G(),Me=U[re++],Ee=[],Le=0;Le<Me;Le++){He=nt.C[U[re++]];var Be=nt.b[He];He=U[re++],Be.D=Se[He>>4],Be.o=ue[He&15],Ee.push(Be)}Le=U[re++],Me=U[re++],He=U[re++];try{var Ae=A(U,re,nt,Ee,Ce,Le,Me,He>>4,He&15,Pe);re+=Ae}catch(se){if(se instanceof p)return(0,_util.warn)('Attempting to re-parse JPEG image using "scanLines" parameter found in DNL marker (0xFFDC) segment.'),this.parse(U,{N:se.g});throw se}break;case 65500:re+=4;break;case 65535:U[re]!==255&&re--;break;default:if(U[re-3]===255&&192<=U[re-2]&&254>=U[re-2])re-=3;else if((Pe=x(U,re-2))&&Pe.f)(0,_util.warn)("JpegImage.parse - unexpected data, current marker is: "+Pe.f),re=Pe.offset;else throw new y("unknown marker "+Le.toString(16))}Le=G()}for(this.width=nt.v,this.height=nt.g,this.A=te,this.b=[],Le=0;Le<nt.b.length;Le++)Be=nt.b[Le],(Ce=W[Be.T])&&(Be.G=Ce),this.b.push({R:P(nt,Be),U:Be.h/nt.s,V:Be.j/nt.u,c:Be.c,l:Be.l});this.i=this.b.length},L:function(U,G){var Z=this.width/U,X=this.height/G,W,J,re=this.b.length,te=U*G*re,ye=new Uint8ClampedArray(te),ue=new Uint32Array(U);for(J=0;J<re;J++){var Se=this.b[J],Le=Se.U*Z,Pe=Se.V*X,Ee=J,Me=Se.R,He=Se.c+1<<3;for(W=0;W<U;W++)Se=0|W*Le,ue[W]=(Se&4294967288)<<3|Se&7;for(Le=0;Le<G;Le++)for(Se=0|Le*Pe,Se=He*(Se&4294967288)|(Se&7)<<3,W=0;W<U;W++)ye[Ee]=Me[Se+ue[W]],Ee+=re}if(X=this.M)for(J=0;J<te;)for(Z=Se=0;Se<re;Se++,J++,Z+=2)ye[J]=(ye[J]*X[Z]>>8)+X[Z+1];return ye},w:function(){return this.A?!!this.A.W:this.i===3?this.B!==0:this.B===1},I:function(U){for(var G,Z,X,W=0,J=U.length;W<J;W+=3)G=U[W],Z=U[W+1],X=U[W+2],U[W]=G-179.456+1.402*X,U[W+1]=G+135.459-.344*Z-.714*X,U[W+2]=G-226.816+1.772*Z;return U},K:function(U){for(var G,Z,X,W,J=0,re=0,te=U.length;re<te;re+=4)G=U[re],Z=U[re+1],X=U[re+2],W=U[re+3],U[J++]=-122.67195406894+Z*(-660635669420364e-19*Z+.000437130475926232*X-54080610064599e-18*G+.00048449797120281*W-.154362151871126)+X*(-.000957964378445773*X+.000817076911346625*G-.00477271405408747*W+1.53380253221734)+G*(.000961250184130688*G-.00266257332283933*W+.48357088451265)+W*(-.000336197177618394*W+.484791561490776),U[J++]=107.268039397724+Z*(219927104525741e-19*Z-.000640992018297945*X+.000659397001245577*G+.000426105652938837*W-.176491792462875)+X*(-.000778269941513683*X+.00130872261408275*G+.000770482631801132*W-.151051492775562)+G*(.00126935368114843*G-.00265090189010898*W+.25802910206845)+W*(-.000318913117588328*W-.213742400323665),U[J++]=-20.810012546947+Z*(-.000570115196973677*Z-263409051004589e-19*X+.0020741088115012*G-.00288260236853442*W+.814272968359295)+X*(-153496057440975e-19*X-.000132689043961446*G+.000560833691242812*W-.195152027534049)+G*(.00174418132927582*G-.00255243321439347*W+.116935020465145)+W*(-.000343531996510555*W+.24165260232407);return U.subarray(0,J)},J:function(U){for(var G,Z,X,W=0,J=U.length;W<J;W+=4)G=U[W],Z=U[W+1],X=U[W+2],U[W]=434.456-G-1.402*X,U[W+1]=119.541-G+.344*Z+.714*X,U[W+2]=481.816-G-1.772*Z;return U},H:function(U){for(var G,Z,X,W,J=0,re=1/255,te=0,ye=U.length;te<ye;te+=4)G=U[te]*re,Z=U[te+1]*re,X=U[te+2]*re,W=U[te+3]*re,U[J++]=255+G*(-4.387332384609988*G+54.48615194189176*Z+18.82290502165302*X+212.25662451639585*W-285.2331026137004)+Z*(1.7149763477362134*Z-5.6096736904047315*X-17.873870861415444*W-5.497006427196366)+X*(-2.5217340131683033*X-21.248923337353073*W+17.5119270841813)-W*(21.86122147463605*W+189.48180835922747),U[J++]=255+G*(8.841041422036149*G+60.118027045597366*Z+6.871425592049007*X+31.159100130055922*W-79.2970844816548)+Z*(-15.310361306967817*Z+17.575251261109482*X+131.35250912493976*W-190.9453302588951)+X*(4.444339102852739*X+9.8632861493405*W-24.86741582555878)-W*(20.737325471181034*W+187.80453709719578),U[J++]=255+G*(.8842522430003296*G+8.078677503112928*Z+30.89978309703729*X-.23883238689178934*W-14.183576799673286)+Z*(10.49593273432072*Z+63.02378494754052*X+50.606957656360734*W-112.23884253719248)+X*(.03296041114873217*X+115.60384449646641*W-193.58209356861505)-W*(22.33816807309886*W+180.12613974708367);return U.subarray(0,J)},getData:function(U,G,Z){if(4<this.i)throw new y("Unsupported color mode");if(U=this.L(U,G),this.i===1&&Z){Z=U.length,G=new Uint8ClampedArray(3*Z);for(var X=0,W=0;W<Z;W++){var J=U[W];G[X++]=J,G[X++]=J,G[X++]=J}return G}if(this.i===3&&this.w())return this.I(U);if(this.i===4){if(this.w())return Z?this.K(U):this.J(U);if(Z)return this.H(U)}return U}},w.JpegDecoder=C})()})(),w.encodeImage=function(m,y,p,C){var z={t256:[y],t257:[p],t258:[8,8,8,8],t259:[1],t262:[2],t273:[1e3],t277:[4],t278:[p],t279:[y*p*4],t282:[1],t283:[1],t284:[1],t286:[0],t287:[0],t296:[1],t305:["Photopea (UTIF.js)"],t338:[1]};if(C)for(var A in C)z[A]=C[A];for(var P=new Uint8Array(w.encode([z])),x=new Uint8Array(m),O=new Uint8Array(1e3+y*p*4),A=0;A<P.length;A++)O[A]=P[A];for(var A=0;A<x.length;A++)O[1e3+A]=x[A];return O.buffer},w.encode=function(m){var y=new Uint8Array(2e4),p=4,C=w._binBE;y[0]=77,y[1]=77,y[3]=42;var z=8;C.writeUint(y,p,z),p+=4;for(var A=0;A<m.length;A++){var P=w._writeIFD(C,y,z,m[A]);z=P[1],A<m.length-1&&C.writeUint(y,P[0],z)}return y.slice(0,z).buffer},w.decode=function(m){w.decode._decodeG3.allow2D=null;var y=new Uint8Array(m),p=0,C=w._binBE.readASCII(y,p,2);p+=2;var z=C=="II"?w._binLE:w._binBE;z.readUshort(y,p),p+=2;var A=z.readUint(y,p);p+=4;for(var P=[];;){var x=w._readIFD(z,y,A,P);if(A=z.readUint(y,x),A==0)break}return P},w.decodeImages=function(m,y){for(var p=new Uint8Array(m),C=w._binBE.readASCII(p,0,2),z=0;z<y.length;z++){var A=y[z];if(A.t256!=null){A.isLE=C=="II",A.width=A.t256[0],A.height=A.t257[0];var P=A.t259?A.t259[0]:1,x=A.t266?A.t266[0]:1;A.t284&&A.t284[0]==2&&D("PlanarConfiguration 2 should not be used!");var O=(A.t258?Math.min(32,A.t258[0]):1)*(A.t277?A.t277[0]:1),U=Math.ceil(A.width*O/8)*8,G=A.t273;G==null&&(G=A.t324);var Z=A.t279;P==1&&G.length==1&&(Z=[A.height*(U>>>3)]),Z==null&&(Z=A.t325);var X=new Uint8Array(A.height*(U>>>3)),W=0;if(A.t322!=null){for(var J=A.t322[0],re=A.t323[0],te=Math.floor((A.width+J-1)/J),ye=Math.floor((A.height+re-1)/re),ue=new Uint8Array(Math.ceil(J*re*O/8)|0),Se=0;Se<ye;Se++)for(var Le=0;Le<te;Le++){for(var Pe=Se*te+Le,Ee=0;Ee<ue.length;Ee++)ue[Ee]=0;w.decode._decompress(A,p,G[Pe],Z[Pe],P,ue,0,x),P==6?X=ue:w._copyTile(ue,Math.ceil(J*O/8)|0,re,X,Math.ceil(A.width*O/8)|0,A.height,Math.ceil(Le*J*O/8)|0,Se*re)}W=X.length*8}else{var Me=A.t278?A.t278[0]:A.height;Me=Math.min(Me,A.height);for(var Pe=0;Pe<G.length;Pe++)w.decode._decompress(A,p,G[Pe],Z[Pe],P,X,Math.ceil(W/8)|0,x),W+=U*Me;W=Math.min(W,X.length*8)}A.data=new Uint8Array(X.buffer,0,Math.ceil(W/8)|0)}}},w.decode._decompress=function(m,y,p,C,z,A,P,x){if(z==1)for(var O=0;O<C;O++)A[P+O]=y[p+O];else if(z==3)w.decode._decodeG3(y,p,C,A,P,m.width,x);else if(z==4)w.decode._decodeG4(y,p,C,A,P,m.width,x);else if(z==5)w.decode._decodeLZW(y,p,A,P);else if(z==6)w.decode._decodeOldJPEG(m,y,p,C,A,P);else if(z==7)w.decode._decodeNewJPEG(m,y,p,C,A,P);else if(z==8)for(var U=new Uint8Array(y.buffer,p,C),G=E.inflate(U),Z=0;Z<G.length;Z++)A[P+Z]=G[Z];else z==32773?w.decode._decodePackBits(y,p,C,A,P):z==32809?w.decode._decodeThunder(y,p,C,A,P):D("Unknown compression",z);if(m.t317&&m.t317[0]==2)for(var X=m.t277?m.t277[0]:1,W=m.t278?m.t278[0]:m.height,J=m.width*X,re=0;re<W;re++){var te=P+re*J;if(X==3)for(var O=3;O<J;O+=3)A[te+O]=A[te+O]+A[te+O-3]&255,A[te+O+1]=A[te+O+1]+A[te+O-2]&255,A[te+O+2]=A[te+O+2]+A[te+O-1]&255;else for(var O=X;O<J;O++)A[te+O]=A[te+O]+A[te+O-X]&255}},w.decode._decodeNikon=function(m,y,x,C,z){var A,P,x;D(m.slice(y,y+100)),A=m[y],y++,P=m[y],y++,D(A.toString(16),P.toString(16),x)},w.decode._decodeNewJPEG=function(m,y,p,C,z,A){var P=m.t347,x=P?P.length:0,O=new Uint8Array(x+C);if(P){for(var U=216,G=217,Z=0,X=0;X<x-1&&!(P[X]==255&&P[X+1]==G);X++)O[Z++]=P[X];var W=y[p],J=y[p+1];(W!=255||J!=U)&&(O[Z++]=W,O[Z++]=J);for(var X=2;X<C;X++)O[Z++]=y[p+X]}else for(var X=0;X<C;X++)O[X]=y[p+X];if(m.t262==32803){var re=m.t258[0],te=new LosslessJpegDecoder,ye=te.decode(O),ue=ye.length;if(re==16)for(var X=0;X<ue;X++)z[A++]=ye[X]&255,z[A++]=ye[X]>>>8;else if(re==12)for(var X=0;X<ue;X+=2)z[A++]=ye[X]>>>4,z[A++]=(ye[X]<<4|ye[X+1]>>>8)&255,z[A++]=ye[X+1]&255;else throw new Error("unsupported bit depth "+re)}else{var Se=new w.JpegDecoder;Se.parse(O);for(var Le=Se.getData(Se.width,Se.height),X=0;X<Le.length;X++)z[A+X]=Le[X]}m.t262[0]==6&&(m.t262[0]=2)},w.decode._decodeOldJPEGInit=function(m,y,p,C){var z=216,A=219,P=196,x=221,O=192,U=218,G=0,Z=0,X,W,J=!1,re,te,ye,ue=m.t513,Se=ue?ue[0]:0,Le=m.t514,Pe=Le?Le[0]:0,Ee=m.t324||m.t273||ue,Me=m.t530,He=0,nt=0,ht=m.t277?m.t277[0]:1,Fe=m.t515;if(Ee&&(Z=Ee[0],J=Ee.length>1),!J){if(y[p]==255&&y[p+1]==z)return{jpegOffset:p};if(ue!=null&&(y[p+Se]==255&&y[p+Se+1]==z?G=p+Se:D("JPEGInterchangeFormat does not point to SOI"),Le==null?D("JPEGInterchangeFormatLength field is missing"):(Se>=Z||Se+Pe<=Z)&&D("JPEGInterchangeFormatLength field value is invalid"),G!=null))return{jpegOffset:G}}if(Me!=null&&(He=Me[0],nt=Me[1]),ue!=null&&Le!=null)if(Pe>=2&&Se+Pe<=Z){for(y[p+Se+Pe-2]==255&&y[p+Se+Pe-1]==z?X=new Uint8Array(Pe-2):X=new Uint8Array(Pe),re=0;re<X.length;re++)X[re]=y[p+Se+re];D("Incorrect JPEG interchange format: using JPEGInterchangeFormat offset to derive tables")}else D("JPEGInterchangeFormat+JPEGInterchangeFormatLength > offset to first strip or tile");if(X==null){var Ce=0,Be=[];Be[Ce++]=255,Be[Ce++]=z;var Ae=m.t519;if(Ae==null)throw new Error("JPEGQTables tag is missing");for(re=0;re<Ae.length;re++)for(Be[Ce++]=255,Be[Ce++]=A,Be[Ce++]=0,Be[Ce++]=67,Be[Ce++]=re,te=0;te<64;te++)Be[Ce++]=y[p+Ae[re]+te];for(ye=0;ye<2;ye++){var se=m[ye==0?"t520":"t521"];if(se==null)throw new Error((ye==0?"JPEGDCTables":"JPEGACTables")+" tag is missing");for(re=0;re<se.length;re++){Be[Ce++]=255,Be[Ce++]=P;var pe=19;for(te=0;te<16;te++)pe+=y[p+se[re]+te];for(Be[Ce++]=pe>>>8,Be[Ce++]=pe&255,Be[Ce++]=re|ye<<4,te=0;te<16;te++)Be[Ce++]=y[p+se[re]+te];for(te=0;te<pe;te++)Be[Ce++]=y[p+se[re]+16+te]}}if(Be[Ce++]=255,Be[Ce++]=O,Be[Ce++]=0,Be[Ce++]=8+3*ht,Be[Ce++]=8,Be[Ce++]=m.height>>>8&255,Be[Ce++]=m.height&255,Be[Ce++]=m.width>>>8&255,Be[Ce++]=m.width&255,Be[Ce++]=ht,ht==1)Be[Ce++]=1,Be[Ce++]=17,Be[Ce++]=0;else for(re=0;re<3;re++)Be[Ce++]=re+1,Be[Ce++]=re!=0?17:(He&15)<<4|nt&15,Be[Ce++]=re;Fe!=null&&Fe[0]!=0&&(Be[Ce++]=255,Be[Ce++]=x,Be[Ce++]=0,Be[Ce++]=4,Be[Ce++]=Fe[0]>>>8&255,Be[Ce++]=Fe[0]&255),X=new Uint8Array(Be)}var Ke=-1;for(re=0;re<X.length-1;){if(X[re]==255&&X[re+1]==O){Ke=re;break}re++}if(Ke==-1){var _e=new Uint8Array(X.length+10+3*ht);_e.set(X);var ke=X.length;if(Ke=X.length,X=_e,X[ke++]=255,X[ke++]=O,X[ke++]=0,X[ke++]=8+3*ht,X[ke++]=8,X[ke++]=m.height>>>8&255,X[ke++]=m.height&255,X[ke++]=m.width>>>8&255,X[ke++]=m.width&255,X[ke++]=ht,ht==1)X[ke++]=1,X[ke++]=17,X[ke++]=0;else for(re=0;re<3;re++)X[ke++]=re+1,X[ke++]=re!=0?17:(He&15)<<4|nt&15,X[ke++]=re}if(y[Z]==255&&y[Z+1]==U){var qe=y[Z+2]<<8|y[Z+3];for(W=new Uint8Array(qe+2),W[0]=y[Z],W[1]=y[Z+1],W[2]=y[Z+2],W[3]=y[Z+3],re=0;re<qe-2;re++)W[re+4]=y[Z+re+4]}else{W=new Uint8Array(8+2*ht);var tt=0;if(W[tt++]=255,W[tt++]=U,W[tt++]=0,W[tt++]=6+2*ht,W[tt++]=ht,ht==1)W[tt++]=1,W[tt++]=0;else for(re=0;re<3;re++)W[tt++]=re+1,W[tt++]=re<<4|re;W[tt++]=0,W[tt++]=63,W[tt++]=0}return{jpegOffset:p,tables:X,sosMarker:W,sofPosition:Ke}},w.decode._decodeOldJPEG=function(m,y,p,C,z,A){var P,x,O,U,G=w.decode._decodeOldJPEGInit(m,y,p,C);if(G.jpegOffset!=null)for(x=p+C-G.jpegOffset,U=new Uint8Array(x),P=0;P<x;P++)U[P]=y[G.jpegOffset+P];else{for(O=G.tables.length,U=new Uint8Array(O+G.sosMarker.length+C+2),U.set(G.tables),U[G.sofPosition+5]=m.height>>>8&255,U[G.sofPosition+6]=m.height&255,U[G.sofPosition+7]=m.width>>>8&255,U[G.sofPosition+8]=m.width&255,(y[p]!=255||y[p+1]!=SOS)&&(U.set(G.sosMarker,bufoff),bufoff+=sosMarker.length),P=0;P<C;P++)U[bufoff++]=y[p+P];U[bufoff++]=255,U[bufoff++]=EOI}var Z=new w.JpegDecoder;Z.parse(U);for(var X=Z.getData(Z.width,Z.height),P=0;P<X.length;P++)z[A+P]=X[P];m.t262[0]==6&&(m.t262[0]=2)},w.decode._decodePackBits=function(m,y,p,C,z){for(var A=new Int8Array(m.buffer),P=new Int8Array(C.buffer),x=y+p;y<x;){var O=A[y];if(y++,O>=0&&O<128)for(var U=0;U<O+1;U++)P[z]=A[y],z++,y++;if(O>=-127&&O<0){for(var U=0;U<-O+1;U++)P[z]=A[y],z++;y++}}},w.decode._decodeThunder=function(m,y,p,C,z){for(var A=[0,1,0,-1],P=[0,1,2,3,0,-3,-2,-1],x=y+p,O=z*2,U=0;y<x;){var G=m[y],Z=G>>>6,X=G&63;if(y++,Z==3&&(U=X&15,C[O>>>1]|=U<<4*(1-O&1),O++),Z==0)for(var W=0;W<X;W++)C[O>>>1]|=U<<4*(1-O&1),O++;if(Z==2)for(var W=0;W<2;W++){var J=X>>>3*(1-W)&7;J!=4&&(U+=P[J],C[O>>>1]|=U<<4*(1-O&1),O++)}if(Z==1)for(var W=0;W<3;W++){var J=X>>>2*(2-W)&3;J!=2&&(U+=A[J],C[O>>>1]|=U<<4*(1-O&1),O++)}}},w.decode._dmap={1:0,"011":1,"000011":2,"0000011":3,"010":-1,"000010":-2,"0000010":-3},w.decode._lens=function(){var m=function(O,U,G,Z){for(var X=0;X<U.length;X++)O[U[X]]=G+X*Z},y="00110101,000111,0111,1000,1011,1100,1110,1111,10011,10100,00111,01000,001000,000011,110100,110101,101010,101011,0100111,0001100,0001000,0010111,0000011,0000100,0101000,0101011,0010011,0100100,0011000,00000010,00000011,00011010,00011011,00010010,00010011,00010100,00010101,00010110,00010111,00101000,00101001,00101010,00101011,00101100,00101101,00000100,00000101,00001010,00001011,01010010,01010011,01010100,01010101,00100100,00100101,01011000,01011001,01011010,01011011,01001010,01001011,00110010,00110011,00110100",p="0000110111,010,11,10,011,0011,0010,00011,000101,000100,0000100,0000101,0000111,00000100,00000111,000011000,0000010111,0000011000,0000001000,00001100111,00001101000,00001101100,00000110111,00000101000,00000010111,00000011000,000011001010,000011001011,000011001100,000011001101,000001101000,000001101001,000001101010,000001101011,000011010010,000011010011,000011010100,000011010101,000011010110,000011010111,000001101100,000001101101,000011011010,000011011011,000001010100,000001010101,000001010110,000001010111,000001100100,000001100101,000001010010,000001010011,000000100100,000000110111,000000111000,000000100111,000000101000,000001011000,000001011001,000000101011,000000101100,000001011010,000001100110,000001100111",C="11011,10010,010111,0110111,00110110,00110111,01100100,01100101,01101000,01100111,011001100,011001101,011010010,011010011,011010100,011010101,011010110,011010111,011011000,011011001,011011010,011011011,010011000,010011001,010011010,011000,010011011",z="0000001111,000011001000,000011001001,000001011011,000000110011,000000110100,000000110101,0000001101100,0000001101101,0000001001010,0000001001011,0000001001100,0000001001101,0000001110010,0000001110011,0000001110100,0000001110101,0000001110110,0000001110111,0000001010010,0000001010011,0000001010100,0000001010101,0000001011010,0000001011011,0000001100100,0000001100101",A="00000001000,00000001100,00000001101,000000010010,000000010011,000000010100,000000010101,000000010110,000000010111,000000011100,000000011101,000000011110,000000011111";y=y.split(","),p=p.split(","),C=C.split(","),z=z.split(","),A=A.split(",");var P={},x={};return m(P,y,0,1),m(P,C,64,64),m(P,A,1792,64),m(x,p,0,1),m(x,z,64,64),m(x,A,1792,64),[P,x]}(),w.decode._decodeG4=function(m,y,p,C,z,A,P){for(var x=w.decode,O=y<<3,U=0,G="",Z=[],X=[],W=0;W<A;W++)X.push(0);X=x._makeDiff(X);for(var J=0,re=0,te=0,ye=0,ue=0,Se=0,Le="",Pe=0,Ee=Math.ceil(A/8)*8;O>>>3<y+p;){te=x._findDiff(X,J+(J==0?0:1),1-ue),ye=x._findDiff(X,te,ue);var Me=0;if(P==1&&(Me=m[O>>>3]>>>7-(O&7)&1),P==2&&(Me=m[O>>>3]>>>(O&7)&1),O++,G+=Me,Le=="H"){if(x._lens[ue][G]!=null){var He=x._lens[ue][G];G="",U+=He,He<64&&(x._addNtimes(Z,U,ue),J+=U,ue=1-ue,U=0,Pe--,Pe==0&&(Le=""))}}else G=="0001"&&(G="",x._addNtimes(Z,ye-J,ue),J=ye),G=="001"&&(G="",Le="H",Pe=2),x._dmap[G]!=null&&(re=te+x._dmap[G],x._addNtimes(Z,re-J,ue),J=re,G="",ue=1-ue);Z.length==A&&Le==""&&(x._writeBits(Z,C,z*8+Se*Ee),ue=0,Se++,J=0,X=x._makeDiff(Z),Z=[])}},w.decode._findDiff=function(m,y,p){for(var C=0;C<m.length;C+=2)if(m[C]>=y&&m[C+1]==p)return m[C]},w.decode._makeDiff=function(m){var y=[];m[0]==1&&y.push(0,1);for(var p=1;p<m.length;p++)m[p-1]!=m[p]&&y.push(p,m[p]);return y.push(m.length,0,m.length,1),y},w.decode._decodeG3=function(m,y,p,C,z,A,P){for(var x=w.decode,O=y<<3,U=0,G="",Z=[],X=[],W=0;W<A;W++)Z.push(0);for(var J=0,re=0,te=0,ye=0,ue=0,Se=-1,Le="",Pe=0,Ee=!1,Me=Math.ceil(A/8)*8;O>>>3<y+p;){te=x._findDiff(X,J+(J==0?0:1),1-ue),ye=x._findDiff(X,te,ue);var He=0;if(P==1&&(He=m[O>>>3]>>>7-(O&7)&1),P==2&&(He=m[O>>>3]>>>(O&7)&1),O++,G+=He,Ee){if(x._lens[ue][G]!=null){var nt=x._lens[ue][G];G="",U+=nt,nt<64&&(x._addNtimes(Z,U,ue),ue=1-ue,U=0)}}else if(Le=="H"){if(x._lens[ue][G]!=null){var nt=x._lens[ue][G];G="",U+=nt,nt<64&&(x._addNtimes(Z,U,ue),J+=U,ue=1-ue,U=0,Pe--,Pe==0&&(Le=""))}}else G=="0001"&&(G="",x._addNtimes(Z,ye-J,ue),J=ye),G=="001"&&(G="",Le="H",Pe=2),x._dmap[G]!=null&&(re=te+x._dmap[G],x._addNtimes(Z,re-J,ue),J=re,G="",ue=1-ue);G.endsWith("000000000001")&&(Se>=0&&x._writeBits(Z,C,z*8+Se*Me),P==1&&(Ee=(m[O>>>3]>>>7-(O&7)&1)==1),P==2&&(Ee=(m[O>>>3]>>>(O&7)&1)==1),O++,x._decodeG3.allow2D==null&&(x._decodeG3.allow2D=Ee),x._decodeG3.allow2D||(Ee=!0,O--),G="",ue=0,Se++,J=0,X=x._makeDiff(Z),Z=[])}Z.length==A&&x._writeBits(Z,C,z*8+Se*Me)},w.decode._addNtimes=function(m,y,p){for(var C=0;C<y;C++)m.push(p)},w.decode._writeBits=function(m,y,p){for(var C=0;C<m.length;C++)y[p+C>>>3]|=m[C]<<7-(p+C&7)},w.decode._decodeLZW=function(m,y,p,C){if(w.decode._lzwTab==null){for(var z=new Uint32Array(65535),A=new Uint16Array(65535),G=new Uint8Array(2e6),P=0;P<256;P++)G[P<<2]=P,z[P]=P<<2,A[P]=1;w.decode._lzwTab=[z,A,G]}for(var x=w.decode._copyData,O=w.decode._lzwTab[0],U=w.decode._lzwTab[1],G=w.decode._lzwTab[2],Z=258,X=1032,W=9,J=y<<3,re=256,te=257,ye=0,ue=0,Se=0;ye=m[J>>>3]<<16|m[J+8>>>3]<<8|m[J+16>>>3],ue=ye>>24-(J&7)-W&(1<<W)-1,J+=W,ue!=te;){if(ue==re){if(W=9,Z=258,X=1032,ye=m[J>>>3]<<16|m[J+8>>>3]<<8|m[J+16>>>3],ue=ye>>24-(J&7)-W&(1<<W)-1,J+=W,ue==te)break;p[C]=ue,C++}else if(ue<Z){var Le=O[ue],Pe=U[ue];if(x(G,Le,p,C,Pe),C+=Pe,Se>=Z)O[Z]=X,G[O[Z]]=Le[0],U[Z]=1,X=X+1+3&-4,Z++;else{O[Z]=X;var Ee=O[Se],Me=U[Se];x(G,Ee,G,X,Me),G[X+Me]=G[Le],Me++,U[Z]=Me,Z++,X=X+Me+3&-4}Z+1==1<<W&&W++}else{if(Se>=Z)O[Z]=X,U[Z]=0,Z++;else{O[Z]=X;var Ee=O[Se],Me=U[Se];x(G,Ee,G,X,Me),G[X+Me]=G[X],Me++,U[Z]=Me,Z++,x(G,X,p,C,Me),C+=Me,X=X+Me+3&-4}Z+1==1<<W&&W++}Se=ue}},w.decode._copyData=function(m,y,p,C,z){for(var A=0;A<z;A+=4)p[C+A]=m[y+A],p[C+A+1]=m[y+A+1],p[C+A+2]=m[y+A+2],p[C+A+3]=m[y+A+3]},w.tags={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",266:"FillOrder",269:"DocumentName",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffset",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",296:"ResolutionUnit",297:"PageNumber",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",320:"ColorMap",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffset",325:"TileByteCounts",330:"SubIFDs",336:"DotRange",338:"ExtraSample",339:"SampleFormat",347:"JPEGTables",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",700:"XMP",33421:"CFARepeatPatternDim",33422:"CFAPattern",33432:"Copyright",33434:"ExposureTime",33437:"FNumber",33723:"IPTC/NAA",34377:"Photoshop",34665:"ExifIFD",34675:"ICC Profile",34850:"ExposureProgram",34853:"GPSInfo",34855:"ISOSpeedRatings",34858:"TimeZoneOffset",34859:"SelfTimeMode",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37377:"ShutterSpeedValue",37378:"ApertureValue",37380:"ExposureBiasValue",37383:"MeteringMode",37385:"Flash",37386:"FocalLength",37390:"FocalPlaneXResolution",37391:"FocalPlaneYResolution",37392:"FocalPlaneResolutionUnit",37393:"ImageNumber",37398:"TIFF/EPStandardID",37399:"SensingMethod",37500:"MakerNote",37510:"UserComment",37724:"ImageSourceData",40092:"XPComment",40094:"XPKeywords",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelXDimension",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50733:"BayerGreenSplit",50738:"AntiAliasStrength",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50727:"AnalogBalance",50728:"AsShotNeutral",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50739:"ShadowScale",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50781:"RawDataUniqueID",50827:"OriginalRawFileName",50829:"ActiveArea",50830:"MaskedAreas",50931:"CameraCalibrationSignature",50932:"ProfileCalibrationSignature",50935:"NoiseReductionApplied",50936:"ProfileName",50937:"ProfileHueSatMapDims",50938:"ProfileHueSatMapData1",50939:"ProfileHueSatMapData2",50940:"ProfileToneCurve",50941:"ProfileEmbedPolicy",50942:"ProfileCopyright",50964:"ForwardMatrix1",50965:"ForwardMatrix2",50966:"PreviewApplicationName",50967:"PreviewApplicationVersion",50969:"PreviewSettingsDigest",50970:"PreviewColorSpace",50971:"PreviewDateTime",50972:"RawImageDigest",51008:"OpcodeList1",51009:"OpcodeList2",51022:"OpcodeList3",51041:"NoiseProfile",51089:"OriginalDefaultFinalSize",51090:"OriginalBestQualityFinalSize",51091:"OriginalDefaultCropSize",51125:"DefaultUserCrop"},w.ttypes={256:3,257:3,258:3,259:3,262:3,273:4,274:3,277:3,278:4,279:4,282:5,283:5,284:3,286:5,287:5,296:3,305:2,306:2,338:3,513:4,514:4,34665:4},w._readIFD=function(m,y,p,C){var z=m.readUshort(y,p);p+=2;var A={};C.push(A);for(var P=0;P<z;P++){var x=m.readUshort(y,p);p+=2;var O=m.readUshort(y,p);p+=2;var U=m.readUint(y,p);p+=4;var G=m.readUint(y,p);p+=4;var Z=[];if(A["t"+x]=Z,O==1||O==7)for(var X=0;X<U;X++)Z.push(y[(U<5?p-4:G)+X]);if(O==2&&Z.push(m.readASCII(y,U<5?p-4:G,U-1)),O==3)for(var X=0;X<U;X++)Z.push(m.readUshort(y,(U<3?p-4:G)+2*X));if(O==4)for(var X=0;X<U;X++)Z.push(m.readUint(y,(U<2?p-4:G)+4*X));if(O==5)for(var X=0;X<U;X++)Z.push(m.readUint(y,G+X*8)/m.readUint(y,G+X*8+4));if(O==8)for(var X=0;X<U;X++)Z.push(m.readShort(y,(U<3?p-4:G)+2*X));if(O==9)for(var X=0;X<U;X++)Z.push(m.readInt(y,(U<2?p-4:G)+4*X));if(O==10)for(var X=0;X<U;X++)Z.push(m.readInt(y,G+X*8)/m.readInt(y,G+X*8+4));if(O==11)for(var X=0;X<U;X++)Z.push(m.readFloat(y,G+X*4));if(O==12)for(var X=0;X<U;X++)Z.push(m.readDouble(y,G+X*8));if(U!=0&&Z.length==0&&D("unknown TIFF tag type: ",O,"num:",U),x==330)for(var X=0;X<U;X++)w._readIFD(m,y,Z[X],C)}return p},w._writeIFD=function(m,y,p,C){var z=Object.keys(C);m.writeUshort(y,p,z.length),p+=2;for(var A=p+z.length*12+4,P=0;P<z.length;P++){var x=z[P],O=parseInt(x.slice(1)),U=w.ttypes[O];if(U==null)throw new Error("unknown type of tag: "+O);var G=C[x];U==2&&(G=G[0]+"\0");var Z=G.length;m.writeUshort(y,p,O),p+=2,m.writeUshort(y,p,U),p+=2,m.writeUint(y,p,Z),p+=4;var X=[-1,1,1,2,4,8,0,0,0,0,0,0,8][U]*Z,W=p;if(X>4&&(m.writeUint(y,p,A),W=A),U==2&&m.writeASCII(y,W,G),U==3)for(var J=0;J<Z;J++)m.writeUshort(y,W+2*J,G[J]);if(U==4)for(var J=0;J<Z;J++)m.writeUint(y,W+4*J,G[J]);if(U==5)for(var J=0;J<Z;J++)m.writeUint(y,W+8*J,Math.round(G[J]*1e4)),m.writeUint(y,W+8*J+4,1e4);if(U==12)for(var J=0;J<Z;J++)m.writeDouble(y,W+8*J,G[J]);X>4&&(X+=X&1,A+=X),p+=4}return[p,A]},w.toRGBA8=function(m){var y=m.width,p=m.height,C=y*p,z=C*4,A=m.data,P=new Uint8Array(C*4),x=m.t262[0],O=m.t258?Math.min(32,m.t258[0]):1,U=m.isLE?1:0;if(x==0)for(var G=Math.ceil(O*y/8),Z=0;Z<p;Z++){var X=Z*G,W=Z*y;if(O==1)for(var J=0;J<y;J++){var re=W+J<<2,te=A[X+(J>>3)]>>7-(J&7)&1;P[re]=P[re+1]=P[re+2]=(1-te)*255,P[re+3]=255}if(O==4)for(var J=0;J<y;J++){var re=W+J<<2,te=A[X+(J>>1)]>>4-4*(J&1)&15;P[re]=P[re+1]=P[re+2]=(15-te)*17,P[re+3]=255}if(O==8)for(var J=0;J<y;J++){var re=W+J<<2,te=A[X+J];P[re]=P[re+1]=P[re+2]=255-te,P[re+3]=255}}else if(x==1)for(var G=Math.ceil(O*y/8),Z=0;Z<p;Z++){var X=Z*G,W=Z*y;if(O==1)for(var J=0;J<y;J++){var re=W+J<<2,te=A[X+(J>>3)]>>7-(J&7)&1;P[re]=P[re+1]=P[re+2]=te*255,P[re+3]=255}if(O==2)for(var J=0;J<y;J++){var re=W+J<<2,te=A[X+(J>>2)]>>6-2*(J&3)&3;P[re]=P[re+1]=P[re+2]=te*85,P[re+3]=255}if(O==8)for(var J=0;J<y;J++){var re=W+J<<2,te=A[X+J];P[re]=P[re+1]=P[re+2]=te,P[re+3]=255}if(O==16)for(var J=0;J<y;J++){var re=W+J<<2,te=A[X+(2*J+U)];P[re]=P[re+1]=P[re+2]=Math.min(255,te),P[re+3]=255}}else if(x==2)if(O==8)if(m.t338)if(m.t338[0]>0)for(var J=0;J<z;J++)P[J]=A[J];else for(var J=0;J<z;J+=4)P[J]=A[J],P[J+1]=A[J+1],P[J+2]=A[J+2],P[J+3]=255;else{var ye=m.t258?m.t258.length:3;if(ye==4)for(var J=0;J<z;J++)P[J]=A[J];if(ye==3)for(var J=0;J<C;J++){var re=J<<2,ue=J*3;P[re]=A[ue],P[re+1]=A[ue+1],P[re+2]=A[ue+2],P[re+3]=255}}else for(var J=0;J<C;J++){var re=J<<2,ue=J*6;P[re]=A[ue],P[re+1]=A[ue+2],P[re+2]=A[ue+4],P[re+3]=255}else if(x==3)for(var Se=m.t320,J=0;J<C;J++){var re=J<<2,Le=A[J];P[re]=Se[Le]>>8,P[re+1]=Se[256+Le]>>8,P[re+2]=Se[512+Le]>>8,P[re+3]=255}else if(x==5)for(var ye=m.t258?m.t258.length:4,Pe=ye>4?1:0,J=0;J<C;J++){var re=J<<2,Ee=J*ye,Me=255-A[Ee],He=255-A[Ee+1],nt=255-A[Ee+2],ht=(255-A[Ee+3])*(1/255);P[re]=~~(Me*ht+.5),P[re+1]=~~(He*ht+.5),P[re+2]=~~(nt*ht+.5),P[re+3]=255*(1-Pe)+A[Ee+4]*Pe}else D("Unknown Photometric interpretation: "+x);return P},w.replaceIMG=function(){for(var m=document.getElementsByTagName("img"),y=0;y<m.length;y++){var p=m[y],C=p.getAttribute("src");if(C!=null){var z=C.split(".").pop().toLowerCase();if(!(z!="tif"&&z!="tiff")){var A=new XMLHttpRequest;w._xhrs.push(A),w._imgs.push(p),A.open("GET",C),A.responseType="arraybuffer",A.onload=w._imgLoaded,A.send()}}}},w._xhrs=[],w._imgs=[],w._imgLoaded=function(m){var y=m.target.response,p=w.decode(y),C=p[0];w.decodeImages(y,p);var z=w.toRGBA8(C),A=C.width,P=C.height,x=w._xhrs.indexOf(m.target),O=w._imgs[x];w._xhrs.splice(x,1),w._imgs.splice(x,1);var U=document.createElement("canvas");U.width=A,U.height=P;for(var G=U.getContext("2d"),Z=G.createImageData(A,P),X=0;X<z.length;X++)Z.data[X]=z[X];G.putImageData(Z,0,0);for(var W=["style","class","id"],X=0;X<W.length;X++)U.setAttribute(W[X],O.getAttribute(W[X]));O.parentNode.replaceChild(U,O)},w._binBE={nextZero:function(m,y){for(;m[y]!=0;)y++;return y},readUshort:function(m,y){return m[y]<<8|m[y+1]},readShort:function(m,y){var p=w._binBE.ui8;return p[0]=m[y+1],p[1]=m[y+0],w._binBE.i16[0]},readInt:function(m,y){var p=w._binBE.ui8;return p[0]=m[y+3],p[1]=m[y+2],p[2]=m[y+1],p[3]=m[y+0],w._binBE.i32[0]},readUint:function(m,y){var p=w._binBE.ui8;return p[0]=m[y+3],p[1]=m[y+2],p[2]=m[y+1],p[3]=m[y+0],w._binBE.ui32[0]},readASCII:function(m,y,p){for(var C="",z=0;z<p;z++)C+=String.fromCharCode(m[y+z]);return C},readFloat:function(m,y){for(var p=w._binBE.ui8,C=0;C<4;C++)p[C]=m[y+3-C];return w._binBE.fl32[0]},readDouble:function(m,y){for(var p=w._binBE.ui8,C=0;C<8;C++)p[C]=m[y+7-C];return w._binBE.fl64[0]},writeUshort:function(m,y,p){m[y]=p>>8&255,m[y+1]=p&255},writeUint:function(m,y,p){m[y]=p>>24&255,m[y+1]=p>>16&255,m[y+2]=p>>8&255,m[y+3]=p>>0&255},writeASCII:function(m,y,p){for(var C=0;C<p.length;C++)m[y+C]=p.charCodeAt(C)},writeDouble:function(m,y,p){w._binBE.fl64[0]=p;for(var C=0;C<8;C++)m[y+C]=w._binBE.ui8[7-C]}},w._binBE.ui8=new Uint8Array(8),w._binBE.i16=new Int16Array(w._binBE.ui8.buffer),w._binBE.i32=new Int32Array(w._binBE.ui8.buffer),w._binBE.ui32=new Uint32Array(w._binBE.ui8.buffer),w._binBE.fl32=new Float32Array(w._binBE.ui8.buffer),w._binBE.fl64=new Float64Array(w._binBE.ui8.buffer),w._binLE={nextZero:w._binBE.nextZero,readUshort:function(m,y){return m[y+1]<<8|m[y]},readShort:function(m,y){var p=w._binBE.ui8;return p[0]=m[y+0],p[1]=m[y+1],w._binBE.i16[0]},readInt:function(m,y){var p=w._binBE.ui8;return p[0]=m[y+0],p[1]=m[y+1],p[2]=m[y+2],p[3]=m[y+3],w._binBE.i32[0]},readUint:function(m,y){var p=w._binBE.ui8;return p[0]=m[y+0],p[1]=m[y+1],p[2]=m[y+2],p[3]=m[y+3],w._binBE.ui32[0]},readASCII:w._binBE.readASCII,readFloat:function(m,y){for(var p=w._binBE.ui8,C=0;C<4;C++)p[C]=m[y+C];return w._binBE.fl32[0]},readDouble:function(m,y){for(var p=w._binBE.ui8,C=0;C<8;C++)p[C]=m[y+C];return w._binBE.fl64[0]}},w._copyTile=function(m,y,p,C,z,A,P,x){for(var O=Math.min(y,z-P),U=Math.min(p,A-x),G=0;G<U;G++)for(var Z=(x+G)*z+P,X=G*y,W=0;W<O;W++)C[Z+W]=m[X+W]}})(t,S)})()}).call(this,_("_process"))},{_process:133,pako:86}],183:[function(_,k,b){(function(T){k.exports=t;function t(D,w){if(S("noDeprecation"))return D;var E=!1;function m(){if(!E){if(S("throwDeprecation"))throw new Error(w);S("traceDeprecation")?console.trace(w):console.warn(w),E=!0}return D.apply(this,arguments)}return m}function S(D){try{if(!T.localStorage)return!1}catch{return!1}var w=T.localStorage[D];return w==null?!1:String(w).toLowerCase()==="true"}}).call(this,typeof Hr<"u"?Hr:typeof self<"u"?self:typeof v<"u"?v:{})},{}],184:[function(_,k,b){arguments[4][26][0].apply(b,arguments)},{dup:26}],185:[function(_,k,b){arguments[4][27][0].apply(b,arguments)},{dup:27}],186:[function(_,k,b){arguments[4][28][0].apply(b,arguments)},{"./support/isBuffer":185,_process:133,dup:28,inherits:184}],187:[function(_,k,b){var T=_("global/window"),t=_("is-function"),S=_("parse-headers"),D=_("xtend");k.exports=y,k.exports.default=y,y.XMLHttpRequest=T.XMLHttpRequest||z,y.XDomainRequest="withCredentials"in new y.XMLHttpRequest?y.XMLHttpRequest:T.XDomainRequest,w(["get","put","post","patch","head","delete"],function(A){y[A==="delete"?"del":A]=function(P,x,O){return x=m(P,x,O),x.method=A.toUpperCase(),p(x)}});function w(A,P){for(var x=0;x<A.length;x++)P(A[x])}function E(A){for(var P in A)if(A.hasOwnProperty(P))return!1;return!0}function m(A,P,x){var O=A;return t(P)?(x=P,typeof A=="string"&&(O={uri:A})):O=D(P,{uri:A}),O.callback=x,O}function y(A,P,x){return P=m(A,P,x),p(P)}function p(A){if(typeof A.callback>"u")throw new Error("callback argument missing");var P=!1,x=function(He,nt,ht){P||(P=!0,A.callback(He,nt,ht))};function O(){X.readyState===4&&setTimeout(Z,0)}function U(){var Me=void 0;if(X.response?Me=X.response:Me=X.responseText||C(X),Le)try{Me=JSON.parse(Me)}catch{}return Me}function G(Me){return clearTimeout(Pe),Me instanceof Error||(Me=new Error(""+(Me||"Unknown XMLHttpRequest Error"))),Me.statusCode=0,x(Me,Ee)}function Z(){if(!J){var Me;clearTimeout(Pe),A.useXDR&&X.status===void 0?Me=200:Me=X.status===1223?204:X.status;var He=Ee,nt=null;return Me!==0?(He={body:U(),statusCode:Me,method:te,headers:{},url:re,rawRequest:X},X.getAllResponseHeaders&&(He.headers=S(X.getAllResponseHeaders()))):nt=new Error("Internal XMLHttpRequest Error"),x(nt,He,He.body)}}var X=A.xhr||null;X||(A.cors||A.useXDR?X=new y.XDomainRequest:X=new y.XMLHttpRequest);var W,J,re=X.url=A.uri||A.url,te=X.method=A.method||"GET",ye=A.body||A.data,ue=X.headers=A.headers||{},Se=!!A.sync,Le=!1,Pe,Ee={body:void 0,headers:{},statusCode:0,method:te,url:re,rawRequest:X};if("json"in A&&A.json!==!1&&(Le=!0,ue.accept||ue.Accept||(ue.Accept="application/json"),te!=="GET"&&te!=="HEAD"&&(ue["content-type"]||ue["Content-Type"]||(ue["Content-Type"]="application/json"),ye=JSON.stringify(A.json===!0?ye:A.json))),X.onreadystatechange=O,X.onload=Z,X.onerror=G,X.onprogress=function(){},X.onabort=function(){J=!0},X.ontimeout=G,X.open(te,re,!Se,A.username,A.password),Se||(X.withCredentials=!!A.withCredentials),!Se&&A.timeout>0&&(Pe=setTimeout(function(){if(!J){J=!0,X.abort("timeout");var Me=new Error("XMLHttpRequest timeout");Me.code="ETIMEDOUT",G(Me)}},A.timeout)),X.setRequestHeader)for(W in ue)ue.hasOwnProperty(W)&&X.setRequestHeader(W,ue[W]);else if(A.headers&&!E(A.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in A&&(X.responseType=A.responseType),"beforeSend"in A&&typeof A.beforeSend=="function"&&A.beforeSend(X),X.send(ye||null),X}function C(A){try{if(A.responseType==="document")return A.responseXML;var P=A.responseXML&&A.responseXML.documentElement.nodeName==="parsererror";if(A.responseType===""&&!P)return A.responseXML}catch{}return null}function z(){}},{"global/window":71,"is-function":78,"parse-headers":106,xtend:189}],188:[function(_,k,b){k.exports=function(){return typeof self.DOMParser<"u"?function(t){var S=new self.DOMParser;return S.parseFromString(t,"application/xml")}:typeof self.ActiveXObject<"u"&&new self.ActiveXObject("Microsoft.XMLDOM")?function(t){var S=new self.ActiveXObject("Microsoft.XMLDOM");return S.async="false",S.loadXML(t),S}:function(t){var S=document.createElement("div");return S.innerHTML=t,S}}()},{}],189:[function(_,k,b){k.exports=t;var T=Object.prototype.hasOwnProperty;function t(){for(var S={},D=0;D<arguments.length;D++){var w=arguments[D];for(var E in w)T.call(w,E)&&(S[E]=w[E])}return S}},{}],190:[function(_,k,b){Object.defineProperty(b,"__esModule",{value:!0}),b.srcOver=T,b.dstOver=t,b.multiply=S,b.add=D,b.screen=w,b.overlay=E,b.darken=m,b.lighten=y,b.hardLight=p,b.difference=C,b.exclusion=z;function T(A,P){var x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;A.a*=x;var O=P.a+A.a-P.a*A.a,U=(A.r*A.a+P.r*P.a*(1-A.a))/O,G=(A.g*A.a+P.g*P.a*(1-A.a))/O,Z=(A.b*A.a+P.b*P.a*(1-A.a))/O;return{r:U,g:G,b:Z,a:O}}function t(A,P){var x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;A.a*=x;var O=P.a+A.a-P.a*A.a,U=(P.r*P.a+A.r*A.a*(1-P.a))/O,G=(P.g*P.a+A.g*A.a*(1-P.a))/O,Z=(P.b*P.a+A.b*A.a*(1-P.a))/O;return{r:U,g:G,b:Z,a:O}}function S(A,P){var x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;A.a*=x;var O=P.a+A.a-P.a*A.a,U=A.r*A.a,G=A.g*A.a,Z=A.b*A.a,X=P.r*P.a,W=P.g*P.a,J=P.b*P.a,re=(U*X+U*(1-P.a)+X*(1-A.a))/O,te=(G*W+G*(1-P.a)+W*(1-A.a))/O,ye=(Z*J+Z*(1-P.a)+J*(1-A.a))/O;return{r:re,g:te,b:ye,a:O}}function D(A,P){var x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;A.a*=x;var O=P.a+A.a-P.a*A.a,U=A.r*A.a,G=A.g*A.a,Z=A.b*A.a,X=P.r*P.a,W=P.g*P.a,J=P.b*P.a,re=(U+X)/O,te=(G+W)/O,ye=(Z+J)/O;return{r:re,g:te,b:ye,a:O}}function w(A,P){var x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;A.a*=x;var O=P.a+A.a-P.a*A.a,U=A.r*A.a,G=A.g*A.a,Z=A.b*A.a,X=P.r*P.a,W=P.g*P.a,J=P.b*P.a,re=(U*P.a+X*A.a-U*X+U*(1-P.a)+X*(1-A.a))/O,te=(G*P.a+W*A.a-G*W+G*(1-P.a)+W*(1-A.a))/O,ye=(Z*P.a+J*A.a-Z*J+Z*(1-P.a)+J*(1-A.a))/O;return{r:re,g:te,b:ye,a:O}}function E(A,P){var x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;A.a*=x;var O=P.a+A.a-P.a*A.a,U=A.r*A.a,G=A.g*A.a,Z=A.b*A.a,X=P.r*P.a,W=P.g*P.a,J=P.b*P.a,re=(2*X<=P.a?2*U*X+U*(1-P.a)+X*(1-A.a):U*(1+P.a)+X*(1+A.a)-2*X*U-P.a*A.a)/O,te=(2*W<=P.a?2*G*W+G*(1-P.a)+W*(1-A.a):G*(1+P.a)+W*(1+A.a)-2*W*G-P.a*A.a)/O,ye=(2*J<=P.a?2*Z*J+Z*(1-P.a)+J*(1-A.a):Z*(1+P.a)+J*(1+A.a)-2*J*Z-P.a*A.a)/O;return{r:re,g:te,b:ye,a:O}}function m(A,P){var x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;A.a*=x;var O=P.a+A.a-P.a*A.a,U=A.r*A.a,G=A.g*A.a,Z=A.b*A.a,X=P.r*P.a,W=P.g*P.a,J=P.b*P.a,re=(Math.min(U*P.a,X*A.a)+U*(1-P.a)+X*(1-A.a))/O,te=(Math.min(G*P.a,W*A.a)+G*(1-P.a)+W*(1-A.a))/O,ye=(Math.min(Z*P.a,J*A.a)+Z*(1-P.a)+J*(1-A.a))/O;return{r:re,g:te,b:ye,a:O}}function y(A,P){var x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;A.a*=x;var O=P.a+A.a-P.a*A.a,U=A.r*A.a,G=A.g*A.a,Z=A.b*A.a,X=P.r*P.a,W=P.g*P.a,J=P.b*P.a,re=(Math.max(U*P.a,X*A.a)+U*(1-P.a)+X*(1-A.a))/O,te=(Math.max(G*P.a,W*A.a)+G*(1-P.a)+W*(1-A.a))/O,ye=(Math.max(Z*P.a,J*A.a)+Z*(1-P.a)+J*(1-A.a))/O;return{r:re,g:te,b:ye,a:O}}function p(A,P){var x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;A.a*=x;var O=P.a+A.a-P.a*A.a,U=A.r*A.a,G=A.g*A.a,Z=A.b*A.a,X=P.r*P.a,W=P.g*P.a,J=P.b*P.a,re=(2*U<=A.a?2*U*X+U*(1-P.a)+X*(1-A.a):U*(1+P.a)+X*(1+A.a)-2*X*U-P.a*A.a)/O,te=(2*G<=A.a?2*G*W+G*(1-P.a)+W*(1-A.a):G*(1+P.a)+W*(1+A.a)-2*W*G-P.a*A.a)/O,ye=(2*Z<=A.a?2*Z*J+Z*(1-P.a)+J*(1-A.a):Z*(1+P.a)+J*(1+A.a)-2*J*Z-P.a*A.a)/O;return{r:re,g:te,b:ye,a:O}}function C(A,P){var x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;A.a*=x;var O=P.a+A.a-P.a*A.a,U=A.r*A.a,G=A.g*A.a,Z=A.b*A.a,X=P.r*P.a,W=P.g*P.a,J=P.b*P.a,re=(U+X-2*Math.min(U*P.a,X*A.a))/O,te=(G+W-2*Math.min(G*P.a,W*A.a))/O,ye=(Z+J-2*Math.min(Z*P.a,J*A.a))/O;return{r:re,g:te,b:ye,a:O}}function z(A,P){var x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;A.a*=x;var O=P.a+A.a-P.a*A.a,U=A.r*A.a,G=A.g*A.a,Z=A.b*A.a,X=P.r*P.a,W=P.g*P.a,J=P.b*P.a,re=(U*P.a+X*A.a-2*U*X+U*(1-P.a)+X*(1-A.a))/O,te=(G*P.a+W*A.a-2*G*W+G*(1-P.a)+W*(1-A.a))/O,ye=(Z*P.a+J*A.a-2*Z*J+Z*(1-P.a)+J*(1-A.a))/O;return{r:re,g:te,b:ye,a:O}}},{}],191:[function(_,k,b){var T=_("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(b,"__esModule",{value:!0}),b.default=w;var t=_("@jimp/utils"),S=T(_("../constants")),D=T(_("./composite-modes"));function w(E,m,y){var p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},C=arguments.length>4?arguments[4]:void 0;if(typeof p=="function"&&(C=p,p={}),!(E instanceof this.constructor))return t.throwError.call(this,"The source must be a Jimp image",C);if(typeof m!="number"||typeof y!="number")return t.throwError.call(this,"x and y must be numbers",C);var z=p,A=z.mode,P=z.opacitySource,x=z.opacityDest;A||(A=S.BLEND_SOURCE_OVER),(typeof P!="number"||P<0||P>1)&&(P=1),(typeof x!="number"||x<0||x>1)&&(x=1);var O=D[A];m=Math.round(m),y=Math.round(y);var U=this;return x!==1&&U.opacity(x),E.scanQuiet(0,0,E.bitmap.width,E.bitmap.height,function(G,Z,X){var W=U.getPixelIndex(m+G,y+Z,S.EDGE_CROP),J=O({r:this.bitmap.data[X+0]/255,g:this.bitmap.data[X+1]/255,b:this.bitmap.data[X+2]/255,a:this.bitmap.data[X+3]/255},{r:U.bitmap.data[W+0]/255,g:U.bitmap.data[W+1]/255,b:U.bitmap.data[W+2]/255,a:U.bitmap.data[W+3]/255},P);U.bitmap.data[W+0]=this.constructor.limit255(J.r*255),U.bitmap.data[W+1]=this.constructor.limit255(J.g*255),U.bitmap.data[W+2]=this.constructor.limit255(J.b*255),U.bitmap.data[W+3]=this.constructor.limit255(J.a*255)}),(0,t.isNodePattern)(C)&&C.call(this,null,this),this}k.exports=b.default},{"../constants":192,"./composite-modes":190,"@babel/runtime/helpers/interopRequireWildcard":12,"@jimp/utils":235}],192:[function(_,k,b){Object.defineProperty(b,"__esModule",{value:!0}),b.EDGE_CROP=b.EDGE_WRAP=b.EDGE_EXTEND=b.BLEND_EXCLUSION=b.BLEND_DIFFERENCE=b.BLEND_HARDLIGHT=b.BLEND_LIGHTEN=b.BLEND_DARKEN=b.BLEND_OVERLAY=b.BLEND_SCREEN=b.BLEND_ADD=b.BLEND_MULTIPLY=b.BLEND_DESTINATION_OVER=b.BLEND_SOURCE_OVER=b.VERTICAL_ALIGN_BOTTOM=b.VERTICAL_ALIGN_MIDDLE=b.VERTICAL_ALIGN_TOP=b.HORIZONTAL_ALIGN_RIGHT=b.HORIZONTAL_ALIGN_CENTER=b.HORIZONTAL_ALIGN_LEFT=b.AUTO=void 0;var T=-1;b.AUTO=T;var t=1;b.HORIZONTAL_ALIGN_LEFT=t;var S=2;b.HORIZONTAL_ALIGN_CENTER=S;var D=4;b.HORIZONTAL_ALIGN_RIGHT=D;var w=8;b.VERTICAL_ALIGN_TOP=w;var E=16;b.VERTICAL_ALIGN_MIDDLE=E;var m=32;b.VERTICAL_ALIGN_BOTTOM=m;var y="srcOver";b.BLEND_SOURCE_OVER=y;var p="dstOver";b.BLEND_DESTINATION_OVER=p;var C="multiply";b.BLEND_MULTIPLY=C;var z="add";b.BLEND_ADD=z;var A="screen";b.BLEND_SCREEN=A;var P="overlay";b.BLEND_OVERLAY=P;var x="darken";b.BLEND_DARKEN=x;var O="lighten";b.BLEND_LIGHTEN=O;var U="hardLight";b.BLEND_HARDLIGHT=U;var G="difference";b.BLEND_DIFFERENCE=G;var Z="exclusion";b.BLEND_EXCLUSION=Z;var X=1;b.EDGE_EXTEND=X;var W=2;b.EDGE_WRAP=W;var J=3;b.EDGE_CROP=J},{}],193:[function(_,k,b){(function(T){var t=_("@babel/runtime/helpers/interopRequireWildcard"),S=_("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(b,"__esModule",{value:!0}),b.addConstants=ke,b.addJimpMethods=qe,b.jimpEvMethod=tt,b.jimpEvChange=Ge,Object.defineProperty(b,"addType",{enumerable:!0,get:function(){return Se.addType}}),b.default=void 0;for(var D=S(_("@babel/runtime/helpers/construct")),w=S(_("@babel/runtime/helpers/slicedToArray")),E=S(_("@babel/runtime/helpers/classCallCheck")),m=S(_("@babel/runtime/helpers/createClass")),y=S(_("@babel/runtime/helpers/possibleConstructorReturn")),p=S(_("@babel/runtime/helpers/getPrototypeOf")),C=S(_("@babel/runtime/helpers/assertThisInitialized")),z=S(_("@babel/runtime/helpers/inherits")),A=S(_("@babel/runtime/helpers/defineProperty")),P=S(_("@babel/runtime/helpers/typeof")),x=S(_("fs")),O=S(_("path")),U=S(_("events")),G=_("@jimp/utils"),Z=S(_("any-base")),X=S(_("mkdirp")),W=S(_("pixelmatch")),J=S(_("tinycolor2")),re=S(_("./modules/phash")),te=S(_("./request")),ye=S(_("./composite")),ue=S(_("./utils/promisify")),Se=t(_("./utils/mime")),Le=_("./utils/image-bitmap"),Pe=t(_("./constants")),Ee="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_",Me=[NaN,NaN],He=2;He<65;He++){var nt=(0,Z.default)(Z.default.BIN,Ee.slice(0,He))(new Array(65).join("1"));Me.push(nt.length)}function ht(){}function Fe(it){return Object.prototype.toString.call(it).toLowerCase().indexOf("arraybuffer")>-1}function Ce(it){for(var ze=T.alloc(it.byteLength),de=new Uint8Array(it),ve=0;ve<ze.length;++ve)ze[ve]=de[ve];return ze}function Be(it,ze){(0,te.default)(it,function(de,ve,be){if(de)return ze(de);if("headers"in ve&&"location"in ve.headers)return it.url=ve.headers.location,Be(it,ze);if((0,P.default)(be)==="object"&&T.isBuffer(be))return ze(null,be);var Oe="Could not load Buffer from <"+it.url+"> (HTTP: "+ve.statusCode+")";return new Error(Oe)})}function Ae(it,ze){x.default&&typeof x.default.readFile=="function"&&!it.match(/^(http|ftp)s?:\/\/./)?x.default.readFile(it,ze):Be({url:it},ze)}function se(it){return it&&(0,P.default)(it)==="object"&&typeof it.width=="number"&&typeof it.height=="number"&&(T.isBuffer(it.data)||it.data instanceof Uint8Array||typeof Uint8ClampedArray=="function"&&it.data instanceof Uint8ClampedArray)&&(it.data.length===it.width*it.height*4||it.data.length===it.width*it.height*3)}function pe(it){if(it.length%3!==0)throw new Error("Buffer length is incorrect");for(var ze=T.allocUnsafe(it.length/3*4),de=0,ve=0;ve<it.length;ve++)ze[de]=it[ve],(ve+1)%3===0&&(ze[++de]=255),de++;return ze}var Ke={data:null,width:null,height:null},_e=function(it){(0,z.default)(ze,it);function ze(){for(var de,ve=arguments.length,be=new Array(ve),Oe=0;Oe<ve;Oe++)be[Oe]=arguments[Oe];(0,E.default)(this,ze),de=(0,y.default)(this,(0,p.default)(ze).call(this)),(0,A.default)((0,C.default)(de),"bitmap",Ke),(0,A.default)((0,C.default)(de),"_background",0),(0,A.default)((0,C.default)(de),"_originalMime",ze.MIME_PNG),(0,A.default)((0,C.default)(de),"_exif",null),(0,A.default)((0,C.default)(de),"_rgba",!0),(0,A.default)((0,C.default)(de),"writeAsync",function(Ir){return(0,ue.default)(de.write,(0,C.default)(de),Ir)}),(0,A.default)((0,C.default)(de),"getBase64Async",function(Ir){return(0,ue.default)(de.getBase64,(0,C.default)(de),Ir)}),(0,A.default)((0,C.default)(de),"getBuffer",Le.getBuffer),(0,A.default)((0,C.default)(de),"getBufferAsync",Le.getBufferAsync),(0,A.default)((0,C.default)(de),"getPixelColour",de.getPixelColor),(0,A.default)((0,C.default)(de),"setPixelColour",de.setPixelColor);var ge=(0,C.default)(de),le=ht;Fe(be[0])&&(be[0]=Ce(be[0]));function et(){for(var Ir=arguments.length,De=new Array(Ir),St=0;St<Ir;St++)De[St]=arguments[St];var Ut=De[0],ir=Ut||{};ir.methodName="constructor",setTimeout(function(){var Rt;Ut&&le===ht?ge.emitError("constructor",Ut):Ut||ge.emitMulti("constructor","initialized"),(Rt=le).call.apply(Rt,[ge].concat(De))},1)}if(typeof be[0]=="number"&&typeof be[1]=="number"||parseInt(be[0],10)&&parseInt(be[1],10)){var wt=parseInt(be[0],10),Ft=parseInt(be[1],10);if(le=be[2],typeof be[2]=="number"&&(de._background=be[2],le=be[3]),typeof be[2]=="string"&&(de._background=ze.cssColorToHex(be[2]),le=be[3]),typeof le>"u"&&(le=ht),typeof le!="function")return(0,y.default)(de,G.throwError.call((0,C.default)(de),"cb must be a function",et));de.bitmap={data:T.alloc(wt*Ft*4),width:wt,height:Ft};for(var Wt=0;Wt<de.bitmap.data.length;Wt+=4)de.bitmap.data.writeUInt32BE(de._background,Wt);et(null,(0,C.default)(de))}else if((0,P.default)(be[0])==="object"&&be[0].url){if(le=be[1]||ht,typeof le!="function")return(0,y.default)(de,G.throwError.call((0,C.default)(de),"cb must be a function",et));Be(be[0],function(Ir,De){if(Ir)return G.throwError.call((0,C.default)(de),Ir,et);de.parseBitmap(De,be[0].url,et)})}else if(be[0]instanceof ze){var or=be[0];if(le=be[1],typeof le>"u"&&(le=ht),typeof le!="function")return(0,y.default)(de,G.throwError.call((0,C.default)(de),"cb must be a function",et));de.bitmap={data:T.from(or.bitmap.data),width:or.bitmap.width,height:or.bitmap.height},de._quality=or._quality,de._deflateLevel=or._deflateLevel,de._deflateStrategy=or._deflateStrategy,de._filterType=or._filterType,de._rgba=or._rgba,de._background=or._background,de._originalMime=or._originalMime,et(null,(0,C.default)(de))}else if(se(be[0])){var Or=be[0];le=be[1]||ht;var xr=Or.width*Or.height*4===Or.data.length,Tr=xr?T.from(Or.data):pe(Or.data);de.bitmap={data:Tr,width:Or.width,height:Or.height},et(null,(0,C.default)(de))}else if(typeof be[0]=="string"){var br=be[0];if(le=be[1],typeof le>"u"&&(le=ht),typeof le!="function")return(0,y.default)(de,G.throwError.call((0,C.default)(de),"cb must be a function",et));Ae(br,function(Ir,De){if(Ir)return G.throwError.call((0,C.default)(de),Ir,et);de.parseBitmap(De,br,et)})}else if((0,P.default)(be[0])==="object"&&T.isBuffer(be[0])){var fr=be[0];if(le=be[1],typeof le!="function")return(0,y.default)(de,G.throwError.call((0,C.default)(de),"cb must be a function",et));de.parseBitmap(fr,null,et)}else{le=be[be.length-1],typeof le!="function"&&(le=be[be.length-2],typeof le!="function"&&(le=ht));var Vr=ze.__extraConstructors.find(function(Ir){return Ir.test.apply(Ir,be)});if(Vr)new Promise(function(Ir,De){var St;return(St=Vr.run).call.apply(St,[(0,C.default)(de),Ir,De].concat(be))}).then(function(){return et(null,(0,C.default)(de))}).catch(et);else return(0,y.default)(de,G.throwError.call((0,C.default)(de),"No matching constructor overloading was found. Please see the docs for how to call the Jimp constructor.",et))}return de}return(0,m.default)(ze,[{key:"parseBitmap",value:function(ve,be,Oe){Le.parseBitmap.call(this,ve,null,Oe)}},{key:"rgba",value:function(ve,be){return typeof ve!="boolean"?G.throwError.call(this,"bool must be a boolean, true for RGBA or false for RGB",be):(this._rgba=ve,(0,G.isNodePattern)(be)&&be.call(this,null,this),this)}},{key:"emitMulti",value:function(ve,be){var Oe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Oe=Object.assign(Oe,{methodName:ve,eventName:be}),this.emit("any",Oe),ve&&this.emit(ve,Oe),this.emit(be,Oe)}},{key:"emitError",value:function(ve,be){this.emitMulti(ve,"error",be)}},{key:"getHeight",value:function(){return this.bitmap.height}},{key:"getWidth",value:function(){return this.bitmap.width}},{key:"inspect",value:function(){return"<Jimp "+(this.bitmap===Ke?"pending...":this.bitmap.width+"x"+this.bitmap.height)+">"}},{key:"toString",value:function(){return"[object Jimp]"}},{key:"getMIME",value:function(){var ve=this._originalMime||ze.MIME_PNG;return ve}},{key:"getExtension",value:function(){var ve=this.getMIME();return Se.getExtension(ve)}},{key:"write",value:function(ve,be){var Oe=this;if(!x.default||!x.default.createWriteStream)throw new Error("Cant access the filesystem. You can use the getBase64 method.");if(typeof ve!="string")return G.throwError.call(this,"path must be a string",be);if(typeof be>"u"&&(be=ht),typeof be!="function")return G.throwError.call(this,"cb must be a function",be);var ge=Se.getType(ve)||this.getMIME(),le=O.default.parse(ve);return le.dir&&X.default.sync(le.dir),this.getBuffer(ge,function(et,wt){if(et)return G.throwError.call(Oe,et,be);var Ft=x.default.createWriteStream(ve);Ft.on("open",function(){Ft.write(wt),Ft.end()}).on("error",function(Wt){return G.throwError.call(Oe,Wt,be)}),Ft.on("finish",function(){be.call(Oe,null,Oe)})}),this}},{key:"getBase64",value:function(ve,be){return ve===ze.AUTO&&(ve=this.getMIME()),typeof ve!="string"?G.throwError.call(this,"mime must be a string",be):typeof be!="function"?G.throwError.call(this,"cb must be a function",be):(this.getBuffer(ve,function(Oe,ge){if(Oe)return G.throwError.call(this,Oe,be);var le="data:"+ve+";base64,"+ge.toString("base64");be.call(this,null,le)}),this)}},{key:"hash",value:function(ve,be){if(ve=ve||64,typeof ve=="function"&&(be=ve,ve=64),typeof ve!="number")return G.throwError.call(this,"base must be a number",be);if(ve<2||ve>64)return G.throwError.call(this,"base must be a number between 2 and 64",be);var Oe=this.pHash();for(Oe=(0,Z.default)(Z.default.BIN,Ee.slice(0,ve))(Oe);Oe.length<Me[ve];)Oe="0"+Oe;return(0,G.isNodePattern)(be)&&be.call(this,null,Oe),Oe}},{key:"pHash",value:function(){var ve=new re.default;return ve.getHash(this)}},{key:"distanceFromHash",value:function(ve){var be=new re.default,Oe=be.getHash(this);return be.distance(Oe,ve)}},{key:"getPixelIndex",value:function(ve,be,Oe,ge){var le,et;if(typeof Oe=="function"&&typeof ge>"u"&&(ge=Oe,Oe=null),Oe||(Oe=ze.EDGE_EXTEND),typeof ve!="number"||typeof be!="number")return G.throwError.call(this,"x and y must be numbers",ge);ve=Math.round(ve),be=Math.round(be),le=ve,et=be,Oe===ze.EDGE_EXTEND&&(ve<0&&(le=0),ve>=this.bitmap.width&&(le=this.bitmap.width-1),be<0&&(et=0),be>=this.bitmap.height&&(et=this.bitmap.height-1)),Oe===ze.EDGE_WRAP&&(ve<0&&(le=this.bitmap.width+ve),ve>=this.bitmap.width&&(le=ve%this.bitmap.width),be<0&&(le=this.bitmap.height+be),be>=this.bitmap.height&&(et=be%this.bitmap.height));var wt=this.bitmap.width*et+le<<2;return(le<0||le>=this.bitmap.width)&&(wt=-1),(et<0||et>=this.bitmap.height)&&(wt=-1),(0,G.isNodePattern)(ge)&&ge.call(this,null,wt),wt}},{key:"getPixelColor",value:function(ve,be,Oe){if(typeof ve!="number"||typeof be!="number")return G.throwError.call(this,"x and y must be numbers",Oe);ve=Math.round(ve),be=Math.round(be);var ge=this.getPixelIndex(ve,be),le=this.bitmap.data.readUInt32BE(ge);return(0,G.isNodePattern)(Oe)&&Oe.call(this,null,le),le}},{key:"setPixelColor",value:function(ve,be,Oe,ge){if(typeof ve!="number"||typeof be!="number"||typeof Oe!="number")return G.throwError.call(this,"hex, x and y must be numbers",ge);be=Math.round(be),Oe=Math.round(Oe);var le=this.getPixelIndex(be,Oe);return this.bitmap.data.writeUInt32BE(ve,le),(0,G.isNodePattern)(ge)&&ge.call(this,null,this),this}},{key:"hasAlpha",value:function(){for(var ve=0;ve<this.bitmap.height;ve++)for(var be=0;be<this.bitmap.width;be++){var Oe=this.bitmap.width*ve+be<<2,ge=this.bitmap.data[Oe+3];if(ge!==255)return!0}return!1}},{key:"scanIterator",value:function(ve,be,Oe,ge){return typeof ve!="number"||typeof be!="number"?G.throwError.call(this,"x and y must be numbers"):typeof Oe!="number"||typeof ge!="number"?G.throwError.call(this,"w and h must be numbers"):(0,G.scanIterator)(this,ve,be,Oe,ge)}}]),ze}(U.default);function ke(it){var ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_e;Object.entries(it).forEach(function(de){var ve=(0,w.default)(de,2),be=ve[0],Oe=ve[1];ze[be]=Oe})}function qe(it){var ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_e;Object.entries(it).forEach(function(de){var ve=(0,w.default)(de,2),be=ve[0],Oe=ve[1];ze.prototype[be]=Oe})}ke(Pe),qe({composite:ye.default}),_e.__extraConstructors=[],_e.appendConstructorOption=function(it,ze,de){_e.__extraConstructors.push({name:it,test:ze,run:de})},_e.read=function(){for(var it=arguments.length,ze=new Array(it),de=0;de<it;de++)ze[de]=arguments[de];return new Promise(function(ve,be){(0,D.default)(_e,ze.concat([function(Oe,ge){Oe?be(Oe):ve(ge)}]))})},_e.create=_e.read,_e.rgbaToInt=function(it,ze,de,ve,be){if(typeof it!="number"||typeof ze!="number"||typeof de!="number"||typeof ve!="number")return G.throwError.call(this,"r, g, b and a must be numbers",be);if(it<0||it>255)return G.throwError.call(this,"r must be between 0 and 255",be);if((ze<0||ze>255)&&G.throwError.call(this,"g must be between 0 and 255",be),de<0||de>255)return G.throwError.call(this,"b must be between 0 and 255",be);if(ve<0||ve>255)return G.throwError.call(this,"a must be between 0 and 255",be);it=Math.round(it),de=Math.round(de),ze=Math.round(ze),ve=Math.round(ve);var Oe=it*Math.pow(256,3)+ze*Math.pow(256,2)+de*Math.pow(256,1)+ve*Math.pow(256,0);return(0,G.isNodePattern)(be)&&be.call(this,null,Oe),Oe},_e.intToRGBA=function(it,ze){if(typeof it!="number")return G.throwError.call(this,"i must be a number",ze);var de={};return de.r=Math.floor(it/Math.pow(256,3)),de.g=Math.floor((it-de.r*Math.pow(256,3))/Math.pow(256,2)),de.b=Math.floor((it-de.r*Math.pow(256,3)-de.g*Math.pow(256,2))/Math.pow(256,1)),de.a=Math.floor((it-de.r*Math.pow(256,3)-de.g*Math.pow(256,2)-de.b*Math.pow(256,1))/Math.pow(256,0)),(0,G.isNodePattern)(ze)&&ze.call(this,null,de),de},_e.cssColorToHex=function(it){return it=it||0,typeof it=="number"?Number(it):parseInt((0,J.default)(it).toHex8(),16)},_e.limit255=function(it){return it=Math.max(it,0),it=Math.min(it,255),it},_e.diff=function(it,ze){var de=arguments.length>2&&arguments[2]!==void 0?arguments[2]:.1;if(!(it instanceof _e)||!(ze instanceof _e))return G.throwError.call(this,"img1 and img2 must be an Jimp images");var ve=it.bitmap,be=ze.bitmap;if((ve.width!==be.width||ve.height!==be.height)&&(ve.width*ve.height>be.width*be.height?it=it.cloneQuiet().resize(be.width,be.height):ze=ze.cloneQuiet().resize(ve.width,ve.height)),typeof de!="number"||de<0||de>1)return G.throwError.call(this,"threshold must be a number between 0 and 1");var Oe=new _e(ve.width,ve.height,4294967295),ge=(0,W.default)(ve.data,be.data,Oe.bitmap.data,Oe.bitmap.width,Oe.bitmap.height,{threshold:de});return{percent:ge/(Oe.bitmap.width*Oe.bitmap.height),image:Oe}},_e.distance=function(it,ze){var de=new re.default,ve=de.getHash(it),be=de.getHash(ze);return de.distance(ve,be)},_e.compareHashes=function(it,ze){var de=new re.default;return de.distance(it,ze)},_e.colorDiff=function(it,ze){var de=function(ge){return Math.pow(ge,2)},ve=Math.max,be=255*255*3;return it.a!==0&&!it.a&&(it.a=255),ze.a!==0&&!ze.a&&(ze.a=255),(ve(de(it.r-ze.r),de(it.r-ze.r-it.a+ze.a))+ve(de(it.g-ze.g),de(it.g-ze.g-it.a+ze.a))+ve(de(it.b-ze.b),de(it.b-ze.b-it.a+ze.a)))/be};function tt(it,ze,de){var ve="before-"+ze,be=ze.replace(/e$/,"")+"ed";_e.prototype[it]=function(){for(var Oe,ge=arguments.length,le=new Array(ge),et=0;et<ge;et++)le[et]=arguments[et];var wt=le[de.length-1],Ft=this;typeof wt=="function"?(Oe=function(){for(var Or=arguments.length,xr=new Array(Or),Tr=0;Tr<Or;Tr++)xr[Tr]=arguments[Tr];var br=xr[0],fr=xr[1];br?Ft.emitError(it,br):Ft.emitMulti(it,be,(0,A.default)({},it,fr)),wt.apply(this,xr)},le[le.length-1]=Oe):Oe=!1,this.emitMulti(it,ve);var Wt;try{Wt=de.apply(this,le),Oe||this.emitMulti(it,be,(0,A.default)({},it,Wt))}catch(or){or.methodName=it,this.emitError(it,or)}return Wt},_e.prototype[it+"Quiet"]=de}tt("clone","clone",function(it){var ze=new _e(this);return(0,G.isNodePattern)(it)&&it.call(ze,null,ze),ze});function Ge(it,ze){tt(it,"change",ze)}Ge("background",function(it,ze){return typeof it!="number"?G.throwError.call(this,"hex must be a hexadecimal rgba value",ze):(this._background=it,(0,G.isNodePattern)(ze)&&ze.call(this,null,this),this)}),Ge("scan",function(it,ze,de,ve,be,Oe){if(typeof it!="number"||typeof ze!="number")return G.throwError.call(this,"x and y must be numbers",Oe);if(typeof de!="number"||typeof ve!="number")return G.throwError.call(this,"w and h must be numbers",Oe);if(typeof be!="function")return G.throwError.call(this,"f must be a function",Oe);var ge=(0,G.scan)(this,it,ze,de,ve,be);return(0,G.isNodePattern)(Oe)&&Oe.call(this,null,ge),ge});{var We;typeof v<"u"&&(typeof v>"u"?"undefined":(0,P.default)(v))==="object"&&(We=v),typeof self<"u"&&(typeof self>"u"?"undefined":(0,P.default)(self))==="object"&&(We=self),We.Jimp=_e,We.Buffer=T}var Je=_e;b.default=Je}).call(this,_("buffer").Buffer)},{"./composite":191,"./constants":192,"./modules/phash":194,"./request":195,"./utils/image-bitmap":196,"./utils/mime":197,"./utils/promisify":198,"@babel/runtime/helpers/assertThisInitialized":3,"@babel/runtime/helpers/classCallCheck":4,"@babel/runtime/helpers/construct":5,"@babel/runtime/helpers/createClass":6,"@babel/runtime/helpers/defineProperty":7,"@babel/runtime/helpers/getPrototypeOf":9,"@babel/runtime/helpers/inherits":10,"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/helpers/interopRequireWildcard":12,"@babel/runtime/helpers/possibleConstructorReturn":17,"@babel/runtime/helpers/slicedToArray":19,"@babel/runtime/helpers/typeof":21,"@jimp/utils":235,"any-base":23,buffer:48,events:52,fs:47,mkdirp:83,path:107,pixelmatch:109,tinycolor2:178}],194:[function(_,k,b){function T(E,m){this.size=this.size||E,this.smallerSize=this.smallerSize||m,D(this.size)}T.prototype.size=32,T.prototype.smallerSize=8,T.prototype.distance=function(E,m){for(var y=0,p=0;p<E.length;p++)E[p]!==m[p]&&y++;return y/E.length},T.prototype.getHash=function(E){E=E.clone().resize(this.size,this.size),E.grayscale();for(var m=[],y=0;y<E.bitmap.width;y++){m[y]=[];for(var p=0;p<E.bitmap.height;p++)m[y][p]=t(E.getPixelColor(y,p)).b}for(var C=w(m,this.size),z=0,A=0;A<this.smallerSize;A++)for(var P=0;P<this.smallerSize;P++)z+=C[A][P];for(var x=z/(this.smallerSize*this.smallerSize),O="",U=0;U<this.smallerSize;U++)for(var G=0;G<this.smallerSize;G++)O+=C[U][G]>x?"1":"0";return O};function t(E){var m={};return m.r=Math.floor(E/Math.pow(256,3)),m.g=Math.floor((E-m.r*Math.pow(256,3))/Math.pow(256,2)),m.b=Math.floor((E-m.r*Math.pow(256,3)-m.g*Math.pow(256,2))/Math.pow(256,1)),m.a=Math.floor((E-m.r*Math.pow(256,3)-m.g*Math.pow(256,2)-m.b*Math.pow(256,1))/Math.pow(256,0)),m}var S=[];function D(E){for(var m=1;m<E;m++)S[m]=1;S[0]=1/Math.sqrt(2)}function w(E,m){for(var y=m,p=[],C=0;C<y;C++){p[C]=[];for(var z=0;z<y;z++){for(var A=0,P=0;P<y;P++)for(var x=0;x<y;x++)A+=Math.cos((2*P+1)/(2*y)*C*Math.PI)*Math.cos((2*x+1)/(2*y)*z*Math.PI)*E[P][x];A*=S[C]*S[z]/4,p[C][z]=A}}return p}k.exports=T},{}],195:[function(_,k,b){(function(T,t){var S=_("@babel/runtime/helpers/interopRequireDefault");S(_("@babel/runtime/helpers/defineProperty")),S(_("@babel/runtime/helpers/extends")),T.browser,k.exports=function(D,w){var E=new XMLHttpRequest;E.open("GET",D.url,!0),E.responseType="arraybuffer",E.addEventListener("load",function(){if(E.status<400)try{var m=t.from(this.response);w(null,E,m)}catch(y){return w(new Error("Response is not a buffer for url "+D.url+". Error: "+y.message))}else w(new Error("HTTP Status "+E.status+" for url "+D.url))}),E.addEventListener("error",function(m){w(m)}),E.send()}}).call(this,_("_process"),_("buffer").Buffer)},{"@babel/runtime/helpers/defineProperty":7,"@babel/runtime/helpers/extends":8,"@babel/runtime/helpers/interopRequireDefault":11,_process:133,buffer:48,phin:108}],196:[function(_,k,b){(function(T){var t=_("@babel/runtime/helpers/interopRequireWildcard"),S=_("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(b,"__esModule",{value:!0}),b.parseBitmap=U,b.getBuffer=Z,b.getBufferAsync=X;var D=S(_("@babel/runtime/helpers/slicedToArray")),w=S(_("file-type")),E=S(_("exif-parser")),m=_("@jimp/utils"),y=t(_("../constants")),p=t(_("./mime")),C=S(_("./promisify"));function z(W,J){var re=(0,w.default)(W);return re?re.mime:J?p.getType(J):null}function A(W){return W._exif&&W._exif.tags&&W._exif.tags.Orientation||1}function P(W){var J=W.getWidth(),re=W.getHeight();switch(A(W)){case 1:return null;case 2:return function(te,ye){return[J-te-1,ye]};case 3:return function(te,ye){return[J-te-1,re-ye-1]};case 4:return function(te,ye){return[te,re-ye-1]};case 5:return function(te,ye){return[ye,te]};case 6:return function(te,ye){return[ye,re-te-1]};case 7:return function(te,ye){return[J-ye-1,re-te-1]};case 8:return function(te,ye){return[J-ye-1,te]};default:return null}}function x(W,J,re,te){for(var ye=W.bitmap.data,ue=W.bitmap.width,Se=T.alloc(ye.length),Le=0;Le<J;Le++)for(var Pe=0;Pe<re;Pe++){var Ee=te(Le,Pe),Me=(0,D.default)(Ee,2),He=Me[0],nt=Me[1],ht=J*Pe+Le<<2,Fe=ue*nt+He<<2,Ce=ye.readUInt32BE(Fe);Se.writeUInt32BE(Ce,ht)}W.bitmap.data=Se,W.bitmap.width=J,W.bitmap.height=re}function O(W){if(!(A(W)<2)){var J=P(W),re=A(W)>4,te=re?W.bitmap.height:W.bitmap.width,ye=re?W.bitmap.width:W.bitmap.height;x(W,te,ye,J)}}function U(W,J,re){var te=z(W,J);if(typeof te!="string")return re(new Error("Could not find MIME for Buffer <"+J+">"));this._originalMime=te.toLowerCase();try{var ye=this.getMIME();if(this.constructor.decoders[ye])this.bitmap=this.constructor.decoders[ye](W);else return m.throwError.call(this,"Unsupported MIME type: "+ye,re)}catch(ue){return re.call(this,ue,this)}try{this._exif=E.default.create(W).parse(),O(this)}catch{}return re.call(this,null,this),this}function G(W,J){return new W(J.bitmap.width,J.bitmap.height,J._background).composite(J,0,0).bitmap}function Z(W,J){if(W===y.AUTO&&(W=this.getMIME()),typeof W!="string")return m.throwError.call(this,"mime must be a string",J);if(typeof J!="function")return m.throwError.call(this,"cb must be a function",J);if(W=W.toLowerCase(),this._rgba&&this.constructor.hasAlpha[W]?this.bitmap.data=T.from(this.bitmap.data):this.bitmap.data=G(this.constructor,this).data,this.constructor.encoders[W]){var re=this.constructor.encoders[W](this);J.call(this,null,re)}else J.call(this,"Unsupported MIME type: "+W);return this}function X(W){return(0,C.default)(Z,this,W)}}).call(this,_("buffer").Buffer)},{"../constants":192,"./mime":197,"./promisify":198,"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/helpers/interopRequireWildcard":12,"@babel/runtime/helpers/slicedToArray":19,"@jimp/utils":235,buffer:48,"exif-parser":53,"file-type":62}],197:[function(_,k,b){Object.defineProperty(b,"__esModule",{value:!0}),b.getExtension=b.getType=b.addType=void 0;var T={},t=function(m){return Object.entries(T).find(function(y){return y[1].includes(m)})||[]},S=function(m,y){T[m]=y};b.addType=S;var D=function(m){var y=m.split("/").slice(-1),p=y[y.length-1].split(".").pop(),C=t(p);return C[0]};b.getType=D;var w=function(m){return(T[m.toLowerCase()]||[])[0]};b.getExtension=w},{}],198:[function(_,k,b){Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var T=function(D,w){for(var E=arguments.length,m=new Array(E>2?E-2:0),y=2;y<E;y++)m[y-2]=arguments[y];return new Promise(function(p,C){m.push(function(z,A){z&&C(z),p(A)}),D.bind(w).apply(void 0,m)})},t=T;b.default=t,k.exports=b.default},{}],199:[function(_,k,b){var T=_("@babel/runtime/helpers/interopRequireWildcard"),t=_("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(b,"__esModule",{value:!0}),b.default=p;var S=t(_("@babel/runtime/helpers/toConsumableArray")),D=t(_("@babel/runtime/helpers/defineProperty")),w=t(_("@babel/runtime/helpers/slicedToArray")),E=T(_("@jimp/core"));function m(C,z){var A=Object.keys(C);if(Object.getOwnPropertySymbols){var P=Object.getOwnPropertySymbols(C);z&&(P=P.filter(function(x){return Object.getOwnPropertyDescriptor(C,x).enumerable})),A.push.apply(A,P)}return A}function y(C){for(var z=1;z<arguments.length;z++){var A=arguments[z]!=null?arguments[z]:{};z%2?m(A,!0).forEach(function(P){(0,D.default)(C,P,A[P])}):Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(A)):m(A).forEach(function(P){Object.defineProperty(C,P,Object.getOwnPropertyDescriptor(A,P))})}return C}function p(C){var z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:E.default,A={hasAlpha:{},encoders:{},decoders:{},class:{},constants:{}};function P(U){Object.entries(U).forEach(function(G){var Z=(0,w.default)(G,2),X=Z[0],W=Z[1];A[X]=y({},A[X],{},W)})}function x(U){var G=U();Array.isArray(G.mime)?E.addType.apply(void 0,(0,S.default)(G.mime)):Object.entries(G.mime).forEach(function(Z){return E.addType.apply(void 0,(0,S.default)(Z))}),delete G.mime,P(G)}function O(U){var G=U(E.jimpEvChange)||{};!G.class&&!G.constants?P({class:G}):P(G)}return C.types&&(C.types.forEach(x),z.decoders=y({},z.decoders,{},A.decoders),z.encoders=y({},z.encoders,{},A.encoders),z.hasAlpha=y({},z.hasAlpha,{},A.hasAlpha)),C.plugins&&C.plugins.forEach(O),(0,E.addJimpMethods)(A.class,z),(0,E.addConstants)(A.constants,z),E.default}k.exports=b.default},{"@babel/runtime/helpers/defineProperty":7,"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/helpers/interopRequireWildcard":12,"@babel/runtime/helpers/slicedToArray":19,"@babel/runtime/helpers/toConsumableArray":20,"@jimp/core":193}],200:[function(_,k,b){var T=_("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var t=T(_("@jimp/custom")),S=T(_("@jimp/types")),D=T(_("@jimp/plugins")),w=(0,t.default)({types:[S.default],plugins:[D.default]});b.default=w,k.exports=b.default},{"@babel/runtime/helpers/interopRequireDefault":11,"@jimp/custom":199,"@jimp/plugins":228,"@jimp/types":234}],201:[function(_,k,b){var T=_("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var t=T(_("@babel/runtime/helpers/typeof")),S=_("@jimp/utils"),D=function(){return{blit:function(m,y,p,C,z,A,P,x){if(!(m instanceof this.constructor))return S.throwError.call(this,"The source must be a Jimp image",x);if(typeof y!="number"||typeof p!="number")return S.throwError.call(this,"x and y must be numbers",x);if(typeof C=="function")x=C,C=0,z=0,A=m.bitmap.width,P=m.bitmap.height;else if((0,t.default)(C)===(0,t.default)(z)&&(0,t.default)(z)===(0,t.default)(A)&&(0,t.default)(A)===(0,t.default)(P))C=C||0,z=z||0,A=A||m.bitmap.width,P=P||m.bitmap.height;else return S.throwError.call(this,"srcx, srcy, srcw, srch must be numbers",x);y=Math.round(y),p=Math.round(p),C=Math.round(C),z=Math.round(z),A=Math.round(A),P=Math.round(P);var O=this.bitmap.width,U=this.bitmap.height,G=this;return m.scanQuiet(C,z,A,P,function(Z,X,W){var J=y+Z-C,re=p+X-z;if(J>=0&&re>=0&&O-J>0&&U-re>0){var te=G.getPixelIndex(J,re),ye={r:this.bitmap.data[W],g:this.bitmap.data[W+1],b:this.bitmap.data[W+2],a:this.bitmap.data[W+3]},ue={r:G.bitmap.data[te],g:G.bitmap.data[te+1],b:G.bitmap.data[te+2],a:G.bitmap.data[te+3]};G.bitmap.data[te]=(ye.a*(ye.r-ue.r)-ue.r+255>>8)+ue.r,G.bitmap.data[te+1]=(ye.a*(ye.g-ue.g)-ue.g+255>>8)+ue.g,G.bitmap.data[te+2]=(ye.a*(ye.b-ue.b)-ue.b+255>>8)+ue.b,G.bitmap.data[te+3]=this.constructor.limit255(ue.a+ye.a)}}),(0,S.isNodePattern)(x)&&x.call(this,null,this),this}}};b.default=D,k.exports=b.default},{"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/helpers/typeof":21,"@jimp/utils":235}],202:[function(_,k,b){Object.defineProperty(b,"__esModule",{value:!0}),b.shgTable=b.mulTable=void 0;var T=[1,57,41,21,203,34,97,73,227,91,149,62,105,45,39,137,241,107,3,173,39,71,65,238,219,101,187,87,81,151,141,133,249,117,221,209,197,187,177,169,5,153,73,139,133,127,243,233,223,107,103,99,191,23,177,171,165,159,77,149,9,139,135,131,253,245,119,231,224,109,211,103,25,195,189,23,45,175,171,83,81,79,155,151,147,9,141,137,67,131,129,251,123,30,235,115,113,221,217,53,13,51,50,49,193,189,185,91,179,175,43,169,83,163,5,79,155,19,75,147,145,143,35,69,17,67,33,65,255,251,247,243,239,59,29,229,113,111,219,27,213,105,207,51,201,199,49,193,191,47,93,183,181,179,11,87,43,85,167,165,163,161,159,157,155,77,19,75,37,73,145,143,141,35,138,137,135,67,33,131,129,255,63,250,247,61,121,239,237,117,29,229,227,225,111,55,109,216,213,211,209,207,205,203,201,199,197,195,193,48,190,47,93,185,183,181,179,178,176,175,173,171,85,21,167,165,41,163,161,5,79,157,78,154,153,19,75,149,74,147,73,144,143,71,141,140,139,137,17,135,134,133,66,131,65,129,1];b.mulTable=T;var t=[0,9,10,10,14,12,14,14,16,15,16,15,16,15,15,17,18,17,12,18,16,17,17,19,19,18,19,18,18,19,19,19,20,19,20,20,20,20,20,20,15,20,19,20,20,20,21,21,21,20,20,20,21,18,21,21,21,21,20,21,17,21,21,21,22,22,21,22,22,21,22,21,19,22,22,19,20,22,22,21,21,21,22,22,22,18,22,22,21,22,22,23,22,20,23,22,22,23,23,21,19,21,21,21,23,23,23,22,23,23,21,23,22,23,18,22,23,20,22,23,23,23,21,22,20,22,21,22,24,24,24,24,24,22,21,24,23,23,24,21,24,23,24,22,24,24,22,24,24,22,23,24,24,24,20,23,22,23,24,24,24,24,24,24,24,23,21,23,22,23,24,24,24,22,24,24,24,23,22,24,24,25,23,25,25,23,24,25,25,24,22,25,25,25,24,23,24,25,25,25,25,25,25,25,25,25,25,25,25,23,25,23,24,25,25,25,25,25,25,25,25,25,24,22,25,25,23,25,25,20,24,25,24,25,25,22,24,25,24,25,24,25,25,24,25,25,25,25,22,25,25,25,24,25,24,25,18];b.shgTable=t},{}],203:[function(_,k,b){Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var T=_("@jimp/utils"),t=_("./blur-tables"),S=function(){return{blur:function(E,m){if(typeof E!="number")return T.throwError.call(this,"r must be a number",m);if(E<1)return T.throwError.call(this,"r must be greater than 0",m);for(var y,p,C,z,A,P,x,O,U,G,Z,X,W,J,re=this.bitmap.width-1,te=this.bitmap.height-1,ye=E+1,ue=t.mulTable[E],Se=t.shgTable[E],Le=[],Pe=[],Ee=[],Me=[],He=[],nt=[],ht=2;ht-- >0;){for(X=0,W=0,P=0;P<this.bitmap.height;P++){for(y=this.bitmap.data[W]*ye,p=this.bitmap.data[W+1]*ye,C=this.bitmap.data[W+2]*ye,z=this.bitmap.data[W+3]*ye,x=1;x<=E;x++)O=W+((x>re?re:x)<<2),y+=this.bitmap.data[O++],p+=this.bitmap.data[O++],C+=this.bitmap.data[O++],z+=this.bitmap.data[O];for(A=0;A<this.bitmap.width;A++)Le[X]=y,Pe[X]=p,Ee[X]=C,Me[X]=z,P===0&&(He[A]=((O=A+ye)<re?O:re)<<2,nt[A]=(O=A-E)>0?O<<2:0),U=W+He[A],G=W+nt[A],y+=this.bitmap.data[U++]-this.bitmap.data[G++],p+=this.bitmap.data[U++]-this.bitmap.data[G++],C+=this.bitmap.data[U++]-this.bitmap.data[G++],z+=this.bitmap.data[U]-this.bitmap.data[G],X++;W+=this.bitmap.width<<2}for(A=0;A<this.bitmap.width;A++){for(Z=A,y=Le[Z]*ye,p=Pe[Z]*ye,C=Ee[Z]*ye,z=Me[Z]*ye,x=1;x<=E;x++)Z+=x>te?0:this.bitmap.width,y+=Le[Z],p+=Pe[Z],C+=Ee[Z],z+=Me[Z];for(X=A<<2,P=0;P<this.bitmap.height;P++)J=z*ue>>>Se,this.bitmap.data[X+3]=J,J>255&&(this.bitmap.data[X+3]=255),J>0?(J=255/J,this.bitmap.data[X]=(y*ue>>>Se)*J,this.bitmap.data[X+1]=(p*ue>>>Se)*J,this.bitmap.data[X+2]=(C*ue>>>Se)*J):(this.bitmap.data[X+2]=0,this.bitmap.data[X+1]=0,this.bitmap.data[X]=0),A===0&&(He[P]=((O=P+ye)<te?O:te)*this.bitmap.width,nt[P]=(O=P-E)>0?O*this.bitmap.width:0),U=A+He[P],G=A+nt[P],y+=Le[U]-Le[G],p+=Pe[U]-Pe[G],C+=Ee[U]-Ee[G],z+=Me[U]-Me[G],X+=this.bitmap.width<<2}}return(0,T.isNodePattern)(m)&&m.call(this,null,this),this}}};b.default=S,k.exports=b.default},{"./blur-tables":202,"@jimp/utils":235}],204:[function(_,k,b){Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var T=_("@jimp/utils"),t=function(){return{circle:function(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},E=arguments.length>1?arguments[1]:void 0;typeof w=="function"&&(E=w,w={});var m=w.radius||(this.bitmap.width>this.bitmap.height?this.bitmap.height:this.bitmap.width)/2,y={x:typeof w.x=="number"?w.x:this.bitmap.width/2,y:typeof w.y=="number"?w.y:this.bitmap.height/2};return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(p,C,z){var A=Math.sqrt(Math.pow(p-y.x,2)+Math.pow(C-y.y,2));m-A<=0?this.bitmap.data[z+3]=0:m-A<1&&(this.bitmap.data[z+3]=255*(m-A))}),(0,T.isNodePattern)(E)&&E.call(this,null,this),this}}};b.default=t,k.exports=b.default},{"@jimp/utils":235}],205:[function(_,k,b){(function(T){var t=_("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var S=t(_("@babel/runtime/helpers/toConsumableArray")),D=t(_("tinycolor2")),w=_("@jimp/utils");function E(A,P,x,O){for(var U=[0,0,0],G=(P.length-1)/2,Z=0;Z<P.length;Z+=1)for(var X=0;X<P[Z].length;X+=1){var W=A.getPixelIndex(x+Z-G,O+X-G);U[0]+=A.bitmap.data[W]*P[Z][X],U[1]+=A.bitmap.data[W+1]*P[Z][X],U[2]+=A.bitmap.data[W+2]*P[Z][X]}return U}var m=function(P){return typeof P<"u"&&P!==null};function y(A){return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(P,x,O){var U=parseInt(.2126*this.bitmap.data[O]+.7152*this.bitmap.data[O+1]+.0722*this.bitmap.data[O+2],10);this.bitmap.data[O]=U,this.bitmap.data[O+1]=U,this.bitmap.data[O+2]=U}),(0,w.isNodePattern)(A)&&A.call(this,null,this),this}function p(A,P){var x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:50;return{r:(P.r-A.r)*(x/100)+A.r,g:(P.g-A.g)*(x/100)+A.g,b:(P.b-A.b)*(x/100)+A.b}}function C(A,P){var x=this;return!A||!Array.isArray(A)?w.throwError.call(this,"actions must be an array",P):(A=A.map(function(O){return(O.apply==="xor"||O.apply==="mix")&&(O.params[0]=(0,D.default)(O.params[0]).toRgb()),O}),this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(O,U,G){var Z={r:x.bitmap.data[G],g:x.bitmap.data[G+1],b:x.bitmap.data[G+2]},X=function(J,re){return x.constructor.limit255(Z[J]+re)};A.forEach(function(W){if(W.apply==="mix")Z=p(Z,W.params[0],W.params[1]);else if(W.apply==="tint")Z=p(Z,{r:255,g:255,b:255},W.params[0]);else if(W.apply==="shade")Z=p(Z,{r:0,g:0,b:0},W.params[0]);else if(W.apply==="xor")Z={r:Z.r^W.params[0].r,g:Z.g^W.params[0].g,b:Z.b^W.params[0].b};else if(W.apply==="red")Z.r=X("r",W.params[0]);else if(W.apply==="green")Z.g=X("g",W.params[0]);else if(W.apply==="blue")Z.b=X("b",W.params[0]);else{var J;if(W.apply==="hue"&&(W.apply="spin"),Z=(0,D.default)(Z),!Z[W.apply])return w.throwError.call(x,"action "+W.apply+" not supported",P);Z=(J=Z)[W.apply].apply(J,(0,S.default)(W.params)).toRgb()}}),x.bitmap.data[G]=Z.r,x.bitmap.data[G+1]=Z.g,x.bitmap.data[G+2]=Z.b}),(0,w.isNodePattern)(P)&&P.call(this,null,this),this)}var z=function(){return{brightness:function(x,O){return typeof x!="number"?w.throwError.call(this,"val must be numbers",O):x<-1||x>1?w.throwError.call(this,"val must be a number between -1 and +1",O):(this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(U,G,Z){x<0?(this.bitmap.data[Z]=this.bitmap.data[Z]*(1+x),this.bitmap.data[Z+1]=this.bitmap.data[Z+1]*(1+x),this.bitmap.data[Z+2]=this.bitmap.data[Z+2]*(1+x)):(this.bitmap.data[Z]=this.bitmap.data[Z]+(255-this.bitmap.data[Z])*x,this.bitmap.data[Z+1]=this.bitmap.data[Z+1]+(255-this.bitmap.data[Z+1])*x,this.bitmap.data[Z+2]=this.bitmap.data[Z+2]+(255-this.bitmap.data[Z+2])*x)}),(0,w.isNodePattern)(O)&&O.call(this,null,this),this)},contrast:function(x,O){if(typeof x!="number")return w.throwError.call(this,"val must be numbers",O);if(x<-1||x>1)return w.throwError.call(this,"val must be a number between -1 and +1",O);var U=(x+1)/(1-x);function G(Z){return Z=Math.floor(U*(Z-127)+127),Z<0?0:Z>255?255:Z}return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(Z,X,W){this.bitmap.data[W]=G(this.bitmap.data[W]),this.bitmap.data[W+1]=G(this.bitmap.data[W+1]),this.bitmap.data[W+2]=G(this.bitmap.data[W+2])}),(0,w.isNodePattern)(O)&&O.call(this,null,this),this},posterize:function(x,O){return typeof x!="number"?w.throwError.call(this,"n must be numbers",O):(x<2&&(x=2),this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(U,G,Z){this.bitmap.data[Z]=Math.floor(this.bitmap.data[Z]/255*(x-1))/(x-1)*255,this.bitmap.data[Z+1]=Math.floor(this.bitmap.data[Z+1]/255*(x-1))/(x-1)*255,this.bitmap.data[Z+2]=Math.floor(this.bitmap.data[Z+2]/255*(x-1))/(x-1)*255}),(0,w.isNodePattern)(O)&&O.call(this,null,this),this)},greyscale:y,grayscale:y,opacity:function(x,O){return typeof x!="number"?w.throwError.call(this,"f must be a number",O):x<0||x>1?w.throwError.call(this,"f must be a number from 0 to 1",O):(this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(U,G,Z){var X=this.bitmap.data[Z+3]*x;this.bitmap.data[Z+3]=X}),(0,w.isNodePattern)(O)&&O.call(this,null,this),this)},sepia:function(x){return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(O,U,G){var Z=this.bitmap.data[G],X=this.bitmap.data[G+1],W=this.bitmap.data[G+2];Z=Z*.393+X*.769+W*.189,X=Z*.349+X*.686+W*.168,W=Z*.272+X*.534+W*.131,this.bitmap.data[G]=Z<255?Z:255,this.bitmap.data[G+1]=X<255?X:255,this.bitmap.data[G+2]=W<255?W:255}),(0,w.isNodePattern)(x)&&x.call(this,null,this),this},fade:function(x,O){return typeof x!="number"?w.throwError.call(this,"f must be a number",O):x<0||x>1?w.throwError.call(this,"f must be a number from 0 to 1",O):(this.opacity(1-x),(0,w.isNodePattern)(O)&&O.call(this,null,this),this)},convolution:function(x,O,U){typeof O=="function"&&typeof U>"u"&&(U=O,O=null),O||(O=this.constructor.EDGE_EXTEND);var G=T.from(this.bitmap.data),Z=x.length,X=x[0].length,W=Math.floor(Z/2),J=Math.floor(X/2),re=-W,te=-J,ye,ue,Se,Le,Pe,Ee,Me,He,nt,ht;return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(Fe,Ce,Be){Le=0,Se=0,ue=0;for(var Ae=re;Ae<=W;Ae++)for(var se=te;se<=J;se++)He=Fe+se,nt=Ce+Ae,ye=x[Ae+W][se+J],ht=this.getPixelIndex(He,nt,O),ht===-1?(Me=0,Ee=0,Pe=0):(Pe=this.bitmap.data[ht+0],Ee=this.bitmap.data[ht+1],Me=this.bitmap.data[ht+2]),ue+=ye*Pe,Se+=ye*Ee,Le+=ye*Me;ue<0&&(ue=0),Se<0&&(Se=0),Le<0&&(Le=0),ue>255&&(ue=255),Se>255&&(Se=255),Le>255&&(Le=255),G[Be+0]=ue,G[Be+1]=Se,G[Be+2]=Le}),this.bitmap.data=G,(0,w.isNodePattern)(U)&&U.call(this,null,this),this},opaque:function(x){return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(O,U,G){this.bitmap.data[G+3]=255}),(0,w.isNodePattern)(x)&&x.call(this,null,this),this},pixelate:function(x,O,U,G,Z,X){if(typeof O=="function")X=O,Z=null,G=null,U=null,O=null;else{if(typeof x!="number")return w.throwError.call(this,"size must be a number",X);if(m(O)&&typeof O!="number")return w.throwError.call(this,"x must be a number",X);if(m(U)&&typeof U!="number")return w.throwError.call(this,"y must be a number",X);if(m(G)&&typeof G!="number")return w.throwError.call(this,"w must be a number",X);if(m(Z)&&typeof Z!="number")return w.throwError.call(this,"h must be a number",X)}var W=[[1/16,2/16,1/16],[2/16,4/16,2/16],[1/16,2/16,1/16]];O=O||0,U=U||0,G=m(G)?G:this.bitmap.width-O,Z=m(Z)?Z:this.bitmap.height-U;var J=this.cloneQuiet();return this.scanQuiet(O,U,G,Z,function(re,te,ye){re=x*Math.floor(re/x),te=x*Math.floor(te/x);var ue=E(J,W,re,te);this.bitmap.data[ye]=ue[0],this.bitmap.data[ye+1]=ue[1],this.bitmap.data[ye+2]=ue[2]}),(0,w.isNodePattern)(X)&&X.call(this,null,this),this},convolute:function(x,O,U,G,Z,X){if(!Array.isArray(x))return w.throwError.call(this,"the kernel must be an array",X);if(typeof O=="function")X=O,O=null,U=null,G=null,Z=null;else{if(m(O)&&typeof O!="number")return w.throwError.call(this,"x must be a number",X);if(m(U)&&typeof U!="number")return w.throwError.call(this,"y must be a number",X);if(m(G)&&typeof G!="number")return w.throwError.call(this,"w must be a number",X);if(m(Z)&&typeof Z!="number")return w.throwError.call(this,"h must be a number",X)}var W=(x.length-1)/2;O=m(O)?O:W,U=m(U)?U:W,G=m(G)?G:this.bitmap.width-O,Z=m(Z)?Z:this.bitmap.height-U;var J=this.cloneQuiet();return this.scanQuiet(O,U,G,Z,function(re,te,ye){var ue=E(J,x,re,te);this.bitmap.data[ye]=this.constructor.limit255(ue[0]),this.bitmap.data[ye+1]=this.constructor.limit255(ue[1]),this.bitmap.data[ye+2]=this.constructor.limit255(ue[2])}),(0,w.isNodePattern)(X)&&X.call(this,null,this),this},color:C,colour:C}};b.default=z,k.exports=b.default}).call(this,_("buffer").Buffer)},{"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/helpers/toConsumableArray":20,"@jimp/utils":235,buffer:48,tinycolor2:178}],206:[function(_,k,b){Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var T=_("@jimp/utils"),t=function(){return{contain:function(w,E,m,y,p){if(typeof w!="number"||typeof E!="number")return T.throwError.call(this,"w and h must be numbers",p);typeof m=="string"&&(typeof y=="function"&&typeof p>"u"&&(p=y),y=m,m=null),typeof m=="function"&&(typeof p>"u"&&(p=m),y=null,m=null),typeof y=="function"&&typeof p>"u"&&(p=y,y=null),m=m||this.constructor.HORIZONTAL_ALIGN_CENTER|this.constructor.VERTICAL_ALIGN_MIDDLE;var C=m&7,z=m>>3;if(!(C!==0&&!(C&C-1)||z!==0&&!(z&z-1)))return T.throwError.call(this,"only use one flag per alignment direction",p);var A=C>>1,P=z>>1,x=w/E>this.bitmap.width/this.bitmap.height?E/this.bitmap.height:w/this.bitmap.width,O=this.cloneQuiet().scale(x,y);return this.resize(w,E,y),this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(U,G,Z){this.bitmap.data.writeUInt32BE(this._background,Z)}),this.blit(O,(this.bitmap.width-O.bitmap.width)/2*A,(this.bitmap.height-O.bitmap.height)/2*P),(0,T.isNodePattern)(p)&&p.call(this,null,this),this}}};b.default=t,k.exports=b.default},{"@jimp/utils":235}],207:[function(_,k,b){Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var T=_("@jimp/utils"),t=function(){return{cover:function(w,E,m,y,p){if(typeof w!="number"||typeof E!="number")return T.throwError.call(this,"w and h must be numbers",p);m&&typeof m=="function"&&typeof p>"u"?(p=m,m=null,y=null):typeof y=="function"&&typeof p>"u"&&(p=y,y=null),m=m||this.constructor.HORIZONTAL_ALIGN_CENTER|this.constructor.VERTICAL_ALIGN_MIDDLE;var C=m&7,z=m>>3;if(!(C!==0&&!(C&C-1)||z!==0&&!(z&z-1)))return T.throwError.call(this,"only use one flag per alignment direction",p);var A=C>>1,P=z>>1,x=w/E>this.bitmap.width/this.bitmap.height?w/this.bitmap.width:E/this.bitmap.height;return this.scale(x,y),this.crop((this.bitmap.width-w)/2*A,(this.bitmap.height-E)/2*P,w,E),(0,T.isNodePattern)(p)&&p.call(this,null,this),this}}};b.default=t,k.exports=b.default},{"@jimp/utils":235}],208:[function(_,k,b){(function(T){var t=_("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(b,"__esModule",{value:!0}),b.default=w;var S=t(_("@babel/runtime/helpers/typeof")),D=_("@jimp/utils");function w(E){return E("crop",function(m,y,p,C,z){if(typeof m!="number"||typeof y!="number")return D.throwError.call(this,"x and y must be numbers",z);if(typeof p!="number"||typeof C!="number")return D.throwError.call(this,"w and h must be numbers",z);if(m=Math.round(m),y=Math.round(y),p=Math.round(p),C=Math.round(C),m===0&&p===this.bitmap.width){var A=p*y+m<<2,P=A+C*p<<2;this.bitmap.data=this.bitmap.data.slice(A,P)}else{var x=T.allocUnsafe(p*C*4),O=0;this.scanQuiet(m,y,p,C,function(U,G,Z){var X=this.bitmap.data.readUInt32BE(Z,!0);x.writeUInt32BE(X,O,!0),O+=4}),this.bitmap.data=x}return this.bitmap.width=p,this.bitmap.height=C,(0,D.isNodePattern)(z)&&z.call(this,null,this),this}),{class:{autocrop:function(){for(var y=this.bitmap.width,p=this.bitmap.height,C=1,z,A=0,P=2e-4,x=!0,O=!1,U=arguments.length,G=new Array(U),Z=0;Z<U;Z++)G[Z]=arguments[Z];for(var X=0,W=G.length;X<W;X++)if(typeof G[X]=="number"&&(P=G[X]),typeof G[X]=="boolean"&&(x=G[X]),typeof G[X]=="function"&&(z=G[X]),(0,S.default)(G[X])==="object"){var J=G[X];typeof J.tolerance<"u"&&(P=J.tolerance),typeof J.cropOnlyFrames<"u"&&(x=J.cropOnlyFrames),typeof J.cropSymmetric<"u"&&(O=J.cropSymmetric),typeof J.leaveBorder<"u"&&(A=J.leaveBorder)}var re=this.getPixelColor(0,0),te=this.constructor.intToRGBA(re),ye=0,ue=0,Se=0,Le=0;re=this.getPixelColor(0,0);e:for(var Pe=0;Pe<p-C;Pe++){for(var Ee=0;Ee<y;Ee++){var Me=this.getPixelColor(Ee,Pe),He=this.constructor.intToRGBA(Me);if(this.constructor.colorDiff(te,He)>P)break e}ye++}re=this.getPixelColor(y,0);e:for(var nt=0;nt<y-C;nt++){for(var ht=0+ye;ht<p;ht++){var Fe=this.getPixelColor(nt,ht),Ce=this.constructor.intToRGBA(Fe);if(this.constructor.colorDiff(te,Ce)>P)break e}ue++}re=this.getPixelColor(0,p);e:for(var Be=p-1;Be>=ye+C;Be--){for(var Ae=y-ue-1;Ae>=0;Ae--){var se=this.getPixelColor(Ae,Be),pe=this.constructor.intToRGBA(se);if(this.constructor.colorDiff(te,pe)>P)break e}Se++}re=this.getPixelColor(y,p);e:for(var Ke=y-1;Ke>=0+ue+C;Ke--){for(var _e=p-1;_e>=0+ye;_e--){var ke=this.getPixelColor(Ke,_e),qe=this.constructor.intToRGBA(ke);if(this.constructor.colorDiff(te,qe)>P)break e}Le++}var tt=!1;if(Le-=A,ue-=A,ye-=A,Se-=A,O){var Ge=Math.min(ue,Le),We=Math.min(ye,Se);Le=Ge,ue=Ge,ye=We,Se=We}Le=Le>=0?Le:0,ue=ue>=0?ue:0,ye=ye>=0?ye:0,Se=Se>=0?Se:0;var Je=y-(Le+ue),it=p-(Se+ye);return x?tt=ue!==0&&ye!==0&&Le!==0&&Se!==0:tt=ue!==0||ye!==0||Le!==0||Se!==0,tt&&this.crop(ue,ye,Je,it),(0,D.isNodePattern)(z)&&z.call(this,null,this),this}}}}k.exports=b.default}).call(this,_("buffer").Buffer)},{"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/helpers/typeof":21,"@jimp/utils":235,buffer:48}],209:[function(_,k,b){var T=_("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var t=T(_("@babel/runtime/helpers/typeof")),S=_("@jimp/utils"),D=function(){return{displace:function(m,y,p){if((0,t.default)(m)!=="object"||m.constructor!==this.constructor)return S.throwError.call(this,"The source must be a Jimp image",p);if(typeof y!="number")return S.throwError.call(this,"factor must be a number",p);var C=this.cloneQuiet();return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(z,A,P){var x=m.bitmap.data[P]/256*y;x=Math.round(x);var O=this.getPixelIndex(z+x,A);this.bitmap.data[O]=C.bitmap.data[P],this.bitmap.data[O+1]=C.bitmap.data[P+1],this.bitmap.data[O+2]=C.bitmap.data[P+2]}),(0,S.isNodePattern)(p)&&p.call(this,null,this),this}}};b.default=D,k.exports=b.default},{"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/helpers/typeof":21,"@jimp/utils":235}],210:[function(_,k,b){Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var T=_("@jimp/utils");function t(D){var w=[1,9,3,11,13,5,15,7,4,12,2,10,16,8,14,6];return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(E,m,y){var p=((m&3)<<2)+E%4,C=w[p];this.bitmap.data[y]=Math.min(this.bitmap.data[y]+C,255),this.bitmap.data[y+1]=Math.min(this.bitmap.data[y+1]+C,255),this.bitmap.data[y+2]=Math.min(this.bitmap.data[y+2]+C,255)}),(0,T.isNodePattern)(D)&&D.call(this,null,this),this}var S=function(){return{dither565:t,dither16:t}};b.default=S,k.exports=b.default},{"@jimp/utils":235}],211:[function(_,k,b){Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var T=_("@jimp/utils"),t=function(){return{fisheye:function(){var w=this,E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{r:2.5},m=arguments.length>1?arguments[1]:void 0;typeof E=="function"&&(m=E,E={r:2.5});var y=this.cloneQuiet(),p=y.bitmap,C=p.width,z=p.height;return y.scanQuiet(0,0,C,z,function(A,P){var x=A/C,O=P/z,U=Math.sqrt(Math.pow(x-.5,2)+Math.pow(O-.5,2)),G=2*Math.pow(U,E.r),Z=(x-.5)/U,X=(O-.5)/U,W=Math.round((G*Z+.5)*C),J=Math.round((G*X+.5)*z),re=y.getPixelColor(W,J);w.setPixelColor(re,A,P)}),this.setPixelColor(y.getPixelColor(C/2,z/2),C/2,z/2),(0,T.isNodePattern)(m)&&m.call(this,null,this),this}}};b.default=t,k.exports=b.default},{"@jimp/utils":235}],212:[function(_,k,b){(function(T){Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var t=_("@jimp/utils");function S(w,E,m){if(typeof w!="boolean"||typeof E!="boolean")return t.throwError.call(this,"horizontal and vertical must be Booleans",m);var y=T.alloc(this.bitmap.data.length);return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(p,C,z){var A=w?this.bitmap.width-1-p:p,P=E?this.bitmap.height-1-C:C,x=this.bitmap.width*P+A<<2,O=this.bitmap.data.readUInt32BE(z);y.writeUInt32BE(O,x)}),this.bitmap.data=T.from(y),(0,t.isNodePattern)(m)&&m.call(this,null,this),this}var D=function(){return{flip:S,mirror:S}};b.default=D,k.exports=b.default}).call(this,_("buffer").Buffer)},{"@jimp/utils":235,buffer:48}],213:[function(_,k,b){Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var T=_("@jimp/utils"),t=function(){return{gaussian:function(w,E){if(typeof w!="number")return T.throwError.call(this,"r must be a number",E);if(w<1)return T.throwError.call(this,"r must be greater than 0",E);for(var m=Math.ceil(w*2.57),y=m*2+1,p=w*w*2,C=p*Math.PI,z=[],A=0;A<y;A++){z[A]=[];for(var P=0;P<y;P++){var x=Math.pow(P-m,2)+Math.pow(A-m,2);z[A][P]=Math.exp(-x/p)/C}}for(var O=0;O<this.bitmap.height;O++)for(var U=0;U<this.bitmap.width;U++)for(var G=0,Z=0,X=0,W=0,J=0,re=0;re<y;re++){for(var te=0;te<y;te++){var ye=Math.min(this.bitmap.width-1,Math.max(0,te+U-m)),ue=Math.min(this.bitmap.height-1,Math.max(0,re+O-m)),Se=z[re][te],Le=ue*this.bitmap.width+ye<<2;G+=this.bitmap.data[Le]*Se,Z+=this.bitmap.data[Le+1]*Se,X+=this.bitmap.data[Le+2]*Se,W+=this.bitmap.data[Le+3]*Se,J+=Se}var Pe=O*this.bitmap.width+U<<2;this.bitmap.data[Pe]=Math.round(G/J),this.bitmap.data[Pe+1]=Math.round(Z/J),this.bitmap.data[Pe+2]=Math.round(X/J),this.bitmap.data[Pe+3]=Math.round(W/J)}return(0,T.isNodePattern)(E)&&E.call(this,null,this),this}}};b.default=t,k.exports=b.default},{"@jimp/utils":235}],214:[function(_,k,b){Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var T=_("@jimp/utils"),t=function(){return{invert:function(w){return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(E,m,y){this.bitmap.data[y]=255-this.bitmap.data[y],this.bitmap.data[y+1]=255-this.bitmap.data[y+1],this.bitmap.data[y+2]=255-this.bitmap.data[y+2]}),(0,T.isNodePattern)(w)&&w.call(this,null,this),this}}};b.default=t,k.exports=b.default},{"@jimp/utils":235}],215:[function(_,k,b){Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var T=_("@jimp/utils"),t=function(){return{mask:function(w){var E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,y=arguments.length>3?arguments[3]:void 0;if(!(w instanceof this.constructor))return T.throwError.call(this,"The source must be a Jimp image",y);if(typeof E!="number"||typeof m!="number")return T.throwError.call(this,"x and y must be numbers",y);E=Math.round(E),m=Math.round(m);var p=this.bitmap.width,C=this.bitmap.height,z=this;return w.scanQuiet(0,0,w.bitmap.width,w.bitmap.height,function(A,P,x){var O=E+A,U=m+P;if(O>=0&&U>=0&&O<p&&U<C){var G=z.getPixelIndex(O,U),Z=this.bitmap.data,X=(Z[x+0]+Z[x+1]+Z[x+2])/3;z.bitmap.data[G+3]*=X/255}}),(0,T.isNodePattern)(y)&&y.call(this,null,this),this}}};b.default=t,k.exports=b.default},{"@jimp/utils":235}],216:[function(_,k,b){Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var T=_("@jimp/utils");function t(){var E={r:new Array(256).fill(0),g:new Array(256).fill(0),b:new Array(256).fill(0)};return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(m,y,p){E.r[this.bitmap.data[p+0]]++,E.g[this.bitmap.data[p+1]]++,E.b[this.bitmap.data[p+2]]++}),E}var S=function(m,y,p){return(m-y)*255/(p-y)},D=function(m){return[m.findIndex(function(y){return y>0}),255-m.slice().reverse().findIndex(function(y){return y>0})]},w=function(){return{normalize:function(y){var p=t.call(this),C={r:D(p.r),g:D(p.g),b:D(p.b)};return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(z,A,P){var x=this.bitmap.data[P+0],O=this.bitmap.data[P+1],U=this.bitmap.data[P+2];this.bitmap.data[P+0]=S(x,C.r[0],C.r[1]),this.bitmap.data[P+1]=S(O,C.g[0],C.g[1]),this.bitmap.data[P+2]=S(U,C.b[0],C.b[1])}),(0,T.isNodePattern)(y)&&y.call(this,null,this),this}}};b.default=w,k.exports=b.default},{"@jimp/utils":235}],217:[function(_,k,b){(function(T){var t=_("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var S=t(_("@babel/runtime/helpers/typeof")),D=t(_("@babel/runtime/helpers/toConsumableArray")),w=t(_("path")),E=t(_("load-bmfont")),m=_("@jimp/utils"),y=_("./measure-text");function p(U,G,Z,X,W){return W===U.HORIZONTAL_ALIGN_LEFT?0:W===U.HORIZONTAL_ALIGN_CENTER?(X-(0,y.measureText)(G,Z))/2:X-(0,y.measureText)(G,Z)}function C(U,G,Z,X,W){if(W.width>0&&W.height>0){var J=G.pages[W.page];U.blit(J,Z+W.xoffset,X+W.yoffset,W.x,W.y,W.width,W.height)}return U}function z(U,G,Z,X,W){for(var J=0;J<X.length;J++){var re=void 0;U.chars[X[J]]?re=X[J]:/\s/.test(X[J])?re="":re="?";var te=U.chars[re]||{},ye=U.kernings[re];C(this,U,G,Z,te||{});var ue=ye&&ye[X[J+1]]?ye[X[J+1]]:0;G+=ue+(te.xadvance||W)}}function A(U,G,Z){var X=G.split(" "),W=[],J=[],re=0;return X.forEach(function(te){var ye=[].concat((0,D.default)(J),[te]).join(" "),ue=(0,y.measureText)(U,ye);ue<=Z?(ue>re&&(re=ue),J.push(te)):(W.push(J),J=[te])}),W.push(J),{lines:W,longestLine:re}}function P(U,G,Z){var X=Z.map(function(W){return U.read(G+"/"+W)});return Promise.all(X)}var x="browser/lib/",O=function(){return{constants:{measureText:y.measureText,measureTextHeight:y.measureTextHeight,FONT_SANS_8_BLACK:w.default.join(x,"fonts/open-sans/open-sans-8-black/open-sans-8-black.fnt"),FONT_SANS_10_BLACK:w.default.join(x,"fonts/open-sans/open-sans-10-black/open-sans-10-black.fnt"),FONT_SANS_12_BLACK:w.default.join(x,"fonts/open-sans/open-sans-12-black/open-sans-12-black.fnt"),FONT_SANS_14_BLACK:w.default.join(x,"fonts/open-sans/open-sans-14-black/open-sans-14-black.fnt"),FONT_SANS_16_BLACK:w.default.join(x,"fonts/open-sans/open-sans-16-black/open-sans-16-black.fnt"),FONT_SANS_32_BLACK:w.default.join(x,"fonts/open-sans/open-sans-32-black/open-sans-32-black.fnt"),FONT_SANS_64_BLACK:w.default.join(x,"fonts/open-sans/open-sans-64-black/open-sans-64-black.fnt"),FONT_SANS_128_BLACK:w.default.join(x,"fonts/open-sans/open-sans-128-black/open-sans-128-black.fnt"),FONT_SANS_8_WHITE:w.default.join(x,"fonts/open-sans/open-sans-8-white/open-sans-8-white.fnt"),FONT_SANS_16_WHITE:w.default.join(x,"fonts/open-sans/open-sans-16-white/open-sans-16-white.fnt"),FONT_SANS_32_WHITE:w.default.join(x,"fonts/open-sans/open-sans-32-white/open-sans-32-white.fnt"),FONT_SANS_64_WHITE:w.default.join(x,"fonts/open-sans/open-sans-64-white/open-sans-64-white.fnt"),FONT_SANS_128_WHITE:w.default.join(x,"fonts/open-sans/open-sans-128-white/open-sans-128-white.fnt"),loadFont:function(Z,X){var W=this;return typeof Z!="string"?m.throwError.call(this,"file must be a string",X):new Promise(function(J,re){X=X||function(te,ye){te?re(te):J(ye)},(0,E.default)(Z,function(te,ye){var ue={},Se={};if(te)return m.throwError.call(W,te,X);for(var Le=0;Le<ye.chars.length;Le++)ue[String.fromCharCode(ye.chars[Le].id)]=ye.chars[Le];for(var Pe=0;Pe<ye.kernings.length;Pe++){var Ee=String.fromCharCode(ye.kernings[Pe].first);Se[Ee]=Se[Ee]||{},Se[Ee][String.fromCharCode(ye.kernings[Pe].second)]=ye.kernings[Pe].amount}P(W,w.default.dirname(Z),ye.pages).then(function(Me){X(null,{chars:ue,kernings:Se,pages:Me,common:ye.common,info:ye.info})})})})}},class:{print:function(Z,X,W,J,re,te,ye){var ue=this;if(typeof re=="function"&&typeof ye>"u"&&(ye=re,re=1/0),typeof re>"u"&&(re=1/0),typeof te=="function"&&typeof ye>"u"&&(ye=te,te=1/0),typeof te>"u"&&(te=1/0),(0,S.default)(Z)!=="object")return m.throwError.call(this,"font must be a Jimp loadFont",ye);if(typeof X!="number"||typeof W!="number"||typeof re!="number")return m.throwError.call(this,"x, y and maxWidth must be numbers",ye);if(typeof re!="number")return m.throwError.call(this,"maxWidth must be a number",ye);if(typeof te!="number")return m.throwError.call(this,"maxHeight must be a number",ye);var Se,Le;if((0,S.default)(J)==="object"&&J.text!==null&&J.text!==void 0){Se=J.alignmentX||this.constructor.HORIZONTAL_ALIGN_LEFT,Le=J.alignmentY||this.constructor.VERTICAL_ALIGN_TOP;var Pe=J;J=Pe.text}else Se=this.constructor.HORIZONTAL_ALIGN_LEFT,Le=this.constructor.VERTICAL_ALIGN_TOP,J=J.toString();te!==1/0&&Le===this.constructor.VERTICAL_ALIGN_BOTTOM?W+=te-(0,y.measureTextHeight)(Z,J,re):te!==1/0&&Le===this.constructor.VERTICAL_ALIGN_MIDDLE&&(W+=te/2-(0,y.measureTextHeight)(Z,J,re)/2);var Ee=Object.entries(Z.chars)[0][1].xadvance,Me=A(Z,J,re),He=Me.lines,nt=Me.longestLine;return He.forEach(function(ht){var Fe=ht.join(" "),Ce=p(ue.constructor,Z,Fe,re,Se);z.call(ue,Z,X+Ce,W,Fe,Ee),W+=Z.common.lineHeight}),(0,m.isNodePattern)(ye)&&ye.call(this,null,this,{x:X+nt,y:W}),this}}}};b.default=O,k.exports=b.default}).call(this,"/../../node_modules/@jimp/plugin-print/dist")},{"./measure-text":218,"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/helpers/toConsumableArray":20,"@babel/runtime/helpers/typeof":21,"@jimp/utils":235,"load-bmfont":219,path:107}],218:[function(_,k,b){Object.defineProperty(b,"__esModule",{value:!0}),b.measureText=T,b.measureTextHeight=t;function T(S,D){for(var w=0,E=0;E<D.length;E++)if(S.chars[D[E]]){var m=S.kernings[D[E]]&&S.kernings[D[E]][D[E+1]]?S.kernings[D[E]][D[E+1]]:0;w+=(S.chars[D[E]].xadvance||0)+m}return w}function t(S,D,w){for(var E=D.split(" "),m="",y=S.common.lineHeight,p=0;p<E.length;p++){var C=m+E[p]+" ",z=T(S,C);z>w&&p>0?(y+=S.common.lineHeight,m=E[p]+" "):m=C}return y}},{}],219:[function(_,k,b){(function(T){var t=_("xhr"),S=function(){},D=_("parse-bmfont-ascii"),w=_("parse-bmfont-xml"),E=_("parse-bmfont-binary"),m=_("./lib/is-binary"),y=_("xtend"),p=function(){return self.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}();k.exports=function(A,P){P=typeof P=="function"?P:S,typeof A=="string"?A={uri:A}:A||(A={});var x=A.binary;x&&(A=z(A)),t(A,function(O,U,G){if(O)return P(O);if(!/^2/.test(U.statusCode))return P(new Error("http status code: "+U.statusCode));if(!G)return P(new Error("no body result"));var Z=!1;if(C(G)){var X=new Uint8Array(G);G=new T(X,"binary")}m(G)&&(Z=!0,typeof G=="string"&&(G=new T(G,"binary"))),Z||(T.isBuffer(G)&&(G=G.toString(A.encoding)),G=G.trim());var W;try{var J=U.headers["content-type"];Z?W=E(G):/json/.test(J)||G.charAt(0)==="{"?W=JSON.parse(G):/xml/.test(J)||G.charAt(0)==="<"?W=w(G):W=D(G)}catch(re){P(new Error("error parsing font "+re.message)),P=S}P(null,W)})};function C(A){var P=Object.prototype.toString;return P.call(A)==="[object ArrayBuffer]"}function z(A){if(p)return y(A,{responseType:"arraybuffer"});if(typeof self.XMLHttpRequest>"u")throw new Error("your browser does not support XHR loading");var P=new self.XMLHttpRequest;return P.overrideMimeType("text/plain; charset=x-user-defined"),y({xhr:P},A)}}).call(this,_("buffer").Buffer)},{"./lib/is-binary":220,buffer:48,"parse-bmfont-ascii":102,"parse-bmfont-binary":103,"parse-bmfont-xml":104,xhr:187,xtend:189}],220:[function(_,k,b){(function(T){var t=_("buffer-equal"),S=new T([66,77,70,3]);k.exports=function(D){return typeof D=="string"?D.substring(0,3)==="BMF":D.length>4&&t(D.slice(0,4),S)}}).call(this,_("buffer").Buffer)},{buffer:48,"buffer-equal":49}],221:[function(_,k,b){(function(T){var t=_("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var S=_("@jimp/utils"),D=t(_("./modules/resize")),w=t(_("./modules/resize2")),E=function(){return{constants:{RESIZE_NEAREST_NEIGHBOR:"nearestNeighbor",RESIZE_BILINEAR:"bilinearInterpolation",RESIZE_BICUBIC:"bicubicInterpolation",RESIZE_HERMITE:"hermiteInterpolation",RESIZE_BEZIER:"bezierInterpolation"},class:{resize:function(p,C,z,A){if(typeof p!="number"||typeof C!="number")return S.throwError.call(this,"w and h must be numbers",A);if(typeof z=="function"&&typeof A>"u"&&(A=z,z=null),p===this.constructor.AUTO&&C===this.constructor.AUTO)return S.throwError.call(this,"w and h cannot both be set to auto",A);if(p===this.constructor.AUTO&&(p=this.bitmap.width*(C/this.bitmap.height)),C===this.constructor.AUTO&&(C=this.bitmap.height*(p/this.bitmap.width)),p<0||C<0)return S.throwError.call(this,"w and h must be positive numbers",A);if(p=Math.round(p),C=Math.round(C),typeof w.default[z]=="function"){var P={data:T.alloc(p*C*4),width:p,height:C};w.default[z](this.bitmap,P),this.bitmap=P}else{var x=this,O=new D.default(this.bitmap.width,this.bitmap.height,p,C,!0,!0,function(U){x.bitmap.data=T.from(U),x.bitmap.width=p,x.bitmap.height=C});O.resize(this.bitmap.data)}return(0,S.isNodePattern)(A)&&A.call(this,null,this),this}}}};b.default=E,k.exports=b.default}).call(this,_("buffer").Buffer)},{"./modules/resize":222,"./modules/resize2":223,"@babel/runtime/helpers/interopRequireDefault":11,"@jimp/utils":235,buffer:48}],222:[function(_,k,b){function T(t,S,D,w,E,m,y){this.widthOriginal=Math.abs(Math.floor(t)||0),this.heightOriginal=Math.abs(Math.floor(S)||0),this.targetWidth=Math.abs(Math.floor(D)||0),this.targetHeight=Math.abs(Math.floor(w)||0),this.colorChannels=E?4:3,this.interpolationPass=!!m,this.resizeCallback=typeof y=="function"?y:function(){},this.targetWidthMultipliedByChannels=this.targetWidth*this.colorChannels,this.originalWidthMultipliedByChannels=this.widthOriginal*this.colorChannels,this.originalHeightMultipliedByChannels=this.heightOriginal*this.colorChannels,this.widthPassResultSize=this.targetWidthMultipliedByChannels*this.heightOriginal,this.finalResultSize=this.targetWidthMultipliedByChannels*this.targetHeight,this.initialize()}T.prototype.initialize=function(){if(this.widthOriginal>0&&this.heightOriginal>0&&this.targetWidth>0&&this.targetHeight>0)this.configurePasses();else throw new Error("Invalid settings specified for the resizer.")},T.prototype.configurePasses=function(){this.widthOriginal===this.targetWidth?this.resizeWidth=this.bypassResizer:(this.ratioWeightWidthPass=this.widthOriginal/this.targetWidth,this.ratioWeightWidthPass<1&&this.interpolationPass?(this.initializeFirstPassBuffers(!0),this.resizeWidth=this.colorChannels===4?this.resizeWidthInterpolatedRGBA:this.resizeWidthInterpolatedRGB):(this.initializeFirstPassBuffers(!1),this.resizeWidth=this.colorChannels===4?this.resizeWidthRGBA:this.resizeWidthRGB)),this.heightOriginal===this.targetHeight?this.resizeHeight=this.bypassResizer:(this.ratioWeightHeightPass=this.heightOriginal/this.targetHeight,this.ratioWeightHeightPass<1&&this.interpolationPass?(this.initializeSecondPassBuffers(!0),this.resizeHeight=this.resizeHeightInterpolated):(this.initializeSecondPassBuffers(!1),this.resizeHeight=this.colorChannels===4?this.resizeHeightRGBA:this.resizeHeightRGB))},T.prototype._resizeWidthInterpolatedRGBChannels=function(t,S){var D=S?4:3,w=this.ratioWeightWidthPass,E=this.widthBuffer,m=0,y=0,p=0,C=0,z=0,A;for(A=0;m<1/3;A+=D,m+=w)for(y=A,p=0;y<this.widthPassResultSize;p+=this.originalWidthMultipliedByChannels,y+=this.targetWidthMultipliedByChannels)E[y]=t[p],E[y+1]=t[p+1],E[y+2]=t[p+2],S&&(E[y+3]=t[p+3]);m-=1/3;var P;for(P=this.widthOriginal-1;m<P;A+=D,m+=w)for(z=m%1,C=1-z,y=A,p=Math.floor(m)*D;y<this.widthPassResultSize;p+=this.originalWidthMultipliedByChannels,y+=this.targetWidthMultipliedByChannels)E[y+0]=t[p+0]*C+t[p+D+0]*z,E[y+1]=t[p+1]*C+t[p+D+1]*z,E[y+2]=t[p+2]*C+t[p+D+2]*z,S&&(E[y+3]=t[p+3]*C+t[p+D+3]*z);for(P=this.originalWidthMultipliedByChannels-D;A<this.targetWidthMultipliedByChannels;A+=D)for(y=A,p=P;y<this.widthPassResultSize;p+=this.originalWidthMultipliedByChannels,y+=this.targetWidthMultipliedByChannels)E[y]=t[p],E[y+1]=t[p+1],E[y+2]=t[p+2],S&&(E[y+3]=t[p+3]);return E},T.prototype._resizeWidthRGBChannels=function(t,S){var D=S?4:3,w=this.ratioWeightWidthPass,E=1/w,m=this.originalWidthMultipliedByChannels-D+1,y=this.targetWidthMultipliedByChannels-D+1,p=this.outputWidthWorkBench,C=this.widthBuffer,z=this.outputWidthWorkBenchOpaquePixelsCount,A=0,P=0,x=0,O=0,U=0,G=0,Z=0,X=1,W=0,J=0,re=0,te=0;do{for(U=0;U<this.originalHeightMultipliedByChannels;)p[U++]=0,p[U++]=0,p[U++]=0,S&&(p[U++]=0,z[U/D-1]=0);A=w;do{for(P=1+x-O,X=Math.min(A,P),U=0,G=x;U<this.originalHeightMultipliedByChannels;G+=m)W=t[G],J=t[++G],re=t[++G],te=S?t[++G]:255,p[U++]+=(te?W:0)*X,p[U++]+=(te?J:0)*X,p[U++]+=(te?re:0)*X,S&&(p[U++]+=te*X,z[U/D-1]+=te?X:0);if(A>=P)x+=D,O=x,A-=P;else{O+=A;break}}while(A>0&&x<this.originalWidthMultipliedByChannels);for(U=0,G=Z;U<this.originalHeightMultipliedByChannels;G+=y)A=S?z[U/D]:1,X=S?A?1/A:0:E,C[G]=p[U++]*X,C[++G]=p[U++]*X,C[++G]=p[U++]*X,S&&(C[++G]=p[U++]*E);Z+=D}while(Z<this.targetWidthMultipliedByChannels);return C},T.prototype._resizeHeightRGBChannels=function(t,S){var D=this.ratioWeightHeightPass,w=1/D,E=this.outputHeightWorkBench,m=this.heightBuffer,y=this.outputHeightWorkBenchOpaquePixelsCount,p=0,C=0,z=0,A=0,P=0,x=0,O=0,U=1,G=0,Z=0,X=0,W=0;do{for(P=0;P<this.targetWidthMultipliedByChannels;)E[P++]=0,E[P++]=0,E[P++]=0,S&&(E[P++]=0,y[P/4-1]=0);p=D;do{for(C=1+z-A,U=Math.min(p,C),O=z,P=0;P<this.targetWidthMultipliedByChannels;)G=t[O++],Z=t[O++],X=t[O++],W=S?t[O++]:255,E[P++]+=(W?G:0)*U,E[P++]+=(W?Z:0)*U,E[P++]+=(W?X:0)*U,S&&(E[P++]+=W*U,y[P/4-1]+=W?U:0);if(p>=C)z=O,A=z,p-=C;else{A+=p;break}}while(p>0&&z<this.widthPassResultSize);for(P=0;P<this.targetWidthMultipliedByChannels;)p=S?y[P/4]:1,U=S?p?1/p:0:w,m[x++]=Math.round(E[P++]*U),m[x++]=Math.round(E[P++]*U),m[x++]=Math.round(E[P++]*U),S&&(m[x++]=Math.round(E[P++]*w))}while(x<this.finalResultSize);return m},T.prototype.resizeWidthInterpolatedRGB=function(t){return this._resizeWidthInterpolatedRGBChannels(t,!1)},T.prototype.resizeWidthInterpolatedRGBA=function(t){return this._resizeWidthInterpolatedRGBChannels(t,!0)},T.prototype.resizeWidthRGB=function(t){return this._resizeWidthRGBChannels(t,!1)},T.prototype.resizeWidthRGBA=function(t){return this._resizeWidthRGBChannels(t,!0)},T.prototype.resizeHeightInterpolated=function(t){for(var S=this.ratioWeightHeightPass,D=this.heightBuffer,w=0,E=0,m=0,y=0,p=0,C=0,z=0,A;w<1/3;w+=S)for(m=0;m<this.targetWidthMultipliedByChannels;)D[E++]=Math.round(t[m++]);for(w-=1/3,A=this.heightOriginal-1;w<A;w+=S)for(z=w%1,C=1-z,y=Math.floor(w)*this.targetWidthMultipliedByChannels,p=y+this.targetWidthMultipliedByChannels,m=0;m<this.targetWidthMultipliedByChannels;++m)D[E++]=Math.round(t[y++]*C+t[p++]*z);for(;E<this.finalResultSize;)for(m=0,y=A*this.targetWidthMultipliedByChannels;m<this.targetWidthMultipliedByChannels;++m)D[E++]=Math.round(t[y++]);return D},T.prototype.resizeHeightRGB=function(t){return this._resizeHeightRGBChannels(t,!1)},T.prototype.resizeHeightRGBA=function(t){return this._resizeHeightRGBChannels(t,!0)},T.prototype.resize=function(t){this.resizeCallback(this.resizeHeight(this.resizeWidth(t)))},T.prototype.bypassResizer=function(t){return t},T.prototype.initializeFirstPassBuffers=function(t){this.widthBuffer=this.generateFloatBuffer(this.widthPassResultSize),t||(this.outputWidthWorkBench=this.generateFloatBuffer(this.originalHeightMultipliedByChannels),this.colorChannels>3&&(this.outputWidthWorkBenchOpaquePixelsCount=this.generateFloat64Buffer(this.heightOriginal)))},T.prototype.initializeSecondPassBuffers=function(t){this.heightBuffer=this.generateUint8Buffer(this.finalResultSize),t||(this.outputHeightWorkBench=this.generateFloatBuffer(this.targetWidthMultipliedByChannels),this.colorChannels>3&&(this.outputHeightWorkBenchOpaquePixelsCount=this.generateFloat64Buffer(this.targetWidth)))},T.prototype.generateFloatBuffer=function(t){try{return new Float32Array(t)}catch{return[]}},T.prototype.generateFloat64Buffer=function(t){try{return new Float64Array(t)}catch{return[]}},T.prototype.generateUint8Buffer=function(t){try{return new Uint8Array(t)}catch{return[]}},k.exports=T},{}],223:[function(_,k,b){(function(T){k.exports={nearestNeighbor:function(S,D){for(var w=S.width,E=S.height,m=D.width,y=D.height,p=S.data,C=D.data,z=0;z<y;z++)for(var A=0;A<m;A++){var P=(z*m+A)*4,x=Math.floor(z*E/y),O=Math.floor(A*w/m),U=(x*w+O)*4;C[P++]=p[U++],C[P++]=p[U++],C[P++]=p[U++],C[P++]=p[U++]}},bilinearInterpolation:function(S,D){for(var w=S.width,E=S.height,m=D.width,y=D.height,p=S.data,C=D.data,z=function(te,ye,ue,Se,Le){return ye===Se?ue:Math.round((te-ye)*Le+(Se-te)*ue)},A=function(te,ye,ue,Se,Le,Pe,Ee,Me){var He=(Ee*w+Se)*4+ye,nt=(Ee*w+Le)*4+ye,ht=z(ue,Se,p[He],Le,p[nt]);if(Me===Ee)C[te+ye]=ht;else{He=(Me*w+Se)*4+ye,nt=(Me*w+Le)*4+ye;var Fe=z(ue,Se,p[He],Le,p[nt]);C[te+ye]=z(Pe,Ee,ht,Me,Fe)}},P=0;P<y;P++)for(var x=0;x<m;x++){var O=(P*m+x)*4,U=x*w/m,G=Math.floor(U),Z=Math.min(Math.ceil(U),w-1),X=P*E/y,W=Math.floor(X),J=Math.min(Math.ceil(X),E-1);A(O,0,U,G,Z,X,W,J),A(O,1,U,G,Z,X,W,J),A(O,2,U,G,Z,X,W,J),A(O,3,U,G,Z,X,W,J)}},_interpolate2D:function(S,D,w,E){for(var m=S.data,y=D.data,p=S.width,C=S.height,z=D.width,A=D.height,P=Math.max(1,Math.floor(p/z)),x=z*P,O=Math.max(1,Math.floor(C/A)),U=A*O,G=T.alloc(x*C*4),Z=0;Z<C;Z++)for(var X=0;X<x;X++)for(var W=X*(p-1)/x,J=Math.floor(W),re=W-J,te=(Z*p+J)*4,ye=(Z*x+X)*4,ue=0;ue<4;ue++){var Se=te+ue,Le=J>0?m[Se-4]:2*m[Se]-m[Se+4],Pe=m[Se],Ee=m[Se+4],Me=J<p-2?m[Se+8]:2*m[Se+4]-m[Se];G[ye+ue]=E(Le,Pe,Ee,Me,re)}for(var He=T.alloc(x*U*4),nt=0;nt<U;nt++)for(var ht=0;ht<x;ht++)for(var Fe=nt*(C-1)/U,Ce=Math.floor(Fe),Be=Fe-Ce,Ae=(Ce*x+ht)*4,se=(nt*x+ht)*4,pe=0;pe<4;pe++){var Ke=Ae+pe,_e=Ce>0?G[Ke-x*4]:2*G[Ke]-G[Ke+x*4],ke=G[Ke],qe=G[Ke+x*4],tt=Ce<C-2?G[Ke+x*8]:2*G[Ke+x*4]-G[Ke];He[se+pe]=E(_e,ke,qe,tt,Be)}var Ge=P*O;if(Ge>1)for(var We=0;We<A;We++)for(var Je=0;Je<z;Je++){for(var it=0,ze=0,de=0,ve=0,be=0,Oe=0;Oe<O;Oe++)for(var ge=We*O+Oe,le=0;le<P;le++){var et=Je*P+le,wt=(ge*x+et)*4,Ft=He[wt+3];Ft&&(it+=He[wt],ze+=He[wt+1],de+=He[wt+2],be++),ve+=Ft}var Wt=(We*z+Je)*4;y[Wt]=be?Math.round(it/be):0,y[Wt+1]=be?Math.round(ze/be):0,y[Wt+2]=be?Math.round(de/be):0,y[Wt+3]=Math.round(ve/Ge)}else D.data=He},bicubicInterpolation:function(S,D,w){var E=function(y,p,C,z,A){var P=z-C-y+p,x=y-p-P,O=C-y,U=p;return Math.max(0,Math.min(255,P*(A*A*A)+x*(A*A)+O*A+U))};return this._interpolate2D(S,D,w,E)},hermiteInterpolation:function(S,D,w){var E=function(y,p,C,z,A){var P=p,x=.5*(C-y),O=y-2.5*p+2*C-.5*z,U=.5*(z-y)+1.5*(p-C);return Math.max(0,Math.min(255,Math.round(((U*A+O)*A+x)*A+P)))};return this._interpolate2D(S,D,w,E)},bezierInterpolation:function(S,D,w){var E=function(y,p,C,z,A){var P=p+(C-y)/4,x=C-(z-p)/4,O=1-A,U=p*O*O*O,G=3*P*O*O*A,Z=3*x*O*A*A,X=C*A*A*A;return Math.max(0,Math.min(255,Math.round(U+G+Z+X)))};return this._interpolate2D(S,D,w,E)}}}).call(this,_("buffer").Buffer)},{buffer:48}],224:[function(_,k,b){(function(T){Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var t=_("@jimp/utils");function S(w,E){w%=360;var m=w*Math.PI/180,y=Math.cos(m),p=Math.sin(m),C=this.bitmap.width,z=this.bitmap.height;if(E===!0||typeof E=="string"){C=Math.ceil(Math.abs(this.bitmap.width*y)+Math.abs(this.bitmap.height*p))+1,z=Math.ceil(Math.abs(this.bitmap.width*p)+Math.abs(this.bitmap.height*y))+1,C%2!==0&&C++,z%2!==0&&z++;var A=this.cloneQuiet();this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(Ee,Me,He){this.bitmap.data.writeUInt32BE(this._background,He)});var P=Math.max(C,z,this.bitmap.width,this.bitmap.height);this.resize(P,P,E),this.blit(A,this.bitmap.width/2-A.bitmap.width/2,this.bitmap.height/2-A.bitmap.height/2)}var x=this.bitmap.width,O=this.bitmap.height,U=T.alloc(this.bitmap.data.length);function G(Ee,Me){return function(He,nt){return{x:He+Ee,y:nt+Me}}}for(var Z=G(-(x/2),-(O/2)),X=G(x/2+.5,O/2+.5),W=1;W<=O;W++)for(var J=1;J<=x;J++){var re=Z(J,W),te=X(y*re.x-p*re.y,y*re.y+p*re.x),ye=x*(W-1)+J-1<<2;if(te.x>=0&&te.x<x&&te.y>=0&&te.y<O){var ue=(x*(te.y|0)+te.x|0)<<2,Se=this.bitmap.data.readUInt32BE(ue);U.writeUInt32BE(Se,ye)}else U.writeUInt32BE(this._background,ye)}if(this.bitmap.data=U,E===!0||typeof E=="string"){var Le=x/2-C/2,Pe=O/2-z/2;this.crop(Le,Pe,C,z)}}var D=function(){return{rotate:function(m,y,p){return(typeof y>"u"||y===null)&&(y=!0),typeof y=="function"&&typeof p>"u"&&(p=y,y=!0),typeof m!="number"?t.throwError.call(this,"deg must be a number",p):typeof y!="boolean"&&typeof y!="string"?t.throwError.call(this,"mode must be a boolean or a string",p):(S.call(this,m,y,p),(0,t.isNodePattern)(p)&&p.call(this,null,this),this)}}};b.default=D,k.exports=b.default}).call(this,_("buffer").Buffer)},{"@jimp/utils":235,buffer:48}],225:[function(_,k,b){Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var T=_("@jimp/utils"),t=function(){return{scale:function(w,E,m){if(typeof w!="number")return T.throwError.call(this,"f must be a number",m);if(w<0)return T.throwError.call(this,"f must be a positive number",m);typeof E=="function"&&typeof m>"u"&&(m=E,E=null);var y=this.bitmap.width*w,p=this.bitmap.height*w;return this.resize(y,p,E),(0,T.isNodePattern)(m)&&m.call(this,null,this),this},scaleToFit:function(w,E,m,y){if(typeof w!="number"||typeof E!="number")return T.throwError.call(this,"w and h must be numbers",y);typeof m=="function"&&typeof y>"u"&&(y=m,m=null);var p=w/E>this.bitmap.width/this.bitmap.height?E/this.bitmap.height:w/this.bitmap.width;return this.scale(p,m),(0,T.isNodePattern)(y)&&y.call(this,null,this),this}}};b.default=t,k.exports=b.default},{"@jimp/utils":235}],226:[function(_,k,b){Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var T=_("@jimp/utils"),t=function(){return{shadow:function(){var w=this,E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},m=arguments.length>1?arguments[1]:void 0;typeof E=="function"&&(m=E,E={});var y=E,p=y.opacity,C=p===void 0?.7:p,z=y.size,A=z===void 0?1.1:z,P=y.x,x=P===void 0?-25:P,O=y.y,U=O===void 0?25:O,G=y.blur,Z=G===void 0?5:G,X=this.clone(),W=this.clone();return W.scan(0,0,W.bitmap.width,W.bitmap.height,function(J,re,te){W.bitmap.data[te]=0,W.bitmap.data[te+1]=0,W.bitmap.data[te+2]=0,W.bitmap.data[te+3]=W.constructor.limit255(W.bitmap.data[te+3]*C),w.bitmap.data[te]=0,w.bitmap.data[te+1]=0,w.bitmap.data[te+2]=0,w.bitmap.data[te+3]=0}),W.resize(W.bitmap.width*A,W.bitmap.height*A).blur(Z),this.composite(W,x,U),this.composite(X,0,0),(0,T.isNodePattern)(m)&&m.call(this,null,this),this}}};b.default=t,k.exports=b.default},{"@jimp/utils":235}],227:[function(_,k,b){Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var T=_("@jimp/utils"),t=function(){return{threshold:function(w,E){var m=this,y=w.max,p=w.replace,C=p===void 0?255:p,z=w.autoGreyscale,A=z===void 0?!0:z;return typeof y!="number"?T.throwError.call(this,"max must be a number",E):typeof C!="number"?T.throwError.call(this,"replace must be a number",E):typeof A!="boolean"?T.throwError.call(this,"autoGreyscale must be a boolean",E):(y=this.constructor.limit255(y),C=this.constructor.limit255(C),A&&this.greyscale(),this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(P,x,O){var U=m.bitmap.data[O]<y?m.bitmap.data[O]:C;m.bitmap.data[O]=U,m.bitmap.data[O+1]=U,m.bitmap.data[O+2]=U}),(0,T.isNodePattern)(E)&&E.call(this,null,this),this)}}};b.default=t,k.exports=b.default},{"@jimp/utils":235}],228:[function(_,k,b){var T=_("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var t=T(_("@babel/runtime/helpers/toConsumableArray")),S=_("timm"),D=T(_("@jimp/plugin-blit")),w=T(_("@jimp/plugin-blur")),E=T(_("@jimp/plugin-circle")),m=T(_("@jimp/plugin-color")),y=T(_("@jimp/plugin-contain")),p=T(_("@jimp/plugin-cover")),C=T(_("@jimp/plugin-crop")),z=T(_("@jimp/plugin-displace")),A=T(_("@jimp/plugin-dither")),P=T(_("@jimp/plugin-fisheye")),x=T(_("@jimp/plugin-flip")),O=T(_("@jimp/plugin-gaussian")),U=T(_("@jimp/plugin-invert")),G=T(_("@jimp/plugin-mask")),Z=T(_("@jimp/plugin-normalize")),X=T(_("@jimp/plugin-print")),W=T(_("@jimp/plugin-resize")),J=T(_("@jimp/plugin-rotate")),re=T(_("@jimp/plugin-scale")),te=T(_("@jimp/plugin-shadow")),ye=T(_("@jimp/plugin-threshold")),ue=[D.default,w.default,E.default,m.default,y.default,p.default,C.default,z.default,A.default,P.default,x.default,O.default,U.default,G.default,Z.default,X.default,W.default,J.default,re.default,te.default,ye.default],Se=function(Pe){var Ee=ue.map(function(Me){var He=Me(Pe)||{};return!He.class&&!He.constants&&(He={class:He}),He});return S.mergeDeep.apply(void 0,(0,t.default)(Ee))};b.default=Se,k.exports=b.default},{"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/helpers/toConsumableArray":20,"@jimp/plugin-blit":201,"@jimp/plugin-blur":203,"@jimp/plugin-circle":204,"@jimp/plugin-color":205,"@jimp/plugin-contain":206,"@jimp/plugin-cover":207,"@jimp/plugin-crop":208,"@jimp/plugin-displace":209,"@jimp/plugin-dither":210,"@jimp/plugin-fisheye":211,"@jimp/plugin-flip":212,"@jimp/plugin-gaussian":213,"@jimp/plugin-invert":214,"@jimp/plugin-mask":215,"@jimp/plugin-normalize":216,"@jimp/plugin-print":217,"@jimp/plugin-resize":221,"@jimp/plugin-rotate":224,"@jimp/plugin-scale":225,"@jimp/plugin-shadow":226,"@jimp/plugin-threshold":227,timm:177}],229:[function(_,k,b){var T=_("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var t=T(_("@babel/runtime/helpers/defineProperty")),S=T(_("bmp-js")),D=_("@jimp/utils"),w="image/bmp",E="image/x-ms-bmp";function m(A){return(0,D.scan)(A,0,0,A.bitmap.width,A.bitmap.height,function(P,x,O){var U=this.bitmap.data[O+0],G=this.bitmap.data[O+1],Z=this.bitmap.data[O+2],X=this.bitmap.data[O+3];this.bitmap.data[O+0]=X,this.bitmap.data[O+1]=Z,this.bitmap.data[O+2]=G,this.bitmap.data[O+3]=U}).bitmap}function y(A){return(0,D.scan)({bitmap:A},0,0,A.width,A.height,function(P,x,O){var U=this.bitmap.data[O+0],G=this.bitmap.data[O+1],Z=this.bitmap.data[O+2],X=this.bitmap.data[O+3];this.bitmap.data[O+0]=X,this.bitmap.data[O+1]=Z,this.bitmap.data[O+2]=G,this.bitmap.data[O+3]=A.is_with_alpha?U:255}).bitmap}var p=function(P){return y(S.default.decode(P))},C=function(P){return S.default.encode(m(P)).data},z=function(){var P,x;return{mime:(0,t.default)({},w,["bmp"]),constants:{MIME_BMP:w,MIME_X_MS_BMP:E},decoders:(P={},(0,t.default)(P,w,p),(0,t.default)(P,E,p),P),encoders:(x={},(0,t.default)(x,w,C),(0,t.default)(x,E,C),x)}};b.default=z,k.exports=b.default},{"@babel/runtime/helpers/defineProperty":7,"@babel/runtime/helpers/interopRequireDefault":11,"@jimp/utils":235,"bmp-js":30}],230:[function(_,k,b){(function(T){var t=_("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var S=t(_("@babel/runtime/helpers/defineProperty")),D=t(_("omggif")),w=_("gifwrap"),E="image/gif",m=function(){return{mime:(0,S.default)({},E,["gif"]),constants:{MIME_GIF:E},decoders:(0,S.default)({},E,function(p){var C=new D.default.GifReader(p),z=T.alloc(C.width*C.height*4);return C.decodeAndBlitFrameRGBA(0,z),{data:z,width:C.width,height:C.height}}),encoders:(0,S.default)({},E,function(p){var C=new w.BitmapImage(p.bitmap);w.GifUtil.quantizeDekker(C,256);var z=new w.GifFrame(C),A=new w.GifCodec;return A.encodeGif([z],{}).then(function(P){return P.buffer})})}};b.default=m,k.exports=b.default}).call(this,_("buffer").Buffer)},{"@babel/runtime/helpers/defineProperty":7,"@babel/runtime/helpers/interopRequireDefault":11,buffer:48,gifwrap:70,omggif:85}],231:[function(_,k,b){var T=_("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var t=T(_("@babel/runtime/helpers/defineProperty")),S=T(_("jpeg-js")),D=_("@jimp/utils"),w="image/jpeg",E=function(){return{mime:(0,t.default)({},w,["jpeg","jpg","jpe"]),constants:{MIME_JPEG:w},decoders:(0,t.default)({},w,S.default.decode),encoders:(0,t.default)({},w,function(y){return S.default.encode(y.bitmap,y._quality).data}),class:{_quality:100,quality:function(p,C){return typeof p!="number"?D.throwError.call(this,"n must be a number",C):p<0||p>100?D.throwError.call(this,"n must be a number 0 - 100",C):(this._quality=Math.round(p),(0,D.isNodePattern)(C)&&C.call(this,null,this),this)}}}};b.default=E,k.exports=b.default},{"@babel/runtime/helpers/defineProperty":7,"@babel/runtime/helpers/interopRequireDefault":11,"@jimp/utils":235,"jpeg-js":80}],232:[function(_,k,b){var T=_("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var t=T(_("@babel/runtime/helpers/defineProperty")),S=_("pngjs"),D=_("@jimp/utils"),w="image/png",E=-1,m=0,y=1,p=2,C=3,z=4,A=function(){return{mime:(0,t.default)({},w,["png"]),constants:{MIME_PNG:w,PNG_FILTER_AUTO:E,PNG_FILTER_NONE:m,PNG_FILTER_SUB:y,PNG_FILTER_UP:p,PNG_FILTER_AVERAGE:C,PNG_FILTER_PATH:z},hasAlpha:(0,t.default)({},w,!0),decoders:(0,t.default)({},w,S.PNG.sync.read),encoders:(0,t.default)({},w,function(x){var O=new S.PNG({width:x.bitmap.width,height:x.bitmap.height});return O.data=x.bitmap.data,S.PNG.sync.write(O,{width:x.bitmap.width,height:x.bitmap.height,deflateLevel:x._deflateLevel,deflateStrategy:x._deflateStrategy,filterType:x._filterType,colorType:typeof x._colorType=="number"?x._colorType:x._rgba?6:2,inputHasAlpha:x._rgba})}),class:{_deflateLevel:9,_deflateStrategy:3,_filterType:E,_colorType:null,deflateLevel:function(O,U){return typeof O!="number"?D.throwError.call(this,"l must be a number",U):O<0||O>9?D.throwError.call(this,"l must be a number 0 - 9",U):(this._deflateLevel=Math.round(O),(0,D.isNodePattern)(U)&&U.call(this,null,this),this)},deflateStrategy:function(O,U){return typeof O!="number"?D.throwError.call(this,"s must be a number",U):O<0||O>3?D.throwError.call(this,"s must be a number 0 - 3",U):(this._deflateStrategy=Math.round(O),(0,D.isNodePattern)(U)&&U.call(this,null,this),this)},filterType:function(O,U){return typeof O!="number"?D.throwError.call(this,"n must be a number",U):O<-1||O>4?D.throwError.call(this,"n must be -1 (auto) or a number 0 - 4",U):(this._filterType=Math.round(O),(0,D.isNodePattern)(U)&&U.call(this,null,this),this)},colorType:function(O,U){return typeof O!="number"?D.throwError.call(this,"s must be a number",U):O!==0&&O!==2&&O!==4&&O!==6?D.throwError.call(this,"s must be a number 0, 2, 4, 6.",U):(this._colorType=Math.round(O),(0,D.isNodePattern)(U)&&U.call(this,null,this),this)}}}};b.default=A,k.exports=b.default},{"@babel/runtime/helpers/defineProperty":7,"@babel/runtime/helpers/interopRequireDefault":11,"@jimp/utils":235,pngjs:129}],233:[function(_,k,b){(function(T){var t=_("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var S=t(_("@babel/runtime/helpers/defineProperty")),D=t(_("utif")),w="image/tiff",E=function(){return{mime:(0,S.default)({},w,["tiff","tif"]),constants:{MIME_TIFF:w},decoders:(0,S.default)({},w,function(y){var p=D.default.decode(y),C=p[0];D.default.decodeImages(y,p);var z=D.default.toRGBA8(C);return{data:T.from(z),width:C.t256[0],height:C.t257[0]}}),encoders:(0,S.default)({},w,function(y){var p=D.default.encodeImage(y.bitmap.data,y.bitmap.width,y.bitmap.height);return T.from(p)})}};b.default=E,k.exports=b.default}).call(this,_("buffer").Buffer)},{"@babel/runtime/helpers/defineProperty":7,"@babel/runtime/helpers/interopRequireDefault":11,buffer:48,utif:182}],234:[function(_,k,b){var T=_("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var t=_("timm"),S=T(_("@jimp/jpeg")),D=T(_("@jimp/png")),w=T(_("@jimp/bmp")),E=T(_("@jimp/tiff")),m=T(_("@jimp/gif")),y=function(){return(0,t.mergeDeep)((0,S.default)(),(0,D.default)(),(0,w.default)(),(0,E.default)(),(0,m.default)())};b.default=y,k.exports=b.default},{"@babel/runtime/helpers/interopRequireDefault":11,"@jimp/bmp":229,"@jimp/gif":230,"@jimp/jpeg":231,"@jimp/png":232,"@jimp/tiff":233,timm:177}],235:[function(_,k,b){var T=_("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(b,"__esModule",{value:!0}),b.isNodePattern=D,b.throwError=w,b.scan=E,b.scanIterator=m;var t=T(_("@babel/runtime/regenerator")),S=t.default.mark(m);function D(y){if(typeof y>"u")return!1;if(typeof y!="function")throw new TypeError("Callback must be a function");return!0}function w(y,p){if(typeof y=="string"&&(y=new Error(y)),typeof p=="function")return p.call(this,y);throw y}function E(y,p,C,z,A,P){p=Math.round(p),C=Math.round(C),z=Math.round(z),A=Math.round(A);for(var x=C;x<C+A;x++)for(var O=p;O<p+z;O++){var U=y.bitmap.width*x+O<<2;P.call(y,O,x,U)}return y}function m(y,p,C,z,A){var P,x,O;return t.default.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:p=Math.round(p),C=Math.round(C),z=Math.round(z),A=Math.round(A),P=C;case 5:if(!(P<C+A)){G.next=17;break}x=p;case 7:if(!(x<p+z)){G.next=14;break}return O=y.bitmap.width*P+x<<2,G.next=11,{x,y:P,idx:O,image:y};case 11:x++,G.next=7;break;case 14:P++,G.next=5;break;case 17:case"end":return G.stop()}},S)}},{"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/regenerator":22}]},{},[200])(200)})})(qE);var WE=qE.exports;function Sy(a,h){this.x=a||0,this.y=h||0}Sy.prototype={copy:function(){return new Sy(this.x,this.y)}};var Jp=Sy,Uy=Jp,Lp={};function aI(a){return Lp[a]||(Lp[a]=new RegExp(" "+a+'="((?:\\\\(?=")"|[^"])+)"',"i")),Lp[a]}function oI(a,h,v){var _=" "+h+'="'+v+'"';return a.indexOf(" "+h+'="')===-1?a=a.replace(/<[a-z]+/i,function(k){return k+_}):a=a.replace(aI(h),_),a}function Qa(a){return a.toFixed(3).replace(".000","")}function sI(a,h){return a>=h?a%h:a>=0?a:h-1-(-1-a)%h}function lI(a,h){return a.x*h.y-a.y*h.x}function uI(a,h,v){return a<=v?a<=h&&h<v:a<=h||h<v}function My(a){return a>0?1:a<0?-1:0}function cI(a,h){var v=new Array(3),_,k,b;for(v[0]=h.x,v[1]=h.y,v[2]=1,b=0,_=0;_<3;_++)for(k=0;k<3;k++)b+=v[_]*a.at(_,k)*v[k];return b}function hI(a,h,v){var _=new Uy;return _.x=h.x+a*(v.x-h.x),_.y=h.y+a*(v.y-h.y),_}function $E(a,h){var v=new Uy;return v.y=My(h.x-a.x),v.x=-My(h.y-a.y),v}function fI(a,h){var v=$E(a,h);return v.y*(h.x-a.x)-v.x*(h.y-a.y)}function dI(a,h,v){var _,k,b,T;return _=h.x-a.x,k=h.y-a.y,b=v.x-a.x,T=v.y-a.y,_*T-b*k}function Op(a,h,v,_){var k,b,T,t;return k=h.x-a.x,b=h.y-a.y,T=_.x-v.x,t=_.y-v.y,k*t-T*b}function pI(a,h,v){var _,k,b,T;return _=h.x-a.x,k=h.y-a.y,b=v.x-a.x,T=v.y-a.y,_*b+k*T}function mI(a,h,v,_){var k,b,T,t;return k=h.x-a.x,b=h.y-a.y,T=_.x-v.x,t=_.y-v.y,k*T+b*t}function _I(a,h){return Math.sqrt((a.x-h.x)*(a.x-h.x)+(a.y-h.y)*(a.y-h.y))}var Qp={luminance:function(a,h,v){return Math.round(.2126*a+.7153*h+.0721*v)},between:function(a,h,v){return a>=h&&a<=v},clamp:function(a,h,v){return Math.min(v,Math.max(h,a))},isNumber:function(a){return typeof a=="number"},setHtmlAttr:oI,renderCurve:function(a,h){h=h||{x:1,y:1};var v=a.c[(a.n-1)*3+2],_=["M "+Qa(v.x*h.x)+" "+Qa(v.y*h.y)];return a.tag.forEach(function(k,b){var T=b*3,t=a.c[T],S=a.c[T+1],D=a.c[T+2];k==="CURVE"?_.push("C "+Qa(t.x*h.x)+" "+Qa(t.y*h.y)+", "+Qa(S.x*h.x)+" "+Qa(S.y*h.y)+", "+Qa(D.x*h.x)+" "+Qa(D.y*h.y)):k==="CORNER"&&_.push("L "+Qa(S.x*h.x)+" "+Qa(S.y*h.y)+" "+Qa(D.x*h.x)+" "+Qa(D.y*h.y))}),_.join(" ")},bezier:function(h,v,_,k,b){var T=1-h,t=new Uy;return t.x=T*T*T*v.x+3*(T*T*h)*_.x+3*(h*h*T)*k.x+h*h*h*b.x,t.y=T*T*T*v.y+3*(T*T*h)*_.y+3*(h*h*T)*k.y+h*h*h*b.y,t},tangent:function(h,v,_,k,b,T){var t,S,D,w,E,m,y,p,C,z;return t=Op(h,v,b,T),S=Op(v,_,b,T),D=Op(_,k,b,T),w=t-2*S+D,E=-2*t+2*S,m=t,y=E*E-4*w*m,w===0||y<0?-1:(p=Math.sqrt(y),C=(-E+p)/(2*w),z=(-E-p)/(2*w),C>=0&&C<=1?C:z>=0&&z<=1?z:-1)},mod:sI,xprod:lI,cyclic:uI,sign:My,quadform:cI,interval:hI,dorth_infty:$E,ddenom:fI,dpara:dI,cprod:Op,iprod:pI,iprod1:mI,ddist:_I},pg,Zx;function Xx(){if(Zx)return pg;Zx=1;var a=Qp,h=null;try{h=WE}catch{}var v=ZE(),_=256,k=_-1;function b(S,D){return _*S+D}function T(S,D){if(S=typeof S=="number"?a.clamp(Math.round(S),0,k):0,D=typeof D=="number"?a.clamp(Math.round(D),0,k):k,S>D)throw new Error('Invalid range "'+S+"..."+D+'"');return[S,D]}function t(S,D){if(this.data=null,this.pixels=0,this._sortedIndexes=null,this._cachedStats={},this._lookupTableH=null,typeof S=="number")this._createArray(S);else if(S instanceof v)this._collectValuesBitmap(S);else if(h&&S instanceof h)this._collectValuesJimp(S,D);else throw new Error("Unsupported image source")}return t.MODE_LUMINANCE="luminance",t.MODE_R="r",t.MODE_G="g",t.MODE_B="b",t.prototype={_createArray:function(S){var D=S<=Math.pow(2,8)?Uint8Array:S<=Math.pow(2,16)?Uint16Array:Uint32Array;return this.pixels=S,this.data=new D(_)},_collectValuesJimp:function(S,D){var w=S.bitmap.data,E=this._createArray(S.bitmap.width*S.bitmap.height);S.scan(0,0,S.bitmap.width,S.bitmap.height,function(m,y,p){var C=D===t.MODE_R?w[p]:D===t.MODE_G?w[p+1]:D===t.MODE_B?w[p+2]:a.luminance(w[p],w[p+1],w[p+2]);E[C]++})},_collectValuesBitmap:function(S){for(var D=this._createArray(S.size),w=S.data.length,E,m=0;m<w;m++)E=S.data[m],D[E]++},_getSortedIndexes:function(S){if(!S&&this._sortedIndexes)return this._sortedIndexes;var D=this.data,w=new Array(_),E=0;for(E;E<_;E++)w[E]=E;return w.sort(function(m,y){return D[m]>D[y]?1:D[m]<D[y]?-1:0}),this._sortedIndexes=w,w},_thresholdingBuildLookupTable:function(){var S=new Float64Array(_*_),D=new Float64Array(_*_),w=new Float64Array(_*_),E=this.pixels,m,y,p,C;for(m=1;m<_;++m)p=b(m,m),C=this.data[m]/E,S[p]=C,D[p]=m*C;for(m=1;m<_-1;++m)C=this.data[m+1]/E,p=b(1,m),S[p+1]=S[p]+C,D[p+1]=D[p]+(m+1)*C;for(m=2;m<_;m++)for(y=m+1;y<_;y++)S[b(m,y)]=S[b(1,y)]-S[b(1,m-1)],D[b(m,y)]=D[b(1,y)]-D[b(1,m-1)];for(m=1;m<_;++m)for(y=m+1;y<_;y++)p=b(m,y),w[p]=S[p]!==0?D[p]*D[p]/S[p]:0;return this._lookupTableH=w},multilevelThresholding:function(S,D,w){if(D=T(D,w),w=D[1],D=D[0],S=Math.min(w-D-2,~~S),S<1)return[];this._lookupTableH||this._thresholdingBuildLookupTable();var E=this._lookupTableH,m=null,y=0;S>4&&console.log("[Warning]: Threshold computation for more than 5 levels may take a long time");function p(C,z,A,P){C=(C||0)+1,z=z||0,A=A||new Array(S),P=P||0;for(var x=P+1,O,U=C;U<w-S+P;U++)O=z+E[b(C,U)],A[x-1]=U,x+1<S+1?p(U,O,A,x):(O+=E[b(U+1,w)],y<O&&(y=O,m=A.slice()))}return p(D||0),m||[]},autoThreshold:function(S,D){var w=this.multilevelThresholding(1,S,D);return w.length?w[0]:null},getDominantColor:function(S,D,w){S=T(S,D),D=S[1],S=S[0],w=w||1;var E=this.data,m=-1,y=-1,p,C,z;if(S===D)return E[S]?S:-1;for(p=S;p<=D;p++){for(z=0,C=~~(w/-2);C<w;C++)z+=a.between(p+C,0,k)?E[p+C]:0;var A=z>y,P=y===z&&(m<0||E[p]>E[m]);(A||P)&&(m=p,y=z)}return y<=0?-1:m},getStats:function(S,D,w){if(S=T(S,D),D=S[1],S=S[0],!w&&this._cachedStats[S+"-"+D])return this._cachedStats[S+"-"+D];var E=this.data,m=this._getSortedIndexes(),y=0,p=null,C,z,A,P,x=0,O=0,U=0,G,Z,X,W=0,J=0;for(G=S;G<=D;G++)y+=E[G],U+=E[G]*G,W+=E[G]===0?0:1,J<E[G]&&(J=E[G]);for(C=U/y,A=y/(D-S),P=y/W,z=Math.floor(y/2),G=0;G<_;G++)X=m[G],Z=E[X],!(X<S||X>D)&&(O+=Z,x+=Math.pow(X-C,2)*Z,p===null&&O>=z&&(p=X));return this._cachedStats[S+"-"+D]={levels:{mean:C,median:p,stdDev:Math.sqrt(x/y),unique:W},pixelsPerLevel:{mean:A,median:P,peak:J},pixels:y}}},pg=t,pg}var mg,Yx;function ZE(){if(Yx)return mg;Yx=1;var a=Jp,h=Qp;function v(_,k){this._histogram=null,this.width=_,this.height=k,this.size=_*k,this.arrayBuffer=new ArrayBuffer(this.size),this.data=new Uint8Array(this.arrayBuffer)}return mg=v,Xx(),v.prototype={getValueAt:function(_,k){var b=typeof _=="number"&&typeof k!="number"?_:this.pointToIndex(_,k);return this.data[b]},indexToPoint:function(_){var k=new a;return h.between(_,0,this.size)?(k.y=Math.floor(_/this.width),k.x=_-k.y*this.width):(k.x=-1,k.y=-1),k},pointToIndex:function(_,k){var b=_,T=k;return _ instanceof a&&(b=_.x,T=_.y),!h.between(b,0,this.width)||!h.between(T,0,this.height)?-1:this.width*T+b},copy:function(_){var k=new v(this.width,this.height),b=typeof _=="function",T;for(T=0;T<this.size;T++)k.data[T]=b?_(this.data[T],T):this.data[T];return k},histogram:function(){var _=Xx();return this._histogram?this._histogram:(this._histogram=new _(this),this._histogram)}},mg}function gI(a){this.n=a,this.tag=new Array(a),this.c=new Array(a*3),this.alphaCurve=0,this.vertex=new Array(a),this.alpha=new Array(a),this.alpha0=new Array(a),this.beta=new Array(a)}var yI=gI;function vI(){this.area=0,this.len=0,this.curve={},this.pt=[],this.minX=1e5,this.minY=1e5,this.maxX=-1,this.maxY=-1}var bI=vI;function XE(){this.data=[0,0,0,0,0,0,0,0,0]}XE.prototype.at=function(a,h){return this.data[a*3+h]};var xI=XE;function wI(a,h,v,_,k){this.x=a,this.y=h,this.xy=v,this.x2=_,this.y2=k}var EI=wI,Kx=Jp;function TI(){this.pen=0,this.c=[new Kx,new Kx],this.t=0,this.s=0,this.alpha=0}var SI=TI,Jx=WE,MI=ZE(),Qx=yI,qa=Jp,AI=bI,ew=xI,tw=EI,rw=SI,Nr=Qp;function bn(a){this._luminanceData=null,this._pathlist=[],this._imageLoadingIdentifier=null,this._imageLoaded=!1,this._processed=!1,this._params={turnPolicy:bn.TURNPOLICY_MINORITY,turdSize:2,alphaMax:1,optCurve:!0,optTolerance:.2,threshold:bn.THRESHOLD_AUTO,blackOnWhite:!0,color:bn.COLOR_AUTO,background:bn.COLOR_TRANSPARENT,width:null,height:null},a&&this.setParameters(a)}bn.COLOR_AUTO="auto";bn.COLOR_TRANSPARENT="transparent";bn.THRESHOLD_AUTO=-1;bn.TURNPOLICY_BLACK="black";bn.TURNPOLICY_WHITE="white";bn.TURNPOLICY_LEFT="left";bn.TURNPOLICY_RIGHT="right";bn.TURNPOLICY_MINORITY="minority";bn.TURNPOLICY_MAJORITY="majority";var iw=[bn.TURNPOLICY_BLACK,bn.TURNPOLICY_WHITE,bn.TURNPOLICY_LEFT,bn.TURNPOLICY_RIGHT,bn.TURNPOLICY_MINORITY,bn.TURNPOLICY_MAJORITY];bn.prototype={_bmToPathlist:function(){var a=this,h=this._params.threshold,v=this._params.blackOnWhite,_,k=new qa(0,0),b;h===bn.THRESHOLD_AUTO&&(h=this._luminanceData.histogram().autoThreshold()||128),_=this._luminanceData.copy(function(w){var E=v?w>h:w<h;return E?0:1});function T(w){for(var E=_.pointToIndex(w);E<_.size&&_.data[E]!==1;)E++;return E<_.size&&_.indexToPoint(E)}function t(w,E){var m,y,p;for(m=2;m<5;m++){for(p=0,y=-m+1;y<=m-1;y++)p+=_.getValueAt(w+y,E+m-1)?1:-1,p+=_.getValueAt(w+m-1,E+y-1)?1:-1,p+=_.getValueAt(w+y-1,E-m)?1:-1,p+=_.getValueAt(w-m,E+y)?1:-1;if(p>0)return 1;if(p<0)return 0}return 0}function S(w){var E=new AI,m=w.x,y=w.y,p=0,C=1,z;for(E.sign=_.getValueAt(w.x,w.y)?"+":"-";E.pt.push(new qa(m,y)),m>E.maxX&&(E.maxX=m),m<E.minX&&(E.minX=m),y>E.maxY&&(E.maxY=y),y<E.minY&&(E.minY=y),E.len++,m+=p,y+=C,E.area-=m*C,!(m===w.x&&y===w.y);){var A=_.getValueAt(m+(p+C-1)/2,y+(C-p-1)/2),P=_.getValueAt(m+(p-C-1)/2,y+(C+p-1)/2);P&&!A?a._params.turnPolicy==="right"||a._params.turnPolicy==="black"&&E.sign==="+"||a._params.turnPolicy==="white"&&E.sign==="-"||a._params.turnPolicy==="majority"&&t(m,y)||a._params.turnPolicy==="minority"&&!t(m,y)?(z=p,p=-C,C=z):(z=p,p=C,C=-z):P?(z=p,p=-C,C=z):A||(z=p,p=C,C=-z)}return E}function D(w){var E=w.pt[0].y,m=w.len,y,p,C,z,A,P,x;for(A=1;A<m;A++)if(y=w.pt[A].x,p=w.pt[A].y,p!==E){for(z=E<p?E:p,C=w.maxX,P=y;P<C;P++)x=_.pointToIndex(P,z),_.data[x]=_.data[x]?0:1;E=p}}for(this._pathlist=[];k=T(k);)b=S(k),D(b),b.area>a._params.turdSize&&this._pathlist.push(b)},_processPath:function(){var a=this;function h(w){var E,m,y;w.x0=w.pt[0].x,w.y0=w.pt[0].y,w.sums=[];var p=w.sums;for(p.push(new tw(0,0,0,0,0)),E=0;E<w.len;E++)m=w.pt[E].x-w.x0,y=w.pt[E].y-w.y0,p.push(new tw(p[E].x+m,p[E].y+y,p[E].xy+m*y,p[E].x2+m*m,p[E].y2+y*y))}function v(w){var E=w.len,m=w.pt,y,p=new Array(E),C=new Array(E),z=new Array(4);w.lon=new Array(E);var A=[new qa,new qa],P=new qa,x=new qa,O=new qa,U,G,Z,X,W,J,re,te,ye=0;for(G=E-1;G>=0;G--)m[G].x!=m[ye].x&&m[G].y!=m[ye].y&&(ye=G+1),C[G]=ye;for(G=E-1;G>=0;G--){for(z[0]=z[1]=z[2]=z[3]=0,y=(3+3*(m[Nr.mod(G+1,E)].x-m[G].x)+(m[Nr.mod(G+1,E)].y-m[G].y))/2,z[y]++,A[0].x=0,A[0].y=0,A[1].x=0,A[1].y=0,ye=C[G],X=G;;){if(U=0,y=(3+3*Nr.sign(m[ye].x-m[X].x)+Nr.sign(m[ye].y-m[X].y))/2,z[y]++,z[0]&&z[1]&&z[2]&&z[3]){p[G]=X,U=1;break}if(P.x=m[ye].x-m[G].x,P.y=m[ye].y-m[G].y,Nr.xprod(A[0],P)<0||Nr.xprod(A[1],P)>0||(Math.abs(P.x)<=1&&Math.abs(P.y)<=1||(x.x=P.x+(P.y>=0&&(P.y>0||P.x<0)?1:-1),x.y=P.y+(P.x<=0&&(P.x<0||P.y<0)?1:-1),Nr.xprod(A[0],x)>=0&&(A[0].x=x.x,A[0].y=x.y),x.x=P.x+(P.y<=0&&(P.y<0||P.x<0)?1:-1),x.y=P.y+(P.x>=0&&(P.x>0||P.y<0)?1:-1),Nr.xprod(A[1],x)<=0&&(A[1].x=x.x,A[1].y=x.y)),X=ye,ye=C[X],!Nr.cyclic(ye,G,X)))break}U===0&&(O.x=Nr.sign(m[ye].x-m[X].x),O.y=Nr.sign(m[ye].y-m[X].y),P.x=m[X].x-m[G].x,P.y=m[X].y-m[G].y,W=Nr.xprod(A[0],P),J=Nr.xprod(A[0],O),re=Nr.xprod(A[1],P),te=Nr.xprod(A[1],O),Z=1e7,J<0&&(Z=Math.floor(W/-J)),te>0&&(Z=Math.min(Z,Math.floor(-re/te))),p[G]=Nr.mod(X+Z,E))}for(Z=p[E-1],w.lon[E-1]=Z,G=E-2;G>=0;G--)Nr.cyclic(G+1,p[G],Z)&&(Z=p[G]),w.lon[G]=Z;for(G=E-1;Nr.cyclic(Nr.mod(G+1,E),Z,w.lon[G]);G--)w.lon[G]=Z}function _(w){function E(J,re,te){var ye=J.len,ue=J.pt,Se=J.sums,Le,Pe,Ee,Me,He,nt,ht,Fe,Ce,Be,Ae,se,pe,Ke,_e=0;return te>=ye&&(te-=ye,_e=1),_e===0?(Le=Se[te+1].x-Se[re].x,Pe=Se[te+1].y-Se[re].y,Me=Se[te+1].x2-Se[re].x2,Ee=Se[te+1].xy-Se[re].xy,He=Se[te+1].y2-Se[re].y2,nt=te+1-re):(Le=Se[te+1].x-Se[re].x+Se[ye].x,Pe=Se[te+1].y-Se[re].y+Se[ye].y,Me=Se[te+1].x2-Se[re].x2+Se[ye].x2,Ee=Se[te+1].xy-Se[re].xy+Se[ye].xy,He=Se[te+1].y2-Se[re].y2+Se[ye].y2,nt=te+1-re+ye),Ae=(ue[re].x+ue[te].x)/2-ue[0].x,se=(ue[re].y+ue[te].y)/2-ue[0].y,Ke=ue[te].x-ue[re].x,pe=-(ue[te].y-ue[re].y),ht=(Me-2*Le*Ae)/nt+Ae*Ae,Fe=(Ee-Le*se-Pe*Ae)/nt+Ae*se,Ce=(He-2*Pe*se)/nt+se*se,Be=pe*pe*ht+2*pe*Ke*Fe+Ke*Ke*Ce,Math.sqrt(Be)}var m,y,p,C,z=w.len,A=new Array(z+1),P=new Array(z+1),x=new Array(z),O=new Array(z+1),U=new Array(z+1),G=new Array(z+1),Z,X,W;for(m=0;m<z;m++)W=Nr.mod(w.lon[Nr.mod(m-1,z)]-1,z),W==m&&(W=Nr.mod(m+1,z)),W<m?x[m]=z:x[m]=W;for(y=1,m=0;m<z;m++)for(;y<=x[m];)O[y]=m,y++;for(m=0,y=0;m<z;y++)U[y]=m,m=x[m];for(U[y]=z,p=y,m=z,y=p;y>0;y--)G[y]=m,m=O[m];for(G[0]=0,A[0]=0,y=1;y<=p;y++)for(m=G[y];m<=U[y];m++){for(X=-1,C=U[y-1];C>=O[m];C--)Z=E(w,C,m)+A[C],(X<0||Z<X)&&(P[m]=C,X=Z);A[m]=X}for(w.m=p,w.po=new Array(p),m=z,y=p-1;m>0;y--)m=P[m],w.po[y]=m}function k(w){function E(ht,Fe,Ce,Be,Ae){for(var se=ht.len,pe=ht.sums,Ke,_e,ke,qe,tt,Ge,We,Je,it,ze,de,ve=0;Ce>=se;)Ce-=se,ve+=1;for(;Fe>=se;)Fe-=se,ve-=1;for(;Ce<0;)Ce+=se,ve-=1;for(;Fe<0;)Fe+=se,ve+=1;Ke=pe[Ce+1].x-pe[Fe].x+ve*pe[se].x,_e=pe[Ce+1].y-pe[Fe].y+ve*pe[se].y,ke=pe[Ce+1].x2-pe[Fe].x2+ve*pe[se].x2,qe=pe[Ce+1].xy-pe[Fe].xy+ve*pe[se].xy,tt=pe[Ce+1].y2-pe[Fe].y2+ve*pe[se].y2,Ge=Ce+1-Fe+ve*se,Be.x=Ke/Ge,Be.y=_e/Ge,We=(ke-Ke*Ke/Ge)/Ge,Je=(qe-Ke*_e/Ge)/Ge,it=(tt-_e*_e/Ge)/Ge,ze=(We+it+Math.sqrt((We-it)*(We-it)+4*Je*Je))/2,We-=ze,it-=ze,Math.abs(We)>=Math.abs(it)?(de=Math.sqrt(We*We+Je*Je),de!==0&&(Ae.x=-Je/de,Ae.y=We/de)):(de=Math.sqrt(it*it+Je*Je),de!==0&&(Ae.x=-it/de,Ae.y=Je/de)),de===0&&(Ae.x=Ae.y=0)}var m=w.m,y=w.po,p=w.len,C=w.pt,z=w.x0,A=w.y0,P=new Array(m),x=new Array(m),O=new Array(m),U=new Array(3),G,Z,X,W,J,re=new qa;for(w.curve=new Qx(m),Z=0;Z<m;Z++)X=y[Nr.mod(Z+1,m)],X=Nr.mod(X-y[Z],p)+y[Z],P[Z]=new qa,x[Z]=new qa,E(w,y[Z],X,P[Z],x[Z]);for(Z=0;Z<m;Z++)if(O[Z]=new ew,G=x[Z].x*x[Z].x+x[Z].y*x[Z].y,G===0)for(X=0;X<3;X++)for(W=0;W<3;W++)O[Z].data[X*3+W]=0;else for(U[0]=x[Z].y,U[1]=-x[Z].x,U[2]=-U[1]*P[Z].y-U[0]*P[Z].x,J=0;J<3;J++)for(W=0;W<3;W++)O[Z].data[J*3+W]=U[J]*U[W]/G;var te,ye,ue,Se,Le,Pe,Ee,Me,He,nt;for(Z=0;Z<m;Z++){for(te=new ew,ye=new qa,re.x=C[y[Z]].x-z,re.y=C[y[Z]].y-A,X=Nr.mod(Z-1,m),J=0;J<3;J++)for(W=0;W<3;W++)te.data[J*3+W]=O[X].at(J,W)+O[Z].at(J,W);for(;;){if(Le=te.at(0,0)*te.at(1,1)-te.at(0,1)*te.at(1,0),Le!==0){ye.x=(-te.at(0,2)*te.at(1,1)+te.at(1,2)*te.at(0,1))/Le,ye.y=(te.at(0,2)*te.at(1,0)-te.at(1,2)*te.at(0,0))/Le;break}for(te.at(0,0)>te.at(1,1)?(U[0]=-te.at(0,1),U[1]=te.at(0,0)):te.at(1,1)?(U[0]=-te.at(1,1),U[1]=te.at(1,0)):(U[0]=1,U[1]=0),G=U[0]*U[0]+U[1]*U[1],U[2]=-U[1]*re.y-U[0]*re.x,J=0;J<3;J++)for(W=0;W<3;W++)te.data[J*3+W]+=U[J]*U[W]/G}if(ue=Math.abs(ye.x-re.x),Se=Math.abs(ye.y-re.y),ue<=.5&&Se<=.5){w.curve.vertex[Z]=new qa(ye.x+z,ye.y+A);continue}if(Pe=Nr.quadform(te,re),Me=re.x,He=re.y,te.at(0,0)!==0)for(nt=0;nt<2;nt++)ye.y=re.y-.5+nt,ye.x=-(te.at(0,1)*ye.y+te.at(0,2))/te.at(0,0),ue=Math.abs(ye.x-re.x),Ee=Nr.quadform(te,ye),ue<=.5&&Ee<Pe&&(Pe=Ee,Me=ye.x,He=ye.y);if(te.at(1,1)!==0)for(nt=0;nt<2;nt++)ye.x=re.x-.5+nt,ye.y=-(te.at(1,0)*ye.x+te.at(1,2))/te.at(1,1),Se=Math.abs(ye.y-re.y),Ee=Nr.quadform(te,ye),Se<=.5&&Ee<Pe&&(Pe=Ee,Me=ye.x,He=ye.y);for(J=0;J<2;J++)for(W=0;W<2;W++)ye.x=re.x-.5+J,ye.y=re.y-.5+W,Ee=Nr.quadform(te,ye),Ee<Pe&&(Pe=Ee,Me=ye.x,He=ye.y);w.curve.vertex[Z]=new qa(Me+z,He+A)}}function b(w){var E=w.curve,m=E.n,y=E.vertex,p,C,z;for(p=0,C=m-1;p<C;p++,C--)z=y[p],y[p]=y[C],y[C]=z}function T(w){var E=w.curve.n,m=w.curve,y,p,C,z,A,P,x,O,U;for(y=0;y<E;y++)p=Nr.mod(y+1,E),C=Nr.mod(y+2,E),U=Nr.interval(1/2,m.vertex[C],m.vertex[p]),A=Nr.ddenom(m.vertex[y],m.vertex[C]),A!==0?(z=Nr.dpara(m.vertex[y],m.vertex[p],m.vertex[C])/A,z=Math.abs(z),P=z>1?1-1/z:0,P=P/.75):P=4/3,m.alpha0[p]=P,P>=a._params.alphaMax?(m.tag[p]="CORNER",m.c[3*p+1]=m.vertex[p],m.c[3*p+2]=U):(P<.55?P=.55:P>1&&(P=1),x=Nr.interval(.5+.5*P,m.vertex[y],m.vertex[p]),O=Nr.interval(.5+.5*P,m.vertex[C],m.vertex[p]),m.tag[p]="CURVE",m.c[3*p+0]=x,m.c[3*p+1]=O,m.c[3*p+2]=U),m.alpha[p]=P,m.beta[p]=.5;m.alphaCurve=1}function t(w){function E(Pe,Ee,Me,He,nt,ht,Fe){var Ce=Pe.curve.n,Be=Pe.curve,Ae=Be.vertex,se,pe,Ke,_e,ke,qe,tt,Ge,We,Je,it,ze,de,ve,be,Oe,ge,le,et,wt,Ft,Wt,or;if(Ee==Me||(se=Ee,ke=Nr.mod(Ee+1,Ce),pe=Nr.mod(se+1,Ce),_e=ht[pe],_e===0))return 1;for(Ge=Nr.ddist(Ae[Ee],Ae[ke]),se=pe;se!=Me;se=pe)if(pe=Nr.mod(se+1,Ce),Ke=Nr.mod(se+2,Ce),ht[pe]!=_e||Nr.sign(Nr.cprod(Ae[Ee],Ae[ke],Ae[pe],Ae[Ke]))!=_e||Nr.iprod1(Ae[Ee],Ae[ke],Ae[pe],Ae[Ke])<Ge*Nr.ddist(Ae[pe],Ae[Ke])*-.999847695156)return 1;if(it=Be.c[Nr.mod(Ee,Ce)*3+2].copy(),ze=Ae[Nr.mod(Ee+1,Ce)].copy(),de=Ae[Nr.mod(Me,Ce)].copy(),ve=Be.c[Nr.mod(Me,Ce)*3+2].copy(),qe=Fe[Me]-Fe[Ee],qe-=Nr.dpara(Ae[0],Be.c[Ee*3+2],Be.c[Me*3+2])/2,Ee>=Me&&(qe+=Fe[Ce]),le=Nr.dpara(it,ze,de),et=Nr.dpara(it,ze,ve),wt=Nr.dpara(it,de,ve),Ft=le+wt-et,et==le||(or=wt/(wt-Ft),Wt=et/(et-le),Oe=et*or/2,Oe===0))return 1;for(ge=qe/Oe,tt=2-Math.sqrt(4-ge/.3),He.c[0]=Nr.interval(or*tt,it,ze),He.c[1]=Nr.interval(Wt*tt,ve,de),He.alpha=tt,He.t=or,He.s=Wt,ze=He.c[0].copy(),de=He.c[1].copy(),He.pen=0,se=Nr.mod(Ee+1,Ce);se!=Me;se=pe){if(pe=Nr.mod(se+1,Ce),or=Nr.tangent(it,ze,de,ve,Ae[se],Ae[pe]),or<-.5||(be=Nr.bezier(or,it,ze,de,ve),Ge=Nr.ddist(Ae[se],Ae[pe]),Ge===0)||(We=Nr.dpara(Ae[se],Ae[pe],be)/Ge,Math.abs(We)>nt)||Nr.iprod(Ae[se],Ae[pe],be)<0||Nr.iprod(Ae[pe],Ae[se],be)<0)return 1;He.pen+=We*We}for(se=Ee;se!=Me;se=pe){if(pe=Nr.mod(se+1,Ce),or=Nr.tangent(it,ze,de,ve,Be.c[se*3+2],Be.c[pe*3+2]),or<-.5||(be=Nr.bezier(or,it,ze,de,ve),Ge=Nr.ddist(Be.c[se*3+2],Be.c[pe*3+2]),Ge===0)||(We=Nr.dpara(Be.c[se*3+2],Be.c[pe*3+2],be)/Ge,Je=Nr.dpara(Be.c[se*3+2],Be.c[pe*3+2],Ae[pe])/Ge,Je*=.75*Be.alpha[pe],Je<0&&(We=-We,Je=-Je),We<Je-nt))return 1;We<Je&&(He.pen+=(We-Je)*(We-Je))}return 0}var m=w.curve,y=m.n,p=m.vertex,C=new Array(y+1),z=new Array(y+1),A=new Array(y+1),P=new Array(y+1),x,O,U,G,Z=new rw,X,W,J,re,te,ye,ue,Se=new Array(y),Le=new Array(y+1);for(O=0;O<y;O++)m.tag[O]=="CURVE"?Se[O]=Nr.sign(Nr.dpara(p[Nr.mod(O-1,y)],p[O],p[Nr.mod(O+1,y)])):Se[O]=0;for(J=0,Le[0]=0,X=m.vertex[0],O=0;O<y;O++)W=Nr.mod(O+1,y),m.tag[W]=="CURVE"&&(re=m.alpha[W],J+=.3*re*(4-re)*Nr.dpara(m.c[O*3+2],p[W],m.c[W*3+2])/2,J+=Nr.dpara(X,m.c[O*3+2],m.c[W*3+2])/2),Le[O+1]=J;for(C[0]=-1,z[0]=0,A[0]=0,U=1;U<=y;U++)for(C[U]=U-1,z[U]=z[U-1],A[U]=A[U-1]+1,O=U-2;O>=0&&(G=E(w,O,Nr.mod(U,y),Z,a._params.optTolerance,Se,Le),!G);O--)(A[U]>A[O]+1||A[U]==A[O]+1&&z[U]>z[O]+Z.pen)&&(C[U]=O,z[U]=z[O]+Z.pen,A[U]=A[O]+1,P[U]=Z,Z=new rw);for(x=A[y],te=new Qx(x),ye=new Array(x),ue=new Array(x),U=y,O=x-1;O>=0;O--)C[U]==U-1?(te.tag[O]=m.tag[Nr.mod(U,y)],te.c[O*3+0]=m.c[Nr.mod(U,y)*3+0],te.c[O*3+1]=m.c[Nr.mod(U,y)*3+1],te.c[O*3+2]=m.c[Nr.mod(U,y)*3+2],te.vertex[O]=m.vertex[Nr.mod(U,y)],te.alpha[O]=m.alpha[Nr.mod(U,y)],te.alpha0[O]=m.alpha0[Nr.mod(U,y)],te.beta[O]=m.beta[Nr.mod(U,y)],ye[O]=ue[O]=1):(te.tag[O]="CURVE",te.c[O*3+0]=P[U].c[0],te.c[O*3+1]=P[U].c[1],te.c[O*3+2]=m.c[Nr.mod(U,y)*3+2],te.vertex[O]=Nr.interval(P[U].s,m.c[Nr.mod(U,y)*3+2],p[Nr.mod(U,y)]),te.alpha[O]=P[U].alpha,te.alpha0[O]=P[U].alpha,ye[O]=P[U].s,ue[O]=P[U].t),U=C[U];for(O=0;O<x;O++)W=Nr.mod(O+1,x),te.beta[O]=ye[O]/(ye[O]+ue[W]);te.alphaCurve=1,w.curve=te}for(var S=0;S<this._pathlist.length;S++){var D=this._pathlist[S];h(D),v(D),_(D),k(D),D.sign==="-"&&b(D),T(D),a._params.optCurve&&t(D)}},_validateParameters:function(a){if(a&&a.turnPolicy&&iw.indexOf(a.turnPolicy)===-1){var h="'"+iw.join("', '")+"'";throw new Error("Bad turnPolicy value. Allowed values are: "+h)}if(a&&a.threshold!=null&&a.threshold!==bn.THRESHOLD_AUTO&&(typeof a.threshold!="number"||!Nr.between(a.threshold,0,255)))throw new Error("Bad threshold value. Expected to be an integer in range 0..255");if(a&&a.optCurve!=null&&typeof a.optCurve!="boolean")throw new Error("'optCurve' must be Boolean")},_processLoadedImage:function(a){var h=new MI(a.bitmap.width,a.bitmap.height),v=a.bitmap.data;a.scan(0,0,a.bitmap.width,a.bitmap.height,function(_,k,b){var T=v[b+3]/255,t=255+(v[b+0]-255)*T,S=255+(v[b+1]-255)*T,D=255+(v[b+2]-255)*T;h.data[b/4]=Nr.luminance(t,S,D)}),this._luminanceData=h,this._imageLoaded=!0},loadImage:function(a,h){var v=this,_={};this._imageLoadingIdentifier=_,this._imageLoaded=!1,a instanceof Jx?(this._imageLoadingIdentifier=null,this._imageLoaded=!0,v._processLoadedImage(a),h.call(v,null)):Jx.read(a,function(k,b){var T=v._imageLoadingIdentifier!==_;if(T){var t=k||new Error("Another image was loaded instead");return h.call(v,t)}v._imageLoadingIdentifier=null,v._processLoadedImage(b),h.call(v,null)})},setParameters:function(a){var h,v;this._validateParameters(a);for(h in this._params)this._params.hasOwnProperty(h)&&a.hasOwnProperty(h)&&(v=this._params[h],this._params[h]=a[h],v!==this._params[h]&&["color","background"].indexOf(h)===-1&&(this._processed=!1))},getPathTag:function(a,h){if(a=arguments.length===0?this._params.color:a,a===bn.COLOR_AUTO&&(a=this._params.blackOnWhite?"black":"white"),!this._imageLoaded)throw new Error("Image should be loaded first");this._processed||(this._bmToPathlist(),this._processPath(),this._processed=!0);var v='<path d="';return v+=this._pathlist.map(function(_){return Nr.renderCurve(_.curve,h)}).join(" "),v+='" stroke="none" fill="'+a+'" fill-rule="evenodd"/>',v},getSymbol:function(a){return'<symbol viewBox="0 0 '+this._luminanceData.width+" "+this._luminanceData.height+'" id="'+a+'">'+this.getPathTag("")+"</symbol>"},getSVG:function(){var a=this._params.width||this._luminanceData.width,h=this._params.height||this._luminanceData.height,v={x:this._params.width?this._params.width/this._luminanceData.width:1,y:this._params.height?this._params.height/this._luminanceData.height:1};return'<svg xmlns="http://www.w3.org/2000/svg" width="'+a+'" height="'+h+'" viewBox="0 0 '+a+" "+h+`" version="1.1">
`+(this._params.background!==bn.COLOR_TRANSPARENT?'	<rect x="0" y="0" width="100%" height="100%" fill="'+this._params.background+`" />
`:"")+"	"+this.getPathTag(this._params.color,v)+`
</svg>`}};var YE=bn,Wo=YE,ll=Qp;function Rn(a){this._potrace=new Wo,this._calculatedThreshold=null,this._params={threshold:Wo.THRESHOLD_AUTO,blackOnWhite:!0,steps:Rn.STEPS_AUTO,background:Wo.COLOR_TRANSPARENT,fillStrategy:Rn.FILL_DOMINANT,rangeDistribution:Rn.RANGES_AUTO},a&&this.setParameters(a)}for(var Tf in Wo)Object.prototype.hasOwnProperty.call(Wo,Tf)&&Tf===Tf.toUpperCase()&&(Rn[Tf]=Wo[Tf]);Rn.STEPS_AUTO=-1;Rn.FILL_SPREAD="spread";Rn.FILL_DOMINANT="dominant";Rn.FILL_MEDIAN="median";Rn.FILL_MEAN="mean";Rn.RANGES_AUTO="auto";Rn.RANGES_EQUAL="equal";Rn.prototype={_addExtraColorStop:function(a){var h=this._params.blackOnWhite,v=a[a.length-1],_=h?0:v.value,k=h?v.value:255;if(k-_>25&&v.colorIntensity!==1){var b=this._getImageHistogram(),T=b.getStats(_,k).levels,t=T.mean+T.stdDev<=25?T.mean+T.stdDev:T.mean-T.stdDev<=25?T.mean-T.stdDev:25,S=h?b.getStats(0,t):b.getStats(t,255),D=S.levels.mean;a.push({value:Math.abs((h?0:255)-t),colorIntensity:isNaN(D)?0:(h?255-D:D)/255})}return a},_calcColorIntensity:function(a){var h=this._params.blackOnWhite,v=this._params.fillStrategy,_=v!==Rn.FILL_SPREAD?this._getImageHistogram():null,k=Math.abs(this._paramThreshold()-(h?0:255));return a.map(function(b,T){var t=T+1===a.length?h?-1:256:a[T+1],S=Math.round(h?t+1:b),D=Math.round(h?b:t-1),w=T/(a.length-1),E=D-S,m=_.getStats(S,D),y=-1;if(m.pixels===0)return{value:b,colorIntensity:0};switch(v){case Rn.FILL_SPREAD:y=(h?S:D)+(h?1:-1)*E*Math.max(.5,k/255)*w;break;case Rn.FILL_DOMINANT:y=_.getDominantColor(S,D,ll.clamp(E,1,5));break;case Rn.FILL_MEAN:y=m.levels.mean;break;case Rn.FILL_MEDIAN:y=m.levels.median;break}return T!==0&&(y=h?ll.clamp(y,S,D-Math.round(E*.1)):ll.clamp(y,S+Math.round(E*.1),D)),{value:b,colorIntensity:y===-1?0:(h?255-y:y)/255}})},_getImageHistogram:function(){return this._potrace._luminanceData.histogram()},_getRanges:function(){var a=this._paramSteps();if(!Array.isArray(a))return this._params.rangeDistribution===Rn.RANGES_AUTO?this._getRangesAuto():this._getRangesEquallyDistributed();var h=[],v=this._paramThreshold(),_=this._params.blackOnWhite;return a.forEach(function(k){h.indexOf(k)===-1&&ll.between(k,0,255)&&h.push(k)}),h.length||h.push(v),h=h.sort(function(k,b){return k<b===_?1:-1}),_&&h[0]<v?h.unshift(v):!_&&h[h.length-1]<v&&h.push(v),this._calcColorIntensity(h)},_getRangesAuto:function(){var a=this._getImageHistogram(),h=this._paramSteps(!0),v;if(this._params.threshold===Wo.THRESHOLD_AUTO)v=a.multilevelThresholding(h);else{var _=this._paramThreshold();v=this._params.blackOnWhite?a.multilevelThresholding(h-1,0,_):a.multilevelThresholding(h-1,_,255),this._params.blackOnWhite?v.push(_):v.unshift(_)}return this._params.blackOnWhite&&(v=v.reverse()),this._calcColorIntensity(v)},_getRangesEquallyDistributed:function(){for(var a=this._params.blackOnWhite,h=a?this._paramThreshold():255-this._paramThreshold(),v=this._paramSteps(),_=h/v,k=[],b=v-1,T;b>=0;)T=Math.min(h,(b+1)*_),T=a?T:255-T,b--,k.push(T);return this._calcColorIntensity(k)},_paramSteps:function(a){var h=this._params.steps;if(Array.isArray(h))return a?h.length:h;if(h===Rn.STEPS_AUTO&&this._params.threshold===Wo.THRESHOLD_AUTO)return 4;var v=this._params.blackOnWhite,_=v?this._paramThreshold():255-this._paramThreshold();return h===Rn.STEPS_AUTO?_>200?4:3:Math.min(_,Math.max(2,h))},_paramThreshold:function(){if(this._calculatedThreshold!==null)return this._calculatedThreshold;if(this._params.threshold!==Wo.THRESHOLD_AUTO)return this._calculatedThreshold=this._params.threshold,this._calculatedThreshold;var a=this._getImageHistogram().multilevelThresholding(2);return this._calculatedThreshold=this._params.blackOnWhite?a[1]:a[0],this._calculatedThreshold=this._calculatedThreshold||128,this._calculatedThreshold},_pathTags:function(a){var h=this._getRanges(),v=this._potrace,_=this._params.blackOnWhite;h.length>=10&&(h=this._addExtraColorStop(h)),v.setParameters({blackOnWhite:_});var k=0;return h.map(function(b){var T=b.colorIntensity;if(T===0)return"";var t=!k||T===1?T:(k-T)/(k-1);t=ll.clamp(parseFloat(t.toFixed(3)),0,1),k=k+(1-k)*t,v.setParameters({threshold:b.value});var S=a?v.getPathTag(""):v.getPathTag();S=ll.setHtmlAttr(S,"fill-opacity",t.toFixed(3));var D=t===0||S.indexOf(' d=""')!==-1;return D?"":S})},loadImage:function(a,h){var v=this;this._potrace.loadImage(a,function(_){v._calculatedThreshold=null,h.call(v,_)})},setParameters:function(a){if(a){if(this._potrace.setParameters(a),a.steps&&!Array.isArray(a.steps)&&(!ll.isNumber(a.steps)||!ll.between(a.steps,1,255)))throw new Error("Bad 'steps' value");for(var h in this._params)this._params.hasOwnProperty(h)&&a.hasOwnProperty(h)&&(this._params[h]=a[h]);this._calculatedThreshold=null}},getSymbol:function(a){var h=this._potrace._luminanceData.width,v=this._potrace._luminanceData.height,_=this._pathTags(!0);return'<symbol viewBox="0 0 '+h+" "+v+'" id="'+a+'">'+_.join("")+"</symbol>"},getSVG:function(){var a=this._potrace._luminanceData.width,h=this._potrace._luminanceData.height,v=this._pathTags(!1),_='<svg xmlns="http://www.w3.org/2000/svg" width="'+a+'" height="'+h+'" viewBox="0 0 '+a+" "+h+`" version="1.1">
	`+(this._params.background!==Wo.COLOR_TRANSPARENT?'<rect x="0" y="0" width="100%" height="100%" fill="'+this._params.background+`" />
	`:"")+v.join(`
	`)+`
</svg>`;return _.replace(/\n(?:\t*\n)+(\t*)/g,`
$1`)}};var II=Rn,KE=YE,JE=II;function PI(a,h,v){arguments.length===2&&(v=h,h={});var _=new KE(h);_.loadImage(a,function(k){if(k)return v(k);v(null,_.getSVG(),_)})}function CI(a,h,v){arguments.length===2&&(v=h,h={});var _=new JE(h);_.loadImage(a,function(k){if(k)return v(k);v(null,_.getSVG(),_)})}var RI={trace:PI,posterize:CI,Potrace:KE,Posterizer:JE};const DI=Fy(RI);function LI(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var QE={exports:{}},Dn=QE.exports={},Ho,qo;function Ay(){throw new Error("setTimeout has not been defined")}function Iy(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Ho=setTimeout:Ho=Ay}catch{Ho=Ay}try{typeof clearTimeout=="function"?qo=clearTimeout:qo=Iy}catch{qo=Iy}})();function eT(a){if(Ho===setTimeout)return setTimeout(a,0);if((Ho===Ay||!Ho)&&setTimeout)return Ho=setTimeout,setTimeout(a,0);try{return Ho(a,0)}catch{try{return Ho.call(null,a,0)}catch{return Ho.call(this,a,0)}}}function OI(a){if(qo===clearTimeout)return clearTimeout(a);if((qo===Iy||!qo)&&clearTimeout)return qo=clearTimeout,clearTimeout(a);try{return qo(a)}catch{try{return qo.call(null,a)}catch{return qo.call(this,a)}}}var gs=[],kc=!1,ou,Vp=-1;function zI(){!kc||!ou||(kc=!1,ou.length?gs=ou.concat(gs):Vp=-1,gs.length&&tT())}function tT(){if(!kc){var a=eT(zI);kc=!0;for(var h=gs.length;h;){for(ou=gs,gs=[];++Vp<h;)ou&&ou[Vp].run();Vp=-1,h=gs.length}ou=null,kc=!1,OI(a)}}Dn.nextTick=function(a){var h=new Array(arguments.length-1);if(arguments.length>1)for(var v=1;v<arguments.length;v++)h[v-1]=arguments[v];gs.push(new rT(a,h)),gs.length===1&&!kc&&eT(tT)};function rT(a,h){this.fun=a,this.array=h}rT.prototype.run=function(){this.fun.apply(null,this.array)};Dn.title="browser";Dn.browser=!0;Dn.env={};Dn.argv=[];Dn.version="";Dn.versions={};function xs(){}Dn.on=xs;Dn.addListener=xs;Dn.once=xs;Dn.off=xs;Dn.removeListener=xs;Dn.removeAllListeners=xs;Dn.emit=xs;Dn.prependListener=xs;Dn.prependOnceListener=xs;Dn.listeners=function(a){return[]};Dn.binding=function(a){throw new Error("process.binding is not supported")};Dn.cwd=function(){return"/"};Dn.chdir=function(a){throw new Error("process.chdir is not supported")};Dn.umask=function(){return 0};var kI=QE.exports;const Ui=LI(kI),BI="0.7.1",FI={version:BI};function NI(a,h){function v(){this.constructor=a}v.prototype=h.prototype,a.prototype=new v}function Lf(a,h,v,_){this.message=a,this.expected=h,this.found=v,this.location=_,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Lf)}NI(Lf,Error);Lf.buildMessage=function(a,h){var v={literal:function(D){return'"'+k(D.text)+'"'},class:function(D){var w="",E;for(E=0;E<D.parts.length;E++)w+=D.parts[E]instanceof Array?b(D.parts[E][0])+"-"+b(D.parts[E][1]):b(D.parts[E]);return"["+(D.inverted?"^":"")+w+"]"},any:function(D){return"any character"},end:function(D){return"end of input"},other:function(D){return D.description}};function _(D){return D.charCodeAt(0).toString(16).toUpperCase()}function k(D){return D.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(w){return"\\x0"+_(w)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(w){return"\\x"+_(w)})}function b(D){return D.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(w){return"\\x0"+_(w)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(w){return"\\x"+_(w)})}function T(D){return v[D.type](D)}function t(D){var w=new Array(D.length),E,m;for(E=0;E<D.length;E++)w[E]=T(D[E]);if(w.sort(),w.length>0){for(E=1,m=1;E<w.length;E++)w[E-1]!==w[E]&&(w[m]=w[E],m++);w.length=m}switch(w.length){case 1:return w[0];case 2:return w[0]+" or "+w[1];default:return w.slice(0,-1).join(", ")+", or "+w[w.length-1]}}function S(D){return D?'"'+k(D)+'"':"end of input"}return"Expected "+t(a)+" but "+S(h)+" found."};function UI(a,h){h=h!==void 0?h:{};var v={},_={svg_path:br},k=br,b=function(ut){if(!ut)return[];for(var _t=[],Vt=0;Vt<ut.length;Vt++)_t=_t.concat.apply(_t,ut[Vt]);var At=_t[0];return At&&At.code=="m"&&(delete At.relative,At.code="M"),_t},T=function(ut,_t){return Pi(ut,_t)},t=/^[Mm]/,S=Ft(["M","m"],!1,!1),D=function(ut,_t,Vt){var At=en(ut,[_t]);return Vt&&(At=At.concat(en(ut=="M"?"L":"l",Vt[1]))),At},w=/^[Zz]/,E=Ft(["Z","z"],!1,!1),m=function(){return en("Z")},y=/^[Ll]/,p=Ft(["L","l"],!1,!1),C=function(ut,_t){return en(ut,_t)},z=/^[Hh]/,A=Ft(["H","h"],!1,!1),P=function(ut,_t){return en(ut,_t.map(function(Vt){return{x:Vt}}))},x=/^[Vv]/,O=Ft(["V","v"],!1,!1),U=function(ut,_t){return en(ut,_t.map(function(Vt){return{y:Vt}}))},G=/^[Cc]/,Z=Ft(["C","c"],!1,!1),X=function(ut,_t,Vt){return{x1:ut.x,y1:ut.y,x2:_t.x,y2:_t.y,x:Vt.x,y:Vt.y}},W=/^[Ss]/,J=Ft(["S","s"],!1,!1),re=function(ut,_t){return{x2:ut.x,y2:ut.y,x:_t.x,y:_t.y}},te=/^[Qq]/,ye=Ft(["Q","q"],!1,!1),ue=function(ut,_t){return{x1:ut.x,y1:ut.y,x:_t.x,y:_t.y}},Se=/^[Tt]/,Le=Ft(["T","t"],!1,!1),Pe=/^[Aa]/,Ee=Ft(["A","a"],!1,!1),Me=function(ut,_t,Vt,At,Qt,Cr){return{rx:ut,ry:_t,xAxisRotation:Vt,largeArc:At,sweep:Qt,x:Cr.x,y:Cr.y}},He=function(ut,_t){return{x:ut,y:_t}},nt=function(ut){return ut*1},ht=function(ut){return ut.join("")*1},Fe=/^[01]/,Ce=Ft(["0","1"],!1,!1),Be=function(ut){return ut=="1"},Ae=function(){return""},se=",",pe=wt(",",!1),Ke=function(ut){return ut.join("")},_e=".",ke=wt(".",!1),qe=/^[eE]/,tt=Ft(["e","E"],!1,!1),Ge=/^[+\-]/,We=Ft(["+","-"],!1,!1),Je=/^[0-9]/,it=Ft([["0","9"]],!1,!1),ze=function(ut){return ut.join("")},de=/^[ \t\n\r]/,ve=Ft([" ","	",`
`,"\r"],!1,!1),be=0,Oe=[{line:1,column:1}],ge=0,le=[],et;if("startRule"in h){if(!(h.startRule in _))throw new Error(`Can't start parsing from rule "`+h.startRule+'".');k=_[h.startRule]}function wt(ut,_t){return{type:"literal",text:ut,ignoreCase:_t}}function Ft(ut,_t,Vt){return{type:"class",parts:ut,inverted:_t,ignoreCase:Vt}}function Wt(){return{type:"end"}}function or(ut){var _t=Oe[ut],Vt;if(_t)return _t;for(Vt=ut-1;!Oe[Vt];)Vt--;for(_t=Oe[Vt],_t={line:_t.line,column:_t.column};Vt<ut;)a.charCodeAt(Vt)===10?(_t.line++,_t.column=1):_t.column++,Vt++;return Oe[ut]=_t,_t}function Or(ut,_t){var Vt=or(ut),At=or(_t);return{start:{offset:ut,line:Vt.line,column:Vt.column},end:{offset:_t,line:At.line,column:At.column}}}function xr(ut){be<ge||(be>ge&&(ge=be,le=[]),le.push(ut))}function Tr(ut,_t,Vt){return new Lf(Lf.buildMessage(ut,_t),ut,_t,Vt)}function br(){var ut,_t,Vt,At,Qt;for(ut=be,_t=[],Vt=Wr();Vt!==v;)_t.push(Vt),Vt=Wr();if(_t!==v)if(Vt=fr(),Vt===v&&(Vt=null),Vt!==v){for(At=[],Qt=Wr();Qt!==v;)At.push(Qt),Qt=Wr();At!==v?(_t=b(Vt),ut=_t):(be=ut,ut=v)}else be=ut,ut=v;else be=ut,ut=v;return ut}function fr(){var ut,_t,Vt,At,Qt,Cr;if(ut=be,_t=Vr(),_t!==v){for(Vt=[],At=be,Qt=[],Cr=Wr();Cr!==v;)Qt.push(Cr),Cr=Wr();for(Qt!==v?(Cr=Vr(),Cr!==v?(Qt=[Qt,Cr],At=Qt):(be=At,At=v)):(be=At,At=v);At!==v;){for(Vt.push(At),At=be,Qt=[],Cr=Wr();Cr!==v;)Qt.push(Cr),Cr=Wr();Qt!==v?(Cr=Vr(),Cr!==v?(Qt=[Qt,Cr],At=Qt):(be=At,At=v)):(be=At,At=v)}Vt!==v?(_t=T(_t,Vt),ut=_t):(be=ut,ut=v)}else be=ut,ut=v;return ut}function Vr(){var ut,_t,Vt,At,Qt,Cr;if(ut=be,_t=De(),_t!==v){for(Vt=[],At=be,Qt=[],Cr=Wr();Cr!==v;)Qt.push(Cr),Cr=Wr();for(Qt!==v?(Cr=Ir(),Cr!==v?(Qt=[Qt,Cr],At=Qt):(be=At,At=v)):(be=At,At=v);At!==v;){for(Vt.push(At),At=be,Qt=[],Cr=Wr();Cr!==v;)Qt.push(Cr),Cr=Wr();Qt!==v?(Cr=Ir(),Cr!==v?(Qt=[Qt,Cr],At=Qt):(be=At,At=v)):(be=At,At=v)}Vt!==v?(_t=T(_t,Vt),ut=_t):(be=ut,ut=v)}else be=ut,ut=v;return ut}function Ir(){var ut;return ut=St(),ut===v&&(ut=Ut(),ut===v&&(ut=Rt(),ut===v&&(ut=rt(),ut===v&&(ut=sr(),ut===v&&(ut=Qe(),ut===v&&(ut=Q(),ut===v&&(ut=Ze(),ut===v&&(ut=mt())))))))),ut}function De(){var ut,_t,Vt,At,Qt,Cr,Ca;if(ut=be,t.test(a.charAt(be))?(_t=a.charAt(be),be++):(_t=v,xr(S)),_t!==v){for(Vt=[],At=Wr();At!==v;)Vt.push(At),At=Wr();Vt!==v?(At=Lt(),At!==v?(Qt=be,Cr=Pr(),Cr===v&&(Cr=null),Cr!==v?(Ca=ir(),Ca!==v?(Cr=[Cr,Ca],Qt=Cr):(be=Qt,Qt=v)):(be=Qt,Qt=v),Qt===v&&(Qt=null),Qt!==v?(_t=D(_t,At,Qt),ut=_t):(be=ut,ut=v)):(be=ut,ut=v)):(be=ut,ut=v)}else be=ut,ut=v;return ut}function St(){var ut,_t;return ut=be,w.test(a.charAt(be))?(_t=a.charAt(be),be++):(_t=v,xr(E)),_t!==v&&(_t=m()),ut=_t,ut}function Ut(){var ut,_t,Vt,At;if(ut=be,y.test(a.charAt(be))?(_t=a.charAt(be),be++):(_t=v,xr(p)),_t!==v){for(Vt=[],At=Wr();At!==v;)Vt.push(At),At=Wr();Vt!==v?(At=ir(),At!==v?(_t=C(_t,At),ut=_t):(be=ut,ut=v)):(be=ut,ut=v)}else be=ut,ut=v;return ut}function ir(){var ut,_t,Vt,At,Qt,Cr;if(ut=be,_t=Lt(),_t!==v){for(Vt=[],At=be,Qt=Pr(),Qt===v&&(Qt=null),Qt!==v?(Cr=Lt(),Cr!==v?(Qt=[Qt,Cr],At=Qt):(be=At,At=v)):(be=At,At=v);At!==v;)Vt.push(At),At=be,Qt=Pr(),Qt===v&&(Qt=null),Qt!==v?(Cr=Lt(),Cr!==v?(Qt=[Qt,Cr],At=Qt):(be=At,At=v)):(be=At,At=v);Vt!==v?(_t=T(_t,Vt),ut=_t):(be=ut,ut=v)}else be=ut,ut=v;return ut}function Rt(){var ut,_t,Vt,At;if(ut=be,z.test(a.charAt(be))?(_t=a.charAt(be),be++):(_t=v,xr(A)),_t!==v){for(Vt=[],At=Wr();At!==v;)Vt.push(At),At=Wr();Vt!==v?(At=$t(),At!==v?(_t=P(_t,At),ut=_t):(be=ut,ut=v)):(be=ut,ut=v)}else be=ut,ut=v;return ut}function $t(){var ut,_t,Vt,At,Qt,Cr;if(ut=be,_t=cr(),_t!==v){for(Vt=[],At=be,Qt=Pr(),Qt===v&&(Qt=null),Qt!==v?(Cr=cr(),Cr!==v?(Qt=[Qt,Cr],At=Qt):(be=At,At=v)):(be=At,At=v);At!==v;)Vt.push(At),At=be,Qt=Pr(),Qt===v&&(Qt=null),Qt!==v?(Cr=cr(),Cr!==v?(Qt=[Qt,Cr],At=Qt):(be=At,At=v)):(be=At,At=v);Vt!==v?(_t=T(_t,Vt),ut=_t):(be=ut,ut=v)}else be=ut,ut=v;return ut}function rt(){var ut,_t,Vt,At;if(ut=be,x.test(a.charAt(be))?(_t=a.charAt(be),be++):(_t=v,xr(O)),_t!==v){for(Vt=[],At=Wr();At!==v;)Vt.push(At),At=Wr();Vt!==v?(At=$t(),At!==v?(_t=U(_t,At),ut=_t):(be=ut,ut=v)):(be=ut,ut=v)}else be=ut,ut=v;return ut}function sr(){var ut,_t,Vt,At;if(ut=be,G.test(a.charAt(be))?(_t=a.charAt(be),be++):(_t=v,xr(Z)),_t!==v){for(Vt=[],At=Wr();At!==v;)Vt.push(At),At=Wr();Vt!==v?(At=Fr(),At!==v?(_t=C(_t,At),ut=_t):(be=ut,ut=v)):(be=ut,ut=v)}else be=ut,ut=v;return ut}function Fr(){var ut,_t,Vt,At,Qt,Cr;if(ut=be,_t=ee(),_t!==v){for(Vt=[],At=be,Qt=Pr(),Qt===v&&(Qt=null),Qt!==v?(Cr=ee(),Cr!==v?(Qt=[Qt,Cr],At=Qt):(be=At,At=v)):(be=At,At=v);At!==v;)Vt.push(At),At=be,Qt=Pr(),Qt===v&&(Qt=null),Qt!==v?(Cr=ee(),Cr!==v?(Qt=[Qt,Cr],At=Qt):(be=At,At=v)):(be=At,At=v);Vt!==v?(_t=T(_t,Vt),ut=_t):(be=ut,ut=v)}else be=ut,ut=v;return ut}function ee(){var ut,_t,Vt,At,Qt,Cr;return ut=be,_t=Lt(),_t!==v?(Vt=Pr(),Vt===v&&(Vt=null),Vt!==v?(At=Lt(),At!==v?(Qt=Pr(),Qt===v&&(Qt=null),Qt!==v?(Cr=Lt(),Cr!==v?(_t=X(_t,At,Cr),ut=_t):(be=ut,ut=v)):(be=ut,ut=v)):(be=ut,ut=v)):(be=ut,ut=v)):(be=ut,ut=v),ut}function Qe(){var ut,_t,Vt,At;if(ut=be,W.test(a.charAt(be))?(_t=a.charAt(be),be++):(_t=v,xr(J)),_t!==v){for(Vt=[],At=Wr();At!==v;)Vt.push(At),At=Wr();Vt!==v?(At=ie(),At!==v?(_t=C(_t,At),ut=_t):(be=ut,ut=v)):(be=ut,ut=v)}else be=ut,ut=v;return ut}function ie(){var ut,_t,Vt,At,Qt,Cr;if(ut=be,_t=B(),_t!==v){for(Vt=[],At=be,Qt=Pr(),Qt===v&&(Qt=null),Qt!==v?(Cr=B(),Cr!==v?(Qt=[Qt,Cr],At=Qt):(be=At,At=v)):(be=At,At=v);At!==v;)Vt.push(At),At=be,Qt=Pr(),Qt===v&&(Qt=null),Qt!==v?(Cr=B(),Cr!==v?(Qt=[Qt,Cr],At=Qt):(be=At,At=v)):(be=At,At=v);Vt!==v?(_t=T(_t,Vt),ut=_t):(be=ut,ut=v)}else be=ut,ut=v;return ut}function B(){var ut,_t,Vt,At;return ut=be,_t=Lt(),_t!==v?(Vt=Pr(),Vt===v&&(Vt=null),Vt!==v?(At=Lt(),At!==v?(_t=re(_t,At),ut=_t):(be=ut,ut=v)):(be=ut,ut=v)):(be=ut,ut=v),ut}function Q(){var ut,_t,Vt,At;if(ut=be,te.test(a.charAt(be))?(_t=a.charAt(be),be++):(_t=v,xr(ye)),_t!==v){for(Vt=[],At=Wr();At!==v;)Vt.push(At),At=Wr();Vt!==v?(At=xe(),At!==v?(_t=C(_t,At),ut=_t):(be=ut,ut=v)):(be=ut,ut=v)}else be=ut,ut=v;return ut}function xe(){var ut,_t,Vt,At,Qt,Cr;if(ut=be,_t=Ne(),_t!==v){for(Vt=[],At=be,Qt=Pr(),Qt===v&&(Qt=null),Qt!==v?(Cr=Ne(),Cr!==v?(Qt=[Qt,Cr],At=Qt):(be=At,At=v)):(be=At,At=v);At!==v;)Vt.push(At),At=be,Qt=Pr(),Qt===v&&(Qt=null),Qt!==v?(Cr=Ne(),Cr!==v?(Qt=[Qt,Cr],At=Qt):(be=At,At=v)):(be=At,At=v);Vt!==v?(_t=T(_t,Vt),ut=_t):(be=ut,ut=v)}else be=ut,ut=v;return ut}function Ne(){var ut,_t,Vt,At;return ut=be,_t=Lt(),_t!==v?(Vt=Pr(),Vt===v&&(Vt=null),Vt!==v?(At=Lt(),At!==v?(_t=ue(_t,At),ut=_t):(be=ut,ut=v)):(be=ut,ut=v)):(be=ut,ut=v),ut}function Ze(){var ut,_t,Vt,At;if(ut=be,Se.test(a.charAt(be))?(_t=a.charAt(be),be++):(_t=v,xr(Le)),_t!==v){for(Vt=[],At=Wr();At!==v;)Vt.push(At),At=Wr();Vt!==v?(At=ot(),At!==v?(_t=C(_t,At),ut=_t):(be=ut,ut=v)):(be=ut,ut=v)}else be=ut,ut=v;return ut}function ot(){var ut,_t,Vt,At,Qt,Cr;if(ut=be,_t=Lt(),_t!==v){for(Vt=[],At=be,Qt=Pr(),Qt===v&&(Qt=null),Qt!==v?(Cr=Lt(),Cr!==v?(Qt=[Qt,Cr],At=Qt):(be=At,At=v)):(be=At,At=v);At!==v;)Vt.push(At),At=be,Qt=Pr(),Qt===v&&(Qt=null),Qt!==v?(Cr=Lt(),Cr!==v?(Qt=[Qt,Cr],At=Qt):(be=At,At=v)):(be=At,At=v);Vt!==v?(_t=T(_t,Vt),ut=_t):(be=ut,ut=v)}else be=ut,ut=v;return ut}function mt(){var ut,_t,Vt,At;if(ut=be,Pe.test(a.charAt(be))?(_t=a.charAt(be),be++):(_t=v,xr(Ee)),_t!==v){for(Vt=[],At=Wr();At!==v;)Vt.push(At),At=Wr();Vt!==v?(At=Nt(),At!==v?(_t=C(_t,At),ut=_t):(be=ut,ut=v)):(be=ut,ut=v)}else be=ut,ut=v;return ut}function Nt(){var ut,_t,Vt,At,Qt,Cr;if(ut=be,_t=Bt(),_t!==v){for(Vt=[],At=be,Qt=Pr(),Qt===v&&(Qt=null),Qt!==v?(Cr=Bt(),Cr!==v?(Qt=[Qt,Cr],At=Qt):(be=At,At=v)):(be=At,At=v);At!==v;)Vt.push(At),At=be,Qt=Pr(),Qt===v&&(Qt=null),Qt!==v?(Cr=Bt(),Cr!==v?(Qt=[Qt,Cr],At=Qt):(be=At,At=v)):(be=At,At=v);Vt!==v?(_t=T(_t,Vt),ut=_t):(be=ut,ut=v)}else be=ut,ut=v;return ut}function Bt(){var ut,_t,Vt,At,Qt,Cr,Ca,Wa,ea,Ra,To,Es;return ut=be,_t=Yt(),_t!==v?(Vt=Pr(),Vt===v&&(Vt=null),Vt!==v?(At=Yt(),At!==v?(Qt=Pr(),Qt===v&&(Qt=null),Qt!==v?(Cr=cr(),Cr!==v?(Ca=Pr(),Ca!==v?(Wa=gr(),Wa!==v?(ea=Pr(),ea===v&&(ea=null),ea!==v?(Ra=gr(),Ra!==v?(To=Pr(),To===v&&(To=null),To!==v?(Es=Lt(),Es!==v?(_t=Me(_t,At,Cr,Wa,Ra,Es),ut=_t):(be=ut,ut=v)):(be=ut,ut=v)):(be=ut,ut=v)):(be=ut,ut=v)):(be=ut,ut=v)):(be=ut,ut=v)):(be=ut,ut=v)):(be=ut,ut=v)):(be=ut,ut=v)):(be=ut,ut=v)):(be=ut,ut=v),ut}function Lt(){var ut,_t,Vt,At;return ut=be,_t=cr(),_t!==v?(Vt=Pr(),Vt===v&&(Vt=null),Vt!==v?(At=cr(),At!==v?(_t=He(_t,At),ut=_t):(be=ut,ut=v)):(be=ut,ut=v)):(be=ut,ut=v),ut}function Yt(){var ut,_t;return ut=be,_t=Br(),_t===v&&(_t=Kr()),_t!==v&&(_t=nt(_t)),ut=_t,ut}function cr(){var ut,_t,Vt,At;return ut=be,_t=be,Vt=si(),Vt===v&&(Vt=null),Vt!==v?(At=Br(),At!==v?(Vt=[Vt,At],_t=Vt):(be=_t,_t=v)):(be=_t,_t=v),_t===v&&(_t=be,Vt=si(),Vt===v&&(Vt=null),Vt!==v?(At=Kr(),At!==v?(Vt=[Vt,At],_t=Vt):(be=_t,_t=v)):(be=_t,_t=v)),_t!==v&&(_t=ht(_t)),ut=_t,ut}function gr(){var ut,_t;return ut=be,Fe.test(a.charAt(be))?(_t=a.charAt(be),be++):(_t=v,xr(Ce)),_t!==v&&(_t=Be(_t)),ut=_t,ut}function Pr(){var ut,_t,Vt,At,Qt;if(ut=be,_t=[],Vt=Wr(),Vt!==v)for(;Vt!==v;)_t.push(Vt),Vt=Wr();else _t=v;if(_t!==v)if(Vt=Jr(),Vt===v&&(Vt=null),Vt!==v){for(At=[],Qt=Wr();Qt!==v;)At.push(Qt),Qt=Wr();At!==v?(_t=[_t,Vt,At],ut=_t):(be=ut,ut=v)}else be=ut,ut=v;else be=ut,ut=v;if(ut===v){if(ut=be,_t=be,Vt=Jr(),Vt!==v){for(At=[],Qt=Wr();Qt!==v;)At.push(Qt),Qt=Wr();At!==v?(Vt=[Vt,At],_t=Vt):(be=_t,_t=v)}else be=_t,_t=v;_t!==v&&(_t=Ae()),ut=_t}return ut}function Jr(){var ut;return a.charCodeAt(be)===44?(ut=se,be++):(ut=v,xr(pe)),ut}function Br(){var ut,_t,Vt,At;return ut=be,_t=be,Vt=Ur(),Vt!==v?(At=oi(),At===v&&(At=null),At!==v?(Vt=[Vt,At],_t=Vt):(be=_t,_t=v)):(be=_t,_t=v),_t===v&&(_t=be,Vt=Kr(),Vt!==v?(At=oi(),At!==v?(Vt=[Vt,At],_t=Vt):(be=_t,_t=v)):(be=_t,_t=v)),_t!==v&&(_t=Ke(_t)),ut=_t,ut}function Ur(){var ut,_t,Vt,At,Qt;return ut=be,_t=be,Vt=Kr(),Vt===v&&(Vt=null),Vt!==v?(a.charCodeAt(be)===46?(At=_e,be++):(At=v,xr(ke)),At!==v?(Qt=Kr(),Qt!==v?(Vt=[Vt,At,Qt],_t=Vt):(be=_t,_t=v)):(be=_t,_t=v)):(be=_t,_t=v),_t===v&&(_t=be,Vt=Kr(),Vt!==v?(a.charCodeAt(be)===46?(At=_e,be++):(At=v,xr(ke)),At!==v?(Vt=[Vt,At],_t=Vt):(be=_t,_t=v)):(be=_t,_t=v)),_t!==v&&(_t=Ke(_t)),ut=_t,ut}function oi(){var ut,_t,Vt,At,Qt;return ut=be,_t=be,qe.test(a.charAt(be))?(Vt=a.charAt(be),be++):(Vt=v,xr(tt)),Vt!==v?(At=si(),At===v&&(At=null),At!==v?(Qt=Kr(),Qt!==v?(Vt=[Vt,At,Qt],_t=Vt):(be=_t,_t=v)):(be=_t,_t=v)):(be=_t,_t=v),_t!==v&&(_t=Ke(_t)),ut=_t,ut}function si(){var ut;return Ge.test(a.charAt(be))?(ut=a.charAt(be),be++):(ut=v,xr(We)),ut}function Kr(){var ut,_t,Vt;if(ut=be,_t=[],Je.test(a.charAt(be))?(Vt=a.charAt(be),be++):(Vt=v,xr(it)),Vt!==v)for(;Vt!==v;)_t.push(Vt),Je.test(a.charAt(be))?(Vt=a.charAt(be),be++):(Vt=v,xr(it));else _t=v;return _t!==v&&(_t=ze(_t)),ut=_t,ut}function Wr(){var ut,_t;return ut=be,de.test(a.charAt(be))?(_t=a.charAt(be),be++):(_t=v,xr(ve)),_t!==v&&(_t=Ae()),ut=_t,ut}function Pi(ut,_t){if(!_t)return[ut];for(var Vt=[ut],At=0,Qt=_t.length;At<Qt;At++)Vt[At+1]=_t[At][1];return Vt}var Ki={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var xn in Ki)Ki[xn.toUpperCase()]=Ki[xn];function en(ut,_t){_t||(_t=[{}]);for(var Vt=_t.length;Vt--;){var At={code:ut,command:Ki[ut]};ut==ut.toLowerCase()&&(At.relative=!0);for(var Qt in _t[Vt])At[Qt]=_t[Vt][Qt];_t[Vt]=At}return _t}if(et=k(),et!==v&&be===a.length)return et;throw et!==v&&be<a.length&&xr(Wt()),Tr(le,ge<a.length?a.charAt(ge):null,ge<a.length?Or(ge,ge+1):Or(ge,ge))}var jI={parse:UI},Xp=jI.parse;Xp.parseSVG=Xp;Xp.makeAbsolute=GI;var VI=Xp;function GI(a){var h,v={x:0,y:0},_={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return a.forEach(function(k){k.command==="moveto"&&(h=k),k.x0=v.x,k.y0=v.y;for(var b in _)b in k&&(k[b]+=k.relative?k[_[b]]:0);"x"in k||(k.x=v.x),"y"in k||(k.y=v.y),k.relative=!1,k.code=k.code.toUpperCase(),k.command=="closepath"&&(k.x=h.x,k.y=h.y),v=k}),a}var HI={pathDataToPolys:$I};const{parseSVG:qI,makeAbsolute:WI}=VI;function $I(a,h={}){h.tolerance||(h.tolerance=1);const v=[],_=h.tolerance*h.tolerance;let k=[],b;return WI(qI(a)).forEach(S=>{switch(S.code){case"M":v.push(k=[]);case"L":case"H":case"V":case"Z":t(S.x,S.y),S.code==="Z"&&(k.closed=!0);break;case"C":T(S.x0,S.y0,S.x1,S.y1,S.x2,S.y2,S.x,S.y),t(S.x,S.y);break;case"S":let D=0,w=0;b&&(b.code==="C"?(D=b.x*2-b.x2,w=b.y*2-b.y2):(D=b.x,w=b.y)),T(S.x0,S.y0,D,w,S.x2,S.y2,S.x,S.y),t(S.x,S.y);break;default:console.error("Our deepest apologies, but "+S.command+" commands ("+S.code+") are not yet supported."),Ui.exit(2)}b=S}),v;function T(S,D,w,E,m,y,p,C){const z=(S+w)/2,A=(D+E)/2,P=(w+m)/2,x=(E+y)/2,O=(m+p)/2,U=(y+C)/2,G=(z+P)/2,Z=(A+x)/2,X=(P+O)/2,W=(x+U)/2,J=(G+X)/2,re=(Z+W)/2,te=p-S,ye=C-D,ue=Math.abs((w-p)*ye-(E-C)*te),Se=Math.abs((m-p)*ye-(y-C)*te);(ue+Se)*(ue+Se)<_*(te*te+ye*ye)?t(J,re):(T(S,D,z,A,G,Z,J,re),T(J,re,X,W,O,U,p,C))}function t(S,D){h.decimals&&h.decimals>=0&&(S=S.toFixed(h.decimals)*1,D=D.toFixed(h.decimals)*1),k.push([S,D])}}const ZI=Math.PI/180,XI=180/Math.PI,ti=1e-6;function YI(a,h){return Math.abs(a-h)<=ti*Math.max(1,Math.abs(a),Math.abs(h))}function KI(a,h,v){return v=v||ti,Math.abs(a-h)<=v}function JI(a,h,v){return a<h?h:a>v?v:a}function QI(a){return a<0?0:a>1?1:a}function e5(a,h,v){return a+(h-a)*v}function t5(a){return a*ZI}function r5(a){return a*XI}const ul=Math.random;function iT(a,h){return Math.random()*(h-a)+a}function i5(a,h){return Math.floor(iT(a,h))}function n5(a){return--a,a=a>>1|a,a=a>>2|a,a=a>>4|a,a=a>>8|a,a=a>>16|a,++a,a}const jy=32,a5=2147483647,o5=-1<<jy-1;function s5(a){return(a>0)-(a<0)}function l5(a){let h=a>>jy-1;return(a^h)-h}function u5(a,h){return h^(a^h)&-(a<h)}function c5(a,h){return a^(a^h)&-(a<h)}function h5(a){return!(a&a-1)&&!!a}function f5(a){let h,v;return h=(a>65535)<<4,a>>>=h,v=(a>255)<<3,a>>>=v,h|=v,v=(a>15)<<2,a>>>=v,h|=v,v=(a>3)<<1,a>>>=v,h|=v,h|a>>1}function d5(a){return a>=1e9?9:a>=1e8?8:a>=1e7?7:a>=1e6?6:a>=1e5?5:a>=1e4?4:a>=1e3?3:a>=100?2:a>=10?1:0}function p5(a){return a=a-(a>>>1&1431655765),a=(a&858993459)+(a>>>2&858993459),(a+(a>>>4)&252645135)*16843009>>>24}function nT(a){let h=32;return a&=-a,a&&h--,a&65535&&(h-=16),a&16711935&&(h-=8),a&252645135&&(h-=4),a&858993459&&(h-=2),a&1431655765&&(h-=1),h}function m5(a){return a+=a===0,--a,a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,a|=a>>>16,a+1}function _5(a){return a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,a|=a>>>16,a-(a>>>1)}function g5(a){return a^=a>>>16,a^=a>>>8,a^=a>>>4,a&=15,27030>>>a&1}const Pf=new Array(256);(function(a){for(let h=0;h<256;++h){let v=h,_=h,k=7;for(v>>>=1;v;v>>>=1)_<<=1,_|=v&1,--k;a[h]=_<<k&255}})(Pf);function y5(a){return Pf[a&255]<<24|Pf[a>>>8&255]<<16|Pf[a>>>16&255]<<8|Pf[a>>>24&255]}function v5(a,h){return a&=65535,a=(a|a<<8)&16711935,a=(a|a<<4)&252645135,a=(a|a<<2)&858993459,a=(a|a<<1)&1431655765,h&=65535,h=(h|h<<8)&16711935,h=(h|h<<4)&252645135,h=(h|h<<2)&858993459,h=(h|h<<1)&1431655765,a|h<<1}function b5(a,h){return a=a>>>h&1431655765,a=(a|a>>>1)&858993459,a=(a|a>>>2)&252645135,a=(a|a>>>4)&16711935,a=(a|a>>>16)&65535,a<<16>>16}function x5(a,h,v){return a&=1023,a=(a|a<<16)&4278190335,a=(a|a<<8)&251719695,a=(a|a<<4)&3272356035,a=(a|a<<2)&1227133513,h&=1023,h=(h|h<<16)&4278190335,h=(h|h<<8)&251719695,h=(h|h<<4)&3272356035,h=(h|h<<2)&1227133513,a|=h<<1,v&=1023,v=(v|v<<16)&4278190335,v=(v|v<<8)&251719695,v=(v|v<<4)&3272356035,v=(v|v<<2)&1227133513,a|v<<2}function w5(a,h){return a=a>>>h&1227133513,a=(a|a>>>2)&3272356035,a=(a|a>>>4)&251719695,a=(a|a>>>8)&4278190335,a=(a|a>>>16)&1023,a<<22>>22}function E5(a){let h=a|a-1;return h+1|(~h&-~h)-1>>>nT(a)+1}const T5=Object.freeze(Object.defineProperty({__proto__:null,INT_BITS:jy,INT_MAX:a5,INT_MIN:o5,abs:l5,countTrailingZeros:nT,deinterleave2:b5,deinterleave3:w5,interleave2:v5,interleave3:x5,isPow2:h5,log10:d5,log2:f5,max:c5,min:u5,nextCombination:E5,nextPow2:m5,parity:g5,popCount:p5,prevPow2:_5,reverse:y5,sign:s5},Symbol.toStringTag,{value:"Module"}));let _g=new Array(2);class Vy{constructor(h,v){this.x=h,this.y=v}toJSON(){return _g[0]=this.x,_g[1]=this.y,_g}}let bi={};bi.create=function(){return new Vy(0,0)};bi.new=function(a,h){return new Vy(a,h)};bi.clone=function(a){return new Vy(a.x,a.y)};bi.copy=function(a,h){return a.x=h.x,a.y=h.y,a};bi.set=function(a,h,v){return a.x=h,a.y=v,a};bi.add=function(a,h,v){return a.x=h.x+v.x,a.y=h.y+v.y,a};bi.subtract=function(a,h,v){return a.x=h.x-v.x,a.y=h.y-v.y,a};bi.sub=bi.subtract;bi.multiply=function(a,h,v){return a.x=h.x*v.x,a.y=h.y*v.y,a};bi.mul=bi.multiply;bi.divide=function(a,h,v){return a.x=h.x/v.x,a.y=h.y/v.y,a};bi.div=bi.divide;bi.ceil=function(a,h){return a.x=Math.ceil(h.x),a.y=Math.ceil(h.y),a};bi.floor=function(a,h){return a.x=Math.floor(h.x),a.y=Math.floor(h.y),a};bi.min=function(a,h,v){return a.x=Math.min(h.x,v.x),a.y=Math.min(h.y,v.y),a};bi.max=function(a,h,v){return a.x=Math.max(h.x,v.x),a.y=Math.max(h.y,v.y),a};bi.round=function(a,h){return a.x=Math.round(h.x),a.y=Math.round(h.y),a};bi.scale=function(a,h,v){return a.x=h.x*v,a.y=h.y*v,a};bi.scaleAndAdd=function(a,h,v,_){return a.x=h.x+v.x*_,a.y=h.y+v.y*_,a};bi.distance=function(a,h){let v=h.x-a.x,_=h.y-a.y;return Math.sqrt(v*v+_*_)};bi.dist=bi.distance;bi.squaredDistance=function(a,h){let v=h.x-a.x,_=h.y-a.y;return v*v+_*_};bi.sqrDist=bi.squaredDistance;bi.length=function(a){let h=a.x,v=a.y;return Math.sqrt(h*h+v*v)};bi.len=bi.length;bi.squaredLength=function(a){let h=a.x,v=a.y;return h*h+v*v};bi.sqrLen=bi.squaredLength;bi.negate=function(a,h){return a.x=-h.x,a.y=-h.y,a};bi.inverse=function(a,h){return a.x=1/h.x,a.y=1/h.y,a};bi.inverseSafe=function(a,h){let v=h.x,_=h.y;return Math.abs(v)<ti?a.x=0:a.x=1/v,Math.abs(_)<ti?a.y=0:a.y=1/h.y,a};bi.normalize=function(a,h){let v=h.x,_=h.y,k=v*v+_*_;return k>0&&(k=1/Math.sqrt(k),a.x=h.x*k,a.y=h.y*k),a};bi.dot=function(a,h){return a.x*h.x+a.y*h.y};bi.cross=function(a,h,v){let _=h.x*v.y-h.y*v.x;return a.x=a.y=0,a.z=_,a};bi.lerp=function(a,h,v,_){let k=h.x,b=h.y;return a.x=k+_*(v.x-k),a.y=b+_*(v.y-b),a};bi.random=function(a,h){h=h||1;let v=ul()*2*Math.PI;return a.x=Math.cos(v)*h,a.y=Math.sin(v)*h,a};bi.transformMat2=function(a,h,v){let _=h.x,k=h.y;return a.x=v.m00*_+v.m02*k,a.y=v.m01*_+v.m03*k,a};bi.transformMat23=function(a,h,v){let _=h.x,k=h.y;return a.x=v.m00*_+v.m02*k+v.m04,a.y=v.m01*_+v.m03*k+v.m05,a};bi.transformMat3=function(a,h,v){let _=h.x,k=h.y;return a.x=v.m00*_+v.m03*k+v.m06,a.y=v.m01*_+v.m04*k+v.m07,a};bi.transformMat4=function(a,h,v){let _=h.x,k=h.y;return a.x=v.m00*_+v.m04*k+v.m12,a.y=v.m01*_+v.m05*k+v.m13,a};bi.forEach=function(){let a=bi.create();return function(h,v,_,k,b,T){let t,S;for(v||(v=2),_||(_=0),k?S=Math.min(k*v+_,h.length):S=h.length,t=_;t<S;t+=v)a.x=h[t],a.y=h[t+1],b(a,a,T),h[t]=a.x,h[t+1]=a.y;return h}}();bi.str=function(a){return`vec2(${a.x}, ${a.y})`};bi.array=function(a,h){return a[0]=h.x,a[1]=h.y,a};bi.exactEquals=function(a,h){return a.x===h.x&&a.y===h.y};bi.equals=function(a,h){let v=a.x,_=a.y,k=h.x,b=h.y;return Math.abs(v-k)<=ti*Math.max(1,Math.abs(v),Math.abs(k))&&Math.abs(_-b)<=ti*Math.max(1,Math.abs(_),Math.abs(b))};let zp=new Array(3);class Gy{constructor(h,v,_){this.x=h,this.y=v,this.z=_}toJSON(){return zp[0]=this.x,zp[1]=this.y,zp[2]=this.z,zp}}let $r={};$r.create=function(){return new Gy(0,0,0)};$r.new=function(a,h,v){return new Gy(a,h,v)};$r.clone=function(a){return new Gy(a.x,a.y,a.z)};$r.copy=function(a,h){return a.x=h.x,a.y=h.y,a.z=h.z,a};$r.set=function(a,h,v,_){return a.x=h,a.y=v,a.z=_,a};$r.add=function(a,h,v){return a.x=h.x+v.x,a.y=h.y+v.y,a.z=h.z+v.z,a};$r.subtract=function(a,h,v){return a.x=h.x-v.x,a.y=h.y-v.y,a.z=h.z-v.z,a};$r.sub=$r.subtract;$r.multiply=function(a,h,v){return a.x=h.x*v.x,a.y=h.y*v.y,a.z=h.z*v.z,a};$r.mul=$r.multiply;$r.divide=function(a,h,v){return a.x=h.x/v.x,a.y=h.y/v.y,a.z=h.z/v.z,a};$r.div=$r.divide;$r.ceil=function(a,h){return a.x=Math.ceil(h.x),a.y=Math.ceil(h.y),a.z=Math.ceil(h.z),a};$r.floor=function(a,h){return a.x=Math.floor(h.x),a.y=Math.floor(h.y),a.z=Math.floor(h.z),a};$r.min=function(a,h,v){return a.x=Math.min(h.x,v.x),a.y=Math.min(h.y,v.y),a.z=Math.min(h.z,v.z),a};$r.max=function(a,h,v){return a.x=Math.max(h.x,v.x),a.y=Math.max(h.y,v.y),a.z=Math.max(h.z,v.z),a};$r.round=function(a,h){return a.x=Math.round(h.x),a.y=Math.round(h.y),a.z=Math.round(h.z),a};$r.scale=function(a,h,v){return a.x=h.x*v,a.y=h.y*v,a.z=h.z*v,a};$r.scaleAndAdd=function(a,h,v,_){return a.x=h.x+v.x*_,a.y=h.y+v.y*_,a.z=h.z+v.z*_,a};$r.distance=function(a,h){let v=h.x-a.x,_=h.y-a.y,k=h.z-a.z;return Math.sqrt(v*v+_*_+k*k)};$r.dist=$r.distance;$r.squaredDistance=function(a,h){let v=h.x-a.x,_=h.y-a.y,k=h.z-a.z;return v*v+_*_+k*k};$r.sqrDist=$r.squaredDistance;$r.length=function(a){let h=a.x,v=a.y,_=a.z;return Math.sqrt(h*h+v*v+_*_)};$r.len=$r.length;$r.squaredLength=function(a){let h=a.x,v=a.y,_=a.z;return h*h+v*v+_*_};$r.sqrLen=$r.squaredLength;$r.negate=function(a,h){return a.x=-h.x,a.y=-h.y,a.z=-h.z,a};$r.inverse=function(a,h){return a.x=1/h.x,a.y=1/h.y,a.z=1/h.z,a};$r.inverseSafe=function(a,h){let v=h.x,_=h.y,k=h.z;return Math.abs(v)<ti?a.x=0:a.x=1/v,Math.abs(_)<ti?a.y=0:a.y=1/_,Math.abs(k)<ti?a.z=0:a.z=1/k,a};$r.normalize=function(a,h){let v=h.x,_=h.y,k=h.z,b=v*v+_*_+k*k;return b>0&&(b=1/Math.sqrt(b),a.x=v*b,a.y=_*b,a.z=k*b),a};$r.dot=function(a,h){return a.x*h.x+a.y*h.y+a.z*h.z};$r.cross=function(a,h,v){let _=h.x,k=h.y,b=h.z,T=v.x,t=v.y,S=v.z;return a.x=k*S-b*t,a.y=b*T-_*S,a.z=_*t-k*T,a};$r.lerp=function(a,h,v,_){let k=h.x,b=h.y,T=h.z;return a.x=k+_*(v.x-k),a.y=b+_*(v.y-b),a.z=T+_*(v.z-T),a};$r.hermite=function(a,h,v,_,k,b){let T=b*b,t=T*(2*b-3)+1,S=T*(b-2)+b,D=T*(b-1),w=T*(3-2*b);return a.x=h.x*t+v.x*S+_.x*D+k.x*w,a.y=h.y*t+v.y*S+_.y*D+k.y*w,a.z=h.z*t+v.z*S+_.z*D+k.z*w,a};$r.bezier=function(a,h,v,_,k,b){let T=1-b,t=T*T,S=b*b,D=t*T,w=3*b*t,E=3*S*T,m=S*b;return a.x=h.x*D+v.x*w+_.x*E+k.x*m,a.y=h.y*D+v.y*w+_.y*E+k.y*m,a.z=h.z*D+v.z*w+_.z*E+k.z*m,a};$r.random=function(a,h){h=h||1;let v=ul()*2*Math.PI,_=ul()*2-1,k=Math.sqrt(1-_*_)*h;return a.x=Math.cos(v)*k,a.y=Math.sin(v)*k,a.z=_*h,a};$r.transformMat4=function(a,h,v){let _=h.x,k=h.y,b=h.z,T=v.m03*_+v.m07*k+v.m11*b+v.m15;return T=T||1,a.x=(v.m00*_+v.m04*k+v.m08*b+v.m12)/T,a.y=(v.m01*_+v.m05*k+v.m09*b+v.m13)/T,a.z=(v.m02*_+v.m06*k+v.m10*b+v.m14)/T,a};$r.transformMat3=function(a,h,v){let _=h.x,k=h.y,b=h.z;return a.x=_*v.m00+k*v.m03+b*v.m06,a.y=_*v.m01+k*v.m04+b*v.m07,a.z=_*v.m02+k*v.m05+b*v.m08,a};$r.transformQuat=function(a,h,v){let _=h.x,k=h.y,b=h.z,T=v.x,t=v.y,S=v.z,D=v.w,w=D*_+t*b-S*k,E=D*k+S*_-T*b,m=D*b+T*k-t*_,y=-T*_-t*k-S*b;return a.x=w*D+y*-T+E*-S-m*-t,a.y=E*D+y*-t+m*-T-w*-S,a.z=m*D+y*-S+w*-t-E*-T,a};$r.rotateX=function(a,h,v,_){let k=[],b=[];return k.x=h.x-v.x,k.y=h.y-v.y,k.z=h.z-v.z,b.x=k.x,b.y=k.y*Math.cos(_)-k.z*Math.sin(_),b.z=k.y*Math.sin(_)+k.z*Math.cos(_),a.x=b.x+v.x,a.y=b.y+v.y,a.z=b.z+v.z,a};$r.rotateY=function(a,h,v,_){let k=[],b=[];return k.x=h.x-v.x,k.y=h.y-v.y,k.z=h.z-v.z,b.x=k.z*Math.sin(_)+k.x*Math.cos(_),b.y=k.y,b.z=k.z*Math.cos(_)-k.x*Math.sin(_),a.x=b.x+v.x,a.y=b.y+v.y,a.z=b.z+v.z,a};$r.rotateZ=function(a,h,v,_){let k=[],b=[];return k.x=h.x-v.x,k.y=h.y-v.y,k.z=h.z-v.z,b.x=k.x*Math.cos(_)-k.y*Math.sin(_),b.y=k.x*Math.sin(_)+k.y*Math.cos(_),b.z=k.z,a.x=b.x+v.x,a.y=b.y+v.y,a.z=b.z+v.z,a};$r.forEach=function(){let a=$r.create();return function(h,v,_,k,b,T){let t,S;for(v||(v=3),_||(_=0),k?S=Math.min(k*v+_,h.length):S=h.length,t=_;t<S;t+=v)a.x=h[t],a.y=h[t+1],a.z=h[t+2],b(a,a,T),h[t]=a.x,h[t+1]=a.y,h[t+2]=a.z;return h}}();$r.angle=function(){let a=$r.create(),h=$r.create();return function(v,_){$r.copy(a,v),$r.copy(h,_),$r.normalize(a,a),$r.normalize(h,h);let k=$r.dot(a,h);return k>1?0:k<-1?Math.PI:Math.acos(k)}}();$r.str=function(a){return`vec3(${a.x}, ${a.y}, ${a.z})`};$r.array=function(a,h){return a[0]=h.x,a[1]=h.y,a[2]=h.z,a};$r.exactEquals=function(a,h){return a.x===h.x&&a.y===h.y&&a.z===h.z};$r.equals=function(a,h){let v=a.x,_=a.y,k=a.z,b=h.x,T=h.y,t=h.z;return Math.abs(v-b)<=ti*Math.max(1,Math.abs(v),Math.abs(b))&&Math.abs(_-T)<=ti*Math.max(1,Math.abs(_),Math.abs(T))&&Math.abs(k-t)<=ti*Math.max(1,Math.abs(k),Math.abs(t))};let Sf=new Array(4);class Hy{constructor(h,v,_,k){this.x=h,this.y=v,this.z=_,this.w=k}toJSON(){return Sf[0]=this.x,Sf[1]=this.y,Sf[2]=this.z,Sf[3]=this.w,Sf}}let fi={};fi.create=function(){return new Hy(0,0,0,0)};fi.new=function(a,h,v,_){return new Hy(a,h,v,_)};fi.clone=function(a){return new Hy(a.x,a.y,a.z,a.w)};fi.copy=function(a,h){return a.x=h.x,a.y=h.y,a.z=h.z,a.w=h.w,a};fi.set=function(a,h,v,_,k){return a.x=h,a.y=v,a.z=_,a.w=k,a};fi.add=function(a,h,v){return a.x=h.x+v.x,a.y=h.y+v.y,a.z=h.z+v.z,a.w=h.w+v.w,a};fi.subtract=function(a,h,v){return a.x=h.x-v.x,a.y=h.y-v.y,a.z=h.z-v.z,a.w=h.w-v.w,a};fi.sub=fi.subtract;fi.multiply=function(a,h,v){return a.x=h.x*v.x,a.y=h.y*v.y,a.z=h.z*v.z,a.w=h.w*v.w,a};fi.mul=fi.multiply;fi.divide=function(a,h,v){return a.x=h.x/v.x,a.y=h.y/v.y,a.z=h.z/v.z,a.w=h.w/v.w,a};fi.div=fi.divide;fi.ceil=function(a,h){return a.x=Math.ceil(h.x),a.y=Math.ceil(h.y),a.z=Math.ceil(h.z),a.w=Math.ceil(h.w),a};fi.floor=function(a,h){return a.x=Math.floor(h.x),a.y=Math.floor(h.y),a.z=Math.floor(h.z),a.w=Math.floor(h.w),a};fi.min=function(a,h,v){return a.x=Math.min(h.x,v.x),a.y=Math.min(h.y,v.y),a.z=Math.min(h.z,v.z),a.w=Math.min(h.w,v.w),a};fi.max=function(a,h,v){return a.x=Math.max(h.x,v.x),a.y=Math.max(h.y,v.y),a.z=Math.max(h.z,v.z),a.w=Math.max(h.w,v.w),a};fi.round=function(a,h){return a.x=Math.round(h.x),a.y=Math.round(h.y),a.z=Math.round(h.z),a.w=Math.round(h.w),a};fi.scale=function(a,h,v){return a.x=h.x*v,a.y=h.y*v,a.z=h.z*v,a.w=h.w*v,a};fi.scaleAndAdd=function(a,h,v,_){return a.x=h.x+v.x*_,a.y=h.y+v.y*_,a.z=h.z+v.z*_,a.w=h.w+v.w*_,a};fi.distance=function(a,h){let v=h.x-a.x,_=h.y-a.y,k=h.z-a.z,b=h.w-a.w;return Math.sqrt(v*v+_*_+k*k+b*b)};fi.dist=fi.distance;fi.squaredDistance=function(a,h){let v=h.x-a.x,_=h.y-a.y,k=h.z-a.z,b=h.w-a.w;return v*v+_*_+k*k+b*b};fi.sqrDist=fi.squaredDistance;fi.length=function(a){let h=a.x,v=a.y,_=a.z,k=a.w;return Math.sqrt(h*h+v*v+_*_+k*k)};fi.len=fi.length;fi.squaredLength=function(a){let h=a.x,v=a.y,_=a.z,k=a.w;return h*h+v*v+_*_+k*k};fi.sqrLen=fi.squaredLength;fi.negate=function(a,h){return a.x=-h.x,a.y=-h.y,a.z=-h.z,a.w=-h.w,a};fi.inverse=function(a,h){return a.x=1/h.x,a.y=1/h.y,a.z=1/h.z,a.w=1/h.w,a};fi.inverseSafe=function(a,h){let v=h.x,_=h.y,k=h.z,b=h.w;return Math.abs(v)<ti?a.x=0:a.x=1/v,Math.abs(_)<ti?a.y=0:a.y=1/_,Math.abs(k)<ti?a.z=0:a.z=1/k,Math.abs(b)<ti?a.w=0:a.w=1/b,a};fi.normalize=function(a,h){let v=h.x,_=h.y,k=h.z,b=h.w,T=v*v+_*_+k*k+b*b;return T>0&&(T=1/Math.sqrt(T),a.x=v*T,a.y=_*T,a.z=k*T,a.w=b*T),a};fi.dot=function(a,h){return a.x*h.x+a.y*h.y+a.z*h.z+a.w*h.w};fi.lerp=function(a,h,v,_){let k=h.x,b=h.y,T=h.z,t=h.w;return a.x=k+_*(v.x-k),a.y=b+_*(v.y-b),a.z=T+_*(v.z-T),a.w=t+_*(v.w-t),a};fi.random=function(a,h){return h=h||1,a.x=ul(),a.y=ul(),a.z=ul(),a.w=ul(),fi.normalize(a,a),fi.scale(a,a,h),a};fi.transformMat4=function(a,h,v){let _=h.x,k=h.y,b=h.z,T=h.w;return a.x=v.m00*_+v.m04*k+v.m08*b+v.m12*T,a.y=v.m01*_+v.m05*k+v.m09*b+v.m13*T,a.z=v.m02*_+v.m06*k+v.m10*b+v.m14*T,a.w=v.m03*_+v.m07*k+v.m11*b+v.m15*T,a};fi.transformQuat=function(a,h,v){let _=h.x,k=h.y,b=h.z,T=v.x,t=v.y,S=v.z,D=v.w,w=D*_+t*b-S*k,E=D*k+S*_-T*b,m=D*b+T*k-t*_,y=-T*_-t*k-S*b;return a.x=w*D+y*-T+E*-S-m*-t,a.y=E*D+y*-t+m*-T-w*-S,a.z=m*D+y*-S+w*-t-E*-T,a.w=h.w,a};fi.forEach=function(){let a=fi.create();return function(h,v,_,k,b,T){let t,S;for(v||(v=4),_||(_=0),k?S=Math.min(k*v+_,h.length):S=h.length,t=_;t<S;t+=v)a.x=h[t],a.y=h[t+1],a.z=h[t+2],a.w=h[t+3],b(a,a,T),h[t]=a.x,h[t+1]=a.y,h[t+2]=a.z,h[t+3]=a.w;return h}}();fi.str=function(a){return`vec4(${a.x}, ${a.y}, ${a.z}, ${a.w})`};fi.array=function(a,h){return a[0]=h.x,a[1]=h.y,a[2]=h.z,a[3]=h.w,a};fi.exactEquals=function(a,h){return a.x===h.x&&a.y===h.y&&a.z===h.z&&a.w===h.w};fi.equals=function(a,h){let v=a.x,_=a.y,k=a.z,b=a.w,T=h.x,t=h.y,S=h.z,D=h.w;return Math.abs(v-T)<=ti*Math.max(1,Math.abs(v),Math.abs(T))&&Math.abs(_-t)<=ti*Math.max(1,Math.abs(_),Math.abs(t))&&Math.abs(k-S)<=ti*Math.max(1,Math.abs(k),Math.abs(S))&&Math.abs(b-D)<=ti*Math.max(1,Math.abs(b),Math.abs(D))};let Go=new Array(9);class qy{constructor(h,v,_,k,b,T,t,S,D){this.m00=h,this.m01=v,this.m02=_,this.m03=k,this.m04=b,this.m05=T,this.m06=t,this.m07=S,this.m08=D}toJSON(){return Go[0]=this.m00,Go[1]=this.m01,Go[2]=this.m02,Go[3]=this.m03,Go[4]=this.m04,Go[5]=this.m05,Go[6]=this.m06,Go[7]=this.m07,Go[8]=this.m08,Go}}let Oi={};Oi.create=function(){return new qy(1,0,0,0,1,0,0,0,1)};Oi.new=function(a,h,v,_,k,b,T,t,S){return new qy(a,h,v,_,k,b,T,t,S)};Oi.clone=function(a){return new qy(a.m00,a.m01,a.m02,a.m03,a.m04,a.m05,a.m06,a.m07,a.m08)};Oi.copy=function(a,h){return a.m00=h.m00,a.m01=h.m01,a.m02=h.m02,a.m03=h.m03,a.m04=h.m04,a.m05=h.m05,a.m06=h.m06,a.m07=h.m07,a.m08=h.m08,a};Oi.set=function(a,h,v,_,k,b,T,t,S,D){return a.m00=h,a.m01=v,a.m02=_,a.m03=k,a.m04=b,a.m05=T,a.m06=t,a.m07=S,a.m08=D,a};Oi.identity=function(a){return a.m00=1,a.m01=0,a.m02=0,a.m03=0,a.m04=1,a.m05=0,a.m06=0,a.m07=0,a.m08=1,a};Oi.transpose=function(a,h){if(a===h){let v=h.m01,_=h.m02,k=h.m05;a.m01=h.m03,a.m02=h.m06,a.m03=v,a.m05=h.m07,a.m06=_,a.m07=k}else a.m00=h.m00,a.m01=h.m03,a.m02=h.m06,a.m03=h.m01,a.m04=h.m04,a.m05=h.m07,a.m06=h.m02,a.m07=h.m05,a.m08=h.m08;return a};Oi.invert=function(a,h){let v=h.m00,_=h.m01,k=h.m02,b=h.m03,T=h.m04,t=h.m05,S=h.m06,D=h.m07,w=h.m08,E=w*T-t*D,m=-w*b+t*S,y=D*b-T*S,p=v*E+_*m+k*y;return p?(p=1/p,a.m00=E*p,a.m01=(-w*_+k*D)*p,a.m02=(t*_-k*T)*p,a.m03=m*p,a.m04=(w*v-k*S)*p,a.m05=(-t*v+k*b)*p,a.m06=y*p,a.m07=(-D*v+_*S)*p,a.m08=(T*v-_*b)*p,a):null};Oi.adjoint=function(a,h){let v=h.m00,_=h.m01,k=h.m02,b=h.m03,T=h.m04,t=h.m05,S=h.m06,D=h.m07,w=h.m08;return a.m00=T*w-t*D,a.m01=k*D-_*w,a.m02=_*t-k*T,a.m03=t*S-b*w,a.m04=v*w-k*S,a.m05=k*b-v*t,a.m06=b*D-T*S,a.m07=_*S-v*D,a.m08=v*T-_*b,a};Oi.determinant=function(a){let h=a.m00,v=a.m01,_=a.m02,k=a.m03,b=a.m04,T=a.m05,t=a.m06,S=a.m07,D=a.m08;return h*(D*b-T*S)+v*(-D*k+T*t)+_*(S*k-b*t)};Oi.multiply=function(a,h,v){let _=h.m00,k=h.m01,b=h.m02,T=h.m03,t=h.m04,S=h.m05,D=h.m06,w=h.m07,E=h.m08,m=v.m00,y=v.m01,p=v.m02,C=v.m03,z=v.m04,A=v.m05,P=v.m06,x=v.m07,O=v.m08;return a.m00=m*_+y*T+p*D,a.m01=m*k+y*t+p*w,a.m02=m*b+y*S+p*E,a.m03=C*_+z*T+A*D,a.m04=C*k+z*t+A*w,a.m05=C*b+z*S+A*E,a.m06=P*_+x*T+O*D,a.m07=P*k+x*t+O*w,a.m08=P*b+x*S+O*E,a};Oi.mul=Oi.multiply;Oi.translate=function(a,h,v){let _=h.m00,k=h.m01,b=h.m02,T=h.m03,t=h.m04,S=h.m05,D=h.m06,w=h.m07,E=h.m08,m=v.x,y=v.y;return a.m00=_,a.m01=k,a.m02=b,a.m03=T,a.m04=t,a.m05=S,a.m06=m*_+y*T+D,a.m07=m*k+y*t+w,a.m08=m*b+y*S+E,a};Oi.rotate=function(a,h,v){let _=h.m00,k=h.m01,b=h.m02,T=h.m03,t=h.m04,S=h.m05,D=h.m06,w=h.m07,E=h.m08,m=Math.sin(v),y=Math.cos(v);return a.m00=y*_+m*T,a.m01=y*k+m*t,a.m02=y*b+m*S,a.m03=y*T-m*_,a.m04=y*t-m*k,a.m05=y*S-m*b,a.m06=D,a.m07=w,a.m08=E,a};Oi.scale=function(a,h,v){let _=v.x,k=v.y;return a.m00=_*h.m00,a.m01=_*h.m01,a.m02=_*h.m02,a.m03=k*h.m03,a.m04=k*h.m04,a.m05=k*h.m05,a.m06=h.m06,a.m07=h.m07,a.m08=h.m08,a};Oi.fromMat4=function(a,h){return a.m00=h.m00,a.m01=h.m01,a.m02=h.m02,a.m03=h.m04,a.m04=h.m05,a.m05=h.m06,a.m06=h.m08,a.m07=h.m09,a.m08=h.m10,a};Oi.fromTranslation=function(a,h){return a.m00=1,a.m01=0,a.m02=0,a.m03=0,a.m04=1,a.m05=0,a.m06=h.x,a.m07=h.y,a.m08=1,a};Oi.fromRotation=function(a,h){let v=Math.sin(h),_=Math.cos(h);return a.m00=_,a.m01=v,a.m02=0,a.m03=-v,a.m04=_,a.m05=0,a.m06=0,a.m07=0,a.m08=1,a};Oi.fromScaling=function(a,h){return a.m00=h.x,a.m01=0,a.m02=0,a.m03=0,a.m04=h.y,a.m05=0,a.m06=0,a.m07=0,a.m08=1,a};Oi.fromMat2d=function(a,h){return a.m00=h.m00,a.m01=h.m01,a.m02=0,a.m03=h.m02,a.m04=h.m03,a.m05=0,a.m06=h.m04,a.m07=h.m05,a.m08=1,a};Oi.fromQuat=function(a,h){let v=h.x,_=h.y,k=h.z,b=h.w,T=v+v,t=_+_,S=k+k,D=v*T,w=_*T,E=_*t,m=k*T,y=k*t,p=k*S,C=b*T,z=b*t,A=b*S;return a.m00=1-E-p,a.m03=w-A,a.m06=m+z,a.m01=w+A,a.m04=1-D-p,a.m07=y-C,a.m02=m-z,a.m05=y+C,a.m08=1-D-E,a};Oi.fromViewUp=function(){let a=$r.new(0,1,0),h=$r.create(),v=$r.create();return function(_,k,b){return $r.sqrLen(k)<ti*ti||(b=b||a,$r.cross(h,b,k),$r.sqrLen(h)<ti*ti)?(Oi.identity(_),_):($r.cross(v,k,h),Oi.set(_,h.x,h.y,h.z,v.x,v.y,v.z,k.x,k.y,k.z),_)}}();Oi.normalFromMat4=function(a,h){let v=h.m00,_=h.m01,k=h.m02,b=h.m03,T=h.m04,t=h.m05,S=h.m06,D=h.m07,w=h.m08,E=h.m09,m=h.m10,y=h.m11,p=h.m12,C=h.m13,z=h.m14,A=h.m15,P=v*t-_*T,x=v*S-k*T,O=v*D-b*T,U=_*S-k*t,G=_*D-b*t,Z=k*D-b*S,X=w*C-E*p,W=w*z-m*p,J=w*A-y*p,re=E*z-m*C,te=E*A-y*C,ye=m*A-y*z,ue=P*ye-x*te+O*re+U*J-G*W+Z*X;return ue?(ue=1/ue,a.m00=(t*ye-S*te+D*re)*ue,a.m01=(S*J-T*ye-D*W)*ue,a.m02=(T*te-t*J+D*X)*ue,a.m03=(k*te-_*ye-b*re)*ue,a.m04=(v*ye-k*J+b*W)*ue,a.m05=(_*J-v*te-b*X)*ue,a.m06=(C*Z-z*G+A*U)*ue,a.m07=(z*O-p*Z-A*x)*ue,a.m08=(p*G-C*O+A*P)*ue,a):null};Oi.str=function(a){return`mat3(${a.m00}, ${a.m01}, ${a.m02}, ${a.m03}, ${a.m04}, ${a.m05}, ${a.m06}, ${a.m07}, ${a.m08})`};Oi.array=function(a,h){return a[0]=h.m00,a[1]=h.m01,a[2]=h.m02,a[3]=h.m03,a[4]=h.m04,a[5]=h.m05,a[6]=h.m06,a[7]=h.m07,a[8]=h.m08,a};Oi.frob=function(a){return Math.sqrt(Math.pow(a.m00,2)+Math.pow(a.m01,2)+Math.pow(a.m02,2)+Math.pow(a.m03,2)+Math.pow(a.m04,2)+Math.pow(a.m05,2)+Math.pow(a.m06,2)+Math.pow(a.m07,2)+Math.pow(a.m08,2))};Oi.add=function(a,h,v){return a.m00=h.m00+v.m00,a.m01=h.m01+v.m01,a.m02=h.m02+v.m02,a.m03=h.m03+v.m03,a.m04=h.m04+v.m04,a.m05=h.m05+v.m05,a.m06=h.m06+v.m06,a.m07=h.m07+v.m07,a.m08=h.m08+v.m08,a};Oi.subtract=function(a,h,v){return a.m00=h.m00-v.m00,a.m01=h.m01-v.m01,a.m02=h.m02-v.m02,a.m03=h.m03-v.m03,a.m04=h.m04-v.m04,a.m05=h.m05-v.m05,a.m06=h.m06-v.m06,a.m07=h.m07-v.m07,a.m08=h.m08-v.m08,a};Oi.sub=Oi.subtract;Oi.multiplyScalar=function(a,h,v){return a.m00=h.m00*v,a.m01=h.m01*v,a.m02=h.m02*v,a.m03=h.m03*v,a.m04=h.m04*v,a.m05=h.m05*v,a.m06=h.m06*v,a.m07=h.m07*v,a.m08=h.m08*v,a};Oi.multiplyScalarAndAdd=function(a,h,v,_){return a.m00=h.m00+v.m00*_,a.m01=h.m01+v.m01*_,a.m02=h.m02+v.m02*_,a.m03=h.m03+v.m03*_,a.m04=h.m04+v.m04*_,a.m05=h.m05+v.m05*_,a.m06=h.m06+v.m06*_,a.m07=h.m07+v.m07*_,a.m08=h.m08+v.m08*_,a};Oi.exactEquals=function(a,h){return a.m00===h.m00&&a.m01===h.m01&&a.m02===h.m02&&a.m03===h.m03&&a.m04===h.m04&&a.m05===h.m05&&a.m06===h.m06&&a.m07===h.m07&&a.m08===h.m08};Oi.equals=function(a,h){let v=a.m00,_=a.m01,k=a.m02,b=a.m03,T=a.m04,t=a.m05,S=a.m06,D=a.m07,w=a.m08,E=h.m00,m=h.m01,y=h.m02,p=h.m03,C=h.m04,z=h.m05,A=h.m06,P=h.m07,x=h.m08;return Math.abs(v-E)<=ti*Math.max(1,Math.abs(v),Math.abs(E))&&Math.abs(_-m)<=ti*Math.max(1,Math.abs(_),Math.abs(m))&&Math.abs(k-y)<=ti*Math.max(1,Math.abs(k),Math.abs(y))&&Math.abs(b-p)<=ti*Math.max(1,Math.abs(b),Math.abs(p))&&Math.abs(T-C)<=ti*Math.max(1,Math.abs(T),Math.abs(C))&&Math.abs(t-z)<=ti*Math.max(1,Math.abs(t),Math.abs(z))&&Math.abs(S-A)<=ti*Math.max(1,Math.abs(S),Math.abs(A))&&Math.abs(D-P)<=ti*Math.max(1,Math.abs(D),Math.abs(P))&&Math.abs(w-x)<=ti*Math.max(1,Math.abs(w),Math.abs(x))};let Mf=new Array(4);class Wy{constructor(h,v,_,k){this.x=h,this.y=v,this.z=_,this.w=k}toJSON(){return Mf[0]=this.x,Mf[1]=this.y,Mf[2]=this.z,Mf[3]=this.w,Mf}}let mi={};mi.create=function(){return new Wy(0,0,0,1)};mi.new=function(a,h,v,_){return new Wy(a,h,v,_)};mi.clone=function(a){return new Wy(a.x,a.y,a.z,a.w)};mi.copy=fi.copy;mi.set=fi.set;mi.identity=function(a){return a.x=0,a.y=0,a.z=0,a.w=1,a};mi.rotationTo=function(){let a=$r.create(),h=$r.new(1,0,0),v=$r.new(0,1,0);return function(_,k,b){let T=$r.dot(k,b);return T<-.999999?($r.cross(a,h,k),$r.length(a)<1e-6&&$r.cross(a,v,k),$r.normalize(a,a),mi.fromAxisAngle(_,a,Math.PI),_):T>.999999?(_.x=0,_.y=0,_.z=0,_.w=1,_):($r.cross(a,k,b),_.x=a.x,_.y=a.y,_.z=a.z,_.w=1+T,mi.normalize(_,_))}}();mi.getAxisAngle=function(a,h){let v=Math.acos(h.w)*2,_=Math.sin(v/2);return _!=0?(a.x=h.x/_,a.y=h.y/_,a.z=h.z/_):(a.x=1,a.y=0,a.z=0),v};mi.multiply=function(a,h,v){let _=h.x,k=h.y,b=h.z,T=h.w,t=v.x,S=v.y,D=v.z,w=v.w;return a.x=_*w+T*t+k*D-b*S,a.y=k*w+T*S+b*t-_*D,a.z=b*w+T*D+_*S-k*t,a.w=T*w-_*t-k*S-b*D,a};mi.mul=mi.multiply;mi.scale=fi.scale;mi.rotateX=function(a,h,v){v*=.5;let _=h.x,k=h.y,b=h.z,T=h.w,t=Math.sin(v),S=Math.cos(v);return a.x=_*S+T*t,a.y=k*S+b*t,a.z=b*S-k*t,a.w=T*S-_*t,a};mi.rotateY=function(a,h,v){v*=.5;let _=h.x,k=h.y,b=h.z,T=h.w,t=Math.sin(v),S=Math.cos(v);return a.x=_*S-b*t,a.y=k*S+T*t,a.z=b*S+_*t,a.w=T*S-k*t,a};mi.rotateZ=function(a,h,v){v*=.5;let _=h.x,k=h.y,b=h.z,T=h.w,t=Math.sin(v),S=Math.cos(v);return a.x=_*S+k*t,a.y=k*S-_*t,a.z=b*S+T*t,a.w=T*S-b*t,a};mi.rotateAround=function(){let a=$r.create(),h=mi.create();return function(v,_,k,b){return mi.invert(h,_),$r.transformQuat(a,k,h),mi.fromAxisAngle(h,a,b),mi.mul(v,_,h),v}}();mi.rotateAroundLocal=function(){let a=mi.create();return function(h,v,_,k){return mi.fromAxisAngle(a,_,k),mi.mul(h,v,a),h}}();mi.calculateW=function(a,h){let v=h.x,_=h.y,k=h.z;return a.x=v,a.y=_,a.z=k,a.w=Math.sqrt(Math.abs(1-v*v-_*_-k*k)),a};mi.dot=fi.dot;mi.lerp=fi.lerp;mi.slerp=function(a,h,v,_){let k=h.x,b=h.y,T=h.z,t=h.w,S=v.x,D=v.y,w=v.z,E=v.w,m,y,p,C,z;return y=k*S+b*D+T*w+t*E,y<0&&(y=-y,S=-S,D=-D,w=-w,E=-E),1-y>1e-6?(m=Math.acos(y),p=Math.sin(m),C=Math.sin((1-_)*m)/p,z=Math.sin(_*m)/p):(C=1-_,z=_),a.x=C*k+z*S,a.y=C*b+z*D,a.z=C*T+z*w,a.w=C*t+z*E,a};mi.sqlerp=function(){let a=mi.create(),h=mi.create();return function(v,_,k,b,T,t){return mi.slerp(a,_,T,t),mi.slerp(h,k,b,t),mi.slerp(v,a,h,2*t*(1-t)),v}}();mi.invert=function(a,h){let v=h.x,_=h.y,k=h.z,b=h.w,T=v*v+_*_+k*k+b*b,t=T?1/T:0;return a.x=-v*t,a.y=-_*t,a.z=-k*t,a.w=b*t,a};mi.conjugate=function(a,h){return a.x=-h.x,a.y=-h.y,a.z=-h.z,a.w=h.w,a};mi.length=fi.length;mi.len=mi.length;mi.squaredLength=fi.squaredLength;mi.sqrLen=mi.squaredLength;mi.normalize=fi.normalize;mi.fromAxes=function(){let a=Oi.create();return function(h,v,_,k){return Oi.set(a,v.x,v.y,v.z,_.x,_.y,_.z,k.x,k.y,k.z),mi.normalize(h,mi.fromMat3(h,a))}}();mi.fromViewUp=function(){let a=Oi.create();return function(h,v,_){return Oi.fromViewUp(a,v,_),a?mi.normalize(h,mi.fromMat3(h,a)):null}}();mi.fromAxisAngle=function(a,h,v){v=v*.5;let _=Math.sin(v);return a.x=_*h.x,a.y=_*h.y,a.z=_*h.z,a.w=Math.cos(v),a};mi.fromMat3=function(a,h){let v=h.m00,_=h.m03,k=h.m06,b=h.m01,T=h.m04,t=h.m07,S=h.m02,D=h.m05,w=h.m08,E=v+T+w;if(E>0){let m=.5/Math.sqrt(E+1);a.w=.25/m,a.x=(D-t)*m,a.y=(k-S)*m,a.z=(b-_)*m}else if(v>T&&v>w){let m=2*Math.sqrt(1+v-T-w);a.w=(D-t)/m,a.x=.25*m,a.y=(_+b)/m,a.z=(k+S)/m}else if(T>w){let m=2*Math.sqrt(1+T-v-w);a.w=(k-S)/m,a.x=(_+b)/m,a.y=.25*m,a.z=(t+D)/m}else{let m=2*Math.sqrt(1+w-v-T);a.w=(b-_)/m,a.x=(k+S)/m,a.y=(t+D)/m,a.z=.25*m}return a};mi.fromEuler=function(a,h,v,_){let k=.5*Math.PI/180;h*=k,v*=k,_*=k;let b=Math.sin(h),T=Math.cos(h),t=Math.sin(v),S=Math.cos(v),D=Math.sin(_),w=Math.cos(_);return a.x=b*S*w-T*t*D,a.y=T*t*w+b*S*D,a.z=T*S*D-b*t*w,a.w=T*S*w+b*t*D,a};mi.str=function(a){return`quat(${a.x}, ${a.y}, ${a.z}, ${a.w})`};mi.array=function(a,h){return a[0]=h.x,a[1]=h.y,a[2]=h.z,a[3]=h.w,a};mi.exactEquals=fi.exactEquals;mi.equals=fi.equals;let Af=new Array(4);class $y{constructor(h,v,_,k){this.m00=h,this.m01=v,this.m02=_,this.m03=k}toJSON(){return Af[0]=this.m00,Af[1]=this.m01,Af[2]=this.m02,Af[3]=this.m03,Af}}let ln={};ln.create=function(){return new $y(1,0,0,1)};ln.new=function(a,h,v,_){return new $y(a,h,v,_)};ln.clone=function(a){return new $y(a.m00,a.m01,a.m02,a.m03)};ln.copy=function(a,h){return a.m00=h.m00,a.m01=h.m01,a.m02=h.m02,a.m03=h.m03,a};ln.identity=function(a){return a.m00=1,a.m01=0,a.m02=0,a.m03=1,a};ln.set=function(a,h,v,_,k){return a.m00=h,a.m01=v,a.m02=_,a.m03=k,a};ln.transpose=function(a,h){if(a===h){let v=h.m01;a.m01=h.m02,a.m02=v}else a.m00=h.m00,a.m01=h.m02,a.m02=h.m01,a.m03=h.m03;return a};ln.invert=function(a,h){let v=h.m00,_=h.m01,k=h.m02,b=h.m03,T=v*b-k*_;return T?(T=1/T,a.m00=b*T,a.m01=-_*T,a.m02=-k*T,a.m03=v*T,a):null};ln.adjoint=function(a,h){let v=h.m00;return a.m00=h.m03,a.m01=-h.m01,a.m02=-h.m02,a.m03=v,a};ln.determinant=function(a){return a.m00*a.m03-a.m02*a.m01};ln.multiply=function(a,h,v){let _=h.m00,k=h.m01,b=h.m02,T=h.m03,t=v.m00,S=v.m01,D=v.m02,w=v.m03;return a.m00=_*t+b*S,a.m01=k*t+T*S,a.m02=_*D+b*w,a.m03=k*D+T*w,a};ln.mul=ln.multiply;ln.rotate=function(a,h,v){let _=h.m00,k=h.m01,b=h.m02,T=h.m03,t=Math.sin(v),S=Math.cos(v);return a.m00=_*S+b*t,a.m01=k*S+T*t,a.m02=_*-t+b*S,a.m03=k*-t+T*S,a};ln.scale=function(a,h,v){let _=h.m00,k=h.m01,b=h.m02,T=h.m03,t=v.x,S=v.y;return a.m00=_*t,a.m01=k*t,a.m02=b*S,a.m03=T*S,a};ln.fromRotation=function(a,h){let v=Math.sin(h),_=Math.cos(h);return a.m00=_,a.m01=v,a.m02=-v,a.m03=_,a};ln.fromScaling=function(a,h){return a.m00=h.x,a.m01=0,a.m02=0,a.m03=h.y,a};ln.str=function(a){return`mat2(${a.m00}, ${a.m01}, ${a.m02}, ${a.m03})`};ln.array=function(a,h){return a[0]=h.m00,a[1]=h.m01,a[2]=h.m02,a[3]=h.m03,a};ln.frob=function(a){return Math.sqrt(Math.pow(a.m00,2)+Math.pow(a.m01,2)+Math.pow(a.m02,2)+Math.pow(a.m03,2))};ln.LDU=function(a,h,v,_){a.m02=_.m02/_.m00,v.m00=_.m00,v.m01=_.m01,v.m03=_.m03-a.m02*v.m01};ln.add=function(a,h,v){return a.m00=h.m00+v.m00,a.m01=h.m01+v.m01,a.m02=h.m02+v.m02,a.m03=h.m03+v.m03,a};ln.subtract=function(a,h,v){return a.m00=h.m00-v.m00,a.m01=h.m01-v.m01,a.m02=h.m02-v.m02,a.m03=h.m03-v.m03,a};ln.sub=ln.subtract;ln.exactEquals=function(a,h){return a.m00===h.m00&&a.m01===h.m01&&a.m02===h.m02&&a.m03===h.m03};ln.equals=function(a,h){let v=a.m00,_=a.m01,k=a.m02,b=a.m03,T=h.m00,t=h.m01,S=h.m02,D=h.m03;return Math.abs(v-T)<=ti*Math.max(1,Math.abs(v),Math.abs(T))&&Math.abs(_-t)<=ti*Math.max(1,Math.abs(_),Math.abs(t))&&Math.abs(k-S)<=ti*Math.max(1,Math.abs(k),Math.abs(S))&&Math.abs(b-D)<=ti*Math.max(1,Math.abs(b),Math.abs(D))};ln.multiplyScalar=function(a,h,v){return a.m00=h.m00*v,a.m01=h.m01*v,a.m02=h.m02*v,a.m03=h.m03*v,a};ln.multiplyScalarAndAdd=function(a,h,v,_){return a.m00=h.m00+v.m00*_,a.m01=h.m01+v.m01*_,a.m02=h.m02+v.m02*_,a.m03=h.m03+v.m03*_,a};let iu=new Array(6);class Zy{constructor(h,v,_,k,b,T){this.m00=h,this.m01=v,this.m02=_,this.m03=k,this.m04=b,this.m05=T}toJSON(){return iu[0]=this.m00,iu[1]=this.m01,iu[2]=this.m02,iu[3]=this.m03,iu[4]=this.m04,iu[5]=this.m05,iu}}let an={};an.create=function(){return new Zy(1,0,0,1,0,0)};an.new=function(a,h,v,_,k,b){return new Zy(a,h,v,_,k,b)};an.clone=function(a){return new Zy(a.m00,a.m01,a.m02,a.m03,a.m04,a.m05)};an.copy=function(a,h){return a.m00=h.m00,a.m01=h.m01,a.m02=h.m02,a.m03=h.m03,a.m04=h.m04,a.m05=h.m05,a};an.identity=function(a){return a.m00=1,a.m01=0,a.m02=0,a.m03=1,a.m04=0,a.m05=0,a};an.set=function(a,h,v,_,k,b,T){return a.m00=h,a.m01=v,a.m02=_,a.m03=k,a.m04=b,a.m05=T,a};an.invert=function(a,h){let v=h.m00,_=h.m01,k=h.m02,b=h.m03,T=h.m04,t=h.m05,S=v*b-_*k;return S?(S=1/S,a.m00=b*S,a.m01=-_*S,a.m02=-k*S,a.m03=v*S,a.m04=(k*t-b*T)*S,a.m05=(_*T-v*t)*S,a):null};an.determinant=function(a){return a.m00*a.m03-a.m01*a.m02};an.multiply=function(a,h,v){let _=h.m00,k=h.m01,b=h.m02,T=h.m03,t=h.m04,S=h.m05,D=v.m00,w=v.m01,E=v.m02,m=v.m03,y=v.m04,p=v.m05;return a.m00=_*D+b*w,a.m01=k*D+T*w,a.m02=_*E+b*m,a.m03=k*E+T*m,a.m04=_*y+b*p+t,a.m05=k*y+T*p+S,a};an.mul=an.multiply;an.rotate=function(a,h,v){let _=h.m00,k=h.m01,b=h.m02,T=h.m03,t=h.m04,S=h.m05,D=Math.sin(v),w=Math.cos(v);return a.m00=_*w+b*D,a.m01=k*w+T*D,a.m02=_*-D+b*w,a.m03=k*-D+T*w,a.m04=t,a.m05=S,a};an.scale=function(a,h,v){let _=h.m00,k=h.m01,b=h.m02,T=h.m03,t=h.m04,S=h.m05,D=v.x,w=v.y;return a.m00=_*D,a.m01=k*D,a.m02=b*w,a.m03=T*w,a.m04=t,a.m05=S,a};an.translate=function(a,h,v){let _=h.m00,k=h.m01,b=h.m02,T=h.m03,t=h.m04,S=h.m05,D=v.x,w=v.y;return a.m00=_,a.m01=k,a.m02=b,a.m03=T,a.m04=_*D+b*w+t,a.m05=k*D+T*w+S,a};an.fromRotation=function(a,h){let v=Math.sin(h),_=Math.cos(h);return a.m00=_,a.m01=v,a.m02=-v,a.m03=_,a.m04=0,a.m05=0,a};an.fromScaling=function(a,h){return a.m00=h.m00,a.m01=0,a.m02=0,a.m03=h.m01,a.m04=0,a.m05=0,a};an.fromTranslation=function(a,h){return a.m00=1,a.m01=0,a.m02=0,a.m03=1,a.m04=h.x,a.m05=h.y,a};an.fromRTS=function(a,h,v,_){let k=Math.sin(h),b=Math.cos(h);return a.m00=b*_.x,a.m01=k*_.x,a.m02=-k*_.y,a.m03=b*_.y,a.m04=v.x,a.m05=v.y,a};an.str=function(a){return`mat23(${a.m00}, ${a.m01}, ${a.m02}, ${a.m03}, ${a.m04}, ${a.m05})`};an.array=function(a,h){return a[0]=h.m00,a[1]=h.m01,a[2]=h.m02,a[3]=h.m03,a[4]=h.m04,a[5]=h.m05,a};an.array4x4=function(a,h){return a[0]=h.m00,a[1]=h.m01,a[2]=0,a[3]=0,a[4]=h.m02,a[5]=h.m03,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=h.m04,a[13]=h.m05,a[14]=0,a[15]=1,a};an.frob=function(a){return Math.sqrt(Math.pow(a.m00,2)+Math.pow(a.m01,2)+Math.pow(a.m02,2)+Math.pow(a.m03,2)+Math.pow(a.m04,2)+Math.pow(a.m05,2)+1)};an.add=function(a,h,v){return a.m00=h.m00+v.m00,a.m01=h.m01+v.m01,a.m02=h.m02+v.m02,a.m03=h.m03+v.m03,a.m04=h.m04+v.m04,a.m05=h.m05+v.m05,a};an.subtract=function(a,h,v){return a.m00=h.m00-v.m00,a.m01=h.m01-v.m01,a.m02=h.m02-v.m02,a.m03=h.m03-v.m03,a.m04=h.m04-v.m04,a.m05=h.m05-v.m05,a};an.sub=an.subtract;an.multiplyScalar=function(a,h,v){return a.m00=h.m00*v,a.m01=h.m01*v,a.m02=h.m02*v,a.m03=h.m03*v,a.m04=h.m04*v,a.m05=h.m05*v,a};an.multiplyScalarAndAdd=function(a,h,v,_){return a.m00=h.m00+v.m00*_,a.m01=h.m01+v.m01*_,a.m02=h.m02+v.m02*_,a.m03=h.m03+v.m03*_,a.m04=h.m04+v.m04*_,a.m05=h.m05+v.m05*_,a};an.exactEquals=function(a,h){return a.m00===h.m00&&a.m01===h.m01&&a.m02===h.m02&&a.m03===h.m03&&a.m04===h.m04&&a.m05===h.m05};an.equals=function(a,h){let v=a.m00,_=a.m01,k=a.m02,b=a.m03,T=a.m04,t=a.m05,S=h.m00,D=h.m01,w=h.m02,E=h.m03,m=h.m04,y=h.m05;return Math.abs(v-S)<=ti*Math.max(1,Math.abs(v),Math.abs(S))&&Math.abs(_-D)<=ti*Math.max(1,Math.abs(_),Math.abs(D))&&Math.abs(k-w)<=ti*Math.max(1,Math.abs(k),Math.abs(w))&&Math.abs(b-E)<=ti*Math.max(1,Math.abs(b),Math.abs(E))&&Math.abs(T-m)<=ti*Math.max(1,Math.abs(T),Math.abs(m))&&Math.abs(t-y)<=ti*Math.max(1,Math.abs(t),Math.abs(y))};let Qn=new Array(16);class Xy{constructor(h,v,_,k,b,T,t,S,D,w,E,m,y,p,C,z){this.m00=h,this.m01=v,this.m02=_,this.m03=k,this.m04=b,this.m05=T,this.m06=t,this.m07=S,this.m08=D,this.m09=w,this.m10=E,this.m11=m,this.m12=y,this.m13=p,this.m14=C,this.m15=z}toJSON(){return Qn[0]=this.m00,Qn[1]=this.m01,Qn[2]=this.m02,Qn[3]=this.m03,Qn[4]=this.m04,Qn[5]=this.m05,Qn[6]=this.m06,Qn[7]=this.m07,Qn[8]=this.m08,Qn[9]=this.m09,Qn[10]=this.m10,Qn[11]=this.m11,Qn[12]=this.m12,Qn[13]=this.m13,Qn[14]=this.m14,Qn[15]=this.m15,Qn}}let Ei={};Ei.create=function(){return new Xy(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)};Ei.new=function(a,h,v,_,k,b,T,t,S,D,w,E,m,y,p,C){return new Xy(a,h,v,_,k,b,T,t,S,D,w,E,m,y,p,C)};Ei.clone=function(a){return new Xy(a.m00,a.m01,a.m02,a.m03,a.m04,a.m05,a.m06,a.m07,a.m08,a.m09,a.m10,a.m11,a.m12,a.m13,a.m14,a.m15)};Ei.copy=function(a,h){return a.m00=h.m00,a.m01=h.m01,a.m02=h.m02,a.m03=h.m03,a.m04=h.m04,a.m05=h.m05,a.m06=h.m06,a.m07=h.m07,a.m08=h.m08,a.m09=h.m09,a.m10=h.m10,a.m11=h.m11,a.m12=h.m12,a.m13=h.m13,a.m14=h.m14,a.m15=h.m15,a};Ei.set=function(a,h,v,_,k,b,T,t,S,D,w,E,m,y,p,C,z){return a.m00=h,a.m01=v,a.m02=_,a.m03=k,a.m04=b,a.m05=T,a.m06=t,a.m07=S,a.m08=D,a.m09=w,a.m10=E,a.m11=m,a.m12=y,a.m13=p,a.m14=C,a.m15=z,a};Ei.identity=function(a){return a.m00=1,a.m01=0,a.m02=0,a.m03=0,a.m04=0,a.m05=1,a.m06=0,a.m07=0,a.m08=0,a.m09=0,a.m10=1,a.m11=0,a.m12=0,a.m13=0,a.m14=0,a.m15=1,a};Ei.transpose=function(a,h){if(a===h){let v=h.m01,_=h.m02,k=h.m03,b=h.m06,T=h.m07,t=h.m11;a.m01=h.m04,a.m02=h.m08,a.m03=h.m12,a.m04=v,a.m06=h.m09,a.m07=h.m13,a.m08=_,a.m09=b,a.m11=h.m14,a.m12=k,a.m13=T,a.m14=t}else a.m00=h.m00,a.m01=h.m04,a.m02=h.m08,a.m03=h.m12,a.m04=h.m01,a.m05=h.m05,a.m06=h.m09,a.m07=h.m13,a.m08=h.m02,a.m09=h.m06,a.m10=h.m10,a.m11=h.m14,a.m12=h.m03,a.m13=h.m07,a.m14=h.m11,a.m15=h.m15;return a};Ei.invert=function(a,h){let v=h.m00,_=h.m01,k=h.m02,b=h.m03,T=h.m04,t=h.m05,S=h.m06,D=h.m07,w=h.m08,E=h.m09,m=h.m10,y=h.m11,p=h.m12,C=h.m13,z=h.m14,A=h.m15,P=v*t-_*T,x=v*S-k*T,O=v*D-b*T,U=_*S-k*t,G=_*D-b*t,Z=k*D-b*S,X=w*C-E*p,W=w*z-m*p,J=w*A-y*p,re=E*z-m*C,te=E*A-y*C,ye=m*A-y*z,ue=P*ye-x*te+O*re+U*J-G*W+Z*X;return ue?(ue=1/ue,a.m00=(t*ye-S*te+D*re)*ue,a.m01=(k*te-_*ye-b*re)*ue,a.m02=(C*Z-z*G+A*U)*ue,a.m03=(m*G-E*Z-y*U)*ue,a.m04=(S*J-T*ye-D*W)*ue,a.m05=(v*ye-k*J+b*W)*ue,a.m06=(z*O-p*Z-A*x)*ue,a.m07=(w*Z-m*O+y*x)*ue,a.m08=(T*te-t*J+D*X)*ue,a.m09=(_*J-v*te-b*X)*ue,a.m10=(p*G-C*O+A*P)*ue,a.m11=(E*O-w*G-y*P)*ue,a.m12=(t*W-T*re-S*X)*ue,a.m13=(v*re-_*W+k*X)*ue,a.m14=(C*x-p*U-z*P)*ue,a.m15=(w*U-E*x+m*P)*ue,a):null};Ei.adjoint=function(a,h){let v=h.m00,_=h.m01,k=h.m02,b=h.m03,T=h.m04,t=h.m05,S=h.m06,D=h.m07,w=h.m08,E=h.m09,m=h.m10,y=h.m11,p=h.m12,C=h.m13,z=h.m14,A=h.m15;return a.m00=t*(m*A-y*z)-E*(S*A-D*z)+C*(S*y-D*m),a.m01=-(_*(m*A-y*z)-E*(k*A-b*z)+C*(k*y-b*m)),a.m02=_*(S*A-D*z)-t*(k*A-b*z)+C*(k*D-b*S),a.m03=-(_*(S*y-D*m)-t*(k*y-b*m)+E*(k*D-b*S)),a.m04=-(T*(m*A-y*z)-w*(S*A-D*z)+p*(S*y-D*m)),a.m05=v*(m*A-y*z)-w*(k*A-b*z)+p*(k*y-b*m),a.m06=-(v*(S*A-D*z)-T*(k*A-b*z)+p*(k*D-b*S)),a.m07=v*(S*y-D*m)-T*(k*y-b*m)+w*(k*D-b*S),a.m08=T*(E*A-y*C)-w*(t*A-D*C)+p*(t*y-D*E),a.m09=-(v*(E*A-y*C)-w*(_*A-b*C)+p*(_*y-b*E)),a.m10=v*(t*A-D*C)-T*(_*A-b*C)+p*(_*D-b*t),a.m11=-(v*(t*y-D*E)-T*(_*y-b*E)+w*(_*D-b*t)),a.m12=-(T*(E*z-m*C)-w*(t*z-S*C)+p*(t*m-S*E)),a.m13=v*(E*z-m*C)-w*(_*z-k*C)+p*(_*m-k*E),a.m14=-(v*(t*z-S*C)-T*(_*z-k*C)+p*(_*S-k*t)),a.m15=v*(t*m-S*E)-T*(_*m-k*E)+w*(_*S-k*t),a};Ei.determinant=function(a){let h=a.m00,v=a.m01,_=a.m02,k=a.m03,b=a.m04,T=a.m05,t=a.m06,S=a.m07,D=a.m08,w=a.m09,E=a.m10,m=a.m11,y=a.m12,p=a.m13,C=a.m14,z=a.m15,A=h*T-v*b,P=h*t-_*b,x=h*S-k*b,O=v*t-_*T,U=v*S-k*T,G=_*S-k*t,Z=D*p-w*y,X=D*C-E*y,W=D*z-m*y,J=w*C-E*p,re=w*z-m*p,te=E*z-m*C;return A*te-P*re+x*J+O*W-U*X+G*Z};Ei.multiply=function(a,h,v){let _=h.m00,k=h.m01,b=h.m02,T=h.m03,t=h.m04,S=h.m05,D=h.m06,w=h.m07,E=h.m08,m=h.m09,y=h.m10,p=h.m11,C=h.m12,z=h.m13,A=h.m14,P=h.m15,x=v.m00,O=v.m01,U=v.m02,G=v.m03;return a.m00=x*_+O*t+U*E+G*C,a.m01=x*k+O*S+U*m+G*z,a.m02=x*b+O*D+U*y+G*A,a.m03=x*T+O*w+U*p+G*P,x=v.m04,O=v.m05,U=v.m06,G=v.m07,a.m04=x*_+O*t+U*E+G*C,a.m05=x*k+O*S+U*m+G*z,a.m06=x*b+O*D+U*y+G*A,a.m07=x*T+O*w+U*p+G*P,x=v.m08,O=v.m09,U=v.m10,G=v.m11,a.m08=x*_+O*t+U*E+G*C,a.m09=x*k+O*S+U*m+G*z,a.m10=x*b+O*D+U*y+G*A,a.m11=x*T+O*w+U*p+G*P,x=v.m12,O=v.m13,U=v.m14,G=v.m15,a.m12=x*_+O*t+U*E+G*C,a.m13=x*k+O*S+U*m+G*z,a.m14=x*b+O*D+U*y+G*A,a.m15=x*T+O*w+U*p+G*P,a};Ei.mul=Ei.multiply;Ei.translate=function(a,h,v){let _=v.x,k=v.y,b=v.z,T,t,S,D,w,E,m,y,p,C,z,A;return h===a?(a.m12=h.m00*_+h.m04*k+h.m08*b+h.m12,a.m13=h.m01*_+h.m05*k+h.m09*b+h.m13,a.m14=h.m02*_+h.m06*k+h.m10*b+h.m14,a.m15=h.m03*_+h.m07*k+h.m11*b+h.m15):(T=h.m00,t=h.m01,S=h.m02,D=h.m03,w=h.m04,E=h.m05,m=h.m06,y=h.m07,p=h.m08,C=h.m09,z=h.m10,A=h.m11,a.m00=T,a.m01=t,a.m02=S,a.m03=D,a.m04=w,a.m05=E,a.m06=m,a.m07=y,a.m08=p,a.m09=C,a.m10=z,a.m11=A,a.m12=T*_+w*k+p*b+h.m12,a.m13=t*_+E*k+C*b+h.m13,a.m14=S*_+m*k+z*b+h.m14,a.m15=D*_+y*k+A*b+h.m15),a};Ei.scale=function(a,h,v){let _=v.x,k=v.y,b=v.z;return a.m00=h.m00*_,a.m01=h.m01*_,a.m02=h.m02*_,a.m03=h.m03*_,a.m04=h.m04*k,a.m05=h.m05*k,a.m06=h.m06*k,a.m07=h.m07*k,a.m08=h.m08*b,a.m09=h.m09*b,a.m10=h.m10*b,a.m11=h.m11*b,a.m12=h.m12,a.m13=h.m13,a.m14=h.m14,a.m15=h.m15,a};Ei.rotate=function(a,h,v,_){let k=_.x,b=_.y,T=_.z,t,S,D,w,E,m,y,p,C,z,A,P,x,O,U,G,Z,X,W,J,re,te,ye,ue,Se=Math.sqrt(k*k+b*b+T*T);return Math.abs(Se)<ti?null:(Se=1/Se,k*=Se,b*=Se,T*=Se,t=Math.sin(v),S=Math.cos(v),D=1-S,w=h.m00,E=h.m01,m=h.m02,y=h.m03,p=h.m04,C=h.m05,z=h.m06,A=h.m07,P=h.m08,x=h.m09,O=h.m10,U=h.m11,G=k*k*D+S,Z=b*k*D+T*t,X=T*k*D-b*t,W=k*b*D-T*t,J=b*b*D+S,re=T*b*D+k*t,te=k*T*D+b*t,ye=b*T*D-k*t,ue=T*T*D+S,a.m00=w*G+p*Z+P*X,a.m01=E*G+C*Z+x*X,a.m02=m*G+z*Z+O*X,a.m03=y*G+A*Z+U*X,a.m04=w*W+p*J+P*re,a.m05=E*W+C*J+x*re,a.m06=m*W+z*J+O*re,a.m07=y*W+A*J+U*re,a.m08=w*te+p*ye+P*ue,a.m09=E*te+C*ye+x*ue,a.m10=m*te+z*ye+O*ue,a.m11=y*te+A*ye+U*ue,h!==a&&(a.m12=h.m12,a.m13=h.m13,a.m14=h.m14,a.m15=h.m15),a)};Ei.rotateX=function(a,h,v){let _=Math.sin(v),k=Math.cos(v),b=h.m04,T=h.m05,t=h.m06,S=h.m07,D=h.m08,w=h.m09,E=h.m10,m=h.m11;return h!==a&&(a.m00=h.m00,a.m01=h.m01,a.m02=h.m02,a.m03=h.m03,a.m12=h.m12,a.m13=h.m13,a.m14=h.m14,a.m15=h.m15),a.m04=b*k+D*_,a.m05=T*k+w*_,a.m06=t*k+E*_,a.m07=S*k+m*_,a.m08=D*k-b*_,a.m09=w*k-T*_,a.m10=E*k-t*_,a.m11=m*k-S*_,a};Ei.rotateY=function(a,h,v){let _=Math.sin(v),k=Math.cos(v),b=h.m00,T=h.m01,t=h.m02,S=h.m03,D=h.m08,w=h.m09,E=h.m10,m=h.m11;return h!==a&&(a.m04=h.m04,a.m05=h.m05,a.m06=h.m06,a.m07=h.m07,a.m12=h.m12,a.m13=h.m13,a.m14=h.m14,a.m15=h.m15),a.m00=b*k-D*_,a.m01=T*k-w*_,a.m02=t*k-E*_,a.m03=S*k-m*_,a.m08=b*_+D*k,a.m09=T*_+w*k,a.m10=t*_+E*k,a.m11=S*_+m*k,a};Ei.rotateZ=function(a,h,v){let _=Math.sin(v),k=Math.cos(v),b=h.m00,T=h.m01,t=h.m02,S=h.m03,D=h.m04,w=h.m05,E=h.m06,m=h.m07;return h!==a&&(a.m08=h.m08,a.m09=h.m09,a.m10=h.m10,a.m11=h.m11,a.m12=h.m12,a.m13=h.m13,a.m14=h.m14,a.m15=h.m15),a.m00=b*k+D*_,a.m01=T*k+w*_,a.m02=t*k+E*_,a.m03=S*k+m*_,a.m04=D*k-b*_,a.m05=w*k-T*_,a.m06=E*k-t*_,a.m07=m*k-S*_,a};Ei.fromTranslation=function(a,h){return a.m00=1,a.m01=0,a.m02=0,a.m03=0,a.m04=0,a.m05=1,a.m06=0,a.m07=0,a.m08=0,a.m09=0,a.m10=1,a.m11=0,a.m12=h.x,a.m13=h.y,a.m14=h.z,a.m15=1,a};Ei.fromScaling=function(a,h){return a.m00=h.x,a.m01=0,a.m02=0,a.m03=0,a.m04=0,a.m05=h.y,a.m06=0,a.m07=0,a.m08=0,a.m09=0,a.m10=h.z,a.m11=0,a.m12=0,a.m13=0,a.m14=0,a.m15=1,a};Ei.fromRotation=function(a,h,v){let _=v.x,k=v.y,b=v.z,T=Math.sqrt(_*_+k*k+b*b),t,S,D;return Math.abs(T)<ti?null:(T=1/T,_*=T,k*=T,b*=T,t=Math.sin(h),S=Math.cos(h),D=1-S,a.m00=_*_*D+S,a.m01=k*_*D+b*t,a.m02=b*_*D-k*t,a.m03=0,a.m04=_*k*D-b*t,a.m05=k*k*D+S,a.m06=b*k*D+_*t,a.m07=0,a.m08=_*b*D+k*t,a.m09=k*b*D-_*t,a.m10=b*b*D+S,a.m11=0,a.m12=0,a.m13=0,a.m14=0,a.m15=1,a)};Ei.fromXRotation=function(a,h){let v=Math.sin(h),_=Math.cos(h);return a.m00=1,a.m01=0,a.m02=0,a.m03=0,a.m04=0,a.m05=_,a.m06=v,a.m07=0,a.m08=0,a.m09=-v,a.m10=_,a.m11=0,a.m12=0,a.m13=0,a.m14=0,a.m15=1,a};Ei.fromYRotation=function(a,h){let v=Math.sin(h),_=Math.cos(h);return a.m00=_,a.m01=0,a.m02=-v,a.m03=0,a.m04=0,a.m05=1,a.m06=0,a.m07=0,a.m08=v,a.m09=0,a.m10=_,a.m11=0,a.m12=0,a.m13=0,a.m14=0,a.m15=1,a};Ei.fromZRotation=function(a,h){let v=Math.sin(h),_=Math.cos(h);return a.m00=_,a.m01=v,a.m02=0,a.m03=0,a.m04=-v,a.m05=_,a.m06=0,a.m07=0,a.m08=0,a.m09=0,a.m10=1,a.m11=0,a.m12=0,a.m13=0,a.m14=0,a.m15=1,a};Ei.fromRT=function(a,h,v){let _=h.x,k=h.y,b=h.z,T=h.w,t=_+_,S=k+k,D=b+b,w=_*t,E=_*S,m=_*D,y=k*S,p=k*D,C=b*D,z=T*t,A=T*S,P=T*D;return a.m00=1-(y+C),a.m01=E+P,a.m02=m-A,a.m03=0,a.m04=E-P,a.m05=1-(w+C),a.m06=p+z,a.m07=0,a.m08=m+A,a.m09=p-z,a.m10=1-(w+y),a.m11=0,a.m12=v.x,a.m13=v.y,a.m14=v.z,a.m15=1,a};Ei.getTranslation=function(a,h){return a.x=h.m12,a.y=h.m13,a.z=h.m14,a};Ei.getScaling=function(a,h){let v=h.m00,_=h.m01,k=h.m02,b=h.m04,T=h.m05,t=h.m06,S=h.m08,D=h.m09,w=h.m10;return a.x=Math.sqrt(v*v+_*_+k*k),a.y=Math.sqrt(b*b+T*T+t*t),a.z=Math.sqrt(S*S+D*D+w*w),a};Ei.getRotation=function(a,h){let v=h.m00+h.m05+h.m10,_=0;return v>0?(_=Math.sqrt(v+1)*2,a.w=.25*_,a.x=(h.m06-h.m09)/_,a.y=(h.m08-h.m02)/_,a.z=(h.m01-h.m04)/_):h.m00>h.m05&h.m00>h.m10?(_=Math.sqrt(1+h.m00-h.m05-h.m10)*2,a.w=(h.m06-h.m09)/_,a.x=.25*_,a.y=(h.m01+h.m04)/_,a.z=(h.m08+h.m02)/_):h.m05>h.m10?(_=Math.sqrt(1+h.m05-h.m00-h.m10)*2,a.w=(h.m08-h.m02)/_,a.x=(h.m01+h.m04)/_,a.y=.25*_,a.z=(h.m06+h.m09)/_):(_=Math.sqrt(1+h.m10-h.m00-h.m05)*2,a.w=(h.m01-h.m04)/_,a.x=(h.m08+h.m02)/_,a.y=(h.m06+h.m09)/_,a.z=.25*_),a};Ei.fromRTS=function(a,h,v,_){let k=h.x,b=h.y,T=h.z,t=h.w,S=k+k,D=b+b,w=T+T,E=k*S,m=k*D,y=k*w,p=b*D,C=b*w,z=T*w,A=t*S,P=t*D,x=t*w,O=_.x,U=_.y,G=_.z;return a.m00=(1-(p+z))*O,a.m01=(m+x)*O,a.m02=(y-P)*O,a.m03=0,a.m04=(m-x)*U,a.m05=(1-(E+z))*U,a.m06=(C+A)*U,a.m07=0,a.m08=(y+P)*G,a.m09=(C-A)*G,a.m10=(1-(E+p))*G,a.m11=0,a.m12=v.x,a.m13=v.y,a.m14=v.z,a.m15=1,a};Ei.fromRTSOrigin=function(a,h,v,_,k){let b=h.x,T=h.y,t=h.z,S=h.w,D=b+b,w=T+T,E=t+t,m=b*D,y=b*w,p=b*E,C=T*w,z=T*E,A=t*E,P=S*D,x=S*w,O=S*E,U=_.x,G=_.y,Z=_.z,X=k.x,W=k.y,J=k.z;return a.m00=(1-(C+A))*U,a.m01=(y+O)*U,a.m02=(p-x)*U,a.m03=0,a.m04=(y-O)*G,a.m05=(1-(m+A))*G,a.m06=(z+P)*G,a.m07=0,a.m08=(p+x)*Z,a.m09=(z-P)*Z,a.m10=(1-(m+C))*Z,a.m11=0,a.m12=v.x+X-(a.m00*X+a.m04*W+a.m08*J),a.m13=v.y+W-(a.m01*X+a.m05*W+a.m09*J),a.m14=v.z+J-(a.m02*X+a.m06*W+a.m10*J),a.m15=1,a};Ei.fromQuat=function(a,h){let v=h.x,_=h.y,k=h.z,b=h.w,T=v+v,t=_+_,S=k+k,D=v*T,w=_*T,E=_*t,m=k*T,y=k*t,p=k*S,C=b*T,z=b*t,A=b*S;return a.m00=1-E-p,a.m01=w+A,a.m02=m-z,a.m03=0,a.m04=w-A,a.m05=1-D-p,a.m06=y+C,a.m07=0,a.m08=m+z,a.m09=y-C,a.m10=1-D-E,a.m11=0,a.m12=0,a.m13=0,a.m14=0,a.m15=1,a};Ei.frustum=function(a,h,v,_,k,b,T){let t=1/(v-h),S=1/(k-_),D=1/(b-T);return a.m00=b*2*t,a.m01=0,a.m02=0,a.m03=0,a.m04=0,a.m05=b*2*S,a.m06=0,a.m07=0,a.m08=(v+h)*t,a.m09=(k+_)*S,a.m10=(T+b)*D,a.m11=-1,a.m12=0,a.m13=0,a.m14=T*b*2*D,a.m15=0,a};Ei.perspective=function(a,h,v,_,k){let b=1/Math.tan(h/2),T=1/(_-k);return a.m00=b/v,a.m01=0,a.m02=0,a.m03=0,a.m04=0,a.m05=b,a.m06=0,a.m07=0,a.m08=0,a.m09=0,a.m10=(k+_)*T,a.m11=-1,a.m12=0,a.m13=0,a.m14=2*k*_*T,a.m15=0,a};Ei.perspectiveFromFieldOfView=function(a,h,v,_){let k=Math.tan(h.upDegrees*Math.PI/180),b=Math.tan(h.downDegrees*Math.PI/180),T=Math.tan(h.leftDegrees*Math.PI/180),t=Math.tan(h.rightDegrees*Math.PI/180),S=2/(T+t),D=2/(k+b);return a.m00=S,a.m01=0,a.m02=0,a.m03=0,a.m04=0,a.m05=D,a.m06=0,a.m07=0,a.m08=-((T-t)*S*.5),a.m09=(k-b)*D*.5,a.m10=_/(v-_),a.m11=-1,a.m12=0,a.m13=0,a.m14=_*v/(v-_),a.m15=0,a};Ei.ortho=function(a,h,v,_,k,b,T){let t=1/(h-v),S=1/(_-k),D=1/(b-T);return a.m00=-2*t,a.m01=0,a.m02=0,a.m03=0,a.m04=0,a.m05=-2*S,a.m06=0,a.m07=0,a.m08=0,a.m09=0,a.m10=2*D,a.m11=0,a.m12=(h+v)*t,a.m13=(k+_)*S,a.m14=(T+b)*D,a.m15=1,a};Ei.lookAt=function(a,h,v,_){let k,b,T,t,S,D,w,E,m,y,p=h.x,C=h.y,z=h.z,A=_.x,P=_.y,x=_.z,O=v.x,U=v.y,G=v.z;return Math.abs(p-O)<ti&&Math.abs(C-U)<ti&&Math.abs(z-G)<ti?Ei.identity(a):(w=p-O,E=C-U,m=z-G,y=1/Math.sqrt(w*w+E*E+m*m),w*=y,E*=y,m*=y,k=P*m-x*E,b=x*w-A*m,T=A*E-P*w,y=Math.sqrt(k*k+b*b+T*T),y?(y=1/y,k*=y,b*=y,T*=y):(k=0,b=0,T=0),t=E*T-m*b,S=m*k-w*T,D=w*b-E*k,y=Math.sqrt(t*t+S*S+D*D),y?(y=1/y,t*=y,S*=y,D*=y):(t=0,S=0,D=0),a.m00=k,a.m01=t,a.m02=w,a.m03=0,a.m04=b,a.m05=S,a.m06=E,a.m07=0,a.m08=T,a.m09=D,a.m10=m,a.m11=0,a.m12=-(k*p+b*C+T*z),a.m13=-(t*p+S*C+D*z),a.m14=-(w*p+E*C+m*z),a.m15=1,a)};Ei.str=function(a){return`mat4(${a.m00}, ${a.m01}, ${a.m02}, ${a.m03}, ${a.m04}, ${a.m05}, ${a.m06}, ${a.m07}, ${a.m08}, ${a.m09}, ${a.m10}, ${a.m11}, ${a.m12}, ${a.m13}, ${a.m14}, ${a.m15})`};Ei.array=function(a,h){return a[0]=h.m00,a[1]=h.m01,a[2]=h.m02,a[3]=h.m03,a[4]=h.m04,a[5]=h.m05,a[6]=h.m06,a[7]=h.m07,a[8]=h.m08,a[9]=h.m09,a[10]=h.m10,a[11]=h.m11,a[12]=h.m12,a[13]=h.m13,a[14]=h.m14,a[15]=h.m15,a};Ei.frob=function(a){return Math.sqrt(Math.pow(a.m00,2)+Math.pow(a.m01,2)+Math.pow(a.m02,2)+Math.pow(a.m03,2)+Math.pow(a.m04,2)+Math.pow(a.m05,2)+Math.pow(a.m06,2)+Math.pow(a.m07,2)+Math.pow(a.m08,2)+Math.pow(a.m09,2)+Math.pow(a.m10,2)+Math.pow(a.m11,2)+Math.pow(a.m12,2)+Math.pow(a.m13,2)+Math.pow(a.m14,2)+Math.pow(a.m15,2))};Ei.add=function(a,h,v){return a.m00=h.m00+v.m00,a.m01=h.m01+v.m01,a.m02=h.m02+v.m02,a.m03=h.m03+v.m03,a.m04=h.m04+v.m04,a.m05=h.m05+v.m05,a.m06=h.m06+v.m06,a.m07=h.m07+v.m07,a.m08=h.m08+v.m08,a.m09=h.m09+v.m09,a.m10=h.m10+v.m10,a.m11=h.m11+v.m11,a.m12=h.m12+v.m12,a.m13=h.m13+v.m13,a.m14=h.m14+v.m14,a.m15=h.m15+v.m15,a};Ei.subtract=function(a,h,v){return a.m00=h.m00-v.m00,a.m01=h.m01-v.m01,a.m02=h.m02-v.m02,a.m03=h.m03-v.m03,a.m04=h.m04-v.m04,a.m05=h.m05-v.m05,a.m06=h.m06-v.m06,a.m07=h.m07-v.m07,a.m08=h.m08-v.m08,a.m09=h.m09-v.m09,a.m10=h.m10-v.m10,a.m11=h.m11-v.m11,a.m12=h.m12-v.m12,a.m13=h.m13-v.m13,a.m14=h.m14-v.m14,a.m15=h.m15-v.m15,a};Ei.sub=Ei.subtract;Ei.multiplyScalar=function(a,h,v){return a.m00=h.m00*v,a.m01=h.m01*v,a.m02=h.m02*v,a.m03=h.m03*v,a.m04=h.m04*v,a.m05=h.m05*v,a.m06=h.m06*v,a.m07=h.m07*v,a.m08=h.m08*v,a.m09=h.m09*v,a.m10=h.m10*v,a.m11=h.m11*v,a.m12=h.m12*v,a.m13=h.m13*v,a.m14=h.m14*v,a.m15=h.m15*v,a};Ei.multiplyScalarAndAdd=function(a,h,v,_){return a.m00=h.m00+v.m00*_,a.m01=h.m01+v.m01*_,a.m02=h.m02+v.m02*_,a.m03=h.m03+v.m03*_,a.m04=h.m04+v.m04*_,a.m05=h.m05+v.m05*_,a.m06=h.m06+v.m06*_,a.m07=h.m07+v.m07*_,a.m08=h.m08+v.m08*_,a.m09=h.m09+v.m09*_,a.m10=h.m10+v.m10*_,a.m11=h.m11+v.m11*_,a.m12=h.m12+v.m12*_,a.m13=h.m13+v.m13*_,a.m14=h.m14+v.m14*_,a.m15=h.m15+v.m15*_,a};Ei.exactEquals=function(a,h){return a.m00===h.m00&&a.m01===h.m01&&a.m02===h.m02&&a.m03===h.m03&&a.m04===h.m04&&a.m05===h.m05&&a.m06===h.m06&&a.m07===h.m07&&a.m08===h.m08&&a.m09===h.m09&&a.m10===h.m10&&a.m11===h.m11&&a.m12===h.m12&&a.m13===h.m13&&a.m14===h.m14&&a.m15===h.m15};Ei.equals=function(a,h){let v=a.m00,_=a.m01,k=a.m02,b=a.m03,T=a.m04,t=a.m05,S=a.m06,D=a.m07,w=a.m08,E=a.m09,m=a.m10,y=a.m11,p=a.m12,C=a.m13,z=a.m14,A=a.m15,P=h.m00,x=h.m01,O=h.m02,U=h.m03,G=h.m04,Z=h.m05,X=h.m06,W=h.m07,J=h.m08,re=h.m09,te=h.m10,ye=h.m11,ue=h.m12,Se=h.m13,Le=h.m14,Pe=h.m15;return Math.abs(v-P)<=ti*Math.max(1,Math.abs(v),Math.abs(P))&&Math.abs(_-x)<=ti*Math.max(1,Math.abs(_),Math.abs(x))&&Math.abs(k-O)<=ti*Math.max(1,Math.abs(k),Math.abs(O))&&Math.abs(b-U)<=ti*Math.max(1,Math.abs(b),Math.abs(U))&&Math.abs(T-G)<=ti*Math.max(1,Math.abs(T),Math.abs(G))&&Math.abs(t-Z)<=ti*Math.max(1,Math.abs(t),Math.abs(Z))&&Math.abs(S-X)<=ti*Math.max(1,Math.abs(S),Math.abs(X))&&Math.abs(D-W)<=ti*Math.max(1,Math.abs(D),Math.abs(W))&&Math.abs(w-J)<=ti*Math.max(1,Math.abs(w),Math.abs(J))&&Math.abs(E-re)<=ti*Math.max(1,Math.abs(E),Math.abs(re))&&Math.abs(m-te)<=ti*Math.max(1,Math.abs(m),Math.abs(te))&&Math.abs(y-ye)<=ti*Math.max(1,Math.abs(y),Math.abs(ye))&&Math.abs(p-ue)<=ti*Math.max(1,Math.abs(p),Math.abs(ue))&&Math.abs(C-Se)<=ti*Math.max(1,Math.abs(C),Math.abs(Se))&&Math.abs(z-Le)<=ti*Math.max(1,Math.abs(z),Math.abs(Le))&&Math.abs(A-Pe)<=ti*Math.max(1,Math.abs(A),Math.abs(Pe))};let kp=new Array(3);class Yy{constructor(h,v,_){this.r=h,this.g=v,this.b=_}toJSON(){return kp[0]=this.r,kp[1]=this.g,kp[2]=this.b,kp}}let wn={};wn.create=function(){return new Yy(1,1,1)};wn.new=function(a,h,v){return new Yy(a,h,v)};wn.clone=function(a){return new Yy(a.r,a.g,a.b,a.a)};wn.copy=function(a,h){return a.r=h.r,a.g=h.g,a.b=h.b,a};wn.set=function(a,h,v,_){return a.r=h,a.g=v,a.b=_,a};wn.fromHex=function(a,h){let v=(h>>16)/255,_=(h>>8&255)/255,k=(h&255)/255;return a.r=v,a.g=_,a.b=k,a};wn.add=function(a,h,v){return a.r=h.r+v.r,a.g=h.g+v.g,a.b=h.b+v.b,a};wn.subtract=function(a,h,v){return a.r=h.r-v.r,a.g=h.g-v.g,a.b=h.b-v.b,a};wn.sub=wn.subtract;wn.multiply=function(a,h,v){return a.r=h.r*v.r,a.g=h.g*v.g,a.b=h.b*v.b,a};wn.mul=wn.multiply;wn.divide=function(a,h,v){return a.r=h.r/v.r,a.g=h.g/v.g,a.b=h.b/v.b,a};wn.div=wn.divide;wn.scale=function(a,h,v){return a.r=h.r*v,a.g=h.g*v,a.b=h.b*v,a};wn.lerp=function(a,h,v,_){let k=h.r,b=h.g,T=h.b;return a.r=k+_*(v.r-k),a.g=b+_*(v.g-b),a.b=T+_*(v.b-T),a};wn.str=function(a){return`color3(${a.r}, ${a.g}, ${a.b})`};wn.array=function(a,h){return a[0]=h.r,a[1]=h.g,a[2]=h.b,a};wn.exactEquals=function(a,h){return a.r===h.r&&a.g===h.g&&a.b===h.b};wn.equals=function(a,h){let v=a.r,_=a.g,k=a.b,b=h.r,T=h.g,t=h.b;return Math.abs(v-b)<=ti*Math.max(1,Math.abs(v),Math.abs(b))&&Math.abs(_-T)<=ti*Math.max(1,Math.abs(_),Math.abs(T))&&Math.abs(k-t)<=ti*Math.max(1,Math.abs(k),Math.abs(t))};wn.hex=function(a){return a.r*255<<16|a.g*255<<8|a.b*255};let If=new Array(4);class Ky{constructor(h,v,_,k){this.r=h,this.g=v,this.b=_,this.a=k}toJSON(){return If[0]=this.r,If[1]=this.g,If[2]=this.b,If[3]=this.a,If}}let En={};En.create=function(){return new Ky(1,1,1,1)};En.new=function(a,h,v,_){return new Ky(a,h,v,_)};En.clone=function(a){return new Ky(a.r,a.g,a.b,a.a)};En.copy=function(a,h){return a.r=h.r,a.g=h.g,a.b=h.b,a.a=h.a,a};En.set=function(a,h,v,_,k){return a.r=h,a.g=v,a.b=_,a.a=k,a};En.fromHex=function(a,h){let v=(h>>24)/255,_=(h>>16&255)/255,k=(h>>8&255)/255,b=(h&255)/255;return a.r=v,a.g=_,a.b=k,a.a=b,a};En.add=function(a,h,v){return a.r=h.r+v.r,a.g=h.g+v.g,a.b=h.b+v.b,a.a=h.a+v.a,a};En.subtract=function(a,h,v){return a.r=h.r-v.r,a.g=h.g-v.g,a.b=h.b-v.b,a.a=h.a-v.a,a};En.sub=En.subtract;En.multiply=function(a,h,v){return a.r=h.r*v.r,a.g=h.g*v.g,a.b=h.b*v.b,a.a=h.a*v.a,a};En.mul=En.multiply;En.divide=function(a,h,v){return a.r=h.r/v.r,a.g=h.g/v.g,a.b=h.b/v.b,a.a=h.a/v.a,a};En.div=En.divide;En.scale=function(a,h,v){return a.r=h.r*v,a.g=h.g*v,a.b=h.b*v,a.a=h.a*v,a};En.lerp=function(a,h,v,_){let k=h.r,b=h.g,T=h.b,t=h.a;return a.r=k+_*(v.r-k),a.g=b+_*(v.g-b),a.b=T+_*(v.b-T),a.a=t+_*(v.a-t),a};En.str=function(a){return`color4(${a.r}, ${a.g}, ${a.b}, ${a.a})`};En.array=function(a,h){return a[0]=h.r,a[1]=h.g,a[2]=h.b,a[3]=h.a,a};En.exactEquals=function(a,h){return a.r===h.r&&a.g===h.g&&a.b===h.b&&a.a===h.a};En.equals=function(a,h){let v=a.r,_=a.g,k=a.b,b=a.a,T=h.r,t=h.g,S=h.b,D=h.a;return Math.abs(v-T)<=ti*Math.max(1,Math.abs(v),Math.abs(T))&&Math.abs(_-t)<=ti*Math.max(1,Math.abs(_),Math.abs(t))&&Math.abs(k-S)<=ti*Math.max(1,Math.abs(k),Math.abs(S))&&Math.abs(b-D)<=ti*Math.max(1,Math.abs(b),Math.abs(D))};En.hex=function(a){return(a.r*255<<24|a.g*255<<16|a.b*255<<8|a.a*255)>>>0};let S5=T5;const M5=Object.freeze(Object.defineProperty({__proto__:null,EPSILON:ti,approx:KI,bits:S5,clamp:JI,clamp01:QI,color3:wn,color4:En,equals:YI,lerp:e5,mat2:ln,mat23:an,mat3:Oi,mat4:Ei,nextPow2:n5,quat:mi,random:ul,randomRange:iT,randomRangeInt:i5,toDegree:r5,toRadian:t5,vec2:bi,vec3:$r,vec4:fi},Symbol.toStringTag,{value:"Module"})),A5=UE(M5);var I5=null;const P5=Object.freeze(Object.defineProperty({__proto__:null,default:I5},Symbol.toStringTag,{value:"Module"})),C5=UE(P5);var ps={},gg={},nw;function Jy(){return nw||(nw=1,function(){gg.defaults={"0.1":{explicitCharkey:!1,trim:!0,normalize:!0,normalizeTags:!1,attrkey:"@",charkey:"#",explicitArray:!1,ignoreAttrs:!1,mergeAttrs:!1,explicitRoot:!1,validator:null,xmlns:!1,explicitChildren:!1,childkey:"@@",charsAsChildren:!1,includeWhiteChars:!1,async:!1,strict:!0,attrNameProcessors:null,attrValueProcessors:null,tagNameProcessors:null,valueProcessors:null,emptyTag:""},"0.2":{explicitCharkey:!1,trim:!1,normalize:!1,normalizeTags:!1,attrkey:"$",charkey:"_",explicitArray:!0,ignoreAttrs:!1,mergeAttrs:!1,explicitRoot:!0,validator:null,xmlns:!1,explicitChildren:!1,preserveChildrenOrder:!1,childkey:"$$",charsAsChildren:!1,includeWhiteChars:!1,async:!1,strict:!0,attrNameProcessors:null,attrValueProcessors:null,tagNameProcessors:null,valueProcessors:null,rootName:"root",xmldec:{version:"1.0",encoding:"UTF-8",standalone:!0},doctype:null,renderOpts:{pretty:!0,indent:"  ",newline:`
`},headless:!1,chunkSize:1e4,emptyTag:"",cdata:!1}}}.call(Hr)),gg}var yg={},ms={},_s={},aw;function ws(){return aw||(aw=1,function(){var a,h,v,_,k,b,T,t=[].slice,S={}.hasOwnProperty;a=function(){var D,w,E,m,y,p;if(p=arguments[0],y=2<=arguments.length?t.call(arguments,1):[],k(Object.assign))Object.assign.apply(null,arguments);else for(D=0,E=y.length;D<E;D++)if(m=y[D],m!=null)for(w in m)S.call(m,w)&&(p[w]=m[w]);return p},k=function(D){return!!D&&Object.prototype.toString.call(D)==="[object Function]"},b=function(D){var w;return!!D&&((w=typeof D)=="function"||w==="object")},v=function(D){return k(Array.isArray)?Array.isArray(D):Object.prototype.toString.call(D)==="[object Array]"},_=function(D){var w;if(v(D))return!D.length;for(w in D)if(S.call(D,w))return!1;return!0},T=function(D){var w,E;return b(D)&&(E=Object.getPrototypeOf(D))&&(w=E.constructor)&&typeof w=="function"&&w instanceof w&&Function.prototype.toString.call(w)===Function.prototype.toString.call(Object)},h=function(D){return k(D.valueOf)?D.valueOf():D},_s.assign=a,_s.isFunction=k,_s.isObject=b,_s.isArray=v,_s.isEmpty=_,_s.isPlainObject=T,_s.getValue=h}.call(Hr)),_s}var vg={exports:{}},ow;function aT(){return ow||(ow=1,function(){vg.exports=function(){function a(){}return a.prototype.hasFeature=function(h,v){return!0},a.prototype.createDocumentType=function(h,v,_){throw new Error("This DOM method is not implemented.")},a.prototype.createDocument=function(h,v,_){throw new Error("This DOM method is not implemented.")},a.prototype.createHTMLDocument=function(h){throw new Error("This DOM method is not implemented.")},a.prototype.getFeature=function(h,v){throw new Error("This DOM method is not implemented.")},a}()}.call(Hr)),vg.exports}var bg={exports:{}},xg={exports:{}},wg={exports:{}},sw;function R5(){return sw||(sw=1,function(){wg.exports=function(){function a(){}return a.prototype.handleError=function(h){throw new Error(h)},a}()}.call(Hr)),wg.exports}var Eg={exports:{}},lw;function D5(){return lw||(lw=1,function(){Eg.exports=function(){function a(h){this.arr=h||[]}return Object.defineProperty(a.prototype,"length",{get:function(){return this.arr.length}}),a.prototype.item=function(h){return this.arr[h]||null},a.prototype.contains=function(h){return this.arr.indexOf(h)!==-1},a}()}.call(Hr)),Eg.exports}var uw;function L5(){return uw||(uw=1,function(){var a,h;a=R5(),h=D5(),xg.exports=function(){function v(){this.defaultParams={"canonical-form":!1,"cdata-sections":!1,comments:!1,"datatype-normalization":!1,"element-content-whitespace":!0,entities:!0,"error-handler":new a,infoset:!0,"validate-if-schema":!1,namespaces:!0,"namespace-declarations":!0,"normalize-characters":!1,"schema-location":"","schema-type":"","split-cdata-sections":!0,validate:!1,"well-formed":!0},this.params=Object.create(this.defaultParams)}return Object.defineProperty(v.prototype,"parameterNames",{get:function(){return new h(Object.keys(this.defaultParams))}}),v.prototype.getParameter=function(_){return this.params.hasOwnProperty(_)?this.params[_]:null},v.prototype.canSetParameter=function(_,k){return!0},v.prototype.setParameter=function(_,k){return k!=null?this.params[_]=k:delete this.params[_]},v}()}.call(Hr)),xg.exports}var Tg={exports:{}},Sg={exports:{}},Mg={exports:{}},cw;function Bn(){return cw||(cw=1,function(){Mg.exports={Element:1,Attribute:2,Text:3,CData:4,EntityReference:5,EntityDeclaration:6,ProcessingInstruction:7,Comment:8,Document:9,DocType:10,DocumentFragment:11,NotationDeclaration:12,Declaration:201,Raw:202,AttributeDeclaration:203,ElementDeclaration:204,Dummy:205}}.call(Hr)),Mg.exports}var Ag={exports:{}},hw;function oT(){return hw||(hw=1,function(){var a;a=Bn(),to(),Ag.exports=function(){function h(v,_,k){if(this.parent=v,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),_==null)throw new Error("Missing attribute name. "+this.debugInfo(_));this.name=this.stringify.name(_),this.value=this.stringify.attValue(k),this.type=a.Attribute,this.isId=!1,this.schemaTypeInfo=null}return Object.defineProperty(h.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(h.prototype,"ownerElement",{get:function(){return this.parent}}),Object.defineProperty(h.prototype,"textContent",{get:function(){return this.value},set:function(v){return this.value=v||""}}),Object.defineProperty(h.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(h.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(h.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(h.prototype,"specified",{get:function(){return!0}}),h.prototype.clone=function(){return Object.create(this)},h.prototype.toString=function(v){return this.options.writer.attribute(this,this.options.writer.filterOptions(v))},h.prototype.debugInfo=function(v){return v=v||this.name,v==null?"parent: <"+this.parent.name+">":"attribute: {"+v+"}, parent: <"+this.parent.name+">"},h.prototype.isEqualNode=function(v){return!(v.namespaceURI!==this.namespaceURI||v.prefix!==this.prefix||v.localName!==this.localName||v.value!==this.value)},h}()}.call(Hr)),Ag.exports}var Ig={exports:{}},fw;function Qy(){return fw||(fw=1,function(){Ig.exports=function(){function a(h){this.nodes=h}return Object.defineProperty(a.prototype,"length",{get:function(){return Object.keys(this.nodes).length||0}}),a.prototype.clone=function(){return this.nodes=null},a.prototype.getNamedItem=function(h){return this.nodes[h]},a.prototype.setNamedItem=function(h){var v;return v=this.nodes[h.nodeName],this.nodes[h.nodeName]=h,v||null},a.prototype.removeNamedItem=function(h){var v;return v=this.nodes[h],delete this.nodes[h],v||null},a.prototype.item=function(h){return this.nodes[Object.keys(this.nodes)[h]]||null},a.prototype.getNamedItemNS=function(h,v){throw new Error("This DOM method is not implemented.")},a.prototype.setNamedItemNS=function(h){throw new Error("This DOM method is not implemented.")},a.prototype.removeNamedItemNS=function(h,v){throw new Error("This DOM method is not implemented.")},a}()}.call(Hr)),Ig.exports}var dw;function e1(){return dw||(dw=1,function(){var a,h,v,_,k,b,T,t,S=function(w,E){for(var m in E)D.call(E,m)&&(w[m]=E[m]);function y(){this.constructor=w}return y.prototype=E.prototype,w.prototype=new y,w.__super__=E.prototype,w},D={}.hasOwnProperty;t=ws(),T=t.isObject,b=t.isFunction,k=t.getValue,_=to(),a=Bn(),h=oT(),v=Qy(),Sg.exports=function(w){S(E,w);function E(m,y,p){var C,z,A,P;if(E.__super__.constructor.call(this,m),y==null)throw new Error("Missing element name. "+this.debugInfo());if(this.name=this.stringify.name(y),this.type=a.Element,this.attribs={},this.schemaTypeInfo=null,p!=null&&this.attribute(p),m.type===a.Document&&(this.isRoot=!0,this.documentObject=m,m.rootObject=this,m.children)){for(P=m.children,z=0,A=P.length;z<A;z++)if(C=P[z],C.type===a.DocType){C.name=this.name;break}}}return Object.defineProperty(E.prototype,"tagName",{get:function(){return this.name}}),Object.defineProperty(E.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(E.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(E.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(E.prototype,"id",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(E.prototype,"className",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(E.prototype,"classList",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(E.prototype,"attributes",{get:function(){return(!this.attributeMap||!this.attributeMap.nodes)&&(this.attributeMap=new v(this.attribs)),this.attributeMap}}),E.prototype.clone=function(){var m,y,p,C;p=Object.create(this),p.isRoot&&(p.documentObject=null),p.attribs={},C=this.attribs;for(y in C)D.call(C,y)&&(m=C[y],p.attribs[y]=m.clone());return p.children=[],this.children.forEach(function(z){var A;return A=z.clone(),A.parent=p,p.children.push(A)}),p},E.prototype.attribute=function(m,y){var p,C;if(m!=null&&(m=k(m)),T(m))for(p in m)D.call(m,p)&&(C=m[p],this.attribute(p,C));else b(y)&&(y=y.apply()),this.options.keepNullAttributes&&y==null?this.attribs[m]=new h(this,m,""):y!=null&&(this.attribs[m]=new h(this,m,y));return this},E.prototype.removeAttribute=function(m){var y,p,C;if(m==null)throw new Error("Missing attribute name. "+this.debugInfo());if(m=k(m),Array.isArray(m))for(p=0,C=m.length;p<C;p++)y=m[p],delete this.attribs[y];else delete this.attribs[m];return this},E.prototype.toString=function(m){return this.options.writer.element(this,this.options.writer.filterOptions(m))},E.prototype.att=function(m,y){return this.attribute(m,y)},E.prototype.a=function(m,y){return this.attribute(m,y)},E.prototype.getAttribute=function(m){return this.attribs.hasOwnProperty(m)?this.attribs[m].value:null},E.prototype.setAttribute=function(m,y){throw new Error("This DOM method is not implemented."+this.debugInfo())},E.prototype.getAttributeNode=function(m){return this.attribs.hasOwnProperty(m)?this.attribs[m]:null},E.prototype.setAttributeNode=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},E.prototype.removeAttributeNode=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},E.prototype.getElementsByTagName=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},E.prototype.getAttributeNS=function(m,y){throw new Error("This DOM method is not implemented."+this.debugInfo())},E.prototype.setAttributeNS=function(m,y,p){throw new Error("This DOM method is not implemented."+this.debugInfo())},E.prototype.removeAttributeNS=function(m,y){throw new Error("This DOM method is not implemented."+this.debugInfo())},E.prototype.getAttributeNodeNS=function(m,y){throw new Error("This DOM method is not implemented."+this.debugInfo())},E.prototype.setAttributeNodeNS=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},E.prototype.getElementsByTagNameNS=function(m,y){throw new Error("This DOM method is not implemented."+this.debugInfo())},E.prototype.hasAttribute=function(m){return this.attribs.hasOwnProperty(m)},E.prototype.hasAttributeNS=function(m,y){throw new Error("This DOM method is not implemented."+this.debugInfo())},E.prototype.setIdAttribute=function(m,y){return this.attribs.hasOwnProperty(m)?this.attribs[m].isId:y},E.prototype.setIdAttributeNS=function(m,y,p){throw new Error("This DOM method is not implemented."+this.debugInfo())},E.prototype.setIdAttributeNode=function(m,y){throw new Error("This DOM method is not implemented."+this.debugInfo())},E.prototype.getElementsByTagName=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},E.prototype.getElementsByTagNameNS=function(m,y){throw new Error("This DOM method is not implemented."+this.debugInfo())},E.prototype.getElementsByClassName=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},E.prototype.isEqualNode=function(m){var y,p,C;if(!E.__super__.isEqualNode.apply(this,arguments).isEqualNode(m)||m.namespaceURI!==this.namespaceURI||m.prefix!==this.prefix||m.localName!==this.localName||m.attribs.length!==this.attribs.length)return!1;for(y=p=0,C=this.attribs.length-1;0<=C?p<=C:p>=C;y=0<=C?++p:--p)if(!this.attribs[y].isEqualNode(m.attribs[y]))return!1;return!0},E}(_)}.call(Hr)),Sg.exports}var Pg={exports:{}},Cg={exports:{}},pw;function em(){return pw||(pw=1,function(){var a,h=function(_,k){for(var b in k)v.call(k,b)&&(_[b]=k[b]);function T(){this.constructor=_}return T.prototype=k.prototype,_.prototype=new T,_.__super__=k.prototype,_},v={}.hasOwnProperty;a=to(),Cg.exports=function(_){h(k,_);function k(b){k.__super__.constructor.call(this,b),this.value=""}return Object.defineProperty(k.prototype,"data",{get:function(){return this.value},set:function(b){return this.value=b||""}}),Object.defineProperty(k.prototype,"length",{get:function(){return this.value.length}}),Object.defineProperty(k.prototype,"textContent",{get:function(){return this.value},set:function(b){return this.value=b||""}}),k.prototype.clone=function(){return Object.create(this)},k.prototype.substringData=function(b,T){throw new Error("This DOM method is not implemented."+this.debugInfo())},k.prototype.appendData=function(b){throw new Error("This DOM method is not implemented."+this.debugInfo())},k.prototype.insertData=function(b,T){throw new Error("This DOM method is not implemented."+this.debugInfo())},k.prototype.deleteData=function(b,T){throw new Error("This DOM method is not implemented."+this.debugInfo())},k.prototype.replaceData=function(b,T,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},k.prototype.isEqualNode=function(b){return!(!k.__super__.isEqualNode.apply(this,arguments).isEqualNode(b)||b.data!==this.data)},k}(a)}.call(Hr)),Cg.exports}var mw;function t1(){return mw||(mw=1,function(){var a,h,v=function(k,b){for(var T in b)_.call(b,T)&&(k[T]=b[T]);function t(){this.constructor=k}return t.prototype=b.prototype,k.prototype=new t,k.__super__=b.prototype,k},_={}.hasOwnProperty;a=Bn(),h=em(),Pg.exports=function(k){v(b,k);function b(T,t){if(b.__super__.constructor.call(this,T),t==null)throw new Error("Missing CDATA text. "+this.debugInfo());this.name="#cdata-section",this.type=a.CData,this.value=this.stringify.cdata(t)}return b.prototype.clone=function(){return Object.create(this)},b.prototype.toString=function(T){return this.options.writer.cdata(this,this.options.writer.filterOptions(T))},b}(h)}.call(Hr)),Pg.exports}var Rg={exports:{}},_w;function r1(){return _w||(_w=1,function(){var a,h,v=function(k,b){for(var T in b)_.call(b,T)&&(k[T]=b[T]);function t(){this.constructor=k}return t.prototype=b.prototype,k.prototype=new t,k.__super__=b.prototype,k},_={}.hasOwnProperty;a=Bn(),h=em(),Rg.exports=function(k){v(b,k);function b(T,t){if(b.__super__.constructor.call(this,T),t==null)throw new Error("Missing comment text. "+this.debugInfo());this.name="#comment",this.type=a.Comment,this.value=this.stringify.comment(t)}return b.prototype.clone=function(){return Object.create(this)},b.prototype.toString=function(T){return this.options.writer.comment(this,this.options.writer.filterOptions(T))},b}(h)}.call(Hr)),Rg.exports}var Dg={exports:{}},gw;function i1(){return gw||(gw=1,function(){var a,h,v,_=function(b,T){for(var t in T)k.call(T,t)&&(b[t]=T[t]);function S(){this.constructor=b}return S.prototype=T.prototype,b.prototype=new S,b.__super__=T.prototype,b},k={}.hasOwnProperty;v=ws().isObject,h=to(),a=Bn(),Dg.exports=function(b){_(T,b);function T(t,S,D,w){var E;T.__super__.constructor.call(this,t),v(S)&&(E=S,S=E.version,D=E.encoding,w=E.standalone),S||(S="1.0"),this.type=a.Declaration,this.version=this.stringify.xmlVersion(S),D!=null&&(this.encoding=this.stringify.xmlEncoding(D)),w!=null&&(this.standalone=this.stringify.xmlStandalone(w))}return T.prototype.toString=function(t){return this.options.writer.declaration(this,this.options.writer.filterOptions(t))},T}(h)}.call(Hr)),Dg.exports}var Lg={exports:{}},Og={exports:{}},yw;function n1(){return yw||(yw=1,function(){var a,h,v=function(k,b){for(var T in b)_.call(b,T)&&(k[T]=b[T]);function t(){this.constructor=k}return t.prototype=b.prototype,k.prototype=new t,k.__super__=b.prototype,k},_={}.hasOwnProperty;h=to(),a=Bn(),Og.exports=function(k){v(b,k);function b(T,t,S,D,w,E){if(b.__super__.constructor.call(this,T),t==null)throw new Error("Missing DTD element name. "+this.debugInfo());if(S==null)throw new Error("Missing DTD attribute name. "+this.debugInfo(t));if(!D)throw new Error("Missing DTD attribute type. "+this.debugInfo(t));if(!w)throw new Error("Missing DTD attribute default. "+this.debugInfo(t));if(w.indexOf("#")!==0&&(w="#"+w),!w.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT. "+this.debugInfo(t));if(E&&!w.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT. "+this.debugInfo(t));this.elementName=this.stringify.name(t),this.type=a.AttributeDeclaration,this.attributeName=this.stringify.name(S),this.attributeType=this.stringify.dtdAttType(D),E&&(this.defaultValue=this.stringify.dtdAttDefault(E)),this.defaultValueType=w}return b.prototype.toString=function(T){return this.options.writer.dtdAttList(this,this.options.writer.filterOptions(T))},b}(h)}.call(Hr)),Og.exports}var zg={exports:{}},vw;function a1(){return vw||(vw=1,function(){var a,h,v,_=function(b,T){for(var t in T)k.call(T,t)&&(b[t]=T[t]);function S(){this.constructor=b}return S.prototype=T.prototype,b.prototype=new S,b.__super__=T.prototype,b},k={}.hasOwnProperty;v=ws().isObject,h=to(),a=Bn(),zg.exports=function(b){_(T,b);function T(t,S,D,w){if(T.__super__.constructor.call(this,t),D==null)throw new Error("Missing DTD entity name. "+this.debugInfo(D));if(w==null)throw new Error("Missing DTD entity value. "+this.debugInfo(D));if(this.pe=!!S,this.name=this.stringify.name(D),this.type=a.EntityDeclaration,!v(w))this.value=this.stringify.dtdEntityValue(w),this.internal=!0;else{if(!w.pubID&&!w.sysID)throw new Error("Public and/or system identifiers are required for an external entity. "+this.debugInfo(D));if(w.pubID&&!w.sysID)throw new Error("System identifier is required for a public external entity. "+this.debugInfo(D));if(this.internal=!1,w.pubID!=null&&(this.pubID=this.stringify.dtdPubID(w.pubID)),w.sysID!=null&&(this.sysID=this.stringify.dtdSysID(w.sysID)),w.nData!=null&&(this.nData=this.stringify.dtdNData(w.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity. "+this.debugInfo(D))}}return Object.defineProperty(T.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(T.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(T.prototype,"notationName",{get:function(){return this.nData||null}}),Object.defineProperty(T.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(T.prototype,"xmlEncoding",{get:function(){return null}}),Object.defineProperty(T.prototype,"xmlVersion",{get:function(){return null}}),T.prototype.toString=function(t){return this.options.writer.dtdEntity(this,this.options.writer.filterOptions(t))},T}(h)}.call(Hr)),zg.exports}var kg={exports:{}},bw;function o1(){return bw||(bw=1,function(){var a,h,v=function(k,b){for(var T in b)_.call(b,T)&&(k[T]=b[T]);function t(){this.constructor=k}return t.prototype=b.prototype,k.prototype=new t,k.__super__=b.prototype,k},_={}.hasOwnProperty;h=to(),a=Bn(),kg.exports=function(k){v(b,k);function b(T,t,S){if(b.__super__.constructor.call(this,T),t==null)throw new Error("Missing DTD element name. "+this.debugInfo());S||(S="(#PCDATA)"),Array.isArray(S)&&(S="("+S.join(",")+")"),this.name=this.stringify.name(t),this.type=a.ElementDeclaration,this.value=this.stringify.dtdElementValue(S)}return b.prototype.toString=function(T){return this.options.writer.dtdElement(this,this.options.writer.filterOptions(T))},b}(h)}.call(Hr)),kg.exports}var Bg={exports:{}},xw;function s1(){return xw||(xw=1,function(){var a,h,v=function(k,b){for(var T in b)_.call(b,T)&&(k[T]=b[T]);function t(){this.constructor=k}return t.prototype=b.prototype,k.prototype=new t,k.__super__=b.prototype,k},_={}.hasOwnProperty;h=to(),a=Bn(),Bg.exports=function(k){v(b,k);function b(T,t,S){if(b.__super__.constructor.call(this,T),t==null)throw new Error("Missing DTD notation name. "+this.debugInfo(t));if(!S.pubID&&!S.sysID)throw new Error("Public or system identifiers are required for an external entity. "+this.debugInfo(t));this.name=this.stringify.name(t),this.type=a.NotationDeclaration,S.pubID!=null&&(this.pubID=this.stringify.dtdPubID(S.pubID)),S.sysID!=null&&(this.sysID=this.stringify.dtdSysID(S.sysID))}return Object.defineProperty(b.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(b.prototype,"systemId",{get:function(){return this.sysID}}),b.prototype.toString=function(T){return this.options.writer.dtdNotation(this,this.options.writer.filterOptions(T))},b}(h)}.call(Hr)),Bg.exports}var ww;function l1(){return ww||(ww=1,function(){var a,h,v,_,k,b,T,t,S=function(w,E){for(var m in E)D.call(E,m)&&(w[m]=E[m]);function y(){this.constructor=w}return y.prototype=E.prototype,w.prototype=new y,w.__super__=E.prototype,w},D={}.hasOwnProperty;t=ws().isObject,T=to(),a=Bn(),h=n1(),_=a1(),v=o1(),k=s1(),b=Qy(),Lg.exports=function(w){S(E,w);function E(m,y,p){var C,z,A,P,x,O;if(E.__super__.constructor.call(this,m),this.type=a.DocType,m.children){for(P=m.children,z=0,A=P.length;z<A;z++)if(C=P[z],C.type===a.Element){this.name=C.name;break}}this.documentObject=m,t(y)&&(x=y,y=x.pubID,p=x.sysID),p==null&&(O=[y,p],p=O[0],y=O[1]),y!=null&&(this.pubID=this.stringify.dtdPubID(y)),p!=null&&(this.sysID=this.stringify.dtdSysID(p))}return Object.defineProperty(E.prototype,"entities",{get:function(){var m,y,p,C,z;for(C={},z=this.children,y=0,p=z.length;y<p;y++)m=z[y],m.type===a.EntityDeclaration&&!m.pe&&(C[m.name]=m);return new b(C)}}),Object.defineProperty(E.prototype,"notations",{get:function(){var m,y,p,C,z;for(C={},z=this.children,y=0,p=z.length;y<p;y++)m=z[y],m.type===a.NotationDeclaration&&(C[m.name]=m);return new b(C)}}),Object.defineProperty(E.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(E.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(E.prototype,"internalSubset",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),E.prototype.element=function(m,y){var p;return p=new v(this,m,y),this.children.push(p),this},E.prototype.attList=function(m,y,p,C,z){var A;return A=new h(this,m,y,p,C,z),this.children.push(A),this},E.prototype.entity=function(m,y){var p;return p=new _(this,!1,m,y),this.children.push(p),this},E.prototype.pEntity=function(m,y){var p;return p=new _(this,!0,m,y),this.children.push(p),this},E.prototype.notation=function(m,y){var p;return p=new k(this,m,y),this.children.push(p),this},E.prototype.toString=function(m){return this.options.writer.docType(this,this.options.writer.filterOptions(m))},E.prototype.ele=function(m,y){return this.element(m,y)},E.prototype.att=function(m,y,p,C,z){return this.attList(m,y,p,C,z)},E.prototype.ent=function(m,y){return this.entity(m,y)},E.prototype.pent=function(m,y){return this.pEntity(m,y)},E.prototype.not=function(m,y){return this.notation(m,y)},E.prototype.up=function(){return this.root()||this.documentObject},E.prototype.isEqualNode=function(m){return!(!E.__super__.isEqualNode.apply(this,arguments).isEqualNode(m)||m.name!==this.name||m.publicId!==this.publicId||m.systemId!==this.systemId)},E}(T)}.call(Hr)),Lg.exports}var Fg={exports:{}},Ew;function u1(){return Ew||(Ew=1,function(){var a,h,v=function(k,b){for(var T in b)_.call(b,T)&&(k[T]=b[T]);function t(){this.constructor=k}return t.prototype=b.prototype,k.prototype=new t,k.__super__=b.prototype,k},_={}.hasOwnProperty;a=Bn(),h=to(),Fg.exports=function(k){v(b,k);function b(T,t){if(b.__super__.constructor.call(this,T),t==null)throw new Error("Missing raw text. "+this.debugInfo());this.type=a.Raw,this.value=this.stringify.raw(t)}return b.prototype.clone=function(){return Object.create(this)},b.prototype.toString=function(T){return this.options.writer.raw(this,this.options.writer.filterOptions(T))},b}(h)}.call(Hr)),Fg.exports}var Ng={exports:{}},Tw;function c1(){return Tw||(Tw=1,function(){var a,h,v=function(k,b){for(var T in b)_.call(b,T)&&(k[T]=b[T]);function t(){this.constructor=k}return t.prototype=b.prototype,k.prototype=new t,k.__super__=b.prototype,k},_={}.hasOwnProperty;a=Bn(),h=em(),Ng.exports=function(k){v(b,k);function b(T,t){if(b.__super__.constructor.call(this,T),t==null)throw new Error("Missing element text. "+this.debugInfo());this.name="#text",this.type=a.Text,this.value=this.stringify.text(t)}return Object.defineProperty(b.prototype,"isElementContentWhitespace",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(b.prototype,"wholeText",{get:function(){var T,t,S;for(S="",t=this.previousSibling;t;)S=t.data+S,t=t.previousSibling;for(S+=this.data,T=this.nextSibling;T;)S=S+T.data,T=T.nextSibling;return S}}),b.prototype.clone=function(){return Object.create(this)},b.prototype.toString=function(T){return this.options.writer.text(this,this.options.writer.filterOptions(T))},b.prototype.splitText=function(T){throw new Error("This DOM method is not implemented."+this.debugInfo())},b.prototype.replaceWholeText=function(T){throw new Error("This DOM method is not implemented."+this.debugInfo())},b}(h)}.call(Hr)),Ng.exports}var Ug={exports:{}},Sw;function h1(){return Sw||(Sw=1,function(){var a,h,v=function(k,b){for(var T in b)_.call(b,T)&&(k[T]=b[T]);function t(){this.constructor=k}return t.prototype=b.prototype,k.prototype=new t,k.__super__=b.prototype,k},_={}.hasOwnProperty;a=Bn(),h=em(),Ug.exports=function(k){v(b,k);function b(T,t,S){if(b.__super__.constructor.call(this,T),t==null)throw new Error("Missing instruction target. "+this.debugInfo());this.type=a.ProcessingInstruction,this.target=this.stringify.insTarget(t),this.name=this.target,S&&(this.value=this.stringify.insValue(S))}return b.prototype.clone=function(){return Object.create(this)},b.prototype.toString=function(T){return this.options.writer.processingInstruction(this,this.options.writer.filterOptions(T))},b.prototype.isEqualNode=function(T){return!(!b.__super__.isEqualNode.apply(this,arguments).isEqualNode(T)||T.target!==this.target)},b}(h)}.call(Hr)),Ug.exports}var jg={exports:{}},Mw;function sT(){return Mw||(Mw=1,function(){var a,h,v=function(k,b){for(var T in b)_.call(b,T)&&(k[T]=b[T]);function t(){this.constructor=k}return t.prototype=b.prototype,k.prototype=new t,k.__super__=b.prototype,k},_={}.hasOwnProperty;h=to(),a=Bn(),jg.exports=function(k){v(b,k);function b(T){b.__super__.constructor.call(this,T),this.type=a.Dummy}return b.prototype.clone=function(){return Object.create(this)},b.prototype.toString=function(T){return""},b}(h)}.call(Hr)),jg.exports}var Vg={exports:{}},Aw;function O5(){return Aw||(Aw=1,function(){Vg.exports=function(){function a(h){this.nodes=h}return Object.defineProperty(a.prototype,"length",{get:function(){return this.nodes.length||0}}),a.prototype.clone=function(){return this.nodes=null},a.prototype.item=function(h){return this.nodes[h]||null},a}()}.call(Hr)),Vg.exports}var Gg={exports:{}},Iw;function z5(){return Iw||(Iw=1,function(){Gg.exports={Disconnected:1,Preceding:2,Following:4,Contains:8,ContainedBy:16,ImplementationSpecific:32}}.call(Hr)),Gg.exports}var Pw;function to(){return Pw||(Pw=1,function(){var a,h,v,_,k,b,T,t,S,D,w,E,m,y,p,C,z,A={}.hasOwnProperty;z=ws(),C=z.isObject,p=z.isFunction,y=z.isEmpty,m=z.getValue,t=null,v=null,_=null,k=null,b=null,w=null,E=null,D=null,T=null,h=null,S=null,a=null,Tg.exports=function(){function P(x){this.parent=x,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.value=null,this.children=[],this.baseURI=null,t||(t=e1(),v=t1(),_=r1(),k=i1(),b=l1(),w=u1(),E=c1(),D=h1(),T=sT(),h=Bn(),S=O5(),Qy(),a=z5())}return Object.defineProperty(P.prototype,"nodeName",{get:function(){return this.name}}),Object.defineProperty(P.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(P.prototype,"nodeValue",{get:function(){return this.value}}),Object.defineProperty(P.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(P.prototype,"childNodes",{get:function(){return(!this.childNodeList||!this.childNodeList.nodes)&&(this.childNodeList=new S(this.children)),this.childNodeList}}),Object.defineProperty(P.prototype,"firstChild",{get:function(){return this.children[0]||null}}),Object.defineProperty(P.prototype,"lastChild",{get:function(){return this.children[this.children.length-1]||null}}),Object.defineProperty(P.prototype,"previousSibling",{get:function(){var x;return x=this.parent.children.indexOf(this),this.parent.children[x-1]||null}}),Object.defineProperty(P.prototype,"nextSibling",{get:function(){var x;return x=this.parent.children.indexOf(this),this.parent.children[x+1]||null}}),Object.defineProperty(P.prototype,"ownerDocument",{get:function(){return this.document()||null}}),Object.defineProperty(P.prototype,"textContent",{get:function(){var x,O,U,G,Z;if(this.nodeType===h.Element||this.nodeType===h.DocumentFragment){for(Z="",G=this.children,O=0,U=G.length;O<U;O++)x=G[O],x.textContent&&(Z+=x.textContent);return Z}else return null},set:function(x){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),P.prototype.setParent=function(x){var O,U,G,Z,X;for(this.parent=x,x&&(this.options=x.options,this.stringify=x.stringify),Z=this.children,X=[],U=0,G=Z.length;U<G;U++)O=Z[U],X.push(O.setParent(this));return X},P.prototype.element=function(x,O,U){var G,Z,X,W,J,re,te,ye,ue,Se,Le;if(re=null,O===null&&U==null&&(ue=[{},null],O=ue[0],U=ue[1]),O==null&&(O={}),O=m(O),C(O)||(Se=[O,U],U=Se[0],O=Se[1]),x!=null&&(x=m(x)),Array.isArray(x))for(X=0,te=x.length;X<te;X++)Z=x[X],re=this.element(Z);else if(p(x))re=this.element(x.apply());else if(C(x)){for(J in x)if(A.call(x,J))if(Le=x[J],p(Le)&&(Le=Le.apply()),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&J.indexOf(this.stringify.convertAttKey)===0)re=this.attribute(J.substr(this.stringify.convertAttKey.length),Le);else if(!this.options.separateArrayItems&&Array.isArray(Le)&&y(Le))re=this.dummy();else if(C(Le)&&y(Le))re=this.element(J);else if(!this.options.keepNullNodes&&Le==null)re=this.dummy();else if(!this.options.separateArrayItems&&Array.isArray(Le))for(W=0,ye=Le.length;W<ye;W++)Z=Le[W],G={},G[J]=Z,re=this.element(G);else C(Le)?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&J.indexOf(this.stringify.convertTextKey)===0?re=this.element(Le):(re=this.element(J),re.element(Le)):re=this.element(J,Le)}else!this.options.keepNullNodes&&U===null?re=this.dummy():!this.options.ignoreDecorators&&this.stringify.convertTextKey&&x.indexOf(this.stringify.convertTextKey)===0?re=this.text(U):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&x.indexOf(this.stringify.convertCDataKey)===0?re=this.cdata(U):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&x.indexOf(this.stringify.convertCommentKey)===0?re=this.comment(U):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&x.indexOf(this.stringify.convertRawKey)===0?re=this.raw(U):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&x.indexOf(this.stringify.convertPIKey)===0?re=this.instruction(x.substr(this.stringify.convertPIKey.length),U):re=this.node(x,O,U);if(re==null)throw new Error("Could not create any elements with: "+x+". "+this.debugInfo());return re},P.prototype.insertBefore=function(x,O,U){var G,Z,X,W,J;if(x?.type)return X=x,W=O,X.setParent(this),W?(Z=children.indexOf(W),J=children.splice(Z),children.push(X),Array.prototype.push.apply(children,J)):children.push(X),X;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(x));return Z=this.parent.children.indexOf(this),J=this.parent.children.splice(Z),G=this.parent.element(x,O,U),Array.prototype.push.apply(this.parent.children,J),G},P.prototype.insertAfter=function(x,O,U){var G,Z,X;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(x));return Z=this.parent.children.indexOf(this),X=this.parent.children.splice(Z+1),G=this.parent.element(x,O,U),Array.prototype.push.apply(this.parent.children,X),G},P.prototype.remove=function(){var x;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return x=this.parent.children.indexOf(this),[].splice.apply(this.parent.children,[x,x-x+1].concat([])),this.parent},P.prototype.node=function(x,O,U){var G,Z;return x!=null&&(x=m(x)),O||(O={}),O=m(O),C(O)||(Z=[O,U],U=Z[0],O=Z[1]),G=new t(this,x,O),U!=null&&G.text(U),this.children.push(G),G},P.prototype.text=function(x){var O;return C(x)&&this.element(x),O=new E(this,x),this.children.push(O),this},P.prototype.cdata=function(x){var O;return O=new v(this,x),this.children.push(O),this},P.prototype.comment=function(x){var O;return O=new _(this,x),this.children.push(O),this},P.prototype.commentBefore=function(x){var O,U;return O=this.parent.children.indexOf(this),U=this.parent.children.splice(O),this.parent.comment(x),Array.prototype.push.apply(this.parent.children,U),this},P.prototype.commentAfter=function(x){var O,U;return O=this.parent.children.indexOf(this),U=this.parent.children.splice(O+1),this.parent.comment(x),Array.prototype.push.apply(this.parent.children,U),this},P.prototype.raw=function(x){var O;return O=new w(this,x),this.children.push(O),this},P.prototype.dummy=function(){var x;return x=new T(this),x},P.prototype.instruction=function(x,O){var U,G,Z,X,W;if(x!=null&&(x=m(x)),O!=null&&(O=m(O)),Array.isArray(x))for(X=0,W=x.length;X<W;X++)U=x[X],this.instruction(U);else if(C(x))for(U in x)A.call(x,U)&&(G=x[U],this.instruction(U,G));else p(O)&&(O=O.apply()),Z=new D(this,x,O),this.children.push(Z);return this},P.prototype.instructionBefore=function(x,O){var U,G;return U=this.parent.children.indexOf(this),G=this.parent.children.splice(U),this.parent.instruction(x,O),Array.prototype.push.apply(this.parent.children,G),this},P.prototype.instructionAfter=function(x,O){var U,G;return U=this.parent.children.indexOf(this),G=this.parent.children.splice(U+1),this.parent.instruction(x,O),Array.prototype.push.apply(this.parent.children,G),this},P.prototype.declaration=function(x,O,U){var G,Z;return G=this.document(),Z=new k(G,x,O,U),G.children.length===0?G.children.unshift(Z):G.children[0].type===h.Declaration?G.children[0]=Z:G.children.unshift(Z),G.root()||G},P.prototype.dtd=function(x,O){var U,G,Z,X,W,J,re,te,ye,ue;for(G=this.document(),Z=new b(G,x,O),ye=G.children,X=W=0,re=ye.length;W<re;X=++W)if(U=ye[X],U.type===h.DocType)return G.children[X]=Z,Z;for(ue=G.children,X=J=0,te=ue.length;J<te;X=++J)if(U=ue[X],U.isRoot)return G.children.splice(X,0,Z),Z;return G.children.push(Z),Z},P.prototype.up=function(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent},P.prototype.root=function(){var x;for(x=this;x;){if(x.type===h.Document)return x.rootObject;if(x.isRoot)return x;x=x.parent}},P.prototype.document=function(){var x;for(x=this;x;){if(x.type===h.Document)return x;x=x.parent}},P.prototype.end=function(x){return this.document().end(x)},P.prototype.prev=function(){var x;if(x=this.parent.children.indexOf(this),x<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[x-1]},P.prototype.next=function(){var x;if(x=this.parent.children.indexOf(this),x===-1||x===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[x+1]},P.prototype.importDocument=function(x){var O;return O=x.root().clone(),O.parent=this,O.isRoot=!1,this.children.push(O),this},P.prototype.debugInfo=function(x){var O,U;return x=x||this.name,x==null&&!((O=this.parent)!=null&&O.name)?"":x==null?"parent: <"+this.parent.name+">":(U=this.parent)!=null&&U.name?"node: <"+x+">, parent: <"+this.parent.name+">":"node: <"+x+">"},P.prototype.ele=function(x,O,U){return this.element(x,O,U)},P.prototype.nod=function(x,O,U){return this.node(x,O,U)},P.prototype.txt=function(x){return this.text(x)},P.prototype.dat=function(x){return this.cdata(x)},P.prototype.com=function(x){return this.comment(x)},P.prototype.ins=function(x,O){return this.instruction(x,O)},P.prototype.doc=function(){return this.document()},P.prototype.dec=function(x,O,U){return this.declaration(x,O,U)},P.prototype.e=function(x,O,U){return this.element(x,O,U)},P.prototype.n=function(x,O,U){return this.node(x,O,U)},P.prototype.t=function(x){return this.text(x)},P.prototype.d=function(x){return this.cdata(x)},P.prototype.c=function(x){return this.comment(x)},P.prototype.r=function(x){return this.raw(x)},P.prototype.i=function(x,O){return this.instruction(x,O)},P.prototype.u=function(){return this.up()},P.prototype.importXMLBuilder=function(x){return this.importDocument(x)},P.prototype.replaceChild=function(x,O){throw new Error("This DOM method is not implemented."+this.debugInfo())},P.prototype.removeChild=function(x){throw new Error("This DOM method is not implemented."+this.debugInfo())},P.prototype.appendChild=function(x){throw new Error("This DOM method is not implemented."+this.debugInfo())},P.prototype.hasChildNodes=function(){return this.children.length!==0},P.prototype.cloneNode=function(x){throw new Error("This DOM method is not implemented."+this.debugInfo())},P.prototype.normalize=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},P.prototype.isSupported=function(x,O){return!0},P.prototype.hasAttributes=function(){return this.attribs.length!==0},P.prototype.compareDocumentPosition=function(x){var O,U;return O=this,O===x?0:this.document()!==x.document()?(U=a.Disconnected|a.ImplementationSpecific,Math.random()<.5?U|=a.Preceding:U|=a.Following,U):O.isAncestor(x)?a.Contains|a.Preceding:O.isDescendant(x)?a.Contains|a.Following:O.isPreceding(x)?a.Preceding:a.Following},P.prototype.isSameNode=function(x){throw new Error("This DOM method is not implemented."+this.debugInfo())},P.prototype.lookupPrefix=function(x){throw new Error("This DOM method is not implemented."+this.debugInfo())},P.prototype.isDefaultNamespace=function(x){throw new Error("This DOM method is not implemented."+this.debugInfo())},P.prototype.lookupNamespaceURI=function(x){throw new Error("This DOM method is not implemented."+this.debugInfo())},P.prototype.isEqualNode=function(x){var O,U,G;if(x.nodeType!==this.nodeType||x.children.length!==this.children.length)return!1;for(O=U=0,G=this.children.length-1;0<=G?U<=G:U>=G;O=0<=G?++U:--U)if(!this.children[O].isEqualNode(x.children[O]))return!1;return!0},P.prototype.getFeature=function(x,O){throw new Error("This DOM method is not implemented."+this.debugInfo())},P.prototype.setUserData=function(x,O,U){throw new Error("This DOM method is not implemented."+this.debugInfo())},P.prototype.getUserData=function(x){throw new Error("This DOM method is not implemented."+this.debugInfo())},P.prototype.contains=function(x){return x?x===this||this.isDescendant(x):!1},P.prototype.isDescendant=function(x){var O,U,G,Z,X;for(X=this.children,G=0,Z=X.length;G<Z;G++)if(O=X[G],x===O||(U=O.isDescendant(x),U))return!0;return!1},P.prototype.isAncestor=function(x){return x.isDescendant(this)},P.prototype.isPreceding=function(x){var O,U;return O=this.treePosition(x),U=this.treePosition(this),O===-1||U===-1?!1:O<U},P.prototype.isFollowing=function(x){var O,U;return O=this.treePosition(x),U=this.treePosition(this),O===-1||U===-1?!1:O>U},P.prototype.treePosition=function(x){var O,U;return U=0,O=!1,this.foreachTreeNode(this.document(),function(G){if(U++,!O&&G===x)return O=!0}),O?U:-1},P.prototype.foreachTreeNode=function(x,O){var U,G,Z,X,W;for(x||(x=this.document()),X=x.children,G=0,Z=X.length;G<Z;G++){if(U=X[G],W=O(U))return W;if(W=this.foreachTreeNode(U,O),W)return W}},P}()}.call(Hr)),Tg.exports}var Hg={exports:{}},Cw;function lT(){return Cw||(Cw=1,function(){var a=function(v,_){return function(){return v.apply(_,arguments)}},h={}.hasOwnProperty;Hg.exports=function(){function v(_){this.assertLegalName=a(this.assertLegalName,this),this.assertLegalChar=a(this.assertLegalChar,this);var k,b,T;_||(_={}),this.options=_,this.options.version||(this.options.version="1.0"),b=_.stringify||{};for(k in b)h.call(b,k)&&(T=b[k],this[k]=T)}return v.prototype.name=function(_){return this.options.noValidation?_:this.assertLegalName(""+_||"")},v.prototype.text=function(_){return this.options.noValidation?_:this.assertLegalChar(this.textEscape(""+_||""))},v.prototype.cdata=function(_){return this.options.noValidation?_:(_=""+_||"",_=_.replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(_))},v.prototype.comment=function(_){if(this.options.noValidation)return _;if(_=""+_||"",_.match(/--/))throw new Error("Comment text cannot contain double-hypen: "+_);return this.assertLegalChar(_)},v.prototype.raw=function(_){return this.options.noValidation?_:""+_||""},v.prototype.attValue=function(_){return this.options.noValidation?_:this.assertLegalChar(this.attEscape(_=""+_||""))},v.prototype.insTarget=function(_){return this.options.noValidation?_:this.assertLegalChar(""+_||"")},v.prototype.insValue=function(_){if(this.options.noValidation)return _;if(_=""+_||"",_.match(/\?>/))throw new Error("Invalid processing instruction value: "+_);return this.assertLegalChar(_)},v.prototype.xmlVersion=function(_){if(this.options.noValidation)return _;if(_=""+_||"",!_.match(/1\.[0-9]+/))throw new Error("Invalid version number: "+_);return _},v.prototype.xmlEncoding=function(_){if(this.options.noValidation)return _;if(_=""+_||"",!_.match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+_);return this.assertLegalChar(_)},v.prototype.xmlStandalone=function(_){return this.options.noValidation?_:_?"yes":"no"},v.prototype.dtdPubID=function(_){return this.options.noValidation?_:this.assertLegalChar(""+_||"")},v.prototype.dtdSysID=function(_){return this.options.noValidation?_:this.assertLegalChar(""+_||"")},v.prototype.dtdElementValue=function(_){return this.options.noValidation?_:this.assertLegalChar(""+_||"")},v.prototype.dtdAttType=function(_){return this.options.noValidation?_:this.assertLegalChar(""+_||"")},v.prototype.dtdAttDefault=function(_){return this.options.noValidation?_:this.assertLegalChar(""+_||"")},v.prototype.dtdEntityValue=function(_){return this.options.noValidation?_:this.assertLegalChar(""+_||"")},v.prototype.dtdNData=function(_){return this.options.noValidation?_:this.assertLegalChar(""+_||"")},v.prototype.convertAttKey="@",v.prototype.convertPIKey="?",v.prototype.convertTextKey="#text",v.prototype.convertCDataKey="#cdata",v.prototype.convertCommentKey="#comment",v.prototype.convertRawKey="#raw",v.prototype.assertLegalChar=function(_){var k,b;if(this.options.noValidation)return _;if(k="",this.options.version==="1.0"){if(k=/[\0-\x08\x0B\f\x0E-\x1F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,b=_.match(k))throw new Error("Invalid character in string: "+_+" at index "+b.index)}else if(this.options.version==="1.1"&&(k=/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,b=_.match(k)))throw new Error("Invalid character in string: "+_+" at index "+b.index);return _},v.prototype.assertLegalName=function(_){var k;if(this.options.noValidation)return _;if(this.assertLegalChar(_),k=/^([:A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])([\x2D\.0-:A-Z_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/,!_.match(k))throw new Error("Invalid character in name");return _},v.prototype.textEscape=function(_){var k;return this.options.noValidation?_:(k=this.options.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,_.replace(k,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;"))},v.prototype.attEscape=function(_){var k;return this.options.noValidation?_:(k=this.options.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,_.replace(k,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;"))},v}()}.call(Hr)),Hg.exports}var qg={exports:{}},Wg={exports:{}},$g={exports:{}},Rw;function tm(){return Rw||(Rw=1,function(){$g.exports={None:0,OpenTag:1,InsideTag:2,CloseTag:3}}.call(Hr)),$g.exports}var Dw;function uT(){return Dw||(Dw=1,function(){var a,h,v,_={}.hasOwnProperty;v=ws().assign,a=Bn(),i1(),l1(),t1(),r1(),e1(),u1(),c1(),h1(),sT(),n1(),o1(),a1(),s1(),h=tm(),Wg.exports=function(){function k(b){var T,t,S;b||(b={}),this.options=b,t=b.writer||{};for(T in t)_.call(t,T)&&(S=t[T],this["_"+T]=this[T],this[T]=S)}return k.prototype.filterOptions=function(b){var T,t,S,D,w,E,m,y;return b||(b={}),b=v({},this.options,b),T={writer:this},T.pretty=b.pretty||!1,T.allowEmpty=b.allowEmpty||!1,T.indent=(t=b.indent)!=null?t:"  ",T.newline=(S=b.newline)!=null?S:`
`,T.offset=(D=b.offset)!=null?D:0,T.dontPrettyTextNodes=(w=(E=b.dontPrettyTextNodes)!=null?E:b.dontprettytextnodes)!=null?w:0,T.spaceBeforeSlash=(m=(y=b.spaceBeforeSlash)!=null?y:b.spacebeforeslash)!=null?m:"",T.spaceBeforeSlash===!0&&(T.spaceBeforeSlash=" "),T.suppressPrettyCount=0,T.user={},T.state=h.None,T},k.prototype.indent=function(b,T,t){var S;return!T.pretty||T.suppressPrettyCount?"":T.pretty&&(S=(t||0)+T.offset+1,S>0)?new Array(S).join(T.indent):""},k.prototype.endline=function(b,T,t){return!T.pretty||T.suppressPrettyCount?"":T.newline},k.prototype.attribute=function(b,T,t){var S;return this.openAttribute(b,T,t),S=" "+b.name+'="'+b.value+'"',this.closeAttribute(b,T,t),S},k.prototype.cdata=function(b,T,t){var S;return this.openNode(b,T,t),T.state=h.OpenTag,S=this.indent(b,T,t)+"<![CDATA[",T.state=h.InsideTag,S+=b.value,T.state=h.CloseTag,S+="]]>"+this.endline(b,T,t),T.state=h.None,this.closeNode(b,T,t),S},k.prototype.comment=function(b,T,t){var S;return this.openNode(b,T,t),T.state=h.OpenTag,S=this.indent(b,T,t)+"<!-- ",T.state=h.InsideTag,S+=b.value,T.state=h.CloseTag,S+=" -->"+this.endline(b,T,t),T.state=h.None,this.closeNode(b,T,t),S},k.prototype.declaration=function(b,T,t){var S;return this.openNode(b,T,t),T.state=h.OpenTag,S=this.indent(b,T,t)+"<?xml",T.state=h.InsideTag,S+=' version="'+b.version+'"',b.encoding!=null&&(S+=' encoding="'+b.encoding+'"'),b.standalone!=null&&(S+=' standalone="'+b.standalone+'"'),T.state=h.CloseTag,S+=T.spaceBeforeSlash+"?>",S+=this.endline(b,T,t),T.state=h.None,this.closeNode(b,T,t),S},k.prototype.docType=function(b,T,t){var S,D,w,E,m;if(t||(t=0),this.openNode(b,T,t),T.state=h.OpenTag,E=this.indent(b,T,t),E+="<!DOCTYPE "+b.root().name,b.pubID&&b.sysID?E+=' PUBLIC "'+b.pubID+'" "'+b.sysID+'"':b.sysID&&(E+=' SYSTEM "'+b.sysID+'"'),b.children.length>0){for(E+=" [",E+=this.endline(b,T,t),T.state=h.InsideTag,m=b.children,D=0,w=m.length;D<w;D++)S=m[D],E+=this.writeChildNode(S,T,t+1);T.state=h.CloseTag,E+="]"}return T.state=h.CloseTag,E+=T.spaceBeforeSlash+">",E+=this.endline(b,T,t),T.state=h.None,this.closeNode(b,T,t),E},k.prototype.element=function(b,T,t){var S,D,w,E,m,y,p,C,z,A,P,x,O,U;t||(t=0),A=!1,P="",this.openNode(b,T,t),T.state=h.OpenTag,P+=this.indent(b,T,t)+"<"+b.name,x=b.attribs;for(z in x)_.call(x,z)&&(S=x[z],P+=this.attribute(S,T,t));if(w=b.children.length,E=w===0?null:b.children[0],w===0||b.children.every(function(G){return(G.type===a.Text||G.type===a.Raw)&&G.value===""}))T.allowEmpty?(P+=">",T.state=h.CloseTag,P+="</"+b.name+">"+this.endline(b,T,t)):(T.state=h.CloseTag,P+=T.spaceBeforeSlash+"/>"+this.endline(b,T,t));else if(T.pretty&&w===1&&(E.type===a.Text||E.type===a.Raw)&&E.value!=null)P+=">",T.state=h.InsideTag,T.suppressPrettyCount++,A=!0,P+=this.writeChildNode(E,T,t+1),T.suppressPrettyCount--,A=!1,T.state=h.CloseTag,P+="</"+b.name+">"+this.endline(b,T,t);else{if(T.dontPrettyTextNodes){for(O=b.children,m=0,p=O.length;m<p;m++)if(D=O[m],(D.type===a.Text||D.type===a.Raw)&&D.value!=null){T.suppressPrettyCount++,A=!0;break}}for(P+=">"+this.endline(b,T,t),T.state=h.InsideTag,U=b.children,y=0,C=U.length;y<C;y++)D=U[y],P+=this.writeChildNode(D,T,t+1);T.state=h.CloseTag,P+=this.indent(b,T,t)+"</"+b.name+">",A&&T.suppressPrettyCount--,P+=this.endline(b,T,t),T.state=h.None}return this.closeNode(b,T,t),P},k.prototype.writeChildNode=function(b,T,t){switch(b.type){case a.CData:return this.cdata(b,T,t);case a.Comment:return this.comment(b,T,t);case a.Element:return this.element(b,T,t);case a.Raw:return this.raw(b,T,t);case a.Text:return this.text(b,T,t);case a.ProcessingInstruction:return this.processingInstruction(b,T,t);case a.Dummy:return"";case a.Declaration:return this.declaration(b,T,t);case a.DocType:return this.docType(b,T,t);case a.AttributeDeclaration:return this.dtdAttList(b,T,t);case a.ElementDeclaration:return this.dtdElement(b,T,t);case a.EntityDeclaration:return this.dtdEntity(b,T,t);case a.NotationDeclaration:return this.dtdNotation(b,T,t);default:throw new Error("Unknown XML node type: "+b.constructor.name)}},k.prototype.processingInstruction=function(b,T,t){var S;return this.openNode(b,T,t),T.state=h.OpenTag,S=this.indent(b,T,t)+"<?",T.state=h.InsideTag,S+=b.target,b.value&&(S+=" "+b.value),T.state=h.CloseTag,S+=T.spaceBeforeSlash+"?>",S+=this.endline(b,T,t),T.state=h.None,this.closeNode(b,T,t),S},k.prototype.raw=function(b,T,t){var S;return this.openNode(b,T,t),T.state=h.OpenTag,S=this.indent(b,T,t),T.state=h.InsideTag,S+=b.value,T.state=h.CloseTag,S+=this.endline(b,T,t),T.state=h.None,this.closeNode(b,T,t),S},k.prototype.text=function(b,T,t){var S;return this.openNode(b,T,t),T.state=h.OpenTag,S=this.indent(b,T,t),T.state=h.InsideTag,S+=b.value,T.state=h.CloseTag,S+=this.endline(b,T,t),T.state=h.None,this.closeNode(b,T,t),S},k.prototype.dtdAttList=function(b,T,t){var S;return this.openNode(b,T,t),T.state=h.OpenTag,S=this.indent(b,T,t)+"<!ATTLIST",T.state=h.InsideTag,S+=" "+b.elementName+" "+b.attributeName+" "+b.attributeType,b.defaultValueType!=="#DEFAULT"&&(S+=" "+b.defaultValueType),b.defaultValue&&(S+=' "'+b.defaultValue+'"'),T.state=h.CloseTag,S+=T.spaceBeforeSlash+">"+this.endline(b,T,t),T.state=h.None,this.closeNode(b,T,t),S},k.prototype.dtdElement=function(b,T,t){var S;return this.openNode(b,T,t),T.state=h.OpenTag,S=this.indent(b,T,t)+"<!ELEMENT",T.state=h.InsideTag,S+=" "+b.name+" "+b.value,T.state=h.CloseTag,S+=T.spaceBeforeSlash+">"+this.endline(b,T,t),T.state=h.None,this.closeNode(b,T,t),S},k.prototype.dtdEntity=function(b,T,t){var S;return this.openNode(b,T,t),T.state=h.OpenTag,S=this.indent(b,T,t)+"<!ENTITY",T.state=h.InsideTag,b.pe&&(S+=" %"),S+=" "+b.name,b.value?S+=' "'+b.value+'"':(b.pubID&&b.sysID?S+=' PUBLIC "'+b.pubID+'" "'+b.sysID+'"':b.sysID&&(S+=' SYSTEM "'+b.sysID+'"'),b.nData&&(S+=" NDATA "+b.nData)),T.state=h.CloseTag,S+=T.spaceBeforeSlash+">"+this.endline(b,T,t),T.state=h.None,this.closeNode(b,T,t),S},k.prototype.dtdNotation=function(b,T,t){var S;return this.openNode(b,T,t),T.state=h.OpenTag,S=this.indent(b,T,t)+"<!NOTATION",T.state=h.InsideTag,S+=" "+b.name,b.pubID&&b.sysID?S+=' PUBLIC "'+b.pubID+'" "'+b.sysID+'"':b.pubID?S+=' PUBLIC "'+b.pubID+'"':b.sysID&&(S+=' SYSTEM "'+b.sysID+'"'),T.state=h.CloseTag,S+=T.spaceBeforeSlash+">"+this.endline(b,T,t),T.state=h.None,this.closeNode(b,T,t),S},k.prototype.openNode=function(b,T,t){},k.prototype.closeNode=function(b,T,t){},k.prototype.openAttribute=function(b,T,t){},k.prototype.closeAttribute=function(b,T,t){},k}()}.call(Hr)),Wg.exports}var Lw;function f1(){return Lw||(Lw=1,function(){var a,h=function(_,k){for(var b in k)v.call(k,b)&&(_[b]=k[b]);function T(){this.constructor=_}return T.prototype=k.prototype,_.prototype=new T,_.__super__=k.prototype,_},v={}.hasOwnProperty;a=uT(),qg.exports=function(_){h(k,_);function k(b){k.__super__.constructor.call(this,b)}return k.prototype.document=function(b,T){var t,S,D,w,E;for(T=this.filterOptions(T),w="",E=b.children,S=0,D=E.length;S<D;S++)t=E[S],w+=this.writeChildNode(t,T,0);return T.pretty&&w.slice(-T.newline.length)===T.newline&&(w=w.slice(0,-T.newline.length)),w},k}(a)}.call(Hr)),qg.exports}var Ow;function cT(){return Ow||(Ow=1,function(){var a,h,v,_,k,b,T,t=function(D,w){for(var E in w)S.call(w,E)&&(D[E]=w[E]);function m(){this.constructor=D}return m.prototype=w.prototype,D.prototype=new m,D.__super__=w.prototype,D},S={}.hasOwnProperty;T=ws().isPlainObject,v=aT(),h=L5(),_=to(),a=Bn(),b=lT(),k=f1(),bg.exports=function(D){t(w,D);function w(E){w.__super__.constructor.call(this,null),this.name="#document",this.type=a.Document,this.documentURI=null,this.domConfig=new h,E||(E={}),E.writer||(E.writer=new k),this.options=E,this.stringify=new b(E)}return Object.defineProperty(w.prototype,"implementation",{value:new v}),Object.defineProperty(w.prototype,"doctype",{get:function(){var E,m,y,p;for(p=this.children,m=0,y=p.length;m<y;m++)if(E=p[m],E.type===a.DocType)return E;return null}}),Object.defineProperty(w.prototype,"documentElement",{get:function(){return this.rootObject||null}}),Object.defineProperty(w.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(w.prototype,"strictErrorChecking",{get:function(){return!1}}),Object.defineProperty(w.prototype,"xmlEncoding",{get:function(){return this.children.length!==0&&this.children[0].type===a.Declaration?this.children[0].encoding:null}}),Object.defineProperty(w.prototype,"xmlStandalone",{get:function(){return this.children.length!==0&&this.children[0].type===a.Declaration?this.children[0].standalone==="yes":!1}}),Object.defineProperty(w.prototype,"xmlVersion",{get:function(){return this.children.length!==0&&this.children[0].type===a.Declaration?this.children[0].version:"1.0"}}),Object.defineProperty(w.prototype,"URL",{get:function(){return this.documentURI}}),Object.defineProperty(w.prototype,"origin",{get:function(){return null}}),Object.defineProperty(w.prototype,"compatMode",{get:function(){return null}}),Object.defineProperty(w.prototype,"characterSet",{get:function(){return null}}),Object.defineProperty(w.prototype,"contentType",{get:function(){return null}}),w.prototype.end=function(E){var m;return m={},E?T(E)&&(m=E,E=this.options.writer):E=this.options.writer,E.document(this,E.filterOptions(m))},w.prototype.toString=function(E){return this.options.writer.document(this,this.options.writer.filterOptions(E))},w.prototype.createElement=function(E){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.createDocumentFragment=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.createTextNode=function(E){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.createComment=function(E){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.createCDATASection=function(E){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.createProcessingInstruction=function(E,m){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.createAttribute=function(E){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.createEntityReference=function(E){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.getElementsByTagName=function(E){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.importNode=function(E,m){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.createElementNS=function(E,m){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.createAttributeNS=function(E,m){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.getElementsByTagNameNS=function(E,m){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.getElementById=function(E){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.adoptNode=function(E){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.normalizeDocument=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.renameNode=function(E,m,y){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.getElementsByClassName=function(E){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.createEvent=function(E){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.createRange=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.createNodeIterator=function(E,m,y){throw new Error("This DOM method is not implemented."+this.debugInfo())},w.prototype.createTreeWalker=function(E,m,y){throw new Error("This DOM method is not implemented."+this.debugInfo())},w}(_)}.call(Hr)),bg.exports}var Zg={exports:{}},zw;function k5(){return zw||(zw=1,function(){var a,h,v,_,k,b,T,t,S,D,w,E,m,y,p,C,z,A,P,x,O,U,G,Z={}.hasOwnProperty;G=ws(),O=G.isObject,x=G.isFunction,U=G.isPlainObject,P=G.getValue,a=Bn(),E=cT(),m=e1(),_=t1(),k=r1(),p=u1(),A=c1(),y=h1(),D=i1(),w=l1(),b=n1(),t=a1(),T=o1(),S=s1(),v=oT(),z=lT(),C=f1(),h=tm(),Zg.exports=function(){function X(W,J,re){var te;this.name="?xml",this.type=a.Document,W||(W={}),te={},W.writer?U(W.writer)&&(te=W.writer,W.writer=new C):W.writer=new C,this.options=W,this.writer=W.writer,this.writerOptions=this.writer.filterOptions(te),this.stringify=new z(W),this.onDataCallback=J||function(){},this.onEndCallback=re||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}return X.prototype.createChildNode=function(W){var J,re,te,ye,ue,Se,Le,Pe;switch(W.type){case a.CData:this.cdata(W.value);break;case a.Comment:this.comment(W.value);break;case a.Element:te={},Le=W.attribs;for(re in Le)Z.call(Le,re)&&(J=Le[re],te[re]=J.value);this.node(W.name,te);break;case a.Dummy:this.dummy();break;case a.Raw:this.raw(W.value);break;case a.Text:this.text(W.value);break;case a.ProcessingInstruction:this.instruction(W.target,W.value);break;default:throw new Error("This XML node type is not supported in a JS object: "+W.constructor.name)}for(Pe=W.children,ue=0,Se=Pe.length;ue<Se;ue++)ye=Pe[ue],this.createChildNode(ye),ye.type===a.Element&&this.up();return this},X.prototype.dummy=function(){return this},X.prototype.node=function(W,J,re){var te;if(W==null)throw new Error("Missing node name.");if(this.root&&this.currentLevel===-1)throw new Error("Document can only have one root node. "+this.debugInfo(W));return this.openCurrent(),W=P(W),J==null&&(J={}),J=P(J),O(J)||(te=[J,re],re=te[0],J=te[1]),this.currentNode=new m(this,W,J),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,re!=null&&this.text(re),this},X.prototype.element=function(W,J,re){var te,ye,ue,Se,Le,Pe;if(this.currentNode&&this.currentNode.type===a.DocType)this.dtdElement.apply(this,arguments);else if(Array.isArray(W)||O(W)||x(W))for(Se=this.options.noValidation,this.options.noValidation=!0,Pe=new E(this.options).element("TEMP_ROOT"),Pe.element(W),this.options.noValidation=Se,Le=Pe.children,ye=0,ue=Le.length;ye<ue;ye++)te=Le[ye],this.createChildNode(te),te.type===a.Element&&this.up();else this.node(W,J,re);return this},X.prototype.attribute=function(W,J){var re,te;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode. "+this.debugInfo(W));if(W!=null&&(W=P(W)),O(W))for(re in W)Z.call(W,re)&&(te=W[re],this.attribute(re,te));else x(J)&&(J=J.apply()),this.options.keepNullAttributes&&J==null?this.currentNode.attribs[W]=new v(this,W,""):J!=null&&(this.currentNode.attribs[W]=new v(this,W,J));return this},X.prototype.text=function(W){var J;return this.openCurrent(),J=new A(this,W),this.onData(this.writer.text(J,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},X.prototype.cdata=function(W){var J;return this.openCurrent(),J=new _(this,W),this.onData(this.writer.cdata(J,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},X.prototype.comment=function(W){var J;return this.openCurrent(),J=new k(this,W),this.onData(this.writer.comment(J,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},X.prototype.raw=function(W){var J;return this.openCurrent(),J=new p(this,W),this.onData(this.writer.raw(J,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},X.prototype.instruction=function(W,J){var re,te,ye,ue,Se;if(this.openCurrent(),W!=null&&(W=P(W)),J!=null&&(J=P(J)),Array.isArray(W))for(re=0,ue=W.length;re<ue;re++)te=W[re],this.instruction(te);else if(O(W))for(te in W)Z.call(W,te)&&(ye=W[te],this.instruction(te,ye));else x(J)&&(J=J.apply()),Se=new y(this,W,J),this.onData(this.writer.processingInstruction(Se,this.writerOptions,this.currentLevel+1),this.currentLevel+1);return this},X.prototype.declaration=function(W,J,re){var te;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node.");return te=new D(this,W,J,re),this.onData(this.writer.declaration(te,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},X.prototype.doctype=function(W,J,re){if(this.openCurrent(),W==null)throw new Error("Missing root node name.");if(this.root)throw new Error("dtd() must come before the root node.");return this.currentNode=new w(this,J,re),this.currentNode.rootNodeName=W,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this},X.prototype.dtdElement=function(W,J){var re;return this.openCurrent(),re=new T(this,W,J),this.onData(this.writer.dtdElement(re,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},X.prototype.attList=function(W,J,re,te,ye){var ue;return this.openCurrent(),ue=new b(this,W,J,re,te,ye),this.onData(this.writer.dtdAttList(ue,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},X.prototype.entity=function(W,J){var re;return this.openCurrent(),re=new t(this,!1,W,J),this.onData(this.writer.dtdEntity(re,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},X.prototype.pEntity=function(W,J){var re;return this.openCurrent(),re=new t(this,!0,W,J),this.onData(this.writer.dtdEntity(re,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},X.prototype.notation=function(W,J){var re;return this.openCurrent(),re=new S(this,W,J),this.onData(this.writer.dtdNotation(re,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},X.prototype.up=function(){if(this.currentLevel<0)throw new Error("The document node has no parent.");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this},X.prototype.end=function(){for(;this.currentLevel>=0;)this.up();return this.onEnd()},X.prototype.openCurrent=function(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)},X.prototype.openNode=function(W){var J,re,te,ye;if(!W.isOpen){if(!this.root&&this.currentLevel===0&&W.type===a.Element&&(this.root=W),re="",W.type===a.Element){this.writerOptions.state=h.OpenTag,re=this.writer.indent(W,this.writerOptions,this.currentLevel)+"<"+W.name,ye=W.attribs;for(te in ye)Z.call(ye,te)&&(J=ye[te],re+=this.writer.attribute(J,this.writerOptions,this.currentLevel));re+=(W.children?">":"/>")+this.writer.endline(W,this.writerOptions,this.currentLevel),this.writerOptions.state=h.InsideTag}else this.writerOptions.state=h.OpenTag,re=this.writer.indent(W,this.writerOptions,this.currentLevel)+"<!DOCTYPE "+W.rootNodeName,W.pubID&&W.sysID?re+=' PUBLIC "'+W.pubID+'" "'+W.sysID+'"':W.sysID&&(re+=' SYSTEM "'+W.sysID+'"'),W.children?(re+=" [",this.writerOptions.state=h.InsideTag):(this.writerOptions.state=h.CloseTag,re+=">"),re+=this.writer.endline(W,this.writerOptions,this.currentLevel);return this.onData(re,this.currentLevel),W.isOpen=!0}},X.prototype.closeNode=function(W){var J;if(!W.isClosed)return J="",this.writerOptions.state=h.CloseTag,W.type===a.Element?J=this.writer.indent(W,this.writerOptions,this.currentLevel)+"</"+W.name+">"+this.writer.endline(W,this.writerOptions,this.currentLevel):J=this.writer.indent(W,this.writerOptions,this.currentLevel)+"]>"+this.writer.endline(W,this.writerOptions,this.currentLevel),this.writerOptions.state=h.None,this.onData(J,this.currentLevel),W.isClosed=!0},X.prototype.onData=function(W,J){return this.documentStarted=!0,this.onDataCallback(W,J+1)},X.prototype.onEnd=function(){return this.documentCompleted=!0,this.onEndCallback()},X.prototype.debugInfo=function(W){return W==null?"":"node: <"+W+">"},X.prototype.ele=function(){return this.element.apply(this,arguments)},X.prototype.nod=function(W,J,re){return this.node(W,J,re)},X.prototype.txt=function(W){return this.text(W)},X.prototype.dat=function(W){return this.cdata(W)},X.prototype.com=function(W){return this.comment(W)},X.prototype.ins=function(W,J){return this.instruction(W,J)},X.prototype.dec=function(W,J,re){return this.declaration(W,J,re)},X.prototype.dtd=function(W,J,re){return this.doctype(W,J,re)},X.prototype.e=function(W,J,re){return this.element(W,J,re)},X.prototype.n=function(W,J,re){return this.node(W,J,re)},X.prototype.t=function(W){return this.text(W)},X.prototype.d=function(W){return this.cdata(W)},X.prototype.c=function(W){return this.comment(W)},X.prototype.r=function(W){return this.raw(W)},X.prototype.i=function(W,J){return this.instruction(W,J)},X.prototype.att=function(){return this.currentNode&&this.currentNode.type===a.DocType?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},X.prototype.a=function(){return this.currentNode&&this.currentNode.type===a.DocType?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},X.prototype.ent=function(W,J){return this.entity(W,J)},X.prototype.pent=function(W,J){return this.pEntity(W,J)},X.prototype.not=function(W,J){return this.notation(W,J)},X}()}.call(Hr)),Zg.exports}var Xg={exports:{}},kw;function B5(){return kw||(kw=1,function(){var a,h,v,_=function(b,T){for(var t in T)k.call(T,t)&&(b[t]=T[t]);function S(){this.constructor=b}return S.prototype=T.prototype,b.prototype=new S,b.__super__=T.prototype,b},k={}.hasOwnProperty;a=Bn(),v=uT(),h=tm(),Xg.exports=function(b){_(T,b);function T(t,S){this.stream=t,T.__super__.constructor.call(this,S)}return T.prototype.endline=function(t,S,D){return t.isLastRootNode&&S.state===h.CloseTag?"":T.__super__.endline.call(this,t,S,D)},T.prototype.document=function(t,S){var D,w,E,m,y,p,C,z,A;for(C=t.children,w=E=0,y=C.length;E<y;w=++E)D=C[w],D.isLastRootNode=w===t.children.length-1;for(S=this.filterOptions(S),z=t.children,A=[],m=0,p=z.length;m<p;m++)D=z[m],A.push(this.writeChildNode(D,S,0));return A},T.prototype.attribute=function(t,S,D){return this.stream.write(T.__super__.attribute.call(this,t,S,D))},T.prototype.cdata=function(t,S,D){return this.stream.write(T.__super__.cdata.call(this,t,S,D))},T.prototype.comment=function(t,S,D){return this.stream.write(T.__super__.comment.call(this,t,S,D))},T.prototype.declaration=function(t,S,D){return this.stream.write(T.__super__.declaration.call(this,t,S,D))},T.prototype.docType=function(t,S,D){var w,E,m,y;if(D||(D=0),this.openNode(t,S,D),S.state=h.OpenTag,this.stream.write(this.indent(t,S,D)),this.stream.write("<!DOCTYPE "+t.root().name),t.pubID&&t.sysID?this.stream.write(' PUBLIC "'+t.pubID+'" "'+t.sysID+'"'):t.sysID&&this.stream.write(' SYSTEM "'+t.sysID+'"'),t.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline(t,S,D)),S.state=h.InsideTag,y=t.children,E=0,m=y.length;E<m;E++)w=y[E],this.writeChildNode(w,S,D+1);S.state=h.CloseTag,this.stream.write("]")}return S.state=h.CloseTag,this.stream.write(S.spaceBeforeSlash+">"),this.stream.write(this.endline(t,S,D)),S.state=h.None,this.closeNode(t,S,D)},T.prototype.element=function(t,S,D){var w,E,m,y,p,C,z,A,P;D||(D=0),this.openNode(t,S,D),S.state=h.OpenTag,this.stream.write(this.indent(t,S,D)+"<"+t.name),A=t.attribs;for(z in A)k.call(A,z)&&(w=A[z],this.attribute(w,S,D));if(m=t.children.length,y=m===0?null:t.children[0],m===0||t.children.every(function(x){return(x.type===a.Text||x.type===a.Raw)&&x.value===""}))S.allowEmpty?(this.stream.write(">"),S.state=h.CloseTag,this.stream.write("</"+t.name+">")):(S.state=h.CloseTag,this.stream.write(S.spaceBeforeSlash+"/>"));else if(S.pretty&&m===1&&(y.type===a.Text||y.type===a.Raw)&&y.value!=null)this.stream.write(">"),S.state=h.InsideTag,S.suppressPrettyCount++,this.writeChildNode(y,S,D+1),S.suppressPrettyCount--,S.state=h.CloseTag,this.stream.write("</"+t.name+">");else{for(this.stream.write(">"+this.endline(t,S,D)),S.state=h.InsideTag,P=t.children,p=0,C=P.length;p<C;p++)E=P[p],this.writeChildNode(E,S,D+1);S.state=h.CloseTag,this.stream.write(this.indent(t,S,D)+"</"+t.name+">")}return this.stream.write(this.endline(t,S,D)),S.state=h.None,this.closeNode(t,S,D)},T.prototype.processingInstruction=function(t,S,D){return this.stream.write(T.__super__.processingInstruction.call(this,t,S,D))},T.prototype.raw=function(t,S,D){return this.stream.write(T.__super__.raw.call(this,t,S,D))},T.prototype.text=function(t,S,D){return this.stream.write(T.__super__.text.call(this,t,S,D))},T.prototype.dtdAttList=function(t,S,D){return this.stream.write(T.__super__.dtdAttList.call(this,t,S,D))},T.prototype.dtdElement=function(t,S,D){return this.stream.write(T.__super__.dtdElement.call(this,t,S,D))},T.prototype.dtdEntity=function(t,S,D){return this.stream.write(T.__super__.dtdEntity.call(this,t,S,D))},T.prototype.dtdNotation=function(t,S,D){return this.stream.write(T.__super__.dtdNotation.call(this,t,S,D))},T}(v)}.call(Hr)),Xg.exports}var Bw;function F5(){return Bw||(Bw=1,function(){var a,h,v,_,k,b,T,t,S,D;D=ws(),t=D.assign,S=D.isFunction,v=aT(),_=cT(),k=k5(),T=f1(),b=B5(),a=Bn(),h=tm(),ms.create=function(w,E,m,y){var p,C;if(w==null)throw new Error("Root element needs a name.");return y=t({},E,m,y),p=new _(y),C=p.element(w),y.headless||(p.declaration(y),(y.pubID!=null||y.sysID!=null)&&p.dtd(y)),C},ms.begin=function(w,E,m){var y;return S(w)&&(y=[w,E],E=y[0],m=y[1],w={}),E?new k(w,E,m):new _(w)},ms.stringWriter=function(w){return new T(w)},ms.streamWriter=function(w,E){return new b(w,E)},ms.implementation=new v,ms.nodeType=a,ms.writerState=h}.call(Hr)),ms}var Fw;function N5(){return Fw||(Fw=1,function(){var a,h,v,_,k,b={}.hasOwnProperty;a=F5(),h=Jy().defaults,_=function(T){return typeof T=="string"&&(T.indexOf("&")>=0||T.indexOf(">")>=0||T.indexOf("<")>=0)},k=function(T){return"<![CDATA["+v(T)+"]]>"},v=function(T){return T.replace("]]>","]]]]><![CDATA[>")},yg.Builder=function(){function T(t){var S,D,w;this.options={},D=h["0.2"];for(S in D)b.call(D,S)&&(w=D[S],this.options[S]=w);for(S in t)b.call(t,S)&&(w=t[S],this.options[S]=w)}return T.prototype.buildObject=function(t){var S,D,w,E,m;return S=this.options.attrkey,D=this.options.charkey,Object.keys(t).length===1&&this.options.rootName===h["0.2"].rootName?(m=Object.keys(t)[0],t=t[m]):m=this.options.rootName,w=function(y){return function(p,C){var z,A,P,x,O,U;if(typeof C!="object")y.options.cdata&&_(C)?p.raw(k(C)):p.txt(C);else if(Array.isArray(C)){for(x in C)if(b.call(C,x)){A=C[x];for(O in A)P=A[O],p=w(p.ele(O),P).up()}}else for(O in C)if(b.call(C,O))if(A=C[O],O===S){if(typeof A=="object")for(z in A)U=A[z],p=p.att(z,U)}else if(O===D)y.options.cdata&&_(A)?p=p.raw(k(A)):p=p.txt(A);else if(Array.isArray(A))for(x in A)b.call(A,x)&&(P=A[x],typeof P=="string"?y.options.cdata&&_(P)?p=p.ele(O).raw(k(P)).up():p=p.ele(O,P).up():p=w(p.ele(O),P).up());else typeof A=="object"?p=w(p.ele(O),A).up():typeof A=="string"&&y.options.cdata&&_(A)?p=p.ele(O).raw(k(A)).up():(A==null&&(A=""),p=p.ele(O,A.toString()).up());return p}}(this),E=a.create(m,this.options.xmldec,this.options.doctype,{headless:this.options.headless,allowSurrogateChars:this.options.allowSurrogateChars}),w(E,t).end(this.options.renderOpts)},T}()}.call(Hr)),yg}var Yg={},Kg={},Nw;function Bf(){return Nw||(Nw=1,function(a){Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var h={},v={};v.byteLength=w,v.toByteArray=m,v.fromByteArray=C;for(var _=[],k=[],b=typeof Uint8Array<"u"?Uint8Array:Array,T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,S=T.length;t<S;++t)_[t]=T[t],k[T.charCodeAt(t)]=t;k[45]=62,k[95]=63;function D(P){var x=P.length;if(x%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var O=P.indexOf("=");O===-1&&(O=x);var U=O===x?0:4-O%4;return[O,U]}function w(P){var x=D(P),O=x[0],U=x[1];return(O+U)*3/4-U}function E(P,x,O){return(x+O)*3/4-O}function m(P){var x,O=D(P),U=O[0],G=O[1],Z=new b(E(P,U,G)),X=0,W=G>0?U-4:U,J;for(J=0;J<W;J+=4)x=k[P.charCodeAt(J)]<<18|k[P.charCodeAt(J+1)]<<12|k[P.charCodeAt(J+2)]<<6|k[P.charCodeAt(J+3)],Z[X++]=x>>16&255,Z[X++]=x>>8&255,Z[X++]=x&255;return G===2&&(x=k[P.charCodeAt(J)]<<2|k[P.charCodeAt(J+1)]>>4,Z[X++]=x&255),G===1&&(x=k[P.charCodeAt(J)]<<10|k[P.charCodeAt(J+1)]<<4|k[P.charCodeAt(J+2)]>>2,Z[X++]=x>>8&255,Z[X++]=x&255),Z}function y(P){return _[P>>18&63]+_[P>>12&63]+_[P>>6&63]+_[P&63]}function p(P,x,O){for(var U,G=[],Z=x;Z<O;Z+=3)U=(P[Z]<<16&16711680)+(P[Z+1]<<8&65280)+(P[Z+2]&255),G.push(y(U));return G.join("")}function C(P){for(var x,O=P.length,U=O%3,G=[],Z=16383,X=0,W=O-U;X<W;X+=Z)G.push(p(P,X,X+Z>W?W:X+Z));return U===1?(x=P[O-1],G.push(_[x>>2]+_[x<<4&63]+"==")):U===2&&(x=(P[O-2]<<8)+P[O-1],G.push(_[x>>10]+_[x>>4&63]+_[x<<2&63]+"=")),G.join("")}var z={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */z.read=function(P,x,O,U,G){var Z,X,W=G*8-U-1,J=(1<<W)-1,re=J>>1,te=-7,ye=O?G-1:0,ue=O?-1:1,Se=P[x+ye];for(ye+=ue,Z=Se&(1<<-te)-1,Se>>=-te,te+=W;te>0;Z=Z*256+P[x+ye],ye+=ue,te-=8);for(X=Z&(1<<-te)-1,Z>>=-te,te+=U;te>0;X=X*256+P[x+ye],ye+=ue,te-=8);if(Z===0)Z=1-re;else{if(Z===J)return X?NaN:(Se?-1:1)*(1/0);X=X+Math.pow(2,U),Z=Z-re}return(Se?-1:1)*X*Math.pow(2,Z-U)},z.write=function(P,x,O,U,G,Z){var X,W,J,re=Z*8-G-1,te=(1<<re)-1,ye=te>>1,ue=G===23?Math.pow(2,-24)-Math.pow(2,-77):0,Se=U?0:Z-1,Le=U?1:-1,Pe=x<0||x===0&&1/x<0?1:0;for(x=Math.abs(x),isNaN(x)||x===1/0?(W=isNaN(x)?1:0,X=te):(X=Math.floor(Math.log(x)/Math.LN2),x*(J=Math.pow(2,-X))<1&&(X--,J*=2),X+ye>=1?x+=ue/J:x+=ue*Math.pow(2,1-ye),x*J>=2&&(X++,J/=2),X+ye>=te?(W=0,X=te):X+ye>=1?(W=(x*J-1)*Math.pow(2,G),X=X+ye):(W=x*Math.pow(2,ye-1)*Math.pow(2,G),X=0));G>=8;P[O+Se]=W&255,Se+=Le,W/=256,G-=8);for(X=X<<G|W,re+=G;re>0;P[O+Se]=X&255,Se+=Le,X/=256,re-=8);P[O+Se-Le]|=Pe*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(P){const x=v,O=z,U=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;P.Buffer=te,P.SlowBuffer=Fe,P.INSPECT_MAX_BYTES=50;const G=2147483647;P.kMaxLength=G;const{Uint8Array:Z,ArrayBuffer:X,SharedArrayBuffer:W}=globalThis;te.TYPED_ARRAY_SUPPORT=J(),!te.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function J(){try{const ie=new Z(1),B={foo:function(){return 42}};return Object.setPrototypeOf(B,Z.prototype),Object.setPrototypeOf(ie,B),ie.foo()===42}catch{return!1}}Object.defineProperty(te.prototype,"parent",{enumerable:!0,get:function(){if(te.isBuffer(this))return this.buffer}}),Object.defineProperty(te.prototype,"offset",{enumerable:!0,get:function(){if(te.isBuffer(this))return this.byteOffset}});function re(ie){if(ie>G)throw new RangeError('The value "'+ie+'" is invalid for option "size"');const B=new Z(ie);return Object.setPrototypeOf(B,te.prototype),B}function te(ie,B,Q){if(typeof ie=="number"){if(typeof B=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return Le(ie)}return ye(ie,B,Q)}te.poolSize=8192;function ye(ie,B,Q){if(typeof ie=="string")return Pe(ie,B);if(X.isView(ie))return Me(ie);if(ie==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof ie);if(rt(ie,X)||ie&&rt(ie.buffer,X)||typeof W<"u"&&(rt(ie,W)||ie&&rt(ie.buffer,W)))return He(ie,B,Q);if(typeof ie=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const xe=ie.valueOf&&ie.valueOf();if(xe!=null&&xe!==ie)return te.from(xe,B,Q);const Ne=nt(ie);if(Ne)return Ne;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof ie[Symbol.toPrimitive]=="function")return te.from(ie[Symbol.toPrimitive]("string"),B,Q);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof ie)}te.from=function(ie,B,Q){return ye(ie,B,Q)},Object.setPrototypeOf(te.prototype,Z.prototype),Object.setPrototypeOf(te,Z);function ue(ie){if(typeof ie!="number")throw new TypeError('"size" argument must be of type number');if(ie<0)throw new RangeError('The value "'+ie+'" is invalid for option "size"')}function Se(ie,B,Q){return ue(ie),ie<=0?re(ie):B!==void 0?typeof Q=="string"?re(ie).fill(B,Q):re(ie).fill(B):re(ie)}te.alloc=function(ie,B,Q){return Se(ie,B,Q)};function Le(ie){return ue(ie),re(ie<0?0:ht(ie)|0)}te.allocUnsafe=function(ie){return Le(ie)},te.allocUnsafeSlow=function(ie){return Le(ie)};function Pe(ie,B){if((typeof B!="string"||B==="")&&(B="utf8"),!te.isEncoding(B))throw new TypeError("Unknown encoding: "+B);const Q=Ce(ie,B)|0;let xe=re(Q);const Ne=xe.write(ie,B);return Ne!==Q&&(xe=xe.slice(0,Ne)),xe}function Ee(ie){const B=ie.length<0?0:ht(ie.length)|0,Q=re(B);for(let xe=0;xe<B;xe+=1)Q[xe]=ie[xe]&255;return Q}function Me(ie){if(rt(ie,Z)){const B=new Z(ie);return He(B.buffer,B.byteOffset,B.byteLength)}return Ee(ie)}function He(ie,B,Q){if(B<0||ie.byteLength<B)throw new RangeError('"offset" is outside of buffer bounds');if(ie.byteLength<B+(Q||0))throw new RangeError('"length" is outside of buffer bounds');let xe;return B===void 0&&Q===void 0?xe=new Z(ie):Q===void 0?xe=new Z(ie,B):xe=new Z(ie,B,Q),Object.setPrototypeOf(xe,te.prototype),xe}function nt(ie){if(te.isBuffer(ie)){const B=ht(ie.length)|0,Q=re(B);return Q.length===0||ie.copy(Q,0,0,B),Q}if(ie.length!==void 0)return typeof ie.length!="number"||sr(ie.length)?re(0):Ee(ie);if(ie.type==="Buffer"&&Array.isArray(ie.data))return Ee(ie.data)}function ht(ie){if(ie>=G)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+G.toString(16)+" bytes");return ie|0}function Fe(ie){return+ie!=ie&&(ie=0),te.alloc(+ie)}te.isBuffer=function(B){return B!=null&&B._isBuffer===!0&&B!==te.prototype},te.compare=function(B,Q){if(rt(B,Z)&&(B=te.from(B,B.offset,B.byteLength)),rt(Q,Z)&&(Q=te.from(Q,Q.offset,Q.byteLength)),!te.isBuffer(B)||!te.isBuffer(Q))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(B===Q)return 0;let xe=B.length,Ne=Q.length;for(let Ze=0,ot=Math.min(xe,Ne);Ze<ot;++Ze)if(B[Ze]!==Q[Ze]){xe=B[Ze],Ne=Q[Ze];break}return xe<Ne?-1:Ne<xe?1:0},te.isEncoding=function(B){switch(String(B).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},te.concat=function(B,Q){if(!Array.isArray(B))throw new TypeError('"list" argument must be an Array of Buffers');if(B.length===0)return te.alloc(0);let xe;if(Q===void 0)for(Q=0,xe=0;xe<B.length;++xe)Q+=B[xe].length;const Ne=te.allocUnsafe(Q);let Ze=0;for(xe=0;xe<B.length;++xe){let ot=B[xe];if(rt(ot,Z))Ze+ot.length>Ne.length?(te.isBuffer(ot)||(ot=te.from(ot)),ot.copy(Ne,Ze)):Z.prototype.set.call(Ne,ot,Ze);else if(te.isBuffer(ot))ot.copy(Ne,Ze);else throw new TypeError('"list" argument must be an Array of Buffers');Ze+=ot.length}return Ne};function Ce(ie,B){if(te.isBuffer(ie))return ie.length;if(X.isView(ie)||rt(ie,X))return ie.byteLength;if(typeof ie!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof ie);const Q=ie.length,xe=arguments.length>2&&arguments[2]===!0;if(!xe&&Q===0)return 0;let Ne=!1;for(;;)switch(B){case"ascii":case"latin1":case"binary":return Q;case"utf8":case"utf-8":return St(ie).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Q*2;case"hex":return Q>>>1;case"base64":return Rt(ie).length;default:if(Ne)return xe?-1:St(ie).length;B=(""+B).toLowerCase(),Ne=!0}}te.byteLength=Ce;function Be(ie,B,Q){let xe=!1;if((B===void 0||B<0)&&(B=0),B>this.length||((Q===void 0||Q>this.length)&&(Q=this.length),Q<=0)||(Q>>>=0,B>>>=0,Q<=B))return"";for(ie||(ie="utf8");;)switch(ie){case"hex":return ve(this,B,Q);case"utf8":case"utf-8":return We(this,B,Q);case"ascii":return ze(this,B,Q);case"latin1":case"binary":return de(this,B,Q);case"base64":return Ge(this,B,Q);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return be(this,B,Q);default:if(xe)throw new TypeError("Unknown encoding: "+ie);ie=(ie+"").toLowerCase(),xe=!0}}te.prototype._isBuffer=!0;function Ae(ie,B,Q){const xe=ie[B];ie[B]=ie[Q],ie[Q]=xe}te.prototype.swap16=function(){const B=this.length;if(B%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let Q=0;Q<B;Q+=2)Ae(this,Q,Q+1);return this},te.prototype.swap32=function(){const B=this.length;if(B%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let Q=0;Q<B;Q+=4)Ae(this,Q,Q+3),Ae(this,Q+1,Q+2);return this},te.prototype.swap64=function(){const B=this.length;if(B%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let Q=0;Q<B;Q+=8)Ae(this,Q,Q+7),Ae(this,Q+1,Q+6),Ae(this,Q+2,Q+5),Ae(this,Q+3,Q+4);return this},te.prototype.toString=function(){const B=this.length;return B===0?"":arguments.length===0?We(this,0,B):Be.apply(this,arguments)},te.prototype.toLocaleString=te.prototype.toString,te.prototype.equals=function(B){if(!te.isBuffer(B))throw new TypeError("Argument must be a Buffer");return this===B?!0:te.compare(this,B)===0},te.prototype.inspect=function(){let B="";const Q=P.INSPECT_MAX_BYTES;return B=this.toString("hex",0,Q).replace(/(.{2})/g,"$1 ").trim(),this.length>Q&&(B+=" ... "),"<Buffer "+B+">"},U&&(te.prototype[U]=te.prototype.inspect),te.prototype.compare=function(B,Q,xe,Ne,Ze){if(rt(B,Z)&&(B=te.from(B,B.offset,B.byteLength)),!te.isBuffer(B))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof B);if(Q===void 0&&(Q=0),xe===void 0&&(xe=B?B.length:0),Ne===void 0&&(Ne=0),Ze===void 0&&(Ze=this.length),Q<0||xe>B.length||Ne<0||Ze>this.length)throw new RangeError("out of range index");if(Ne>=Ze&&Q>=xe)return 0;if(Ne>=Ze)return-1;if(Q>=xe)return 1;if(Q>>>=0,xe>>>=0,Ne>>>=0,Ze>>>=0,this===B)return 0;let ot=Ze-Ne,mt=xe-Q;const Nt=Math.min(ot,mt),Bt=this.slice(Ne,Ze),Lt=B.slice(Q,xe);for(let Yt=0;Yt<Nt;++Yt)if(Bt[Yt]!==Lt[Yt]){ot=Bt[Yt],mt=Lt[Yt];break}return ot<mt?-1:mt<ot?1:0};function se(ie,B,Q,xe,Ne){if(ie.length===0)return-1;if(typeof Q=="string"?(xe=Q,Q=0):Q>2147483647?Q=2147483647:Q<-2147483648&&(Q=-2147483648),Q=+Q,sr(Q)&&(Q=Ne?0:ie.length-1),Q<0&&(Q=ie.length+Q),Q>=ie.length){if(Ne)return-1;Q=ie.length-1}else if(Q<0)if(Ne)Q=0;else return-1;if(typeof B=="string"&&(B=te.from(B,xe)),te.isBuffer(B))return B.length===0?-1:pe(ie,B,Q,xe,Ne);if(typeof B=="number")return B=B&255,typeof Z.prototype.indexOf=="function"?Ne?Z.prototype.indexOf.call(ie,B,Q):Z.prototype.lastIndexOf.call(ie,B,Q):pe(ie,[B],Q,xe,Ne);throw new TypeError("val must be string, number or Buffer")}function pe(ie,B,Q,xe,Ne){let Ze=1,ot=ie.length,mt=B.length;if(xe!==void 0&&(xe=String(xe).toLowerCase(),xe==="ucs2"||xe==="ucs-2"||xe==="utf16le"||xe==="utf-16le")){if(ie.length<2||B.length<2)return-1;Ze=2,ot/=2,mt/=2,Q/=2}function Nt(Lt,Yt){return Ze===1?Lt[Yt]:Lt.readUInt16BE(Yt*Ze)}let Bt;if(Ne){let Lt=-1;for(Bt=Q;Bt<ot;Bt++)if(Nt(ie,Bt)===Nt(B,Lt===-1?0:Bt-Lt)){if(Lt===-1&&(Lt=Bt),Bt-Lt+1===mt)return Lt*Ze}else Lt!==-1&&(Bt-=Bt-Lt),Lt=-1}else for(Q+mt>ot&&(Q=ot-mt),Bt=Q;Bt>=0;Bt--){let Lt=!0;for(let Yt=0;Yt<mt;Yt++)if(Nt(ie,Bt+Yt)!==Nt(B,Yt)){Lt=!1;break}if(Lt)return Bt}return-1}te.prototype.includes=function(B,Q,xe){return this.indexOf(B,Q,xe)!==-1},te.prototype.indexOf=function(B,Q,xe){return se(this,B,Q,xe,!0)},te.prototype.lastIndexOf=function(B,Q,xe){return se(this,B,Q,xe,!1)};function Ke(ie,B,Q,xe){Q=Number(Q)||0;const Ne=ie.length-Q;xe?(xe=Number(xe),xe>Ne&&(xe=Ne)):xe=Ne;const Ze=B.length;xe>Ze/2&&(xe=Ze/2);let ot;for(ot=0;ot<xe;++ot){const mt=parseInt(B.substr(ot*2,2),16);if(sr(mt))return ot;ie[Q+ot]=mt}return ot}function _e(ie,B,Q,xe){return $t(St(B,ie.length-Q),ie,Q,xe)}function ke(ie,B,Q,xe){return $t(Ut(B),ie,Q,xe)}function qe(ie,B,Q,xe){return $t(Rt(B),ie,Q,xe)}function tt(ie,B,Q,xe){return $t(ir(B,ie.length-Q),ie,Q,xe)}te.prototype.write=function(B,Q,xe,Ne){if(Q===void 0)Ne="utf8",xe=this.length,Q=0;else if(xe===void 0&&typeof Q=="string")Ne=Q,xe=this.length,Q=0;else if(isFinite(Q))Q=Q>>>0,isFinite(xe)?(xe=xe>>>0,Ne===void 0&&(Ne="utf8")):(Ne=xe,xe=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Ze=this.length-Q;if((xe===void 0||xe>Ze)&&(xe=Ze),B.length>0&&(xe<0||Q<0)||Q>this.length)throw new RangeError("Attempt to write outside buffer bounds");Ne||(Ne="utf8");let ot=!1;for(;;)switch(Ne){case"hex":return Ke(this,B,Q,xe);case"utf8":case"utf-8":return _e(this,B,Q,xe);case"ascii":case"latin1":case"binary":return ke(this,B,Q,xe);case"base64":return qe(this,B,Q,xe);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return tt(this,B,Q,xe);default:if(ot)throw new TypeError("Unknown encoding: "+Ne);Ne=(""+Ne).toLowerCase(),ot=!0}},te.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Ge(ie,B,Q){return B===0&&Q===ie.length?x.fromByteArray(ie):x.fromByteArray(ie.slice(B,Q))}function We(ie,B,Q){Q=Math.min(ie.length,Q);const xe=[];let Ne=B;for(;Ne<Q;){const Ze=ie[Ne];let ot=null,mt=Ze>239?4:Ze>223?3:Ze>191?2:1;if(Ne+mt<=Q){let Nt,Bt,Lt,Yt;switch(mt){case 1:Ze<128&&(ot=Ze);break;case 2:Nt=ie[Ne+1],(Nt&192)===128&&(Yt=(Ze&31)<<6|Nt&63,Yt>127&&(ot=Yt));break;case 3:Nt=ie[Ne+1],Bt=ie[Ne+2],(Nt&192)===128&&(Bt&192)===128&&(Yt=(Ze&15)<<12|(Nt&63)<<6|Bt&63,Yt>2047&&(Yt<55296||Yt>57343)&&(ot=Yt));break;case 4:Nt=ie[Ne+1],Bt=ie[Ne+2],Lt=ie[Ne+3],(Nt&192)===128&&(Bt&192)===128&&(Lt&192)===128&&(Yt=(Ze&15)<<18|(Nt&63)<<12|(Bt&63)<<6|Lt&63,Yt>65535&&Yt<1114112&&(ot=Yt))}}ot===null?(ot=65533,mt=1):ot>65535&&(ot-=65536,xe.push(ot>>>10&1023|55296),ot=56320|ot&1023),xe.push(ot),Ne+=mt}return it(xe)}const Je=4096;function it(ie){const B=ie.length;if(B<=Je)return String.fromCharCode.apply(String,ie);let Q="",xe=0;for(;xe<B;)Q+=String.fromCharCode.apply(String,ie.slice(xe,xe+=Je));return Q}function ze(ie,B,Q){let xe="";Q=Math.min(ie.length,Q);for(let Ne=B;Ne<Q;++Ne)xe+=String.fromCharCode(ie[Ne]&127);return xe}function de(ie,B,Q){let xe="";Q=Math.min(ie.length,Q);for(let Ne=B;Ne<Q;++Ne)xe+=String.fromCharCode(ie[Ne]);return xe}function ve(ie,B,Q){const xe=ie.length;(!B||B<0)&&(B=0),(!Q||Q<0||Q>xe)&&(Q=xe);let Ne="";for(let Ze=B;Ze<Q;++Ze)Ne+=Fr[ie[Ze]];return Ne}function be(ie,B,Q){const xe=ie.slice(B,Q);let Ne="";for(let Ze=0;Ze<xe.length-1;Ze+=2)Ne+=String.fromCharCode(xe[Ze]+xe[Ze+1]*256);return Ne}te.prototype.slice=function(B,Q){const xe=this.length;B=~~B,Q=Q===void 0?xe:~~Q,B<0?(B+=xe,B<0&&(B=0)):B>xe&&(B=xe),Q<0?(Q+=xe,Q<0&&(Q=0)):Q>xe&&(Q=xe),Q<B&&(Q=B);const Ne=this.subarray(B,Q);return Object.setPrototypeOf(Ne,te.prototype),Ne};function Oe(ie,B,Q){if(ie%1!==0||ie<0)throw new RangeError("offset is not uint");if(ie+B>Q)throw new RangeError("Trying to access beyond buffer length")}te.prototype.readUintLE=te.prototype.readUIntLE=function(B,Q,xe){B=B>>>0,Q=Q>>>0,xe||Oe(B,Q,this.length);let Ne=this[B],Ze=1,ot=0;for(;++ot<Q&&(Ze*=256);)Ne+=this[B+ot]*Ze;return Ne},te.prototype.readUintBE=te.prototype.readUIntBE=function(B,Q,xe){B=B>>>0,Q=Q>>>0,xe||Oe(B,Q,this.length);let Ne=this[B+--Q],Ze=1;for(;Q>0&&(Ze*=256);)Ne+=this[B+--Q]*Ze;return Ne},te.prototype.readUint8=te.prototype.readUInt8=function(B,Q){return B=B>>>0,Q||Oe(B,1,this.length),this[B]},te.prototype.readUint16LE=te.prototype.readUInt16LE=function(B,Q){return B=B>>>0,Q||Oe(B,2,this.length),this[B]|this[B+1]<<8},te.prototype.readUint16BE=te.prototype.readUInt16BE=function(B,Q){return B=B>>>0,Q||Oe(B,2,this.length),this[B]<<8|this[B+1]},te.prototype.readUint32LE=te.prototype.readUInt32LE=function(B,Q){return B=B>>>0,Q||Oe(B,4,this.length),(this[B]|this[B+1]<<8|this[B+2]<<16)+this[B+3]*16777216},te.prototype.readUint32BE=te.prototype.readUInt32BE=function(B,Q){return B=B>>>0,Q||Oe(B,4,this.length),this[B]*16777216+(this[B+1]<<16|this[B+2]<<8|this[B+3])},te.prototype.readBigUInt64LE=ee(function(B){B=B>>>0,fr(B,"offset");const Q=this[B],xe=this[B+7];(Q===void 0||xe===void 0)&&Vr(B,this.length-8);const Ne=Q+this[++B]*2**8+this[++B]*2**16+this[++B]*2**24,Ze=this[++B]+this[++B]*2**8+this[++B]*2**16+xe*2**24;return BigInt(Ne)+(BigInt(Ze)<<BigInt(32))}),te.prototype.readBigUInt64BE=ee(function(B){B=B>>>0,fr(B,"offset");const Q=this[B],xe=this[B+7];(Q===void 0||xe===void 0)&&Vr(B,this.length-8);const Ne=Q*2**24+this[++B]*2**16+this[++B]*2**8+this[++B],Ze=this[++B]*2**24+this[++B]*2**16+this[++B]*2**8+xe;return(BigInt(Ne)<<BigInt(32))+BigInt(Ze)}),te.prototype.readIntLE=function(B,Q,xe){B=B>>>0,Q=Q>>>0,xe||Oe(B,Q,this.length);let Ne=this[B],Ze=1,ot=0;for(;++ot<Q&&(Ze*=256);)Ne+=this[B+ot]*Ze;return Ze*=128,Ne>=Ze&&(Ne-=Math.pow(2,8*Q)),Ne},te.prototype.readIntBE=function(B,Q,xe){B=B>>>0,Q=Q>>>0,xe||Oe(B,Q,this.length);let Ne=Q,Ze=1,ot=this[B+--Ne];for(;Ne>0&&(Ze*=256);)ot+=this[B+--Ne]*Ze;return Ze*=128,ot>=Ze&&(ot-=Math.pow(2,8*Q)),ot},te.prototype.readInt8=function(B,Q){return B=B>>>0,Q||Oe(B,1,this.length),this[B]&128?(255-this[B]+1)*-1:this[B]},te.prototype.readInt16LE=function(B,Q){B=B>>>0,Q||Oe(B,2,this.length);const xe=this[B]|this[B+1]<<8;return xe&32768?xe|4294901760:xe},te.prototype.readInt16BE=function(B,Q){B=B>>>0,Q||Oe(B,2,this.length);const xe=this[B+1]|this[B]<<8;return xe&32768?xe|4294901760:xe},te.prototype.readInt32LE=function(B,Q){return B=B>>>0,Q||Oe(B,4,this.length),this[B]|this[B+1]<<8|this[B+2]<<16|this[B+3]<<24},te.prototype.readInt32BE=function(B,Q){return B=B>>>0,Q||Oe(B,4,this.length),this[B]<<24|this[B+1]<<16|this[B+2]<<8|this[B+3]},te.prototype.readBigInt64LE=ee(function(B){B=B>>>0,fr(B,"offset");const Q=this[B],xe=this[B+7];(Q===void 0||xe===void 0)&&Vr(B,this.length-8);const Ne=this[B+4]+this[B+5]*2**8+this[B+6]*2**16+(xe<<24);return(BigInt(Ne)<<BigInt(32))+BigInt(Q+this[++B]*2**8+this[++B]*2**16+this[++B]*2**24)}),te.prototype.readBigInt64BE=ee(function(B){B=B>>>0,fr(B,"offset");const Q=this[B],xe=this[B+7];(Q===void 0||xe===void 0)&&Vr(B,this.length-8);const Ne=(Q<<24)+this[++B]*2**16+this[++B]*2**8+this[++B];return(BigInt(Ne)<<BigInt(32))+BigInt(this[++B]*2**24+this[++B]*2**16+this[++B]*2**8+xe)}),te.prototype.readFloatLE=function(B,Q){return B=B>>>0,Q||Oe(B,4,this.length),O.read(this,B,!0,23,4)},te.prototype.readFloatBE=function(B,Q){return B=B>>>0,Q||Oe(B,4,this.length),O.read(this,B,!1,23,4)},te.prototype.readDoubleLE=function(B,Q){return B=B>>>0,Q||Oe(B,8,this.length),O.read(this,B,!0,52,8)},te.prototype.readDoubleBE=function(B,Q){return B=B>>>0,Q||Oe(B,8,this.length),O.read(this,B,!1,52,8)};function ge(ie,B,Q,xe,Ne,Ze){if(!te.isBuffer(ie))throw new TypeError('"buffer" argument must be a Buffer instance');if(B>Ne||B<Ze)throw new RangeError('"value" argument is out of bounds');if(Q+xe>ie.length)throw new RangeError("Index out of range")}te.prototype.writeUintLE=te.prototype.writeUIntLE=function(B,Q,xe,Ne){if(B=+B,Q=Q>>>0,xe=xe>>>0,!Ne){const mt=Math.pow(2,8*xe)-1;ge(this,B,Q,xe,mt,0)}let Ze=1,ot=0;for(this[Q]=B&255;++ot<xe&&(Ze*=256);)this[Q+ot]=B/Ze&255;return Q+xe},te.prototype.writeUintBE=te.prototype.writeUIntBE=function(B,Q,xe,Ne){if(B=+B,Q=Q>>>0,xe=xe>>>0,!Ne){const mt=Math.pow(2,8*xe)-1;ge(this,B,Q,xe,mt,0)}let Ze=xe-1,ot=1;for(this[Q+Ze]=B&255;--Ze>=0&&(ot*=256);)this[Q+Ze]=B/ot&255;return Q+xe},te.prototype.writeUint8=te.prototype.writeUInt8=function(B,Q,xe){return B=+B,Q=Q>>>0,xe||ge(this,B,Q,1,255,0),this[Q]=B&255,Q+1},te.prototype.writeUint16LE=te.prototype.writeUInt16LE=function(B,Q,xe){return B=+B,Q=Q>>>0,xe||ge(this,B,Q,2,65535,0),this[Q]=B&255,this[Q+1]=B>>>8,Q+2},te.prototype.writeUint16BE=te.prototype.writeUInt16BE=function(B,Q,xe){return B=+B,Q=Q>>>0,xe||ge(this,B,Q,2,65535,0),this[Q]=B>>>8,this[Q+1]=B&255,Q+2},te.prototype.writeUint32LE=te.prototype.writeUInt32LE=function(B,Q,xe){return B=+B,Q=Q>>>0,xe||ge(this,B,Q,4,4294967295,0),this[Q+3]=B>>>24,this[Q+2]=B>>>16,this[Q+1]=B>>>8,this[Q]=B&255,Q+4},te.prototype.writeUint32BE=te.prototype.writeUInt32BE=function(B,Q,xe){return B=+B,Q=Q>>>0,xe||ge(this,B,Q,4,4294967295,0),this[Q]=B>>>24,this[Q+1]=B>>>16,this[Q+2]=B>>>8,this[Q+3]=B&255,Q+4};function le(ie,B,Q,xe,Ne){br(B,xe,Ne,ie,Q,7);let Ze=Number(B&BigInt(4294967295));ie[Q++]=Ze,Ze=Ze>>8,ie[Q++]=Ze,Ze=Ze>>8,ie[Q++]=Ze,Ze=Ze>>8,ie[Q++]=Ze;let ot=Number(B>>BigInt(32)&BigInt(4294967295));return ie[Q++]=ot,ot=ot>>8,ie[Q++]=ot,ot=ot>>8,ie[Q++]=ot,ot=ot>>8,ie[Q++]=ot,Q}function et(ie,B,Q,xe,Ne){br(B,xe,Ne,ie,Q,7);let Ze=Number(B&BigInt(4294967295));ie[Q+7]=Ze,Ze=Ze>>8,ie[Q+6]=Ze,Ze=Ze>>8,ie[Q+5]=Ze,Ze=Ze>>8,ie[Q+4]=Ze;let ot=Number(B>>BigInt(32)&BigInt(4294967295));return ie[Q+3]=ot,ot=ot>>8,ie[Q+2]=ot,ot=ot>>8,ie[Q+1]=ot,ot=ot>>8,ie[Q]=ot,Q+8}te.prototype.writeBigUInt64LE=ee(function(B,Q=0){return le(this,B,Q,BigInt(0),BigInt("0xffffffffffffffff"))}),te.prototype.writeBigUInt64BE=ee(function(B,Q=0){return et(this,B,Q,BigInt(0),BigInt("0xffffffffffffffff"))}),te.prototype.writeIntLE=function(B,Q,xe,Ne){if(B=+B,Q=Q>>>0,!Ne){const Nt=Math.pow(2,8*xe-1);ge(this,B,Q,xe,Nt-1,-Nt)}let Ze=0,ot=1,mt=0;for(this[Q]=B&255;++Ze<xe&&(ot*=256);)B<0&&mt===0&&this[Q+Ze-1]!==0&&(mt=1),this[Q+Ze]=(B/ot>>0)-mt&255;return Q+xe},te.prototype.writeIntBE=function(B,Q,xe,Ne){if(B=+B,Q=Q>>>0,!Ne){const Nt=Math.pow(2,8*xe-1);ge(this,B,Q,xe,Nt-1,-Nt)}let Ze=xe-1,ot=1,mt=0;for(this[Q+Ze]=B&255;--Ze>=0&&(ot*=256);)B<0&&mt===0&&this[Q+Ze+1]!==0&&(mt=1),this[Q+Ze]=(B/ot>>0)-mt&255;return Q+xe},te.prototype.writeInt8=function(B,Q,xe){return B=+B,Q=Q>>>0,xe||ge(this,B,Q,1,127,-128),B<0&&(B=255+B+1),this[Q]=B&255,Q+1},te.prototype.writeInt16LE=function(B,Q,xe){return B=+B,Q=Q>>>0,xe||ge(this,B,Q,2,32767,-32768),this[Q]=B&255,this[Q+1]=B>>>8,Q+2},te.prototype.writeInt16BE=function(B,Q,xe){return B=+B,Q=Q>>>0,xe||ge(this,B,Q,2,32767,-32768),this[Q]=B>>>8,this[Q+1]=B&255,Q+2},te.prototype.writeInt32LE=function(B,Q,xe){return B=+B,Q=Q>>>0,xe||ge(this,B,Q,4,2147483647,-2147483648),this[Q]=B&255,this[Q+1]=B>>>8,this[Q+2]=B>>>16,this[Q+3]=B>>>24,Q+4},te.prototype.writeInt32BE=function(B,Q,xe){return B=+B,Q=Q>>>0,xe||ge(this,B,Q,4,2147483647,-2147483648),B<0&&(B=4294967295+B+1),this[Q]=B>>>24,this[Q+1]=B>>>16,this[Q+2]=B>>>8,this[Q+3]=B&255,Q+4},te.prototype.writeBigInt64LE=ee(function(B,Q=0){return le(this,B,Q,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),te.prototype.writeBigInt64BE=ee(function(B,Q=0){return et(this,B,Q,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function wt(ie,B,Q,xe,Ne,Ze){if(Q+xe>ie.length)throw new RangeError("Index out of range");if(Q<0)throw new RangeError("Index out of range")}function Ft(ie,B,Q,xe,Ne){return B=+B,Q=Q>>>0,Ne||wt(ie,B,Q,4),O.write(ie,B,Q,xe,23,4),Q+4}te.prototype.writeFloatLE=function(B,Q,xe){return Ft(this,B,Q,!0,xe)},te.prototype.writeFloatBE=function(B,Q,xe){return Ft(this,B,Q,!1,xe)};function Wt(ie,B,Q,xe,Ne){return B=+B,Q=Q>>>0,Ne||wt(ie,B,Q,8),O.write(ie,B,Q,xe,52,8),Q+8}te.prototype.writeDoubleLE=function(B,Q,xe){return Wt(this,B,Q,!0,xe)},te.prototype.writeDoubleBE=function(B,Q,xe){return Wt(this,B,Q,!1,xe)},te.prototype.copy=function(B,Q,xe,Ne){if(!te.isBuffer(B))throw new TypeError("argument should be a Buffer");if(xe||(xe=0),!Ne&&Ne!==0&&(Ne=this.length),Q>=B.length&&(Q=B.length),Q||(Q=0),Ne>0&&Ne<xe&&(Ne=xe),Ne===xe||B.length===0||this.length===0)return 0;if(Q<0)throw new RangeError("targetStart out of bounds");if(xe<0||xe>=this.length)throw new RangeError("Index out of range");if(Ne<0)throw new RangeError("sourceEnd out of bounds");Ne>this.length&&(Ne=this.length),B.length-Q<Ne-xe&&(Ne=B.length-Q+xe);const Ze=Ne-xe;return this===B&&typeof Z.prototype.copyWithin=="function"?this.copyWithin(Q,xe,Ne):Z.prototype.set.call(B,this.subarray(xe,Ne),Q),Ze},te.prototype.fill=function(B,Q,xe,Ne){if(typeof B=="string"){if(typeof Q=="string"?(Ne=Q,Q=0,xe=this.length):typeof xe=="string"&&(Ne=xe,xe=this.length),Ne!==void 0&&typeof Ne!="string")throw new TypeError("encoding must be a string");if(typeof Ne=="string"&&!te.isEncoding(Ne))throw new TypeError("Unknown encoding: "+Ne);if(B.length===1){const ot=B.charCodeAt(0);(Ne==="utf8"&&ot<128||Ne==="latin1")&&(B=ot)}}else typeof B=="number"?B=B&255:typeof B=="boolean"&&(B=Number(B));if(Q<0||this.length<Q||this.length<xe)throw new RangeError("Out of range index");if(xe<=Q)return this;Q=Q>>>0,xe=xe===void 0?this.length:xe>>>0,B||(B=0);let Ze;if(typeof B=="number")for(Ze=Q;Ze<xe;++Ze)this[Ze]=B;else{const ot=te.isBuffer(B)?B:te.from(B,Ne),mt=ot.length;if(mt===0)throw new TypeError('The value "'+B+'" is invalid for argument "value"');for(Ze=0;Ze<xe-Q;++Ze)this[Ze+Q]=ot[Ze%mt]}return this};const or={};function Or(ie,B,Q){or[ie]=class extends Q{constructor(){super(),Object.defineProperty(this,"message",{value:B.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${ie}]`,this.stack,delete this.name}get code(){return ie}set code(Ne){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:Ne,writable:!0})}toString(){return`${this.name} [${ie}]: ${this.message}`}}}Or("ERR_BUFFER_OUT_OF_BOUNDS",function(ie){return ie?`${ie} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Or("ERR_INVALID_ARG_TYPE",function(ie,B){return`The "${ie}" argument must be of type number. Received type ${typeof B}`},TypeError),Or("ERR_OUT_OF_RANGE",function(ie,B,Q){let xe=`The value of "${ie}" is out of range.`,Ne=Q;return Number.isInteger(Q)&&Math.abs(Q)>2**32?Ne=xr(String(Q)):typeof Q=="bigint"&&(Ne=String(Q),(Q>BigInt(2)**BigInt(32)||Q<-(BigInt(2)**BigInt(32)))&&(Ne=xr(Ne)),Ne+="n"),xe+=` It must be ${B}. Received ${Ne}`,xe},RangeError);function xr(ie){let B="",Q=ie.length;const xe=ie[0]==="-"?1:0;for(;Q>=xe+4;Q-=3)B=`_${ie.slice(Q-3,Q)}${B}`;return`${ie.slice(0,Q)}${B}`}function Tr(ie,B,Q){fr(B,"offset"),(ie[B]===void 0||ie[B+Q]===void 0)&&Vr(B,ie.length-(Q+1))}function br(ie,B,Q,xe,Ne,Ze){if(ie>Q||ie<B){const ot=typeof B=="bigint"?"n":"";let mt;throw B===0||B===BigInt(0)?mt=`>= 0${ot} and < 2${ot} ** ${(Ze+1)*8}${ot}`:mt=`>= -(2${ot} ** ${(Ze+1)*8-1}${ot}) and < 2 ** ${(Ze+1)*8-1}${ot}`,new or.ERR_OUT_OF_RANGE("value",mt,ie)}Tr(xe,Ne,Ze)}function fr(ie,B){if(typeof ie!="number")throw new or.ERR_INVALID_ARG_TYPE(B,"number",ie)}function Vr(ie,B,Q){throw Math.floor(ie)!==ie?(fr(ie,Q),new or.ERR_OUT_OF_RANGE("offset","an integer",ie)):B<0?new or.ERR_BUFFER_OUT_OF_BOUNDS:new or.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${B}`,ie)}const Ir=/[^+/0-9A-Za-z-_]/g;function De(ie){if(ie=ie.split("=")[0],ie=ie.trim().replace(Ir,""),ie.length<2)return"";for(;ie.length%4!==0;)ie=ie+"=";return ie}function St(ie,B){B=B||1/0;let Q;const xe=ie.length;let Ne=null;const Ze=[];for(let ot=0;ot<xe;++ot){if(Q=ie.charCodeAt(ot),Q>55295&&Q<57344){if(!Ne){if(Q>56319){(B-=3)>-1&&Ze.push(239,191,189);continue}else if(ot+1===xe){(B-=3)>-1&&Ze.push(239,191,189);continue}Ne=Q;continue}if(Q<56320){(B-=3)>-1&&Ze.push(239,191,189),Ne=Q;continue}Q=(Ne-55296<<10|Q-56320)+65536}else Ne&&(B-=3)>-1&&Ze.push(239,191,189);if(Ne=null,Q<128){if((B-=1)<0)break;Ze.push(Q)}else if(Q<2048){if((B-=2)<0)break;Ze.push(Q>>6|192,Q&63|128)}else if(Q<65536){if((B-=3)<0)break;Ze.push(Q>>12|224,Q>>6&63|128,Q&63|128)}else if(Q<1114112){if((B-=4)<0)break;Ze.push(Q>>18|240,Q>>12&63|128,Q>>6&63|128,Q&63|128)}else throw new Error("Invalid code point")}return Ze}function Ut(ie){const B=[];for(let Q=0;Q<ie.length;++Q)B.push(ie.charCodeAt(Q)&255);return B}function ir(ie,B){let Q,xe,Ne;const Ze=[];for(let ot=0;ot<ie.length&&!((B-=2)<0);++ot)Q=ie.charCodeAt(ot),xe=Q>>8,Ne=Q%256,Ze.push(Ne),Ze.push(xe);return Ze}function Rt(ie){return x.toByteArray(De(ie))}function $t(ie,B,Q,xe){let Ne;for(Ne=0;Ne<xe&&!(Ne+Q>=B.length||Ne>=ie.length);++Ne)B[Ne+Q]=ie[Ne];return Ne}function rt(ie,B){return ie instanceof B||ie!=null&&ie.constructor!=null&&ie.constructor.name!=null&&ie.constructor.name===B.name}function sr(ie){return ie!==ie}const Fr=function(){const ie="0123456789abcdef",B=new Array(256);for(let Q=0;Q<16;++Q){const xe=Q*16;for(let Ne=0;Ne<16;++Ne)B[xe+Ne]=ie[Q]+ie[Ne]}return B}();function ee(ie){return typeof BigInt>"u"?Qe:ie}function Qe(){throw new Error("BigInt not supported")}})(h);const A=h.Buffer;a.Blob=h.Blob,a.BlobOptions=h.BlobOptions,a.Buffer=h.Buffer,a.File=h.File,a.FileOptions=h.FileOptions,a.INSPECT_MAX_BYTES=h.INSPECT_MAX_BYTES,a.SlowBuffer=h.SlowBuffer,a.TranscodeEncoding=h.TranscodeEncoding,a.atob=h.atob,a.btoa=h.btoa,a.constants=h.constants,a.default=A,a.isAscii=h.isAscii,a.isUtf8=h.isUtf8,a.kMaxLength=h.kMaxLength,a.kStringMaxLength=h.kStringMaxLength,a.resolveObjectURL=h.resolveObjectURL,a.transcode=h.transcode}(Kg)),Kg}var U5=Bf();const Jg=Fy(U5);var Qg={},Bp={exports:{}},Uw;function rm(){if(Uw)return Bp.exports;Uw=1;var a=typeof Reflect=="object"?Reflect:null,h=a&&typeof a.apply=="function"?a.apply:function(U,G,Z){return Function.prototype.apply.call(U,G,Z)},v;a&&typeof a.ownKeys=="function"?v=a.ownKeys:Object.getOwnPropertySymbols?v=function(U){return Object.getOwnPropertyNames(U).concat(Object.getOwnPropertySymbols(U))}:v=function(U){return Object.getOwnPropertyNames(U)};function _(O){console&&console.warn&&console.warn(O)}var k=Number.isNaN||function(U){return U!==U};function b(){b.init.call(this)}Bp.exports=b,Bp.exports.once=A,b.EventEmitter=b,b.prototype._events=void 0,b.prototype._eventsCount=0,b.prototype._maxListeners=void 0;var T=10;function t(O){if(typeof O!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof O)}Object.defineProperty(b,"defaultMaxListeners",{enumerable:!0,get:function(){return T},set:function(O){if(typeof O!="number"||O<0||k(O))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+O+".");T=O}}),b.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},b.prototype.setMaxListeners=function(U){if(typeof U!="number"||U<0||k(U))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+U+".");return this._maxListeners=U,this};function S(O){return O._maxListeners===void 0?b.defaultMaxListeners:O._maxListeners}b.prototype.getMaxListeners=function(){return S(this)},b.prototype.emit=function(U){for(var G=[],Z=1;Z<arguments.length;Z++)G.push(arguments[Z]);var X=U==="error",W=this._events;if(W!==void 0)X=X&&W.error===void 0;else if(!X)return!1;if(X){var J;if(G.length>0&&(J=G[0]),J instanceof Error)throw J;var re=new Error("Unhandled error."+(J?" ("+J.message+")":""));throw re.context=J,re}var te=W[U];if(te===void 0)return!1;if(typeof te=="function")h(te,this,G);else for(var ye=te.length,ue=p(te,ye),Z=0;Z<ye;++Z)h(ue[Z],this,G);return!0};function D(O,U,G,Z){var X,W,J;if(t(G),W=O._events,W===void 0?(W=O._events=Object.create(null),O._eventsCount=0):(W.newListener!==void 0&&(O.emit("newListener",U,G.listener?G.listener:G),W=O._events),J=W[U]),J===void 0)J=W[U]=G,++O._eventsCount;else if(typeof J=="function"?J=W[U]=Z?[G,J]:[J,G]:Z?J.unshift(G):J.push(G),X=S(O),X>0&&J.length>X&&!J.warned){J.warned=!0;var re=new Error("Possible EventEmitter memory leak detected. "+J.length+" "+String(U)+" listeners added. Use emitter.setMaxListeners() to increase limit");re.name="MaxListenersExceededWarning",re.emitter=O,re.type=U,re.count=J.length,_(re)}return O}b.prototype.addListener=function(U,G){return D(this,U,G,!1)},b.prototype.on=b.prototype.addListener,b.prototype.prependListener=function(U,G){return D(this,U,G,!0)};function w(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function E(O,U,G){var Z={fired:!1,wrapFn:void 0,target:O,type:U,listener:G},X=w.bind(Z);return X.listener=G,Z.wrapFn=X,X}b.prototype.once=function(U,G){return t(G),this.on(U,E(this,U,G)),this},b.prototype.prependOnceListener=function(U,G){return t(G),this.prependListener(U,E(this,U,G)),this},b.prototype.removeListener=function(U,G){var Z,X,W,J,re;if(t(G),X=this._events,X===void 0)return this;if(Z=X[U],Z===void 0)return this;if(Z===G||Z.listener===G)--this._eventsCount===0?this._events=Object.create(null):(delete X[U],X.removeListener&&this.emit("removeListener",U,Z.listener||G));else if(typeof Z!="function"){for(W=-1,J=Z.length-1;J>=0;J--)if(Z[J]===G||Z[J].listener===G){re=Z[J].listener,W=J;break}if(W<0)return this;W===0?Z.shift():C(Z,W),Z.length===1&&(X[U]=Z[0]),X.removeListener!==void 0&&this.emit("removeListener",U,re||G)}return this},b.prototype.off=b.prototype.removeListener,b.prototype.removeAllListeners=function(U){var G,Z,X;if(Z=this._events,Z===void 0)return this;if(Z.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):Z[U]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete Z[U]),this;if(arguments.length===0){var W=Object.keys(Z),J;for(X=0;X<W.length;++X)J=W[X],J!=="removeListener"&&this.removeAllListeners(J);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(G=Z[U],typeof G=="function")this.removeListener(U,G);else if(G!==void 0)for(X=G.length-1;X>=0;X--)this.removeListener(U,G[X]);return this};function m(O,U,G){var Z=O._events;if(Z===void 0)return[];var X=Z[U];return X===void 0?[]:typeof X=="function"?G?[X.listener||X]:[X]:G?z(X):p(X,X.length)}b.prototype.listeners=function(U){return m(this,U,!0)},b.prototype.rawListeners=function(U){return m(this,U,!1)},b.listenerCount=function(O,U){return typeof O.listenerCount=="function"?O.listenerCount(U):y.call(O,U)},b.prototype.listenerCount=y;function y(O){var U=this._events;if(U!==void 0){var G=U[O];if(typeof G=="function")return 1;if(G!==void 0)return G.length}return 0}b.prototype.eventNames=function(){return this._eventsCount>0?v(this._events):[]};function p(O,U){for(var G=new Array(U),Z=0;Z<U;++Z)G[Z]=O[Z];return G}function C(O,U){for(;U+1<O.length;U++)O[U]=O[U+1];O.pop()}function z(O){for(var U=new Array(O.length),G=0;G<U.length;++G)U[G]=O[G].listener||O[G];return U}function A(O,U){return new Promise(function(G,Z){function X(J){O.removeListener(U,W),Z(J)}function W(){typeof O.removeListener=="function"&&O.removeListener("error",X),G([].slice.call(arguments))}x(O,U,W,{once:!0}),U!=="error"&&P(O,X,{once:!0})})}function P(O,U,G){typeof O.on=="function"&&x(O,"error",U,G)}function x(O,U,G,Z){if(typeof O.on=="function")Z.once?O.once(U,G):O.on(U,G);else if(typeof O.addEventListener=="function")O.addEventListener(U,function X(W){Z.once&&O.removeEventListener(U,X),G(W)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof O)}return Bp.exports}var Fp={exports:{}},jw;function uu(){return jw||(jw=1,typeof Object.create=="function"?Fp.exports=function(h,v){v&&(h.super_=v,h.prototype=Object.create(v.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}))}:Fp.exports=function(h,v){if(v){h.super_=v;var _=function(){};_.prototype=v.prototype,h.prototype=new _,h.prototype.constructor=h}}),Fp.exports}var e0,Vw;function hT(){return Vw||(Vw=1,e0=rm().EventEmitter),e0}var t0={},r0={},i0,Gw;function fT(){return Gw||(Gw=1,i0=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var h={},v=Symbol("test"),_=Object(v);if(typeof v=="string"||Object.prototype.toString.call(v)!=="[object Symbol]"||Object.prototype.toString.call(_)!=="[object Symbol]")return!1;var k=42;h[v]=k;for(var b in h)return!1;if(typeof Object.keys=="function"&&Object.keys(h).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(h).length!==0)return!1;var T=Object.getOwnPropertySymbols(h);if(T.length!==1||T[0]!==v||!Object.prototype.propertyIsEnumerable.call(h,v))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var t=Object.getOwnPropertyDescriptor(h,v);if(t.value!==k||t.enumerable!==!0)return!1}return!0}),i0}var n0,Hw;function im(){if(Hw)return n0;Hw=1;var a=fT();return n0=function(){return a()&&!!Symbol.toStringTag},n0}var a0,qw;function dT(){return qw||(qw=1,a0=Object),a0}var o0,Ww;function j5(){return Ww||(Ww=1,o0=Error),o0}var s0,$w;function V5(){return $w||($w=1,s0=EvalError),s0}var l0,Zw;function G5(){return Zw||(Zw=1,l0=RangeError),l0}var u0,Xw;function H5(){return Xw||(Xw=1,u0=ReferenceError),u0}var c0,Yw;function pT(){return Yw||(Yw=1,c0=SyntaxError),c0}var h0,Kw;function Ff(){return Kw||(Kw=1,h0=TypeError),h0}var f0,Jw;function q5(){return Jw||(Jw=1,f0=URIError),f0}var d0,Qw;function W5(){return Qw||(Qw=1,d0=Math.abs),d0}var p0,e2;function $5(){return e2||(e2=1,p0=Math.floor),p0}var m0,t2;function Z5(){return t2||(t2=1,m0=Math.max),m0}var _0,r2;function X5(){return r2||(r2=1,_0=Math.min),_0}var g0,i2;function Y5(){return i2||(i2=1,g0=Math.pow),g0}var y0,n2;function K5(){return n2||(n2=1,y0=Math.round),y0}var v0,a2;function J5(){return a2||(a2=1,v0=Number.isNaN||function(h){return h!==h}),v0}var b0,o2;function Q5(){if(o2)return b0;o2=1;var a=J5();return b0=function(v){return a(v)||v===0?v:v<0?-1:1},b0}var x0,s2;function eP(){return s2||(s2=1,x0=Object.getOwnPropertyDescriptor),x0}var w0,l2;function Fc(){if(l2)return w0;l2=1;var a=eP();if(a)try{a([],"length")}catch{a=null}return w0=a,w0}var E0,u2;function nm(){if(u2)return E0;u2=1;var a=Object.defineProperty||!1;if(a)try{a({},"a",{value:1})}catch{a=!1}return E0=a,E0}var T0,c2;function tP(){if(c2)return T0;c2=1;var a=typeof Symbol<"u"&&Symbol,h=fT();return T0=function(){return typeof a!="function"||typeof Symbol!="function"||typeof a("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:h()},T0}var S0,h2;function mT(){return h2||(h2=1,S0=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),S0}var M0,f2;function _T(){if(f2)return M0;f2=1;var a=dT();return M0=a.getPrototypeOf||null,M0}var A0,d2;function rP(){if(d2)return A0;d2=1;var a="Function.prototype.bind called on incompatible ",h=Object.prototype.toString,v=Math.max,_="[object Function]",k=function(S,D){for(var w=[],E=0;E<S.length;E+=1)w[E]=S[E];for(var m=0;m<D.length;m+=1)w[m+S.length]=D[m];return w},b=function(S,D){for(var w=[],E=D,m=0;E<S.length;E+=1,m+=1)w[m]=S[E];return w},T=function(t,S){for(var D="",w=0;w<t.length;w+=1)D+=t[w],w+1<t.length&&(D+=S);return D};return A0=function(S){var D=this;if(typeof D!="function"||h.apply(D)!==_)throw new TypeError(a+D);for(var w=b(arguments,1),E,m=function(){if(this instanceof E){var A=D.apply(this,k(w,arguments));return Object(A)===A?A:this}return D.apply(S,k(w,arguments))},y=v(0,D.length-w.length),p=[],C=0;C<y;C++)p[C]="$"+C;if(E=Function("binder","return function ("+T(p,",")+"){ return binder.apply(this,arguments); }")(m),D.prototype){var z=function(){};z.prototype=D.prototype,E.prototype=new z,z.prototype=null}return E},A0}var I0,p2;function Nf(){if(p2)return I0;p2=1;var a=rP();return I0=Function.prototype.bind||a,I0}var P0,m2;function d1(){return m2||(m2=1,P0=Function.prototype.call),P0}var C0,_2;function p1(){return _2||(_2=1,C0=Function.prototype.apply),C0}var R0,g2;function iP(){return g2||(g2=1,R0=typeof Reflect<"u"&&Reflect&&Reflect.apply),R0}var D0,y2;function gT(){if(y2)return D0;y2=1;var a=Nf(),h=p1(),v=d1(),_=iP();return D0=_||a.call(v,h),D0}var L0,v2;function m1(){if(v2)return L0;v2=1;var a=Nf(),h=Ff(),v=d1(),_=gT();return L0=function(b){if(b.length<1||typeof b[0]!="function")throw new h("a function is required");return _(a,v,b)},L0}var O0,b2;function nP(){if(b2)return O0;b2=1;var a=m1(),h=Fc(),v;try{v=[].__proto__===Array.prototype}catch(T){if(!T||typeof T!="object"||!("code"in T)||T.code!=="ERR_PROTO_ACCESS")throw T}var _=!!v&&h&&h(Object.prototype,"__proto__"),k=Object,b=k.getPrototypeOf;return O0=_&&typeof _.get=="function"?a([_.get]):typeof b=="function"?function(t){return b(t==null?t:k(t))}:!1,O0}var z0,x2;function yT(){if(x2)return z0;x2=1;var a=mT(),h=_T(),v=nP();return z0=a?function(k){return a(k)}:h?function(k){if(!k||typeof k!="object"&&typeof k!="function")throw new TypeError("getProto: not an object");return h(k)}:v?function(k){return v(k)}:null,z0}var k0,w2;function vT(){if(w2)return k0;w2=1;var a=Function.prototype.call,h=Object.prototype.hasOwnProperty,v=Nf();return k0=v.call(a,h),k0}var B0,E2;function bT(){if(E2)return B0;E2=1;var a,h=dT(),v=j5(),_=V5(),k=G5(),b=H5(),T=pT(),t=Ff(),S=q5(),D=W5(),w=$5(),E=Z5(),m=X5(),y=Y5(),p=K5(),C=Q5(),z=Function,A=function(Ke){try{return z('"use strict"; return ('+Ke+").constructor;")()}catch{}},P=Fc(),x=nm(),O=function(){throw new t},U=P?function(){try{return arguments.callee,O}catch{try{return P(arguments,"callee").get}catch{return O}}}():O,G=tP()(),Z=yT(),X=_T(),W=mT(),J=p1(),re=d1(),te={},ye=typeof Uint8Array>"u"||!Z?a:Z(Uint8Array),ue={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?a:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?a:ArrayBuffer,"%ArrayIteratorPrototype%":G&&Z?Z([][Symbol.iterator]()):a,"%AsyncFromSyncIteratorPrototype%":a,"%AsyncFunction%":te,"%AsyncGenerator%":te,"%AsyncGeneratorFunction%":te,"%AsyncIteratorPrototype%":te,"%Atomics%":typeof Atomics>"u"?a:Atomics,"%BigInt%":typeof BigInt>"u"?a:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?a:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?a:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?a:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":v,"%eval%":eval,"%EvalError%":_,"%Float32Array%":typeof Float32Array>"u"?a:Float32Array,"%Float64Array%":typeof Float64Array>"u"?a:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?a:FinalizationRegistry,"%Function%":z,"%GeneratorFunction%":te,"%Int8Array%":typeof Int8Array>"u"?a:Int8Array,"%Int16Array%":typeof Int16Array>"u"?a:Int16Array,"%Int32Array%":typeof Int32Array>"u"?a:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":G&&Z?Z(Z([][Symbol.iterator]())):a,"%JSON%":typeof JSON=="object"?JSON:a,"%Map%":typeof Map>"u"?a:Map,"%MapIteratorPrototype%":typeof Map>"u"||!G||!Z?a:Z(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":h,"%Object.getOwnPropertyDescriptor%":P,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?a:Promise,"%Proxy%":typeof Proxy>"u"?a:Proxy,"%RangeError%":k,"%ReferenceError%":b,"%Reflect%":typeof Reflect>"u"?a:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?a:Set,"%SetIteratorPrototype%":typeof Set>"u"||!G||!Z?a:Z(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?a:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":G&&Z?Z(""[Symbol.iterator]()):a,"%Symbol%":G?Symbol:a,"%SyntaxError%":T,"%ThrowTypeError%":U,"%TypedArray%":ye,"%TypeError%":t,"%Uint8Array%":typeof Uint8Array>"u"?a:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?a:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?a:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?a:Uint32Array,"%URIError%":S,"%WeakMap%":typeof WeakMap>"u"?a:WeakMap,"%WeakRef%":typeof WeakRef>"u"?a:WeakRef,"%WeakSet%":typeof WeakSet>"u"?a:WeakSet,"%Function.prototype.call%":re,"%Function.prototype.apply%":J,"%Object.defineProperty%":x,"%Object.getPrototypeOf%":X,"%Math.abs%":D,"%Math.floor%":w,"%Math.max%":E,"%Math.min%":m,"%Math.pow%":y,"%Math.round%":p,"%Math.sign%":C,"%Reflect.getPrototypeOf%":W};if(Z)try{null.error}catch(Ke){var Se=Z(Z(Ke));ue["%Error.prototype%"]=Se}var Le=function Ke(_e){var ke;if(_e==="%AsyncFunction%")ke=A("async function () {}");else if(_e==="%GeneratorFunction%")ke=A("function* () {}");else if(_e==="%AsyncGeneratorFunction%")ke=A("async function* () {}");else if(_e==="%AsyncGenerator%"){var qe=Ke("%AsyncGeneratorFunction%");qe&&(ke=qe.prototype)}else if(_e==="%AsyncIteratorPrototype%"){var tt=Ke("%AsyncGenerator%");tt&&Z&&(ke=Z(tt.prototype))}return ue[_e]=ke,ke},Pe={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Ee=Nf(),Me=vT(),He=Ee.call(re,Array.prototype.concat),nt=Ee.call(J,Array.prototype.splice),ht=Ee.call(re,String.prototype.replace),Fe=Ee.call(re,String.prototype.slice),Ce=Ee.call(re,RegExp.prototype.exec),Be=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Ae=/\\(\\)?/g,se=function(_e){var ke=Fe(_e,0,1),qe=Fe(_e,-1);if(ke==="%"&&qe!=="%")throw new T("invalid intrinsic syntax, expected closing `%`");if(qe==="%"&&ke!=="%")throw new T("invalid intrinsic syntax, expected opening `%`");var tt=[];return ht(_e,Be,function(Ge,We,Je,it){tt[tt.length]=Je?ht(it,Ae,"$1"):We||Ge}),tt},pe=function(_e,ke){var qe=_e,tt;if(Me(Pe,qe)&&(tt=Pe[qe],qe="%"+tt[0]+"%"),Me(ue,qe)){var Ge=ue[qe];if(Ge===te&&(Ge=Le(qe)),typeof Ge>"u"&&!ke)throw new t("intrinsic "+_e+" exists, but is not available. Please file an issue!");return{alias:tt,name:qe,value:Ge}}throw new T("intrinsic "+_e+" does not exist!")};return B0=function(_e,ke){if(typeof _e!="string"||_e.length===0)throw new t("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof ke!="boolean")throw new t('"allowMissing" argument must be a boolean');if(Ce(/^%?[^%]*%?$/,_e)===null)throw new T("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var qe=se(_e),tt=qe.length>0?qe[0]:"",Ge=pe("%"+tt+"%",ke),We=Ge.name,Je=Ge.value,it=!1,ze=Ge.alias;ze&&(tt=ze[0],nt(qe,He([0,1],ze)));for(var de=1,ve=!0;de<qe.length;de+=1){var be=qe[de],Oe=Fe(be,0,1),ge=Fe(be,-1);if((Oe==='"'||Oe==="'"||Oe==="`"||ge==='"'||ge==="'"||ge==="`")&&Oe!==ge)throw new T("property names with quotes must have matching quotes");if((be==="constructor"||!ve)&&(it=!0),tt+="."+be,We="%"+tt+"%",Me(ue,We))Je=ue[We];else if(Je!=null){if(!(be in Je)){if(!ke)throw new t("base intrinsic for "+_e+" exists, but the property is not available.");return}if(P&&de+1>=qe.length){var le=P(Je,be);ve=!!le,ve&&"get"in le&&!("originalValue"in le.get)?Je=le.get:Je=Je[be]}else ve=Me(Je,be),Je=Je[be];ve&&!it&&(ue[We]=Je)}}return Je},B0}var F0,T2;function Uf(){if(T2)return F0;T2=1;var a=bT(),h=m1(),v=h([a("%String.prototype.indexOf%")]);return F0=function(k,b){var T=a(k,!!b);return typeof T=="function"&&v(k,".prototype.")>-1?h([T]):T},F0}var N0,S2;function aP(){if(S2)return N0;S2=1;var a=im()(),h=Uf(),v=h("Object.prototype.toString"),_=function(t){return a&&t&&typeof t=="object"&&Symbol.toStringTag in t?!1:v(t)==="[object Arguments]"},k=function(t){return _(t)?!0:t!==null&&typeof t=="object"&&"length"in t&&typeof t.length=="number"&&t.length>=0&&v(t)!=="[object Array]"&&"callee"in t&&v(t.callee)==="[object Function]"},b=function(){return _(arguments)}();return _.isLegacyArguments=k,N0=b?_:k,N0}var U0,M2;function oP(){if(M2)return U0;M2=1;var a=Uf(),h=im()(),v=vT(),_=Fc(),k;if(h){var b=a("RegExp.prototype.exec"),T={},t=function(){throw T},S={toString:t,valueOf:t};typeof Symbol.toPrimitive=="symbol"&&(S[Symbol.toPrimitive]=t),k=function(m){if(!m||typeof m!="object")return!1;var y=_(m,"lastIndex"),p=y&&v(y,"value");if(!p)return!1;try{b(m,S)}catch(C){return C===T}}}else{var D=a("Object.prototype.toString"),w="[object RegExp]";k=function(m){return!m||typeof m!="object"&&typeof m!="function"?!1:D(m)===w}}return U0=k,U0}var j0,A2;function sP(){if(A2)return j0;A2=1;var a=Uf(),h=oP(),v=a("RegExp.prototype.exec"),_=Ff();return j0=function(b){if(!h(b))throw new _("`regex` must be a RegExp");return function(t){return v(b,t)!==null}},j0}var V0,I2;function lP(){if(I2)return V0;I2=1;var a=Uf(),h=sP(),v=h(/^\s*(?:function)?\*/),_=im()(),k=yT(),b=a("Object.prototype.toString"),T=a("Function.prototype.toString"),t=function(){if(!_)return!1;try{return Function("return function*() {}")()}catch{}},S;return V0=function(w){if(typeof w!="function")return!1;if(v(T(w)))return!0;if(!_){var E=b(w);return E==="[object GeneratorFunction]"}if(!k)return!1;if(typeof S>"u"){var m=t();S=m?k(m):!1}return k(w)===S},V0}var G0,P2;function uP(){if(P2)return G0;P2=1;var a=Function.prototype.toString,h=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,v,_;if(typeof h=="function"&&typeof Object.defineProperty=="function")try{v=Object.defineProperty({},"length",{get:function(){throw _}}),_={},h(function(){throw 42},null,v)}catch(P){P!==_&&(h=null)}else h=null;var k=/^\s*class\b/,b=function(x){try{var O=a.call(x);return k.test(O)}catch{return!1}},T=function(x){try{return b(x)?!1:(a.call(x),!0)}catch{return!1}},t=Object.prototype.toString,S="[object Object]",D="[object Function]",w="[object GeneratorFunction]",E="[object HTMLAllCollection]",m="[object HTML document.all class]",y="[object HTMLCollection]",p=typeof Symbol=="function"&&!!Symbol.toStringTag,C=!(0 in[,]),z=function(){return!1};if(typeof document=="object"){var A=document.all;t.call(A)===t.call(document.all)&&(z=function(x){if((C||!x)&&(typeof x>"u"||typeof x=="object"))try{var O=t.call(x);return(O===E||O===m||O===y||O===S)&&x("")==null}catch{}return!1})}return G0=h?function(x){if(z(x))return!0;if(!x||typeof x!="function"&&typeof x!="object")return!1;try{h(x,null,v)}catch(O){if(O!==_)return!1}return!b(x)&&T(x)}:function(x){if(z(x))return!0;if(!x||typeof x!="function"&&typeof x!="object")return!1;if(p)return T(x);if(b(x))return!1;var O=t.call(x);return O!==D&&O!==w&&!/^\[object HTML/.test(O)?!1:T(x)},G0}var H0,C2;function cP(){if(C2)return H0;C2=1;var a=uP(),h=Object.prototype.toString,v=Object.prototype.hasOwnProperty,_=function(S,D,w){for(var E=0,m=S.length;E<m;E++)v.call(S,E)&&(w==null?D(S[E],E,S):D.call(w,S[E],E,S))},k=function(S,D,w){for(var E=0,m=S.length;E<m;E++)w==null?D(S.charAt(E),E,S):D.call(w,S.charAt(E),E,S)},b=function(S,D,w){for(var E in S)v.call(S,E)&&(w==null?D(S[E],E,S):D.call(w,S[E],E,S))},T=function(S,D,w){if(!a(D))throw new TypeError("iterator must be a function");var E;arguments.length>=3&&(E=w),h.call(S)==="[object Array]"?_(S,D,E):typeof S=="string"?k(S,D,E):b(S,D,E)};return H0=T,H0}var q0,R2;function hP(){return R2||(R2=1,q0=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]),q0}var W0,D2;function fP(){if(D2)return W0;D2=1;var a=hP(),h=typeof globalThis>"u"?Hr:globalThis;return W0=function(){for(var _=[],k=0;k<a.length;k++)typeof h[a[k]]=="function"&&(_[_.length]=a[k]);return _},W0}var $0={exports:{}},Z0,L2;function dP(){if(L2)return Z0;L2=1;var a=nm(),h=pT(),v=Ff(),_=Fc();return Z0=function(b,T,t){if(!b||typeof b!="object"&&typeof b!="function")throw new v("`obj` must be an object or a function`");if(typeof T!="string"&&typeof T!="symbol")throw new v("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new v("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new v("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new v("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new v("`loose`, if provided, must be a boolean");var S=arguments.length>3?arguments[3]:null,D=arguments.length>4?arguments[4]:null,w=arguments.length>5?arguments[5]:null,E=arguments.length>6?arguments[6]:!1,m=!!_&&_(b,T);if(a)a(b,T,{configurable:w===null&&m?m.configurable:!w,enumerable:S===null&&m?m.enumerable:!S,value:t,writable:D===null&&m?m.writable:!D});else if(E||!S&&!D&&!w)b[T]=t;else throw new h("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Z0}var X0,O2;function pP(){if(O2)return X0;O2=1;var a=nm(),h=function(){return!!a};return h.hasArrayLengthDefineBug=function(){if(!a)return null;try{return a([],"length",{value:1}).length!==1}catch{return!0}},X0=h,X0}var Y0,z2;function mP(){if(z2)return Y0;z2=1;var a=bT(),h=dP(),v=pP()(),_=Fc(),k=Ff(),b=a("%Math.floor%");return Y0=function(t,S){if(typeof t!="function")throw new k("`fn` is not a function");if(typeof S!="number"||S<0||S>4294967295||b(S)!==S)throw new k("`length` must be a positive 32-bit integer");var D=arguments.length>2&&!!arguments[2],w=!0,E=!0;if("length"in t&&_){var m=_(t,"length");m&&!m.configurable&&(w=!1),m&&!m.writable&&(E=!1)}return(w||E||!D)&&(v?h(t,"length",S,!0,!0):h(t,"length",S)),t},Y0}var K0,k2;function _P(){if(k2)return K0;k2=1;var a=Nf(),h=p1(),v=gT();return K0=function(){return v(a,h,arguments)},K0}var B2;function gP(){return B2||(B2=1,function(a){var h=mP(),v=nm(),_=m1(),k=_P();a.exports=function(T){var t=_(arguments),S=T.length-(arguments.length-1);return h(t,1+(S>0?S:0),!0)},v?v(a.exports,"apply",{value:k}):a.exports.apply=k}($0)),$0.exports}var J0,F2;function xT(){if(F2)return J0;F2=1;var a=cP(),h=fP(),v=gP(),_=Uf(),k=Fc(),b=_("Object.prototype.toString"),T=im()(),t=typeof globalThis>"u"?Hr:globalThis,S=h(),D=_("String.prototype.slice"),w=Object.getPrototypeOf,E=_("Array.prototype.indexOf",!0)||function(z,A){for(var P=0;P<z.length;P+=1)if(z[P]===A)return P;return-1},m={__proto__:null};T&&k&&w?a(S,function(C){var z=new t[C];if(Symbol.toStringTag in z){var A=w(z),P=k(A,Symbol.toStringTag);if(!P){var x=w(A);P=k(x,Symbol.toStringTag)}m["$"+C]=v(P.get)}}):a(S,function(C){var z=new t[C],A=z.slice||z.set;A&&(m["$"+C]=v(A))});var y=function(z){var A=!1;return a(m,function(P,x){if(!A)try{"$"+P(z)===x&&(A=D(x,1))}catch{}}),A},p=function(z){var A=!1;return a(m,function(P,x){if(!A)try{P(z),A=D(x,1)}catch{}}),A};return J0=function(z){if(!z||typeof z!="object")return!1;if(!T){var A=D(b(z),8,-1);return E(S,A)>-1?A:A!=="Object"?!1:p(z)}return k?y(z):null},J0}var Q0,N2;function yP(){if(N2)return Q0;N2=1;var a=xT();return Q0=function(v){return!!a(v)},Q0}var U2;function vP(){return U2||(U2=1,function(a){var h=aP(),v=lP(),_=xT(),k=yP();function b(de){return de.call.bind(de)}var T=typeof BigInt<"u",t=typeof Symbol<"u",S=b(Object.prototype.toString),D=b(Number.prototype.valueOf),w=b(String.prototype.valueOf),E=b(Boolean.prototype.valueOf);if(T)var m=b(BigInt.prototype.valueOf);if(t)var y=b(Symbol.prototype.valueOf);function p(de,ve){if(typeof de!="object")return!1;try{return ve(de),!0}catch{return!1}}a.isArgumentsObject=h,a.isGeneratorFunction=v,a.isTypedArray=k;function C(de){return typeof Promise<"u"&&de instanceof Promise||de!==null&&typeof de=="object"&&typeof de.then=="function"&&typeof de.catch=="function"}a.isPromise=C;function z(de){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(de):k(de)||Fe(de)}a.isArrayBufferView=z;function A(de){return _(de)==="Uint8Array"}a.isUint8Array=A;function P(de){return _(de)==="Uint8ClampedArray"}a.isUint8ClampedArray=P;function x(de){return _(de)==="Uint16Array"}a.isUint16Array=x;function O(de){return _(de)==="Uint32Array"}a.isUint32Array=O;function U(de){return _(de)==="Int8Array"}a.isInt8Array=U;function G(de){return _(de)==="Int16Array"}a.isInt16Array=G;function Z(de){return _(de)==="Int32Array"}a.isInt32Array=Z;function X(de){return _(de)==="Float32Array"}a.isFloat32Array=X;function W(de){return _(de)==="Float64Array"}a.isFloat64Array=W;function J(de){return _(de)==="BigInt64Array"}a.isBigInt64Array=J;function re(de){return _(de)==="BigUint64Array"}a.isBigUint64Array=re;function te(de){return S(de)==="[object Map]"}te.working=typeof Map<"u"&&te(new Map);function ye(de){return typeof Map>"u"?!1:te.working?te(de):de instanceof Map}a.isMap=ye;function ue(de){return S(de)==="[object Set]"}ue.working=typeof Set<"u"&&ue(new Set);function Se(de){return typeof Set>"u"?!1:ue.working?ue(de):de instanceof Set}a.isSet=Se;function Le(de){return S(de)==="[object WeakMap]"}Le.working=typeof WeakMap<"u"&&Le(new WeakMap);function Pe(de){return typeof WeakMap>"u"?!1:Le.working?Le(de):de instanceof WeakMap}a.isWeakMap=Pe;function Ee(de){return S(de)==="[object WeakSet]"}Ee.working=typeof WeakSet<"u"&&Ee(new WeakSet);function Me(de){return Ee(de)}a.isWeakSet=Me;function He(de){return S(de)==="[object ArrayBuffer]"}He.working=typeof ArrayBuffer<"u"&&He(new ArrayBuffer);function nt(de){return typeof ArrayBuffer>"u"?!1:He.working?He(de):de instanceof ArrayBuffer}a.isArrayBuffer=nt;function ht(de){return S(de)==="[object DataView]"}ht.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&ht(new DataView(new ArrayBuffer(1),0,1));function Fe(de){return typeof DataView>"u"?!1:ht.working?ht(de):de instanceof DataView}a.isDataView=Fe;var Ce=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function Be(de){return S(de)==="[object SharedArrayBuffer]"}function Ae(de){return typeof Ce>"u"?!1:(typeof Be.working>"u"&&(Be.working=Be(new Ce)),Be.working?Be(de):de instanceof Ce)}a.isSharedArrayBuffer=Ae;function se(de){return S(de)==="[object AsyncFunction]"}a.isAsyncFunction=se;function pe(de){return S(de)==="[object Map Iterator]"}a.isMapIterator=pe;function Ke(de){return S(de)==="[object Set Iterator]"}a.isSetIterator=Ke;function _e(de){return S(de)==="[object Generator]"}a.isGeneratorObject=_e;function ke(de){return S(de)==="[object WebAssembly.Module]"}a.isWebAssemblyCompiledModule=ke;function qe(de){return p(de,D)}a.isNumberObject=qe;function tt(de){return p(de,w)}a.isStringObject=tt;function Ge(de){return p(de,E)}a.isBooleanObject=Ge;function We(de){return T&&p(de,m)}a.isBigIntObject=We;function Je(de){return t&&p(de,y)}a.isSymbolObject=Je;function it(de){return qe(de)||tt(de)||Ge(de)||We(de)||Je(de)}a.isBoxedPrimitive=it;function ze(de){return typeof Uint8Array<"u"&&(nt(de)||Ae(de))}a.isAnyArrayBuffer=ze,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(de){Object.defineProperty(a,de,{enumerable:!1,value:function(){throw new Error(de+" is not supported in userland")}})})}(r0)),r0}var ey,j2;function bP(){return j2||(j2=1,ey=function(h){return h&&typeof h=="object"&&typeof h.copy=="function"&&typeof h.fill=="function"&&typeof h.readUInt8=="function"}),ey}var V2;function wT(){return V2||(V2=1,function(a){var h={},v=Object.getOwnPropertyDescriptors||function(Ce){for(var Be=Object.keys(Ce),Ae={},se=0;se<Be.length;se++)Ae[Be[se]]=Object.getOwnPropertyDescriptor(Ce,Be[se]);return Ae},_=/%[sdj%]/g;a.format=function(Fe){if(!G(Fe)){for(var Ce=[],Be=0;Be<arguments.length;Be++)Ce.push(t(arguments[Be]));return Ce.join(" ")}for(var Be=1,Ae=arguments,se=Ae.length,pe=String(Fe).replace(_,function(_e){if(_e==="%%")return"%";if(Be>=se)return _e;switch(_e){case"%s":return String(Ae[Be++]);case"%d":return Number(Ae[Be++]);case"%j":try{return JSON.stringify(Ae[Be++])}catch{return"[Circular]"}default:return _e}}),Ke=Ae[Be];Be<se;Ke=Ae[++Be])x(Ke)||!J(Ke)?pe+=" "+Ke:pe+=" "+t(Ke);return pe},a.deprecate=function(Fe,Ce){if(typeof Ui<"u"&&Ui.noDeprecation===!0)return Fe;if(typeof Ui>"u")return function(){return a.deprecate(Fe,Ce).apply(this,arguments)};var Be=!1;function Ae(){if(!Be){if(Ui.throwDeprecation)throw new Error(Ce);Ui.traceDeprecation?console.trace(Ce):console.error(Ce),Be=!0}return Fe.apply(this,arguments)}return Ae};var k={},b=/^$/;if(h.NODE_DEBUG){var T=h.NODE_DEBUG;T=T.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),b=new RegExp("^"+T+"$","i")}a.debuglog=function(Fe){if(Fe=Fe.toUpperCase(),!k[Fe])if(b.test(Fe)){var Ce=Ui.pid;k[Fe]=function(){var Be=a.format.apply(a,arguments);console.error("%s %d: %s",Fe,Ce,Be)}}else k[Fe]=function(){};return k[Fe]};function t(Fe,Ce){var Be={seen:[],stylize:D};return arguments.length>=3&&(Be.depth=arguments[2]),arguments.length>=4&&(Be.colors=arguments[3]),P(Ce)?Be.showHidden=Ce:Ce&&a._extend(Be,Ce),X(Be.showHidden)&&(Be.showHidden=!1),X(Be.depth)&&(Be.depth=2),X(Be.colors)&&(Be.colors=!1),X(Be.customInspect)&&(Be.customInspect=!0),Be.colors&&(Be.stylize=S),E(Be,Fe,Be.depth)}a.inspect=t,t.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},t.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function S(Fe,Ce){var Be=t.styles[Ce];return Be?"\x1B["+t.colors[Be][0]+"m"+Fe+"\x1B["+t.colors[Be][1]+"m":Fe}function D(Fe,Ce){return Fe}function w(Fe){var Ce={};return Fe.forEach(function(Be,Ae){Ce[Be]=!0}),Ce}function E(Fe,Ce,Be){if(Fe.customInspect&&Ce&&ye(Ce.inspect)&&Ce.inspect!==a.inspect&&!(Ce.constructor&&Ce.constructor.prototype===Ce)){var Ae=Ce.inspect(Be,Fe);return G(Ae)||(Ae=E(Fe,Ae,Be)),Ae}var se=m(Fe,Ce);if(se)return se;var pe=Object.keys(Ce),Ke=w(pe);if(Fe.showHidden&&(pe=Object.getOwnPropertyNames(Ce)),te(Ce)&&(pe.indexOf("message")>=0||pe.indexOf("description")>=0))return y(Ce);if(pe.length===0){if(ye(Ce)){var _e=Ce.name?": "+Ce.name:"";return Fe.stylize("[Function"+_e+"]","special")}if(W(Ce))return Fe.stylize(RegExp.prototype.toString.call(Ce),"regexp");if(re(Ce))return Fe.stylize(Date.prototype.toString.call(Ce),"date");if(te(Ce))return y(Ce)}var ke="",qe=!1,tt=["{","}"];if(A(Ce)&&(qe=!0,tt=["[","]"]),ye(Ce)){var Ge=Ce.name?": "+Ce.name:"";ke=" [Function"+Ge+"]"}if(W(Ce)&&(ke=" "+RegExp.prototype.toString.call(Ce)),re(Ce)&&(ke=" "+Date.prototype.toUTCString.call(Ce)),te(Ce)&&(ke=" "+y(Ce)),pe.length===0&&(!qe||Ce.length==0))return tt[0]+ke+tt[1];if(Be<0)return W(Ce)?Fe.stylize(RegExp.prototype.toString.call(Ce),"regexp"):Fe.stylize("[Object]","special");Fe.seen.push(Ce);var We;return qe?We=p(Fe,Ce,Be,Ke,pe):We=pe.map(function(Je){return C(Fe,Ce,Be,Ke,Je,qe)}),Fe.seen.pop(),z(We,ke,tt)}function m(Fe,Ce){if(X(Ce))return Fe.stylize("undefined","undefined");if(G(Ce)){var Be="'"+JSON.stringify(Ce).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return Fe.stylize(Be,"string")}if(U(Ce))return Fe.stylize(""+Ce,"number");if(P(Ce))return Fe.stylize(""+Ce,"boolean");if(x(Ce))return Fe.stylize("null","null")}function y(Fe){return"["+Error.prototype.toString.call(Fe)+"]"}function p(Fe,Ce,Be,Ae,se){for(var pe=[],Ke=0,_e=Ce.length;Ke<_e;++Ke)Me(Ce,String(Ke))?pe.push(C(Fe,Ce,Be,Ae,String(Ke),!0)):pe.push("");return se.forEach(function(ke){ke.match(/^\d+$/)||pe.push(C(Fe,Ce,Be,Ae,ke,!0))}),pe}function C(Fe,Ce,Be,Ae,se,pe){var Ke,_e,ke;if(ke=Object.getOwnPropertyDescriptor(Ce,se)||{value:Ce[se]},ke.get?ke.set?_e=Fe.stylize("[Getter/Setter]","special"):_e=Fe.stylize("[Getter]","special"):ke.set&&(_e=Fe.stylize("[Setter]","special")),Me(Ae,se)||(Ke="["+se+"]"),_e||(Fe.seen.indexOf(ke.value)<0?(x(Be)?_e=E(Fe,ke.value,null):_e=E(Fe,ke.value,Be-1),_e.indexOf(`
`)>-1&&(pe?_e=_e.split(`
`).map(function(qe){return"  "+qe}).join(`
`).slice(2):_e=`
`+_e.split(`
`).map(function(qe){return"   "+qe}).join(`
`))):_e=Fe.stylize("[Circular]","special")),X(Ke)){if(pe&&se.match(/^\d+$/))return _e;Ke=JSON.stringify(""+se),Ke.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(Ke=Ke.slice(1,-1),Ke=Fe.stylize(Ke,"name")):(Ke=Ke.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),Ke=Fe.stylize(Ke,"string"))}return Ke+": "+_e}function z(Fe,Ce,Be){var Ae=Fe.reduce(function(se,pe){return pe.indexOf(`
`)>=0,se+pe.replace(/\u001b\[\d\d?m/g,"").length+1},0);return Ae>60?Be[0]+(Ce===""?"":Ce+`
 `)+" "+Fe.join(`,
  `)+" "+Be[1]:Be[0]+Ce+" "+Fe.join(", ")+" "+Be[1]}a.types=vP();function A(Fe){return Array.isArray(Fe)}a.isArray=A;function P(Fe){return typeof Fe=="boolean"}a.isBoolean=P;function x(Fe){return Fe===null}a.isNull=x;function O(Fe){return Fe==null}a.isNullOrUndefined=O;function U(Fe){return typeof Fe=="number"}a.isNumber=U;function G(Fe){return typeof Fe=="string"}a.isString=G;function Z(Fe){return typeof Fe=="symbol"}a.isSymbol=Z;function X(Fe){return Fe===void 0}a.isUndefined=X;function W(Fe){return J(Fe)&&Se(Fe)==="[object RegExp]"}a.isRegExp=W,a.types.isRegExp=W;function J(Fe){return typeof Fe=="object"&&Fe!==null}a.isObject=J;function re(Fe){return J(Fe)&&Se(Fe)==="[object Date]"}a.isDate=re,a.types.isDate=re;function te(Fe){return J(Fe)&&(Se(Fe)==="[object Error]"||Fe instanceof Error)}a.isError=te,a.types.isNativeError=te;function ye(Fe){return typeof Fe=="function"}a.isFunction=ye;function ue(Fe){return Fe===null||typeof Fe=="boolean"||typeof Fe=="number"||typeof Fe=="string"||typeof Fe=="symbol"||typeof Fe>"u"}a.isPrimitive=ue,a.isBuffer=bP();function Se(Fe){return Object.prototype.toString.call(Fe)}function Le(Fe){return Fe<10?"0"+Fe.toString(10):Fe.toString(10)}var Pe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Ee(){var Fe=new Date,Ce=[Le(Fe.getHours()),Le(Fe.getMinutes()),Le(Fe.getSeconds())].join(":");return[Fe.getDate(),Pe[Fe.getMonth()],Ce].join(" ")}a.log=function(){console.log("%s - %s",Ee(),a.format.apply(a,arguments))},a.inherits=uu(),a._extend=function(Fe,Ce){if(!Ce||!J(Ce))return Fe;for(var Be=Object.keys(Ce),Ae=Be.length;Ae--;)Fe[Be[Ae]]=Ce[Be[Ae]];return Fe};function Me(Fe,Ce){return Object.prototype.hasOwnProperty.call(Fe,Ce)}var He=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;a.promisify=function(Ce){if(typeof Ce!="function")throw new TypeError('The "original" argument must be of type Function');if(He&&Ce[He]){var Be=Ce[He];if(typeof Be!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(Be,He,{value:Be,enumerable:!1,writable:!1,configurable:!0}),Be}function Be(){for(var Ae,se,pe=new Promise(function(ke,qe){Ae=ke,se=qe}),Ke=[],_e=0;_e<arguments.length;_e++)Ke.push(arguments[_e]);Ke.push(function(ke,qe){ke?se(ke):Ae(qe)});try{Ce.apply(this,Ke)}catch(ke){se(ke)}return pe}return Object.setPrototypeOf(Be,Object.getPrototypeOf(Ce)),He&&Object.defineProperty(Be,He,{value:Be,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(Be,v(Ce))},a.promisify.custom=He;function nt(Fe,Ce){if(!Fe){var Be=new Error("Promise was rejected with a falsy value");Be.reason=Fe,Fe=Be}return Ce(Fe)}function ht(Fe){if(typeof Fe!="function")throw new TypeError('The "original" argument must be of type Function');function Ce(){for(var Be=[],Ae=0;Ae<arguments.length;Ae++)Be.push(arguments[Ae]);var se=Be.pop();if(typeof se!="function")throw new TypeError("The last argument must be of type Function");var pe=this,Ke=function(){return se.apply(pe,arguments)};Fe.apply(this,Be).then(function(_e){Ui.nextTick(Ke.bind(null,null,_e))},function(_e){Ui.nextTick(nt.bind(null,_e,Ke))})}return Object.setPrototypeOf(Ce,Object.getPrototypeOf(Fe)),Object.defineProperties(Ce,v(Fe)),Ce}a.callbackify=ht}(t0)),t0}var ty,G2;function xP(){if(G2)return ty;G2=1;function a(p,C){var z=Object.keys(p);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(p);C&&(A=A.filter(function(P){return Object.getOwnPropertyDescriptor(p,P).enumerable})),z.push.apply(z,A)}return z}function h(p){for(var C=1;C<arguments.length;C++){var z=arguments[C]!=null?arguments[C]:{};C%2?a(Object(z),!0).forEach(function(A){v(p,A,z[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(z)):a(Object(z)).forEach(function(A){Object.defineProperty(p,A,Object.getOwnPropertyDescriptor(z,A))})}return p}function v(p,C,z){return C=T(C),C in p?Object.defineProperty(p,C,{value:z,enumerable:!0,configurable:!0,writable:!0}):p[C]=z,p}function _(p,C){if(!(p instanceof C))throw new TypeError("Cannot call a class as a function")}function k(p,C){for(var z=0;z<C.length;z++){var A=C[z];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(p,T(A.key),A)}}function b(p,C,z){return C&&k(p.prototype,C),Object.defineProperty(p,"prototype",{writable:!1}),p}function T(p){var C=t(p,"string");return typeof C=="symbol"?C:String(C)}function t(p,C){if(typeof p!="object"||p===null)return p;var z=p[Symbol.toPrimitive];if(z!==void 0){var A=z.call(p,C);if(typeof A!="object")return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(p)}var S=Bf(),D=S.Buffer,w=wT(),E=w.inspect,m=E&&E.custom||"inspect";function y(p,C,z){D.prototype.copy.call(p,C,z)}return ty=function(){function p(){_(this,p),this.head=null,this.tail=null,this.length=0}return b(p,[{key:"push",value:function(z){var A={data:z,next:null};this.length>0?this.tail.next=A:this.head=A,this.tail=A,++this.length}},{key:"unshift",value:function(z){var A={data:z,next:this.head};this.length===0&&(this.tail=A),this.head=A,++this.length}},{key:"shift",value:function(){if(this.length!==0){var z=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,z}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(z){if(this.length===0)return"";for(var A=this.head,P=""+A.data;A=A.next;)P+=z+A.data;return P}},{key:"concat",value:function(z){if(this.length===0)return D.alloc(0);for(var A=D.allocUnsafe(z>>>0),P=this.head,x=0;P;)y(P.data,A,x),x+=P.data.length,P=P.next;return A}},{key:"consume",value:function(z,A){var P;return z<this.head.data.length?(P=this.head.data.slice(0,z),this.head.data=this.head.data.slice(z)):z===this.head.data.length?P=this.shift():P=A?this._getString(z):this._getBuffer(z),P}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(z){var A=this.head,P=1,x=A.data;for(z-=x.length;A=A.next;){var O=A.data,U=z>O.length?O.length:z;if(U===O.length?x+=O:x+=O.slice(0,z),z-=U,z===0){U===O.length?(++P,A.next?this.head=A.next:this.head=this.tail=null):(this.head=A,A.data=O.slice(U));break}++P}return this.length-=P,x}},{key:"_getBuffer",value:function(z){var A=D.allocUnsafe(z),P=this.head,x=1;for(P.data.copy(A),z-=P.data.length;P=P.next;){var O=P.data,U=z>O.length?O.length:z;if(O.copy(A,A.length-z,0,U),z-=U,z===0){U===O.length?(++x,P.next?this.head=P.next:this.head=this.tail=null):(this.head=P,P.data=O.slice(U));break}++x}return this.length-=x,A}},{key:m,value:function(z,A){return E(this,h(h({},A),{},{depth:0,customInspect:!1}))}}]),p}(),ty}var ry,H2;function ET(){if(H2)return ry;H2=1;function a(T,t){var S=this,D=this._readableState&&this._readableState.destroyed,w=this._writableState&&this._writableState.destroyed;return D||w?(t?t(T):T&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,Ui.nextTick(k,this,T)):Ui.nextTick(k,this,T)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(T||null,function(E){!t&&E?S._writableState?S._writableState.errorEmitted?Ui.nextTick(v,S):(S._writableState.errorEmitted=!0,Ui.nextTick(h,S,E)):Ui.nextTick(h,S,E):t?(Ui.nextTick(v,S),t(E)):Ui.nextTick(v,S)}),this)}function h(T,t){k(T,t),v(T)}function v(T){T._writableState&&!T._writableState.emitClose||T._readableState&&!T._readableState.emitClose||T.emit("close")}function _(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function k(T,t){T.emit("error",t)}function b(T,t){var S=T._readableState,D=T._writableState;S&&S.autoDestroy||D&&D.autoDestroy?T.destroy(t):T.emit("error",t)}return ry={destroy:a,undestroy:_,errorOrDestroy:b},ry}var iy={},q2;function Nc(){if(q2)return iy;q2=1;function a(t,S){t.prototype=Object.create(S.prototype),t.prototype.constructor=t,t.__proto__=S}var h={};function v(t,S,D){D||(D=Error);function w(m,y,p){return typeof S=="string"?S:S(m,y,p)}var E=function(m){a(y,m);function y(p,C,z){return m.call(this,w(p,C,z))||this}return y}(D);E.prototype.name=D.name,E.prototype.code=t,h[t]=E}function _(t,S){if(Array.isArray(t)){var D=t.length;return t=t.map(function(w){return String(w)}),D>2?"one of ".concat(S," ").concat(t.slice(0,D-1).join(", "),", or ")+t[D-1]:D===2?"one of ".concat(S," ").concat(t[0]," or ").concat(t[1]):"of ".concat(S," ").concat(t[0])}else return"of ".concat(S," ").concat(String(t))}function k(t,S,D){return t.substr(0,S.length)===S}function b(t,S,D){return(D===void 0||D>t.length)&&(D=t.length),t.substring(D-S.length,D)===S}function T(t,S,D){return typeof D!="number"&&(D=0),D+S.length>t.length?!1:t.indexOf(S,D)!==-1}return v("ERR_INVALID_OPT_VALUE",function(t,S){return'The value "'+S+'" is invalid for option "'+t+'"'},TypeError),v("ERR_INVALID_ARG_TYPE",function(t,S,D){var w;typeof S=="string"&&k(S,"not ")?(w="must not be",S=S.replace(/^not /,"")):w="must be";var E;if(b(t," argument"))E="The ".concat(t," ").concat(w," ").concat(_(S,"type"));else{var m=T(t,".")?"property":"argument";E='The "'.concat(t,'" ').concat(m," ").concat(w," ").concat(_(S,"type"))}return E+=". Received type ".concat(typeof D),E},TypeError),v("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),v("ERR_METHOD_NOT_IMPLEMENTED",function(t){return"The "+t+" method is not implemented"}),v("ERR_STREAM_PREMATURE_CLOSE","Premature close"),v("ERR_STREAM_DESTROYED",function(t){return"Cannot call "+t+" after a stream was destroyed"}),v("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),v("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),v("ERR_STREAM_WRITE_AFTER_END","write after end"),v("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),v("ERR_UNKNOWN_ENCODING",function(t){return"Unknown encoding: "+t},TypeError),v("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),iy.codes=h,iy}var ny,W2;function TT(){if(W2)return ny;W2=1;var a=Nc().codes.ERR_INVALID_OPT_VALUE;function h(_,k,b){return _.highWaterMark!=null?_.highWaterMark:k?_[b]:null}function v(_,k,b,T){var t=h(k,T,b);if(t!=null){if(!(isFinite(t)&&Math.floor(t)===t)||t<0){var S=T?b:"highWaterMark";throw new a(S,t)}return Math.floor(t)}return _.objectMode?16:16*1024}return ny={getHighWaterMark:v},ny}var ay,$2;function wP(){if($2)return ay;$2=1,ay=a;function a(v,_){if(h("noDeprecation"))return v;var k=!1;function b(){if(!k){if(h("throwDeprecation"))throw new Error(_);h("traceDeprecation")?console.trace(_):console.warn(_),k=!0}return v.apply(this,arguments)}return b}function h(v){try{if(!Hr.localStorage)return!1}catch{return!1}var _=Hr.localStorage[v];return _==null?!1:String(_).toLowerCase()==="true"}return ay}var oy,Z2;function ST(){if(Z2)return oy;Z2=1,oy=X;function a(Ae){var se=this;this.next=null,this.entry=null,this.finish=function(){Be(se,Ae)}}var h;X.WritableState=G;var v={deprecate:wP()},_=hT(),k=Bf().Buffer,b=(typeof Hr<"u"?Hr:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function T(Ae){return k.from(Ae)}function t(Ae){return k.isBuffer(Ae)||Ae instanceof b}var S=ET(),D=TT(),w=D.getHighWaterMark,E=Nc().codes,m=E.ERR_INVALID_ARG_TYPE,y=E.ERR_METHOD_NOT_IMPLEMENTED,p=E.ERR_MULTIPLE_CALLBACK,C=E.ERR_STREAM_CANNOT_PIPE,z=E.ERR_STREAM_DESTROYED,A=E.ERR_STREAM_NULL_VALUES,P=E.ERR_STREAM_WRITE_AFTER_END,x=E.ERR_UNKNOWN_ENCODING,O=S.errorOrDestroy;uu()(X,_);function U(){}function G(Ae,se,pe){h=h||Bc(),Ae=Ae||{},typeof pe!="boolean"&&(pe=se instanceof h),this.objectMode=!!Ae.objectMode,pe&&(this.objectMode=this.objectMode||!!Ae.writableObjectMode),this.highWaterMark=w(this,Ae,"writableHighWaterMark",pe),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var Ke=Ae.decodeStrings===!1;this.decodeStrings=!Ke,this.defaultEncoding=Ae.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(_e){Le(se,_e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=Ae.emitClose!==!1,this.autoDestroy=!!Ae.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}G.prototype.getBuffer=function(){for(var se=this.bufferedRequest,pe=[];se;)pe.push(se),se=se.next;return pe},function(){try{Object.defineProperty(G.prototype,"buffer",{get:v.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var Z;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(Z=Function.prototype[Symbol.hasInstance],Object.defineProperty(X,Symbol.hasInstance,{value:function(se){return Z.call(this,se)?!0:this!==X?!1:se&&se._writableState instanceof G}})):Z=function(se){return se instanceof this};function X(Ae){h=h||Bc();var se=this instanceof h;if(!se&&!Z.call(X,this))return new X(Ae);this._writableState=new G(Ae,this,se),this.writable=!0,Ae&&(typeof Ae.write=="function"&&(this._write=Ae.write),typeof Ae.writev=="function"&&(this._writev=Ae.writev),typeof Ae.destroy=="function"&&(this._destroy=Ae.destroy),typeof Ae.final=="function"&&(this._final=Ae.final)),_.call(this)}X.prototype.pipe=function(){O(this,new C)};function W(Ae,se){var pe=new P;O(Ae,pe),Ui.nextTick(se,pe)}function J(Ae,se,pe,Ke){var _e;return pe===null?_e=new A:typeof pe!="string"&&!se.objectMode&&(_e=new m("chunk",["string","Buffer"],pe)),_e?(O(Ae,_e),Ui.nextTick(Ke,_e),!1):!0}X.prototype.write=function(Ae,se,pe){var Ke=this._writableState,_e=!1,ke=!Ke.objectMode&&t(Ae);return ke&&!k.isBuffer(Ae)&&(Ae=T(Ae)),typeof se=="function"&&(pe=se,se=null),ke?se="buffer":se||(se=Ke.defaultEncoding),typeof pe!="function"&&(pe=U),Ke.ending?W(this,pe):(ke||J(this,Ke,Ae,pe))&&(Ke.pendingcb++,_e=te(this,Ke,ke,Ae,se,pe)),_e},X.prototype.cork=function(){this._writableState.corked++},X.prototype.uncork=function(){var Ae=this._writableState;Ae.corked&&(Ae.corked--,!Ae.writing&&!Ae.corked&&!Ae.bufferProcessing&&Ae.bufferedRequest&&Me(this,Ae))},X.prototype.setDefaultEncoding=function(se){if(typeof se=="string"&&(se=se.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((se+"").toLowerCase())>-1))throw new x(se);return this._writableState.defaultEncoding=se,this},Object.defineProperty(X.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function re(Ae,se,pe){return!Ae.objectMode&&Ae.decodeStrings!==!1&&typeof se=="string"&&(se=k.from(se,pe)),se}Object.defineProperty(X.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function te(Ae,se,pe,Ke,_e,ke){if(!pe){var qe=re(se,Ke,_e);Ke!==qe&&(pe=!0,_e="buffer",Ke=qe)}var tt=se.objectMode?1:Ke.length;se.length+=tt;var Ge=se.length<se.highWaterMark;if(Ge||(se.needDrain=!0),se.writing||se.corked){var We=se.lastBufferedRequest;se.lastBufferedRequest={chunk:Ke,encoding:_e,isBuf:pe,callback:ke,next:null},We?We.next=se.lastBufferedRequest:se.bufferedRequest=se.lastBufferedRequest,se.bufferedRequestCount+=1}else ye(Ae,se,!1,tt,Ke,_e,ke);return Ge}function ye(Ae,se,pe,Ke,_e,ke,qe){se.writelen=Ke,se.writecb=qe,se.writing=!0,se.sync=!0,se.destroyed?se.onwrite(new z("write")):pe?Ae._writev(_e,se.onwrite):Ae._write(_e,ke,se.onwrite),se.sync=!1}function ue(Ae,se,pe,Ke,_e){--se.pendingcb,pe?(Ui.nextTick(_e,Ke),Ui.nextTick(Fe,Ae,se),Ae._writableState.errorEmitted=!0,O(Ae,Ke)):(_e(Ke),Ae._writableState.errorEmitted=!0,O(Ae,Ke),Fe(Ae,se))}function Se(Ae){Ae.writing=!1,Ae.writecb=null,Ae.length-=Ae.writelen,Ae.writelen=0}function Le(Ae,se){var pe=Ae._writableState,Ke=pe.sync,_e=pe.writecb;if(typeof _e!="function")throw new p;if(Se(pe),se)ue(Ae,pe,Ke,se,_e);else{var ke=He(pe)||Ae.destroyed;!ke&&!pe.corked&&!pe.bufferProcessing&&pe.bufferedRequest&&Me(Ae,pe),Ke?Ui.nextTick(Pe,Ae,pe,ke,_e):Pe(Ae,pe,ke,_e)}}function Pe(Ae,se,pe,Ke){pe||Ee(Ae,se),se.pendingcb--,Ke(),Fe(Ae,se)}function Ee(Ae,se){se.length===0&&se.needDrain&&(se.needDrain=!1,Ae.emit("drain"))}function Me(Ae,se){se.bufferProcessing=!0;var pe=se.bufferedRequest;if(Ae._writev&&pe&&pe.next){var Ke=se.bufferedRequestCount,_e=new Array(Ke),ke=se.corkedRequestsFree;ke.entry=pe;for(var qe=0,tt=!0;pe;)_e[qe]=pe,pe.isBuf||(tt=!1),pe=pe.next,qe+=1;_e.allBuffers=tt,ye(Ae,se,!0,se.length,_e,"",ke.finish),se.pendingcb++,se.lastBufferedRequest=null,ke.next?(se.corkedRequestsFree=ke.next,ke.next=null):se.corkedRequestsFree=new a(se),se.bufferedRequestCount=0}else{for(;pe;){var Ge=pe.chunk,We=pe.encoding,Je=pe.callback,it=se.objectMode?1:Ge.length;if(ye(Ae,se,!1,it,Ge,We,Je),pe=pe.next,se.bufferedRequestCount--,se.writing)break}pe===null&&(se.lastBufferedRequest=null)}se.bufferedRequest=pe,se.bufferProcessing=!1}X.prototype._write=function(Ae,se,pe){pe(new y("_write()"))},X.prototype._writev=null,X.prototype.end=function(Ae,se,pe){var Ke=this._writableState;return typeof Ae=="function"?(pe=Ae,Ae=null,se=null):typeof se=="function"&&(pe=se,se=null),Ae!=null&&this.write(Ae,se),Ke.corked&&(Ke.corked=1,this.uncork()),Ke.ending||Ce(this,Ke,pe),this},Object.defineProperty(X.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function He(Ae){return Ae.ending&&Ae.length===0&&Ae.bufferedRequest===null&&!Ae.finished&&!Ae.writing}function nt(Ae,se){Ae._final(function(pe){se.pendingcb--,pe&&O(Ae,pe),se.prefinished=!0,Ae.emit("prefinish"),Fe(Ae,se)})}function ht(Ae,se){!se.prefinished&&!se.finalCalled&&(typeof Ae._final=="function"&&!se.destroyed?(se.pendingcb++,se.finalCalled=!0,Ui.nextTick(nt,Ae,se)):(se.prefinished=!0,Ae.emit("prefinish")))}function Fe(Ae,se){var pe=He(se);if(pe&&(ht(Ae,se),se.pendingcb===0&&(se.finished=!0,Ae.emit("finish"),se.autoDestroy))){var Ke=Ae._readableState;(!Ke||Ke.autoDestroy&&Ke.endEmitted)&&Ae.destroy()}return pe}function Ce(Ae,se,pe){se.ending=!0,Fe(Ae,se),pe&&(se.finished?Ui.nextTick(pe):Ae.once("finish",pe)),se.ended=!0,Ae.writable=!1}function Be(Ae,se,pe){var Ke=Ae.entry;for(Ae.entry=null;Ke;){var _e=Ke.callback;se.pendingcb--,_e(pe),Ke=Ke.next}se.corkedRequestsFree.next=Ae}return Object.defineProperty(X.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(se){this._writableState&&(this._writableState.destroyed=se)}}),X.prototype.destroy=S.destroy,X.prototype._undestroy=S.undestroy,X.prototype._destroy=function(Ae,se){se(Ae)},oy}var sy,X2;function Bc(){if(X2)return sy;X2=1;var a=Object.keys||function(D){var w=[];for(var E in D)w.push(E);return w};sy=T;var h=MT(),v=ST();uu()(T,h);for(var _=a(v.prototype),k=0;k<_.length;k++){var b=_[k];T.prototype[b]||(T.prototype[b]=v.prototype[b])}function T(D){if(!(this instanceof T))return new T(D);h.call(this,D),v.call(this,D),this.allowHalfOpen=!0,D&&(D.readable===!1&&(this.readable=!1),D.writable===!1&&(this.writable=!1),D.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",t)))}Object.defineProperty(T.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(T.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(T.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function t(){this._writableState.ended||Ui.nextTick(S,this)}function S(D){D.end()}return Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(w){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=w,this._writableState.destroyed=w)}}),sy}var ly={},Np={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var Y2;function EP(){return Y2||(Y2=1,function(a,h){var v=Bf(),_=v.Buffer;function k(T,t){for(var S in T)t[S]=T[S]}_.from&&_.alloc&&_.allocUnsafe&&_.allocUnsafeSlow?a.exports=v:(k(v,h),h.Buffer=b);function b(T,t,S){return _(T,t,S)}b.prototype=Object.create(_.prototype),k(_,b),b.from=function(T,t,S){if(typeof T=="number")throw new TypeError("Argument must not be a number");return _(T,t,S)},b.alloc=function(T,t,S){if(typeof T!="number")throw new TypeError("Argument must be a number");var D=_(T);return t!==void 0?typeof S=="string"?D.fill(t,S):D.fill(t):D.fill(0),D},b.allocUnsafe=function(T){if(typeof T!="number")throw new TypeError("Argument must be a number");return _(T)},b.allocUnsafeSlow=function(T){if(typeof T!="number")throw new TypeError("Argument must be a number");return v.SlowBuffer(T)}}(Np,Np.exports)),Np.exports}var K2;function Py(){if(K2)return ly;K2=1;var a=EP().Buffer,h=a.isEncoding||function(A){switch(A=""+A,A&&A.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function v(A){if(!A)return"utf8";for(var P;;)switch(A){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return A;default:if(P)return;A=(""+A).toLowerCase(),P=!0}}function _(A){var P=v(A);if(typeof P!="string"&&(a.isEncoding===h||!h(A)))throw new Error("Unknown encoding: "+A);return P||A}ly.StringDecoder=k;function k(A){this.encoding=_(A);var P;switch(this.encoding){case"utf16le":this.text=E,this.end=m,P=4;break;case"utf8":this.fillLast=S,P=4;break;case"base64":this.text=y,this.end=p,P=3;break;default:this.write=C,this.end=z;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=a.allocUnsafe(P)}k.prototype.write=function(A){if(A.length===0)return"";var P,x;if(this.lastNeed){if(P=this.fillLast(A),P===void 0)return"";x=this.lastNeed,this.lastNeed=0}else x=0;return x<A.length?P?P+this.text(A,x):this.text(A,x):P||""},k.prototype.end=w,k.prototype.text=D,k.prototype.fillLast=function(A){if(this.lastNeed<=A.length)return A.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);A.copy(this.lastChar,this.lastTotal-this.lastNeed,0,A.length),this.lastNeed-=A.length};function b(A){return A<=127?0:A>>5===6?2:A>>4===14?3:A>>3===30?4:A>>6===2?-1:-2}function T(A,P,x){var O=P.length-1;if(O<x)return 0;var U=b(P[O]);return U>=0?(U>0&&(A.lastNeed=U-1),U):--O<x||U===-2?0:(U=b(P[O]),U>=0?(U>0&&(A.lastNeed=U-2),U):--O<x||U===-2?0:(U=b(P[O]),U>=0?(U>0&&(U===2?U=0:A.lastNeed=U-3),U):0))}function t(A,P,x){if((P[0]&192)!==128)return A.lastNeed=0,"�";if(A.lastNeed>1&&P.length>1){if((P[1]&192)!==128)return A.lastNeed=1,"�";if(A.lastNeed>2&&P.length>2&&(P[2]&192)!==128)return A.lastNeed=2,"�"}}function S(A){var P=this.lastTotal-this.lastNeed,x=t(this,A);if(x!==void 0)return x;if(this.lastNeed<=A.length)return A.copy(this.lastChar,P,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);A.copy(this.lastChar,P,0,A.length),this.lastNeed-=A.length}function D(A,P){var x=T(this,A,P);if(!this.lastNeed)return A.toString("utf8",P);this.lastTotal=x;var O=A.length-(x-this.lastNeed);return A.copy(this.lastChar,0,O),A.toString("utf8",P,O)}function w(A){var P=A&&A.length?this.write(A):"";return this.lastNeed?P+"�":P}function E(A,P){if((A.length-P)%2===0){var x=A.toString("utf16le",P);if(x){var O=x.charCodeAt(x.length-1);if(O>=55296&&O<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=A[A.length-2],this.lastChar[1]=A[A.length-1],x.slice(0,-1)}return x}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=A[A.length-1],A.toString("utf16le",P,A.length-1)}function m(A){var P=A&&A.length?this.write(A):"";if(this.lastNeed){var x=this.lastTotal-this.lastNeed;return P+this.lastChar.toString("utf16le",0,x)}return P}function y(A,P){var x=(A.length-P)%3;return x===0?A.toString("base64",P):(this.lastNeed=3-x,this.lastTotal=3,x===1?this.lastChar[0]=A[A.length-1]:(this.lastChar[0]=A[A.length-2],this.lastChar[1]=A[A.length-1]),A.toString("base64",P,A.length-x))}function p(A){var P=A&&A.length?this.write(A):"";return this.lastNeed?P+this.lastChar.toString("base64",0,3-this.lastNeed):P}function C(A){return A.toString(this.encoding)}function z(A){return A&&A.length?this.write(A):""}return ly}var uy,J2;function _1(){if(J2)return uy;J2=1;var a=Nc().codes.ERR_STREAM_PREMATURE_CLOSE;function h(b){var T=!1;return function(){if(!T){T=!0;for(var t=arguments.length,S=new Array(t),D=0;D<t;D++)S[D]=arguments[D];b.apply(this,S)}}}function v(){}function _(b){return b.setHeader&&typeof b.abort=="function"}function k(b,T,t){if(typeof T=="function")return k(b,null,T);T||(T={}),t=h(t||v);var S=T.readable||T.readable!==!1&&b.readable,D=T.writable||T.writable!==!1&&b.writable,w=function(){b.writable||m()},E=b._writableState&&b._writableState.finished,m=function(){D=!1,E=!0,S||t.call(b)},y=b._readableState&&b._readableState.endEmitted,p=function(){S=!1,y=!0,D||t.call(b)},C=function(x){t.call(b,x)},z=function(){var x;if(S&&!y)return(!b._readableState||!b._readableState.ended)&&(x=new a),t.call(b,x);if(D&&!E)return(!b._writableState||!b._writableState.ended)&&(x=new a),t.call(b,x)},A=function(){b.req.on("finish",m)};return _(b)?(b.on("complete",m),b.on("abort",z),b.req?A():b.on("request",A)):D&&!b._writableState&&(b.on("end",w),b.on("close",w)),b.on("end",p),b.on("finish",m),T.error!==!1&&b.on("error",C),b.on("close",z),function(){b.removeListener("complete",m),b.removeListener("abort",z),b.removeListener("request",A),b.req&&b.req.removeListener("finish",m),b.removeListener("end",w),b.removeListener("close",w),b.removeListener("finish",m),b.removeListener("end",p),b.removeListener("error",C),b.removeListener("close",z)}}return uy=k,uy}var cy,Q2;function TP(){if(Q2)return cy;Q2=1;var a;function h(x,O,U){return O=v(O),O in x?Object.defineProperty(x,O,{value:U,enumerable:!0,configurable:!0,writable:!0}):x[O]=U,x}function v(x){var O=_(x,"string");return typeof O=="symbol"?O:String(O)}function _(x,O){if(typeof x!="object"||x===null)return x;var U=x[Symbol.toPrimitive];if(U!==void 0){var G=U.call(x,O);if(typeof G!="object")return G;throw new TypeError("@@toPrimitive must return a primitive value.")}return(O==="string"?String:Number)(x)}var k=_1(),b=Symbol("lastResolve"),T=Symbol("lastReject"),t=Symbol("error"),S=Symbol("ended"),D=Symbol("lastPromise"),w=Symbol("handlePromise"),E=Symbol("stream");function m(x,O){return{value:x,done:O}}function y(x){var O=x[b];if(O!==null){var U=x[E].read();U!==null&&(x[D]=null,x[b]=null,x[T]=null,O(m(U,!1)))}}function p(x){Ui.nextTick(y,x)}function C(x,O){return function(U,G){x.then(function(){if(O[S]){U(m(void 0,!0));return}O[w](U,G)},G)}}var z=Object.getPrototypeOf(function(){}),A=Object.setPrototypeOf((a={get stream(){return this[E]},next:function(){var O=this,U=this[t];if(U!==null)return Promise.reject(U);if(this[S])return Promise.resolve(m(void 0,!0));if(this[E].destroyed)return new Promise(function(W,J){Ui.nextTick(function(){O[t]?J(O[t]):W(m(void 0,!0))})});var G=this[D],Z;if(G)Z=new Promise(C(G,this));else{var X=this[E].read();if(X!==null)return Promise.resolve(m(X,!1));Z=new Promise(this[w])}return this[D]=Z,Z}},h(a,Symbol.asyncIterator,function(){return this}),h(a,"return",function(){var O=this;return new Promise(function(U,G){O[E].destroy(null,function(Z){if(Z){G(Z);return}U(m(void 0,!0))})})}),a),z),P=function(O){var U,G=Object.create(A,(U={},h(U,E,{value:O,writable:!0}),h(U,b,{value:null,writable:!0}),h(U,T,{value:null,writable:!0}),h(U,t,{value:null,writable:!0}),h(U,S,{value:O._readableState.endEmitted,writable:!0}),h(U,w,{value:function(X,W){var J=G[E].read();J?(G[D]=null,G[b]=null,G[T]=null,X(m(J,!1))):(G[b]=X,G[T]=W)},writable:!0}),U));return G[D]=null,k(O,function(Z){if(Z&&Z.code!=="ERR_STREAM_PREMATURE_CLOSE"){var X=G[T];X!==null&&(G[D]=null,G[b]=null,G[T]=null,X(Z)),G[t]=Z;return}var W=G[b];W!==null&&(G[D]=null,G[b]=null,G[T]=null,W(m(void 0,!0))),G[S]=!0}),O.on("readable",p.bind(null,G)),G};return cy=P,cy}var hy,eE;function SP(){return eE||(eE=1,hy=function(){throw new Error("Readable.from is not available in the browser")}),hy}var fy,tE;function MT(){if(tE)return fy;tE=1,fy=W;var a;W.ReadableState=X,rm().EventEmitter;var h=function(qe,tt){return qe.listeners(tt).length},v=hT(),_=Bf().Buffer,k=(typeof Hr<"u"?Hr:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function b(ke){return _.from(ke)}function T(ke){return _.isBuffer(ke)||ke instanceof k}var t=wT(),S;t&&t.debuglog?S=t.debuglog("stream"):S=function(){};var D=xP(),w=ET(),E=TT(),m=E.getHighWaterMark,y=Nc().codes,p=y.ERR_INVALID_ARG_TYPE,C=y.ERR_STREAM_PUSH_AFTER_EOF,z=y.ERR_METHOD_NOT_IMPLEMENTED,A=y.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,P,x,O;uu()(W,v);var U=w.errorOrDestroy,G=["error","close","destroy","pause","resume"];function Z(ke,qe,tt){if(typeof ke.prependListener=="function")return ke.prependListener(qe,tt);!ke._events||!ke._events[qe]?ke.on(qe,tt):Array.isArray(ke._events[qe])?ke._events[qe].unshift(tt):ke._events[qe]=[tt,ke._events[qe]]}function X(ke,qe,tt){a=a||Bc(),ke=ke||{},typeof tt!="boolean"&&(tt=qe instanceof a),this.objectMode=!!ke.objectMode,tt&&(this.objectMode=this.objectMode||!!ke.readableObjectMode),this.highWaterMark=m(this,ke,"readableHighWaterMark",tt),this.buffer=new D,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=ke.emitClose!==!1,this.autoDestroy=!!ke.autoDestroy,this.destroyed=!1,this.defaultEncoding=ke.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,ke.encoding&&(P||(P=Py().StringDecoder),this.decoder=new P(ke.encoding),this.encoding=ke.encoding)}function W(ke){if(a=a||Bc(),!(this instanceof W))return new W(ke);var qe=this instanceof a;this._readableState=new X(ke,this,qe),this.readable=!0,ke&&(typeof ke.read=="function"&&(this._read=ke.read),typeof ke.destroy=="function"&&(this._destroy=ke.destroy)),v.call(this)}Object.defineProperty(W.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(qe){this._readableState&&(this._readableState.destroyed=qe)}}),W.prototype.destroy=w.destroy,W.prototype._undestroy=w.undestroy,W.prototype._destroy=function(ke,qe){qe(ke)},W.prototype.push=function(ke,qe){var tt=this._readableState,Ge;return tt.objectMode?Ge=!0:typeof ke=="string"&&(qe=qe||tt.defaultEncoding,qe!==tt.encoding&&(ke=_.from(ke,qe),qe=""),Ge=!0),J(this,ke,qe,!1,Ge)},W.prototype.unshift=function(ke){return J(this,ke,null,!0,!1)};function J(ke,qe,tt,Ge,We){S("readableAddChunk",qe);var Je=ke._readableState;if(qe===null)Je.reading=!1,Le(ke,Je);else{var it;if(We||(it=te(Je,qe)),it)U(ke,it);else if(Je.objectMode||qe&&qe.length>0)if(typeof qe!="string"&&!Je.objectMode&&Object.getPrototypeOf(qe)!==_.prototype&&(qe=b(qe)),Ge)Je.endEmitted?U(ke,new A):re(ke,Je,qe,!0);else if(Je.ended)U(ke,new C);else{if(Je.destroyed)return!1;Je.reading=!1,Je.decoder&&!tt?(qe=Je.decoder.write(qe),Je.objectMode||qe.length!==0?re(ke,Je,qe,!1):Me(ke,Je)):re(ke,Je,qe,!1)}else Ge||(Je.reading=!1,Me(ke,Je))}return!Je.ended&&(Je.length<Je.highWaterMark||Je.length===0)}function re(ke,qe,tt,Ge){qe.flowing&&qe.length===0&&!qe.sync?(qe.awaitDrain=0,ke.emit("data",tt)):(qe.length+=qe.objectMode?1:tt.length,Ge?qe.buffer.unshift(tt):qe.buffer.push(tt),qe.needReadable&&Pe(ke)),Me(ke,qe)}function te(ke,qe){var tt;return!T(qe)&&typeof qe!="string"&&qe!==void 0&&!ke.objectMode&&(tt=new p("chunk",["string","Buffer","Uint8Array"],qe)),tt}W.prototype.isPaused=function(){return this._readableState.flowing===!1},W.prototype.setEncoding=function(ke){P||(P=Py().StringDecoder);var qe=new P(ke);this._readableState.decoder=qe,this._readableState.encoding=this._readableState.decoder.encoding;for(var tt=this._readableState.buffer.head,Ge="";tt!==null;)Ge+=qe.write(tt.data),tt=tt.next;return this._readableState.buffer.clear(),Ge!==""&&this._readableState.buffer.push(Ge),this._readableState.length=Ge.length,this};var ye=1073741824;function ue(ke){return ke>=ye?ke=ye:(ke--,ke|=ke>>>1,ke|=ke>>>2,ke|=ke>>>4,ke|=ke>>>8,ke|=ke>>>16,ke++),ke}function Se(ke,qe){return ke<=0||qe.length===0&&qe.ended?0:qe.objectMode?1:ke!==ke?qe.flowing&&qe.length?qe.buffer.head.data.length:qe.length:(ke>qe.highWaterMark&&(qe.highWaterMark=ue(ke)),ke<=qe.length?ke:qe.ended?qe.length:(qe.needReadable=!0,0))}W.prototype.read=function(ke){S("read",ke),ke=parseInt(ke,10);var qe=this._readableState,tt=ke;if(ke!==0&&(qe.emittedReadable=!1),ke===0&&qe.needReadable&&((qe.highWaterMark!==0?qe.length>=qe.highWaterMark:qe.length>0)||qe.ended))return S("read: emitReadable",qe.length,qe.ended),qe.length===0&&qe.ended?pe(this):Pe(this),null;if(ke=Se(ke,qe),ke===0&&qe.ended)return qe.length===0&&pe(this),null;var Ge=qe.needReadable;S("need readable",Ge),(qe.length===0||qe.length-ke<qe.highWaterMark)&&(Ge=!0,S("length less than watermark",Ge)),qe.ended||qe.reading?(Ge=!1,S("reading or ended",Ge)):Ge&&(S("do read"),qe.reading=!0,qe.sync=!0,qe.length===0&&(qe.needReadable=!0),this._read(qe.highWaterMark),qe.sync=!1,qe.reading||(ke=Se(tt,qe)));var We;return ke>0?We=se(ke,qe):We=null,We===null?(qe.needReadable=qe.length<=qe.highWaterMark,ke=0):(qe.length-=ke,qe.awaitDrain=0),qe.length===0&&(qe.ended||(qe.needReadable=!0),tt!==ke&&qe.ended&&pe(this)),We!==null&&this.emit("data",We),We};function Le(ke,qe){if(S("onEofChunk"),!qe.ended){if(qe.decoder){var tt=qe.decoder.end();tt&&tt.length&&(qe.buffer.push(tt),qe.length+=qe.objectMode?1:tt.length)}qe.ended=!0,qe.sync?Pe(ke):(qe.needReadable=!1,qe.emittedReadable||(qe.emittedReadable=!0,Ee(ke)))}}function Pe(ke){var qe=ke._readableState;S("emitReadable",qe.needReadable,qe.emittedReadable),qe.needReadable=!1,qe.emittedReadable||(S("emitReadable",qe.flowing),qe.emittedReadable=!0,Ui.nextTick(Ee,ke))}function Ee(ke){var qe=ke._readableState;S("emitReadable_",qe.destroyed,qe.length,qe.ended),!qe.destroyed&&(qe.length||qe.ended)&&(ke.emit("readable"),qe.emittedReadable=!1),qe.needReadable=!qe.flowing&&!qe.ended&&qe.length<=qe.highWaterMark,Ae(ke)}function Me(ke,qe){qe.readingMore||(qe.readingMore=!0,Ui.nextTick(He,ke,qe))}function He(ke,qe){for(;!qe.reading&&!qe.ended&&(qe.length<qe.highWaterMark||qe.flowing&&qe.length===0);){var tt=qe.length;if(S("maybeReadMore read 0"),ke.read(0),tt===qe.length)break}qe.readingMore=!1}W.prototype._read=function(ke){U(this,new z("_read()"))},W.prototype.pipe=function(ke,qe){var tt=this,Ge=this._readableState;switch(Ge.pipesCount){case 0:Ge.pipes=ke;break;case 1:Ge.pipes=[Ge.pipes,ke];break;default:Ge.pipes.push(ke);break}Ge.pipesCount+=1,S("pipe count=%d opts=%j",Ge.pipesCount,qe);var We=(!qe||qe.end!==!1)&&ke!==Ui.stdout&&ke!==Ui.stderr,Je=We?ze:wt;Ge.endEmitted?Ui.nextTick(Je):tt.once("end",Je),ke.on("unpipe",it);function it(Ft,Wt){S("onunpipe"),Ft===tt&&Wt&&Wt.hasUnpiped===!1&&(Wt.hasUnpiped=!0,be())}function ze(){S("onend"),ke.end()}var de=nt(tt);ke.on("drain",de);var ve=!1;function be(){S("cleanup"),ke.removeListener("close",le),ke.removeListener("finish",et),ke.removeListener("drain",de),ke.removeListener("error",ge),ke.removeListener("unpipe",it),tt.removeListener("end",ze),tt.removeListener("end",wt),tt.removeListener("data",Oe),ve=!0,Ge.awaitDrain&&(!ke._writableState||ke._writableState.needDrain)&&de()}tt.on("data",Oe);function Oe(Ft){S("ondata");var Wt=ke.write(Ft);S("dest.write",Wt),Wt===!1&&((Ge.pipesCount===1&&Ge.pipes===ke||Ge.pipesCount>1&&_e(Ge.pipes,ke)!==-1)&&!ve&&(S("false write response, pause",Ge.awaitDrain),Ge.awaitDrain++),tt.pause())}function ge(Ft){S("onerror",Ft),wt(),ke.removeListener("error",ge),h(ke,"error")===0&&U(ke,Ft)}Z(ke,"error",ge);function le(){ke.removeListener("finish",et),wt()}ke.once("close",le);function et(){S("onfinish"),ke.removeListener("close",le),wt()}ke.once("finish",et);function wt(){S("unpipe"),tt.unpipe(ke)}return ke.emit("pipe",tt),Ge.flowing||(S("pipe resume"),tt.resume()),ke};function nt(ke){return function(){var tt=ke._readableState;S("pipeOnDrain",tt.awaitDrain),tt.awaitDrain&&tt.awaitDrain--,tt.awaitDrain===0&&h(ke,"data")&&(tt.flowing=!0,Ae(ke))}}W.prototype.unpipe=function(ke){var qe=this._readableState,tt={hasUnpiped:!1};if(qe.pipesCount===0)return this;if(qe.pipesCount===1)return ke&&ke!==qe.pipes?this:(ke||(ke=qe.pipes),qe.pipes=null,qe.pipesCount=0,qe.flowing=!1,ke&&ke.emit("unpipe",this,tt),this);if(!ke){var Ge=qe.pipes,We=qe.pipesCount;qe.pipes=null,qe.pipesCount=0,qe.flowing=!1;for(var Je=0;Je<We;Je++)Ge[Je].emit("unpipe",this,{hasUnpiped:!1});return this}var it=_e(qe.pipes,ke);return it===-1?this:(qe.pipes.splice(it,1),qe.pipesCount-=1,qe.pipesCount===1&&(qe.pipes=qe.pipes[0]),ke.emit("unpipe",this,tt),this)},W.prototype.on=function(ke,qe){var tt=v.prototype.on.call(this,ke,qe),Ge=this._readableState;return ke==="data"?(Ge.readableListening=this.listenerCount("readable")>0,Ge.flowing!==!1&&this.resume()):ke==="readable"&&!Ge.endEmitted&&!Ge.readableListening&&(Ge.readableListening=Ge.needReadable=!0,Ge.flowing=!1,Ge.emittedReadable=!1,S("on readable",Ge.length,Ge.reading),Ge.length?Pe(this):Ge.reading||Ui.nextTick(Fe,this)),tt},W.prototype.addListener=W.prototype.on,W.prototype.removeListener=function(ke,qe){var tt=v.prototype.removeListener.call(this,ke,qe);return ke==="readable"&&Ui.nextTick(ht,this),tt},W.prototype.removeAllListeners=function(ke){var qe=v.prototype.removeAllListeners.apply(this,arguments);return(ke==="readable"||ke===void 0)&&Ui.nextTick(ht,this),qe};function ht(ke){var qe=ke._readableState;qe.readableListening=ke.listenerCount("readable")>0,qe.resumeScheduled&&!qe.paused?qe.flowing=!0:ke.listenerCount("data")>0&&ke.resume()}function Fe(ke){S("readable nexttick read 0"),ke.read(0)}W.prototype.resume=function(){var ke=this._readableState;return ke.flowing||(S("resume"),ke.flowing=!ke.readableListening,Ce(this,ke)),ke.paused=!1,this};function Ce(ke,qe){qe.resumeScheduled||(qe.resumeScheduled=!0,Ui.nextTick(Be,ke,qe))}function Be(ke,qe){S("resume",qe.reading),qe.reading||ke.read(0),qe.resumeScheduled=!1,ke.emit("resume"),Ae(ke),qe.flowing&&!qe.reading&&ke.read(0)}W.prototype.pause=function(){return S("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(S("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function Ae(ke){var qe=ke._readableState;for(S("flow",qe.flowing);qe.flowing&&ke.read()!==null;);}W.prototype.wrap=function(ke){var qe=this,tt=this._readableState,Ge=!1;ke.on("end",function(){if(S("wrapped end"),tt.decoder&&!tt.ended){var it=tt.decoder.end();it&&it.length&&qe.push(it)}qe.push(null)}),ke.on("data",function(it){if(S("wrapped data"),tt.decoder&&(it=tt.decoder.write(it)),!(tt.objectMode&&it==null)&&!(!tt.objectMode&&(!it||!it.length))){var ze=qe.push(it);ze||(Ge=!0,ke.pause())}});for(var We in ke)this[We]===void 0&&typeof ke[We]=="function"&&(this[We]=function(ze){return function(){return ke[ze].apply(ke,arguments)}}(We));for(var Je=0;Je<G.length;Je++)ke.on(G[Je],this.emit.bind(this,G[Je]));return this._read=function(it){S("wrapped _read",it),Ge&&(Ge=!1,ke.resume())},this},typeof Symbol=="function"&&(W.prototype[Symbol.asyncIterator]=function(){return x===void 0&&(x=TP()),x(this)}),Object.defineProperty(W.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(W.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(W.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(qe){this._readableState&&(this._readableState.flowing=qe)}}),W._fromList=se,Object.defineProperty(W.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function se(ke,qe){if(qe.length===0)return null;var tt;return qe.objectMode?tt=qe.buffer.shift():!ke||ke>=qe.length?(qe.decoder?tt=qe.buffer.join(""):qe.buffer.length===1?tt=qe.buffer.first():tt=qe.buffer.concat(qe.length),qe.buffer.clear()):tt=qe.buffer.consume(ke,qe.decoder),tt}function pe(ke){var qe=ke._readableState;S("endReadable",qe.endEmitted),qe.endEmitted||(qe.ended=!0,Ui.nextTick(Ke,qe,ke))}function Ke(ke,qe){if(S("endReadableNT",ke.endEmitted,ke.length),!ke.endEmitted&&ke.length===0&&(ke.endEmitted=!0,qe.readable=!1,qe.emit("end"),ke.autoDestroy)){var tt=qe._writableState;(!tt||tt.autoDestroy&&tt.finished)&&qe.destroy()}}typeof Symbol=="function"&&(W.from=function(ke,qe){return O===void 0&&(O=SP()),O(W,ke,qe)});function _e(ke,qe){for(var tt=0,Ge=ke.length;tt<Ge;tt++)if(ke[tt]===qe)return tt;return-1}return fy}var dy,rE;function AT(){if(rE)return dy;rE=1,dy=t;var a=Nc().codes,h=a.ERR_METHOD_NOT_IMPLEMENTED,v=a.ERR_MULTIPLE_CALLBACK,_=a.ERR_TRANSFORM_ALREADY_TRANSFORMING,k=a.ERR_TRANSFORM_WITH_LENGTH_0,b=Bc();uu()(t,b);function T(w,E){var m=this._transformState;m.transforming=!1;var y=m.writecb;if(y===null)return this.emit("error",new v);m.writechunk=null,m.writecb=null,E!=null&&this.push(E),y(w);var p=this._readableState;p.reading=!1,(p.needReadable||p.length<p.highWaterMark)&&this._read(p.highWaterMark)}function t(w){if(!(this instanceof t))return new t(w);b.call(this,w),this._transformState={afterTransform:T.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,w&&(typeof w.transform=="function"&&(this._transform=w.transform),typeof w.flush=="function"&&(this._flush=w.flush)),this.on("prefinish",S)}function S(){var w=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(E,m){D(w,E,m)}):D(this,null,null)}t.prototype.push=function(w,E){return this._transformState.needTransform=!1,b.prototype.push.call(this,w,E)},t.prototype._transform=function(w,E,m){m(new h("_transform()"))},t.prototype._write=function(w,E,m){var y=this._transformState;if(y.writecb=m,y.writechunk=w,y.writeencoding=E,!y.transforming){var p=this._readableState;(y.needTransform||p.needReadable||p.length<p.highWaterMark)&&this._read(p.highWaterMark)}},t.prototype._read=function(w){var E=this._transformState;E.writechunk!==null&&!E.transforming?(E.transforming=!0,this._transform(E.writechunk,E.writeencoding,E.afterTransform)):E.needTransform=!0},t.prototype._destroy=function(w,E){b.prototype._destroy.call(this,w,function(m){E(m)})};function D(w,E,m){if(E)return w.emit("error",E);if(m!=null&&w.push(m),w._writableState.length)throw new k;if(w._transformState.transforming)throw new _;return w.push(null)}return dy}var py,iE;function MP(){if(iE)return py;iE=1,py=h;var a=AT();uu()(h,a);function h(v){if(!(this instanceof h))return new h(v);a.call(this,v)}return h.prototype._transform=function(v,_,k){k(null,v)},py}var my,nE;function AP(){if(nE)return my;nE=1;var a;function h(m){var y=!1;return function(){y||(y=!0,m.apply(void 0,arguments))}}var v=Nc().codes,_=v.ERR_MISSING_ARGS,k=v.ERR_STREAM_DESTROYED;function b(m){if(m)throw m}function T(m){return m.setHeader&&typeof m.abort=="function"}function t(m,y,p,C){C=h(C);var z=!1;m.on("close",function(){z=!0}),a===void 0&&(a=_1()),a(m,{readable:y,writable:p},function(P){if(P)return C(P);z=!0,C()});var A=!1;return function(P){if(!z&&!A){if(A=!0,T(m))return m.abort();if(typeof m.destroy=="function")return m.destroy();C(P||new k("pipe"))}}}function S(m){m()}function D(m,y){return m.pipe(y)}function w(m){return!m.length||typeof m[m.length-1]!="function"?b:m.pop()}function E(){for(var m=arguments.length,y=new Array(m),p=0;p<m;p++)y[p]=arguments[p];var C=w(y);if(Array.isArray(y[0])&&(y=y[0]),y.length<2)throw new _("streams");var z,A=y.map(function(P,x){var O=x<y.length-1,U=x>0;return t(P,O,U,function(G){z||(z=G),G&&A.forEach(S),!O&&(A.forEach(S),C(z))})});return y.reduce(D)}return my=E,my}var _y,aE;function IP(){if(aE)return _y;aE=1,_y=v;var a=rm().EventEmitter,h=uu();h(v,a),v.Readable=MT(),v.Writable=ST(),v.Duplex=Bc(),v.Transform=AT(),v.PassThrough=MP(),v.finished=_1(),v.pipeline=AP(),v.Stream=v;function v(){a.call(this)}return v.prototype.pipe=function(_,k){var b=this;function T(y){_.writable&&_.write(y)===!1&&b.pause&&b.pause()}b.on("data",T);function t(){b.readable&&b.resume&&b.resume()}_.on("drain",t),!_._isStdio&&(!k||k.end!==!1)&&(b.on("end",D),b.on("close",w));var S=!1;function D(){S||(S=!0,_.end())}function w(){S||(S=!0,typeof _.destroy=="function"&&_.destroy())}function E(y){if(m(),a.listenerCount(this,"error")===0)throw y}b.on("error",E),_.on("error",E);function m(){b.removeListener("data",T),_.removeListener("drain",t),b.removeListener("end",D),b.removeListener("close",w),b.removeListener("error",E),_.removeListener("error",E),b.removeListener("end",m),b.removeListener("close",m),_.removeListener("close",m)}return b.on("end",m),b.on("close",m),_.on("close",m),_.emit("pipe",b),_},_y}var oE;function PP(){return oE||(oE=1,function(a){(function(h){h.parser=function(se,pe){return new _(se,pe)},h.SAXParser=_,h.SAXStream=w,h.createStream=D,h.MAX_BUFFER_LENGTH=64*1024;var v=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];h.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function _(se,pe){if(!(this instanceof _))return new _(se,pe);var Ke=this;b(Ke),Ke.q=Ke.c="",Ke.bufferCheckPosition=h.MAX_BUFFER_LENGTH,Ke.opt=pe||{},Ke.opt.lowercase=Ke.opt.lowercase||Ke.opt.lowercasetags,Ke.looseCase=Ke.opt.lowercase?"toLowerCase":"toUpperCase",Ke.tags=[],Ke.closed=Ke.closedRoot=Ke.sawRoot=!1,Ke.tag=Ke.error=null,Ke.strict=!!se,Ke.noscript=!!(se||Ke.opt.noscript),Ke.state=W.BEGIN,Ke.strictEntities=Ke.opt.strictEntities,Ke.ENTITIES=Ke.strictEntities?Object.create(h.XML_ENTITIES):Object.create(h.ENTITIES),Ke.attribList=[],Ke.opt.xmlns&&(Ke.ns=Object.create(C)),Ke.opt.unquotedAttributeValues===void 0&&(Ke.opt.unquotedAttributeValues=!se),Ke.trackPosition=Ke.opt.position!==!1,Ke.trackPosition&&(Ke.position=Ke.line=Ke.column=0),re(Ke,"onready")}Object.create||(Object.create=function(se){function pe(){}pe.prototype=se;var Ke=new pe;return Ke}),Object.keys||(Object.keys=function(se){var pe=[];for(var Ke in se)se.hasOwnProperty(Ke)&&pe.push(Ke);return pe});function k(se){for(var pe=Math.max(h.MAX_BUFFER_LENGTH,10),Ke=0,_e=0,ke=v.length;_e<ke;_e++){var qe=se[v[_e]].length;if(qe>pe)switch(v[_e]){case"textNode":ye(se);break;case"cdata":te(se,"oncdata",se.cdata),se.cdata="";break;case"script":te(se,"onscript",se.script),se.script="";break;default:Se(se,"Max buffer length exceeded: "+v[_e])}Ke=Math.max(Ke,qe)}var tt=h.MAX_BUFFER_LENGTH-Ke;se.bufferCheckPosition=tt+se.position}function b(se){for(var pe=0,Ke=v.length;pe<Ke;pe++)se[v[pe]]=""}function T(se){ye(se),se.cdata!==""&&(te(se,"oncdata",se.cdata),se.cdata=""),se.script!==""&&(te(se,"onscript",se.script),se.script="")}_.prototype={end:function(){Le(this)},write:Ae,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){T(this)}};var t;try{t=IP().Stream}catch{t=function(){}}t||(t=function(){});var S=h.EVENTS.filter(function(se){return se!=="error"&&se!=="end"});function D(se,pe){return new w(se,pe)}function w(se,pe){if(!(this instanceof w))return new w(se,pe);t.apply(this),this._parser=new _(se,pe),this.writable=!0,this.readable=!0;var Ke=this;this._parser.onend=function(){Ke.emit("end")},this._parser.onerror=function(_e){Ke.emit("error",_e),Ke._parser.error=null},this._decoder=null,S.forEach(function(_e){Object.defineProperty(Ke,"on"+_e,{get:function(){return Ke._parser["on"+_e]},set:function(ke){if(!ke)return Ke.removeAllListeners(_e),Ke._parser["on"+_e]=ke,ke;Ke.on(_e,ke)},enumerable:!0,configurable:!1})})}w.prototype=Object.create(t.prototype,{constructor:{value:w}}),w.prototype.write=function(se){if(typeof Jg=="function"&&typeof Jg.isBuffer=="function"&&Jg.isBuffer(se)){if(!this._decoder){var pe=Py().StringDecoder;this._decoder=new pe("utf8")}se=this._decoder.write(se)}return this._parser.write(se.toString()),this.emit("data",se),!0},w.prototype.end=function(se){return se&&se.length&&this.write(se),this._parser.end(),!0},w.prototype.on=function(se,pe){var Ke=this;return!Ke._parser["on"+se]&&S.indexOf(se)!==-1&&(Ke._parser["on"+se]=function(){var _e=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);_e.splice(0,0,se),Ke.emit.apply(Ke,_e)}),t.prototype.on.call(Ke,se,pe)};var E="[CDATA[",m="DOCTYPE",y="http://www.w3.org/XML/1998/namespace",p="http://www.w3.org/2000/xmlns/",C={xml:y,xmlns:p},z=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,A=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,P=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,x=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function O(se){return se===" "||se===`
`||se==="\r"||se==="	"}function U(se){return se==='"'||se==="'"}function G(se){return se===">"||O(se)}function Z(se,pe){return se.test(pe)}function X(se,pe){return!Z(se,pe)}var W=0;h.STATE={BEGIN:W++,BEGIN_WHITESPACE:W++,TEXT:W++,TEXT_ENTITY:W++,OPEN_WAKA:W++,SGML_DECL:W++,SGML_DECL_QUOTED:W++,DOCTYPE:W++,DOCTYPE_QUOTED:W++,DOCTYPE_DTD:W++,DOCTYPE_DTD_QUOTED:W++,COMMENT_STARTING:W++,COMMENT:W++,COMMENT_ENDING:W++,COMMENT_ENDED:W++,CDATA:W++,CDATA_ENDING:W++,CDATA_ENDING_2:W++,PROC_INST:W++,PROC_INST_BODY:W++,PROC_INST_ENDING:W++,OPEN_TAG:W++,OPEN_TAG_SLASH:W++,ATTRIB:W++,ATTRIB_NAME:W++,ATTRIB_NAME_SAW_WHITE:W++,ATTRIB_VALUE:W++,ATTRIB_VALUE_QUOTED:W++,ATTRIB_VALUE_CLOSED:W++,ATTRIB_VALUE_UNQUOTED:W++,ATTRIB_VALUE_ENTITY_Q:W++,ATTRIB_VALUE_ENTITY_U:W++,CLOSE_TAG:W++,CLOSE_TAG_SAW_WHITE:W++,SCRIPT:W++,SCRIPT_ENDING:W++},h.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},h.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(h.ENTITIES).forEach(function(se){var pe=h.ENTITIES[se],Ke=typeof pe=="number"?String.fromCharCode(pe):pe;h.ENTITIES[se]=Ke});for(var J in h.STATE)h.STATE[h.STATE[J]]=J;W=h.STATE;function re(se,pe,Ke){se[pe]&&se[pe](Ke)}function te(se,pe,Ke){se.textNode&&ye(se),re(se,pe,Ke)}function ye(se){se.textNode=ue(se.opt,se.textNode),se.textNode&&re(se,"ontext",se.textNode),se.textNode=""}function ue(se,pe){return se.trim&&(pe=pe.trim()),se.normalize&&(pe=pe.replace(/\s+/g," ")),pe}function Se(se,pe){return ye(se),se.trackPosition&&(pe+=`
Line: `+se.line+`
Column: `+se.column+`
Char: `+se.c),pe=new Error(pe),se.error=pe,re(se,"onerror",pe),se}function Le(se){return se.sawRoot&&!se.closedRoot&&Pe(se,"Unclosed root tag"),se.state!==W.BEGIN&&se.state!==W.BEGIN_WHITESPACE&&se.state!==W.TEXT&&Se(se,"Unexpected end"),ye(se),se.c="",se.closed=!0,re(se,"onend"),_.call(se,se.strict,se.opt),se}function Pe(se,pe){if(typeof se!="object"||!(se instanceof _))throw new Error("bad call to strictFail");se.strict&&Se(se,pe)}function Ee(se){se.strict||(se.tagName=se.tagName[se.looseCase]());var pe=se.tags[se.tags.length-1]||se,Ke=se.tag={name:se.tagName,attributes:{}};se.opt.xmlns&&(Ke.ns=pe.ns),se.attribList.length=0,te(se,"onopentagstart",Ke)}function Me(se,pe){var Ke=se.indexOf(":"),_e=Ke<0?["",se]:se.split(":"),ke=_e[0],qe=_e[1];return pe&&se==="xmlns"&&(ke="xmlns",qe=""),{prefix:ke,local:qe}}function He(se){if(se.strict||(se.attribName=se.attribName[se.looseCase]()),se.attribList.indexOf(se.attribName)!==-1||se.tag.attributes.hasOwnProperty(se.attribName)){se.attribName=se.attribValue="";return}if(se.opt.xmlns){var pe=Me(se.attribName,!0),Ke=pe.prefix,_e=pe.local;if(Ke==="xmlns")if(_e==="xml"&&se.attribValue!==y)Pe(se,"xml: prefix must be bound to "+y+`
Actual: `+se.attribValue);else if(_e==="xmlns"&&se.attribValue!==p)Pe(se,"xmlns: prefix must be bound to "+p+`
Actual: `+se.attribValue);else{var ke=se.tag,qe=se.tags[se.tags.length-1]||se;ke.ns===qe.ns&&(ke.ns=Object.create(qe.ns)),ke.ns[_e]=se.attribValue}se.attribList.push([se.attribName,se.attribValue])}else se.tag.attributes[se.attribName]=se.attribValue,te(se,"onattribute",{name:se.attribName,value:se.attribValue});se.attribName=se.attribValue=""}function nt(se,pe){if(se.opt.xmlns){var Ke=se.tag,_e=Me(se.tagName);Ke.prefix=_e.prefix,Ke.local=_e.local,Ke.uri=Ke.ns[_e.prefix]||"",Ke.prefix&&!Ke.uri&&(Pe(se,"Unbound namespace prefix: "+JSON.stringify(se.tagName)),Ke.uri=_e.prefix);var ke=se.tags[se.tags.length-1]||se;Ke.ns&&ke.ns!==Ke.ns&&Object.keys(Ke.ns).forEach(function(Oe){te(se,"onopennamespace",{prefix:Oe,uri:Ke.ns[Oe]})});for(var qe=0,tt=se.attribList.length;qe<tt;qe++){var Ge=se.attribList[qe],We=Ge[0],Je=Ge[1],it=Me(We,!0),ze=it.prefix,de=it.local,ve=ze===""?"":Ke.ns[ze]||"",be={name:We,value:Je,prefix:ze,local:de,uri:ve};ze&&ze!=="xmlns"&&!ve&&(Pe(se,"Unbound namespace prefix: "+JSON.stringify(ze)),be.uri=ze),se.tag.attributes[We]=be,te(se,"onattribute",be)}se.attribList.length=0}se.tag.isSelfClosing=!!pe,se.sawRoot=!0,se.tags.push(se.tag),te(se,"onopentag",se.tag),pe||(!se.noscript&&se.tagName.toLowerCase()==="script"?se.state=W.SCRIPT:se.state=W.TEXT,se.tag=null,se.tagName=""),se.attribName=se.attribValue="",se.attribList.length=0}function ht(se){if(!se.tagName){Pe(se,"Weird empty close tag."),se.textNode+="</>",se.state=W.TEXT;return}if(se.script){if(se.tagName!=="script"){se.script+="</"+se.tagName+">",se.tagName="",se.state=W.SCRIPT;return}te(se,"onscript",se.script),se.script=""}var pe=se.tags.length,Ke=se.tagName;se.strict||(Ke=Ke[se.looseCase]());for(var _e=Ke;pe--;){var ke=se.tags[pe];if(ke.name!==_e)Pe(se,"Unexpected close tag");else break}if(pe<0){Pe(se,"Unmatched closing tag: "+se.tagName),se.textNode+="</"+se.tagName+">",se.state=W.TEXT;return}se.tagName=Ke;for(var qe=se.tags.length;qe-- >pe;){var tt=se.tag=se.tags.pop();se.tagName=se.tag.name,te(se,"onclosetag",se.tagName);var Ge={};for(var We in tt.ns)Ge[We]=tt.ns[We];var Je=se.tags[se.tags.length-1]||se;se.opt.xmlns&&tt.ns!==Je.ns&&Object.keys(tt.ns).forEach(function(it){var ze=tt.ns[it];te(se,"onclosenamespace",{prefix:it,uri:ze})})}pe===0&&(se.closedRoot=!0),se.tagName=se.attribValue=se.attribName="",se.attribList.length=0,se.state=W.TEXT}function Fe(se){var pe=se.entity,Ke=pe.toLowerCase(),_e,ke="";return se.ENTITIES[pe]?se.ENTITIES[pe]:se.ENTITIES[Ke]?se.ENTITIES[Ke]:(pe=Ke,pe.charAt(0)==="#"&&(pe.charAt(1)==="x"?(pe=pe.slice(2),_e=parseInt(pe,16),ke=_e.toString(16)):(pe=pe.slice(1),_e=parseInt(pe,10),ke=_e.toString(10))),pe=pe.replace(/^0+/,""),isNaN(_e)||ke.toLowerCase()!==pe?(Pe(se,"Invalid character entity"),"&"+se.entity+";"):String.fromCodePoint(_e))}function Ce(se,pe){pe==="<"?(se.state=W.OPEN_WAKA,se.startTagPosition=se.position):O(pe)||(Pe(se,"Non-whitespace before first tag."),se.textNode=pe,se.state=W.TEXT)}function Be(se,pe){var Ke="";return pe<se.length&&(Ke=se.charAt(pe)),Ke}function Ae(se){var pe=this;if(this.error)throw this.error;if(pe.closed)return Se(pe,"Cannot write after close. Assign an onready handler.");if(se===null)return Le(pe);typeof se=="object"&&(se=se.toString());for(var Ke=0,_e="";_e=Be(se,Ke++),pe.c=_e,!!_e;)switch(pe.trackPosition&&(pe.position++,_e===`
`?(pe.line++,pe.column=0):pe.column++),pe.state){case W.BEGIN:if(pe.state=W.BEGIN_WHITESPACE,_e==="\uFEFF")continue;Ce(pe,_e);continue;case W.BEGIN_WHITESPACE:Ce(pe,_e);continue;case W.TEXT:if(pe.sawRoot&&!pe.closedRoot){for(var ke=Ke-1;_e&&_e!=="<"&&_e!=="&";)_e=Be(se,Ke++),_e&&pe.trackPosition&&(pe.position++,_e===`
`?(pe.line++,pe.column=0):pe.column++);pe.textNode+=se.substring(ke,Ke-1)}_e==="<"&&!(pe.sawRoot&&pe.closedRoot&&!pe.strict)?(pe.state=W.OPEN_WAKA,pe.startTagPosition=pe.position):(!O(_e)&&(!pe.sawRoot||pe.closedRoot)&&Pe(pe,"Text data outside of root node."),_e==="&"?pe.state=W.TEXT_ENTITY:pe.textNode+=_e);continue;case W.SCRIPT:_e==="<"?pe.state=W.SCRIPT_ENDING:pe.script+=_e;continue;case W.SCRIPT_ENDING:_e==="/"?pe.state=W.CLOSE_TAG:(pe.script+="<"+_e,pe.state=W.SCRIPT);continue;case W.OPEN_WAKA:if(_e==="!")pe.state=W.SGML_DECL,pe.sgmlDecl="";else if(!O(_e))if(Z(z,_e))pe.state=W.OPEN_TAG,pe.tagName=_e;else if(_e==="/")pe.state=W.CLOSE_TAG,pe.tagName="";else if(_e==="?")pe.state=W.PROC_INST,pe.procInstName=pe.procInstBody="";else{if(Pe(pe,"Unencoded <"),pe.startTagPosition+1<pe.position){var qe=pe.position-pe.startTagPosition;_e=new Array(qe).join(" ")+_e}pe.textNode+="<"+_e,pe.state=W.TEXT}continue;case W.SGML_DECL:if(pe.sgmlDecl+_e==="--"){pe.state=W.COMMENT,pe.comment="",pe.sgmlDecl="";continue}pe.doctype&&pe.doctype!==!0&&pe.sgmlDecl?(pe.state=W.DOCTYPE_DTD,pe.doctype+="<!"+pe.sgmlDecl+_e,pe.sgmlDecl=""):(pe.sgmlDecl+_e).toUpperCase()===E?(te(pe,"onopencdata"),pe.state=W.CDATA,pe.sgmlDecl="",pe.cdata=""):(pe.sgmlDecl+_e).toUpperCase()===m?(pe.state=W.DOCTYPE,(pe.doctype||pe.sawRoot)&&Pe(pe,"Inappropriately located doctype declaration"),pe.doctype="",pe.sgmlDecl=""):_e===">"?(te(pe,"onsgmldeclaration",pe.sgmlDecl),pe.sgmlDecl="",pe.state=W.TEXT):(U(_e)&&(pe.state=W.SGML_DECL_QUOTED),pe.sgmlDecl+=_e);continue;case W.SGML_DECL_QUOTED:_e===pe.q&&(pe.state=W.SGML_DECL,pe.q=""),pe.sgmlDecl+=_e;continue;case W.DOCTYPE:_e===">"?(pe.state=W.TEXT,te(pe,"ondoctype",pe.doctype),pe.doctype=!0):(pe.doctype+=_e,_e==="["?pe.state=W.DOCTYPE_DTD:U(_e)&&(pe.state=W.DOCTYPE_QUOTED,pe.q=_e));continue;case W.DOCTYPE_QUOTED:pe.doctype+=_e,_e===pe.q&&(pe.q="",pe.state=W.DOCTYPE);continue;case W.DOCTYPE_DTD:_e==="]"?(pe.doctype+=_e,pe.state=W.DOCTYPE):_e==="<"?(pe.state=W.OPEN_WAKA,pe.startTagPosition=pe.position):U(_e)?(pe.doctype+=_e,pe.state=W.DOCTYPE_DTD_QUOTED,pe.q=_e):pe.doctype+=_e;continue;case W.DOCTYPE_DTD_QUOTED:pe.doctype+=_e,_e===pe.q&&(pe.state=W.DOCTYPE_DTD,pe.q="");continue;case W.COMMENT:_e==="-"?pe.state=W.COMMENT_ENDING:pe.comment+=_e;continue;case W.COMMENT_ENDING:_e==="-"?(pe.state=W.COMMENT_ENDED,pe.comment=ue(pe.opt,pe.comment),pe.comment&&te(pe,"oncomment",pe.comment),pe.comment=""):(pe.comment+="-"+_e,pe.state=W.COMMENT);continue;case W.COMMENT_ENDED:_e!==">"?(Pe(pe,"Malformed comment"),pe.comment+="--"+_e,pe.state=W.COMMENT):pe.doctype&&pe.doctype!==!0?pe.state=W.DOCTYPE_DTD:pe.state=W.TEXT;continue;case W.CDATA:_e==="]"?pe.state=W.CDATA_ENDING:pe.cdata+=_e;continue;case W.CDATA_ENDING:_e==="]"?pe.state=W.CDATA_ENDING_2:(pe.cdata+="]"+_e,pe.state=W.CDATA);continue;case W.CDATA_ENDING_2:_e===">"?(pe.cdata&&te(pe,"oncdata",pe.cdata),te(pe,"onclosecdata"),pe.cdata="",pe.state=W.TEXT):_e==="]"?pe.cdata+="]":(pe.cdata+="]]"+_e,pe.state=W.CDATA);continue;case W.PROC_INST:_e==="?"?pe.state=W.PROC_INST_ENDING:O(_e)?pe.state=W.PROC_INST_BODY:pe.procInstName+=_e;continue;case W.PROC_INST_BODY:if(!pe.procInstBody&&O(_e))continue;_e==="?"?pe.state=W.PROC_INST_ENDING:pe.procInstBody+=_e;continue;case W.PROC_INST_ENDING:_e===">"?(te(pe,"onprocessinginstruction",{name:pe.procInstName,body:pe.procInstBody}),pe.procInstName=pe.procInstBody="",pe.state=W.TEXT):(pe.procInstBody+="?"+_e,pe.state=W.PROC_INST_BODY);continue;case W.OPEN_TAG:Z(A,_e)?pe.tagName+=_e:(Ee(pe),_e===">"?nt(pe):_e==="/"?pe.state=W.OPEN_TAG_SLASH:(O(_e)||Pe(pe,"Invalid character in tag name"),pe.state=W.ATTRIB));continue;case W.OPEN_TAG_SLASH:_e===">"?(nt(pe,!0),ht(pe)):(Pe(pe,"Forward-slash in opening tag not followed by >"),pe.state=W.ATTRIB);continue;case W.ATTRIB:if(O(_e))continue;_e===">"?nt(pe):_e==="/"?pe.state=W.OPEN_TAG_SLASH:Z(z,_e)?(pe.attribName=_e,pe.attribValue="",pe.state=W.ATTRIB_NAME):Pe(pe,"Invalid attribute name");continue;case W.ATTRIB_NAME:_e==="="?pe.state=W.ATTRIB_VALUE:_e===">"?(Pe(pe,"Attribute without value"),pe.attribValue=pe.attribName,He(pe),nt(pe)):O(_e)?pe.state=W.ATTRIB_NAME_SAW_WHITE:Z(A,_e)?pe.attribName+=_e:Pe(pe,"Invalid attribute name");continue;case W.ATTRIB_NAME_SAW_WHITE:if(_e==="=")pe.state=W.ATTRIB_VALUE;else{if(O(_e))continue;Pe(pe,"Attribute without value"),pe.tag.attributes[pe.attribName]="",pe.attribValue="",te(pe,"onattribute",{name:pe.attribName,value:""}),pe.attribName="",_e===">"?nt(pe):Z(z,_e)?(pe.attribName=_e,pe.state=W.ATTRIB_NAME):(Pe(pe,"Invalid attribute name"),pe.state=W.ATTRIB)}continue;case W.ATTRIB_VALUE:if(O(_e))continue;U(_e)?(pe.q=_e,pe.state=W.ATTRIB_VALUE_QUOTED):(pe.opt.unquotedAttributeValues||Se(pe,"Unquoted attribute value"),pe.state=W.ATTRIB_VALUE_UNQUOTED,pe.attribValue=_e);continue;case W.ATTRIB_VALUE_QUOTED:if(_e!==pe.q){_e==="&"?pe.state=W.ATTRIB_VALUE_ENTITY_Q:pe.attribValue+=_e;continue}He(pe),pe.q="",pe.state=W.ATTRIB_VALUE_CLOSED;continue;case W.ATTRIB_VALUE_CLOSED:O(_e)?pe.state=W.ATTRIB:_e===">"?nt(pe):_e==="/"?pe.state=W.OPEN_TAG_SLASH:Z(z,_e)?(Pe(pe,"No whitespace between attributes"),pe.attribName=_e,pe.attribValue="",pe.state=W.ATTRIB_NAME):Pe(pe,"Invalid attribute name");continue;case W.ATTRIB_VALUE_UNQUOTED:if(!G(_e)){_e==="&"?pe.state=W.ATTRIB_VALUE_ENTITY_U:pe.attribValue+=_e;continue}He(pe),_e===">"?nt(pe):pe.state=W.ATTRIB;continue;case W.CLOSE_TAG:if(pe.tagName)_e===">"?ht(pe):Z(A,_e)?pe.tagName+=_e:pe.script?(pe.script+="</"+pe.tagName,pe.tagName="",pe.state=W.SCRIPT):(O(_e)||Pe(pe,"Invalid tagname in closing tag"),pe.state=W.CLOSE_TAG_SAW_WHITE);else{if(O(_e))continue;X(z,_e)?pe.script?(pe.script+="</"+_e,pe.state=W.SCRIPT):Pe(pe,"Invalid tagname in closing tag."):pe.tagName=_e}continue;case W.CLOSE_TAG_SAW_WHITE:if(O(_e))continue;_e===">"?ht(pe):Pe(pe,"Invalid characters in closing tag");continue;case W.TEXT_ENTITY:case W.ATTRIB_VALUE_ENTITY_Q:case W.ATTRIB_VALUE_ENTITY_U:var tt,Ge;switch(pe.state){case W.TEXT_ENTITY:tt=W.TEXT,Ge="textNode";break;case W.ATTRIB_VALUE_ENTITY_Q:tt=W.ATTRIB_VALUE_QUOTED,Ge="attribValue";break;case W.ATTRIB_VALUE_ENTITY_U:tt=W.ATTRIB_VALUE_UNQUOTED,Ge="attribValue";break}if(_e===";"){var We=Fe(pe);pe.opt.unparsedEntities&&!Object.values(h.XML_ENTITIES).includes(We)?(pe.entity="",pe.state=tt,pe.write(We)):(pe[Ge]+=We,pe.entity="",pe.state=tt)}else Z(pe.entity.length?x:P,_e)?pe.entity+=_e:(Pe(pe,"Invalid character in entity name"),pe[Ge]+="&"+pe.entity+_e,pe.entity="",pe.state=tt);continue;default:throw new Error(pe,"Unknown state: "+pe.state)}return pe.position>=pe.bufferCheckPosition&&k(pe),pe}/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */String.fromCodePoint||function(){var se=String.fromCharCode,pe=Math.floor,Ke=function(){var _e=16384,ke=[],qe,tt,Ge=-1,We=arguments.length;if(!We)return"";for(var Je="";++Ge<We;){var it=Number(arguments[Ge]);if(!isFinite(it)||it<0||it>1114111||pe(it)!==it)throw RangeError("Invalid code point: "+it);it<=65535?ke.push(it):(it-=65536,qe=(it>>10)+55296,tt=it%1024+56320,ke.push(qe,tt)),(Ge+1===We||ke.length>_e)&&(Je+=se.apply(null,ke),ke.length=0)}return Je};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:Ke,configurable:!0,writable:!0}):String.fromCodePoint=Ke}()})(a)}(Qg)),Qg}var gy={},sE;function CP(){return sE||(sE=1,function(){gy.stripBOM=function(a){return a[0]==="\uFEFF"?a.substring(1):a}}.call(Hr)),gy}var nu={},lE;function IT(){return lE||(lE=1,function(){var a;a=new RegExp(/(?!xmlns)^.*:/),nu.normalize=function(h){return h.toLowerCase()},nu.firstCharLowerCase=function(h){return h.charAt(0).toLowerCase()+h.slice(1)},nu.stripPrefix=function(h){return h.replace(a,"")},nu.parseNumbers=function(h){return isNaN(h)||(h=h%1===0?parseInt(h,10):parseFloat(h)),h},nu.parseBooleans=function(h){return/^(?:true|false)$/i.test(h)&&(h=h.toLowerCase()==="true"),h}}.call(Hr)),nu}var eo={},uE={},cE;function RP(){return cE||(cE=1,function(a,h){if(a.setImmediate)return;var v=1,_={},k=!1,b=a.document,T;function t(P){typeof P!="function"&&(P=new Function(""+P));for(var x=new Array(arguments.length-1),O=0;O<x.length;O++)x[O]=arguments[O+1];var U={callback:P,args:x};return _[v]=U,T(v),v++}function S(P){delete _[P]}function D(P){var x=P.callback,O=P.args;switch(O.length){case 0:x();break;case 1:x(O[0]);break;case 2:x(O[0],O[1]);break;case 3:x(O[0],O[1],O[2]);break;default:x.apply(h,O);break}}function w(P){if(k)setTimeout(w,0,P);else{var x=_[P];if(x){k=!0;try{D(x)}finally{S(P),k=!1}}}}function E(){T=function(P){Ui.nextTick(function(){w(P)})}}function m(){if(a.postMessage&&!a.importScripts){var P=!0,x=a.onmessage;return a.onmessage=function(){P=!1},a.postMessage("","*"),a.onmessage=x,P}}function y(){var P="setImmediate$"+Math.random()+"$",x=function(O){O.source===a&&typeof O.data=="string"&&O.data.indexOf(P)===0&&w(+O.data.slice(P.length))};a.addEventListener?a.addEventListener("message",x,!1):a.attachEvent("onmessage",x),T=function(O){a.postMessage(P+O,"*")}}function p(){var P=new MessageChannel;P.port1.onmessage=function(x){var O=x.data;w(O)},T=function(x){P.port2.postMessage(x)}}function C(){var P=b.documentElement;T=function(x){var O=b.createElement("script");O.onreadystatechange=function(){w(x),O.onreadystatechange=null,P.removeChild(O),O=null},P.appendChild(O)}}function z(){T=function(P){setTimeout(w,0,P)}}var A=Object.getPrototypeOf&&Object.getPrototypeOf(a);A=A&&A.setTimeout?A:a,{}.toString.call(a.process)==="[object process]"?E():m()?y():a.MessageChannel?p():b&&"onreadystatechange"in b.createElement("script")?C():z(),A.setImmediate=t,A.clearImmediate=S}(typeof self>"u"?Hr:self)),uE}var hE;function DP(){if(hE)return eo;hE=1;var a=typeof Hr<"u"&&Hr||typeof self<"u"&&self||window,h=Function.prototype.apply;eo.setTimeout=function(){return new v(h.call(setTimeout,a,arguments),clearTimeout)},eo.setInterval=function(){return new v(h.call(setInterval,a,arguments),clearInterval)},eo.clearTimeout=eo.clearInterval=function(_){_&&_.close()};function v(_,k){this._id=_,this._clearFn=k}return v.prototype.unref=v.prototype.ref=function(){},v.prototype.close=function(){this._clearFn.call(a,this._id)},eo.enroll=function(_,k){clearTimeout(_._idleTimeoutId),_._idleTimeout=k},eo.unenroll=function(_){clearTimeout(_._idleTimeoutId),_._idleTimeout=-1},eo._unrefActive=eo.active=function(_){clearTimeout(_._idleTimeoutId);var k=_._idleTimeout;k>=0&&(_._idleTimeoutId=setTimeout(function(){_._onTimeout&&_._onTimeout()},k))},RP(),eo.setImmediate=typeof self<"u"&&self.setImmediate||typeof Hr<"u"&&Hr.setImmediate||Hr&&Hr.setImmediate,eo.clearImmediate=typeof self<"u"&&self.clearImmediate||typeof Hr<"u"&&Hr.clearImmediate||Hr&&Hr.clearImmediate,eo}var fE;function LP(){return fE||(fE=1,function(a){(function(){var h,v,_,k,b,T,t,S,D=function(m,y){return function(){return m.apply(y,arguments)}},w=function(m,y){for(var p in y)E.call(y,p)&&(m[p]=y[p]);function C(){this.constructor=m}return C.prototype=y.prototype,m.prototype=new C,m.__super__=y.prototype,m},E={}.hasOwnProperty;t=PP(),_=rm(),h=CP(),T=IT(),S=DP().setImmediate,v=Jy().defaults,k=function(m){return typeof m=="object"&&m!=null&&Object.keys(m).length===0},b=function(m,y,p){var C,z,A;for(C=0,z=m.length;C<z;C++)A=m[C],y=A(y,p);return y},a.Parser=function(m){w(y,m);function y(p){this.parseStringPromise=D(this.parseStringPromise,this),this.parseString=D(this.parseString,this),this.reset=D(this.reset,this),this.assignOrPush=D(this.assignOrPush,this),this.processAsync=D(this.processAsync,this);var C,z,A;if(!(this instanceof a.Parser))return new a.Parser(p);this.options={},z=v["0.2"];for(C in z)E.call(z,C)&&(A=z[C],this.options[C]=A);for(C in p)E.call(p,C)&&(A=p[C],this.options[C]=A);this.options.xmlns&&(this.options.xmlnskey=this.options.attrkey+"ns"),this.options.normalizeTags&&(this.options.tagNameProcessors||(this.options.tagNameProcessors=[]),this.options.tagNameProcessors.unshift(T.normalize)),this.reset()}return y.prototype.processAsync=function(){var p,C;try{return this.remaining.length<=this.options.chunkSize?(p=this.remaining,this.remaining="",this.saxParser=this.saxParser.write(p),this.saxParser.close()):(p=this.remaining.substr(0,this.options.chunkSize),this.remaining=this.remaining.substr(this.options.chunkSize,this.remaining.length),this.saxParser=this.saxParser.write(p),S(this.processAsync))}catch(z){if(C=z,!this.saxParser.errThrown)return this.saxParser.errThrown=!0,this.emit(C)}},y.prototype.assignOrPush=function(p,C,z){return C in p?(p[C]instanceof Array||(p[C]=[p[C]]),p[C].push(z)):this.options.explicitArray?p[C]=[z]:p[C]=z},y.prototype.reset=function(){var p,C,z,A;return this.removeAllListeners(),this.saxParser=t.parser(this.options.strict,{trim:!1,normalize:!1,xmlns:this.options.xmlns}),this.saxParser.errThrown=!1,this.saxParser.onerror=function(P){return function(x){if(P.saxParser.resume(),!P.saxParser.errThrown)return P.saxParser.errThrown=!0,P.emit("error",x)}}(this),this.saxParser.onend=function(P){return function(){if(!P.saxParser.ended)return P.saxParser.ended=!0,P.emit("end",P.resultObject)}}(this),this.saxParser.ended=!1,this.EXPLICIT_CHARKEY=this.options.explicitCharkey,this.resultObject=null,A=[],p=this.options.attrkey,C=this.options.charkey,this.saxParser.onopentag=function(P){return function(x){var O,U,G,Z,X;if(G={},G[C]="",!P.options.ignoreAttrs){X=x.attributes;for(O in X)E.call(X,O)&&(!(p in G)&&!P.options.mergeAttrs&&(G[p]={}),U=P.options.attrValueProcessors?b(P.options.attrValueProcessors,x.attributes[O],O):x.attributes[O],Z=P.options.attrNameProcessors?b(P.options.attrNameProcessors,O):O,P.options.mergeAttrs?P.assignOrPush(G,Z,U):G[p][Z]=U)}return G["#name"]=P.options.tagNameProcessors?b(P.options.tagNameProcessors,x.name):x.name,P.options.xmlns&&(G[P.options.xmlnskey]={uri:x.uri,local:x.local}),A.push(G)}}(this),this.saxParser.onclosetag=function(P){return function(){var x,O,U,G,Z,X,W,J,re,te;if(X=A.pop(),Z=X["#name"],(!P.options.explicitChildren||!P.options.preserveChildrenOrder)&&delete X["#name"],X.cdata===!0&&(x=X.cdata,delete X.cdata),re=A[A.length-1],X[C].match(/^\s*$/)&&!x?(O=X[C],delete X[C]):(P.options.trim&&(X[C]=X[C].trim()),P.options.normalize&&(X[C]=X[C].replace(/\s{2,}/g," ").trim()),X[C]=P.options.valueProcessors?b(P.options.valueProcessors,X[C],Z):X[C],Object.keys(X).length===1&&C in X&&!P.EXPLICIT_CHARKEY&&(X=X[C])),k(X)&&(X=P.options.emptyTag!==""?P.options.emptyTag:O),P.options.validator!=null&&(te="/"+function(){var ye,ue,Se;for(Se=[],ye=0,ue=A.length;ye<ue;ye++)G=A[ye],Se.push(G["#name"]);return Se}().concat(Z).join("/"),function(){var ye;try{return X=P.options.validator(te,re&&re[Z],X)}catch(ue){return ye=ue,P.emit("error",ye)}}()),P.options.explicitChildren&&!P.options.mergeAttrs&&typeof X=="object"){if(!P.options.preserveChildrenOrder)G={},P.options.attrkey in X&&(G[P.options.attrkey]=X[P.options.attrkey],delete X[P.options.attrkey]),!P.options.charsAsChildren&&P.options.charkey in X&&(G[P.options.charkey]=X[P.options.charkey],delete X[P.options.charkey]),Object.getOwnPropertyNames(X).length>0&&(G[P.options.childkey]=X),X=G;else if(re){re[P.options.childkey]=re[P.options.childkey]||[],W={};for(U in X)E.call(X,U)&&(W[U]=X[U]);re[P.options.childkey].push(W),delete X["#name"],Object.keys(X).length===1&&C in X&&!P.EXPLICIT_CHARKEY&&(X=X[C])}}return A.length>0?P.assignOrPush(re,Z,X):(P.options.explicitRoot&&(J=X,X={},X[Z]=J),P.resultObject=X,P.saxParser.ended=!0,P.emit("end",P.resultObject))}}(this),z=function(P){return function(x){var O,U;if(U=A[A.length-1],U)return U[C]+=x,P.options.explicitChildren&&P.options.preserveChildrenOrder&&P.options.charsAsChildren&&(P.options.includeWhiteChars||x.replace(/\\n/g,"").trim()!=="")&&(U[P.options.childkey]=U[P.options.childkey]||[],O={"#name":"__text__"},O[C]=x,P.options.normalize&&(O[C]=O[C].replace(/\s{2,}/g," ").trim()),U[P.options.childkey].push(O)),U}}(this),this.saxParser.ontext=z,this.saxParser.oncdata=function(P){return function(x){var O;if(O=z(x),O)return O.cdata=!0}}()},y.prototype.parseString=function(p,C){var z;C!=null&&typeof C=="function"&&(this.on("end",function(A){return this.reset(),C(null,A)}),this.on("error",function(A){return this.reset(),C(A)}));try{return p=p.toString(),p.trim()===""?(this.emit("end",null),!0):(p=h.stripBOM(p),this.options.async?(this.remaining=p,S(this.processAsync),this.saxParser):this.saxParser.write(p).close())}catch(A){if(z=A,this.saxParser.errThrown||this.saxParser.ended){if(this.saxParser.ended)throw z}else return this.emit("error",z),this.saxParser.errThrown=!0}},y.prototype.parseStringPromise=function(p){return new Promise(function(C){return function(z,A){return C.parseString(p,function(P,x){return P?A(P):z(x)})}}(this))},y}(_),a.parseString=function(m,y,p){var C,z,A;return p!=null?(typeof p=="function"&&(C=p),typeof y=="object"&&(z=y)):(typeof y=="function"&&(C=y),z={}),A=new a.Parser(z),A.parseString(m,C)},a.parseStringPromise=function(m,y){var p,C;return typeof y=="object"&&(p=y),C=new a.Parser(p),C.parseStringPromise(m)}}).call(Hr)}(Yg)),Yg}var dE;function OP(){return dE||(dE=1,function(){var a,h,v,_,k=function(T,t){for(var S in t)b.call(t,S)&&(T[S]=t[S]);function D(){this.constructor=T}return D.prototype=t.prototype,T.prototype=new D,T.__super__=t.prototype,T},b={}.hasOwnProperty;h=Jy(),a=N5(),v=LP(),_=IT(),ps.defaults=h.defaults,ps.processors=_,ps.ValidationError=function(T){k(t,T);function t(S){this.message=S}return t}(Error),ps.Builder=a.Builder,ps.Parser=v.Parser,ps.parseString=v.parseString,ps.parseStringPromise=v.parseStringPromise}.call(Hr)),ps}const PT=FI;var zP={geoFromSVGFile:FP,geoFromSVGXML:CT,svg2geojsonVersion:PT.version};const{pathDataToPolys:kP}=HI,{vec2:pE,mat23:mE}=A5,BP=C5;function FP(a,h,v={}){var _=BP.readFileSync(a)+"";CT(_,h,v)}function CT(a,h,v={}){OP().Parser({explicitChildren:1,preserveChildrenOrder:1,xmlns:1}).parseString(a,(_,k)=>{if(_)throw _;h(NP(k,v))})}let RT=1;function NP(a,h={}){const{svg:v}=a,_={},k=[],b=v.$$.find(p=>p.$ns&&p.$ns.uri=="http://www.prognoz.ru"&&p.$ns.local=="MetaInfo"),T=b&&b.$$.find(p=>p.$ns.local=="Geo"),t=T&&T.$$.filter(p=>p.$ns.local=="GeoItem");(!t||t.length!=2)&&(console.error(`Your SVG file must include Prognoz MetaInfo as a child of <svg> element, containing 2 GeoItems. See:
http://help.prognoz.com/8.0/en/mergedProjects/Specifications/svgmapspecification/structure/svgmap_structure.htm`),Ui.exit(1));const S=$P(t),D=(t[0].$.Latitude.value*1+t[1].$.Latitude.value*1)/2*Math.PI/180,w=111132.954-559.822*Math.cos(2*D)+1.175*Math.cos(4*D),E=S.deltaLat*w/h.tolerance;RT=S.deltaY/E,v.$$.forEach((p,C)=>{if(h.layers&&p["#name"]==="g"){const z=p.$.id?p.$.id.value.replace(/_1_$/,"").replace(/_/g," "):"Layer "+C;_[z]||(_[z]=[]),LT(p,_[z],kT(p))}else _[""]||(_[""]=[]),DT(p,_[""])});for(var m in _){if(!_[m].length)continue;const p={type:"FeatureCollection",creator:`svg2geojson v${PT.version}`,features:_[m].map(C=>(y(C.coordinates),{type:"Feature",properties:h.debug?{svgID:C.coordinates.debugId}:null,geometry:C}))};k.push({name:m,geo:p})}return h.layers?k:k[0].geo;function y(p){return typeof p[0]=="number"?S(p):p.forEach(C=>{y(C)}),p}}function DT(a,h,v){switch(v=kT(a,v),a["#name"]){case"g":return LT(a,h,v);case"path":return UP(a,h,v);case"rect":return jP(a,h,v);case"line":return VP(a,h,v);case"circle":return GP(a,h,v);case"ellipse":return HP();case"polygon":return qP(a,h,v);case"polyline":return WP(a,h,v);case"style":case"MetaInfo":case"defs":case"use":break;default:console.warn("Ignoring unhandled element "+a["#name"])}}function LT(a,h,v){a.$$&&a.$$.forEach(_=>{DT(_,h,v)})}function UP(a,h,v){const _=Uc(a,"d");if(_.d){const k=OT(h,v,_.d,!0),b=_.d.match(/^.+?\d.*?[\s,-].*?\d.*?(?=[\s,a-z-]|$)/i);jc(k,a,`path @ ${b&&b[0]}`)}}function jP(a,h,v){const _=Uc(a,"x","y","width","height"),k={type:"Polygon",coordinates:[jf([[_.x,_.y],[_.x,_.y+_.height],[_.x+_.width,_.y+_.height],[_.x+_.width,_.y],[_.x,_.y]],v)]};jc(k,a,`rect @ ${_.x},${_.y}`),h.push(k)}function VP(a,h,v){const _=Uc(a,"x1","y1","x2","y2"),k={type:"LineString",coordinates:jf([[_.x1,_.y1],[_.x2,_.y2]],v)};jc(k,a,`line @ ${_.x1},${_.y1}`),h.push(k)}function GP(a,h,v){const _=Uc(a,"cx","cy","r");if(!_.r)return;const k=.55191502449*_.r,b=_.r-k,T=OT(h,v,["M",_.cx,_.cy+_.r,"c",k,0,_.r,-b,_.r,-_.r,"s",-b,-_.r,-_.r,-_.r,"s",-_.r,b,-_.r,_.r,"s",b,_.r,_.r,_.r,"z"].join(" "));jc(T,a,`circle @ ${_.cx},${_.cy}`)}function HP(a,h,v){console.error("FIXME: ADD SUPPORT FOR ELLIPSES"),Ui.exit(2)}function qP(a,h,v){const _=Uc(a,"points");if(!_.points)return;const k=_.points.split(/[\s,]+/),b=[];for(var T=0;T<k.length;T+=2)k[T]&&k[T+1]&&b.push([k[T]*1,k[T+1]*1]);b.push(b[0].concat());const t={type:"Polygon",coordinates:[jf(b,v)]};zT(t.coordinates[0],0)||(t.coordinates[0]=t.coordinates[0].reverse()),jc(t,a,`polygon @ ${b[0]},${b[1]}`),h.push(t)}function WP(a,h,v){const _=Uc(a,"points");if(!_.points)return;const k=_.points.split(/[\s,]+/),b=[];for(var T=0;T<k.length;T+=2)k[T]&&k[T+1]&&b.push([k[T]*1,k[T+1]*1]);b.push(b[0].concat());const t={type:"LineString",coordinates:jf(b,v)};jc(t,a,`polyline @ ${b[0]},${b[1]}`),h.push(t)}function OT(a,h,v,_){const k=kP(v,{tolerance:RT}),b={type:k.length>1||k[0].closed?"Polygon":"LineString",coordinates:k.map(t=>jf(t,h))};if(b.type==="LineString")b.coordinates=b.coordinates[0],b.coordinates.length===1&&(b.type="Point",b.coordinates=b.coordinates[0]);else if(_)for(var T=b.coordinates.length;T--;)zT(b.coordinates[T],T)||(b.coordinates[T]=b.coordinates[T].reverse());return a.push(b),b}function zT(a,h){for(var v=0,_=0;_<a.length;++_){var k=a[(_||a.length)-1];v+=(a[_][0]-k[0])*(a[_][1]+k[1])}return h?v<0:v>0}function Uc(a,...h){const v={};return h.forEach(_=>{v[_]=a.$[_]?isNaN(a.$[_].value*1)?a.$[_].value:a.$[_].value*1:0}),v}function kT(a,h){if(a.$&&a.$.transform){const v=/matrix\((.+?)\)/.exec(a.$.transform.value);if(v){const _=v[1].split(/[\s,]+/),k=mE.new(_[0]*1,_[1]*1,_[2]*1,_[3]*1,_[4]*1,_[5]*1);return h?mE.multiply(h,h,k):k}}return h}function $P(a){const h=_E(a[0].$.X.value*1,a[1].$.X.value*1,a[0].$.Longitude.value*1,a[1].$.Longitude.value*1),v=_E(a[0].$.Y.value*1,a[1].$.Y.value*1,a[0].$.Latitude.value*1,a[1].$.Latitude.value*1),_=k=>{k[0]=h(k[0]),k[1]=v(k[1])};return _.deltaX=h.dx,_.deltaY=v.dx,_.deltaLon=h.dy,_.deltaLat=v.dy,_}function jf(a,h){if(h){const v=pE.create();a.forEach(_=>{v.x=_[0],v.y=_[1],pE.transformMat23(v,v,h),_[0]=v.x,_[1]=v.y})}return a}function jc(a,h,v){a.coordinates.debugId=h.$&&h.$.id?`#${h.$.id}`:v}function _E(a,h,v,_){const k=h-a,b=_-v,T=b/k,t=S=>(S-a)*T+v;return t.dx=k,t.dy=b,t}var ZP=bs("<div>");function BT(a={},h){const v=new Map;for(const _ of h._data.features)v.set(_.id,_);for(const _ of a)v.set(_.id,_);h._data.features=[...v.values()],h._updateWorkerData(!0)}let yy,XP={data:{type:"FeatureCollection",features:[]}};const[YP,KP]=fa(),JP=a=>JSON.parse(JSON.stringify(a)),FT=(a,h)=>{const v=a[1]*Math.PI/180,_=111.32*Math.cos(v),k=111.32,b=h/_,T=h/k,t=Math.sign(v),S=Math.abs(v/(Math.PI/2)),D=10,w=t*8*(Math.exp(D*S)-1)/(Math.exp(D)-1);return[[a[0]-b/2-w,a[1]+T/2],[a[0]+b/2+w,a[1]+T/2],[a[0]+b/2-w,a[1]-T/2],[a[0]-b/2+w,a[1]-T/2]]},QP=(a,h,v)=>a.map(_=>_.map(k=>[h[0]+(k[0]-h[0])*v,h[1]+(k[1]-h[1])*v])),eC=a=>{let h=null;const v=new Map,_=(T,t,S)=>{const D=[T.properties.centerX,T.properties.centerY],w=T.properties.sizeKm,m=1+.2*(S<.5?2*S*S:1-Math.pow(-2*S+2,2)/2),y=a.getSource("polygonsSource");BT([T],y);const p=a.getSource(t);p&&p.setCoordinates(FT(D,w*m))},k=(T,t,S,D)=>{const E=performance.now()-D,m=100,y=T.properties.progress||0,p=S-y,C=y+p*Math.min(E/m,1);if(T.properties.progress=C,_(T,t,C),Math.abs(C-S)>.01){const z=requestAnimationFrame(()=>k(T,t,S,D));v.set(T.id,z)}else T.properties.progress=S,_(T,t,S),v.delete(T.id)},b=(T,t)=>{const S=v.get(T.id);S&&(cancelAnimationFrame(S),v.delete(T.id));const D=`${T.properties.centerY}_${T.properties.centerX}_source`,w=t?1:0;if(T.geometry.coordinates){const E=JSON.parse(T.properties.originalCoordinates);T.geometry.coordinates=QP(E,[T.properties.centerX,T.properties.centerY],t?1.2:1)}k(T,D,w,performance.now())};a.on("mousemove","polygonLayer",T=>{if(T.features.length>0){const t=T.features[0],S=t.id;if(h!==S){if(h!==null){const w=a.getSource("polygonsSource")._data.features.find(E=>E.id===h);w&&(a.setFeatureState({source:"polygonsSource",id:h},{hover:!1}),b(w,!1))}h=S,a.setFeatureState({source:"polygonsSource",id:S},{hover:!0}),t.properties.progress===void 0&&(t.properties.progress=0),b(t,!0)}}}),a.on("mouseleave","polygonLayer",()=>{if(h!==null){const t=a.getSource("polygonsSource")._data.features.find(S=>S.id===h);t&&(a.setFeatureState({source:"polygonsSource",id:h},{hover:!1}),b(t,!1)),h=null}})},tC=(a,h,v,_,k)=>{const b=`${_[1]}_${_[0]}`,T=`${b}_source`,t=`${b}_layer`;return a.addSource(T,{type:"image",url:h,coordinates:v}),a.addLayer({id:t,type:"raster",source:T,paint:{"raster-fade-duration":0,"raster-opacity":1,"raster-resampling":"nearest"}}),{sourceId:T,layerId:t,center:_,sizeKm:k}};let gE=0;const rC=async(a,h,v,_,k)=>{const b=await j3(h);let T;return new Promise((t,S)=>{DI.trace(b,{optCurve:!0},(D,w)=>{if(D)return S(D);const E=parseInt(w.match(/width="(\d+)"/)[1]),m=parseInt(w.match(/height="(\d+)"/)[1]),y=w.split(`
`);y.splice(1,0,`<MetaInfo xmlns="http://www.prognoz.ru"><Geo>
        <GeoItem X="${E}" Y="${m}" Longitude="${v[2][0]}" Latitude="${v[2][1]}"/>
        <GeoItem X="0" Y="0" Longitude="${v[0][0]}" Latitude="${v[0][1]}"/>
      </Geo></MetaInfo>`),w=y.join(`
`),zP.geoFromSVGXML(w,p=>{p.features[0].geometry.type==="LineString"&&(p.features[0].geometry.type="Polygon",p.features[0].geometry.coordinates=[p.features[0].geometry.coordinates]),p.features[0].geometry.coordinates=p.features[0].geometry.coordinates.map(P=>P.filter((x,O)=>O%2===0)),p.features[0].id=gE,gE++,T=JP(p),p.features[0].properties={...p.features[0].properties,centerX:_[0],centerY:_[1],sizeKm:k,progress:0,originalCoordinates:JSON.stringify(p.features[0].geometry.coordinates)};const C=`${_[1]}_${_[0]}_geojson_source`,z=`${_[1]}_${_[0]}_geojson_layer`,A=a.getSource("polygonsSource");BT(p.features,A),t({sourceId:C,layerId:z,orgGeojson:T})})})})},iC=a=>(Kp(async()=>{vs.accessToken="pk.eyJ1Ijoiemltb25pdHJvbWUiLCJhIjoiY2xobW0zZGtwMWRldTNkbnVhNnk1NmIxeCJ9.oSRHcrxFqxJhaKps59a4Bw";const h=new vs.Map({container:yy,zoom:2,minZoom:0,center:[0,0],projection:{name:Gp()}});h.on("load",async()=>{const v=async(T,t,S,D)=>{const w=FT(S,D),E=tC(T,t,w,S,D),m=await rC(T,t,w,S,D);return{imageLayer:E,geoJsonLayer:m}};await h.addSource("polygonsSource",{type:"geojson",data:XP.data,dynamic:!1}),await h.addLayer({id:"polygonLayer",type:"fill",source:"polygonsSource",layout:{},paint:{"fill-color":"#627BC1","fill-opacity":0}}),eC(h);let _=170,k=80,b=10;console.log("n layers",(2*_/b+1)*(2*k/b+1));for(let T=-170;T<=_;T+=b)for(let t=-80;t<=k;t+=b)await v(h,"https://raw.githubusercontent.com/zimonitrome/mapbox-scale-problem/refs/heads/main/src/assets/3.png",[T,t],1200)}),KP(h)}),Of(()=>{Gp(),YP()?.setProjection({name:Gp()})}),(()=>{var h=ZP(),v=yy;return typeof v=="function"?kf(v,h):yy=h,h.style.setProperty("width","600px"),h.style.setProperty("height","400px"),h})());var nC=bs("<div><h1>MapboxGL Flat</h1><div><div><h2>Layer Map</h2></div></div><div><label>Projection:&nbsp;<select><option value=mercator>Mercator</option><option value=globe>Globe</option></select></label><br><label>Scaling<input type=checkbox>");const[aC,oC]=fa(!0),[Gp,sC]=fa("globe"),lC=()=>(()=>{var a=nC(),h=a.firstChild,v=h.nextSibling,_=v.firstChild;_.firstChild;var k=v.nextSibling,b=k.firstChild,T=b.firstChild,t=T.nextSibling,S=b.nextSibling,D=S.nextSibling,w=D.firstChild,E=w.nextSibling;return a.style.setProperty("background-color","lightgrey"),a.style.setProperty("display","flex"),a.style.setProperty("flex-direction","column"),a.style.setProperty("align-items","center"),a.style.setProperty("gap","20px"),a.style.setProperty("padding","20px"),v.style.setProperty("display","flex"),v.style.setProperty("justify-content","space-around"),v.style.setProperty("width","100%"),_.style.setProperty("text-align","center"),cl(_,Gn(iC,{}),null),t.addEventListener("change",m=>{const y=m.target;sC(y.value)}),E.addEventListener("change",m=>{const y=m.target;oC(y.checked)}),Pa(()=>t.value=Gp()),Pa(()=>E.checked=aC()),a})();var uC=bs("<nav>");const cC=a=>[(()=>{var h=uC();return h.style.setProperty("display","flex"),h.style.setProperty("flex-direction","column"),cl(h,Gn(lg,{href:"/mapbox-scale-problem/",children:"ScaleExample"}),null),cl(h,Gn(lg,{href:"/mapbox-scale-problem/SymbolScaleExample",children:"SymbolScaleExample"}),null),cl(h,Gn(lg,{href:"/mapbox-scale-problem/FlatMap",children:"FlatMap"}),null),h})(),kn(()=>a.children)];QA(()=>Gn(F3,{root:cC,get children(){return[Gn(sg,{path:"/mapbox-scale-problem/",component:K3}),Gn(sg,{path:"/mapbox-scale-problem/SymbolScaleExample",component:nI}),Gn(sg,{path:"/mapbox-scale-problem/FlatMap",component:lC})]}}),document.getElementById("root"));
